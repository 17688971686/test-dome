!function(){"use strict";angular.module("app",["ui.router","kendo.directives"]).config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/index"),e.state("index",{url:"/index",templateUrl:rootPath+"/admin/gtasks.html",controller:"adminCtrl",controllerAs:"vm"}).state("dtasks",{url:"/dtasks",templateUrl:rootPath+"/admin/dtasks.html",controller:"adminDoingCtrl",controllerAs:"vm"}).state("etasks",{url:"/etasks",templateUrl:rootPath+"/admin/etasks.html",controller:"adminEndCtrl",controllerAs:"vm"}).state("role",{url:"/role",templateUrl:rootPath+"/role/html/list.html",controller:"roleCtrl",controllerAs:"vm"}).state("roleEdit",{url:"/roleEdit/:id",templateUrl:rootPath+"/role/html/edit.html",controller:"roleEditCtrl",controllerAs:"vm"}).state("user",{url:"/user",templateUrl:rootPath+"/user/html/list.html",controller:"userCtrl",controllerAs:"vm"}).state("userEdit",{url:"/userEdit/:id",templateUrl:rootPath+"/user/html/edit.html",controller:"userEditCtrl",controllerAs:"vm"}).state("org",{url:"/org",templateUrl:rootPath+"/org/html/list.html",controller:"orgCtrl",controllerAs:"vm"}).state("orgEdit",{url:"/orgEdit/:id",templateUrl:rootPath+"/org/html/edit.html",controller:"orgEditCtrl",controllerAs:"vm"}).state("orgUser",{url:"/orgUser/:id",templateUrl:rootPath+"/org/html/orgUser.html",controller:"orgUserCtrl",controllerAs:"vm"}).state("log",{url:"/log",templateUrl:rootPath+"/log/html/list.html",controller:"logCtrl",controllerAs:"vm"}).state("config",{url:"/config",templateUrl:rootPath+"/sysConfig/html/list.html",controller:"sysConfigCtrl",controllerAs:"vm"}).state("upload",{url:"/upload/:uploadid",templateUrl:rootPath+"/upload/html/edit.html",controller:"uploadEditCtrl",controllerAs:"vm"}).state("meeting",{url:"/meeting",templateUrl:rootPath+"/meeting/html/list.html",controller:"meetingCtrl",controllerAs:"vm"}).state("meetingEdit",{url:"/meetingEdit/:id",templateUrl:rootPath+"/meeting/html/edit.html",controller:"meetingEditCtrl",controllerAs:"vm"}).state("room",{url:"/room/:workProgramId",templateUrl:rootPath+"/room/html/roomlist.html",controller:"roomCtrl",controllerAs:"vm"}).state("roomCount",{url:"/roomCount/:id",templateUrl:rootPath+"/room/html/countlist.html",controller:"roomCountCtrl",controllerAs:"vm"}).state("company",{url:"/company",templateUrl:rootPath+"/company/html/list.html",controller:"companyCtrl",controllerAs:"vm"}).state("companyEdit",{url:"/companyEdit/:id",templateUrl:rootPath+"/company/html/edit.html",controller:"companyEditCtrl",controllerAs:"vm"}).state("accountPwd",{url:"/accountPwd",templateUrl:rootPath+"/account/html/changePwd.html",controller:"homeCtrl",controllerAs:"vm"}).state("demo",{url:"/demo",templateUrl:rootPath+"/demo/html/list.html",controller:"demoCtrl",controllerAs:"vm"}).state("myTest",{url:"/myTest",templateUrl:rootPath+"/myTest/html/list.html",controller:"myTestCtrl",controllerAs:"vm"}).state("myTestEdit",{url:"/myTestEdit/:id",templateUrl:rootPath+"/myTest/html/edit.html",controller:"myTestEditCtrl",controllerAs:"vm"}).state("dict",{url:"/dict",templateUrl:rootPath+"/dict/html/list.html",controller:"dictCtrl",controllerAs:"vm"}).state("dict.edit",{url:"/edit/:id",templateUrl:rootPath+"/dict/html/edit.html",controller:"dictEditCtrl",controllerAs:"vm"}).state("expert",{url:"/expert",templateUrl:rootPath+"/expert/html/queryAllList.html",controller:"expertCtrl",controllerAs:"vm"}).state("expertAudit",{url:"/expertAudit",templateUrl:rootPath+"/expert/html/audit.html",controller:"expertAuditCtrl",controllerAs:"vm"}).state("expertRepeat",{url:"/expertRepeat",templateUrl:rootPath+"/expert/html/repeat.html",controller:"expertRepeatCtrl",controllerAs:"vm"}).state("expertEdit",{url:"/expertEdit/:expertID",templateUrl:rootPath+"/expert/html/edit.html",controller:"expertEditCtrl",controllerAs:"vm"}).state("expertReviewEdit",{url:"/expertReview/:workProgramId",templateUrl:rootPath+"/expertReview/html/selectExpert.html",controller:"expertSelectCtrl",controllerAs:"vm"}).state("addSign",{url:"/addSign",templateUrl:rootPath+"/sign/html/add.html",controller:"signCreateCtrl",controllerAs:"vm"}).state("fillSign",{url:"/fillSign/:signid",cache:"false",templateUrl:rootPath+"/sign/html/fillin.html",controller:"signFillinCtrl",controllerAs:"vm"}).state("listSign",{url:"/listSign",templateUrl:rootPath+"/sign/html/list.html",controller:"signCtrl",controllerAs:"vm"}).state("signFlowDeal",{url:"/signFlowDeal/:signid/:taskId/:processInstanceId",templateUrl:rootPath+"/sign/html/flowDeal.html",controller:"signFlowDealCtrl",controllerAs:"vm"}).state("signFlowDetail",{url:"/signFlowDetail/:signid/:taskId/:processInstanceId",templateUrl:rootPath+"/sign/html/signFlowDetail.html",controller:"signFlowDetailCtrl",controllerAs:"vm"}).state("signDetails",{url:"/signDetails/:signid/:processInstanceId",templateUrl:rootPath+"/sign/html/signDetails.html",controller:"signDetailsCtrl",controllerAs:"vm"}).state("endSignDetail",{url:"/endSignDetail/:signid/:processInstanceId",templateUrl:rootPath+"/sign/html/signEndDetails.html",controller:"signEndCtrl",controllerAs:"vm"}).state("workprogramEdit",{url:"/workprogramEdit/:signid",templateUrl:rootPath+"/workprogram/html/edit.html",controller:"workprogramEditCtrl",controllerAs:"vm"}).state("workprogramBaseEdit",{url:"/workprogramBaseEdit/:signid",templateUrl:rootPath+"/workprogram/html/baseEdit.html",controller:"workprogramBaseEditCtrl",controllerAs:"vm"}).state("dispatchEdit",{url:"/dispatchEdit/:signid",templateUrl:rootPath+"/dispatch/html/edit.html",controller:"dispatchEditCtrl",controllerAs:"vm"}).state("fileRecordEdit",{url:"/fileRecordEdit/:signid",templateUrl:rootPath+"/fileRecord/html/edit.html",controller:"fileRecordEditCtrl",controllerAs:"vm"}).state("assistPlan",{url:"/assistPlan",templateUrl:rootPath+"/assistPlan/html/manager.html",controller:"assistPlanCtrl",controllerAs:"vm"}).state("officeUserList",{url:"/officeUserList",templateUrl:rootPath+"/officeUser/html/list.html",controller:"officeUserCtrl",controllerAs:"vm"}).state("officeUserEdit",{url:"/officeUserEdit/:officeID",templateUrl:rootPath+"/officeUser/html/edit.html",controller:"officeUserEditCtrl",controllerAs:"vm"}).state("listDept",{url:"/listDept",templateUrl:rootPath+"/dept/html/list.html",controller:"deptCtrl",controllerAs:"vm"}).state("deptEdit",{url:"/deptEdit/:deptId",templateUrl:rootPath+"/dept/html/edit.html",controller:"deptEditCtrl",controllerAs:"vm"}).state("deptOfficeUser",{url:"/deptOfficeUser/:deptId",templateUrl:rootPath+"/dept/html/listOfficeUser.html",controller:"deptOfficeUserCtrl",controllerAs:"vm"}).state("assistUnit",{url:"/assistUnit",templateUrl:rootPath+"/assistUnit/html/assistUnitList.html",controller:"assistUnitCtrl",controllerAs:"vm"}).state("assistUnitEdit",{url:"/assistUnitEdit/:id",templateUrl:rootPath+"/assistUnit/html/assistUnitEdit.html",controller:"assistUnitEditCtrl",controllerAs:"vm"})}]).run(function(e,t,o,i){e.getTBHeadName=function(e,t,o){return!t||"9"!=t||"项目建议书"!=e&&"可行性研究报告"!=e?e?"项目概算"==e?"概算审核"+o:e+o:o:"评估论证"+o},e.$state=o,e.$stateParams=i,e.$on("$stateChangeSuccess",function(t,o,i,n,a){e.previousState_name=n.name,e.previousState_params=a}),e.back=function(){e.previousState_name?o.go(e.previousState_name,e.previousState_params):window.history.back()},kendo.culture("zh-CN"),e.topSelectChange=function(e,t,o){for(var i=0;i<t.length;i++)if(o&&"code"==o){if(t[i].dictCode==e)return t[i].dicts}else if(t[i].dictName==e)return t[i].dicts},common.getTaskCount({$http:t}),common.initDictData({$http:t,scope:e})})}(),function(){"use strict";function e(e,t){var o=this;o.title="待办事项",function(){t.gtasksGrid(o)}()}angular.module("app").controller("adminCtrl",e),e.$inject=["$location","adminSvc"]}(),function(){"use strict";function e(e,t){var o=this;o.title="在办任务",function(){t.dtasksGrid(o)}()}angular.module("app").controller("adminDoingCtrl",e),e.$inject=["$location","adminSvc"]}(),function(){"use strict";function e(e,t){var o=this;o.title="办结事项",function(){t.etasksGrid(o)}()}angular.module("app").controller("adminEndCtrl",e),e.$inject=["$location","adminSvc"]}(),function(){"use strict";function e(e,t){function o(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/flow/html/tasks"),schema:{data:"value",total:function(e){return e.count?$("#GtasksCount").html(e.count):$("#GtasksCount").html(0),e.count},model:{id:"id",fields:{createdDate:{type:"date"}}}},serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=[{field:"",title:"序号",template:"<span class='row-number'></span>",width:30},{field:"businessName",title:"任务名称",filterable:!1,width:180},{field:"flowName",title:"所属流程",width:180,filterable:!1},{field:"taskName",title:"当前环节",width:180,filterable:!1},{field:"createDate",title:"接收时间",width:150,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"",title:"流程状态",width:80,filterable:!1,template:function(e){return e.isSuspended?'<span style="color:orange;">已暂停</span>':'<span style="color:green;">进行中</span>'}},{field:"",title:"操作",width:180,template:function(e){return"FINAL_SIGN_FLOW"==e.flowKey||"SIGN_XS_FLOW"==e.flowKey?common.format($("#columnBtns").html(),"signFlowDeal",e.businessKey,e.taskId,e.processInstanceId):'<a class="btn btn-xs btn-danger" >流程已停用</a>'}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,resizable:!0,dataBound:function(){var e=this.items(),t=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*o,i=$(this).find(".row-number");$(i).html(e)})}}}function i(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/flow/html/endTasks"),schema:{data:"value",total:function(e){return e.count},model:{id:"id",fields:{createdDate:{type:"date"}}}},serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=[{field:"",title:"序号",template:"<span class='row-number'></span>",width:30},{field:"businessName",title:"任务名称",filterable:!1,width:180},{field:"createDate",title:"开始时间",width:150,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"endDate",title:"结束时间",width:150,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"",title:"用时",width:180,filterable:!1,template:function(e){return e.durationTime?e.durationTime:'<span style="color:orangered;">已办结</span>'}},{field:"",title:"流程状态",width:120,filterable:!1,template:function(e){return'<span style="color:orangered;">已办结</span>'}},{field:"",title:"操作",width:80,template:function(e){if(e.processDefinitionId.indexOf("FINAL_SIGN_FLOW")>=0||e.processDefinitionId.indexOf("SIGN_XS_FLOW")>=0)return common.format($("#columnBtns").html(),"endSignDetail",e.businessKey,e.processInstanceId)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,resizable:!0,dataBound:function(){var e=this.items(),t=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*o,i=$(this).find(".row-number");$(i).html(e)})}}}function n(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/flow/html/doingtasks"),schema:{data:"value",total:function(e){return e.count},model:{id:"id"}},serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=[{field:"",title:"序号",template:"<span class='row-number'></span>",width:30},{field:"businessName",title:"任务名称",filterable:!1,width:180},{field:"flowName",title:"所属流程",width:180,filterable:!1},{field:"taskName",title:"当前环节",width:180,filterable:!1},{field:"createDate",title:"接收时间",width:150,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"",title:"流程状态",width:80,filterable:!1,template:function(e){return e.isSuspended?'<span style="color:orange;">已暂停</span>':'<span style="color:green;">进行中</span>'}},{field:"",title:"操作",width:180,template:function(e){return"FINAL_SIGN_FLOW"==e.flowKey||"SIGN_XS_FLOW"==e.flowKey?common.format($("#columnBtns").html(),"signFlowDetail",e.businessKey,e.taskId,e.processInstanceId):'<a class="btn btn-xs btn-danger" >流程已停用</a>'}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,resizable:!0,dataBound:function(){var e=this.items(),t=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*o,i=$(this).find(".row-number");$(i).html(e)})}}}return{gtasksGrid:o,etasksGrid:i,dtasksGrid:n}}angular.module("app").factory("adminSvc",e),e.$inject=["$rootScope","$http"]}(),function(){"use strict";function e(e,t,o,i,n){var a=this;a.model={},a.filterModel={},a.filterLow={},a.title="协审计划管理",a.splitNumArr=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],a.plan={},a.planList=new Array,a.showPlan={},a.assistSign=new Array,a.pickSign=new Array,a.pickMainSign=new Array,a.lowerSign=new Array,a.selectPlanId="",a.selectMainSignId="",a.initPickLowSign=!1,function(){o.initPlanPage(a),o.initPlanGrid(a),$("#planInfo li").click(function(e){var t=$("a",this);e.preventDefault(),t.tab("show");var o=t.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+o).addClass("active").addClass("in").show(500)})}(),a.filterSign=function(e){var t=!0;if(!angular.isUndefined(e)&&(angular.isUndefined(a.filterModel.filterFilecode)||-1==e.filecode.indexOf(a.filterModel.filterFilecode)&&(t=!1),t&&(angular.isUndefined(a.filterModel.filterProjectCode)||-1==e.projectcode.indexOf(a.filterModel.filterProjectCode)&&(t=!1)),t&&(angular.isUndefined(a.filterModel.filterProjectName)||-1==e.projectname.indexOf(a.filterModel.filterProjectName)&&(t=!1)),t&&(angular.isUndefined(a.filterModel.filterBuiltName)||(angular.isUndefined(e.builtcompanyName)&&(t=!1),t&&-1==e.builtcompanyName.indexOf(a.filterModel.filterBuiltName)&&(t=!1))),t))return e},a.filterLowSign=function(e){var t=!0;if(!angular.isUndefined(e)&&(angular.isUndefined(a.filterLow.filterFilecode)||-1==e.filecode.indexOf(a.filterLow.filterFilecode)&&(t=!1),t&&(angular.isUndefined(a.filterLow.filterProjectCode)||-1==e.projectcode.indexOf(a.filterLow.filterProjectCode)&&(t=!1)),t&&(angular.isUndefined(a.filterLow.filterProjectName)||-1==e.projectname.indexOf(a.filterLow.filterProjectName)&&(t=!1)),t&&(angular.isUndefined(a.filterLow.filterBuiltName)||(angular.isUndefined(e.builtcompanyName)&&(t=!1),t&&-1==e.builtcompanyName.indexOf(a.filterLow.filterBuiltName)&&(t=!1))),t))return e},a.initSplit=function(e){a.plan.assistType==e&&(angular.isUndefined(a.plan.spliNum)||(a.plan.spliNum=0))},a.affirmSign=function(){var e=$("input[name='selASTSign']:checked");if(e.length<1)common.alert({vm:a,msg:"请选择要挑选的项目"});else{if(e.length>1)return void("合并项目"==a.plan.assistType?common.alert({vm:a,msg:"合并项目要先挑选一个主项目，再挑选次项目！"}):common.alert({vm:a,msg:"独立项目，每次只能选择一个！"}));a.model.signId=e[0].value,a.model.assistType=a.plan.assistType,a.model.single="合并项目"!=a.plan.assistType,a.model.splitNum=a.plan.spliNum,a.model.id=a.selectPlanId,a.assistSign.forEach(function(e,t){e.signid==a.model.signId&&(a.model.projectName=e.projectname)}),o.saveAssistPlan(a)}},a.cancelSign=function(){var e=$("input[name='checkASTSign']:checked");e.length<1?common.alert({vm:a,msg:"请选择取消的项目"}):common.confirm({vm:a,title:"",msg:"确认取消挑选项目吗?",fn:function(){$(".confirmDialog").modal("hide");for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);o.cancelPlanSign(a,t.join(","))}})},a.initSelPlan=function(){o.initSelPlan(a)},a.doDelete=function(){a.showPlan.id?common.confirm({vm:a,title:"",msg:"确认删除数据吗?",fn:function(){$(".confirmDialog").modal("hide"),o.deletePlan(a)}}):common.alert({vm:a,msg:"请选择要删除的数据"})},a.showPickLowSign=function(e){a.selectMainSignId=e,o.showPickLowSign(a),$("#lowerSignWin").kendoWindow({width:"1024px",height:"600px",title:"次项目信息",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},a.affirmLowerSign=function(){var e=$("input[name='selLowSign']:checked");if(e.length<1)common.alert({vm:a,msg:"请选择要挑选的次项目"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);o.saveLowPlanSign(a,t)}},a.cancelLowerSign=function(){var e=$("input[name='checkLowSign']:checked");if(e.length<1)common.alert({vm:a,msg:"请选择要挑选的次项目"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);o.cancelLowPlanSign(a,t.join(","))}},a.queryPlan=function(){o.queryPlan(a)};var r="";a.planId="",a.showPlanDetail=function(e){$("#planInfo").kendoWindow({width:"1024px",height:"600px",title:"协审项目清单",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open(),a.signNum=0,r=e,a.planId=e,o.getPlanSignByPlanId(a,e)},a.ministerOpinionEdit=function(e){common.initIdeaData(a,i,e)},a.viceDirectorOpinionEdit=function(e){common.initIdeaData(a,i,e)},a.directorOpinionEdit=function(e){common.initIdeaData(a,i,e)},a.assistPlan={},a.savePlanSign=function(){o.savePlanSign(a),a.assistPlan.id=r,o.savePlan(a)},a.checked="option1",a.chooseAssistUnit=function(){a.number=0,"option1"==a.checked&&(a.number=a.assistPlanSign.length+1),"option2"==a.checked&&(a.number=a.assistPlanSign.length),o.chooseAssistUnit(a)},a.againChooleAssistUnit=function(){$("#againChooleAssistUnit").kendoWindow({title:"选择参加协审单位",width:"30%",height:"60%",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open(),o.getPlanSignByPlanId(a,a.planId)},a.drawAssistUnit=function(){if(void 0!=a.assistPlanSign&&a.assistPlanSign.length>0){a.assistPlanSign.forEach(function(e,t){e.assistUnit=null}),a.drawAssistUnits=a.unitList.slice(0);for(var e=0,t=-1,o=0;o<a.drawAssistUnits.length;o++)if("9"==a.drawAssistUnits[o].isLastUnSelected){o;var i=Math.floor(Math.random()*a.assistPlanSign.length);t=i,a.assistPlanSign[i].assistUnit=a.drawAssistUnits[o],a.drawPlanSign=a.assistPlanSign[i],a.drawAssistUnits.splice(o,1)}a.drawPlanSign=a.assistPlanSign[e];var r=0;a.isStartDraw=!0,a.isDrawDone=!1,a.t=n(function(){a.drawPlanSign=a.assistPlanSign[e];var o=Math.floor(Math.random()*a.drawAssistUnits.length),i=a.drawAssistUnits[o];a.showAssitUnitName=i.unitName,++r%20==0&&(e!=t&&(a.assistPlanSign[e].assistUnit=i),e++,e==a.assistPlanSign.length&&(n.cancel(a.t),a.isDrawDone=!0),a.drawAssistUnits.forEach(function(e,t){e.id==i.id&&a.drawAssistUnits.splice(t,1)}))},50)}},a.saveDrawAssistUnit=function(){o.saveDrawAssistUnit(a)}}angular.module("app").controller("assistPlanCtrl",e),e.$inject=["$location","$state","assistSvc","$http","$interval"]}(),function(){"use strict";function e(e,t){var o=this;o.title="协审单位",o.resource={},o.del=function(e){o.id=e,common.confirm({vm:o,title:"",msg:"确认要删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),o.resource={},t.deleteAssistUnit(o,e)}})},o.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:o,msg:"请选择数据"});else{for(var i=[],n=0;n<e.length;n++)i.push(e[n].value);var a=i.join(",");t.deleteAssistUnit(o,a)}},o.queryAssistUnit=function(){t.queryAssistUnit(o)},function(){t.grid(o)}()}angular.module("app").controller("assistUnitCtrl",e),e.$inject=["$location","assistUnitSvc"]}(),function(){"use strict";function e(e){function t(t){if(common.initJqValidation(),$("form").valid()&&0==t.isUnitExist){var o={method:"post",url:s,data:t.assistUnit},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=c}})}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}}function o(t,o){t.isSubmint=!0;var i={method:"delete",url:s,data:o},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),t.gridOptions.dataSource.read()}})}})};common.http({vm:t,$http:e,httpOptions:i,success:n})}function i(t){if(common.initJqValidation(),$("form").valid()&&0==t.isUnitExist){var o={method:"put",url:s,headers:{contentType:"application/json;charset=utf-8"},dataType:"json",data:angular.toJson(t.assistUnit)},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=c}})}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}}function n(t){var o={method:"get",url:s+"/getAssistUnitById",params:{id:t.id}},i=function(e){t.assistUnit=e.data};common.http({vm:t,$http:e,httpOptions:o,success:i})}function a(e){e.gridOptions.dataSource.read()}function r(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(s+"/fingByOData?$orderby=unitSort",$("#assistUnitform")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"},modifiedDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"unitSort",title:"序号",width:50,filterable:!1},{field:"unitName",title:"单位名称",width:100,filterable:!0},{field:"unitShortName",title:"单位简称",width:100,filterable:!0},{field:"phoneNum",title:"电话号码",width:100,filterable:!1},{field:"phoneNum",title:"传真",width:100,filterable:!1},{field:"principalName",title:"负责人名称",width:100,filterable:!1},{field:"principalPhone",title:"负责人手机号",width:100,filterable:!1},{field:"contactName",title:"联系人名称",width:100,filterable:!1},{field:"contactPhone",title:"联系人手机号",width:100,filterable:!1},{field:"address",title:"企业地址",width:100,filterable:!0},{field:"",title:"操作",width:140,template:function(e){return common.format($("#columnBtns").html(),"vm.del('"+e.id+"')",e.id,e.isUse)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,resizable:!0}}var s=rootPath+"/assistUnit",c="#/assistUnit";return{grid:r,deleteAssistUnit:o,createAssistUnit:t,updateAssistUnit:i,getAssistUnitById:n,queryAssistUnit:a}}angular.module("app").factory("assistUnitSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,o){var i=this;i.title="新增协审单位",i.id=o.params.id,i.isUnitExist=!1,i.id&&(i.isUpdate=!0,i.title="更新协审单位"),i.create=function(){t.createAssistUnit(i)},i.update=function(){t.updateAssistUnit(i)},function(){i.isUpdate&&t.getAssistUnitById(i)}()}angular.module("app").controller("assistUnitEditCtrl",e),e.$inject=["$location","assistUnitSvc","$state"]}(),function(){"use strict";function e(e,t){function o(){return[{field:"rowNumber",title:"序号",width:50,template:"<span class='row-number'></span>"},{field:"planName",title:"协审计划名称",width:100,filterable:!1},{field:"reportTime",title:"报审时间",width:50,filterable:!1,format:"{0: yyyy-MM-dd}"},{field:"drawTime",title:"抽签时间",width:100,filterable:!1},{field:"createdBy",title:"创建人员",width:100,filterable:!1},{field:"createdDate",title:"记录生成时间",width:100,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"",title:"操作",width:100,filterable:!1,template:function(e){return'<button class="btn btn-xs btn-primary"  ng-click="vm.showPlanDetail(\''+e.id+'\')"><span class="glyphicon glyphicon-edit"></span>详情</button>'}}]}function i(e){var t=common.kendoGridDataSource(rootPath+"/assistPlan/findByOData",$("#searchform")),i=function(){var e=this.items(),t=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*o,i=$(this).find(".row-number");$(i).html(e)})};e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o(),dataBound:i,resizable:!0}}function n(t){var o={method:"get",url:rootPath+"/assistPlan/initPlanManager"},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.planList=new Array,e.data.signList&&(t.assistSign=e.data.signList),e.data.planList&&e.data.planList.length>0&&(t.planList=e.data.planList,t.selectPlanId||(t.showPlan=e.data.planList[0],t.selectPlanId=t.showPlan.id),m(t))}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}function a(t){var o=rootPath+"/assistPlan",i={method:"post",url:o,data:t.model},a=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.iscommit=!1,t.showPlan.id||t.gridOptions.dataSource.read(),t.showPlan=e.data,n(t),"合并项目"==t.plan.assistType?t.showPickLowSign(t.model.signId):common.alert({vm:t,msg:"操作成功！",closeDialog:!0})}})};common.http({vm:t,$http:e,httpOptions:i,success:a})}function r(t){var o={method:"delete",url:rootPath+"/assistPlan",data:t.showPlan.id},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.iscommit=!1,common.alert({vm:t,msg:"操作成功！",fn:function(){$(".alertDialog").modal("hide"),n(t),t.gridOptions.dataSource.read()}})}})};common.http({vm:t,$http:e,httpOptions:o,success:i,onError:function(){t.iscommit=!1}})}function s(t,o){var i={method:"get",url:rootPath+"/sign/findByPlanId",params:{planId:o}},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.pickSign=e.data,t.pickMainSign=new Array,t.lowerSign=new Array,t.showPlan.assistPlanSignDtoList&&t.pickSign.forEach(function(e,o){t.showPlan.assistPlanSignDtoList.forEach(function(o,i){"9"==o.isMain&&o.signId==e.signid&&(e.assistType=o.assistType,t.pickMainSign.push(e))})}),1==t.initPickLowSign&&u(t)}})};common.http({vm:t,$http:e,httpOptions:i,success:n,onError:function(){t.iscommit=!1}})}function c(t,o){var i={method:"delete",url:rootPath+"/assistPlan/cancelPlanSign",params:{planId:t.selectPlanId,signIds:o}},a=function(e){common.requestSuccess({vm:t,response:e,fn:function(){n(t),common.alert({vm:t,msg:"操作成功！",closeDialog:!0})}})};common.http({vm:t,$http:e,httpOptions:i,success:a,onError:function(){t.iscommit=!1}})}function l(t,o){var i=new Array;t.assistSign.forEach(function(e,n){for(var a=0,r=o.length;a<r;a++)if(e.signid==o[a]){var s={};s.signId=e.signid,s.projectName=e.projectname,s.assistType="合并项目",s.isMain="0",s.mainSignId=t.selectMainSignId,i.push(s)}}),t.model=t.showPlan,t.model.assistPlanSignDtoList=i,t.iscommit=!0;var a={method:"post",url:rootPath+"/assistPlan/saveLowPlanSign",data:t.model},r=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.iscommit=!1,t.initPickLowSign=!0,n(t),common.alert({vm:t,msg:"操作成功！",closeDialog:!0})}})};common.http({vm:t,$http:e,httpOptions:a,success:r,onError:function(){t.iscommit=!1}})}function d(t,o){t.iscommit=!0;var i={method:"delete",url:rootPath+"/assistPlan/cancelLowPlanSign",params:{planId:t.showPlan.id,signIds:o}},a=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.iscommit=!1,t.initPickLowSign=!0,n(t),common.alert({vm:t,msg:"操作成功！",closeDialog:!0})}})};common.http({vm:t,$http:e,httpOptions:i,success:a,onError:function(){t.iscommit=!1}})}function m(e){e.selectPlanId?(e.planList.forEach(function(t,o){t.id==e.selectPlanId&&(e.showPlan=t)}),s(e,e.selectPlanId)):(e.showPlan={},e.pickSign=new Array,e.pickMainSign=new Array,e.lowerSign=new Array,e.selectMainSignId="",e.initPickLowSign=!1)}function u(e){e.lowerSign=new Array,e.pickSign.forEach(function(t,o){e.showPlan.assistPlanSignDtoList.forEach(function(o,i){"0"==o.isMain&&o.mainSignId==e.selectMainSignId&&o.signId==t.signid&&e.lowerSign.push(t)})})}function f(e){e.gridOptions.dataSource.read()}function p(t,o){t.reviewNum="";var i={method:"get",url:rootPath+"/assistPlanSign/getPlanSignByPlanId",params:{planId:o}},n=function(e){t.assistPlanSign=e.data,t.reviewNum=t.assistPlanSign.length,t.assistPlanSign.length>0&&(v(t,o),S(t,o))};common.http({vm:t,$http:e,httpOptions:i,success:n})}function h(t){var o={method:"put",url:rootPath+"/assistPlanSign/savePlanSign",headers:{contentType:"application/json;charset=utf-8"},dataType:"json",data:angular.toJson(t.assistPlanSign)},i=function(e){};common.http({vm:t,$http:e,httpOptions:o,success:i})}function g(t){var o={method:"put",url:rootPath+"/assistPlan",data:t.assistPlan},i=function(e){alert("保存成功！"),window.parent.$("#planInfo").data("kendoWindow").close()};common.http({vm:t,$http:e,httpOptions:o,success:i})}function v(t,o){var i={method:"get",url:rootPath+"/assistPlan/html/findById",params:{id:o}},n=function(e){t.assistPlan=e.data};common.http({vm:t,$http:e,httpOptions:i,success:n})}function w(t){var o={method:"get",url:rootPath+"/assistUnit/chooseAssistUnit",params:{planId:t.planId,number:t.number}},i=function(e){t.unitList=e.data,t.signNum=t.unitList.length,t.isChoose=!0};common.http({vm:t,$http:e,httpOptions:o,success:i})}function S(t,o){var i={method:"get",url:rootPath+"/assistUnit/getAssistUnitByPlanId",params:{planId:o}},n=function(e){t.unitList=e.data,t.signNum=t.unitList.length,t.unitList.length>0&&(t.isChoose=!0)};common.http({vm:t,$http:e,httpOptions:i,success:n})}function k(t){var o={method:"post",url:rootPath+"/assistUnitUser/findByOData"},i=function(e){t.unitUserList=e.data.value};common.http({vm:t,$http:e,httpOptions:o,success:i})}function b(t){var o={method:"post",url:rootPath+"/assistUnit/fingByOData"},i=function(e){t.allUnitList=e.data.value};common.http({vm:t,$http:e,httpOptions:o,success:i})}function D(t){var o="",i=t.assistPlanSign.length;t.assistPlanSign.forEach(function(e,t){o+=e.id+"|"+e.assistUnit.id,t!=i-1&&(o+=",")});var n="";if(t.drawAssistUnits.length>0){var a=t.drawAssistUnits.length;t.drawAssistUnits.forEach(function(e,t){n+=e.id,t!=a-1&&(n+=",")})}t.iscommit=!0;var r={method:"put",url:rootPath+"/assistPlan/saveDrawAssistUnit",params:{planId:t.planId,drawAssitUnitIds:o,unSelectedIds:n}},s=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.iscommit=!1,t.isCommited=!0,common.alert({closeDialog:!0,vm:t,msg:"操作成功！"})}})};common.http({vm:t,$http:e,httpOptions:r,success:s,onError:function(e){t.iscommit=!1}})}return{initPlanPage:n,initPlanGrid:i,saveAssistPlan:a,deletePlan:r,findPlanSign:s,cancelPlanSign:c,saveLowPlanSign:l,cancelLowPlanSign:d,initSelPlan:m,showPickLowSign:u,queryPlan:f,getPlanSignByPlanId:p,savePlanSign:h,savePlan:g,initPlanByPlanId:v,chooseAssistUnit:w,saveDrawAssistUnit:D,initAssistUnit:S,getUnitUser:k,getAllUnit:b}}angular.module("app").factory("assistSvc",e),e.$inject=["$http","$state"]}(),function(){"use strict";function e(e,t){window.open(rootPath+"/file/fileDownload?sysfileId="+t)}function t(e,t,o){var i={method:"delete",url:rootPath+"/file/deleteSysFile",data:t},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){window.parent.$("#commonQueryWindow").data("kendoWindow").close(),common.alert({vm:e,msg:"删除成功",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}})}})};common.http({vm:e,$http:o,httpOptions:i,success:n})}function o(e){$("#commonuploadWindow").kendoWindow({width:"660px",height:"400px",title:"附件上传",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open(),i(e)}function i(e){var t=e.businessId,o={language:"zh",allowedPreviewTypes:["image"],allowedFileExtensions:["jpg","png","gif","xlsx","docx","doc","xls","pdf"],maxFileSize:2e3,showRemove:!1,uploadUrl:rootPath+"/file/fileUpload",uploadExtraData:{businessId:t}};$("#commonphotofile").fileinput(o).on("filebatchselected",function(e,t){}).on("fileuploaded",function(e,t){})}function n(e,t){var o=e.sysSignId,i={method:"get",url:rootPath+"/file/findBySysFileSignId",params:{signid:o}},n=function(t){e.sysFilelists=t.data};common.http({vm:e,$http:t,httpOptions:i,success:n})}function a(e){$("#commonQueryWindow").kendoWindow({
width:"800px",height:"400px",title:"附件上传列表",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()}function r(e){e?(e.removeData("validator"),e.removeData("unobtrusiveValidation"),$.validator.unobtrusive.parse(e)):($("form").removeData("validator"),$("form").removeData("unobtrusiveValidation"),$.validator.unobtrusive.parse("form"))}function s(e){var t="发生错误,系统已记录,我们会尽快处理！";void 0!=e.response&&(401==e.response.status&&(location.href=A.loginUrl),t=e.response.data.message||t),A.alert({vm:e.vm,msg:t,fn:function(){e.vm.isSubmit=!1,e.vm.disabledButton=!1,$(".alertDialog").modal("hide")}})}function c(e){var t=function(t){A.alert({vm:e.vm,msg:t,fn:function(){e.vm.isSubmit=!1,$(".alertDialog").modal("hide")}})};if(e.response.status>400)t("发生错误！");else{var o=e.response.data;o&&555==o.status?t(o.message):e.fn&&e.fn(o)}}function l(){for(var e=arguments[0],t=1;t<arguments.length;t++){var o=new RegExp("\\{"+(t-1)+"\\}","gm");e=e.replace(o,arguments[t])}return e}function d(e){var t=e.toString().replace(/[^0-9]/g,"");return parseInt(t,10)}function m(e){return isNaN(parseFloat(e,10))?0:parseFloat(e,10)}function u(){return $(window).height()-180}function f(e){e.vm.alertDialogMessage=e.msg,e.vm.alertDialogFn=function(){e.closeDialog&&1==e.closeDialog&&($(".alertDialog").modal("hide"),$(".modal-backdrop").remove()),e.fn?e.fn():$(".alertDialog").modal("hide")},$(".alertDialog").modal({backdrop:"static",keyboard:!1})}function p(e){e.vm.dialogConfirmTitle=e.title,e.vm.dialogConfirmMessage=e.msg,$(".confirmDialog").modal({backdrop:"static"}),e.vm.dialogConfirmSubmit=e.fn,e.cancel?e.vm.dialogConfirmCancel=e.cancel:e.vm.dialogConfirmCancel=function(){$(".confirmDialog").modal("hide")}}function h(e,t){null==t&&(t=""),e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var o=new RegExp("[\\?&]"+e+"=([^&#]*)"),i=o.exec(window.location.href);return null==i?t:i[1]}function g(e,t){return new kendo.data.DataSource({type:"odata",transport:v().transport(e,t),schema:v().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}})}function v(){return{filterable:{extra:!1,operators:{string:{contains:"包含",eq:"等于"},number:{eq:"等于",neq:"不等于",gt:"大于",lt:"小于"},date:{gt:"大于",lt:"小于"}}},pageable:{pageSize:10,previousNext:!0,buttonCount:5,refresh:!0,pageSizes:!0},schema:function(e){return{data:"value",total:function(e){return e.count},model:e}},transport:function(e,t,o){return{read:{url:e,dataType:"json",type:"post",beforeSend:function(e){e.setRequestHeader("Token",A.getToken())},data:function(){if(t){var e=common.buildOdataFilter(t);return e?o&&o.filter?{$filter:e+" and "+o.filter}:{$filter:e}:o&&o.filter?{$filter:o.filter}:{}}return{}}}}},noRecordMessage:{template:"暂时没有数据."}}}function w(e){var t=$(e).find("tr td:nth-child(1)").find("input:checked"),o=[];return t.each(function(){var e=$(this).attr("relId");o.push({name:"id",value:e})}),o}function S(e){e.headers={Token:A.getToken()},e.$http(e.httpOptions).then(e.success,function(t){e.onError&&e.onError(t),common.requestError({vm:e.vm,response:t})})}function k(){return{get:function(e,t){var o=this.getAll(e);return o?o[t]:null},getAll:function(e){var t=encodeURIComponent(e)+"=",o=document.cookie.indexOf(t),i=null,n={};if(o>-1){var a=document.cookie.indexOf(";",o);if(-1==a&&(a=document.cookie.length),i=document.cookie.substring(o+t.length,a),i.length>0){for(var r=i.split("&"),s=0,c=r.length;s<c;s++){var l=r[s].split("=");n[decodeURIComponent(l[0])]=decodeURIComponent(l[1])}return n}}return null},set:function(e,t,o,i,n,a,r){var s=this.getAll(e)||{};s[t]=o,this.setAll(e,s,i,n,a,r)},setAll:function(e,t,o,i,n,a){var r=encodeURIComponent(e)+"=",s=new Array;for(var c in t)c.length>0&&t.hasOwnProperty(c)&&s.push(encodeURIComponent(c)+"="+encodeURIComponent(t[c]));s.length>0?(r+=s.join("&"),o instanceof Date&&(r+=";expires="+o.toGMTString()),i&&(r+=";path="+i),n&&(r+=";domain="+n),a&&(r+=";secure")):r+=";expires="+new Date(0).toGMTString(),document.cookie=r},unset:function(e,t,o,i,n){var a=this.getAll(e);a&&(delete a[t],this.setAll(e,a,null,o,i,n))},unsetAll:function(e,t,o,i){this.setAll(e,null,new Date(0),t,o,i)}}}function b(){var e=k().getAll("data");return null!=e?e.token:""}function D(e){return e.error=function(e){401==e.status&&(location.href=A.loginUrl)},e}function x(e){var t=/^(?:checkbox|radio)$/i,o=/^(?:submit|button|image|reset|file)$/i,i=/^(?:input|select|textarea|keygen)/i;return $(e).map(function(){var e=jQuery.prop(this,"elements");return e?jQuery.makeArray(e):this}).filter(function(){var e=this.type;return this.value&&this.name&&!$(this).is(":disabled")&&i.test(this.nodeName)&&!o.test(e)&&(this.checked||!t.test(e))}).map(function(e,t){var o=$(this),i=o.val();if(!i)return!1;i="'"+i+"'";var n=o.attr("operator")||"eq",a=o.attr("data-role")||"";return"datepicker"==a?i="date"+i:"datetimepicker"==a&&(i="datetime"+i),"like"==n?"substringof("+i+", "+t.name+")":t.name+" "+n+" "+i}).get().join(" and ")}function y(e){e.$http({method:"get",url:rootPath+"/dict/dictItems"}).then(function(t){e.scope.dictMetaData=t.data;var o={};P(o,t.data),e.scope.DICT=o},function(e){alert("初始化数据字典失败")})}function P(e,t,o){if(t&&0!=t.length)if(o)for(var i=0;i<t.length;i++){var n=t[i];if(n.parentId&&n.parentId==o){e.dicts||(e.dicts=new Array);var a={};a.dictId=n.dictId,a.dictName=n.dictName,a.dictCode=n.dictCode,a.dictKey=n.dictKey,a.dictSort=n.dictSort,e.dicts.push(a),P(a,t,n.dictId)}}else for(var i=0;i<t.length;i++){var n=t[i];n.parentId||(e[n.dictCode]={},e[n.dictCode].dictId=n.dictId,e[n.dictCode].dictCode=n.dictCode,e[n.dictCode].dictName=n.dictName,e[n.dictCode].dictKey=n.dictKey,e[n.dictCode].dictSort=n.dictSort,P(e[n.dictCode],t,n.dictId))}}function I(e){return{async:{saveUrl:rootPath+"/file",removeUrl:rootPath+"/file/delete",autoUpload:!1},select:function(t){e.onSelect?e.onSelect(t):$.each(t.files,function(e,t){console.log("Name: "+t.name+"Size: "+t.size+" bytesExtension: "+t.extension)})},upload:function(t){if(e.onUpload)e.onUpload(t);else{t.files;console.log(t.response)}},success:function(t){if(e.onSuccess)e.onSuccess(t);else{var o=t.files;"upload"==t.operation&&(o[0].sysFileId=t.response.sysFileId)}},remove:function(t){if(e.onRemove)e.onRemove(t);else{var o=t.files;t.data={sysFileId:o[0].sysFileId}}}}}function C(e){e.$http({method:"get",url:rootPath+"/flow/html/tasksCount"}).then(function(e){$("#GtasksCount").html(e.data)})}function O(e,t,o){e.ideaContent="",e.$http=t,e.i=1,$("#ideaWindow").kendoWindow({width:"50%",height:"80%",title:"意见选择",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open(),e.$http({method:"get",url:rootPath+"/idea"}).then(function(t){e.commonIdeas=t.data,e.deleteCommonIdea=function(){U(e)},e.addCorrentIdea=function(t){E(e,t)},e.addCommonIdea=function(){R(e)},e.saveCommonIdea=function(){T(e)},e.saveCurrentIdea=function(){M(e,o)}})}function U(e){var t=$("#commonIdeaTable input[name='ideaCheck']:checked");if(t.length<1)alert("请选择要删除的意见！");else{for(var o=[],i=0;i<t.length;i++)e.commonIdeas.forEach(function(n,a){t[i].value!=n.ideaID&&void 0!=n.ideaID||e.commonIdeas.splice(a,1),o.push(t[i].value)});var n=o.join(",");e.$http({method:"delete",url:rootPath+"/idea",params:{ideas:n}})}}function E(e,t){e.ideaContent=e.ideaContent+t}function R(e){e.commonIdea={},e.commonIdea.ideaType="个人常用意见",e.commonIdeas.push(e.commonIdea),e.i++}function T(e){e.$http({method:"post",url:rootPath+"/idea",headers:{contentType:"application/json;charset=utf-8"},dataType:"json",data:angular.toJson(e.commonIdeas)}).then(function(e){alert("保存成功！")})}function M(e,t){var o=$("#"+t.targetId);o.val(o.val()+e.ideaContent),window.parent.$("#ideaWindow").data("kendoWindow").close()}var A={initJqValidation:r,requestError:s,requestSuccess:c,format:l,blockNonNumber:d,floatNumberInput:m,adminContentHeight:u,alert:f,confirm:p,getQuerystring:h,kendoGridConfig:v,getKendoCheckId:w,cookie:k,getToken:b,appPath:"",http:S,gridDataSource:D,loginUrl:window.rootPath+"/home/login",buildOdataFilter:x,initDictData:y,kendoGridDataSource:g,initUploadOption:I,getTaskCount:C,initIdeaData:O,deleteCommonIdea:U,addCommonIdea:R,saveCommonIdea:T,addCorrentIdea:E,saveCurrentIdea:M,initcommonUploadWin:o,initcommonQueryWin:a,initUpload:i,commonDelSysFile:t,commonSysFilelist:n,commonDownloadFile:e};window.common=A,function(){$(document).on("click","#checkboxAll",function(){var e=$(this).is(":checked");$(".grid").find("tr td:nth-child(1)").find("input:checkbox").prop("checked",e)}),$("body").on("click",".grid tr",function(e){$(this).parent().find("tr").removeClass("selected"),$(this).addClass("selected")})}()}(),function(){"use strict";function e(e,t){var o=this;o.title="单位列表",o.del=function(e){common.confirm({vm:o,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deletecompany(o,e)}})},o.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:o,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var n=t.join(",");o.del(n)}},o.queryConpany=function(){t.queryConpany(o)},function(){t.grid(o)}()}angular.module("app").controller("companyCtrl",e),e.$inject=["$location","companySvc"]}(),function(){"use strict";function e(e,t,o){var i=this;i.title="新增单位",i.iscompanyExist=!1,i.id=o.params.id,i.id&&(i.isUpdate=!0,i.title="更新单位"),i.create=function(){t.createcompany(i)},i.update=function(){t.updatecompany(i)},function(){i.isUpdate&&t.getcompanyById(i)}()}angular.module("app").controller("companyEditCtrl",e),e.$inject=["$location","companySvc","$state"]}(),function(){"use strict";function e(e,t){function o(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(c+"/fingByOData",$("#form")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=function(){var e=this.items(),t=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*o,i=$(this).find(".row-number");$(i).html(e)})},i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:70,filterable:!1,template:"<span class='row-number'></span>"},{field:"coName",title:"单位名称",width:260,filterable:!1},{field:"coPhone",title:"单位电话",width:160,filterable:!1},{field:"coPC",title:"邮编",width:160,filterable:!1},{field:"coAddress",title:"地址",width:160,filterable:!1},{field:"coSite",title:"网站",width:160,filterable:!1},{field:"coSynopsis",title:"单位简介",width:160,filterable:!1},{field:"coType",title:"单位类型",width:160,filterable:!1},{field:"",title:"操作",width:200,template:function(e){return common.format($("#columnBtns").html(),"vm.del('"+e.id+"')",e.id)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:o,resizable:!0}}function i(e){e.gridOptions.dataSource.read()}function n(t){if(common.initJqValidation(),$("form").valid()&&0==t.iscompanyExist){t.isSubmit=!0;var o={method:"post",url:c,data:t.model},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=l}})}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}}function a(t){var o={method:"get",url:c+"/html/findByIdCompany",params:{id:t.id}},i=function(e){t.model=e.data,console.log(t.model)};common.http({vm:t,$http:e,httpOptions:o,success:i})}function r(t){if(common.initJqValidation(),$("form").valid()&&0==t.iscompanyExist){t.isSubmit=!0,t.model.id=t.id;var o={method:"put",url:c,data:t.model},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}}function s(t,o){t.isSubmit=!0;var i={method:"delete",url:c,data:o},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})};common.http({vm:t,$http:e,httpOptions:i,success:n})}var c=rootPath+"/company",l="#/company";rootPath;return{grid:o,createcompany:n,getcompanyById:a,updatecompany:r,deletecompany:s,queryConpany:i}}angular.module("app").factory("companySvc",e),e.$inject=["$http","$compile"]}(),function(){"use strict";function e(e,t){function o(){$("#files").kendoUpload({async:{saveUrl:rootPath+"/demo/save",removeUrl:rootPath+"/demo/remove",autoUpload:!0}})}var i=this;i.title="",i.showDialog=function(){$(".myDialog").modal({backdrop:"static",keyboard:!1})},function(){o()}()}angular.module("app").controller("demoCtrl",e),e.$inject=["$location","demoSvc"]}(),function(){"use strict";function e(e){function t(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0;var i={method:"put",url:o,data:t.model.password},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:t,$http:e,httpOptions:i,success:n})}}var o="/account/password";return{upload:t}}angular.module("app").factory("demoSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t){var o=this;o.title="处室管理",o.del=function(e){common.confirm({vm:o,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteDept(o,e)}})},o.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:o,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var n=t.join(",");o.del(n)}},o.queryDept=function(){t.queryDept(o)},function(){t.grid(o)}()}angular.module("app").controller("deptCtrl",e),e.$inject=["$location","deptSvc"]}(),function(){"use strict";function e(e,t,o){var i=this;i.title="编辑处室",i.isuserExist=!1,i.deptId=o.params.deptId,i.deptId&&(i.isUpdate=!0,i.title="更新处室"),i.create=function(){t.createDept(i)},i.update=function(){t.updateDept(i)},function(){i.isUpdate&&t.getDeptById(i)}()}angular.module("app").controller("deptEditCtrl",e),e.$inject=["$location","deptSvc","$state"]}(),function(){"use strict";function e(e){function t(e){e.gridOptions.dataSource.read()}function o(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0;var o={method:"put",url:s,data:t.model},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1}})}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}}function i(t,o){t.isSubmit=!0;var i={method:"delete",url:s,data:o},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})}})};common.http({vm:t,$http:e,httpOptions:i,success:n})}function n(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0;var o={method:"post",url:s,data:t.model},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,location.href=c}})}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}}function a(t){var o={method:"get",url:rootPath+"/dept/html/findById",params:{deptId:t.deptId}},i=function(e){e.data.offices&&(t.offices={},t.offiecs=e.data.offices),t.model=e.data};common.http({vm:t,$http:e,httpOptions:o,success:i})}function r(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(s+"/fingByOData",$("#formDept")),schema:common.kendoGridConfig().schema({id:"deptId",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=function(){var e=this.items(),t=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*o,i=$(this).find(".row-number");$(i).html(e)})},i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.deptId)},filterable:!1,width:20,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:30,filterable:!1,template:"<span class='row-number'></span>"},{field:"deptName",title:"处室名称",width:100,filterable:!1},{field:"deptUserName",title:"联系人",width:100,filterable:!1},{field:"address",title:"地址",width:100,filterable:!1},{field:"deptType",title:"类型",width:100,filterable:!1},{field:"",title:"状态",width:100,filterable:!1,template:function(e){return e.status?5==e.status?"正常":7==e.status?"已删除":void 0:" "}},{field:"",title:"操作",width:140,template:function(e){return common.format($("#columnBtns").html(),"vm.del('"+e.deptId+"')",e.deptId,e.deptId)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:o,resizable:!0}}var s=rootPath+"/dept",c="#/listDept";return{grid:r,getDeptById:a,createDept:n,deleteDept:i,updateDept:o,queryDept:t}}angular.module("app").factory("deptSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,o,i){var n=this;n.title="办事处人员列表",n.id=t.params.deptId,n.showAddUserDialog=function(){$(".addUser").modal({backdrop:"static",keyboard:!1}),n.deptOfficeGrid.dataSource.read()},n.closeAddUserDialog=function(){$(".addUser").modal("hide")},n.addOfficeUser=function(e){i.addOfficeUser(n,e)},n.remove=function(e){common.confirm({vm:n,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),i.deletedeptOfficeUser(n,e)}})},n.removes=function(){var e=common.getKendoCheckId(".deptOfficeGrid");if(0==e.length)common.alert({vm:n,msg:"请选择数据"});else{for(var t=[],o=0;o<e.length;o++)t.push(e[o].value);var i=t.join(",");n.remove(i)}},function(){i.grid(n),i.deptOfficeGrid(n)}()}angular.module("app").controller("deptOfficeUserCtrl",e),e.$inject=["$location","$state","deptSvc","deptOfficeUserSvc"]}(),function(){"use strict";function e(e){function t(t,o){var i={method:"post",url:rootPath+"/dept/addOfficeUser",params:{deptId:t.id,officeId:o}},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.deptOfficeGrid.dataSource.read(),t.gridOptions.dataSource.read()}})};common.http({vm:t,$http:e,httpOptions:i,success:n})}function o(t){var o={method:"get",url:common.format(l+"/getDepts")},i=function(e){t.depts={},t.depts=e.data};common.http({vm:t,$http:e,httpOptions:o,success:i})}function i(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0,t.model.id=t.id;var o={method:"put",url:l,data:t.model},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}}function n(t,o){t.isSubmit=!0;var i={method:"delete",url:rootPath+"/dept/deleteOfficeUsers",params:{deptId:t.id,officeId:o}},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})}})};common.http({vm:t,$http:e,httpOptions:i,success:n})}function a(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0;var o={method:"post",url:l,data:t.model},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,location.href=d}})}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}}function r(t){var o={method:"get",url:rootPath+"/dept/html/findById",params:{officeID:t.officeID}},i=function(e){e.data.dept&&(t.depts={}),t.model=e.data};common.http({vm:t,$http:e,httpOptions:o,success:i})}function s(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(u+"?deptId="+e.id),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.officeID)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"officeUserName",title:"办事处联系人",width:100,filterable:!1},{field:"officePhone",title:"电话",width:100,filterable:!1},{field:"officeDesc",title:"描述",width:100,filterable:!1},{field:"",title:"操作",width:140,template:function(e){return common.format($("#allUserGridBtns").html(),"vm.addOfficeUser('"+e.officeID+"')",e.officeID)}}];e.deptOfficeGrid={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,resizable:!0}}function c(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(m+"?deptId="+e.id),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.officeID)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"officeUserName",title:"办事处联系人",width:100,filterable:!1},{field:"officePhone",title:"电话",width:100,filterable:!1},{field:"officeDesc",title:"描述",width:100,filterable:!1},{field:"",title:"操作",width:140,template:function(e){return common.format($("#columnBtns").html(),"vm.remove('"+e.officeID+"')",e.officeID)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,resizable:!0}}var l=rootPath+"/dept",d="#/deptList",m=rootPath+"/dept/getDeptOfficeUsers",u=rootPath+"/dept/NotInoDeptfficeUsers";return{grid:c,getdeptById:r,createdept:a,deletedeptOfficeUser:n,updatedept:i,getDepts:o,deptOfficeGrid:s,addOfficeUser:t}}angular.module("app").factory("deptOfficeUserSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,o){var i=this;i.title="字典",i.model={},i.del=function(e){common.confirm({vm:i,title:"",msg:"删除字典将会连下级字典一起删除，确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteDict(i,e)}})},i.dels=function(){var e=i.dictsTree.getSelectedNodes();e&&e.length>0?i.del(e[0].id):common.alert({vm:i,msg:"请选择数据"})},function(){t.initDictTree(i)}()}angular.module("app").controller("dictCtrl",e),e.$inject=["$location","dictSvc","$scope"]}(),function(){"use strict";function e(e,t,o,i){var n=this;n.title="增加字典",n.model={},n.id=i.params.id,n.id&&(n.isUpdate=!0,n.title="编辑字典"),n.model.dictSort=0,n.createDict=function(){o.createDict(n)},n.updateDict=function(){o.updateDict(n)},n.dictTypeChange=function(){n.model.dictType&&(n.model.dictKey="")},n.apply=function(){e.$apply()},function(){n.isUpdate?o.getDictById(n):(n.model.dictCode="",o.initpZtreeClient(n))}()}angular.module("app").controller("dictEditCtrl",e),e.$inject=["$scope","$location","dictSvc","$state"]}(),function(){"use strict";function e(e,t,o){function i(t){var o={method:"get",url:common.format(f+"?dictCode={0}","DICT_SEX")},i=function(e){};common.http({vm:t,$http:e,httpOptions:o,success:i})}function n(t){var o={method:"get",url:u},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){if(t.treeData={},t.treeData=e.data.value,t.isUpdate&&t.treeData&&t.model.parentId)for(var o=0;o<t.treeData.length;o++)if(t.treeData[o].dictId==t.model.parentId){t.model.parentDictName=t.treeData[o].dictName;break}}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}function a(o,i){o.isSubmit=!0;var n={method:"delete",url:u,data:i},a=function(e){common.requestSuccess({vm:o,response:e,fn:function(){o.isSubmit=!1,location.href=m,common.alert({vm:o,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),t.go("dict",{},{reload:!0})}})}})};common.http({vm:o,$http:e,httpOptions:n,success:a})}function r(o){common.initJqValidation();var i=$("form").valid(),n=o.zpTree.getCheckedNodes(!0);if(n&&n.length>0&&(o.model.parentId=n[0].id),i){o.isSubmit=!0;var a={method:"post",url:u,data:o.model},r=function(e){common.requestSuccess({vm:o,response:e,fn:function(){common.alert({vm:o,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),t.go("dict",{},{reload:!0})}})}})};common.http({vm:o,$http:e,httpOptions:a,success:r})}}function s(o){if(common.initJqValidation(),$("form").valid()){o.isSubmit=!0;var i={method:"put",url:u,data:o.model},n=function(e){common.requestSuccess({vm:o,response:e,fn:function(){common.alert({vm:o,msg:"操作成功",fn:function(){o.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),t.go("dict.edit",{id:o.model.dictId},{reload:!0})}})}})};common.http({vm:o,$http:e,httpOptions:i,success:n})}}function c(o){var i={method:"get",url:u+"?$orderby=dictSort"},n=function(e){common.requestSuccess({vm:o,response:e,fn:function(){function i(e,o,i){t.go("dict.edit",{id:i.id})}var n,a={callback:{onClick:i},data:{simpleData:{enable:!0,idKey:"id",pIdKey:"pId"}}},r=$linq(e.data.value).select(function(e){var t=null;return e.parentId&&(t=e.parentId),{id:e.dictId,name:e.dictName,pId:t}}).toArray();n=$.fn.zTree.init($("#zTree"),a,r),o.dictsTree=n}})};common.http({vm:o,$http:e,httpOptions:i,success:n})}function l(t){var o={method:"get",url:u+"?$orderby=dictSort"},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){var o={check:{enable:!0,chkStyle:"radio",radioType:"all"},callback:{},data:{simpleData:{enable:!0,idKey:"id",pIdKey:"pId"}}},i=$linq(e.data.value).select(function(e){var t;return e.parentId&&(t=e.parentId),{id:e.dictId,name:e.dictName,pId:t}}).toArray();t.zpTree=$.fn.zTree.init($("#pzTree"),o,i)}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}function d(t){var o={method:"get",url:common.format(u+"?$filter=dictId eq '{0}'",t.id)},i=function(e){t.model=e.data.value[0],n(t)};common.http({vm:t,$http:e,httpOptions:o,success:i})}var m="#/dict",u=rootPath+"/dict",f=rootPath+"/dict/dictNameData";return{initDictTree:c,createDict:r,getDictById:d,updateDict:s,deleteDict:a,initpZtreeClient:l,getTreeData:n,getdictItems:i}}angular.module("app").factory("dictSvc",e),e.$inject=["$http","$state","$location"]}(),function(){"dispatch strict";function e(e,t,o){var i=this;i.title="项目发文编辑",i.isHide=!0,i.isHide2=!0,i.saveProcess=!1,i.showFileNum=!1,i.mwindowHide=!0,i.showCreate=!1,i.linkSignId="",i.sign={},i.dispatchDoc={},i.dispatchDoc.signId=o.params.signid,i.create=function(){t.saveDispatch(i)},i.count=function(){var e=i.dispatchDoc.declareValue,t=i.dispatchDoc.authorizeValue;if(e&&t){var o=e-t,n=(o/e*100).toFixed(2);i.dispatchDoc.extraRate=n,i.dispatchDoc.extraValue=o}},i.dispatchUpload=function(){$("#dispatchUploadWin").kendoWindow({width:"800px",height:"400px",title:"上传附件列表",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},i.dispatchQuery=function(){$("#dispatchqueryWin").kendoWindow({width:"800px",height:"400px",title:"查看附件列表",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},i.delDisptSysFile=function(e){t.delDisptSysFile(i,e)},i.relateHandle=function(){"是"!=i.dispatchDoc.isRelated||i.linkSignId?"否"==i.dispatchDoc.isRelated&&i.linkSignId?(t.deletemerge(i),i.isnotEdit=!1):i.isnotEdit=!1:(common.alert({vm:i,msg:"请关联它信息！",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}}),i.isnotEdit=!0)},i.sigleProject=function(){"1"==i.dispatchDoc.dispatchWay&&i.dispatchDoc.id&&i.linkSignId&&common.confirm({title:"删除提示",vm:i,msg:"你确定删除关联信息?",fn:function(){$(".confirmDialog").modal("hide"),t.deletemerge(i),i.dispatchDoc.isRelated="否"}})},i.isrelated=function(){i.dispatchDoc.isRelated="是"},i.isrelated2=function(){i.dispatchDoc.isRelated="否",i.dispatchDoc.id&&i.linkSignId&&common.confirm({title:"删除提示",vm:i,msg:"你确定删除关联信息?",fn:function(){$(".confirmDialog").modal("hide"),t.deletemerge(i)}})},i.gotoMergePage=function(){t.gotoMergePage(i)},i.search=function(){t.getSign(i)},i.chooseProject=function(){t.chooseProject(i)},i.cancelProject=function(){t.cancelProject(i)},i.onClose=function(){window.parent.$("#mwindow").data("kendoWindow").close()},i.mergeDispa=function(){t.mergeDispa(i)},i.formReset=function(){$("#searchform").find("input,select").val("")},i.search=function(){t.getsign(i)},i.fileNum=function(){t.fileNum(i)},function(){t.initDispatchData(i)}()}angular.module("app").controller("dispatchEditCtrl",e),e.$inject=["$location","dispatchSvc","$state"]}(),function(){"dispatch strict";function e(e,t){function o(e,o){var i={method:"delete",url:rootPath+"/file/deleteSysFile",data:o},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){window.parent.$("#dispatchqueryWin").data("kendoWindow").close(),common.alert({vm:e,msg:"删除成功",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}})}})};common.http({vm:e,$http:t,httpOptions:i,success:n})}function i(e){var t=e.dispatchDoc.signId,o={language:"zh",allowedPreviewTypes:["image"],allowedFileExtensions:["jpg","png","gif","xlsx","docx","pdf"],maxFileSize:2e3,showRemove:!1,uploadUrl:rootPath+"/file/fileUpload",uploadExtraData:{businessId:t}};$("#dispatchphotofile").fileinput(o).on("filebatchselected",function(e,t){}).on("fileuploaded",function(e,o){$("#dispatchPhotoSrc").removeAttr("src"),$("#dispatchPhotoSrc").attr("src",rootPath+"/sign/transportImg?signid="+t+"&t="+Math.random())})}function n(e){if(e.isSubmit=!0,!e.dispatchDoc.id)return void common.alert({vm:e,msg:"请先保存再生成文件字号",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}});var o={method:"post",url:rootPath+"/dispatch/fileNum",params:{dispaId:e.dispatchDoc.id}},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.showFileNum=!1,e.isSubmit=!1,e.dispatchDoc.fileNum=t.data,common.alert({vm:e,msg:"操作成功"})}})};common.http({vm:e,$http:t,httpOptions:o,success:i,onError:function(t){e.isSubmit=!1}})}function a(e){if(e.dispatchDoc.id){e.mwindowHide=!1;$("#mwindow").kendoWindow({width:"1200px",height:"630px",title:"合并发文",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open(),m(e),f(e)}else common.alert({vm:e,msg:"请先保存再进行关联！",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}})}function r(e){e.isEdit=!1,e.dispatchDoc.id&&h(e);var o={method:"get",url:rootPath+"/dispatch/initData",params:{signid:e.dispatchDoc.signId}},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){var o=t.data;e.sign=o.sign,e.dispatchDoc=o.dispatch,e.associateDispatchs=o.associateDispatchs,e.proofread=o.mainUserList,e.org=o.orgList,e.showCreate=!0,e.linkSignId=t.data.linkSignId,e.mergeDispaId=t.data.businessId,e.dispatchDoc.id&&!e.dispatchDoc.fileNum&&(e.showFileNum=!0),e.sysfilelist=t.data.sysfilelist,i(e),$("#dispatchPhotoSrc").attr("src",rootPath+"/sign/transportImg?signId="+e.dispatchDoc.signId+"&t="+Math.random())}})};common.http({vm:e,$http:t,httpOptions:o,success:n})}function s(e){if(!e.linkSignId&&e.mergeDispaId)p(e),e.dispatchDoc.isRelated="否",window.parent.$("#mwindow").data("kendoWindow").close(),common.alert({vm:e,msg:"操作成功！",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}}),e.isnotEdit=!1;else if(e.linkSignId||e.mergeDispaId){e.isnotEdit=!1,e.dispatchDoc.isRelated="是";var o={method:"get",url:rootPath+"/dispatch/mergeDispa",params:{
signId:e.dispatchDoc.signId,linkSignId:e.linkSignId}},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){window.parent.$("#mwindow").data("kendoWindow").close(),common.alert({vm:e,msg:"操作成功！",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}})}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}else e.dispatchDoc.isRelated="否",e.isnotEdit=!1,window.parent.$("#mwindow").data("kendoWindow").close()}function c(e){if("9"==e.dispatchDoc.isMainProject&&e.dispatchDoc.id&&!e.linkSignId)return void common.alert({vm:e,msg:"请关联其它项目",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}});var o={method:"post",url:rootPath+"/dispatch",data:e.dispatchDoc},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功！",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),r(e)}})}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}function l(e){var t=e.linkSignId,o=$("input[name='checksign']:checked"),i=[];0!=o.length&&($.each(o,function(e,t){i.push(t.value)}),t?t+=","+i.join(","):t=i.join(","),e.linkSignId=t,u(e),f(e))}function d(e){var t=e.linkSignId,o=$("input[name='checkss']:checked");0!=o.lenght&&($.each(o,function(e,o){t=0==t.lastIndexOf(o.value)?t.replace(o.value,""):t.replace(","+o.value,"")}),e.linkSignId=t,u(e),f(e))}function m(e){var o={method:"get",url:rootPath+"/dispatch/getSignByDId",params:{bussnessId:e.dispatchDoc.id}},i=function(t){e.selectedSign=t.data.signDtoList,console.log(e.selectedSign),e.linkSignId=t.data.linkSignId,console.log(e.linkSignId)};common.http({vm:e,$http:t,httpOptions:o,success:i})}function u(e){var o={method:"get",url:rootPath+"/dispatch/getSelectedSign",params:{linkSignIds:e.linkSignId}},i=function(t){e.selectedSign=t.data};common.http({vm:e,$http:t,httpOptions:o,success:i})}function f(e){e.sign.signid=e.linkSignId;var o={method:"post",url:rootPath+"/dispatch/getSign",data:e.sign},i=function(t){e.signs=t.data,console.log(e.signs)};common.http({vm:e,$http:t,httpOptions:o,success:i,onError:function(e){}})}function p(e){var o={method:"post",url:rootPath+"/dispatch/deleteMerge",params:{dispatchId:e.dispatchDoc.id}},i=function(t){e.linkSignId=""};common.http({vm:e,$http:t,httpOptions:o,success:i,onError:function(e){}})}function h(e){var o={method:"get",url:rootPath+"/dispatch/getRelatedFileNum",params:{dispatchId:e.dispatchDoc.id}},i=function(t){e.dispatchDoc.fileNum=t.data};common.http({vm:e,$http:t,httpOptions:o,success:i,onError:function(e){}})}return{initDispatchData:r,saveDispatch:c,gotoMergePage:a,chooseProject:l,getsign:f,cancelProject:d,mergeDispa:s,fileNum:n,getselectedSign:u,getSeleSignBysId:m,deletemerge:p,getRelatedFileNum:h,initDisptUpload:i,delDisptSysFile:o}}angular.module("app").factory("dispatchSvc",e),e.$inject=["$rootScope","$http"]}(),function(){"use strict";function e(e){function t(t){if(common.initJqValidation($("#expert_offer_form")),$("#expert_offer_form").valid()){t.expertOffer.expertId=t.model.expertID;var o={method:"post",url:rootPath+"/expertOffer",data:t.expertOffer},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功"})}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}}return{saveOffer:t}}angular.module("app").factory("expertOfferSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t){var o=this;o.searchAudit=function(){t.searchAudit(o)},o.auditToOfficial=function(){t.auditTo(o,2)},o.auditToAlternative=function(){t.auditTo(o,3)},o.auditToStop=function(){t.auditTo(o,4)},o.auditToRemove=function(){t.auditTo(o,5)},o.officialToAudit=function(){t.toAudit(o,2)},o.alternativeToAudit=function(){t.toAudit(o,3)},o.stopToAudit=function(){t.toAudit(o,4)},o.temoveToAudit=function(){t.toAudit(o,5)},function(){t.auditGrid(o)}()}angular.module("app").controller("expertAuditCtrl",e),e.$inject=["$location","expertSvc"]}(),function(){"expert strict";function e(e,t){var o=this;o.data={},o.title="专家列表",function(){t.grid(o)}(),o.search=function(){t.searchMuti(o)},o.searchAudit=function(){t.searchMAudit(o)},o.del=function(e){common.confirm({vm:o,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteExpert(o,e)}})},o.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:o,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var n=t.join(",");o.del(n)}}}angular.module("app").controller("expertCtrl",e),e.$inject=["$location","expertSvc"]}(),function(){"expert strict";function e(e,t,o,i,n,a){var r=this;r.model={},r.title="专家信息录入",r.isuserExist=!1,r.isHide=!0,r.isUpdate=!1,r.expertID=a.params.expertID,r.expertOfferList={},r.expertOffer={},function(){r.expertID&&(r.title="更新专家",r.isHide=!1,r.isUpdate=!0,i.getExpertById(r))}(),r.showUploadWin=function(){r.model.expertID?$("#uploadWin").kendoWindow({width:"660px",height:"360px",title:"上传头像",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open():common.alert({vm:r,msg:"先保存数据在执行操作！"})},r.model={},r.model.expertType="",r.expertTypes=[],r.expertTypeList=[],r.choole=function(e,t){if(r.expertType={},r.expertType.expertType="",r.expertType.maJorBig="",r.expertType.maJorSmall="",r.index=t,r.expertTypes[t])r.expertTypeList.splice(t,1);else{var o=$("#expertType input[name='typeCheck']");r.expertType.expertType=o[t].value,$("#jor").kendoWindow({width:"660px",height:"360px",title:e+"的突出专业",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()}},r.saveChooleMajor=function(e){r.expertType.maJorBig=r.type.maJorBig,r.expertType.maJorSmall=r.type.maJorBig,r.expertTypeList[e]=r.expertType,window.parent.$("#jor").data("kendoWindow").close()},r.create=function(){console.log(r.expertTypeList),r.model.expertTypeDtoList=r.expertTypeList,console.log(r.model),i.createExpert(r)},r.update=function(){i.updateExpert(r)},r.gotoWPage=function(){r.createWork=!0,o.gotoWPage(r)},r.updateWorkPage=function(){r.createWork=!1,o.updateWorkPage(r)},r.createWork=function(){o.createWork(r)},r.updateWork=function(){o.updateWork(r)},r.deleteWork=function(){o.deleteWork(r)},r.onWClose=function(){o.cleanValue(),window.parent.$("#wrwindow").data("kendoWindow").close()},r.onPClose=function(){t.cleanValue(),window.parent.$("#pjwindow").data("kendoWindow").close()},r.gotoJPage=function(){t.gotoJPage(r)},r.updateProject=function(){t.updateProject(r)},r.createProject=function(){r.createProject=!0,t.createProject(r)},r.updateProjectPage=function(){r.createProject=!1,t.updateProjectPage(r)},r.delertProject=function(){t.delertProject(r)},r.gotoOfferPage=function(){$("#ep_offer_div").kendoWindow({width:"800px",height:"600px",title:"专家聘书",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},r.saveOffer=function(){r.model.expertID?n.saveOffer(r):common.alert({vm:r,msg:"先保存专家信息！"})},r.closeOffer=function(){window.parent.$("#ep_offer_div").data("kendoWindow").close()},r.showOffer=function(e){r.expertOffer={},r.expertOfferList.forEach(function(t,o){if(t.id==e)return void(r.expertOffer=t)}),r.gotoOfferPage()}}angular.module("app").controller("expertEditCtrl",e),e.$inject=["$location","projectExpeSvc","workExpeSvc","expertSvc","expertOfferSvc","$state"]}(),function(){"use strict";function e(e,t){var o=this;!function(){t.repeatGrid(o)}()}angular.module("app").controller("expertRepeatCtrl",e),e.$inject=["$location","expertSvc"]}(),function(){"expert strict";function e(e){function t(t){common.initJqValidation();$("form").valid();t.isSubmit=!0,t.model.expertID=t.expertID,t.model.birthDay=$("#birthDay").val(),t.model.createDate=$("#createDate").val();var o={method:"put",url:g,data:t.model},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.isSubmit=!1,common.alert({vm:t,msg:"操作成功"})}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}function o(t,o){t.isSubmit=!0;var i={method:"delete",url:g,data:o},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})};common.http({vm:t,$http:e,httpOptions:i,success:n})}function i(e){e.gridOptions.dataSource.read()}function n(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0,t.model.birthDay=$("#birthDay").val(),t.model.graduateDate=$("#graduateDate").val();var o={method:"post",url:g,data:t.model},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.model.expertID=e.data.expertID,t.isUpdate=!0,t.showBt=!0,t.isSubmit=!1,common.alert({vm:t,msg:"操作成功"})}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}}function a(t){var o={method:"get",url:g+"/findById",params:{id:t.expertID}},i=function(e){t.showBt=!0,t.model=e.data,e.data.workDto&&e.data.workDto.length>0&&(t.showWorkHistory=!0,t.work=e.data.workDto),e.data.projectDto&&e.data.projectDto.length>0&&(t.projectkHistory=!0,t.project=e.data.projectDto),e.data.expertOfferDtoList&&e.data.expertOfferDtoList.length>0&&(t.showExpertOffer=!0,t.expertOfferList=e.data.expertOfferDtoList),h(t),$("#expertPhotoSrc").attr("src",rootPath+"/expert/transportImg?expertId="+t.model.expertID+"&t="+Math.random())};common.http({vm:t,$http:e,httpOptions:o,success:i})}function r(e){var t=common.kendoGridDataSource(rootPath+"/expert/findByOData",$("#searchform")),o=function(){var e=this.items(),t=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*o,i=$(this).find(".row-number");$(i).html(e)})};e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:s(),dataBound:o,resizable:!0}}function s(){return[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.expertID)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,template:"<span class='row-number'></span>"},{field:"name",title:"姓名",width:100,filterable:!0},{field:"sex",title:"性别",width:50,filterable:!0},{field:"degRee",title:"学位",width:100,filterable:!0},{field:"userPhone",title:"手机号码",width:100,filterable:!0},{field:"comPany",title:"工作单位",width:100,filterable:!0},{field:"degRee",title:"职务",width:100,filterable:!0},{field:"idCard",title:"身份证号",width:100,filterable:!0},{field:"maJor",title:"现从事专业",width:100,filterable:!0},{field:"acaDemy",title:"毕业院校",width:100,filterable:!0},{field:"",title:"专家类别",width:100,filterable:!0,template:function(e){if(e.expertTypeDtoList){for(var t="",o=0;o<e.expertTypeDtoList.length;o++)t+=0==o?e.expertTypeDtoList[o].expertType:"、"+e.expertTypeDtoList[o].expertType;return t}return""}},{field:"",title:"操作",width:100,template:function(e){return common.format($("#columnBtns").html(),"vm.del('"+e.expertID+"')",e.expertID)}}]}function c(){return[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.expertID)},filterable:!1,width:25,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"name",title:"姓名",width:100,filterable:!1},{field:"degRee",title:"学位",width:100,filterable:!1},{field:"sex",title:"性别",width:50,filterable:!0},{field:"comPany",title:"工作单位",width:100,filterable:!1},{field:"degRee",title:"职务",width:100,filterable:!1},{field:"",title:"专家类别",width:100,filterable:!1,template:function(e){if(e.expertTypeDtoList){for(var t="",o=0;o<e.expertTypeDtoList.length;o++)t+=0==o?e.expertTypeDtoList[o].expertType:"、"+e.expertTypeDtoList[o].expertType;return t}return""}}]}function l(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findByOData",$("#auditform"),{filter:"state eq '1'"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:25,sort:{field:"createdDate",dir:"desc"}}),o=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findByOData",$("#auditform"),{filter:"state eq '2'"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:5,sort:{field:"createdDate",dir:"desc"}}),i=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findByOData",$("#auditform"),{filter:"state eq '3'"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:5,sort:{field:"createdDate",dir:"desc"}}),n=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findByOData",$("#auditform"),{filter:"state eq '4'"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:5,sort:{field:"createdDate",dir:"desc"}}),a=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findByOData",$("#auditform"),{filter:"state eq '5'"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:5,sort:{field:"createdDate",dir:"desc"}}),r=function(){var e=this.items(),t=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*o,i=$(this).find(".row-number");$(i).html(e)})};e.gridOptions1={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c(),dataBound:r,resizable:!0},e.gridOptions2={dataSource:common.gridDataSource(o),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c(),dataBound:r,resizable:!0},e.gridOptions3={dataSource:common.gridDataSource(i),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c(),dataBound:r,resizable:!0},e.gridOptions4={dataSource:common.gridDataSource(n),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c(),dataBound:r,resizable:!0},e.gridOptions5={dataSource:common.gridDataSource(a),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c(),dataBound:r,resizable:!0}}function d(e){e.gridOptions1.dataSource.read(),e.gridOptions2.dataSource.read(),e.gridOptions3.dataSource.read(),e.gridOptions4.dataSource.read(),e.gridOptions5.dataSource.read()}function m(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findRepeatByOData"),schema:common.kendoGridConfig().schema({id:"id"}),rowNumber:!0,headerCenter:!0}),o=function(){var e=this.items();$(e).each(function(e){$(this).find(".row-number").html(e+1)})};e.repeatGridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:s(),dataBound:o,resizable:!0}}function u(e,t){var o=common.getKendoCheckId("#grid"+t);if(0==o.length)common.alert({vm:e,msg:"请选择数据"});else{for(var i=[],n=0;n<o.length;n++)i.push(o[n].value);p(e,i.join(","),1)}}function f(e,t){var o=common.getKendoCheckId("#grid1");if(0==o.length)common.alert({vm:e,msg:"请选择数据"});else{for(var i=[],n=0;n<o.length;n++)i.push(o[n].value);p(e,i.join(","),t)}}function p(t,o,i){t.isSubmit=!0;var n={method:"post",url:g+"/updateAudit",params:{ids:o,flag:i}},a=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.isSubmit=!1,t.gridOptions1.dataSource.read(),t.gridOptions2.dataSource.read(),t.gridOptions3.dataSource.read(),t.gridOptions4.dataSource.read(),t.gridOptions5.dataSource.read(),common.alert({vm:t,msg:"操作成功"})}})};common.http({vm:t,$http:e,httpOptions:n,success:a})}function h(e){var t={language:"zh",allowedPreviewTypes:["image"],allowedFileExtensions:["jpg","png","gif"],maxFileSize:2e3,showRemove:!1,uploadUrl:rootPath+"/expert/uploadPhoto",uploadExtraData:{expertId:e.model.expertID}};$("#expertphotofile").fileinput(t).on("filebatchselected",function(e,t){}).on("fileuploaded",function(t,o){$("#expertPhotoSrc").removeAttr("src"),$("#expertPhotoSrc").attr("src",rootPath+"/expert/transportImg?expertId="+e.model.expertID+"&t="+Math.random())})}var g=rootPath+"/expert";return{grid:r,auditGrid:l,getExpertById:a,createExpert:n,deleteExpert:o,updateExpert:t,searchMuti:i,searchAudit:d,repeatGrid:m,updateAudit:p,toAudit:u,auditTo:f,initUpload:h}}angular.module("app").factory("expertSvc",e),e.$inject=["$http"]}(),function(){"projectExpe strict";function e(e){function t(t){common.initJqValidation();var o=$("input[name='checkpj']:checked");if(o.length<1)common.alert({vm:t,msg:"请选择操作对象",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}});else{var i="";$.each(o,function(e,t){i+=t.value+","}),t.isSubmit=!0;var a={method:"delete",url:rootPath+"/projectExpe/deleteProject",data:i},r=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.isSubmit=!1,n(t)}})};common.http({vm:t,$http:e,httpOptions:a,success:r})}}function o(t){var o={method:"get",url:common.format(rootPath+"/projectExpe/getProject?$filter=peID eq '{0}'",t.peID)},i=function(e){t.model.projectName=e.data[0].projectName,t.model.projectType=e.data[0].projectType,t.model.projectbeginTime=e.data[0].projectbeginTime,t.model.projectendTime=e.data[0].projectendTime,t.isUpdate};common.http({vm:t,$http:e,httpOptions:o,success:i})}function i(t){if(common.initJqValidation($("#ProjectForm")),$("#ProjectForm").valid()){t.isSubmit=!0,t.model.peID=t.peID,t.model.expertID=t.expertID,t.model.projectbeginTime=$("#projectbeginTime").val(),t.model.projectendTime=$("#projectendTime").val();var o={method:"put",url:rootPath+"/projectExpe/updateProject",data:t.model},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){window.parent.$("#pjwindow").data("kendoWindow").close(),n(t),s(),common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})}}common.http({vm:t,$http:e,httpOptions:o,success:i})}function n(t){var o={method:"GET",url:rootPath+"/projectExpe/getProject?$filter=expert.expertID eq '"+t.model.expertID+"'"},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.project=e.data}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}function a(e){var t=$("input[name='checkpj']:checked");t.length<1?common.alert({vm:e,msg:"请选择操作对象",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}}):t.length>1?common.alert({vm:e,msg:"无法同时操作多条数据",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}}):(e.peID=t.val(),o(e),e.expertID=e.model.expertID,r(e))}function r(e){$("#pjwindow").kendoWindow({width:"690px",height:"330px",title:"添加项目经历",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()}function s(){var e=$("#pjwindow").find("input");$.each(e,function(e,t){t.value=""})}function c(t){if(common.initJqValidation($("#ProjectForm")),$("#ProjectForm").valid()){t.model.projectbeginTime=$("#projectbeginTime").val(),t.model.projectendTime=$("#projectendTime").val();var o={method:"post",url:rootPath+"/projectExpe/projectExpe",data:t.model},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){window.parent.$("#pjwindow").data("kendoWindow").close(),s(),n(t),common.alert({vm:t,msg:"操作成功",fn:function(){t.projectkHistory=!0,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}})}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}}return{getProject:n,createProject:c,updateProject:i,updateProjectPage:a,getProjectById:o,delertProject:t,gotoJPage:r,cleanValue:s}}angular.module("app").factory("projectExpeSvc",e),e.$inject=["$http"]}(),function(){"workExpe strict";function e(e){function t(t){var o={method:"GET",url:rootPath+"/workExpe/getWork?$filter=expert.expertID eq '"+t.model.expertID+"'"},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.work=e.data,console.log(t.work)}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}function o(o){var i=$("input[name='checkwr']:checked");if(i.length<1)common.alert({vm:o,msg:"请选择操作对象",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}});else{var n="";$.each(i,function(e,t){n+=t.value+","}),o.isSubmit=!0;var a={method:"delete",url:rootPath+"/workExpe/deleteWork",data:n},r=function(e){common.requestSuccess({vm:o,response:e,fn:function(){o.isSubmit=!1,t(o)}})};common.http({vm:o,$http:e,httpOptions:a,success:r})}}function i(e){var t=$("input[name='checkwr']:checked");t.length<1?common.alert({vm:e,msg:"请选择操作对象",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}}):t.length>1?common.alert({vm:e,msg:"无法同时操作多条数据",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}}):(e.weID=t.val(),n(e),r(e),e.expertID=e.model.expertID)}function n(t){var o={method:"get",url:common.format(rootPath+"/workExpe/getWork?$filter=weID eq '{0}'",t.weID)},i=function(e){t.model.companyName=e.data[0].companyName,t.model.workJob=e.data[0].workJob,t.model.beginTime=e.data[0].beginTime,t.model.endTime=e.data[0].endTime,console.log(e.data[0])};common.http({vm:t,$http:e,httpOptions:o,success:i})}function a(){var e=$("#wrwindow").find("input");$.each(e,function(e,t){t.value=""})}function r(e){$("#wrwindow").kendoWindow({width:"690px",height:"330px",title:"添加工作经历",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()}function t(t){var o={method:"GET",url:rootPath+"/workExpe/getWork?$filter=expert.expertID eq '"+t.model.expertID+"'"},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.work=e.data}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}function s(o){if(common.initJqValidation($("#workForm")),$("#workForm").valid()){o.model.beginTime=$("#beginTime").val(),o.model.endTime=$("#endTime").val();var i={method:"post",url:rootPath+"/workExpe/workExpe",data:o.model},n=function(e){common.requestSuccess({vm:o,response:e,fn:function(){a(),window.parent.$("#wrwindow").data("kendoWindow").close(),t(o),common.alert({vm:o,msg:"操作成功",fn:function(){o.showWorkHistory=!0,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}})}})};common.http({vm:o,$http:e,httpOptions:i,success:n})}}function c(o){if(common.initJqValidation(),$("form").valid()){o.model.weID=o.weID,o.model.expertID=o.expertID,o.model.beginTime=$("#beginTime").val(),o.model.endTime=$("#endTime").val();var i={method:"put",url:rootPath+"/workExpe/updateWork",data:o.model},n=function(e){common.requestSuccess({vm:o,response:e,fn:function(){window.parent.$("#wrwindow").data("kendoWindow").close(),t(o),a(),common.alert({vm:o,msg:"操作成功",fn:function(){o.showWorkHistory=!0,$(".alertDialog").modal("hide")}})}})};common.http({vm:o,$http:e,httpOptions:i,success:n})}}return{createWork:s,updateWork:c,deleteWork:o,updateWorkPage:i,gotoWPage:r,getWorkById:n,getWork:t,cleanValue:a}}angular.module("app").factory("workExpeSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t){var o=this;o.title="专家列表",o.del=function(e){common.confirm({vm:o,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteExpertReview(o,e)}})},o.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:o,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var n=t.join(",");o.del(n)}},function(){t.initExpertGrid(o),t.getReviewList(o)}()}angular.module("app").controller("expertReviewCtrl",e),e.$inject=["$location","expertReviewSvc"]}(),function(){"use strict";function e(e,t,o){var i=this;i.title="添加附件",i.isuserExist=!1,i.id=o.params.id,i.id&&(i.isUpdate=!0,i.title="更新附件"),i.create=function(){t.createExpertReview(i)},i.update=function(){t.updateExpertReview(i)},function(){i.isUpdate&&t.getExpertReviewById(i)}()}angular.module("app").controller("expertReviewEditCtrl",e),e.$inject=["$location","expertReviewSvc","$state"]}(),function(){"use strict";function e(e,t,o,i){function n(e){return!!(/^(\+|-)?\d+$/.test(e)&&e>0)}function a(e){if(r.conditions.length>0){var t=!0;return r.conditions.forEach(function(o,i){e&&(angular.isUndefined(o.id)||""==o.id)&&(t=!1),r.expertReview.id&&(o.expertReviewDto={},o.expertReviewDto.id=r.expertReview.id),o.workProgramId=r.expertReview.workProgramId,o.maJorBig=$("#maJorBig"+o.sort).val(),o.maJorSmall=$("#maJorSmall"+o.sort).val(),o.expeRttype=$("#expeRttype"+o.sort).val(),$("#officialNum"+o.sort).val()&&n($("#officialNum"+o.sort).val())?o.officialNum=$("#officialNum"+o.sort).val():($("#errorsOfficialNum"+o.sort).html("必填，且为数字"),t=!1),$("#alternativeNum"+o.sort).val()&&n($("#alternativeNum"+o.sort).val())?o.alternativeNum=$("#alternativeNum"+o.sort).val():($("#errorsAlternativeNum"+o.sort).html("必填，且为数字"),t=!1),t&&($("#errorsOfficialNum"+o.sort).html(""),$("#errorsAlternativeNum"+o.sort).html(""))}),t}return!1}var r=this;r.title="选择专家",r.conditionIndex=1,r.conditions=new Array,r.expertReview={},r.autoSelExperts=new Array,r.autoExpertList={},r.workProgramId=i.params.workProgramId,function(){t.initReview(r),t.initExpertGrid(r)}(),r.showSelfExpertGrid=function(){t.initSelfExpert(r)},r.saveSelfExpert=function(){t.saveSelfExpert(r)},r.delertSelfExpert=function(){var e=$("input[name='seletedEp']:checked");e.length<1?common.alert({vm:r,msg:"请选择操作对象"}):common.confirm({vm:r,title:"温馨提示",msg:"删除数据不可恢复，确定删除么？",fn:function(){$(".confirmDialog").modal("hide");for(var o=[],i=0;i<e.length;i++)o.push(e[i].value);var n=o.join(",");t.delSelectedExpert(r,n)}})},r.showOutExpertGrid=function(){t.showOutExpertGrid(r)},r.delertOutSelfExpert=function(){var e=$("input[name='seletedOutEp']:checked");e.length<1?common.alert({vm:r,msg:"请选择操作对象"}):common.confirm({vm:r,title:"温馨提示",msg:"删除数据不可恢复，确定删除么？",fn:function(){$(".confirmDialog").modal("hide");for(var o=[],i=0;i<e.length;i++)o.push(e[i].value);t.delSelectedExpert(r,o.join(","))}})},r.saveOutExpert=function(){t.saveOutExpert(r)},r.countMatchExperts=function(e){r.expertReview.id?t.countMatchExperts(r,e):common.alert({vm:r,msg:"请保存整体抽取方案再计算"})},r.checkIntegerValue=function(e,t,i){o.isUnsignedInteger(e)?($("#"+t+i).val(e),$("#errorsOfficialNum"+i).html(""),$("#errorsAlternativeNum"+i).html("")):($("#errorsOfficialNum"+i).html("只能填写数字"),$("#errorsAlternativeNum"+i).html("只能填写数字"))},r.addCondition=function(){r.expertReview.isSelete?common.alert({vm:r,msg:"当前项目已经进行整体专家方案的抽取，不能再修改方案！"}):(r.condition={},r.condition.sort=r.conditionIndex,r.expertReview.id&&(r.condition.expertReviewDto={},r.condition.expertReviewDto.id=r.expertReview.id),r.condition.selectType="1",r.conditions.push(r.condition),r.conditionIndex++)},r.removeCondition=function(){if(r.expertReview.isSelete)common.alert({vm:r,msg:"当前项目已经进行整体专家方案的抽取，不能再修改方案！"});else{var e=$("#conditionTable input[name='epConditionSort']:checked");e.length>=1&&common.confirm({vm:r,title:"温馨提示",msg:"删除数据不可恢复，确定删除么？",fn:function(){$(".confirmDialog").modal("hide");for(var t=[],i=0;i<e.length;i++)r.conditions.forEach(function(o,n){e[i].value==o.sort&&(r.conditions.splice(n,1),o.id&&t.push(o.id))});t.length>0&&o.deleteSelConditions(r,t.join(","))}})}},r.saveCondition=function(){r.expertReview.isSelete?common.alert({vm:r,msg:"当前项目已经进行整体专家方案的抽取，不能再修改方案！"}):a(!1)?o.saveCondition(r):common.alert({vm:r,msg:"请先设置好条件再保存！",closeDialog:!0})},r.startAutoExpertWin=function(){a(!0)?9==r.expertReview.isSelete?common.alert({vm:r,msg:"该方案已经进行整体专家方案的抽取，不能在继续抽取！"}):t.queryAutoExpert(r):common.alert({vm:r,msg:"请先保存编辑的抽取方案！"})},r.showAutoExpertWin=function(){$("#aotuExpertDiv").kendoWindow({width:"800px",height:"600px",title:"专家抽取",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},r.resetAutoExpert=function(){common.alert({vm:r,msg:"功能待开发！"})},r.affirmAutoExpert=function(){t.affirmAutoExpert(r)},r.affirmJoinExpert=function(){$("#confirmJoinExpert").kendoWindow({width:"960px",height:"600px",title:"参加评审会专家确认",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},r.updateToJoin=function(){var e=$("#notJoinExpertTable input[name='notJoinExpert']:checked");if(e.length<1)common.alert({vm:r,msg:"请选择操作对象"});else{for(var o=[],i=0;i<e.length;i++)o.push(e[i].value);t.updateJoinState(r,o.join(","),"9")}},r.updateToNotJoin=function(){var e=$("#joinExpertTable input[name='joinExpert']:checked");if(e.length<1)common.alert({vm:r,msg:"请选择操作对象"});else{for(var o=[],i=0;i<e.length;i++)o.push(e[i].value);t.updateJoinState(r,o.join(","),"0")}},r.affirmExpert=function(){var e=$("input[name='seletedEp']:checked");if(e.length<1)common.alert({vm:r,msg:"请选择操作对象"});else{for(var o=[],i=0;i<e.length;i++)o.push(e[i].value);var n=o.join(",");t.updateExpertState(r,n,"9")}}}angular.module("app").controller("expertSelectCtrl",e),e.$inject=["$location","expertReviewSvc","expertConditionSvc","$state"]}(),function(){"use strict";function e(e,t){function o(e){e.conditions=new Array,e.customCondition=new Array,e.expertReview={},e.selfExperts=[],e.selectExperts=[],e.selectIds=[],e.autoExperts=[],e.autoSelExperts=[],e.outsideExperts=[]}function i(t){t.iscommit=!0,o(t);var i={method:"get",url:rootPath+"/expertReview/html/initByWorkProgramId",params:{workProgramId:t.workProgramId}},n=function(e){t.iscommit=!1,t.expertReview=e.data,t.expertReview.expertSelConditionDtoList&&t.expertReview.expertSelConditionDtoList.length>0&&(t.conditions=t.expertReview.expertSelConditionDtoList,t.conditionIndex=t.expertReview.expertSelConditionDtoList.length),t.expertReview.expertSelectedDtoList&&t.expertReview.expertSelectedDtoList.length>0&&(t.expertReview.expertSelectedDtoList.forEach(function(e,o){t.selectIds.push(e.expertDto.expertID),t.selectExperts.push(e),"1"==e.selectType?(t.autoExperts.push(e),t.autoSelExperts.push(e.expertDto)):"2"==e.selectType?t.selfExperts.push(e):"3"==e.selectType&&t.outsideExperts.push(e)}),t.selectIds.length>0?t.excludeIds=t.selectIds.join(","):t.excludeIds="")};common.http({vm:t,$http:e,httpOptions:i,success:n})}function n(){return[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.expertID)},filterable:!1,width:25,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"name",title:"姓名",width:100,filterable:!1},{field:"degRee",title:"学位",width:100,filterable:!1},{field:"sex",title:"性别",width:50,filterable:!0},{field:"comPany",title:"工作单位",width:100,filterable:!1},{field:"degRee",title:"职务",width:100,filterable:!1},{field:"expeRttype",title:"专家类别",width:100,filterable:!1}]}function a(e){var t=function(){var e=this.items(),t=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*o,i=$(this).find(".row-number");$(i).html(e)})},o=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findByOData",$("#selfSelExpertForm")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}});e.selfExpertOptions={dataSource:common.gridDataSource(o),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:n(),dataBound:t,resizable:!0};var i=new kendo.data.DataSource({type:"odata",
transport:common.kendoGridConfig().transport(rootPath+"/expert/findByOData",$("#outSelExpertForm"),{filter:"state eq '3'"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}});e.outExpertOptions={dataSource:common.gridDataSource(i),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:n(),dataBound:t,resizable:!0}}function r(e){e.selfExpertOptions.dataSource.read(),$("#selfExpertDiv").kendoWindow({width:"860px",height:"500px",title:"自选评审专家",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()}function s(t){var o=common.getKendoCheckId("#selfExpertGrid");if(0==o.length)$("#selfExpertError").html("请选择一条专家数据才能保存！");else if(o.length>1)$("#selfExpertError").html("自选专家最多只能选择一个！");else{$("#selfExpertError").html(""),window.parent.$("#selfExpertDiv").data("kendoWindow").close(),t.iscommit=!0;var n={method:"post",url:rootPath+"/expertReview/saveExpertReview",params:{expertIds:o[0].value,reviewId:t.expertReview.id,selectType:"2"}},a=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.iscommit=!1,i(t),common.alert({vm:t,msg:"操作成功！",closeDialog:!0})}})};common.http({vm:t,$http:e,httpOptions:n,success:a,onError:function(e){t.iscommit=!1}})}}function c(t,o,i){t.iscommit=!0;var n={method:"post",url:rootPath+"/expertReview/updateExpertState",params:{expertIds:o,state:i}},a=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.iscommit=!1,common.alert({vm:t,msg:"操作成功！",closeDialog:!0})}})};common.http({vm:t,$http:e,httpOptions:n,success:a,onError:function(e){t.iscommit=!1}})}function l(e){e.outExpertOptions.dataSource.read(),$("#outExpertDiv").kendoWindow({width:"860px",height:"500px",title:"自选新专家、市外、境外专家",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()}function d(t){var o=common.getKendoCheckId("#outExpertGrid");if(0==o.length)$("#outExpertError").html("请选择一条专家数据才能保存！");else{$("#outExpertError").html(""),window.parent.$("#outExpertDiv").data("kendoWindow").close(),t.iscommit=!0;var n="";$.each(o,function(e,t){n+=0==e?t.value:","+t.value});var a={method:"post",url:rootPath+"/expertReview/saveExpertReview",params:{expertIds:n,reviewId:t.expertReview.id,selectType:"3"}},r=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.iscommit=!1,i(t),common.alert({vm:t,msg:"操作成功！",closeDialog:!0})}})};common.http({vm:t,$http:e,httpOptions:a,success:r,onError:function(e){t.iscommit=!1}})}}function m(t,o){var i={};t.conditions.forEach(function(e,t){e.sort==o&&(i=e,i.maJorBig=$("#maJorBig"+e.sort).val(),i.maJorSmall=$("#maJorSmall"+e.sort).val(),i.expeRttype=$("#expeRttype"+e.sort).val())}),i.expertReviewDto={},i.expertReviewDto.id=t.expertReview.id;var n={method:"post",url:rootPath+"/expert/countReviewExpert",data:i,params:{workprogramId:t.workProgramId,reviewId:t.expertReview.id}},a=function(e){common.requestSuccess({vm:t,response:e,fn:function(){$("#expertCount"+o).html(e.data)}})};common.http({vm:t,$http:e,httpOptions:n,success:a})}function u(t){var o={method:"get",url:rootPath+"/expertReview/html/getReviewList"},i=function(e){t.reviewList=e.data};common.http({vm:t,$http:e,httpOptions:o,success:i,onError:function(e){t.iscommit=!1}})}function f(t){var o={method:"post",url:rootPath+"/expert/findReviewExpert",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(t.conditions),params:{workprogramId:t.workProgramId,reviewId:t.expertReview.id}},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){e.data&&(t.autoExpertList=e.data,p(t))}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}function p(o){if(!o.autoExpertList||o.autoExpertList.length<1)return void common.alert({vm:o,msg:"本次被抽取的专家人数不满足抽取条件，抽取无效！请重新设置抽取条件！"});var n=0,a=new Array,r=new Array;if(o.autoExpertList.forEach(function(e,t){"2"==e.state||2==e.state?a.push(e):r.push(e)}),o.conditions.forEach(function(e,t){n+=parseInt(e.officialNum)}),n>a.length)return void common.alert({vm:o,msg:"本次被抽取的正选专家人数不满足抽取条件，抽取无效！请重新设置抽取条件！"});if(n>r.length)return void common.alert({vm:o,msg:"本次被抽取的备选专家人数不满足抽取条件，抽取无效！请重新设置抽取条件！"});o.showAutoExpertWin();var s=0,c="";o.t=t(function(){if(0==n){t.cancel(o.t),o.iscommit=!0;var l={method:"post",url:rootPath+"/expertReview/saveExpertReview",params:{expertIds:c,reviewId:o.expertReview.id,selectType:"1",isDraw:!0}},d=function(e){common.requestSuccess({vm:o,response:e,fn:function(){o.iscommit=!1,i(o),common.alert({vm:o,msg:"操作成功！",closeDialog:!0})}})};common.http({vm:o,$http:e,httpOptions:l,success:d,onError:function(e){o.iscommit=!1}})}else{var m=Math.floor(Math.random()*o.autoExpertList.length);if(o.showAutoExpertName=o.autoExpertList[m].name,++s%10==0){var u=Math.floor(Math.random()*a.length);o.autoSelExperts.push(a[u]),c+=a[u].expertID+",",a.forEach(function(e,t){a[u].expertID==e.expertID&&a.splice(t,1)}),u=Math.floor(Math.random()*r.length),o.autoSelExperts.push(r[u]),c+=r[u].expertID+",",r.forEach(function(e,t){r[u].expertID==e.expertID&&r.splice(t,1)}),n--}}},200)}function h(t,o,i){t.iscommit=!0;var n={method:"post",url:rootPath+"/expertReview/updateJoinState",params:{expertIds:o,state:i}},a=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.iscommit=!1,t.selectExperts.forEach(function(e,t){o.indexOf(e.id)>=0&&(e.isJoin=i)}),common.alert({vm:t,msg:"操作成功！",closeDialog:!0})}})};common.http({vm:t,$http:e,httpOptions:n,success:a,onError:function(e){t.iscommit=!1}})}function g(t){t.iscommit=!0;var o={method:"post",url:rootPath+"/expertReview/affirmAutoExpert",params:{reviewId:t.expertReview.id}},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.iscommit=!1,window.parent.$("#aotuExpertDiv").data("kendoWindow").close(),common.alert({vm:t,msg:"操作成功！",closeDialog:!0})}})};common.http({vm:t,$http:e,httpOptions:o,success:i,onError:function(e){t.iscommit=!1}})}function v(t,o){t.iscommit=!0;var n={method:"delete",url:rootPath+"/expertSelected",params:{id:o,reviewId:t.expertReview.id,deleteAll:!1}},a=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.iscommit=!1,i(t),common.alert({vm:t,msg:"操作成功！",closeDialog:!0})}})};common.http({vm:t,$http:e,httpOptions:n,success:a,onError:function(e){t.iscommit=!1}})}return{initExpertGrid:a,initSelfExpert:r,saveSelfExpert:s,updateExpertState:c,showOutExpertGrid:l,saveOutExpert:d,countMatchExperts:m,getReviewList:u,initReview:i,delSelectedExpert:v,queryAutoExpert:f,validateAutoExpert:p,affirmAutoExpert:g,updateJoinState:h,initParamValue:o}}angular.module("app").factory("expertReviewSvc",e),e.$inject=["$http","$interval"]}(),function(){"use strict";function e(e){function t(t){var o={method:"post",url:rootPath+"/expertSelCondition/saveConditionList",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(t.conditions)},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.conditions=e.data,common.alert({vm:t,msg:"操作成功！",closeDialog:!0})}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}function o(e){return!!(/^(\+|-)?\d+$/.test(e)&&e>0)}function i(t,o){t.iscommit=!0;var i={method:"delete",url:rootPath+"/expertSelCondition",params:{ids:o}},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.iscommit=!1,common.alert({vm:t,msg:"操作成功！",closeDialog:!0})}})};common.http({vm:t,$http:e,httpOptions:i,success:n,onError:function(e){t.iscommit=!1}})}return{saveCondition:t,deleteSelConditions:i,isUnsignedInteger:o}}angular.module("app").factory("expertConditionSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,o,i){var n=this;n.title="项目归档编辑",n.fileRecord={},n.fileRecord.signId=o.params.signid,n.signId=o.params.signid,$("input").click(function(){}),n.commonDownloadSysFile=function(e){common.commonDownloadFile(n,e)},n.commonDelSysFile=function(e){common.commonDelSysFile(n,e,i)},n.fileRecordJquery=function(){common.initcommonQueryWin(n),n.sysSignId=n.fileRecord.fileRecordId,common.commonSysFilelist(n,i)},n.fileRecordUpload=function(e){common.initcommonUploadWin({businessId:n.fileRecord.fileRecordId})},function(){t.initFileRecordData(n)}(),n.create=function(){t.saveFileRecord(n)}}angular.module("app").controller("fileRecordEditCtrl",e),e.$inject=["$location","fileRecordSvc","$state","$http"]}(),function(){"use strict";function e(e,t){function o(e){var o={method:"get",url:rootPath+"/fileRecord/html/initFillPage",params:{signId:e.fileRecord.signId}},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){null!=t.data&&""!=t.data&&(e.fileRecord=t.data.file_record,e.fileRecord.signId=e.signId,e.signUserList=t.data.sign_user_List)}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}function i(e){if(common.initJqValidation($("#fileRecord_form")),$("#fileRecord_form").valid()){e.signUser&&(e.fileRecord.signUserid=e.signUser.id,e.fileRecord.signUserName=e.signUser.displayName),e.saveProcess=!0;var o={method:"post",url:rootPath+"/fileRecord",data:e.fileRecord},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.saveProcess=!1,common.alert({vm:e,msg:"操作成功！"})}})};common.http({vm:e,$http:t,httpOptions:o,success:i,onError:function(t){e.saveProcess=!1}})}}return{initFileRecordData:o,saveFileRecord:i}}angular.module("app").factory("fileRecordSvc",e),e.$inject=["$rootScope","$http"]}(),function(){"use strict";function e(e,t,o){function i(e){var t=e.flow.processInstanceId;(angular.isUndefined(e.flow.hideFlowImg)||0==e.flow.hideFlowImg)&&(e.picture=rootPath+"/flow/processInstance/img/"+t);var o=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/flow/processInstance/history/"+t),schema:common.kendoGridConfig().schema({id:"id"}),rowNumber:!0,headerCenter:!0}),i=[{field:"",title:"序号",template:"<span class='row-number'></span>",width:30},{field:"activityName",title:"环节名称",width:120,filterable:!1},{field:"assignee",title:"处理人",width:80,filterable:!1},{field:"startTime",title:"开始时间",width:120,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"endTime",title:"结束时间",width:120,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"duration",title:"处理时长",width:120,filterable:!1},{field:"message",title:"处理信息",width:300,filterable:!1}];e.historygrid={dataSource:common.gridDataSource(o),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,dataBound:function(){var t=this.items();$(t).each(function(o){o==t.length-1&&c(e),$(this).find(".row-number").html(o+1)})}}}function n(t){var i={method:"get",url:rootPath+"/flow/processInstance/flowNodeInfo",params:{taskId:t.flow.taskId,processInstanceId:t.flow.processInstanceId}},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.flow=e.data,t.flow.businessMap&&(t.flow.businessMap.viceDirectors&&(t.businessTr=!0,t.ZHB_SP_SW=!0,t.viceDirectors=t.flow.businessMap.viceDirectors),t.flow.businessMap.orgs&&(t.businessTr=!0,t.FGLD_SP_SW=!0,t.orgs=t.flow.businessMap.orgs),t.flow.businessMap.users&&(t.businessTr=!0,t.BM_FB=!0,t.users=t.flow.businessMap.users),t.flow.businessMap.xsOrgs&&(t.businessTr=!0,t.XS_FGLD_SP_SW=!0,t.xsOrgs=t.flow.businessMap.xsOrgs),t.flow.businessMap.xsusers&&(t.businessTr=!0,t.XS_BM_FB=!0,t.xsusers=t.flow.businessMap.xsusers,t.isSelMainPriUser=!1,t.isMainPriUser=0,t.xsusers.forEach(function(e,t){e.isSelected=!1}))),o.initBusinessParams(t)}})};common.http({vm:t,$http:e,httpOptions:i,success:n})}function a(o){if(common.initJqValidation($("#flow_form")),$("#flow_form").valid()){o.isCommit=!0;var i={method:"post",url:rootPath+"/flow/commit",data:o.flow},n=function(e){common.requestSuccess({vm:o,response:e,fn:function(){common.alert({vm:o,msg:e.data.reMsg,closeDialog:!0,fn:function(){"error"==e.data.reCode?o.isCommit=!1:t.go("index")}})}})};common.http({vm:o,$http:e,httpOptions:i,success:n,onError:function(e){o.isCommit=!1}})}}function r(t){var o={method:"post",url:rootPath+"/flow/rollbacklast",data:t.flow},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:e.data.reMsg})}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}function s(t){if(null==t.flow.back||null==t.flow.back.activitiId||""==t.flow.back.activitiId)return void common.alert({vm:t,msg:"请先选择要会退的环节！"});common.confirm({vm:t,title:"",msg:"确认回退吗？",fn:function(){t.flow.rollBackActiviti=t.flow.back.activitiId,t.flow.backNodeDealUser=t.flow.back.assignee;var o={method:"post",url:rootPath+"/flow/rollback",data:t.flow},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:e.data.reMsg})}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}})}function c(e){e.backNode=[];for(var t=e.historygrid.dataSource.data(),o=t.length,i=0;i<o;i++)t[i].assignee&&t[i].endTime&&e.backNode.push({activitiId:t[i].activityId,activitiName:t[i].activityName,assignee:t[i].assignee})}function l(e){e.nextDealUserList=e.nextDealUserMap[e.flow.nextNodeAcivitiId],e.nextDealUserList&&(e.flow.nextDealUser=e.nextDealUserList[0].loginName)}function d(t,o){var i={method:"post",url:rootPath+"/flow/suspend/"+o},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功！"})}})};common.http({vm:t,$http:e,httpOptions:i,success:n})}function m(t,o){var i={method:"post",url:rootPath+"/flow/active/"+o},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功！"})}})};common.http({vm:t,$http:e,httpOptions:i,success:n})}function u(t){if(null==t.flow.dealOption||""==t.flow.dealOption)return void common.alert({vm:t,msg:"请填写处理信息！"});var o={method:"post",url:rootPath+"/flow/deleteFLow",data:t.flow},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功！"})}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}function f(e){$("#star").raty({score:function(){return $(this).attr("data-num",e.expertReview.score),$(this).attr("data-num")},starOn:"../contents/libs/raty/lib/images/star-on.png",starOff:"../contents/libs/raty/lib/images/star-off.png",starHalf:"../contents/libs/raty/lib/images/star-half.png",readOnly:!1,halfShow:!0,size:34,click:function(t,o){e.expertReview.score=t}}),e.showExpertRemark=!0,$("#expertmark").kendoWindow({width:"1000px",height:"630px",title:"编辑-专家星级",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open(),k(e)}function p(t){if(common.initJqValidation($("#markform")),$("#markform").valid()){var o={method:"post",url:rootPath+"/expertReview/html/expertMark",data:t.expertReview},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){window.parent.$("#expertmark").data("kendoWindow").close(),t.gridOptions.dataSource.read(),t.isSubmit=!1,common.alert({vm:t,msg:"操作成功"})}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}}function h(t){if(common.initJqValidation($("#payform")),getSelectExpert,$("#payform").valid()){if(!w(t))return window.parent.$("#payment").data("kendoWindow").close(),void common.alert({vm:t,msg:"应纳税额计算错误,保存失败！",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}});t.isCommit=!0;var o={method:"post",url:rootPath+"/expertReview/html/savePayment",data:t.expertReview},i=function(e){t.isCommit=!1,window.parent.$("#payment").data("kendoWindow").close(),t.paymentgrid.dataSource.read(),common.alert({vm:t,msg:"操作成功"})};common.http({vm:t,$http:e,httpOptions:o,success:i})}}function g(e){var t,o,i,n=e.expertReview.reviewCost;return n<=1500&&(t=3,o=0),1500<n&&n<=4500&&(t=10,o=105),4500<n&&n<=9e3&&(t=20,o=555),9e3<n&&n<=35e3&&(t=25,o=1005),35e3<n&&n<=55e3&&(t=30,o=2755),55e3<n&&n<=8e4&&(t=35,o=5505),n>8e4&&(t=45,o=13505),i=n*t/100-o,i<0&&(i=0),i}function v(e){var t=e.expertReview.reviewCost,o=g(e);e.expertReview.reviewTaxes=o.toFixed(2),e.expertReview.totalCost=t-o.toFixed(2),console.log(e.expertReview.reviewTaxes)}function w(e){var t=!0,o=e.expertReview.reviewCost,i=g(e),n=o-i.toFixed(2);return i.toFixed(2)!=e.expertReview.reviewTaxes&&n!=e.expertReview.totalCost&&(t=!1),t}function S(e){e.showExpertpayment=!0,$("#payment").kendoWindow({width:"1000px",height:"630px",title:"编辑-专家费用",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open(),k(e)}function k(t){t.isCommit=!0;var o={method:"get",url:rootPath+"/expertReview/html/getSelectExpertById",params:{expertId:t.expertReview.expertId}},i=function(e){t.isCommit=!1,t.expertReview=e.data,t.expertReview.expertId=t.expertReview.expertDto.expertID};common.http({vm:t,$http:e,httpOptions:o,success:i})}return{initFlowData:i,getFlowInfo:n,commit:a,rollBackToLast:r,rollBack:s,initBackNode:c,initDealUerByAcitiviId:l,suspendFlow:d,activeFlow:m,deleteFlow:u,gotoExpertmark:f,saveMark:p,savePayment:h,countTaxes:v,gotopayment:S,getselectExpertById:k}}angular.module("app").factory("flowSvc",e),e.$inject=["$http","$state","signFlowSvc"]}(),function(){"use strict";function e(e,t){var o=this;o.title="",o.changePwd=function(){t.changePwd(o)}}angular.module("app").controller("homeCtrl",e),e.$inject=["$location","homeSvc"]}(),function(){"use strict";function e(e){function t(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0;var i={method:"put",url:o,data:t.model.password},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:t,$http:e,httpOptions:i,success:n})}}var o="/account/password";return{changePwd:t}}angular.module("app").factory("homeSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t){var o=this;o.title="日志列表",function(){t.grid(o)}()}angular.module("app").controller("logCtrl",e),e.$inject=["$location","logSvc"]}(),function(){"use strict";function e(e,t){function o(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(i+"/fingByOData"),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=[{field:"id",title:"ID",width:80,filterable:!1},{field:"level",title:"级别",width:100,filterable:!0},{field:"message",title:"日志内容",filterable:!1},{field:"userId",title:"操作者",width:150,filterable:!0},{field:"createdDate",title:"操作时间",width:180,filterable:!1,format:"{0:yyyy/MM/dd HH:mm:ss}"}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,resizable:!0}}var i=rootPath+"/log";rootPath;return{grid:o}}angular.module("app").factory("logSvc",e),e.$inject=["$http","$compile"]}(),function(){"use strict";function e(e,t){var o=this;o.title="会议室列表",o.model={},o.del=function(e){common.confirm({vm:o,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteMeeting(o,e)}})},o.used=function(e){o.model.id=e,o.model.mrStatus="1",t.roomUseState(o)},o.stoped=function(e){common.confirm({vm:o,title:"",msg:"确定停用会议室么？",fn:function(){$(".confirmDialog").modal("hide"),o.model.id=e,o.model.mrStatus="0",t.roomUseState(o)}})},o.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:o,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var n=t.join(",");o.del(n)}},o.queryMeeting=function(){t.queryMeeting(o)},function(){t.grid(o)}()}angular.module("app").controller("meetingCtrl",e),e.$inject=["$location","meetingSvc"]}(),function(){"use strict";function e(e,t,o){var i=this;i.title="添加会议室",i.isuserExist=!1,i.id=o.params.id,i.id&&(i.isUpdate=!0,i.title="更新会议室"),i.create=function(){t.createMeeting(i)},i.update=function(){t.updateMeeting(i)},function(){i.isUpdate&&t.getMeetingById(i)}()}angular.module("app").controller("meetingEditCtrl",e),e.$inject=["$location","meetingSvc","$state"]}(),function(){"use strict";function e(e){function t(e){e.gridOptions.dataSource.read()}function o(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0,t.model.id=t.id;var o={method:"put",url:c,data:t.model},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}}function i(t,o){t.isSubmit=!0;var i={method:"delete",url:c,data:o},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})};common.http({vm:t,$http:e,httpOptions:i,success:n})}function n(t){var o={method:"put",url:c+"/roomUseState",data:t.model},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.gridOptions.dataSource.read()}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}function a(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0;var o={method:"post",url:c,data:t.model},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=l}})}})};common.http({vm:t,$http:e,httpOptions:o,success:i,onError:function(e){t.iscommit=!1}})}}function r(t){var o={method:"get",url:c+"/html/findByIdMeeting",params:{id:t.id}},i=function(e){t.model=e.data};common.http({vm:t,$http:e,httpOptions:o,success:i})}function s(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(c+"/fingByOData",$("#meetingFrom")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=function(){var e=this.items(),t=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*o,i=$(this).find(".row-number");$(i).html(e)})},i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:30,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:40,filterable:!1,template:"<span class='row-number'></span>"},{field:"num",title:"会议室编号",width:100,filterable:!1},{field:"mrName",title:"会议室名称",width:180,filterable:!1},{field:"mrType",title:"会议室类型",width:180,filterable:!1},{field:"addr",title:"会议室地点",width:200,filterable:!1},{field:"capacity",title:"会议室容量",width:100,filterable:!1},{field:"userName",title:"会议室负责人",width:100,filterable:!1},{field:"userPhone",title:"负责人电话",width:150,filterable:!1},{field:"",title:"状态",width:100,template:function(e){return"2"==e.mrStatus?"停用":"正常"}},{field:"",title:"操作",width:180,template:function(e){var t=!1;return t="2"==e.mrStatus,common.format($("#columnBtns").html(),"vm.stoped('"+e.id+"')",t,"vm.used('"+e.id+"')",t,e.id)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:o,resizable:!0}}var c=rootPath+"/meeting",l="#/meeting";return{grid:s,getMeetingById:r,createMeeting:a,deleteMeeting:i,updateMeeting:o,queryMeeting:t,roomUseState:n}}angular.module("app").factory("meetingSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t){var o=this;o.title="My test",o.del=function(e){common.confirm({vm:o,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteMytest(o,e)}})},o.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:o,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var n=t.join(",");o.del(n)}},function(){t.grid(o)}()}angular.module("app").controller("myTestCtrl",e),e.$inject=["$location","myTestSvc"]}(),function(){"use strict";function e(e,t,o){var i=this;i.title="添加My test",i.isuserExist=!1,i.id=o.params.id,i.id&&(i.isUpdate=!0,i.title="更新My test"),i.create=function(){t.createMyTest(i)},i.update=function(){t.updateMyTest(i)},function(){i.isUpdate&&t.getMyTestById(i)}()}angular.module("app").controller("myTestEditCtrl",e),e.$inject=["$location","myTestSvc","$state"]}(),function(){"use strict";function e(e){function t(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0,t.model.id=t.id;var o={method:"put",url:r,data:t.model},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}}function o(t,o){t.isSubmit=!0;var i={method:"delete",url:r,data:o},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})};common.http({vm:t,$http:e,httpOptions:i,success:n})}function i(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0;var o={method:"post",url:r,data:t.model},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=s}})}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}}function n(t){var o={method:"get",url:common.format(r+"?$filter=id eq '{0}'",t.id)},i=function(e){t.model=e.data.value[0]};common.http({vm:t,$http:e,httpOptions:o,success:i})}function a(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(r),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"id",title:"id",width:100,filterable:!0},{field:"testName",title:"测试名",width:100,filterable:!0},{field:"test01",title:"测试01",width:100,filterable:!0},{field:"test02",title:"测试02",width:100,filterable:!0},{field:"",title:"操作",width:140,template:function(e){return common.format($("#columnBtns").html(),"vm.del('"+e.id+"')",e.id)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,resizable:!0}}var r=rootPath+"/myTest",s="#/myTest";return{grid:a,getMyTestById:n,createMyTest:i,deleteMyTest:o,updateMyTest:t}}angular.module("app").factory("myTestSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t){var o=this;o.title="处室人员管理",o.del=function(e){common.confirm({vm:o,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteOfficeUser(o,e)}})},o.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:o,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var n=t.join(",");o.del(n)}},o.queryOffice=function(){t.queryOffice(o)},function(){t.grid(o)}()}angular.module("app").controller("officeUserCtrl",e),e.$inject=["$location","officeUserSvc"]}(),function(){"use strict";function e(e,t,o){var i=this;i.title="添加人员",i.isuserExist=!1,i.officeID=o.params.officeID,i.officeID&&(i.isUpdate=!0,i.title="更新人员"),i.create=function(){t.createOfficeUser(i)},i.update=function(){t.updateOfficeUser(i)},function(){i.isUpdate&&t.getOfficeUserById(i),t.getDepts(i)}()}angular.module("app").controller("officeUserEditCtrl",e),e.$inject=["$location","officeUserSvc","$state"]}(),function(){"use strict";function e(e){function t(e){e.gridOptions.dataSource.read()}function o(t){var o={method:"get",url:common.format(c+"/getDepts")},i=function(e){t.depts={},t.depts=e.data};common.http({vm:t,$http:e,httpOptions:o,success:i})}function i(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0,t.model.id=t.id;var o={method:"put",url:c,data:t.model},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}}function n(t,o){t.isSubmit=!0;var i={method:"delete",url:c,data:o},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})}})};common.http({vm:t,$http:e,httpOptions:i,success:n})}function a(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0;var o={method:"post",url:c,data:t.model},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,location.href=l}})}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}}function r(t){var o={method:"get",url:rootPath+"/officeUser/html/findById",params:{officeID:t.officeID}},i=function(e){e.data.dept,t.model=e.data};common.http({vm:t,$http:e,httpOptions:o,success:i})}function s(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(c+"/fingByOData",$("#formOffice")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=function(){var e=this.items(),t=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*o,i=$(this).find(".row-number");$(i).html(e)})},i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.officeID)},filterable:!1,width:20,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:30,filterable:!1,template:"<span class='row-number'></span>"},{field:"officeUserName",title:"办事处联系人",width:100,filterable:!1},{field:"deptName",title:"所在办事处",width:100,filterable:!1},{field:"officePhone",title:"电话",width:100,filterable:!1},{field:"officeEmail",title:"邮件",width:100,filterable:!1},{field:"officeDesc",title:"描述",width:100,filterable:!1},{field:"",title:"操作",width:140,template:function(e){return common.format($("#columnBtns").html(),"vm.del('"+e.officeID+"')",e.officeID)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:o,resizable:!0}}var c=rootPath+"/officeUser",l="#/officeUserList";return{grid:s,getOfficeUserById:r,createOfficeUser:a,deleteOfficeUser:n,updateOfficeUser:i,getDepts:o,queryOffice:t}}angular.module("app").factory("officeUserSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t){var o=this;o.title="部门列表",o.del=function(e){common.confirm({vm:o,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteOrg(o,e)}})},o.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:o,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var n=t.join(",");o.del(n)}},o.queryOrg=function(){t.queryOrg(o)},function(){t.grid(o)}()}angular.module("app").controller("orgCtrl",e),e.$inject=["$location","orgSvc"]}(),function(){"use strict";function e(e,t,o){var i=this;i.title="新增部门",i.isorgExist=!1,i.id=o.params.id,i.id&&(i.isUpdate=!0,i.title="更新部门"),i.create=function(){t.createOrg(i)},i.update=function(){t.updateOrg(i)},function(){t.initRoleUsers(i),i.isUpdate&&t.getOrgById(i)}()}angular.module("app").controller("orgEditCtrl",e),e.$inject=["$location","orgSvc","$state"]}(),function(){"use strict";function e(e,t){function o(e){e.gridOptions.dataSource.read()}function i(e){
var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(d+"/fingByOData",$("#orgForm")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"sort",dir:"asc"}}),o=function(){var e=this.items(),t=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*o,i=$(this).find(".row-number");$(i).html(e)})},i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:70,filterable:!1,template:"<span class='row-number'></span>"},{field:"orgIdentity",title:"部门标识",width:80,filterable:!1},{field:"name",title:"部门名称",width:130,filterable:!1},{field:"orgFunction",title:"职能",width:130,filterable:!1},{field:"orgDirectorName",title:"部门负责人",width:100,filterable:!1},{field:"orgSLeaderName",title:"分管领导",width:100,filterable:!1},{field:"orgPhone",title:"电话",width:130,filterable:!1},{field:"orgAddress",title:"地址",width:130,filterable:!1},{field:"remark",title:"描述",width:130,filterable:!1},{field:"createdDate",title:"创建时间",width:180,filterable:!1,format:"{0:yyyy/MM/dd HH:mm:ss}"},{field:"",title:"操作",width:200,template:function(e){return common.format($("#columnBtns").html(),"vm.del('"+e.id+"')",e.id)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:o,resizable:!0}}function n(t){if(common.initJqValidation(),$("form").valid()&&0==t.isorgExist){t.isSubmit=!0;var o={method:"post",url:d,data:t.model};t.OrgDirectorUsers.forEach(function(e,o){e.id==t.model.orgDirector&&(t.model.orgDirectorName=e.displayName)}),t.orgMLeaderUsers.forEach(function(e,o){e.id==t.model.orgMLeader&&(t.model.orgMLeaderName=e.displayName)}),t.orgSLeaderUser.forEach(function(e,o){e.id==t.model.orgSLeader&&(t.model.orgSLeaderName=e.displayName)});var i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=m}})}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}}function a(t){var o={method:"get",url:common.format(d+"/getCompany")},i=function(e){t.company={},t.company=e.data};common.http({vm:t,$http:e,httpOptions:o,success:i})}function r(t){var o={method:"get",url:d+"/html/getOrgById",params:{id:t.id}},i=function(e){t.model=e.data};common.http({vm:t,$http:e,httpOptions:o,success:i})}function s(t){if(common.initJqValidation(),$("form").valid()&&0==t.isorgExist){t.isSubmit=!0,t.model.id=t.id,t.OrgDirectorUsers.forEach(function(e,o){e.id==t.model.orgDirector&&(t.model.orgDirectorName=e.displayName)}),t.orgMLeaderUsers.forEach(function(e,o){e.id==t.model.orgMLeader&&(t.model.orgMLeaderName=e.displayName)}),t.orgSLeaderUser.forEach(function(e,o){e.id==t.model.orgSLeader&&(t.model.orgSLeaderName=e.displayName)});var o={method:"put",url:d,data:t.model},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}}function c(t,o){t.isSubmit=!0;var i={method:"delete",url:d,data:o},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})};common.http({vm:t,$http:e,httpOptions:i,success:n})}function l(t){var o={method:"get",url:rootPath+"/user/initRoleUsers"},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.orgMLeaderUsers=e.data.DIRECTOR,t.orgSLeaderUser=e.data.VICE_DIRECTOR,t.OrgDirectorUsers=e.data.DEPT_LEADER}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}var d=rootPath+"/org",m="#/org";rootPath;return{grid:i,createOrg:n,getOrgById:r,updateOrg:s,deleteOrg:c,getCompany:a,initRoleUsers:l,queryOrg:o}}angular.module("app").factory("orgSvc",e),e.$inject=["$http","$compile"]}(),function(){"use strict";function e(e,t,o,i){var n=this;n.id=t.params.id,n.showAddUserDialog=function(){$(".addUser").modal({backdrop:"static",keyboard:!1}),n.orgUserGrid.dataSource.read()},n.closeAddUserDialog=function(){$(".addUser").modal("hide")},n.add=function(e){i.add(n,e)},n.remove=function(e){i.remove(n,e)},n.removes=function(){var e=common.getKendoCheckId(".orgUserGrid");if(0==e.length)common.alert({vm:n,msg:"请选择数据"});else{for(var t=[],o=0;o<e.length;o++)t.push(e[o].value);var i=t.join(",");n.remove(i)}},function(){o.getOrgById(n),i.orgUserGrid(n),i.allUserGrid(n)}()}angular.module("app").controller("orgUserCtrl",e),e.$inject=["$location","$state","orgSvc","orgUserSvc"]}(),function(){"use strict";function e(e,t){function o(t,o){var i={method:"delete",url:rootPath+"/org/deleteUsers",params:{orgId:t.id,userId:o}},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.gridOptions.dataSource.read()}})};common.http({vm:t,$http:e,httpOptions:i,success:n})}function i(t,o){var i={method:"post",url:rootPath+"/org/addUsers",params:{orgId:t.id,userId:o}},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.orgUserGrid.dataSource.read(),t.gridOptions.dataSource.read()}})};common.http({vm:t,$http:e,httpOptions:i,success:n})}function n(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(r+"?orgId="+e.id),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=[{field:"loginName",title:"登录名",width:200,filterable:!0},{field:"displayName",title:"显示名",width:200,filterable:!0},{field:"comment",title:"描述",filterable:!1},{field:"",title:"操作",width:80,template:function(e){return common.format($("#allUserGridBtns").html(),"vm.add('"+e.id+"')",e.id)}}];e.orgUserGrid={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,resizable:!0}}function a(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(s+"?orgId="+e.id),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!1,serverSorting:!1,serverFiltering:!1,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"loginName",title:"登录名",width:200,filterable:!1},{field:"displayName",title:"显示名",width:200,filterable:!1},{field:"comment",title:"描述",filterable:!1},{field:"",title:"操作",width:180,template:function(e){return common.format($("#columnBtns").html(),"vm.remove('"+e.id+"')",e.id)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,resizable:!0}}var r=rootPath+"/org/userNotIn",s=rootPath+"/org/users";return{orgUserGrid:a,allUserGrid:n,add:i,remove:o}}angular.module("app").factory("orgUserSvc",e),e.$inject=["$http","$compile"]}(),function(){"use strict";function e(e,t){var o=this;o.title="角色列表",o.del=function(e){common.confirm({vm:o,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteRole(o,e)}})},o.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:o,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var n=t.join(",");o.del(n)}},function(){t.grid(o)}()}angular.module("app").controller("roleCtrl",e),e.$inject=["$location","roleSvc"]}(),function(){"use strict";function e(e,t,o){var i=this;i.title="添加角色",i.isRoleExist=!1,i.id=o.params.id,i.id&&(i.isUpdate=!0,i.title="更新角色"),i.create=function(){t.createRole(i)},i.update=function(){t.updateRole(i)},i.checkRole=function(){t.checkRole(i)},function(){i.isUpdate?t.getRoleById(i):t.initZtreeClient(i)}()}angular.module("app").controller("roleEditCtrl",e),e.$inject=["$location","roleSvc","$state"]}(),function(){"use strict";function e(e,t){function o(){return $.fn.zTree.getZTreeObj("zTree").getCheckedNodes(!0)}function i(e){for(var t=$.fn.zTree.getZTreeObj("zTree"),o=$linq(e.model.resources).select(function(e){return e.path}).toArray(),i=t.getNodesByParam("level",1,null),n=$linq(i).where(function(e){return $linq(o).contains(e.path)}).toArray(),a=0,r=n.length;a<r;a++)t.checkNode(n[a],!0,!0)}function n(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(m+"/fingByOData"),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=function(){var e=this.items(),t=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*o,i=$(this).find(".row-number");$(i).html(e)})},i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:70,filterable:!1,template:"<span class='row-number'></span>"},{field:"roleName",title:"角色名称",width:200,filterable:!1},{field:"remark",title:"描述",filterable:!1},{field:"createdDate",title:"创建时间",width:180,filterable:!1,format:"{0:yyyy-MM-dd HH:mm:ss}"},{field:"",title:"操作",width:180,template:function(e){return common.format($("#columnBtns").html(),"vm.del('"+e.id+"')",e.id)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:o,resizable:!0}}function a(t){if(common.initJqValidation(),$("form").valid()&&0==t.isRoleExist){t.isSubmit=!0;var i=o(),n=$linq(i).where(function(e){return 0==e.isParent}).select(function(e){return{id:e.id,name:e.name,path:e.path,method:e.method}}).toArray();t.model.resources=n;var a={method:"post",url:m,data:t.model},r=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=u}})}})};common.http({vm:t,$http:e,httpOptions:a,success:r})}}function r(e){}function s(t){var o={method:"post",url:rootPath+"/role/findById",params:{roleId:t.id}},i=function(e){t.model=e.data,t.isUpdate&&d(t)};common.http({vm:t,$http:e,httpOptions:o,success:i})}function c(t){if(common.initJqValidation(),$("form").valid()&&0==t.isRoleExist){t.isSubmit=!0,t.model.id=t.id;var i=o(),n=$linq(i).where(function(e){return 0==e.isParent}).select(function(e){return{id:e.id,name:e.name,path:e.path,method:e.method}}).toArray();t.model.resources=n,t.model.createdDate="2017-04-07 12:00:00";var a={method:"put",url:m,data:t.model},r=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:t,$http:e,httpOptions:a,success:r})}}function l(t,o){t.isSubmit=!0;var i={method:"delete",url:m,data:o},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})};common.http({vm:t,$http:e,httpOptions:i,success:n})}function d(t){var o={method:"get",url:f},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){var o={check:{chkboxType:{Y:"ps",N:"ps"},enable:!0}},n=e.data;$.fn.zTree.init($("#zTree"),o,n),t.isUpdate&&i(t)}})};common.http({vm:t,$http:e,httpOptions:o,success:n})}var m=rootPath+"/role",u="#/role",f=rootPath+"/sys/resource";return{grid:n,createRole:a,checkRole:r,getRoleById:s,updateRole:c,deleteRole:l,initZtreeClient:d}}angular.module("app").factory("roleSvc",e),e.$inject=["$http","$compile"]}(),function(){"use strict";function e(e,t){var o=this;o.title="预定会议统计列表",o.queryRoomCount=function(){t.queryRoomCount(o)},o.del=function(e){common.confirm({vm:o,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteroomCount(o,e)}})},o.ResetRoomCount=function(){console.log("ddfdf"),t.cleanValue()},o.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:o,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var n=t.join(",");o.del(n)}},function(){t.grid(o),t.roomList(o),t.findAllOrg(o)}()}angular.module("app").controller("roomCountCtrl",e),e.$inject=["$location","roomCountSvc"]}(),function(){"use strict";function e(e,t){function o(){var e=$("#roomCountform").find("input,select");$.each(e,function(e,t){t.value=""})}function i(e){e.gridOptions.dataSource.read()}function n(t){var o={method:"get",url:common.format(c+"/getOrg")},i=function(e){t.orglist={},t.orglist=e.data};common.http({vm:t,$http:e,httpOptions:o,success:i})}function a(t){var o={method:"get",url:common.format(s+"/roomNamelist")},i=function(e){t.roomlists={},t.roomlists=e.data};common.http({vm:t,$http:e,httpOptions:o,success:i})}function r(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(s+"/fingByOData",$("#roomCountform")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=function(){var e=this.items(),t=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*o,i=$(this).find(".row-number");$(i).html(e)})},i=[{field:"rowNumber",title:"序号",width:40,filterable:!1,template:"<span class='row-number'></span>"},{field:"rbName",title:"会议名称",width:120,filterable:!1},{field:"addressName",title:"会议地点",width:120,filterable:!1},{field:"rbDay",title:"会议日期",width:160,filterable:!1},{field:"beginTimeStr",title:"会议开始时间",width:160,filterable:!1},{field:"endTimeStr",title:"会议结束时间",type:"date",width:160,filterable:!1},{field:"rbType",title:"会议类型",width:100,filterable:!1},{field:"dueToPeople",title:"会议预定人",width:100,filterable:!1}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:o,resizable:!0}}var s=(rootPath,rootPath+"/room"),c=rootPath+"/user",c=rootPath+"/user";return{grid:r,queryRoomCount:i,roomList:a,findAllOrg:n,cleanValue:o}}angular.module("app").factory("roomCountSvc",e),e.$inject=["$http","$compile"]}(),function(){"use strict";function e(e,t,o,i){var n=this;n.title="会议室预定列表",n.id=i.params.id,n.workProgramId=i.params.workProgramId,n.startDateTime=new Date("2006/6/1 08:00"),n.endDateTime=new Date("2030/6/1 21:00"),n.editRoom=function(){t.editRoom(n)},n.addRoom=function(){t.addRoom(n)},n.exportWeek=function(){t.exportWeek()},n.exportThisWeek=function(){t.exportThisWeek()},n.exportNextWeek=function(){t.exportNextWeek()},n.stageNextWeek=function(){t.stageNextWeek()},n.findMeeting=function(){t.findMeeting(n)},n.del=function(e){common.confirm({vm:n,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteRoom(n,e)}})},n.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:n,msg:"请选择数据"});else{for(var t=[],o=0;o<e.length;o++)t.push(e[o].value);var i=t.join(",");n.del(i)}},function(){t.showMeeting(n),t.initRoom(n)}()}angular.module("app").controller("roomCtrl",e),e.$inject=["$location","roomSvc","$scope","$state"]}(),function(){"use strict";function e(e,t,o){var i=this;i.title="添加会议室预定",i.isuserExist=!1,i.id=o.params.id,i.id&&(i.isUpdate=!0,i.title="更新会议室"),function(){i.isUpdate&&t.getroomById(i)}()}angular.module("app").controller("roomEditCtrl",e),e.$inject=["$location","roomSvc","$state"]}(),function(){"use strict";function e(e){function t(t){if(t.model.id=$("#id").val(),t.model.rbName=$("#rbName").val(),t.model.mrID=$("#mrID").val(),t.model.rbType=$("#rbType").val(),t.model.host=$("#host").val(),t.model.dueToPeople=$("#dueToPeople").val(),t.model.rbDay=$("#rbDay").val(),t.model.beginTime=$("#beginTime").val(),t.model.endTime=$("#endTime").val(),t.model.content=$("#content").val(),t.model.content=$("#remark").val(),common.initJqValidation($("#formRoom")),$("#formRoom").valid()){t.iscommit=!0;var o={method:"put",url:rootPath+"/room/updateRoom",data:t.model},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}})}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}}function o(t){if(common.initJqValidation($("#formRoom")),$("#formRoom").valid()){var o={method:"post",url:rootPath+"/room/addRoom",data:t.model},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}})}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}}function i(t){var o=new kendo.data.SchedulerDataSource({batch:!0,sync:function(){this.read()},transport:{read:function(t){var o=t.data.mrID,i=rootPath+"/room";o&&(i+="?"+o),e.get(i).success(function(e){t.success(e.value)}).error(function(e){console.log("查询数据失败！")})},create:function(o){if(common.initJqValidation($("#formRoom")),$("#formRoom").valid()){var i=o.data.models[0];if(i.rbDay=$("#rbDay").val(),i.beginTimeStr=$("#beginTime").val(),i.endTimeStr=$("#endTime").val(),i.beginTime=$("#rbDay").val()+" "+$("#beginTime").val()+":00",i.endTime=$("#rbDay").val()+" "+$("#endTime").val()+":00",t.workProgramId&&(i.workProgramId=t.workProgramId),new Date(i.endTime)<new Date(i.beginTime))return void $("#errorTime").html("开始时间不能大于结束时间!");var n={method:"post",url:rootPath+"/room/addRoom",data:i},r=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){a(t),$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),t.schedulerOptions.cancelEvent()}})}})};common.http({vm:t,$http:e,httpOptions:n,success:r})}},update:function(o){if(common.initJqValidation($("#formRoom")),$("#formRoom").valid()){var i=o.data.models[0];if(i.rbDay=$("#rbDay").val(),i.beginTimeStr=$("#beginTime").val(),i.endTimeStr=$("#endTime").val(),i.beginTime=$("#rbDay").val()+" "+$("#beginTime").val()+":00",i.endTime=$("#rbDay").val()+" "+$("#endTime").val()+":00",new Date(i.endTime)<new Date(i.beginTime))return void $("#errorTime").html("开始时间不能大于结束时间!");var n={method:"put",url:rootPath+"/room/updateRoom",data:i},r=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){a(t),$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),t.schedulerOptions.cancelEvent()}})}})};common.http({vm:t,$http:e,httpOptions:n,success:r})}},destroy:function(o){var i=o.data.models[0].id,n={method:"delete",url:d,data:i},a=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"删除成功",closeDialog:!0})}})};common.http({vm:t,$http:e,httpOptions:n,success:a})},parameterMap:function(e,t){if(console.log(t),"read"!==t&&e.models)return{models:kendo.stringify(e.models)}}},serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,schema:{model:{id:"taskId",fields:{taskId:{from:"id"},title:{from:"addressName",defaultValue:"会议室"},start:{type:"date",from:"beginTime"},end:{type:"date",from:"endTime"}}}}});t.schedulerOptions={date:new Date,startTime:t.startDateTime,endTime:t.endDateTime,height:600,views:["day","workWeek",{type:"week",selected:!0},"month","agenda"],editable:{template:$("#customEditorTemplate").html()},eventTemplate:$("#event-template").html(),timezone:"Etc/UTC",dataSource:o,footer:!1}}function n(t){e.get(d+"/meeting").success(function(e){t.meetings={},t.meetings=e,t.meetings&&t.meetings.length>0&&(t.mrID=t.meetings[0].id,a(t))}).error(function(e){})}function a(e){e.mrID?e.schedulerOptions.dataSource.read({mrID:common.format("$filter=mrID eq '{0}'",e.mrID)}):e.schedulerOptions.dataSource.read()}function r(){window.open(d+"/exports")}function s(){window.open(d+"/exportWeek")}function c(){window.open(d+"/exportNextWeek")}function l(){window.open(d+"/stageNextWeek")}var d=rootPath+"/room";return{initRoom:i,showMeeting:n,findMeeting:a,exportWeek:r,exportThisWeek:s,exportNextWeek:c,stageNextWeek:l,addRoom:o,editRoom:t}}angular.module("app").factory("roomSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,o){var i=this;i.model={},i.title="新增收文",i.create=function(){t.createSign(i)}}angular.module("app").controller("signCreateCtrl",e),e.$inject=["$location","signSvc","$state"]}(),function(){"use strict";function e(e,t,o,i,n){var a=this;a.title="收文列表",t.grid(a),a.querySign=function(){t.querySign(a)},a.del=function(e){common.confirm({vm:a,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteSign(a,e)}})},a.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:a,msg:"请选择数据"});else{for(var t=[],o=0;o<e.length;o++)t.push(e[o].value);var i=t.join(",");a.del(i)}},a.startFlow=function(e){common.confirm({vm:a,title:"",msg:"发起流程后，将不能对信息进行修改，确认发起流程么？",fn:function(){$(".confirmDialog").modal("hide"),t.startFlow(a,e)}})},a.stopFlow=function(e){common.confirm({vm:a,title:"",msg:"停止流程后，将无法对流程环节进行操作，确认停止么？",fn:function(){$(".confirmDialog").modal("hide"),i.suspend(a,e)}})},a.restartFlow=function(e){common.confirm({vm:a,title:"",msg:"确认重启流程么？",fn:function(){$(".confirmDialog").modal("hide"),i.activeFlow(a,e)}})},a.startNewFlow=function(e){common.confirm({vm:a,title:"",msg:"确认签收完成了么？",fn:function(){$(".confirmDialog").modal("hide"),n.startFlow(a,e)}})}}angular.module("app").controller("signCtrl",e),e.$inject=["$location","signSvc","$state","flowSvc","signFlowSvc"]}(),function(){"use strict";function e(e,t,o,i){var n=this;n.model={},n.title="填写报审登记表",n.model.signid=o.params.signid,n.flowDeal=!1,t.initFillData(n),n.signPreview=function(e){e<5||window.print()},n.signDownload=function(e){t.signDownload(n,e)},n.delsSysFile=function(e){t.deleteSysFile(n,e)},n.commonUploadWin=function(){common.initcommonUploadWin({businessId:n.model.signid})},n.signQuery=function(){common.initcommonQueryWin(n),n.sysSignId=n.model.signid,common.commonSysFilelist(n,i)},n.commonDelSysFile=function(e){common.commonDelSysFile(n,e,i)},n.commonDownloadSysFile=function(e){common.commonDownloadFile(n,e)},n.selecedMDUN=function(){n.model.maindeptName||common.alert({vm:n,msg:"请先填写主办处室",fn:function(){n.isSubmit=!1,$(".alertDialog").modal("hide")}})},n.selectADUN=function(){n.model.assistdeptName||common.alert({vm:n,msg:"请先填写主办处室",fn:function(){n.isSubmit=!1,$(".alertDialog").modal("hide")}})},n.signUpload=function(){$("#signUploadWin").kendoWindow({width:"660px",height:"400px",title:"附件上传",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},n.signJquery=function(){$("#signAttachments").kendoWindow({width:"800px",height:"400px",title:"查看附件",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open(),t.initFillData(n)},n.updateFillin=function(){t.updateFillin(n)},n.findOfficeUsersByDeptName=function(e){t.findOfficeUsersByDeptName(n,e)}}angular.module("app").controller("signFillinCtrl",e),e.$inject=["$location","signSvc","$state","$http"]}(),function(){"use strict";function e(e,t,o,i){var n=this;n.title="已办结项目详情",n.model={},n.flow={},n.model.signid=o.params.signid,n.flow.processInstanceId=o.params.processInstanceId,n.flow.hideFlowImg=!0,function(){$("#myTab li").click(function(e){var t=$("a",this);e.preventDefault(),t.tab("show");var o=t.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+o).addClass("active").addClass("in").show(500)}),i.initFlowData(n),t.endSignDetail(n)}()}angular.module("app").controller("signEndCtrl",e),e.$inject=["$location","signFlowSvc","$state","flowSvc"]}(),function(){"use strict";function e(e,t){function o(t,o){var i={method:"post",url:rootPath+"/sign/html/startNewFlow",params:{signid:o}},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.gridOptions.dataSource.read(),common.alert({vm:t,msg:"操作成功"})}})};common.http({vm:t,$http:e,httpOptions:i,success:n})}function i(e){switch(e.flow.curNode.activitiId){case"XMFZR_SP_GZFA1":e.businessTr=!0,e.MFLOW_XMFZR_SP_GZFA=!0,e.XMFZR_SP_GZFA=!0,e.MarkAndPay=!1,e.model.isreviewCompleted&&9==e.model.isreviewCompleted?(e.show_workprogram=!0,$("#show_workprogram_a").click(),e.directDisPatch=!1):e.directDisPatch=!0;break;case"XMFZR_SP_GZFA2":e.businessTr=!0,e.XMFZR_SP_GZFA=!0,e.MarkAndPay=!1,e.model.isreviewACompleted&&"9"==e.model.isreviewACompleted&&"9"==e.model.isNeedWrokPrograml&&(e.show_workprogram=!0,$("#show_workprogram_a").click());break;case"BZ_SP_GZAN1":case"FGLD_SP_GZFA1":case"BZ_SP_GZAN2":case"FGLD_SP_GZFA2":e.show_workprogram=!0,"9"==e.model.isNeedWrokPrograml&&$("#show_workprogram_a").click();break;case"FW_SQ":e.businessTr=!0,e.FW_SQ=!0,e.model.isDispatchCompleted&&0==e.model.isDispatchCompleted&&(e.show_dispatch=!0,$("#show_dispatch_a").click());break;case"BZ_SP_FW":case"FGLD_SP_FW":case"ZR_SP_FW":e.show_dispatch=!0,$("#show_dispatch_a").click();break;case"MFZR_GD":e.businessTr=!0,e.MFZR_GD=!0,e.model.filenum&&(e.show_filerecord=!0,$("#show_filerecord_a").click());break;case"AZFR_SP_GD":case"BMLD_QR_GD":e.show_filerecord=!0,$("#show_filerecord_a").click();break;case"XS_BMFB":e.principalUsers=[];break;case"XS_XMFZR_GZFA":e.businessTr=!0,e.XS_XMFZR_GZFA=!0,e.model.isreviewCompleted&&"9"==e.model.isreviewCompleted&&"9"==e.model.isNeedWrokPrograml&&$("#show_workprogram_a").click();break;case"XS_BZSP_GZFA":case"XS_FGLDSP_GZFA":"9"==e.model.isNeedWrokPrograml&&$("#show_workprogram_a").click();break;case"XS_FW":e.businessTr=!0,e.FW_SQ=!0,e.model.isDispatchCompleted&&9==e.model.isDispatchCompleted&&(e.show_dispatch=!0,$("#show_dispatch_a").click());break;case"XS_BZSP_FW":case"XS_FGLDSP_FW":case"XS_ZRSP_FW":e.show_dispatch=!0,$("#show_dispatch_a").click();break;case"XS_FZR_GD":e.businessTr=!0,e.MFZR_GD=!0,e.model.filenum&&(e.show_filerecord=!0,$("#show_filerecord_a").click());break;case"XS_FZR_SP":$("#show_filerecord_a").click()}}function n(e){e.flow.businessMap={};var t=0,o=!0;switch(e.flow.curNode.activitiId){case"ZHB_SP_SW":$("#viceDirector").val()?e.flow.businessMap.FGLD=$("#viceDirector").val():o=!1;break;case"FGLD_SP_SW":if($('.seleteTable input[selectType="main"]:checked').each(function(){e.flow.businessMap.hostdept=$(this).val(),t++}),0==t){o=!1;break}$('.seleteTable input[selectType="assist"]:checked').each(function(){e.flow.businessMap.assistdept=$(this).val()});break;case"BM_FB1":case"BM_FB2":if($('.seleteTable input[selectType="main"]:checked').each(function(){e.flow.businessMap.M_USER_ID=$(this).val(),t++}),0==t){o=!1;break}$('.seleteTable input[selectType="assist"]:checked').each(function(){e.flow.businessMap.A_USER_ID=$(this).val()});break;case"XMFZR_SP_GZFA1":e.directDisPatch?e.flow.businessMap.ZJFW=9:e.model.isNeedWrokPrograml&&"9"==e.model.isNeedWrokPrograml&&(o=!(!e.model.isreviewCompleted||9!=e.model.isreviewCompleted));break;case"XMFZR_SP_GZFA2":e.model.isNeedWrokPrograml&&"9"==e.model.isNeedWrokPrograml&&(o=!(!e.model.isreviewACompleted||9!=e.model.isreviewACompleted));break;case"BZ_SP_GZAN1":e.flow.businessMap.M_WP_ID=e.mainwork.id;break;case"BZ_SP_GZAN2":e.flow.businessMap.A_WP_ID=e.assistwork.id;break;case"FGLD_SP_GZFA1":e.flow.businessMap.M_WP_ID=e.mainwork.id;break;case"FGLD_SP_GZFA2":e.flow.businessMap.A_WP_ID=e.assistwork.id;break;case"FW_SQ":o=!(!e.model.isDispatchCompleted||9!=e.model.isDispatchCompleted||!e.model.docnum);break;case"BZ_SP_FW":case"FGLD_SP_FW":case"ZR_SP_FW":e.flow.businessMap.DIS_ID=e.dispatchDoc.id;break;case"MFZR_GD":o=!!e.model.filenum;break;case"XS_ZHBBL":$("#viceDirector").val()?e.flow.businessMap.FGLD=$("#viceDirector").val():o=!1;break;case"XS_FGLD_SP":$('#xs_table input[selectType="xs_main"]:checked').each(function(){e.flow.businessMap.deptid=$(this).val()}),e.flow.businessMap.deptid||(o=!1);break;case"XS_BMFB":if(angular.isUndefined(e.principalUsers)||0==e.principalUsers.length)o=!1;else{var i=0;e.principalUsers.forEach(function(e,t){9==e.isMainUser&&i++}),0==i||i>1?o=!1:e.flow.businessMap.PRINCIPAL=e.principalUsers}break;case"XS_XMFZR_GZFA":e.flow.businessMap.PSFA=e.model.isNeedWrokPrograml,!e.model.isNeedWrokPrograml||"9"!=e.model.isNeedWrokPrograml||e.mainwork&&e.mainwork.id||(o=!1);break;case"XS_BZSP_GZFA":case"XS_FGLDSP_GZFA":e.flow.businessMap.WP_ID=e.mainwork.id;break;case"XS_FW":o=!(!e.model.isDispatchCompleted||9!=e.model.isDispatchCompleted);break;case"XS_BZSP_FW":case"XS_FGLDSP_FW":case"XS_ZRSP_FW":e.flow.businessMap.DIS_ID=e.dispatchDoc.id;break;case"XS_FZR_GD":o=!!e.model.filenum}return o}function a(t,o){var i=1==o?"9":"0",n={method:"get",url:rootPath+"/workprogram/html/initWorkBySignId",params:{signId:t.model.signid,isMain:i}},a=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.work=e.data,$("#show_workprogram_a").click()}})};common.http({vm:t,$http:e,httpOptions:n,success:a})}function r(t){var o={method:"get",url:rootPath+"/dispatch/html/initDispatchBySignId",params:{signId:t.model.signid}},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.dispatchDoc=e.data,$("#show_dispatch_a").click()}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}function s(t){var o={method:"get",url:rootPath+"/fileRecord/html/initBySignId",params:{signId:t.model.signid}},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.fileRecord=e.data,$("#show_filerecord_a").click()}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}function c(t){var o={method:"get",url:rootPath+"/sign/html/initDetailPageData",params:{signid:t.model.signid,queryAll:!0}},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.model=e.data,t.model.workProgramDtoList&&t.model.workProgramDtoList.length>0&&(t.show_workprogram=!0,t.model.workProgramDtoList.forEach(function(e,o){9==e.isMain?(t.showMainwork=!0,t.mainwork={},t.mainwork=e):0==e.isMain&&(t.showAssistwork=!0,t.assistwork={},t.assistwork=e)})),t.model.dispatchDocDto&&(t.show_dispatch=!0,t.dispatchDoc=t.model.dispatchDocDto),t.model.fileRecordDto&&(t.show_filerecord=!0,t.fileRecord=t.model.fileRecordDto)}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}return{startFlow:o,initBusinessParams:i,checkBusinessFill:n,getChargeWorkProgram:a,getChargeDispatch:r,getChargeFilerecord:s,endSignDetail:c}}angular.module("app").factory("signFlowSvc",e),e.$inject=["$http","$state"]}(),function(){"use strict";function e(e,t,o,i,n,a){var r=this;r.title="项目流程处理",r.model={},r.flow={},r.work={},r.dispatchDoc={},r.fileRecord={},r.model.signid=o.params.signid,r.flow.taskId=o.params.taskId,r.flow.processInstanceId=o.params.processInstanceId,r.dealFlow=!0,r.expertReview={},r.showExpertRemark=!1,r.showExpertpayment=!1,r.MarkAndPay=!0,r.directDisPatch=!1,function(){$("#myTab li").click(function(e){var t=$("a",this);e.preventDefault(),t.tab("show");var o=t.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+o).addClass("active").addClass("in").show(500)}),i.initFlowData(r),t.initFlowPageData(r),t.initAssociateSigns(r,r.model.signid),t.associateGrid(r)}(),r.editSelectExpert=function(e,t){r.expertReview.score=t,r.expertReview.expertId=e,i.gotoExpertmark(r)},r.closeEditMark=function(){window.parent.$("#expertmark").data("kendoWindow").close()},r.saveMark=function(){i.saveMark(r)},r.editpayment=function(e){r.expertReview.expertId=e,i.gotopayment(r)},r.countTaxes=function(){i.countTaxes(r)},
r.closeEditPay=function(){window.parent.$("#payment").data("kendoWindow").close()},r.savePayment=function(){i.savePayment(r)},r.ideaEdit=function(e){console.log(e),common.initIdeaData(r,a,e)},r.commitNextStep=function(){n.checkBusinessFill(r)?i.commit(r):common.alert({vm:r,msg:"请先完成相应的业务操作才能提交"})},r.commitBack=function(){i.rollBack(r)},r.deleteFlow=function(){common.confirm({vm:r,title:"",msg:"终止流程将无法恢复，确认挂起么？",fn:function(){$(".confirmDialog").modal("hide"),i.deleteFlow(r)}})},r.initDealUerByAcitiviId=function(){i.initDealUerByAcitiviId(r)},r.showBtByAcivitiId=function(e){return r.flow.curNodeAcivitiId==e},r.addWorkProgram=function(){o.go("workprogramEdit",{signid:r.model.signid})},r.addBaseWP=function(){o.go("workprogramBaseEdit",{signid:r.model.signid})},r.addDisPatch=function(){o.go("dispatchEdit",{signid:r.model.signid})},r.addDoFile=function(){o.go("fileRecordEdit",{signid:r.model.signid})},r.checkBox=function(e,t,o){var i=e.target,n=i.checked,a=i.value;n?$('.seleteTable input[selectType="'+t+'"]').each(function(){var e=$(this).attr("id"),i=$(this).attr("value");e!=t+"_"+a?($("#"+o+"_"+i).removeAttr("disabled"),$(this).removeAttr("checked")):$("#"+o+"_"+a).attr("disabled","disabled")}):$("#"+o+"_"+a).removeAttr("disabled")},r.checkBoxSingle=function(e,t){var o=e.target,i=o.checked,n=o.value;i?$('.seleteTable input[selectType="'+t+'"]').each(function(){var e=$(this).attr("id"),o=$(this).attr("value");e!=t+"_"+n?($("#"+disabletype+"_"+o).removeAttr("disabled"),$(this).removeAttr("checked")):$("#"+disabletype+"_"+n).attr("disabled","disabled")}):$("#"+disabletype+"_"+n).removeAttr("disabled")},r.checkBoxSingle=function(e,t){var o=e.target,i=o.checked,n=o.value;i&&$('#xs_table input[selectType="'+t+'"]').each(function(){$(this).attr("id");$(this).attr("value")!=n&&$(this).removeAttr("checked")})},r.showAssociate=function(){r.currentAssociateSign=r.model,t.showAssociateSign()},r.saveAssociateSign=function(e){var i=r.model.signid;if(i==e)return void common.alert({vm:r,msg:"不能关联自身项目",closeDialog:!0,fn:function(){}});t.saveAssociateSign(r,i,e,function(){o.reload()})},r.disAssociateSign=function(){t.saveAssociateSign(r,r.model.signid,null,function(){o.reload()})},r.addPriUser=function(){var e=$("#xs_bmfb input[name='unSelPriUser']:checked");if(e.length<1)common.alert({vm:r,msg:"请选择负责人"});else{if(9==r.isMainPriUser&&e.length>1)return void common.alert({vm:r,msg:"总负责人只能选一个"});if(0==r.isSelMainPriUser&&(angular.isUndefined(r.isMainPriUser)||0==r.isMainPriUser))return void common.alert({vm:r,msg:"请先选择总负责人！"});if(1==r.isSelMainPriUser&&9==r.isMainPriUser)return void common.alert({vm:r,msg:"你已经选择了一个总负责人，不能再次选择负责人"});if(r.principalUsers&&r.principalUsers.length+e.length>3)return void common.alert({vm:r,msg:"最多只能选择3个负责人，请重新选择！"});for(var t=0;t<e.length;t++){var o={};o.userId=e[t].value,o.userType=$("#userType").val(),9==r.isMainPriUser?(r.isSelMainPriUser=!0,o.isMainUser=9,r.isMainPriUser):o.isMainUser=0,r.xsusers.forEach(function(i,n){i.id==e[t].value&&(i.isSelected=!0,o.userName=i.loginName)}),r.principalUsers.push(o)}}},r.delPriUser=function(){var e=$("#xs_bmfb input[name='selPriUser']:checked");if(e.length<1)common.alert({vm:r,msg:"请选择取消的负责人"});else for(var t=0;t<e.length;t++)r.xsusers.forEach(function(o,i){o.id==e[t].value&&(o.isSelected=!1)}),r.principalUsers.forEach(function(o,i){o.userId==e[t].value&&(9==o.isMainUser&&(r.isSelMainPriUser=!1),r.principalUsers.splice(i,1))})},r.checkNeedWP=function(e){var o=e.target,i=o.checked;i?r.mainwork&&r.mainwork.id&&common.confirm({vm:r,title:"",msg:"取消会对填报的工作方案进行删除，确认删除么？",fn:function(){$(".confirmDialog").modal("hide"),t.removeWP(r)},cancel:function(){o.checked=!i,r.model.isNeedWrokPrograml="9",$(".confirmDialog").modal("hide")}}):r.model.isNeedWrokPrograml="9"}}angular.module("app").controller("signFlowDealCtrl",e),e.$inject=["$location","signSvc","$state","flowSvc","signFlowSvc","$http"]}(),function(){"use strict";function e(e,t,o,i,n){var a=this;a.title="项目流程信息",a.model={},a.flow={},a.work={},a.dispatchDoc={},a.fileRecord={},a.model.signid=o.params.signid,a.flow.taskId=o.params.taskId,a.flow.processInstanceId=o.params.processInstanceId,function(){$("#myTab li").click(function(e){var t=$("a",this);e.preventDefault(),t.tab("show");var o=t.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+o).addClass("active").addClass("in").show(500)}),i.initFlowData(a),t.initFlowPageData(a)}()}angular.module("app").controller("signFlowDetailCtrl",e),e.$inject=["$location","signSvc","$state","flowSvc","signFlowSvc"]}(),function(){"use strict";function e(e,t,o,i){var n=this;n.model={},n.title="查看详情信息",n.model.signid=o.params.signid,function(){$("#myTab li").click(function(e){var t=$("a",this);e.preventDefault(),t.tab("show");var o=t.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+o).addClass("active").addClass("in").show(500)}),t.initFlowPageData(n),t.initAssociateSigns(n,n.model.signid),o.params.processInstanceId&&(n.flow={},n.flow.processInstanceId=o.params.processInstanceId,i.initFlowData(n))}()}angular.module("app").controller("signDetailsCtrl",e),e.$inject=["$location","signSvc","$state","flowSvc"]}(),function(){"use strict";function e(e,t,o){function i(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/sign/fingByOData",$("#searchform"),{filter:"issign eq (isNull,0)"}),schema:common.kendoGridConfig().schema({id:"signid",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.signid)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"projectname",title:"项目名称",width:160,filterable:!1},{field:"projectcode",title:"收文编号",width:160,filterable:!1},{field:"designcompanyName",title:"项目单位",width:200,filterable:!1},{field:"reviewstage",title:"项目阶段",width:160,filterable:!1},{field:"projectcode",title:"项目代码",width:160,filterable:!1},{field:"receivedate",title:"收文时间",width:160,filterable:!1,format:"{0:yyyy/MM/dd HH:mm:ss}"},{field:"",title:"流程状态",width:160,filterable:!1,template:function(e){return e.folwState?1==e.folwState?'<span style="color:green;">进行中</span>':2==e.folwState?'<span style="color:orange;">已暂停</span>':8==e.folwState?'<span style="color:red;">强制结束</span>':9==e.folwState?'<span style="color:blue;">已完成</span>':void 0:"未发起"}},{field:"",title:"操作",width:180,template:function(e){var t=!1,o=!0,i=!0;return e.folwState&&e.folwState>0&&(t=!0,1==e.folwState&&(o=!1),2==e.folwState&&(i=!1)),common.format($("#columnBtns").html(),e.signid,e.folwState,e.signid+"/"+e.processInstanceId,"vm.del('"+e.signid+"')",t,"vm.startNewFlow('"+e.signid+"')",t,"vm.stopFlow('"+e.signid+"')",o,"vm.restartFlow('"+e.signid+"')",i)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,resizable:!0}}function n(e){e.gridOptions.dataSource.read()}function a(o){if(common.initJqValidation(),$("form").valid()){var i={method:"post",url:rootPath+"/sign",data:o.model},n=function(e){common.requestSuccess({vm:o,response:e,fn:function(){common.alert({vm:o,msg:"操作成功,请继续填写报审登记表！",closeDialog:!0,fn:function(){t.go("fillSign",{signid:e.data.signid},{reload:!0})}})}})};common.http({vm:o,$http:e,httpOptions:i,success:n})}}function r(t,o){var i={};"main"==o?i.maindeptName=t.model.maindeptName:i.assistdeptName=t.model.assistdeptName;var n={method:"post",url:rootPath+"/officeUser/findOfficeUsersByDeptName",data:i},a=function(e){common.requestSuccess({vm:t,response:e,fn:function(){"main"==o?(t.mainOfficeList={},t.mainOfficeList=e.data):(t.assistOfficeList={},t.assistOfficeList=e.data)}})};common.http({vm:t,$http:e,httpOptions:n,success:a})}function s(t){if(common.initJqValidation($("#sign_fill_form")),$("#sign_fill_form").valid()){var o={method:"put",url:rootPath+"/sign",data:t.model},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}}function c(t,o){t.isSubmit=!0;var i={method:"delete",url:rootPath+"/sign",data:o},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})};common.http({vm:t,$http:e,httpOptions:i,success:n})}function l(t){var o={method:"get",url:rootPath+"/sign/html/initFillPageData",params:{signid:t.model.signid}},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.model=e.data.sign,t.deptlist=e.data.deptlist,e.data.mainOfficeList&&(t.mainOfficeList=e.data.mainOfficeList),e.data.assistOfficeList&&(t.assistOfficeList=e.data.assistOfficeList),t.builtcomlist=e.data.builtcomlist,t.designcomlist=e.data.designcomlist}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}function d(t){var o={method:"get",url:rootPath+"/sign/html/initDetailPageData",params:{signid:t.model.signid}},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.model=e.data}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}function m(t){var i={method:"get",url:rootPath+"/sign/html/initFlowPageData",params:{signid:t.model.signid,queryAll:!0}},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.model=e.data,t.model.workProgramDtoList&&t.model.workProgramDtoList.length>0&&(t.show_workprogram=!0,t.model.workProgramDtoList.forEach(function(e,o){9==e.isMain?(t.showMainwork=!0,t.mainwork={},t.mainwork=e):0==e.isMain&&(t.showAssistwork=!0,t.assistwork={},t.assistwork=e)})),t.model.dispatchDocDto&&(t.show_dispatch=!0,t.dispatchDoc=t.model.dispatchDocDto),t.model.fileRecordDto&&(t.show_filerecord=!0,t.fileRecord=t.model.fileRecordDto),t.model.expertSelectedDtoList&&t.model.expertSelectedDtoList.length>0&&(t.show_expert=!0),t.dealFlow&&o.getFlowInfo(t)}})};common.http({vm:t,$http:e,httpOptions:i,success:n})}function u(t){var o={method:"delete",url:rootPath+"/workprogram/deleteBySignId",params:{signId:t.model.signid}},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,t.model.isNeedWrokPrograml="0",$(".alertDialog").modal("hide"),m(t)}})}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}function f(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/sign/fingByOData",$("#searchform")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=[{field:"projectname",title:"项目名称",width:160,filterable:!1},{field:"projectcode",title:"收文编号",width:140,filterable:!1},{field:"designcompanyName",title:"项目单位",width:200,filterable:!1},{field:"reviewstage",title:"项目阶段",width:160,filterable:!1},{field:"projectcode",title:"项目代码",width:140,filterable:!1},{field:"",title:"操作",width:180,template:function(e){return common.format($("#associateColumnBtns").html(),"vm.saveAssociateSign('"+e.signid+"')")}}];e.associateGridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,resizable:!0},e.associateGridOptions.dataSource.read()}function p(t,o,i,n){i="undefined"==i?null:i;var a={method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},url:rootPath+"/sign/associate",data:$.param({signId:o,associateId:i},!0)},r=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:void 0!=i?"项目关联成功":"项目解除关联成功",closeDialog:!0,fn:function(){void 0!=n&&"function"==typeof n&&n()}})}})};common.http({vm:t,$http:e,httpOptions:a,success:r})}function h(t,o){var i={method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded"},url:rootPath+"/sign/associate?signId="+o},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){if(void 0!=e.data){t.associateSign=e.data;for(var o=e.data,i="",n=o.length-1;n>=0;n--){var a=o[n],r=a.signdate||"";i+='<div class="intro-list"><div class="intro-list-left">项目阶段：'+a.reviewstage+"<br/>签收时间："+r+'</div><div class="intro-list-right"><span></span><div class="intro-list-content">名称：<span style="color:red;">'+a.projectname+'</span><br/>送件人：<span style="color:red;">'+a.sendusersign+"</span><br/></div></div></div>"}$("#introFlow").html(i);$("#myStep").step({animate:!0,initStep:1,speed:1e3})}}})};common.http({vm:t,$http:e,httpOptions:i,success:n})}function g(){$("#associateWindow").kendoWindow({width:"50%",height:"80%",title:"项目关联",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()}return{grid:i,querySign:n,createSign:a,initFillData:l,initDetailData:d,updateFillin:s,deleteSign:c,findOfficeUsersByDeptName:r,initFlowPageData:m,removeWP:u,associateGrid:f,saveAssociateSign:p,initAssociateSigns:h,showAssociateSign:g}}angular.module("app").factory("signSvc",e),e.$inject=["$http","$state","flowSvc"]}(),function(){"use strict";function e(e,t){var o=this;o.model={},o.title="系统配置",function(){t.queryList(o)}(),o.addConfig=function(){o.model={},$("#configdiv").kendoWindow({width:"700px",height:"440px",title:"参数编辑",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},o.closeWin=function(){window.parent.$("#configdiv").data("kendoWindow").close()},o.doCommit=function(){common.initJqValidation(),$("#configForm").valid()&&t.saveConfig(o)},o.editConfig=function(e){o.configList.forEach(function(t,i){t.id==e&&(o.model=t)}),$("#configdiv").kendoWindow({width:"700px",height:"440px",title:"参数编辑",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},o.del=function(e){var i=$("input[name='configid']:checked");i.length<1?common.alert({vm:o,msg:"请选择删除的参数"}):common.confirm({vm:o,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide");for(var e=[],n=0;n<i.length;n++)e.push(i[n].value);t.deleteConfig(o,e.join(","))}})}}angular.module("app").controller("sysConfigCtrl",e),e.$inject=["$location","sysConfigSvc"]}(),function(){"use strict";function e(e){function t(t){var o={method:"get",url:rootPath+"/sysConfig/queryList"},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.configList=new Array,t.configList=e.data}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}function o(o,i){var n={method:"delete",url:rootPath+"/sysConfig",params:{id:i}},a=function(e){common.requestSuccess({vm:o,response:e,fn:function(){common.alert({vm:o,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),o.isSubmit=!1,t(o)}})}})};common.http({vm:o,$http:e,httpOptions:n,success:a})}function i(o){var i={method:"post",url:rootPath+"/sysConfig",data:o.model},n=function(e){common.requestSuccess({vm:o,response:e,fn:function(){common.alert({vm:o,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),o.isSubmit=!1,t(o)}})}})};common.http({vm:o,$http:e,httpOptions:i,success:n})}return{queryList:t,deleteConfig:o,saveConfig:i}}angular.module("app").factory("sysConfigSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t){var o=this;o.title="用户列表",o.del=function(e){common.confirm({vm:o,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteUser(o,e)}})},o.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:o,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var n=t.join(",");o.del(n)}},o.queryUser=function(){t.queryUser(o)},function(){t.grid(o)}()}angular.module("app").controller("userCtrl",e),e.$inject=["$location","userSvc"]}(),function(){"use strict";function e(e,t,o){var i=this;i.title="添加用户",i.isuserExist=!1,i.id=o.params.id,i.id&&(i.isUpdate=!0,i.title="更新用户"),i.create=function(){t.createUser(i)},i.update=function(){t.updateUser(i)},function(){i.isUpdate?t.getUserById(i):t.initZtreeClient(i),t.getOrg(i)}()}angular.module("app").controller("userEditCtrl",e),e.$inject=["$location","userSvc","$state"]}(),function(){"use strict";function e(e){function t(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0,t.model.id=t.id;var o=l(),i=$linq(o).where(function(e){return 0==e.isParent}).select(function(e){return{id:e.id,roleName:e.name}}).toArray();t.model.roles=i;var n={method:"put",url:m,data:t.model},a=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:t,$http:e,httpOptions:n,success:a})}}function o(t,o){t.isSubmit=!0;var i={method:"delete",url:m,data:o},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})};common.http({vm:t,$http:e,httpOptions:i,success:n})}function i(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0;var o=l(),i=$linq(o).where(function(e){return 0==e.isParent}).select(function(e){return{id:e.id,roleName:e.name}}).toArray();t.model.roles=i;var n={method:"post",url:m,data:t.model},a=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=u}})}})};common.http({vm:t,$http:e,httpOptions:n,success:a})}}function n(t){var o={method:"get",url:common.format(m+"/getOrg")},i=function(e){t.org={},t.org=e.data};common.http({vm:t,$http:e,httpOptions:o,success:i})}function a(t){var o={method:"post",url:f},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){var o={check:{chkboxType:{Y:"ps",N:"ps"},enable:!0}},i=$linq(e.data.value).select(function(e){return{id:e.id,name:e.roleName}}).toArray(),n={id:"",name:"角色集合",children:i};$.fn.zTree.init($("#zTree"),o,n),t.isUpdate&&d(t)}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}function r(t){var o={method:"POST",url:common.format(m+"/fingByOData?$filter=id eq '{0}'",t.id)},i=function(e){t.model=e.data.value[0],t.isUpdate&&a(t)};common.http({vm:t,$http:e,httpOptions:o,success:i})}function s(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(m+"/fingByOData?$orderby=userSort",$("#usersform")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"},modifiedDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=function(){var e=this.items(),t=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*o,i=$(this).find(".row-number");$(i).html(e)})},i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:70,filterable:!1,template:"<span class='row-number'></span>"},{field:"loginName",title:"登录名",width:100,filterable:!1},{field:"displayName",title:"显示名",width:100,filterable:!1},{field:"userMPhone",title:"联系手机",width:120,filterable:!1},{field:"orgDto.name",title:"所属部门",width:100,filterable:!1},{field:"userIP",title:"登录IP",width:160,filterable:!1},{field:"lastLogin",title:"最后登录时间",width:160,filterable:!1},{field:"",title:"所属角色",width:160,filterable:!1,template:function(e){if(e.roles){for(var t="",o=0,i=e.roles.length;o<i;o++)t+=0==o?e.roles[o].roleName:", "+e.roles[o].roleName;return t}return" "}},{field:"",title:"操作",width:140,template:function(e){return common.format($("#columnBtns").html(),"vm.del('"+e.id+"')",e.id)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:o,resizable:!0}}function c(e){e.gridOptions.dataSource.read()}function l(){return $.fn.zTree.getZTreeObj("zTree").getCheckedNodes(!0)}function d(e){for(var t=$.fn.zTree.getZTreeObj("zTree"),o=$linq(e.model.roles).select(function(e){return e.roleName}).toArray(),i=t.getNodesByParam("level",1,null),n=$linq(i).where(function(e){return $linq(o).contains(e.name)}).toArray(),a=0,r=n.length;a<r;a++)t.checkNode(n[a],!0,!0)}var m=rootPath+"/user",u="#/user",f=rootPath+"/role/fingByOData";rootPath;return{grid:s,getUserById:r,initZtreeClient:a,createUser:i,deleteUser:o,updateUser:t,getOrg:n,queryUser:c}}angular.module("app").factory("userSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,o,i){var n=this;n.work={},n.title="项目基本信息",n.work.signId=o.params.signid,function(){t.initPage(n)}(),n.create=function(){t.createWP(n,!1)}}angular.module("app").controller("workprogramBaseEditCtrl",e),e.$inject=["$location","workprogramSvc","$state","$http"]}(),function(){"use strict";function e(e,t,o,i){var n=this;n.work={},n.title="创建评审方案",n.startDateTime=new Date("2006/6/1 08:00"),n.endDateTime=new Date("2030/6/1 21:00"),n.work.signId=o.params.signid,n.linkSignId=" ",n.sign={},n.isRoomBook=!1,n.isHavePre=!1,n.isHaveNext=!1,n.isHideProject=!0,n.isHideProject2=!0,function(){t.getInitRelateData(n),t.initPage(n),t.findAllMeeting(n),t.findCompanys(n)}(),n.workJquery=function(){common.initcommonQueryWin(n),n.sysSignId=n.work.id,common.commonSysFilelist(n,i)},n.workUpload=function(e){common.initcommonUploadWin({businessId:n.work.id})},n.commonDelSysFile=function(e){common.commonDelSysFile(n,e,i)},n.commonDownloadSysFile=function(e){common.commonDownloadFile(n,e)},n.formResetWork=function(){$("#searchformi").find("input,select").val("")},n.searchWorkSign=function(){t.waitProjects(n)},n.onWorkClose=function(){window.parent.$(".workPro").data("kendoWindow").close()},n.mergeAddWork=function(){t.mergeAddWork(n)},n.reviewType=function(){if("1"==n.work.isSigle);if(n.work.isSigle==n.work.isMainProject){common.confirm({vm:n,title:"",msg:"该项目已经关联其他合并评审会关联，您确定要改为单个评审吗？",fn:function(){$(".confirmDialog").modal("hide")}})}},n.mainIschecked=function(){n.isHideProject2=!1},n.subIschecked=function(){},n.gotoProjcet=function(){t.gotoProjcet(n)},n.selectworkProject=function(){t.selectworkProject(n)},n.cancelworkProject=function(){t.cancelworkProject(n)},n.addTimeStage=function(){n.isRoomBook?$("#stageWindow").kendoWindow({width:"660px",height:"550px",title:"会议预定添加",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open():n.work.id?o.go("room",{workProgramId:n.work.id}):common.alert({vm:n,msg:"请先保存，再选择评审会日期！"})},n.saveRoom=function(){t.saveRoom(n)},n.gotoRoom=function(){window.parent.$("#stageWindow").data("kendoWindow").close(),n.work.id?o.go("room",{workProgramId:n.work.id}):common.alert({vm:n,msg:"请先保存！"})},n.nextBookRoom=function(){var e=0;n.RoomBookings.forEach(function(t,o){t.id==n.roombook.id&&(e=o)}),n.isHavePre=!0,e==n.RoomBookings.length-2?n.isHaveNext=!1:n.isHaveNext=!0,n.roombook=n.RoomBookings[e+1]},n.preBookRoom=function(){var e=0;n.RoomBookings.forEach(function(t,o){t.id==n.roombook.id&&(e=o)}),n.isHaveNext=!0,n.isHavePre=1!=e,n.roombook=n.RoomBookings[e-1]},n.onRoomClose=function(){window.parent.$("#stageWindow").data("kendoWindow").close()},n.queryRoom=function(){t.queryRoom(n)},n.findUsersByOrgId=function(e){t.findUsersByOrgId(n,e)},n.create=function(){t.createWP(n)},n.selectExpert=function(){t.selectExpert(n)},n.findReviewDept=function(){}}angular.module("app").controller("workprogramEditCtrl",e),e.$inject=["$location","workprogramSvc","$state","$http"]}(),function(){"use strict";function e(e,t,o){function i(e){var o=e.work.id,i={method:"get",url:rootPath+"/workprogram/getInitSeleSignBysId",params:{bussnessId:o}},n=function(t){e.selectedSign=t.data.signDtoList,e.linkSignId=t.data.linkSignId};common.http({vm:e,$http:t,httpOptions:i,success:n})}function n(e){var o=e.work.signId,i={method:"post",url:rootPath+"/workprogram/getInitRelateData",params:{signid:o}},n=function(t){e.linkSignId=t.data.linkSignId,console.log(e.linkSignId),e.sysFiles=t.data.sysFilelist};common.http({vm:e,$http:t,httpOptions:i,success:n})}function a(e){var o={method:"get",url:rootPath+"/workprogram/mergeAddWork",params:{signId:e.work.signId,linkSignId:e.linkSignId}},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){window.parent.$(".workPro").data("kendoWindow").close(),common.alert({vm:e,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}})}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}function r(e){var o={method:"post",url:rootPath+"/workprogram/selectedProject",params:{linkSignIds:e.linkSignId}},i=function(t){e.selectedSign=t.data};common.http({vm:e,$http:t,httpOptions:o,success:i})}function s(e){e.sign.signid=e.linkSignId;var o={method:"post",url:common.format(S+"/waitProjects"),data:e.sign},i=function(t){e.signs={},e.signs=t.data,console.log(e.signs)};common.http({vm:e,$http:t,httpOptions:o,success:i})}function c(e){var t=e.linkSignId,o=$("input[name='checkcancel']:checked");o&&($.each(o,function(e,o){t=0==t.lastIndexOf(o.value)?t.replace(o.value,""):t.replace(","+o.value,"")}),e.linkSignId=t,r(e),s(e))}function l(e){var t=e.linkSignId,o=$("input[name='checkwork']:checked"),i=[];o&&($.each(o,function(e,t){i.push(t.value)}),t?t+=","+i.join(","):t=i.join(","),e.linkSignId=t,r(e),s(e))}function d(e){if(!e.work.id)return void common.alert({vm:e,msg:"请先保存再进行关联！",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}});$(".workPro").kendoWindow({width:"1200px",height:"630px",title:"合并评审",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open(),i(e),s(e)}function m(e){if(common.initJqValidation($("#stageForm")),$("#stageForm").valid()){if(e.roombook.workProgramId=e.work.id,e.roombook.stageOrg=e.work.reviewOrgName,e.roombook.stageProject="项目名称:"+e.work.projectName+":"+e.work.buildCompany+":"+e.work.reviewOrgName,e.roombook.beginTimeStr=$("#beginTime").val(),e.roombook.endTimeStr=$("#endTime").val(),$("#endTime").val()<$("#beginTime").val())return void $("#errorTime").html("开始时间不能大于结束时间!");e.roombook.beginTime=$("#rbDay").val()+" "+$("#beginTime").val()+":00",e.roombook.endTime=$("#rbDay").val()+" "+$("#endTime").val()+":00";var o={method:"post",url:rootPath+"/room/saveRoom",data:e.roombook},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){window.parent.$("#stageWindow").data("kendoWindow").close(),common.alert({vm:e,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}})}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}}function u(e){var o={method:"get",url:common.format(rootPath+"/room/meeting")},i=function(t){e.roombookings={},e.roombookings=t.data};common.http({vm:e,$http:t,httpOptions:o,success:i})}function f(e){var o={method:"get",url:common.format(w+"/findCcompanys")},i=function(t){e.companys={},e.companys=t.data};common.http({vm:e,$http:t,httpOptions:o,success:i})}function p(e,o){var i={};"main"==o&&(i.orgId=e.work.reviewDept);var n={method:"get",url:rootPath+"/user/findUsersByOrgId",params:i},a=function(t){common.requestSuccess({vm:e,response:t,fn:function(){"main"==o&&(e.mainUserList={},e.mainUserList=t.data)}})};common.http({vm:e,$http:t,httpOptions:n,success:a})}function h(e){var i={method:"get",url:rootPath+"/workprogram/html/initWorkBySignId",params:{signId:e.work.signId}},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){null!=t.data&&""!=t.data&&(e.work=t.data,e.work.signId=o.params.signid,t.data.roomBookingDtos&&t.data.roomBookingDtos.length>0&&(e.isRoomBook=!0,e.RoomBookings={},e.RoomBookings=t.data.roomBookingDtos,e.roombook=e.RoomBookings[0],e.RoomBookings.length>1&&(e.isHaveNext=!0)))}})};common.http({vm:e,$http:t,httpOptions:i,success:n})}function g(e,o){if(common.initJqValidation($("#work_program_form")),$("#work_program_form").valid()){e.iscommit=!0;var i={method:"post",url:rootPath+"/workprogram/addWork",data:e.work,params:{isNeedWorkProgram:o}},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.iscommit=!1,e.work.id=t.data.id,common.alert({vm:e,msg:"操作成功！",closeDialog:!0})}})};common.http({vm:e,$http:t,httpOptions:i,success:n,onError:function(t){e.iscommit=!1}})}}function v(e){e.work.id&&""!=e.work.id?o.go("expertReviewEdit",{workProgramId:e.work.id}):common.alert({vm:e,msg:"请先保存，再继续执行操作！"})}var w=(rootPath,rootPath+"/company"),S=rootPath+"/workprogram";return{initPage:h,createWP:g,findCompanys:f,findUsersByOrgId:p,selectExpert:v,saveRoom:m,findAllMeeting:u,gotoProjcet:d,waitProjects:s,selectedProject:r,selectworkProject:l,cancelworkProject:c,mergeAddWork:a,getInitSeleSignBysId:i,getInitRelateData:n}}angular.module("app").factory("workprogramSvc",e),e.$inject=["$rootScope","$http","$state"]}();