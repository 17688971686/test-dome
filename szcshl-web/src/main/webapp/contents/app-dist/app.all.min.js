!function(){"use strict";angular.module("app",["ui.router","kendo.directives","angular-loading-bar","ngAnimate","ngFileSaver","angular-toArrayFilter"]).filter("trust2Html",["$sce",function(t){return function(e){return t.trustAsHtml(e)}}]).filter("ntobr",function(){return function(e){if(e)return e.replace(/\n/g,"</br>").replace(/ /g,"&nbsp;")}}).filter("myFilter",function(){return function(e,i,t){var o=[],n=[];return t instanceof Array?n=t:n.push(t),angular.forEach(e,function(t){angular.forEach(n,function(e){t[i]==e&&o.push(t)})}),o}}).filter("unique",function(){return function(e,i){var o=[],n=[];return angular.forEach(e,function(e){var t=e[i];-1===n.indexOf(t)&&(n.push(t),o.push(e))}),o}}).filter("FormatStrDate",function(){return function(e){var t=new Date(e),i=t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,o=t.getDate()<10?"0"+t.getDate():t.getDate();return t.getFullYear()+"/"+i+"/"+o}}).config(["$stateProvider","$locationProvider","$urlRouterProvider","cfpLoadingBarProvider",function(e,t,i,o){t.hashPrefix(""),o.parentSelector="#loading-bar-container",o.spinnerTemplate='<div style="position:fixed;width:100%;height:100%;left:0;top:0; z-index:10001;background:rgba(0, 0, 0, 0.3);overflow: hidden;"><div style="position: absolute;top:30%; width: 400px;height:40px;left:50%;"><i class="fa fa-spinner fa-pulse fa-1x fa-fw"></i>数据加载中...</div></div>',i.otherwise("/welcome"),e.state("welcome",{url:"/welcome",templateUrl:rootPath+"/admin/welcome.html",controller:"adminWelComeCtrl",controllerAs:"vm"}).state("gtasks",{url:"/gtasks",templateUrl:rootPath+"/admin/gtasks.html",controller:"adminCtrl",controllerAs:"vm"}).state("agendaTasks",{url:"/agendaTasks",templateUrl:rootPath+"/admin/agendaTasks.html",controller:"adminAgendaCtrl",controllerAs:"vm"}).state("doingTasks",{url:"/doingTasks",templateUrl:rootPath+"/admin/doingTasks.html",controller:"adminDoTaskCtrl",controllerAs:"vm"}).state("flowDeal",{url:"/flowDeal/:businessKey/:processKey/:taskId/:instanceId",templateUrl:function(e){return rootPath+"/flow/flowDeal/"+e.processKey+".html"},controller:"flowDealCtrl",controllerAs:"vm"}).state("flowDetail",{url:"/flowDetail/:businessKey/:processKey/:taskId/:instanceId",templateUrl:function(e){return rootPath+"/flow/flowDetail/"+e.processKey+".html"},controller:"flowDetailCtrl",controllerAs:"vm"}).state("flowEnd",{url:"/flowEnd/:businessKey/:processKey/:instanceId",templateUrl:function(e){return rootPath+"/flow/flowEnd/"+e.processKey+".html"},controller:"flowEndCtrl",controllerAs:"vm"}).state("addSupp",{url:"/addSupp/:businessId/:businessType/:isControl",templateUrl:rootPath+"/addSuppLetter/edit.html",controller:"addSuppLetterCtrl",controllerAs:"vm"}).state("addSuppletterList",{url:"/addSuppletterList/:businessId",templateUrl:rootPath+"/addSuppLetter/list.html",controller:"addSuppLetterListCtrl",controllerAs:"vm"}).state("addSuppLetterEdit",{url:"/addSuppLetterEdit/:id",templateUrl:rootPath+"/addSuppLetter/editUpload.html",controller:"addSuppLetterEditCtrl",controllerAs:"vm"}).state("suppLetterView",{url:"/suppLetterView/:id",templateUrl:rootPath+"/addSuppLetter/view.html",controller:"suppLetterViewCtrl",controllerAs:"vm"}).state("suppletterList",{url:"/suppletterList",templateUrl:rootPath+"/addSuppLetter/html/suppLetterList.html",controller:"addSuppLetterQueryCtrl",controllerAs:"vm"}).state("querySuppLetterDetail",{url:"/querySuppLetterDetail/:id",templateUrl:rootPath+"/addSuppLetter/detail.html",controller:"addSuppLetterQueryEditCtrl",controllerAs:"vm"}).state("suppLetterApproveEdit",{url:"/suppLetterApproveEdit/:id",templateUrl:rootPath+"/addSuppLetter/suppLetterApproveEdit.html",controller:"addSuppLetterQueryEditCtrl",controllerAs:"vm"}).state("registerFile",{url:"/registerFile/:businessId",templateUrl:rootPath+"/addRegisterFile/list.html",controller:"addRegisterFileCtrl",controllerAs:"vm"}).state("dtasks",{url:"/dtasks",templateUrl:rootPath+"/admin/dtasks.html",controller:"adminDoingCtrl",controllerAs:"vm"}).state("personDtasks",{url:"/personDtasks",templateUrl:rootPath+"/sign/personDtasks.html",controller:"adminPersonDoingCtrl",controllerAs:"vm"}).state("etasks",{url:"/etasks",templateUrl:rootPath+"/sign/etasks.html",controller:"adminEndCtrl",controllerAs:"vm"}).state("role",{url:"/role",templateUrl:rootPath+"/role/html/list.html",controller:"roleCtrl",controllerAs:"vm"}).state("roleEdit",{url:"/roleEdit/:id",templateUrl:rootPath+"/role/html/edit.html",controller:"roleEditCtrl",controllerAs:"vm"}).state("user",{url:"/user",templateUrl:rootPath+"/user/html/list.html",controller:"userCtrl",controllerAs:"vm"}).state("userEdit",{url:"/userEdit/:id",templateUrl:rootPath+"/user/html/edit.html",controller:"userEditCtrl",controllerAs:"vm"}).state("org",{url:"/org",templateUrl:rootPath+"/org/html/list.html",controller:"orgCtrl",controllerAs:"vm"}).state("orgEdit",{url:"/orgEdit/:id",templateUrl:rootPath+"/org/html/edit.html",controller:"orgEditCtrl",controllerAs:"vm"}).state("orgUser",{url:"/orgUser/:id",templateUrl:rootPath+"/org/html/orgUser.html",controller:"orgUserCtrl",controllerAs:"vm"}).state("sysdept",{url:"/sysdept",templateUrl:rootPath+"/sysdept/html/list.html",controller:"sysdeptCtrl",controllerAs:"vm"}).state("sysdeptEdit",{url:"/sysdeptEdit/:id",templateUrl:rootPath+"/sysdept/html/edit.html",controller:"sysdeptEditCtrl",controllerAs:"vm"}).state("sysdeptUser",{url:"/sysdeptUser/:id",templateUrl:rootPath+"/sysdept/html/sysdeptUser.html",controller:"sysdeptUserCtrl",controllerAs:"vm"}).state("log",{url:"/log",templateUrl:rootPath+"/log/html/list.html",controller:"logCtrl",controllerAs:"vm"}).state("logFgw",{url:"/logFgw",templateUrl:rootPath+"/log/html/fgwSignLog.html",controller:"logFgwCtrl",controllerAs:"vm"}).state("smslog",{url:"/smslog",templateUrl:rootPath+"/smslog/html/list.html",controller:"smslogCtrl",controllerAs:"vm"}).state("config",{url:"/config",templateUrl:rootPath+"/sysConfig/html/list.html",controller:"sysConfigCtrl",controllerAs:"vm"}).state("upload",{url:"/upload/:uploadid",templateUrl:rootPath+"/upload/html/edit.html",controller:"uploadEditCtrl",controllerAs:"vm"}).state("meeting",{url:"/meeting",templateUrl:rootPath+"/meeting/html/list.html",controller:"meetingCtrl",controllerAs:"vm"}).state("meetingEdit",{url:"/meetingEdit/:id",templateUrl:rootPath+"/meeting/html/edit.html",controller:"meetingEditCtrl",controllerAs:"vm"}).state("room",{url:"/room",params:{businessId:"",businessType:""},templateUrl:rootPath+"/room/html/roomlist.html",controller:"roomCtrl",controllerAs:"vm"}).state("roomCount",{url:"/roomCount",params:{id:""},templateUrl:rootPath+"/room/html/countlist.html",controller:"roomCountCtrl",controllerAs:"vm"}).state("company",{url:"/company",templateUrl:rootPath+"/company/html/list.html",controller:"companyCtrl",controllerAs:"vm"}).state("companyEdit",{url:"/companyEdit/:id",templateUrl:rootPath+"/company/html/edit.html",controller:"companyEditCtrl",controllerAs:"vm"}).state("accountPwd",{url:"/accountPwd",templateUrl:rootPath+"/account/html/changePwd.html",controller:"homeCtrl",controllerAs:"vm"}).state("demo",{url:"/demo",templateUrl:rootPath+"/demo/html/list.html",controller:"demoCtrl",controllerAs:"vm"}).state("dict",{url:"/dict",templateUrl:rootPath+"/dict/html/list.html",controller:"dictCtrl",controllerAs:"vm"}).state("dict.edit",{url:"/edit/:id",templateUrl:rootPath+"/dict/html/edit.html",controller:"dictEditCtrl",controllerAs:"vm"}).state("expert",{url:"/expert",templateUrl:rootPath+"/expert/html/queryAllList.html",controller:"expertCtrl",controllerAs:"vm"}).state("expertAudit",{url:"/expertAudit",templateUrl:rootPath+"/expert/html/audit.html",controller:"expertAuditCtrl",controllerAs:"vm"}).state("expertRepeat",{url:"/expertRepeat",templateUrl:rootPath+"/expert/html/repeat.html",controller:"expertRepeatCtrl",controllerAs:"vm"}).state("expertEdit",{url:"/expertEdit/:id",templateUrl:rootPath+"/expert/html/edit.html",controller:"expertEditCtrl",controllerAs:"vm"}).state("expertReviewEdit",{url:"/expertReview/:businessId/:minBusinessId/:businessType/:reviewType/:isback/:processInstanceId/:taskId",templateUrl:rootPath+"/expertReview/html/selectExpert.html",controller:"expertSelectCtrl",controllerAs:"vm"}).state("expertScore",{url:"/expertScore",templateUrl:rootPath+"/expert/html/scoreList.html",controller:"expertScoreCtrl",controllerAs:"vm"}).state("expertSelectHis",{url:"/expertSelectHis",templateUrl:rootPath+"/expert/html/selectHisList.html",controller:"expertSelectHisCtrl",controllerAs:"vm"}).state("addSign",{url:"/addSign",templateUrl:rootPath+"/sign/html/add.html",controller:"signCreateCtrl",controllerAs:"vm"}).state("fillSign",{url:"/fillSign/:signid/:isControl",cache:"false",templateUrl:rootPath+"/sign/html/fillin.html",controller:"signFillinCtrl",controllerAs:"vm"}).state("listSign",{url:"/listSign",templateUrl:rootPath+"/sign/html/list.html",controller:"signCtrl",controllerAs:"vm"}).state("signFlowDeal",{url:"/signFlowDeal/:signid/:taskId/:processInstanceId",templateUrl:rootPath+"/sign/html/flowDeal.html",controller:"signFlowDealCtrl",controllerAs:"vm"}).state("signFlowDetail",{url:"/signFlowDetail/:signid/:taskId/:processInstanceId",templateUrl:rootPath+"/sign/html/signFlowDetail.html",controller:"signFlowDetailCtrl",controllerAs:"vm"}).state("signDetails",{url:"/signDetails/:signid/:processInstanceId",templateUrl:rootPath+"/sign/html/signDetails.html",controller:"signDetailsCtrl",controllerAs:"vm"}).state("endSignDetail",{url:"/endSignDetail/:signid/:processInstanceId",templateUrl:rootPath+"/sign/html/signEndDetails.html",controller:"signEndCtrl",controllerAs:"vm"}).state("signList",{url:"/signList",templateUrl:rootPath+"/signView/html/signList.html",controller:"adminSignListCtrl",controllerAs:"vm"}).state("projectStopInfo",{url:"/projectStopInfo/:signId",templateUrl:rootPath+"/projectStop/html/projectStopInfo.html",controller:"projectStopInfoCtrl",controllerAs:"vm"}).state("selectHeader",{url:"/selectHeader",templateUrl:rootPath+"/sign/html/selectHeader.html",controller:"selectHeaderCtrl",controllerAs:"vm"}).state("signGetBack",{url:"/signGetBack",templateUrl:rootPath+"/sign/html/signGetBack.html",controller:"signGetBackCtrl",controllerAs:"vm"}).state("pauseProject",{url:"/pauseProject",templateUrl:rootPath+"/projectStop/html/pauseProjectList.html",controller:"pauseProjectCtrl",controllerAs:"vm"}).state("projectStopForm",{url:"/projectStopForm/:signId/:stopId",templateUrl:rootPath+"/projectStop/html/projectStopForm.html",controller:"projectStopFormCtrl",controllerAs:"vm"}).state("projectStopFormEdit",{url:"/projectStopFormEdit/:stopId",templateUrl:rootPath+"/projectStop/html/projectStopForm.html",controller:"projectStopFormEditCtrl",controllerAs:"vm"}).state("reserveAdd",{url:"/reserveAdd",templateUrl:rootPath+"/sign/html/reserveAdd.html",controller:"signReserveAddCtrl",controllerAs:"vm"}).state("reserveList",{url:"/reserveList",templateUrl:rootPath+"/sign/html/reserveList.html",controller:"signReserveCtrl",controllerAs:"vm"}).state("reserveEdit",{url:"/reserveEdit",templateUrl:rootPath+"/sign/html/reserveList.html",controller:"signReserveCtrl",controllerAs:"vm"}).state("deletList",{url:"/deletList",templateUrl:rootPath+"/maintainProject/html/deletList.html",controller:"signDeletCtrl",controllerAs:"vm"}).state("flowWPEdit",{url:"/flowWPEdit/:signid/:taskid",templateUrl:rootPath+"/workprogram/html/edit.html",controller:"flowWPEditCtrl",controllerAs:"vm"}).state("reWorkFlow",{url:"/reWorkFlow/:signid/:branchId",templateUrl:rootPath+"/workprogram/html/edit.html",controller:"flowWPEditCtrl",controllerAs:"vm"}).state("initProjBase",{url:"/initProjBase/:signid/:isadmin",templateUrl:rootPath+"/workprogram/html/baseEdit.html",controller:"wpBaseCtrl",controllerAs:"vm"}).state("maintWorkprogramEdit",{url:"/maintWorkprogramEdit/:signid",templateUrl:rootPath+"/maintainProject/html/workprogramEdit.html",controller:"maintWorkprogramEditCtrl",controllerAs:"vm"}).state("dispatchEdit",{url:"/dispatchEdit/:signid/:isControl",templateUrl:rootPath+"/dispatch/html/edit.html",controller:"dispatchEditCtrl",controllerAs:"vm"}).state("fileRecordEdit",{url:"/fileRecordEdit/:signid/:isControl",templateUrl:rootPath+"/fileRecord/html/edit.html",controller:"fileRecordEditCtrl",controllerAs:"vm"}).state("assistPlan",{url:"/assistPlan",templateUrl:rootPath+"/assistPlan/html/manager.html",controller:"assistPlanCtrl",controllerAs:"vm"}).state("officeUserList",{url:"/officeUserList",templateUrl:rootPath+"/officeUser/html/list.html",controller:"officeUserCtrl",controllerAs:"vm"}).state("officeUserEdit",{url:"/officeUserEdit/:officeID",templateUrl:rootPath+"/officeUser/html/edit.html",controller:"officeUserEditCtrl",controllerAs:"vm"}).state("listDept",{url:"/listDept",templateUrl:rootPath+"/dept/html/list.html",controller:"deptCtrl",controllerAs:"vm"}).state("deptEdit",{url:"/deptEdit/:deptId",templateUrl:rootPath+"/dept/html/edit.html",controller:"deptEditCtrl",controllerAs:"vm"}).state("deptOfficeUser",{url:"/deptOfficeUser/:deptId",templateUrl:rootPath+"/dept/html/listOfficeUser.html",controller:"deptOfficeUserCtrl",controllerAs:"vm"}).state("assistUnit",{url:"/assistUnit",templateUrl:rootPath+"/assistUnit/html/assistUnitList.html",controller:"assistUnitCtrl",controllerAs:"vm"}).state("assistUnitEdit",{url:"/assistUnitEdit/:id",templateUrl:rootPath+"/assistUnit/html/assistUnitEdit.html",controller:"assistUnitEditCtrl",controllerAs:"vm"}).state("quartz",{url:"/quartz",templateUrl:rootPath+"/quartz/html/list.html",controller:"quartzCtrl",controllerAs:"vm"}).state("workday",{url:"/workday",templateUrl:rootPath+"/workday/html/list.html",controller:"workdayCtrl",controllerAs:"vm"}).state("workdayEdit",{url:"/workdayEdit/:id",templateUrl:rootPath+"/workday/html/edit.html",controller:"workdayEditCtrl",controllerAs:"vm"}).state("annountment",{url:"/annountment",templateUrl:rootPath+"/annountment/html/list.html",controller:"annountmentCtrl",controllerAs:"vm"}).state("annountmentEdit",{url:"/annountmentEdit/:id",templateUrl:rootPath+"/annountment/html/edit.html",controller:"annountmentEditCtrl",controllerAs:"vm"}).state("annountmentDetail",{url:"/annountmentDetail/:id",templateUrl:rootPath+"/annountment/html/detail.html",controller:"annountmentDetailCtrl",controllerAs:"vm"}).state("annountmentYet",{url:"/annountmentYet",templateUrl:rootPath+"/annountment/html/yetList.html",controller:"annountmentYetCtrl",controllerAs:"vm"}).state("sharingPlatlform",{url:"/sharingPlatlform",templateUrl:rootPath+"/sharingPlatlform/html/list.html",controller:"sharingPlatlformCtrl",controllerAs:"vm"}).state("sharingPlatlformEdit",{url:"/sharingPlatlformEdit/:sharId",templateUrl:rootPath+"/sharingPlatlform/html/edit.html",controller:"sharingPlatlformEditCtrl",controllerAs:"vm"}).state("sharingDetil",{url:"/sharingDetil/:sharId",templateUrl:rootPath+"/sharingPlatlform/html/detail.html",controller:"sharingDetailCtrl",controllerAs:"vm"}).state("sharingPlatlformYet",{url:"/sharingPlatlformYet",templateUrl:rootPath+"/sharingPlatlform/html/yetList.html",controller:"sharingPlatlformYetCtrl",controllerAs:"vm"}).state("financialManager",{url:"/financialManager/:businessId",templateUrl:rootPath+"/financialManager/html/add.html",controller:"financialManagerCtrl",controllerAs:"vm"}).state("financialAssistManager",{url:"/financialAssistManager/:businessId",templateUrl:rootPath+"/financialManager/html/assistCostAdd.html",controller:"assistCostEditCtrl",controllerAs:"vm"}).state("assistCostlist",{url:"/assistCostlist/:costType",templateUrl:rootPath+"/financialManager/html/assistCostList.html",controller:"assistCostCountEditCtrl",controllerAs:"vm"}).state("assistCostCountList",{url:"/assistCostCountList",templateUrl:rootPath+"/financialManager/html/assistCostCount.html",controller:"assistCostCountListCtrl",controllerAs:"vm"}).state("financialManagerList",{url:"/financialManagerList/:costType",templateUrl:rootPath+"/financialManager/html/list.html",controller:"financialManagerEditCtrl",controllerAs:"vm"}).state("expertPaymentCountList",{url:"/expertPaymentCountList",templateUrl:rootPath+"/financialManager/html/expertPaymentCount.html",params:{year:(new Date).getFullYear()+"",month:(new Date).getMonth()+1+""},controller:"expertPaymentCountCtrl",controllerAs:"vm"}).state("expertPaymentDetailCountList",{url:"/expertPaymentDetailCountList/:year/:month",templateUrl:rootPath+"/financialManager/html/expertPaymentDetailCount.html",controller:"expertPaymentDetailCountCtrl",controllerAs:"vm"}).state("exportCountList",{url:"/exportCountList",templateUrl:rootPath+"/financialManager/html/expertCount.html",controller:"exportCountCtrl",controllerAs:"vm"}).state("expertRevCondCountList",{url:"/expertRevCondCountList",templateUrl:rootPath+"/signView/html/expertReviewCondCount.html",controller:"expertRevConCountCtrl",controllerAs:"vm"}).state("projectCostCountList",{url:"/projectCostCountList",templateUrl:rootPath+"/financialManager/html/projectCostCount.html",controller:"projectCostCountCtrl",controllerAs:"vm"}).state("proCostClassifyCountList",{url:"/proCostClassifyCountList",templateUrl:rootPath+"/financialManager/html/proCostClassifyCount.html",controller:"proCostClassifyCountCtrl",controllerAs:"vm"}).state("proReviewConCountList",{url:"/proReviewConCountList",templateUrl:rootPath+"/signView/html/proReviewConCount.html",controller:"proReviewConditionCtrl",controllerAs:"vm"}).state("achievementList",{url:"/achievementList",templateUrl:rootPath+"/signView/html/achievement.html",params:{year:(new Date).getFullYear()+"",quarter:"0"},controller:"achievementListCtrl",controllerAs:"vm"}).state("monthlyNewsletterList",{url:"/monthlyNewsletterList",templateUrl:rootPath+"/monthlyNewsletter/html/monthlyNewsletterList.html",controller:"monthlyNewsletterCtrl",controllerAs:"vm"}).state("monthlyEdit",{url:"/monthlyEdit/:id",templateUrl:rootPath+"/monthlyNewsletter/html/monthlyNewsletterEdit.html",controller:"monthlyNewsletterEditCtrl",controllerAs:"vm"}).state("theMonthsList",{url:"/theMonthsList",templateUrl:rootPath+"/monthlyNewsletter/html/theMonthsList.html",controller:"yearMonthlyNewsletterCtrl",controllerAs:"vm"}).state("monthlyFindByMultiyear",{url:"/monthlyFindByMultiyear/:year",templateUrl:rootPath+"/monthlyNewsletter/html/monthlyMultiyearList.html",controller:"monthlyMultiyearCtrl",controllerAs:"vm"}).state("monthlyMultiyearEdit",{url:"/monthlyMultiyearEdit/:year/:id",templateUrl:rootPath+"/monthlyNewsletter/html/monthlyMultiyearAdd.html",controller:"monthlyMultiyearEditCtrl",controllerAs:"vm"}).state("monthlyMultiyFileList",{url:"/monthlyMultiyFileList",templateUrl:rootPath+"/monthlyNewsletter/html/monthlyMultiyFileList.html",controller:"monthlyMultiFileCtrl",controllerAs:"vm"}).state("monthlyMultiyView",{url:"/monthlyMultiyView/:id",templateUrl:rootPath+"/monthlyNewsletter/html/monthlyMultiyView.html",controller:"monthlyMultiyViewCtrl",controllerAs:"vm"}).state("monthlyHistoryList",{url:"/monthlyHistoryList",templateUrl:rootPath+"/monthlyNewsletter/html/monthlyHistoryList.html",controller:"monthlyHistoryCtrl",controllerAs:"vm"}).state("monthlyHistoryEdit",{url:"/monthlyHistoryEdit/:id",templateUrl:rootPath+"/monthlyNewsletter/html/monthlyHistoryAdd.html",controller:"monthlyHistoryEditCtrl",controllerAs:"vm"}).state("approveWindow",{url:"/approveWindow/:signId",templateUrl:rootPath+"/reviewProjectAppraise/html/approveWindow.html",controller:"approveWindowCtrl",controllerAs:"vm"}).state("approveWindowEdit",{url:"/approveWindowEdit/:id",templateUrl:rootPath+"/reviewProjectAppraise/html/approveWindow.html",controller:"approveWindowEditCtrl",controllerAs:"vm"}).state("reviewProjectAppraiseList",{url:"/reviewProjectAppraiseList",params:{id:""},templateUrl:rootPath+"/signView/html/list.html",controller:"reviewProjectAppraiseCtrl",controllerAs:"vm"}).state("reviewProjectAppraiseEdit",{url:"/reviewProjectAppraiseEdit",templateUrl:rootPath+"/reviewProjectAppraise/html/edit.html",controller:"reviewProjectAppraiseEditCtrl",controllerAs:"vm"}).state("approveList",{url:"/approveList",templateUrl:rootPath+"/reviewProjectAppraise/html/approveList.html",controller:"approveListCtrl",controllerAs:"vm"}).state("libraryAdd",{url:"/libraryAdd",params:{id:""},templateUrl:rootPath+"/archivesLibrary/html/archivesLibraryAdd.html",controller:"archivesLibraryCtrl",controllerAs:"vm"}).state("archivesLibraryList",{url:"/archivesLibraryList",params:{id:""},templateUrl:rootPath+"/archivesLibrary/html/archivesLibraryList.html",controller:"archivesLibraryListCtrl",controllerAs:"vm"}).state("archivesLibraryView",{url:"/archivesLibraryView/:id",templateUrl:rootPath+"/archivesLibrary/html/archivesLibraryView.html",controller:"archivesLibraryViewCtrl",controllerAs:"vm"}).state("pluginfile",{url:"/pluginfile",templateUrl:rootPath+"/file/html/pluginfile.html",controller:"pluginfileCtrl",controllerAs:"vm"}).state("takeUser",{url:"/takeUser",templateUrl:rootPath+"/personalCenter/html/takeUser.html",controller:"takeUserCtrl",controllerAs:"vm"}).state("fileLibrary",{url:"/fileLibrary",templateUrl:rootPath+"/fileLibrary/html/fileLibrary.html",controller:"qualityCtrl",controllerAs:"vm"}).state("fileLibrary.fileList",{url:"/fileList/:parentId",templateUrl:rootPath+"/fileLibrary/html/fileList.html",controller:"qualityListCtrl",controllerAs:"vm"}).state("fileLibrary.fileEdit",{url:"/fileEdit/:parentId/:fileId",templateUrl:rootPath+"/fileLibrary/html/fileEdit.html",controller:"qualityEditCtrl",controllerAs:"vm"}).state("policyLibrary",{url:"/policyLibrary",templateUrl:rootPath+"/fileLibrary/html/policyLibrary.html",controller:"policyCtrl",controllerAs:"vm"}).state("policyLibrary.policyList",{url:"/policyList/:parentId",templateUrl:rootPath+"/fileLibrary/html/policyList.html",controller:"policyListCtrl",controllerAs:"vm"}).state("policyLibrary.policyEdit",{url:"/policyEdit/:parentId/:fileId",templateUrl:rootPath+"/fileLibrary/html/policyEdit.html",controller:"policyEditCtrl",controllerAs:"vm"}).state("bookBuyBusinessEdit",{url:"/bookBuyBusinessEdit",params:{businessId:"",viewDetail:""},templateUrl:rootPath+"/bookBuyBusiness/html/bookBuyBusinessEdit.html",controller:"bookBuyBusinessEditCtrl",controllerAs:"vm"}).state("myBookBuyBusiness",{url:"/myBookBuyBusiness",templateUrl:rootPath+"/bookBuyBusiness/html/bookBuyBusinessList.html",controller:"bookBuyBusinessCtrl",controllerAs:"vm"}).state("bookDetailList",{url:"/bookDetailList",templateUrl:rootPath+"/bookBuyBusiness/html/bookBuyList.html",controller:"bookBuyCtrl",controllerAs:"vm"}).state("bookBuyBusinessDetail",{url:"/bookBuyBusinessDetail/:businessId/:viewDetail",templateUrl:rootPath+"/bookBuyBusiness/html/bookBuyBusinessDetail.html",controller:"bookBuyBusinessDetailCtrl",controllerAs:"vm"}).state("bookBorrowList",{url:"/bookBorrowList",templateUrl:rootPath+"/bookBuyBusiness/html/bookBorrowList.html",controller:"bookBorrowCtrl",controllerAs:"vm"}).state("assertStorageBusinessEdit",{url:"/assertStorageBusinessEdit/:businessId",templateUrl:rootPath+"/assertStorageBusiness/html/assertStorageBusinessEdit.html",controller:"assertStorageBusinessEditCtrl",controllerAs:"vm"}).state("myAssertStorageBusiness",{url:"/myAssertStorageBusiness",templateUrl:rootPath+"/assertStorageBusiness/html/assertStorageBusinessList.html",controller:"assertStorageBusinessCtrl",controllerAs:"vm"}).state("assertApplyUse",{url:"/assertApplyUse",templateUrl:rootPath+"/userAssertDetail/html/userAssertDetailAdd.html",controller:"userAssertDetailAddCtrl",controllerAs:"vm"}).state("addTopic",{url:"/topicInfo/:id",templateUrl:rootPath+"/topicInfo/html/add.html",controller:"topicAddCtrl",controllerAs:"vm"}).state("editTopic",{url:"/topicEditInfo/:id/:curNodeId",templateUrl:rootPath+"/topicInfo/html/edit.html",controller:"topicAddCtrl",controllerAs:"vm"}).state("myTopic",{url:"/myTopic",templateUrl:rootPath+"/topicInfo/html/myList.html",controller:"myTopicCtrl",controllerAs:"vm"}).state("queryTopic",{url:"/queryTopic",templateUrl:rootPath+"/topicInfo/html/queryTopic.html",controller:"queryTopicCtrl",controllerAs:"vm"}).state("topicDetail",{url:"/topicDetail/:businessId/:processInstanceId",templateUrl:rootPath+"/topicInfo/html/topicDetail.html",controller:"topicDetailCtrl",controllerAs:"vm"}).state("header",{url:"/header",templateUrl:rootPath+"/header/html/list.html",controller:"headerCtrl",controllerAs:"vm"}).state("headerEdit",{url:"/headerEdit/:headerType",templateUrl:rootPath+"/header/html/selectHeader.html",controller:"headerEditCtrl",controllerAs:"vm"}).state("statisticalList",{url:"/statisticalList/:headerType",templateUrl:rootPath+"/header/html/statisticalList.html",controller:"statisticalListCtrl",controllerAs:"vm"}).state("statistical",{url:"/statistical",templateUrl:rootPath+"/statistical/html/list.html",controller:"statisticalCtrl",controllerAs:"vm"}).state("editWorkPlan",{url:"/editWorkPlan/:topicId",templateUrl:rootPath+"/workPlan/html/edit.html",controller:"workPlanEditCtrl",controllerAs:"vm"}).state("editFiling",{url:"/editFiling/:topicId/:curNodeId",templateUrl:rootPath+"/filing/html/edit.html",controller:"filingEditCtrl",controllerAs:"vm"}).state("reviewFee",{url:"/reviewFee",templateUrl:rootPath+"/reviewFee/html/list.html",controller:"reviewFeeCtrl",controllerAs:"vm"}).state("signwork",{url:"/signwork/:signid",templateUrl:rootPath+"/signwork/html/list.html",controller:"signworkCtrl",controllerAs:"vm"}).state("signFlowDeal.fileList",{url:"/fileList/:id/:type",templateUrl:rootPath+"/file/html/rightList.html",controller:"fileListCtrl",controllerAs:"vm"}).state("signFlowDetail.fileList",{url:"/fileList/:id/:type",templateUrl:rootPath+"/file/html/rightList.html",controller:"fileListCtrl",controllerAs:"vm"}).state("endSignDetail.fileList",{url:"/fileList/:id/:type",templateUrl:rootPath+"/file/html/rightList.html",controller:"fileListCtrl",controllerAs:"vm"}).state("signDetails.fileList",{url:"/fileList/:id/:type",templateUrl:rootPath+"/file/html/rightList.html",controller:"fileListCtrl",controllerAs:"vm"}).state("flowDeal.fileList",{url:"/flowDeal/:id/:type",templateUrl:rootPath+"/file/html/rightList.html",controller:"fileListCtrl",controllerAs:"vm"}).state("MaintainProjectEdit.fileList",{url:"/MaintainProjectEdit/:id/:type",templateUrl:rootPath+"/file/html/rightList.html",controller:"fileListCtrl",controllerAs:"vm"}).state("signChart",{url:"/signChart",templateUrl:rootPath+"/signView/html/signChart.html",controller:"signChartCtrl",controllerAs:"vm"}).state("MaintainProjectList",{url:"/MaintainProjectList",templateUrl:rootPath+"/maintainProject/html/MaintainProjectList.html",controller:"MaintainProjectCtrl",controllerAs:"vm"}).state("MaintainProjectEdit",{url:"/MaintainProjectEdit/:signid/:processInstanceId",templateUrl:rootPath+"/maintainProject/html/MaintainProjectEdit.html",controller:"MaintainProjectEditCtrl",controllerAs:"vm"}).state("reviewWorkday",{url:"/reviewWorkday/:signid",templateUrl:rootPath+"/maintainProject/html/reviewWorkday.html",controller:"reviewWorkdayCtrl",controllerAs:"vm"}).state("reviewOpinion",{url:"/reviewOpinion/:signid/:processInstanceId",templateUrl:rootPath+"/maintainProject/html/reviewOpinion.html",controller:"reviewOpinionCtrl",controllerAs:"vm"}).state("maintainExpertScore",{url:"/maintainExpertScore/:signid",templateUrl:rootPath+"/maintainProject/html/maintainExpertScore.html",controller:"maintainExpertScoreCtrl",controllerAs:"vm"}).state("maintainExpertPayment",{url:"/maintainExpertPayment/:signid",templateUrl:rootPath+"/maintainProject/html/maintainExpertPayment.html",controller:"maintainExpertPaymentCtrl",controllerAs:"vm"}).state("maintainExpertConfirm",{url:"/maintainExpertConfirm/:signid",templateUrl:rootPath+"/maintainProject/html/maintainExpertConfirm.html",controller:"maintainExpertConfirmCtrl",controllerAs:"vm"}).state("partyEdit",{url:"/partyEdit/:id",templateUrl:rootPath+"/partyManager/html/partyEdit.html",controller:"partyEditCtrl",controllerAs:"vm"}).state("partyList",{url:"/partyList",templateUrl:rootPath+"/partyManager/html/partyList.html",controller:"partyListCtrl",controllerAs:"vm"}).state("partyMeetList",{url:"/partyMeetList",templateUrl:rootPath+"/partyMeet/html/partyMeetList.html",controller:"partyMeetingCtrl",controllerAs:"vm"}).state("addPartyMeet",{url:"/addPartyMeet/:id",templateUrl:rootPath+"/partyMeet/html/addPartyMeeting.html",controller:"partyMeetingCtrl",controllerAs:"vm"}).state("partyMeetDetail",{url:"/partyMeetDetail/:id",templateUrl:rootPath+"/partyMeet/html/partyMeetDetail.html",controller:"partyMeetingCtrl",controllerAs:"vm"}).state("msgEdit",{url:"/msgEdit",templateUrl:rootPath+"/message/html/edit.html",controller:"msgEditCtrl",controllerAs:"vm"})}]).run(function(a,r,e,t,s){a.rootPath=rootPath,a.DICT=DICTOBJ,kendo.culture("zh-CN"),common.getTaskCount({$http:r}),a.getTBHeadName=function(e,t,i){return!t||"9"!=t||"项目建议书"!=e&&"可行性研究报告"!=e?e?"项目概算"==e?"概算审核"+i:e+i:i:"评估论证"+i},a.$on("$stateChangeSuccess",function(e,t,i,o,n){a.previousState_name=o.name,a.previousState_params=n,"signFlowDeal"!=o.name&&"flowDeal"!=o.name||(a.$flowUrl=o.name,a.$flowParams=n)}),a.back=function(){a.previousState_name?e.go(a.previousState_name,a.previousState_params):e.go("welcome")},a.backtoflow=function(){a.$flowUrl?e.go(a.$flowUrl,a.$flowParams):e.go("gtasks")},a.topSelectChange=function(e,t,i){if(null!=t)for(var o=0;o<t.length;o++)if(i&&"code"==i){if(t[o].dictCode==e)return t[o].dicts}else if(t[o].dictName==e)return t[o].dicts},a.initInputValue=function(e,t){return e.target.checked&&!t?1:t},a.range=function(e){if(e)return new Array(e)},a.countCharacter=function(e,t,i){var o=e?e.length:0,n="<span style='font-size:12px;'>（最多允许输入"+t+"个字";if(0<o){var a=0<t-o?t-o:0;n+=",还能输入<font color='red'>"+a+"</font>个字",0==a&&(e=e.substr(0,t))}return n+="</span>)",$("#"+i).html(n),e},a.previewFile=function(e,t){var i;if(e)if("pdf"==t?i=rootPath+"/contents/libs/pdfjs-dist/web/viewer.html?file="+rootPath+"/file/preview/"+e+"&version="+(new Date).getTime():"image"==t&&(i=rootPath+"/file/preview/"+e+"?version="+(new Date).getTime()),i){var o={method:"post",url:rootPath+"/file/fileSysCheck",params:{sysFileId:e}};common.http({$http:r,httpOptions:o,success:function(e){$("#iframePreview").attr("src",""),e.data.flag||"ok"==e.data.reCode?($("#iframePreview").attr("src",i),$("#previewModal").kendoWindow({width:"1050px",height:"730px",title:"",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()):s.error(e.data.reMsg)}})}else s.alert("该文件不支持在线预览和在线编辑");else s.alert("参数不正确，无法在线预览")},a.editFile=function(e,t){var i=rootPath+"/file/editFile?sysFileId="+e+"&fileType="+t+"&version="+(new Date).getTime();window.open(i,"_blank")},a.printFile=function(e,t,i){if(e&&t&&i){var o=rootPath+"/contents/libs/pdfjs-dist/web/viewer.html?version="+(new Date).getTime()+"&file="+rootPath+"/file/printPreview/"+e+"/"+t+"/"+i;$("#iframePreview").attr("src",o),$("#previewModal").kendoWindow({width:"80%",height:"730px",title:"",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()}else s.alert("没有项目阶段，找不到对应的打印模板，打印预览失败！")},a.isBankCard=function(e,t,i){var o=!1;if(null==i)o=!0,s.alert("评审费未发放，不能进行打印操作！");else for(var n=0;n<e.length;n++)if("9"==e[n].isConfrim&&"9"==e[n].isJoin){if(null==e[n].expertDto.bankAccount||null==e[n].expertDto.openingBank){o=!0,s.alert("专家的开户行和银行账户信息不全，请填写完整！");break}if(null==e[n].reviewTaxes){o=!0,s.alert("评审费未计纳税额，不能进行打印操作！");break}}o||a.printFile(t,"SIGN_EXPERT","SIGN_EXPERT_PAY")},a.exportInfo=function(e,t,i,o){if(e&&t&&i){var n={method:"post",url:rootPath+"/file/exportInfo",params:{businessId:e,businessType:t,stageType:i,fileName:o}};common.http({$http:r,httpOptions:n,success:function(e){o+=".doc";common.downloadReport(e.data,o,"msword")}})}else s.alert("没有项目阶段，找不到对应的导出模板，导出失败！")},a.view={},a.storeView=function(e,t){a.view[e]=t}})}(),function(){"use strict";var e=angular.module("app");e.directive("goBack",function(){return{restrict:"AE",template:'<a class="btn btn-sm btn-primary" href="javascript:void(0);" ng-click="back();"><span class="glyphicon glyphicon-chevron-left"></span>返回</a>'}}),e.directive("goBackFlow",function(){return{restrict:"AE",template:'<button class="btn btn-sm btn-danger" ng-click="backtoflow();"><span class="glyphicon glyphicon-chevron-left"></span>返回流程</button>'}}),e.directive("flowFileButton",function(){return{restrict:"AE",template:'<button class="btn btn-sm btn-primary" ng-click="vm.clickUploadBt();" id="upload_file_bt">上传附件</button> <button class="btn btn-sm btn-primary" ng-click="vm.clickDetailBt();" id="detail_file_bt">查看附件</button>'}})}(),function(){"use strict";function e(e,a,t,i,r){var s=this;s.title="工作业绩统计表",s.model={},s.mainDoc={},s.assistDoc={},s.model.year=t.params.year,s.model.quarter=t.params.quarter,s.conMaxIndex=0,s.conditions=[],s.isCreate=!1,a.achievementSum(s,function(e){(e.flag||"ok"==e.reCode)&&(s.achievementSumList=e.reObj.achievementSumList,0<s.achievementSumList.length?2==s.achievementSumList.length?(s.assistDoc=s.achievementSumList[0],s.mainDoc=s.achievementSumList[1]):"9"==s.achievementSumList[0].ismainuser?(s.mainDoc=s.achievementSumList[0],s.assistDoc={},s.assistDoc.disSum=0,s.assistDoc.declarevalueSum=0,s.assistDoc.authorizevalueSum=0,s.assistDoc.extravalueSum=0,s.assistDoc.extraRateSum=0):"0"==s.achievementSumList[0].ismainuser&&(s.assistDoc=s.achievementSumList[0],s.mainDoc={},s.mainDoc.disSum=0,s.mainDoc.declarevalueSum=0,s.mainDoc.authorizevalueSum=0,s.mainDoc.extravalueSum=0,s.mainDoc.extraRateSum=0):(s.mainDoc={},s.assistDoc={}),s.achievementMainList=e.reObj.achievementMainList,s.achievementAssistList=e.reObj.achievementAssistList,s.level=e.reObj.level,s.orgDeptList=e.reObj.orgDeptList,0==s.level&&(s.userId=e.reObj.userId,a.findTopicDetail(s.userId,function(e){if(null!=e){s.conditions=e;for(var t=0;t<s.conditions.length;t++)s.conditions[t].sort=t+1}})))}),s.showMainDocDetail=function(){$("#mainDocDetail").kendoWindow({width:"80%",height:"680px",title:"主办人评审项目一览表",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},s.showAssistDocDetail=function(){$("#assistDocDetail").kendoWindow({width:"80%",height:"680px",title:"协办人评审项目一览表",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},s.countAchievementDetail=function(){if(0!=s.level){var e=$("input[name='orgDept']:checked"),i=[];$.each(e,function(e,t){i.push(t.value)}),s.model.deptIds=i.join(",")}a.achievementSum(s,function(e){(e.flag||"ok"==e.reCode)&&(s.achievementSumList=e.reObj.achievementSumList,0<s.achievementSumList.length?2==s.achievementSumList.length?(s.assistDoc=s.achievementSumList[0],s.mainDoc=s.achievementSumList[1]):"9"==s.achievementSumList[0].ismainuser?(s.mainDoc=s.achievementSumList[0],s.assistDoc={},s.assistDoc.disSum=0,s.assistDoc.declarevalueSum=0,s.assistDoc.authorizevalueSum=0,s.assistDoc.extravalueSum=0,s.assistDoc.extraRateSum=0):"0"==s.achievementSumList[0].ismainuser&&(s.assistDoc=s.achievementSumList[0],s.mainDoc={},s.mainDoc.disSum=0,s.mainDoc.declarevalueSum=0,s.mainDoc.authorizevalueSum=0,s.mainDoc.extravalueSum=0,s.mainDoc.extraRateSum=0):(s.mainDoc={},s.assistDoc={}),s.achievementMainList=e.reObj.achievementMainList,s.achievementAssistList=e.reObj.achievementAssistList)})},s.showTopicDetail=function(){$("#topicDetail").kendoWindow({width:"80%",height:"680px",title:"课题研究及其他业务工作一览表",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},s.addTopic=function(){s.condition={},0==s.conditions.length?s.condition.sort=s.conMaxIndex+1:(s.conMaxIndex=s.conditions.length,s.condition.sort=s.conditions.length+1),s.condition.endTime=new Date,s.conditions.push(s.condition),s.conMaxIndex++},s.saveTopic=function(){(function(){{if(common.initJqValidation($("#topicform")),$("#topicform").valid()){if(0<s.conditions.length){return s.conditions.forEach(function(e,t){e.businessType=$("#businessType"+e.sort).val(),e.topicName=$("#topicName"+e.sort).val(),e.endTime=$("#endTime"+e.sort).val()}),!0}return r.error("没有分录数据，无法保存！"),!1}return r.alert("页面未填报完整或者为正确，请检查！"),!1}})()&&a.saveTopicDetailList(s.conditions,function(e){if(e.flag||"ok"==e.reCode){s.conditions=e.reObj;for(var t=0;t<s.conditions.length;t++)s.conditions[t].sort=t+1;r.success("保存成功！")}else r.error(e.reMsg)})},s.removeTopic=function(){var o=$("#topicform input[name='topicInfo']:checked");0<o.length?r.confirm({title:"询问提示",message:"删除数据不可恢复，确定删除么？",onOk:function(){$(".confirmDialog").modal("hide");for(var n=[],e=0;e<o.length;e++)for(var t=0;t<s.conditions.length;t++){var i=s.conditions[t];if(o[e].value==i.sort){if(!i.id){s.conditions.splice(t,1),$("#conTr"+i.sort).remove();break}n.push(i.id)}}0<n.length&&a.deleteTopicMaintainDel(n.join(","),function(e){if(e.flag||"ok"==e.reCode){r.success("操作成功！");for(var t=0;t<n.length;t++)for(var i=0;i<s.conditions.length;i++){var o=s.conditions[i];if(n[t]==o.id){s.conditions.splice(i,1),$("#conTr"+o.sort).remove();break}}}else r.error(e.reMsg)})}}):r.alert("请选择要删除的合同信息！")},s.showPersonalAchievementDetail=function(t,e){s.model.userId=t,s.userName=e,a.achievementSum(s,function(e){(e.flag||"ok"==e.reCode)&&(s.achievementPersonalSumList=e.reObj.achievementSumList,0<s.achievementPersonalSumList.length?2==s.achievementPersonalSumList.length?(s.assistPersonalDoc=s.achievementPersonalSumList[0],s.mainPersonalDoc=s.achievementPersonalSumList[1]):"9"==s.achievementPersonalSumList[0].ismainuser?(s.mainPersonalDoc=s.achievementPersonalSumList[0],s.assistPersonalDoc={},s.assistPersonalDoc.disSum=0,s.assistPersonalDoc.declarevalueSum=0,s.assistPersonalDoc.authorizevalueSum=0,s.assistPersonalDoc.extravalueSum=0,s.assistPersonalDoc.extraRateSum=0):"0"==s.achievementPersonalSumList[0].ismainuser&&(s.assistPersonalDoc=s.achievementPersonalSumList[0],s.mainPersonalDoc={},s.mainPersonalDoc.disSum=0,s.mainPersonalDoc.declarevalueSum=0,s.mainPersonalDoc.authorizevalueSum=0,s.mainPersonalDoc.extravalueSum=0,s.mainPersonalDoc.extraRateSum=0):(s.assistPersonalDoc={},s.mainPersonalDoc={}),s.model.userId="",s.achievementMainPersonalList=e.reObj.achievementMainList,s.achievementAssistPersonalList=e.reObj.achievementAssistList,s.deptName=e.reObj.deptName,a.findTopicDetail(t,function(e){if(null!=e){s.conditions=e;for(var t=0;t<s.conditions.length;t++)s.conditions[t].sort=t+1;$("#achievementPersonal").kendoWindow({width:"80%",height:"700px",title:"评审中心员工工作业绩统计表",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()}}))})},s.showAchievementDetail=function(){var e=$("input[name='orgDept']:checked"),o=[],n=[];$.each(e,function(e,t){o.push(t.value);var i=$(t);n.push(i.attr("tit"))}),s.model.deptIds=o.join(","),s.model.deptNames=n.join("、"),a.achievementDeptDetail(s,function(e){(e.flag||"ok"==e.reCode)&&(s.achievementDeptDetailList=e.reObj.achievementDeptDetailList,$("#achievementDeptDetail").kendoWindow({width:"80%",height:"680px",title:"部门工作业绩统计表",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open())})},s.initAchievementSum=function(e){var t=$("input[name='orgDept']:checked"),i=[];if($.each(t,function(e,t){i.push(t.value)}),0==i.length){var o=e.target;return r.alert("至少需要选择一个部门！"),void(o.checked=!0)}s.model.deptIds=i.join(","),s.model.initFlag="1",a.achievementSum(s,function(e){(e.flag||"ok"==e.reCode)&&(s.achievementSumList=e.reObj.achievementSumList,0<s.achievementSumList.length?(s.assistDoc=s.achievementSumList[0],s.mainDoc=s.achievementSumList[1]):(s.assistDoc={},s.mainDoc={}),s.achievementMainList=e.reObj.achievementMainList,s.achievementAssistList=e.reObj.achievementAssistList)})},s.exportAchievementDetail=function(){a.exportAchievementDetail(s)},s.exportDeptAchievementDetail=function(){a.exportDeptAchievementDetail(s)},s.exportTopicMaintainInfo=function(){a.exportTopicMaintainInfo(s)},s.exportProReview=function(e){s.model.isMainPro=e,a.exportProReview(s)}}angular.module("app").controller("achievementListCtrl",e),e.$inject=["$location","achievementSvc","$state","$http","bsWin"]}(),function(){"use strict";function e(o){return{achievementSum:function(e,t){var i={method:"post",url:rootPath+"/signView/getAchievementSum",data:e.model};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},achievementDeptDetail:function(e,t){var i={method:"post",url:rootPath+"/signView/getAchievementDeptDetail",data:e.model};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},saveTopicDetailList:function(e,t){var i={method:"post",url:rootPath+"/topicInfo/saveTopicDetailList",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(e)};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},deleteTopicMaintainDel:function(e,t){var i={method:"delete",url:rootPath+"/topicInfo/topicMaintainDel",params:{ids:e}};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},findTopicDetail:function(e,t){var i={method:"post",url:rootPath+"/topicInfo/findTopicDetail",params:{userId:e}};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)},onError:function(){}})},exportAchievementDetail:function(e){var t={method:"post",url:rootPath+"/signView/exportAchievementSum",data:e.model};common.http({$http:o,httpOptions:t,success:function(e){common.downloadReport(e.data,"员工业绩统计表.doc","msword")}})},exportDeptAchievementDetail:function(e){var t={method:"post",url:rootPath+"/signView/exportDeptAchievementSum",data:e.model};common.http({$http:o,httpOptions:t,success:function(e){common.downloadReport(e.data,"部门业绩统计表.doc","msword")}})},exportTopicMaintainInfo:function(e){var t={method:"post",url:rootPath+"/signView/exportTopicMaintainInfo",params:{userId:e.userId}};common.http({$http:o,httpOptions:t,success:function(e){common.downloadReport(e.data,"课题研究一览表.doc","msword")}})},exportProReview:function(e){if("9"==e.model.isMainPro)var i="主办项目一览表.doc";else var i="协办项目一览表.doc";var t={method:"post",url:rootPath+"/signView/exportProReview",data:e.model};common.http({$http:o,httpOptions:t,success:function(e){var t=i;common.downloadReport(e.data,t,"msword")}})}}}angular.module("app").factory("achievementSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(a,r,e){var s=this;s.title="登记补充资料",s.sign={},s.addRegisters=[],s.businessId=e.params.businessId,s.addRegisterFile=function(){s.addRegister={},s.addRegister.businessId=s.businessId,s.addRegister.id=common.uuid(),s.addRegisters.push(s.addRegister)},s.saveRegisterFile=function(){r.saveRegisterFile(s.addRegisters,function(e){e.flag||"ok"==e.reCode?(a.alert("操作成功"),s.addRegisters=e.reObj):a.alert(e.reMsg)})},s.deleteRegisterFile=function(){var i=$("#addRegistersTable input[name='addRegistersCheck']:checked");if(i.length<1)a.alert("请选择要删除的记录！");else{for(var o=[],n=0;n<i.length;n++)s.addRegisters.forEach(function(e,t){e.id&&i[n].value==e.id&&(o.push(i[n].value),s.addRegisters.splice(t,1))});0<o.length&&r.deleteByIds(o.join(","),function(e){a.alert("删除成功！")})}},s.inputIntegerValue=function(e,t){r.isUnsignedInteger(e)?$("#errorsUnmber"+t).html(""):$("#errorsUnmber"+t).html("只能输入数字")},e.params.businessId&&r.initAddRegisterFile(e.params.businessId,function(e){e&&0<e.length&&(s.addRegisters=e)}),s.printFile=function(e){var t=$("input[name='addRegistersCheck']:checked");if(console.log(t),0==t.length)a.alert("请选择数据！");else{for(var i=[],o=0;o<t.length;o++)i.push(t[o].value);i=i.join(",");var n=rootPath+"/contents/libs/pdfjs-dist/web/viewer.html?version="+(new Date).getTime()+"&file="+rootPath+"/addRegisterFile/printAddRegisterFile/"+e+"/"+i;$("#iframePreview").attr("src",n),$("#previewModal").kendoWindow({width:"80%",height:"730px",title:"",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()}}}angular.module("app").controller("addRegisterFileCtrl",e),e.$inject=["bsWin","addRegisterFileSvc","$state"]}(),function(){"use strict";function e(e,t,i){var o=this;o.title="添加登记补充资料",o.isuserExist=!1,o.id=i.params.id,o.id&&(o.isUpdate=!0,o.title="更新登记补充资料"),o.create=function(){t.createAddRegisterFile(o)},o.update=function(){t.updateAddRegisterFile(o)},o.isUpdate&&t.getAddRegisterFileById(o)}angular.module("app").controller("addRegisterFileEditCtrl",e),e.$inject=["$location","addRegisterFileSvc","$state"]}(),function(){"use strict";function e(o){var n=rootPath+"/addRegisterFile";return{initAddRegisterFile:function(e,t){var i={method:"post",url:rootPath+"/addRegisterFile/findByBusinessId",params:{businessId:e}};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},saveRegisterFile:function(e,t){var i={method:"post",url:rootPath+"/addRegisterFile/save",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(e)};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},isUnsignedInteger:function(e){return!!(/^(\+|-)?\d+$/.test(e)&&0<e)},initRegisterWinDow:function(e,t){$("#addRegister").kendoWindow({width:"70%",height:"660px",title:"意见选择",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()},deleteByIds:function(e,t){var i={method:"delete",url:n+"/deleteFile",params:{ids:e}};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}}}angular.module("app").factory("addRegisterFileSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,i,o,n,a){var r=this;r.suppletter={},r.suppletter.businessId=o.params.businessId,r.suppletter.businessType=o.params.businessType,r.suppletter.id=o.params.id,r.isControl=o.params.isControl,r.title="拟补充资料函",r.businessFlag={isInitFileOption:!1},t.initSuppLetter(r.suppletter.businessId,r.suppletter.businessType,function(e){r.suppletter=e,r.initFileUpload()}),r.initFileUpload=function(){r.suppletter.id||a.$watch("vm.suppletter.id",function(e,t){e&&e!=t&&!r.initUploadOptionSuccess&&r.initFileUpload()}),r.sysFile={businessId:r.suppletter.id,mainId:r.suppletter.businessId,mainType:i.mainTypeValue().SIGN,sysfileType:i.mainTypeValue().AADSUPP_FILE,sysBusiType:i.mainTypeValue().AADSUPP_FILE},i.initUploadOptions({inputId:"sysfileinput",vm:r})},r.saveAddSuppletter=function(){common.initJqValidation($("#suppletter_form")),$("#suppletter_form").valid()?(r.suppletter.fileType="1",t.saveSuppLetter(r.suppletter,r.isCommit,function(e){e.flag||"ok"==e.reCode?(r.suppletter=e.reObj,n.success("操作成功！")):n.error(e.reMsg)})):n.alert("表格填写不正确，请检查相应的必填项信息！")},r.startSignSupperFlow=function(){common.initJqValidation($("#suppletter_form")),$("#suppletter_form").valid()?n.confirm({title:"询问提示",message:"确认已经完成填写，并且发起流程么？",onOk:function(){t.saveSuppLetter(r.suppletter,r.isCommit,function(e){r.isCommit=!1,e.flag||"ok"==e.reCode?(r.suppletter=e.reObj,t.startSignSupperFlow(r.suppletter.id,function(e){e.flag||"ok"==e.reCode?n.success("操作成功！"):n.error(e.reMsg)})):n.error(e.reMsg)})}}):n.alert("表格填写不正确，请检查相应的必填项信息！")},r.del=function(e){common.confirm({vm:r,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteAddSuppLetter(r,e)}})},r.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:r,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");r.del(o)}}}angular.module("app").controller("addSuppLetterCtrl",e),e.$inject=["$location","addSuppLetterSvc","sysfileSvc","$state","bsWin","$scope"]}(),function(){"use strict";function e(e,t,i,o,n,a){var r=this;r.title="添加登记补充资料",r.isuserExist=!1,r.id=o.params.id,r.suppletter={},r.suppletter.businessId=o.params.businessId,r.suppletter.businessType=o.params.businessType,r.suppletter.id=o.params.id,r.id&&(r.isUpdate=!0,r.title="更新登记补充资料"),r.businessFlag={isInitFileOption:!1},r.initFileUpload=function(){r.suppletter.id||a.$watch("vm.suppletter.id",function(e,t){e&&e!=t&&!r.initUploadOptionSuccess&&r.initFileUpload()}),r.sysFile={businessId:r.suppletter.id,mainId:r.suppletter.businessId,mainType:i.mainTypeValue().SIGN,sysfileType:i.mainTypeValue().AADSUPP_FILE,sysBusiType:i.mainTypeValue().AADSUPP_FILE,detailBt:"detail_file_bt"},i.initUploadOptions({inputId:"sysfileinput",vm:r})},r.saveAddSuppletter=function(){common.initJqValidation($("#suppletter_form")),$("#suppletter_form").valid()?t.saveSuppLetter(r.suppletter,r.isCommit,function(e){e.flag||"ok"==e.reCode?(r.suppletter=e.reObj,n.success("操作成功！")):n.error(e.reMsg)}):n.alert("表格填写不正确，请检查相应的必填项信息！")},r.comeBack=function(){o.go("addSuppletterList",{businessId:r.suppletter.businessId})},r.update=function(){t.updateAddSuppLetter(r)},r.startSignSupperFlow=function(){common.initJqValidation($("#suppletter_form")),$("#suppletter_form").valid()?n.confirm({title:"询问提示",message:"确认已经完成填写，并且发起流程么？",onOk:function(){t.saveSuppLetter(r.suppletter,r.isCommit,function(e){r.isCommit=!1,e.flag||"ok"==e.reCode?(r.suppletter=e.reObj,o.go("addSuppletterList",{businessId:r.suppletter.businessId}),t.startSignSupperFlow(r.suppletter.id,function(e){e.flag||"ok"==e.reCode?n.success("操作成功！"):n.error(e.reMsg)})):n.error(e.reMsg)})}}):n.alert("提交失败，有红色*号的内容都要按要求填写！")},t.getAddSuppLetterById(r.suppletter.id,function(e){r.suppletter=e,r.initFileUpload()})}angular.module("app").controller("addSuppLetterEditCtrl",e),e.$inject=["$location","addSuppLetterSvc","sysfileSvc","$state","bsWin","$scope"]}(),function(){"use strict";function e(n,e){var o=rootPath+"/addSuppLetter";return{initSuppLetter:function(e,t,i){var o={method:"post",url:rootPath+"/addSuppLetter/initSuppLetter",params:{businessId:e,businessType:t}};common.http({$http:n,httpOptions:o,success:function(e){null!=i&&"function"==typeof i&&i(e.data)}})},saveSuppLetter:function(e,t,i){!0;var o={method:"post",url:rootPath+"/addSuppLetter/saveSupp",data:e};common.http({$http:n,httpOptions:o,success:function(e){null!=i&&"function"==typeof i&&i(e.data)},onError:function(e){!1}})},grid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(o),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"id",title:"id",width:100,filterable:!0},{field:"orgName",title:"orgName",width:100,filterable:!0},{field:"userName",title:"userName",width:100,filterable:!0},{field:"suppLetterTime",title:"suppLetterTime",width:100,filterable:!0,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"disapDate",title:"disapDate",width:100,filterable:!0,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"secretLevel",title:"secretLevel",width:100,filterable:!0},{field:"mergencyLevel",title:"mergencyLevel",width:100,filterable:!0},{field:"filenum",title:"filenum",width:100,filterable:!0},{field:"title",title:"title",width:100,filterable:!0},{field:"dispaRange",title:"dispaRange",width:100,filterable:!0},{field:"suppleterSuggest",title:"suppleterSuggest",width:100,filterable:!0},{field:"meetingSuggest",title:"meetingSuggest",width:100,filterable:!0},{field:"leaderSuggest",title:"leaderSuggest",width:100,filterable:!0},{field:"printnum",title:"printnum",width:100,filterable:!0},{field:"signid",title:"signid",width:100,filterable:!0},{field:"fileSeq",title:"fileSeq",width:100,filterable:!0},{field:"",title:"操作",width:140,template:function(e){return common.format($("#columnBtns").html(),"vm.del('"+e.id+"')",e.id)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0}},deleteAddSuppLetter:function(t,e){t.isSubmit=!0;var i={method:"delete",url:o,data:e};common.http({vm:t,$http:n,httpOptions:i,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})}})}})},getAddSuppLetterById:i,createFilenum:function(e,t){var i={method:"post",url:o+"/createFileNum",params:{id:e}};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},initSuppListDate:function(e,t){var i={method:"post",url:rootPath+"/addSuppLetter/initSuppListDate",params:{businessId:e}};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},initFlowDeal:function(t){i(t.businessKey,function(e){t.suppletter=e})},startSignSupperFlow:function(e,t){var i={method:"post",url:rootPath+"/addSuppLetter/startSignSupperFlow",params:{id:e}};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}};function i(e,t){var i={method:"post",url:rootPath+"/addSuppLetter/findById",params:{id:e}};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}}angular.module("app").factory("addSuppLetterSvc",e),e.$inject=["$http","bsWin"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.suppletter={},n.suppletter.businessId=i.params.businessId,n.title="登记补充资料",t.initSuppListDate(n.suppletter.businessId,function(e){n.suppletterlist=e}),n.getFilenum=function(e){t.createFilenum(e,function(i){i.flag||"ok"==i.reCode?(o.alert("操作成功！"),$.each(n.suppletterlist,function(e,t){t.id==i.reObj.id&&(t.filenum=i.reObj.filenum)})):o.alert(i.reMsg)})},n.findByIdAddSuppLetter=function(e){i.go("addSuppLetterEdit",{id:e})}}angular.module("app").controller("addSuppLetterListCtrl",e),e.$inject=["$location","addSuppLetterSvc","$state","bsWin"]}(),function(){"use strict";function e(e,t,i,o,n){var a=this;a.suppletter={},a.id=i.params.id,a.isQuery=!0,a.model={},t.addQueryGrid(a),n.queryOrgList(a,function(e){a.model.org=e}),a.quarySuppContent=function(){a.queryGridOptions.dataSource._skip="",a.queryGridOptions.dataSource.read()},a.resetSuppContent=function(){var e=$("#supQueryForm").find("input,select").not(":submit, :reset, :image, :disabled,:hidden");$.each(e,function(e,t){t.value=""})},a.showSuppLetterDetail=function(e){a.isDisplay=!0,a.id=e,t.getaddSuppLetterQueryById(a,function(e){a.suppletter=e,$("#suppLetterDetailDiv").kendoWindow({width:"1072px",height:"800px",title:"拟补充资料函详情",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()})},a.deleteById=function(e){o.confirm({title:"询问提示",message:"确定删除么？",onOk:function(){t.deleteaddSuppLetterQuery(e,function(e){e.flag||"ok"==e.reCode?o.alert("删除成功！",function(){a.quarySuppContent()}):o.alert(e.reMsg)})}})}}angular.module("app").controller("addSuppLetterQueryCtrl",e),e.$inject=["$location","addSuppLetterQuerySvc","$state","bsWin","orgSvc"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.title="添加登记补充资料",n.isuserExist=!1,n.id=i.params.id,n.id&&(n.isUpdate=!0,n.title="更新登记补充资料"),n.saveSuppletterApprove=function(){t.createaddSuppLetterQuery(n)},n.update=function(){t.updateaddSuppLetterQuery(n)},t.getaddSuppLetterQueryById(n,function(e){n.suppletter=e})}angular.module("app").controller("addSuppLetterQueryEditCtrl",e),e.$inject=["$location","addSuppLetterQuerySvc","$state","bsWin"]}(),function(){"use strict";function e(n,i){var o=rootPath+"/addSuppLetter";return{approveGrid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(o+"/addSuppApproveList"),schema:{data:"value",total:function(e){return e.count?$("#ADDSUPPLETTER_COUNT").html(e.count):$("#ADDSUPPLETTER_COUNT").html(0),e.count},model:{id:"id",fields:{createdDate:{type:"date"},modifiedDate:{type:"date"}}}},serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"title",title:"文件标题",width:100,filterable:!1},{field:"orgName",title:"拟稿部门",width:100,filterable:!1},{field:"userName",title:"拟稿人",width:100,filterable:!1},{field:"suppLetterTime",title:"拟稿时间",width:100,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"filenum",title:"文件字号",width:100,filterable:!1},{field:"",title:"操作",width:140,template:function(e){return common.format($("#columnBtns").html(),e.id)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0}},addQueryGrid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/addSuppLetter/addsuppListData",$("#supQueryForm")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"",title:"文件标题",filterable:!1,template:function(e){return"<a ng-click='vm.showSuppLetterDetail( \""+e.id+"\")'>"+e.title+"</a>"}},{field:"orgName",title:"拟稿部门",width:120,filterable:!1},{field:"userName",title:"拟稿人",width:90,filterable:!1},{field:"suppLetterTime",title:"拟稿时间",width:120,filterable:!1,format:"{0: yyyy-MM-dd}"},{field:"filenum",title:"文件字号",width:120,filterable:!1},{field:"",title:"操作",width:80,filterable:!1,template:function(e){return e.createdBy!=curUserId||e.processInstanceId?"":"<a class='btn btn-xs btn-primary' href='#addSuppLetterEdit/"+e.id+"'><span class='glyphicon glyphicon-pencil'></span>编辑</a><a class='btn btn-xs btn-danger' ng-click='vm.deleteById(\""+e.id+"\")'><span class='glyphicon glyphicon-remove'></span>删除</a>"}}];e.queryGridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})},resizable:!0}},createaddSuppLetterQuery:function(e){var t={method:"post",url:rootPath+"/addSuppLetter/updateApprove",data:e.suppletter};common.http({$http:n,httpOptions:t,success:function(e){i.success("操作成功！")}})},deleteaddSuppLetterQuery:function(e,t){var i={method:"post",url:rootPath+"/addSuppLetter/deleteById",params:{id:e}};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},updateaddSuppLetterQuery:function(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0,t.model.id=t.id;var e={method:"put",url:o,data:t.model};common.http({vm:t,$http:n,httpOptions:e,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})}})}},getaddSuppLetterQueryById:function(e,t){var i={method:"post",url:rootPath+"/addSuppLetter/findById",params:{id:e.id}};common.http({vm:e,$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},initSuppLetter:function(e,t,i){var o={method:"post",url:rootPath+"/addSuppLetterQuery/initSuppLetter",params:{businessId:e,businessType:t}};common.http({$http:n,httpOptions:o,success:function(e){null!=i&&"function"==typeof i&&i(e.data)}})},createFilenum:function(e,t){var i={method:"post",url:o+"/createFileNum",params:{id:e}};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},initSuppListDate:function(e,t){var i={method:"post",url:rootPath+"/addSuppLetterQuery/initSuppListDate",params:{businessId:e}};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},checkIsApprove:function(e,t,i){var o={method:"post",url:rootPath+"/addSuppLetter/checkIsApprove",params:{signId:e,fileType:t}};common.http({$http:n,httpOptions:o,success:function(e){null!=i&&"function"==typeof i&&i(e.data)}})}}}angular.module("app").factory("addSuppLetterQuerySvc",e),e.$inject=["$http","bsWin"]}(),function(){"use strict";function e(e,t,i,o,n,a){var r=this;r.isuserExist=!1,r.id=o.params.id,r.suppletter={},r.suppletter.id=o.params.id,r.id&&(r.isUpdate=!0,r.title="查看登记补充资料"),r.businessFlag={isInitFileOption:!1},r.initFileUpload=function(){r.suppletter.id||a.$watch("vm.suppletter.id",function(e,t){e&&e!=t&&!r.initUploadOptionSuccess&&r.initFileUpload()}),r.sysFile={businessId:r.suppletter.id,mainId:r.suppletter.id,mainType:i.mainTypeValue().SIGN,sysfileType:i.mainTypeValue().AADSUPP_FILE,sysBusiType:i.mainTypeValue().AADSUPP_FILE},i.initUploadOptions({inputId:"sysfileinput",vm:r,uploadSuccess:function(){i.findByBusinessId(r.suppletter.id,function(e){r.sysFilelists=e})}})},r.addSuppContent=function(){r.suppletter.id?(r.showsupp=!0,$("#addsuppletter").kendoWindow({width:"60%",height:"90%",title:"拟补资料函正文",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open(),i.findByBusinessId(r.suppletter.id,function(e){r.sysFilelists=e})):n.alert("请先保存业务数据")},r.saveAddSuppletter=function(){common.initJqValidation($("#suppletter_form")),$("#suppletter_form").valid()?t.saveSuppLetter(r.suppletter,r.isCommit,function(e){e.flag||"ok"==e.reCode?(r.suppletter=e.reObj,n.success("操作成功！")):n.error(e.reMsg)}):n.alert("表格填写不正确，请检查相应的必填项信息！")},r.comeBack=function(){o.go("addSuppletterList",{businessId:r.suppletter.businessId})},t.getAddSuppLetterById(r.suppletter.id,function(e){r.suppletter=e,r.initFileUpload()})}angular.module("app").controller("suppLetterViewCtrl",e),e.$inject=["$location","addSuppLetterSvc","sysfileSvc","$state","bsWin","$scope"]}(),function(){"use strict";function e(t,e,i){var o=this;function n(){e.agendaTaskGrid(o),e.workName(o)}o.title="待办任务",n(),o.query=function(){o.gridOptions.dataSource._skip=0,o.gridOptions.dataSource.read()},o.deleteTask=function(e){e?t.confirm("是否删除任务，删除数据不可恢复，操作请慎重！",function(){i.deleteFlow(e,"删除任务",function(e){e.flag||"ok"==e.reCode?t.alert("操作成功！",function(){o.gridOptions.dataSource.read()}):t.alert(e.reMsg)})}):t.alert("该流程已删除！",function(){n()})}}angular.module("app").controller("adminAgendaCtrl",e),e.$inject=["bsWin","adminSvc","flowSvc"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.title="待办项目",n.stateName=i.current.name,n.queryParams={},n.saveView=function(){o.storeView(n.stateName,{gridParams:n.gridOptions.dataSource.transport.options.read.data(),queryParams:n.queryParams,data:n})},function(){if(o.view[n.stateName]){var e=o.view[n.stateName];e.gridParams&&(n.gridParams=e.gridParams),e.data&&(n.model=e.data.model),e.queryParams&&(n.queryParams=e.queryParams),t.gtasksGrid(n),o.view[n.stateName]=void 0}else t.gtasksGrid(n)}(),n.querySign=function(){n.gridOptions.dataSource._skip=0,n.gridOptions.dataSource.read()},n.resetForm=function(){var e=$("#searchform").find("input,select");$.each(e,function(e,t){t.value=""})},n.countWorkday=function(){t.countWorakday(n)}}angular.module("app").filter("date",function(){return function(e){return e?new Date(e.CompatibleDate()).Format("yyyy-MM-dd"):""}}).controller("adminCtrl",e),e.$inject=["$location","adminSvc","$state","$rootScope"]}(),function(){"use strict";function e(e,t,i,o,n,a,r,s){var l=this;l.title="在办项目",l.model={},l.page=0,l.stateName=r.current.name,l.queryParams={},l.saveView=function(){s.storeView(l.stateName,{gridParams:l.gridOptions.dataSource.transport.options.read.data(),queryParams:l.queryParams,data:l})},function(){if(l.showwin=!1,s.view[l.stateName]){var e=s.view[l.stateName];console.log(e),e.gridParams&&(l.gridParams=e.gridParams),e.data&&(l.model=e.data.model),e.queryParams&&(l.queryParams=e.queryParams),t.dtasksGrid(l),s.view[l.stateName]=void 0}else t.dtasksGrid(l)}(),l.pauseProject=function(e){o.findPausingProject(l,e,"")},l.Checked=function(){$("#fileNo").is(":checked")&&($("#file1").prop("checked",!1),$("#file2").prop("checked",!1))},l.Checked2=function(){$("#fileNo").prop("checked",!1)},l.commitProjectStop=function(){o.pauseProject(l)},l.closewin=function(){window.parent.$("#spwindow").data("kendoWindow").close()},l.querySign=function(){l.gridOptions.dataSource._skip="",l.gridOptions.dataSource.read()},l.filterRuTask=function(e){e.target.checked?$("#query_signprocessState").val(9):$("#query_signprocessState").val(6),l.querySign()},l.formReset=function(){l.model={}},l.startProject=function(e){common.confirm({vm:l,title:"",msg:"确认激活吗？",fn:function(){$(".confirmDialog").modal("hide"),i.activeFlow(l,e)}})},l.deletProject=function(e){n.confirm({title:"询问提示",message:"确认删除该条项目吗？",onOk:function(){$(".confirmDialog").modal("hide"),a.deleteSign(e,function(e){e.flag||"ok"==e.reCode?n.alert("删除成功！",function(){l.gridOptions.dataSource.read()}):n.alert(e.reMsg)})}})}}angular.module("app").controller("adminDoingCtrl",e),e.$inject=["$location","adminSvc","flowSvc","pauseProjectSvc","bsWin","signSvc","$state","$rootScope"]}(),function(){"use strict";function e(t,e,i){var o=this;o.title="在办任务",o.stateName=e.current.name,o.queryParams={},o.saveView=function(){i.storeView(o.stateName,{gridParams:o.gridOptions.dataSource.transport.options.read.data(),queryParams:o.queryParams,data:o})},o.query=function(){o.gridOptions.dataSource._skip="",o.gridOptions.dataSource.read()},function(){if(i.view[o.stateName]){var e=i.view[o.stateName];e.gridParams&&(o.gridParams=e.gridParams),e.data&&(o.model=e.data.model),e.queryParams&&(o.queryParams=e.queryParams),t.doingTaskGrid(o),i.view[o.stateName]=void 0}else t.doingTaskGrid(o);t.workName(o)}()}angular.module("app").controller("adminDoTaskCtrl",e),e.$inject=["adminSvc","$state","$rootScope"]}(),function(){"use strict";function e(e,t){var i=this;i.title="办结事项",t.etasksGrid(i)}angular.module("app").controller("adminEndCtrl",e),e.$inject=["$location","adminSvc"]}(),function(){"use strict";function e(e,t,i,o,n,a){var r=this;r.title="个人经办项目",r.model={},r.stateName=n.current.name,r.queryParams={},r.saveView=function(){a.storeView(r.stateName,{gridParams:r.gridOptions.dataSource.transport.options.read.data(),queryParams:r.queryParams,data:r})},function(){if(r.showwin=!1,a.view[r.stateName]){var e=a.view[r.stateName];e.gridParams&&(r.gridParams=e.gridParams),e.data&&(r.model=e.data.model),e.queryParams&&(r.queryParams=e.queryParams),t.personMainTasksGrid(r),a.view[r.stateName]=void 0}else t.personMainTasksGrid(r)}()}angular.module("app").controller("adminPersonAssistCtrl",e),e.$inject=["$location","adminSvc","flowSvc","pauseProjectSvc","$state","$rootScope"]}(),function(){"use strict";function e(e,t,i,o,n,a){var r=this;r.title="个人经办项目",r.stateName=n.current.name,r.queryParams={},r.saveView=function(){a.storeView(r.stateName,{gridParams:r.gridOptions.dataSource.transport.options.read.data(),queryParams:r.queryParams,data:r})},function(){if(a.view[r.stateName]){var e=a.view[r.stateName];e.gridParams&&(r.gridParams=e.gridParams),e.data&&(r.model=e.data.model),e.queryParams&&(r.queryParams=e.queryParams),t.personMainTasksGrid(r),a.view[r.stateName]=void 0}else t.personMainTasksGrid(r)}(),r.querySign=function(){r.gridOptions.dataSource._skip=0,r.gridOptions.dataSource.read()},r.resetForm=function(){r.model={}},r.pauseProject=function(e){o.findPausingProject(r,e)},r.startProject=function(e){common.confirm({vm:r,title:"",msg:"确认激活吗？",fn:function(){$(".confirmDialog").modal("hide"),i.activeFlow(r,e)}})}}angular.module("app").controller("adminPersonDoingCtrl",e),e.$inject=["$location","adminSvc","flowSvc","pauseProjectSvc","$state","$rootScope"]}(),function(){"use strict";function e(n,o,a,r,e,t,i,s,l){var c=this;c.title="项目查询统计",c.currentAssociateSign={},c.signList={},c.headerList={},c.header="",c.project={},c.headerType="项目类型",c.fileName="项目统计报表",c.formatErrorCount=0,c.signList=[],c.page=0,c.template="1",c.stateName=r.current.name,c.queryParams={},c.saveView=function(){i.storeView(c.stateName,{gridParams:c.signListOptions.dataSource.transport.options.read.data(),queryParams:c.queryParams,data:c})},function(){if(i.view[c.stateName]){var e=i.view[c.stateName];e.gridParams&&(c.gridParams=e.gridParams),e.data&&(c.project=e.data.project),e.queryParams&&(c.queryParams=e.queryParams),o.getSignList(c),i.view[c.stateName]=void 0}else o.getSignList(c);o.initSignList(function(e){(e.flag||"ok"==e.reCode)&&(c.orgDeptList=e.reObj)}),l.findAllUsers(c,function(e){c.userlist={},c.userlist=e})}(),c.formReset=function(){c.project={}},c.searchSignList=function(){c.signListOptions.dataSource._skip=0,c.signListOptions.dataSource.read();var e=$("input[name='mUserName']").val(),t=$("input[name='aUserName']").val(),i=$("input[name='allPriUser']").val();if(e?c.project.mUserName=e:t?c.project.aUserName=t:i&&(c.project.allPriUser=i),c.filters=c.project,c.filters&&null!=c.filters){var o=JSON.stringify(c.filters);c.filters=o.substring(1,o.length-1)}c.signList=[],c.page=0},c.statistical=function(){},c.excelExport=function(){for(var e=[],t=0;t<c.signList.length;t++)e.push(c.signList[t].signid);var i=e.join(",");"1"==c.template?n.excelExport2(i):"2"==c.template&&n.excelExport(i)},c.excelDefineExport=function(){for(var e=[],t=0;t<c.signList.length;t++)e.push(c.signList[t].signid);var i=e.join(",");n.excelExport(i)},c.ProjectStopInfo=function(e){r.go("projectStopInfo",{signId:e})},c.statistics=function(){o.QueryStatistics(c,function(e){null!=e&&e.forEach(function(e,t){c.signList.push(e),null==e.receivedate&&c.formatErrorCount++}),c.isContinue&&null!=e&&0!=e.length&&(c.page++,c.statistics()),c.countProject=c.signList.length})},c.QueryStatistics=function(){c.formatErrorCount=0,c.countReviewDay=0,c.notSelectedProject=0,c.selectedProject=0,c.totalReviewDas=0,c.averageDay=0,c.avgWorkDay=0,c.countProject=0,c.selectProject=0,c.averageDay=0,c.isopens=!1,c.isContinue=!0,c.filters&&null!=c.filters||(c.filters=""),c.statistics(),$("#queryStatisticsWindow").kendoWindow({width:"80%",height:"700px",title:"项目查询统计",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"],open:function(){c.countDay=function(){c.countReviewDay=0,c.stopDay=0;var e=$("#countSignDayTable input[name='sumSignDay']:checked");if(c.selectedProject=e.length,c.notSelectedProject=c.countProject-c.selectedProject,(c.averageDay=0)==e.length)a.alert("请选择要统计的数据");else{for(var t=[],i=e.length,o=0;o<i;o++)t.push(e[o].id);n.findAVGDayById(t,function(e){c.isopens=!0,c.isDay=!0,c.totalReviewDas=e.reObj[0],c.averageDay=e.reObj[1],c.avgWorkDay=e.reObj[2]})}},c.countWork=function(){var e=$("#countSignDayTable input[name='sumSignDay']:checked");if(c.selectProject=e.length,(c.averageDay=0)==e.length)a.alert("请选择要统计的数据");else{for(var t=0,i=e.length,o=0;o<i;o++)t+=Number(e[o].value);c.averageDay=(t/i).toFixed(2),c.isopens=!0,c.isDay=!1}}},close:function(){c.isContinue=!1,c.signList=[],c.page=0}}).data("kendoWindow").center().open()},c.selectHeader=function(){e.selectHeaderWindow(c,c.headerType)},c.signDetails=function(t,i){c.saveView(),o.signDetails(t,function(e){e.flag?r.go("signDetails",{signid:t,processInstanceId:i}):a.alert(e.reMsg)})}}angular.module("app").controller("adminSignListCtrl",e),e.$inject=["signSvc","adminSvc","bsWin","$state","headerSvc","pauseProjectSvc","$rootScope","$scope","roomCountSvc"]}(),function(){"use strict";function e(e,o,t){return{gtasksGrid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/flow/html/tasks",$("#searchform"),e.gridParams),schema:{data:"value",total:function(e){return e.count?$("#DO_SIGN_COUNT").html(e.count):$("#DO_SIGN_COUNT").html(0),e.count},model:{id:"id",fields:{createdDate:{type:"date"}}}},serverPaging:!1,serverSorting:!1,serverFiltering:!1,pageSize:e.queryParams.pageSize||10,page:e.queryParams.page||1,sort:{field:"createdDate",dir:"desc"}}),i=[{field:"",title:"",width:30,template:function(e){switch(e.lightState){case"4":return $("#span1").html();case"5":return $("#span2").html();case"6":return $("#span3").html();case"7":return $("#span4").html();case"8":return $("#span5").html();case"1":case"2":case"3":default:return""}}},{field:"",title:"序号",width:50,attributes:{class:"table-cell",style:"text-align: center"},template:"<span class='row-number'></span>"},{field:"",title:"项目名称",filterable:!1,width:200,template:function(e){return n(e)?9==e.isAgent?'<span class="label label-primary">代办</span><a ng-click="vm.saveView()" href="#/signFlowDetail/'+e.businessKey+"/"+e.taskId+"/"+e.processInstanceId+'" >'+e.projectName+"</a>":'<a ng-click="vm.saveView()" href="#/signFlowDetail/'+e.businessKey+"/"+e.taskId+"/"+e.processInstanceId+'" >'+e.projectName+"</a>":9==e.isAgent?'<span class="label label-primary">代办</span><a ng-click="vm.saveView()" href="#/signFlowDeal/'+e.businessKey+"/"+e.taskId+"/"+e.processInstanceId+'" >'+e.projectName+"</a>":'<a ng-click="vm.saveView()" href="#/signFlowDeal/'+e.businessKey+"/"+e.taskId+"/"+e.processInstanceId+'" >'+e.projectName+"</a>"}},{field:"reviewStage",title:"项目阶段",filterable:!1,width:100},{field:"nodeNameValue",title:"当前环节",width:120,filterable:!1},{field:"preSignDate",title:"预签收时间",width:100,filterable:!1,format:"{0: yyyy-MM-dd}"},{field:"signDate",title:"签收时间",width:100,filterable:!1,format:"{0: yyyy-MM-dd}"},{field:"",title:"签收状态",width:100,filterable:!1,template:function(e){return e.signDate?"<span style='color: #2b9d00;'>正式签收</span>":e.preSignDate?"<span style='color:#ff0000;'>预签收</span>":""}},{field:"allPriUser",title:"项目负责人",width:140,filterable:!1},{field:"",title:"剩余工作日",width:100,filterable:!1,template:function(e){return null!=e.surplusDays?e.surplusDays:""}},{field:"displayName",title:"处理人",width:120,filterable:!1},{field:"",title:"状态",width:80,filterable:!1,template:function(e){return e.processState&&2==e.processState?'<span style="color:orange;">已暂停</span>':'<span style="color:green;">进行中</span>'}},{field:"",title:"合并评审",width:120,filterable:!1,template:function(e){return e.reviewType?9==e.reviewType||"9"==e.reviewType?"合并评审[主项目]":"合并评审[次项目]":"否"}},{field:"",title:"合并项目",width:180,filterable:!1,template:function(e){if(e.reviewSignDtoList){var o="";return angular.forEach(e.reviewSignDtoList,function(e,t,i){0<t&&(o+=","),o+='<a href="#/signDetails/'+e.signid+"/"+e.processInstanceId+'" >'+e.projectname+"</a>"}),o}return""}},{field:"",title:"操作",width:80,template:function(e){return n(e)?common.format($("#detailBtns").html(),"signFlowDetail",e.businessKey,e.taskId,e.processInstanceId):common.format($("#columnBtns").html(),"signFlowDeal",e.businessKey,e.taskId,e.processInstanceId)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,pageable:common.kendoGridConfig(e.queryParams).pageable,dataBound:common.kendoGridConfig(e.queryParams).dataBound}},etasksGrid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/flow/html/endTasks"),schema:{data:"value",total:function(e){return e.count},model:{id:"id",fields:{createdDate:{type:"date"}}}},serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{field:"",title:"序号",template:"<span class='row-number'></span>",width:50},{field:"projectname",title:"项目名称",filterable:!1,width:180},{field:"builtcompanyname",title:"建设单位",width:150,filterable:!1},{field:"reviewstage",title:"评审阶段",width:80,filterable:!1},{field:"signdate",title:"签收日期",width:100,filterable:!1,format:"{0: yyyy-MM-dd}"},{field:"reviewdays",title:"评审天数",width:150,filterable:!1},{field:"",title:"操作",width:100,template:function(e){return common.format($("#columnBtns").html(),e.isAppraising,e.signid,"endSignDetail",e.signid,e.processInstanceId,e.mUserName)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})}}},dtasksGrid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/flow/html/doingtasks",$("#searchform"),e.gridParams),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!1,serverSorting:!1,serverFiltering:!1,pageSize:e.queryParams.pageSize||10,page:e.queryParams.page||1,sort:{field:"createdDate",dir:"desc"}}),i=[{field:"",title:"",width:30,template:function(e){switch(e.lightState){case"4":return $("#span1").html();case"5":return $("#span2").html();case"6":return $("#span3").html();case"7":return $("#span4").html();case"8":return $("#span5").html();case"1":case"2":case"3":default:return""}}},{field:"",title:"序号",width:50,attributes:{style:"text-align: center;"},template:function(e){return e.signprocessState?6==e.signprocessState?"<span class='row-number label-info' style='width: 100%;display: inline-block;'></span>":7==e.signprocessState?"<span class='row-number label-primary' style='width: 100%;display: inline-block;'></span>":8==e.signprocessState?"<span class='row-number label-success' style='width: 100%;display: inline-block;'></span>":"<span class='row-number'></span>":"<span class='row-number'></span>"}},{field:"",title:"项目名称",filterable:!1,width:260,template:function(e){return'<a ng-click="vm.saveView()" href="#/signFlowDetail/'+e.businessKey+"/"+e.taskId+"/"+e.processInstanceId+'" >'+e.projectName+"</a>"}},{field:"reviewStage",title:"项目阶段",filterable:!1,width:120},{field:"nodeNameValue",title:"办理环节",filterable:!1,width:120},{field:"signDate",title:"签收时间",width:100,filterable:!1,format:"{0: yyyy-MM-dd}"},{field:"",title:"签收状态",width:100,filterable:!1,template:function(e){return e.signDate?"<span style='color: #2b9d00;'>正式签收</span>":e.preSignDate?"<span style='color:#ff0000;'>预签收</span>":""}},{field:"expectdispatchdate",title:"预发文时间",width:100,filterable:!1,format:"{0: yyyy-MM-dd}"},{field:"",title:"剩余工作日",width:100,filterable:!1,template:function(e){return null!=e.surplusDays?e.surplusDays:""}},{field:"",title:"评审部门",width:160,filterable:!1,template:function(e){return e.mOrgName?e.aOrgName?e.mOrgName+","+e.aOrgName:e.mOrgName:""}},{field:"allPriUser",title:"项目负责人",width:160,filterable:!1},{field:"",title:"项目状态",width:90,filterable:!1,template:function(e){return e.processState&&2==e.processState?'<span style="color:orange;">已暂停</span>':'<span style="color:green;">进行中</span>'}},{field:"preSignDate",title:"预签收时间",width:100,filterable:!1,format:"{0: yyyy-MM-dd}"},{field:"",title:"操作",width:130,template:function(e){return common.format($("#columnBtns").html(),"signFlowDetail",e.businessKey,e.taskId,e.processInstanceId)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig(e.queryParams).pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,dataBound:common.kendoGridConfig(e.queryParams).dataBound}},doingTaskGrid:function(e){var t=common.kendoGridDataSource(rootPath+"/flow/queryAgendaTask",$("#doingTaskForm"),e.queryParams.page,e.queryParams.pageSize,e.gridParams),i=[{field:"",title:"序号",template:"<span class='row-number'></span>",width:50},{field:"",title:"任务名称",filterable:!1,width:"30%",template:function(e){return'<a ng-click="vm.saveView()" href="#/flowDetail/'+e.businessKey+"/"+e.processKey+"/"+e.taskId+"/"+e.instanceId+'" >'+e.instanceName+"</a>"}},{field:"nodeNameValue",title:"当前环节",width:"20%",filterable:!1},{field:"displayName",title:"处理人",width:"15%",filterable:!1},{field:"processName",title:"流程类别",width:"25%",filterable:!1},{field:"",title:"流程状态",width:"10%",filterable:!1,template:function(e){return e.processState&&2==e.processState?'<span style="color:orange;">已暂停</span>':'<span style="color:green;">进行中</span>'}},{field:"",title:"操作",width:"10%",template:function(e){return common.format($("#columnBtns").html(),e.businessKey,e.processKey,e.taskId,e.instanceId)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,pageable:common.kendoGridConfig(e.queryParams).pageable,dataBound:common.kendoGridConfig(e.queryParams).dataBound}},personMainTasksGrid:function(e){var t=common.kendoGridDataSource(rootPath+"/signView/html/personMainTasks?$orderby=signdate desc",$("#searchform"),e.queryParams.page,e.queryParams.pageSize,e.gridParams),i=[{field:"",title:"",width:30,template:function(e){switch(e.lightState){case"4":return $("#span1").html();case"5":return $("#span2").html();case"6":return $("#span3").html();case"7":return $("#span4").html();case"8":return $("#span5").html();case"1":case"2":case"3":default:return""}}},{field:"",title:"序号",width:50,attributes:{style:"text-align: center;"},template:function(e){return e.processState?6==e.processState?"<span class='row-number label-info' style='width: 100%;display: inline-block;'></span>":7==e.processState?"<span class='row-number label-primary' style='width: 100%;display: inline-block;'></span>":8==e.processState?"<span class='row-number label-success' style='width: 100%;display: inline-block;'></span>":"<span class='row-number'></span>":"<span class='row-number'></span>"}},{field:"",title:"项目名称",width:320,filterable:!1,template:function(e){return e.processInstanceId?'<a ng-click="vm.saveView()" href="#/signDetails/'+e.signid+"/"+e.processInstanceId+'" >'+e.projectname+"</a>":'<a ng-click="vm.saveView()" href="#/signDetails/'+e.signid+'/" >'+e.projectname+"</a>"}},{field:"reviewstage",title:"评审阶段",width:100,filterable:!1},{field:"",title:"项目状态",width:80,filterable:!1,template:function(e){var t="";switch(e.signState){case"1":t="进行中";break;case"2":t="暂停";break;case"8":t="强制结束";break;case"9":t="已完成"}return t}},{field:"",title:"签收时间",width:100,filterable:!1,template:function(e){return e.signdate?new Date(e.signdate.CompatibleDate()).Format("yyyy-MM-dd"):""}},{field:"",title:"发文日期",width:100,filterable:!1,template:function(e){return e.dispatchDate?new Date(e.dispatchDate.CompatibleDate()).Format("yyyy-MM-dd"):""}},{field:"",title:"剩余工作日",width:100,filterable:!1,template:function(e){return null!=e.surplusdays?e.surplusdays:""}},{field:"builtcompanyname",title:"建设单位",width:250,filterable:!1},{field:"",title:"操作",width:100,template:function(e){var t=!1,i=!0,o=!1;return"2"==e.signState?t=!0:"1"==e.signState&&(o=!0),9==e.signState&&angular.isUndefined(e.isAppraising)&&(i=!1),common.format($("#columnBtns").html(),"signDetails",e.signid,e.processInstanceId,"vm.pauseProject('"+e.signid+"')",o,"vm.startProject('"+e.signid+"')",t,e.signid,i)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,pageable:common.kendoGridConfig(e.queryParams).pageable,dataBound:common.kendoGridConfig(e.queryParams).dataBound}},countWorakday:function(e){var t={method:"get",url:rootPath+"/workday/countWorkday"};common.http({vm:e,$http:o,httpOptions:t,success:function(e){}})},agendaTaskGrid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/flow/queryMyAgendaTask",$("#agendaTaskForm")),schema:{data:"value",total:function(e){return e.count?$("#DO_TASK_COUNT").html(e.count):$("#DO_TASK_COUNT").html(0),e.count},model:{id:"taskId"}},serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createTime",dir:"desc"}}),i=[{field:"",title:"序号",template:"<span class='row-number'></span>",width:50},{field:"",title:"任务名称",filterable:!1,width:"25%",template:function(e){return'<a href="#/flowDeal/'+e.businessKey+"/"+e.processKey+"/"+e.taskId+"/"+e.instanceId+'" >'+e.instanceName+"</a>"}},{field:"nodeNameValue",title:"当前环节",width:"15%",filterable:!1},{field:"displayName",title:"处理人",width:"15%",filterable:!1},{field:"processName",title:"流程类别",width:"15%",filterable:!1},{field:"",title:"流程状态",width:"10%",filterable:!1,template:function(e){return e.processState&&2==e.processState?'<span style="color:orange;">已暂停</span>':'<span style="color:green;">进行中</span>'}},{field:"",title:"操作",width:"15%",template:function(e){return common.format($("#columnBtns").html(),e.businessKey,e.processKey,e.taskId,e.instanceId,"vm.deleteTask('"+e.instanceId+"')")}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})}}},initFile:function(t){var e={method:"get",url:rootPath+"/file/findByBusinessId",params:{businessId:t.anId}};common.http({vm:t,$http:o,httpOptions:e,success:function(e){t.file=e.data}})},upload:function(e,t){window.open(rootPath+"/file/fileDownload?sysfileId="+t)},getSignList:function(e){var t=common.kendoGridDataSource(rootPath+"/signView/getSignList",$("#searchform"),e.queryParams.page,e.queryParams.pageSize,e.gridParams),i=[{field:"",title:"",width:30,template:function(e){switch(e.lightState){case"4":return $("#span1").html();case"5":return $("#span2").html();case"6":return $("#span3").html();case"7":return $("#span4").html();case"8":return $("#span5").html();case"1":case"2":case"3":default:return""}}},{field:"",title:"序号",width:50,attributes:{style:"text-align: center;"},template:function(e){return e.processState?6==e.processState?"<span class='row-number label-info' style='width: 100%;display: inline-block;'></span>":7==e.processState?"<span class='row-number label-primary' style='width: 100%;display: inline-block;'></span>":8==e.processState?"<span class='row-number label-success' style='width: 100%;display: inline-block;'></span>":9==e.processState?"<span class='row-number label-default' style='width: 100%;display: inline-block;'></span>":"<span class='row-number'></span>":"<span class='row-number'></span>"}},{field:"",title:"项目名称",width:280,filterable:!1,template:function(e){return"秘密"==e.secrectlevel||e.processState<6?e.processInstanceId?"<a ng-click=\"vm.signDetails('"+e.signid+"','"+e.processInstanceId+"')\" >"+e.projectname+"</a>":"<a ng-click=\"vm.signDetails('"+e.signid+"','')\" >"+e.projectname+"</a>":e.processInstanceId?'<a ng-click="vm.saveView()" href="#/signDetails/'+e.signid+"/"+e.processInstanceId+'" >'+e.projectname+"</a>":'<a ng-click="vm.saveView()" href="#/signDetails/'+e.signid+'/" >'+e.projectname+"</a>"}},{field:"reviewstage",title:"评审阶段",width:110,filterable:!1},{field:"signdate",title:"签收日期",width:100,filterable:!1,format:"{0:yyyy-MM-dd}"},{field:"dispatchDate",title:"发文日期",width:100,filterable:!1,format:"{0:yyyy-MM-dd}"},{field:"reviewdays",title:"评审天数",width:90,filterable:!1},{field:"",title:"剩余工作日",width:100,filterable:!1,template:function(e){return null!=e.surplusdays?e.surplusdays:""}},{field:"",title:"评审部门",width:140,filterable:!1,template:function(e){return e.aOrgName?e.mOrgName+","+e.aOrgName:e.mOrgName?e.mOrgName:""}},{field:"allPriUser",title:"项目负责人",width:110,filterable:!1},{field:"ffilenum",title:"归档编号",width:125,filterable:!1},{field:"dfilenum",title:"文件字号",width:130,filterable:!1},{field:"appalyInvestment",title:"申报投资",width:100,filterable:!1},{field:"authorizeValue",title:"审定投资",width:100,filterable:!1},{field:"extraValue",title:"核减（增）",width:100,filterable:!1},{field:"extraRate",title:"核减率",width:100,filterable:!1},{field:"approveValue",title:"批复金额",width:140,filterable:!1},{field:"dispatchType",title:"发文类型",width:100,filterable:!1},{field:"fileDate",title:"归档日期",width:100,filterable:!1,format:"{0:yyyy-MM-dd}"},{field:"builtcompanyname",title:"建设单位",width:260,filterable:!1},{field:"isassistproc",title:"是否协审",width:80,filterable:!1,template:function(e){return 9==e.isassistproc?"是":"否"}},{field:"daysafterdispatch",title:"发文后工作日",width:120,filterable:!1},{field:"",title:"操作",width:90,filterable:!1,template:function(e){return"2"==e.signState?common.format($("#columnBtns").html(),"vm.ProjectStopInfo('"+e.signid+"')"):""}}];e.signListOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:{pageSize:10,previousNext:!0,buttonCount:5,refresh:!0,pageSizes:[10,20,30,50],change:function(){e.queryParams&&e.queryParams.page&&(e.queryParams.page=this.dataSource.page())}},noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,dataBound:common.kendoGridConfig(e.queryParams).dataBound}},initSignList:function(t){var e={method:"post",url:rootPath+"/sign/initSignList"};common.http({$http:o,httpOptions:e,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},getHomeInfo:function(t){var e={method:"post",url:rootPath+"/admin/getHomeInfo"};common.http({$http:o,httpOptions:e,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},getHomeProjInfo:function(t){var e={method:"post",url:rootPath+"/admin/getHomeProjInfo"};common.http({$http:o,httpOptions:e,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},getHomeMeetInfo:function(t){var e={method:"post",url:rootPath+"/admin/getHomeMeetInfo"};common.http({$http:o,httpOptions:e,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},excelExport:function(e,t,i){var t=escape(encodeURIComponent(t));window.open(rootPath+"/signView/excelExport?filterData="+i+"&fileName="+t)},statisticalGrid:function(e){e.dataSource=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/signView/getSignList",$("#searchform")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!1,serverSorting:!0,serverFiltering:!0,sort:{field:"createdDate",dir:"desc"}})},workName:function(t){var e={method:"get",url:rootPath+"/flow/proc"};common.http({vm:t,$http:o,httpOptions:e,success:function(e){t.workName=e.data}})},QueryStatistics:function(e,t){var i={method:"post",url:rootPath+"/signView/QueryStatistics",params:{queryData:e.filters,page:e.page}};common.http({vm:e,$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},signDetails:function(e,t){var i={method:"post",url:rootPath+"/signView/findSecretProPermission",params:{signId:e}};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}};function n(e){var t=2==e.processState;return t||e.reviewType&&(0==e.reviewType||"0"==e.reviewType)&&0<=$.inArray(e.nodeDefineKey,["SIGN_BMLD_SPW1","SIGN_FGLD_SPW1"])&&(t=!0),t||e.mergeDis&&2==e.mergeDis&&0==e.mergeDisMain&&0<=$.inArray(e.nodeDefineKey,["SIGN_QRFW","SIGN_BMLD_QRFW","SIGN_FGLD_QRFW","SIGN_ZR_QRFW"])&&(t=!0),t}}angular.module("app").factory("adminSvc",e),e.$inject=["$rootScope","$http","bsWin"]}(),function(){"use strict";function e(e,t,o){var d=this;function u(e){var t;if(function(e){if(null==e||void 0===e)return!0;return!1}(e))t=new Date;else{var i=e.split("-");t=new Date(i[0],parseInt(i[1]-1),i[2])}var o=t.getDay();return"星期"+"日一二三四五六".charAt(o)}d.title="主页",d.isdisplays=!1,d.timeHeadArr=[],d.timeArr=[],d.initHistogram=function(){var e=echarts.init(document.getElementById("histogram")),t={title:{text:"在办项目数量统计情况",subtext:"",x:"center"},tooltip:{trigger:"item",formatter:function(e){var a=e.name,r="";return d.histogram&&$.each(d.histogram,function(e,t){if(e==a)for(var i=0,o=t.TASK_LIST.length;i<o;i++){var n=t.TASK_LIST[i];0<i&&(r+="<br>"),r+=n.projectName}}),r}},legend:{orient:"vertical",left:"left",data:d.capital},grid:{left:"13%",right:"10%",bottom:"10%",containLabel:!0},xAxis:{type:"category",name:"人员/部门",data:d.review,axisTick:{alignWithLabel:!0},axisLabel:{interval:0,rotate:30,margin:2,textStyle:{fontWeight:"bolder",color:"#295645"}}},yAxis:{type:"value",name:"数量",min:0},series:[{name:"数量",type:"bar",barWidth:30,data:d.signNumber}],itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0,0,0,0.5)"}}};e.setOption(t)},d.initLineChart=function(){var e=echarts.init(document.getElementById("lineChart")),i={title:{text:"项目办理情况",subtext:"",x:"center"},tooltip:{trigger:"axis",formatter:function(e){var t=i.series[e[0].seriesIndex].rawdate[e[0].dataIndex].split(",");return"项目名称："+e[0].name+"<br/>剩余工作日:"+t[0]}},grid:{left:"13%",right:"10%",bottom:"10%",containLabel:!0},xAxis:{show:!1,type:"category",boundaryGap:!1,name:"项目名称",axisLine:{onZero:!1},data:d.reviewdate},yAxis:{type:"value",name:"剩余工作日",min:-3,max:15},series:[{name:"剩余工作日",type:"line",showAllSymbol:!0,markPoint:{data:[{type:"max",name:"最大值"},{type:"min",name:"最小值"}]},markLine:{data:[{type:"average",name:"平均值"}]},data:d.linedatas,rawdate:d.name}],lineStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0,0,0,0.5)"}}};e.setOption(i),e.on("click",function(e){var t=i.series[e.seriesIndex].rawdate[e.dataIndex].split(",");o.go("signDetails",{signid:t[1],processInstanceId:t[2]})})},function(){for(var e=new Date,t=0;t<5;t++)d.timeArr.push((i=t,a=void 0,o=e.getTime(),n=o+(i=24*i*3600*1e3),a=new Date(n),r=a.getFullYear(),s=a.getMonth()+1,l=a.getDate(),r+"-"+s+"-"+l));for(var i,o,n,a,r,s,l,c,t=0;t<d.timeArr.length;t++)d.timeHeadArr.push((c=(c=d.timeArr[t]).split("-"))[1].replace(/\b(0+)/gi,"")+"月"+c[2]+"("+u(d.timeArr[t])+")")}(),t.getHomeInfo(function(e){e.annountmentList&&(d.annountmentList=e.annountmentList),e.comTaskList&&(d.agendaTaskList=e.comTaskList)}),t.getHomeProjInfo(function(e){if(d.hidePreTable=!0,d.isdisplays=!0,e&&(e.proTaskList&&(d.tasksList=e.proTaskList),e.endTaskList&&(d.endTasksList=e.endTaskList),e.DOINGNUM&&(d.doingNum=e.DOINGNUM),e.DISPATHOVERNUM&&(d.dispathNum=e.DISPATHOVERNUM),e.STOPNUM&&(d.stopNum=e.STOPNUM),e.WEEKNUM&&(d.weekNum=e.WEEKNUM),d.isdisplays=e.isdisplay,!e.isdisplay)){if(d.linedatas=[],d.reviewdate=[],d.name=[],e.lineSign)for(var t=e.lineSign,i=0,o=t.length;i<o;i++){var n=t[i].surplusDays;n<-3&&(n=-3),15<n&&(n=15),null==n&&(n=0),d.linedatas.push(n),d.reviewdate.push(t[i].projectName),d.name.push(t[i].surplusDays+","+t[i].businessKey+","+t[i].processInstanceId)}d.initLineChart();var a=[],r=[];d.histogram=e.histogram,d.histogram&&$.each(d.histogram,function(e,t){var i=t;a.push(e),r.push(i.COUNT)}),d.review=a,d.signNumber=r,d.initHistogram(),e.preHistogram?(d.preHistogram=e.preHistogram,d.preHistogram&&(d.hidePreTable=!1)):d.hidePreTable=!0}}),t.getHomeMeetInfo(function(e){e.proMeetInfo.proAmMeetDtoList&&(d.proAmMeetDtoList=e.proMeetInfo.proAmMeetDtoList),e.proMeetInfo.proPmMeetDtoList&&(d.proPmMeetDtoList=e.proMeetInfo.proPmMeetDtoList)})}angular.module("app").controller("adminWelComeCtrl",e),e.$inject=["bsWin","adminSvc","$state"]}(),function(){"use strict";function e(e,t,n,a,i,o){var r=this;r.title="通知公告管理",r.stateName=t.current.name,r.queryParams={},r.saveView=function(){o.storeView(r.stateName,{gridParams:r.gridOptions.dataSource.transport.options.read.data(),queryParams:r.queryParams,data:r})},function(){if(o.view[r.stateName]){var e=o.view[r.stateName];e.gridParams&&(r.gridParams=e.gridParams),e.data&&(r.model=e.data.model),e.queryParams&&(r.queryParams=e.queryParams),a.grid(r),o.view[r.stateName]=void 0}else a.grid(r)}(),r.bathIssue=function(){a.updateIssueState(r,"9")},r.bathUnissue=function(){a.updateIssueState(r,"0")},r.del=function(e){n.confirm({title:"询问提示",message:"确认删除数据吗?",onOk:function(){a.deleteAnnountment(e,function(e){e.flag||"ok"==e.reCode?(r.gridOptions.dataSource.read(),n.alert("操作成功！")):n.alert(e.reMsg)})}})},r.dels=function(){var o=common.getKendoCheckId(".grid");0==o.length?n.alert("请选择要删除的记录"):n.confirm({title:"询问提示",message:"确认删除数据吗?",onOk:function(){for(var e=[],t=0;t<o.length;t++)e.push(o[t].value);var i=e.join(",");a.deleteAnnountment(i,function(e){e.flag||"ok"==e.reCode?n.alert("操作成功！",function(){r.gridOptions.dataSource.read()}):n.alert(e.reMsg)})}})},r.detail=function(e){e&&(r.saveView(),t.go("annountmentDetail",{id:e}))},r.queryAnnountment=function(){r.gridOptions.dataSource._skip="",r.gridOptions.dataSource.read()},r.resetAnnountment=function(){var e=$("#annountmentform").find("input,select");$.each(e,function(e,t){t.value=""})}}angular.module("app").controller("annountmentCtrl",e),e.$inject=["$location","$state","bsWin","annountmentSvc","sysfileSvc","$rootScope"]}(),function(){"use strict";function e(t,e,i){var o=this;o.title="通知公告详情页",o.annountment={},o.annountment.anId=e.params.id,i.findDetailById(o,o.annountment.anId),o.post=function(e){i.findDetailById(o,e)},o.next=function(e){i.findDetailById(o,e)},o.downloadSysFile=function(e){t.downloadFile(e)},o.alertwd=function(){$("section").addClass("cont-alert")},o.closed=function(){$("section").removeClass("cont-alert")},o.printNotice=function(){var e=getLodop(),t="<head>"+("<link href="+(rootPath+"/contents/shared/annountmentPrint.css")+" type='text/css' rel='stylesheet'>")+"</head><body>"+$("#annountment-body").html()+"</body>";e.PRINT_INIT(""),e.ADD_PRINT_HTML(10,20,"100%","100%",t),e.PREVIEW()}}angular.module("app").controller("annountmentDetailCtrl",e),e.$inject=["sysfileSvc","$state","annountmentSvc"]}(),function(){"use strict";function e(t,i,e,o,n){var a=this;a.title="通知公告编辑",a.annountment={},a.annountment.anId=t.params.id,a.editor=void 0,a.businessFlag={isInitFileOption:!1},a.initFileUpload=function(){a.annountment.anId||o.$watch("vm.annountment.anId",function(e,t){e&&e!=t&&!a.initUploadOptionSuccess&&a.initFileUpload()}),a.sysFile={businessId:a.annountment.anId,mainId:a.annountment.anId,mainType:"通知公告",sysBusiType:"",showBusiType:!1},e.initUploadOptions({inputId:"sysfileinput",vm:a,uploadSuccess:function(){e.findByBusinessId(a.annountment.anId,function(e){a.sysFilelists=e})}})},a.isNeed="1",a.editor=new UE.ui.Editor,a.editor.render("editor"),a.annountment.anId?(a.isUpdate=!0,i.findAnnountmentById(a,function(e){a.annountment=e,a.initFileUpload(),a.editor.ready(function(){null!=a.annountment.anContent&&a.editor.setContent(a.annountment.anContent)})}),e.findByBusinessId(a.annountment.anId,function(e){a.sysFilelists=e})):a.initFileUpload(),a.create=function(){i.createAnnountment(a,function(e){e.flag||"ok"==e.reCode?n.alert("保存成功！",function(){t.go("annountmentEdit",{id:e.reObj.anId},{reload:!0})}):n.alert(e.reMsg)})},a.update=function(){i.updateAnnountment(a,function(e){a.isSubmit=!1,n.alert("操作成功！")})},a.startNewFlow=function(){n.confirm({title:"询问提示",message:"确认已经完成填写，并且发起流程么？",onOk:function(){a.annountment.anId?i.updateAnnountment(a,function(e){i.startFlow(a.annountment.anId,function(e){e.flag||"ok"==e.reCode?n.success("操作成功！",function(){t.go("annountment")}):n.error(e.reMsg)})}):i.createAnnountment(a,function(e){a.id=e.reObj.anId,i.startFlow(a.id,function(e){e.flag||"ok"==e.reCode?n.success("操作成功！",function(){t.go("annountment")}):n.error(e.reMsg)})})}})}}angular.module("app").controller("annountmentEditCtrl",e),e.$inject=["$state","annountmentSvc","sysfileSvc","$scope","bsWin"]}(),function(){"use strict";function e(r,s,o){var n=rootPath+"/annountment";return{grid:function(e){var t=common.kendoGridDataSource(rootPath+"/annountment/fingByCurUser",$("#annountmentform"),e.queryParams.page,e.queryParams.pageSize,e.gridParams),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.anId)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"unitSort",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"",title:"标题",width:300,filterable:!1,template:function(e){return e.processInstanceId?'<a href="#/flowDetail/'+e.anId+"/ANNOUNT_MENT_FLOW//"+e.processInstanceId+'" >'+e.anTitle+"</a>":e.anTitle}},{field:"",title:"是否置顶",width:100,filterable:!1,template:function(e){return e.isStick&&9==e.isStick?"是":"否"}},{field:"",title:"是否审批",width:100,filterable:!1,template:function(e){return e.processInstanceId?"是":"否"}},{field:"",title:"审批结果",width:100,filterable:!1,template:function(e){return e.appoveStatus?"9"!=e.appoveStatus?"审批中":"9"==e.appoveStatus&&"9"==e.issue?"<span style='color: green'>审批通过</span>":"9"==e.appoveStatus&&"9"!=e.issue?"<span style='color: red'>审批不通过</span>":void 0:""}},{field:"",title:"发布状态",width:100,template:function(e){return e.issue&&"9"==e.issue?"已发布":"未发布"}},{field:"issueDate",title:"发布时间",format:"{0:yyyy-MM-dd hh24:mm:ss}",width:160,filterable:!1},{field:"",title:"操作",width:150,template:function(e){var t=!0,i=!0;return("9"==e.issue||e.processInstanceId)&&(t="0"==e.issue&&"9"==e.appoveStatus),e.processInstanceId&&(i="0"==e.issue&&"9"==e.appoveStatus),common.format($("#columnBtns").html(),"vm.detail('"+e.anId+"')",e.anId,i,"vm.del('"+e.anId+"')",t)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,pageable:common.kendoGridConfig(e.queryParams).pageable,dataBound:common.kendoGridConfig(e.queryParams).dataBound,columns:i,resizable:!0}},createAnnountment:function(t,i){if(t.annountment.anContent=t.editor.getContent(),common.initJqValidation(),$("#form").valid()){t.isSubmit=!0;var e={method:"post",url:rootPath+"/annountment",data:t.annountment};common.http({$http:r,httpOptions:e,success:function(e){t.isSubmit=!1,null!=i&&"function"==typeof i&&i(e.data)},onError:function(){t.isSubmit=!1}})}},initAnOrg:function(t){var e={method:"get",url:n+"/initAnOrg"};common.http({vm:t,$http:r,httpOptions:e,success:function(e){t.annountment.anOrg="",t.annountment.anOrg=e.data.substring(1,e.data.length-1)}})},findAnnountmentById:e,updateIssueState:function(t,e){var i=common.getKendoCheckId(".grid");if(0==i.length)s.alert("请选择要修改的数据");else{for(var o=[],n=0;n<i.length;n++)o.push(i[n].value);var a={method:"post",url:rootPath+"/annountment/updateIssueState",params:{ids:o.join(","),issueState:e}};common.http({$http:r,httpOptions:a,success:function(e){t.isSubmit=!1,e.data.flag||"ok"==e.data.reCode?s.alert("操作成功！",function(){t.gridOptions.dataSource.read()}):s.alert(e.data.reMsg)}})}},updateAnnountment:function(t,i){t.isSubmit=!0,t.annountment.anContent=t.editor.getContent();var e={method:"put",url:n,data:t.annountment};common.http({$http:r,httpOptions:e,success:function(e){null!=i&&"function"==typeof i&&(t.isSubmit=!1,i(e.data))},onError:function(){t.isSubmit=!1}})},deleteAnnountment:function(e,t){var i={method:"delete",url:n,params:{anId:e}};common.http({$http:r,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},findDetailById:function(t,i){var e={method:"post",url:n+"/findAnnountmentById",params:{anId:i}};common.http({vm:t,$http:r,httpOptions:e,success:function(e){t.annountment=e.data,o.findByBusinessId(i,function(e){t.sysFilelists=e}),a(t,i),l(t,i)}})},postArticle:a,nextArticle:l,startFlow:function(e,t){var i={method:"post",url:rootPath+"/annountment/startFlow",params:{id:e}};common.http({$http:r,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},initFlowDeal:function(t){t.annountment={},t.annountment.anId=t.businessKey,e(t,function(e){t.annountment=e})}};function e(e,t){var i={method:"post",url:n+"/findAnnountmentById",params:{anId:e.annountment.anId}};common.http({$http:r,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}function a(t,e){var i={method:"get",url:rootPath+"/annountment/postArticle",params:{anId:e}};common.http({vm:t,$http:r,httpOptions:i,success:function(e){t.annountmentPost=e.data}})}function l(t,e){var i={method:"get",url:rootPath+"/annountment/nextArticle",params:{anId:e}};common.http({vm:t,$http:r,httpOptions:i,success:function(e){t.annountmentNext=e.data}})}}angular.module("app").factory("annountmentSvc",e),e.$inject=["$http","bsWin","sysfileSvc"]}(),function(){"use strict";function e(e,t,i,o,n){var a=this;a.title="通知公告列表",a.stateName=t.current.name,a.queryParams={},a.saveView=function(){n.storeView(a.stateName,{gridParams:a.gridOptions.dataSource.transport.options.read.data(),queryParams:a.queryParams,data:a})},function(){if(n.view[a.stateName]){var e=n.view[a.stateName];e.gridParams&&(a.gridParams=e.gridParams),e.data&&(a.model=e.data.model),e.queryParams&&(a.queryParams=e.queryParams),o.grid(a),n.view[a.stateName]=void 0}else o.grid(a)}(),a.detail=function(e){e&&(a.saveView(),t.go("annountmentDetail",{id:e}))},a.findAnnountment=function(){a.gridOptions.dataSource._skip=0,a.gridOptions.dataSource.read()},a.resetAnnountment=function(){var e=$("#annountmentYetform").find("input,select");$.each(e,function(e,t){t.value=""})}}angular.module("app").controller("annountmentYetCtrl",e),e.$inject=["$location","$state","$http","annountmentYetSvc","$rootScope"]}(),function(){"use strict";function e(e){return{grid:function(e){var t=common.kendoGridDataSource(rootPath+"/annountment/findByIssue",$("#annountmentYetform"),e.queryParams.page,e.queryParams.pageSize,e.gridParams),i=[{field:"unitSort",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"",title:"标题",width:300,filterable:!1,template:function(e){return 9==e.isStick?'<span class="label label-primary">置顶</span>'+e.anTitle:e.anTitle}},{field:"issueDate",title:"发布时间",format:"{0:yyyy-MM-dd hh24:mm:ss}",width:160,filterable:!1},{field:"issueUser",title:"发布人",width:100,filterable:!1},{field:"",title:"操作",width:150,template:function(e){return common.format($("#columnBtns").html(),"vm.detail('"+e.anId+"')")}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,pageable:common.kendoGridConfig(e.queryParams).pageable,dataBound:common.kendoGridConfig(e.queryParams).dataBound,columns:i,resizable:!0}}}}angular.module("app").factory("annountmentYetSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,o,s,l,i){var c=this;c.model={},c.filterModel={},c.filterLow={},c.title="协审计划管理",c.splitNumArr=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],c.plan={},c.plan.assistType="独立项目",c.planList=[],c.assistSign=[],c.pickSign=[],c.pickMainSign=[],c.lowerSign=[],c.showPlanId="",c.assistPlan={};var a=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"];c.refleshPageInfo=function(e){c.assistSign=[],o.initPlanPage(e,function(e){c.assistSign=e.signList,c.refleshPlanInfo(c.plan.id)})},c.refleshPlanInfo=function(e){o.findPlanSign(e,!1,c.isCommit,function(t){c.pickMainSign=[],c.lowerSign=[],c.plan=t.planDto,"合并项目"==c.plan.assistType?angular.forEach(c.plan.assistPlanSignDtoList,function(i,e){"9"!=i.isMain&&9!=i.isMain||angular.forEach(t.signList,function(e,t){i.signId==e.signid?c.pickMainSign.push(e):c.lowerSign.push(e)})}):c.pickMainSign=t.signList})},o.initPlanPage(!1,function(e){e.signList&&0<e.signList.length&&(c.assistSign=e.signList),e.planList&&0<e.planList.length&&(c.planList=e.planList)}),o.initPlanGrid(c),$("#planInfo li").click(function(e){var t=$("a",this);e.preventDefault(),t.tab("show");var i=t.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500)}),c.filterSign=function(e){var t=!0;if(!angular.isUndefined(e)&&(angular.isUndefined(c.filterModel.filterFilecode)||(e.projectcode?-1==e.filecode.indexOf(c.filterModel.filterFilecode)&&(t=!1):t=!1),t&&(angular.isUndefined(c.filterModel.filterProjectCode)||(e.projectcode?-1==e.projectcode.indexOf(c.filterModel.filterProjectCode)&&(t=!1):t=!1)),t&&(angular.isUndefined(c.filterModel.filterProjectName)||(e.projectname?-1==e.projectname.indexOf(c.filterModel.filterProjectName)&&(t=!1):t=!1)),t&&(angular.isUndefined(c.filterModel.filterBuiltName)||(angular.isUndefined(e.builtcompanyName)&&(t=!1),t&&-1==e.builtcompanyName.indexOf(c.filterModel.filterBuiltName)&&(t=!1))),t))return e},c.filterLowSign=function(e){var t=!0;if(!angular.isUndefined(e)&&(angular.isUndefined(c.filterLow.filterFilecode)||(e.filecode?-1==e.filecode.indexOf(c.filterLow.filterFilecode)&&(t=!1):t=!1),t&&(angular.isUndefined(c.filterLow.filterProjectCode)||(e.projectcode?-1==e.projectcode.indexOf(c.filterLow.filterProjectCode)&&(t=!1):t=!1)),t&&(angular.isUndefined(c.filterLow.filterProjectName)||(e.projectname?-1==e.projectname.indexOf(c.filterLow.filterProjectName)&&(t=!1):t=!1)),t&&(angular.isUndefined(c.filterLow.filterBuiltName)||(angular.isUndefined(e.builtcompanyName)&&(t=!1),t&&-1==e.builtcompanyName.indexOf(c.filterLow.filterBuiltName)&&(t=!1))),t))return e},c.initSplit=function(e){c.plan.assistType==e&&(angular.isUndefined(c.plan.spliNum)||(c.plan.spliNum=0))},c.affirmSign=function(){var e=$("input[name='selASTSign']:checked");if(e.length<1)l.alert("请选择要挑选的项目");else if(1<e.length)"合并项目"==c.plan.assistType?l.alert("合并项目要先挑选一个主项目，再挑选次项目！"):l.alert("独立项目，每次只能选择一个！");else{var t=e[0].value;c.plan.signId=t,o.saveAssistPlan(c.plan,c.isCommit,function(e){c.isCommit=!1,e.flag||"ok"==date.reCode?(c.plan.id||c.gridOptions.dataSource.read(),c.plan=e.reObj,o.initPlanPage(!0,function(e){e.signList&&0<e.signList.length&&(c.assistSign=e.signList)}),c.planList.push(c.plan),c.showPickLowSign(c.plan.id)):l.alert(e.reMsg)})}},c.cancelSign=function(){var i=$("input[name='checkASTSign']:checked");i.length<1?l.alert("请选择取消的项目"):l.confirm({title:"询问提示",message:"确认取消挑选项目吗?",onOk:function(){for(var e=[],t=0;t<i.length;t++)e.push(i[t].value);o.cancelPlanSign(c,e.join(","),function(e){c.isCommit=!1,c.refleshPageInfo(!0),l.alert("操作成功！")})}})},c.initSelPlan=function(){c.pickMainSign=[],c.lowerSign=[],c.showPlanId?o.findPlanSign(c.showPlanId,!1,c.isCommit,function(e){c.plan=e.planDto,c.refleshPlanInfo(c.showPlanId)}):c.plan={}},c.doDelete=function(){c.plan.id?l.confirm({title:"询问提示",message:"确认删除吗？删除数据不可恢复，请慎重！",onOk:function(){o.deletePlan(c.plan.id,c.isCommit,function(e){c.planList=[],o.initPlanPage(!1,function(e){e.signList&&0<e.signList.length&&(c.assistSign=e.signList),e.planList&&0<e.planList.length&&(c.planList=e.planList)}),c.isCommit=!1,c.pickMainSign=[],c.lowerSign=[],c.plan={},c.gridOptions.dataSource.read(),l.alert("操作成功！")})}}):l.alert("请选择要删除的协审计划包")},c.showPickLowSign=function(e){o.findPlanSign(e,!1,c.isCommit,function(t){c.pickMainSign=[],c.lowerSign=[],c.plan=t.planDto,"合并项目"==c.plan.assistType?(angular.forEach(c.plan.assistPlanSignDtoList,function(i,e){"9"!=i.isMain&&9!=i.isMain||angular.forEach(t.signList,function(e,t){i.signId==e.signid?c.pickMainSign.push(e):c.lowerSign.push(e)})}),$("#lowerSignWin").kendoWindow({width:"1024px",height:"600px",title:"次项目信息",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()):c.pickMainSign=t.signList})},c.affirmLowerSign=function(){var e=$("input[name='selLowSign']:checked");if(e.length<1)l.alert("请选择要挑选的次项目!");else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);o.saveLowPlanSign(c,t,function(e){c.isCommit=!1,l.alert("操作成功！"),c.refleshPageInfo(!0)})}},c.cancelLowerSign=function(){var e=$("input[name='checkLowSign']:checked");if(e.length<1)l.alert("请选择要挑选的次项目");else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);o.cancelLowPlanSign(c,t.join(","),function(){c.isCommit=!1,l.alert("操作成功！"),c.refleshPageInfo(!0)})}},c.queryPlan=function(){o.queryPlan(c)},c.showPlanDetail=function(t){c.assistPlan={},c.unitList=[],c.assistPlanSign=[],o.initPlanByPlanId(t,function(e){c.assistPlan=e,o.findPlanSign(t,!0,c.isCommit,function(t){t.signList&&0<t.signList.length&&angular.forEach(c.assistPlan.assistPlanSignDtoList,function(i,e){angular.forEach(t.signList,function(e,t){e.signid==i.signId&&(i.projectName=e.projectname,i.estimateCost=e.declaration)})}),$("#planInfo").kendoWindow({width:"80%",height:"600px",title:"协审项目清单",visible:!1,modal:!0,open:function(){c.drawTimeDay="",c.drawTimeStart="",c.drawTimeEnd=""},closable:!0,actions:["Minimize","Maximize","Close"]}).data("kendoWindow").center().open()})})},c.ministerOpinionEdit=function(e){angular.isObject(e)||(e={}),i.initIdeaData(c,e)},c.viceDirectorOpinionEdit=function(e){angular.isObject(e)||(e={}),i.initIdeaData(c,e)},c.directorOpinionEdit=function(e){angular.isObject(e)||(e={}),i.initIdeaData(c,e)},c.savePlanSign=function(){c.assistPlan.ministerOpinion=$("#ministerOpinion").val(),c.assistPlan.viceDirectorOpinion=$("#viceDirectorOpinion").val(),c.assistPlan.directorOpinion=$("#directorOpinion").val();var e=angular.copy(c.assistPlan);o.savePlan(e,function(e){e.flag||"ok"==e.reCode?l.alert("操作成功！"):l.alert(e.reMsg)})},c.chooseAssistUnit=function(){c.number=null==c.assistPlan.assistPlanSignDtoList?0:c.assistPlan.assistPlanSignDtoList.length,"1"==c.assistPlan.drawType&&(c.number=c.number+1),o.chooseAssistUnit(c.assistPlan.id,c.number,c.assistPlan.drawType,function(e){console.log(e),e.flag||"ok"==e.reCode?c.assistPlan.assistUnitDtoList=e.reObj:l.alert(e.reMsg)})},c.againChooleAssistUnit=function(){c.allUnitList&&0!=c.allUnitList.length?$("#againChooleAssistUnit").kendoWindow({title:"选择参加协审单位",width:"820px",height:"560px",visible:!1,modal:!0,closable:!0,actions:["Minimize","Maximize","Close"]}).data("kendoWindow").center().open():o.getAllUnit(function(e){c.allUnitList=e,$("#againChooleAssistUnit").kendoWindow({title:"选择参加协审单位",width:"820px",height:"560px",visible:!1,modal:!0,closable:!0,actions:["Minimize","Maximize","Close"]}).data("kendoWindow").center().open()})},c.saveAddChooleUnit=function(e){var t=c.assistPlan.assistPlanSignDtoList.length;"1"==c.assistPlan.drawType&&(t+=1),c.assistPlan.assistUnitDtoList.length<t?o.saveAddChooleUnit(c,e,function(e){e.flag||"ok"==e.reCode?(c.assistPlan.assistUnitDtoList.push(e.reObj),l.alert("操作成功！")):l.alert(e.reMsg)}):l.alert("当前只能"+t+"家单位参与抽签")},c.drawAssistUnit=function(){var t=0;if(c.assistPlan.assistPlanSignDtoList&&0<c.assistPlan.assistPlanSignDtoList.length)if(t=c.assistPlan.assistPlanSignDtoList.length,angular.forEach(c.assistPlan.assistPlanSignDtoList,function(e,t){e.assistUnit=null}),c.assistPlan.assistUnitDtoList&&0!=c.assistPlan.assistUnitDtoList.length){var o=c.assistPlan.assistUnitDtoList.length;if(c.drawAssistUnits=angular.copy(c.assistPlan.assistUnitDtoList),"1"==c.assistPlan.drawType?t<o:t<=o){for(var n=0,a=-1,e=0;e<o;e++)if("9"==c.assistPlan.assistUnitDtoList[e].isLastUnSelected){var i=Math.floor(Math.random()*o);a=i,c.assistPlan.assistPlanSignDtoList[i].assistUnit=c.drawAssistUnits[e],c.drawPlanSign=c.assistPlan.assistPlanSignDtoList[i],c.drawAssistUnits.splice(e,1)}var r=0;c.isStartDraw=!0,c.isDrawDone=!1,c.t=s(function(){c.drawPlanSign=c.assistPlan.assistPlanSignDtoList[n];var e=Math.floor(Math.random()*o),i=c.drawAssistUnits[e];c.showAssitUnitName=i.unitName,++r%5==0&&(n!=a?c.assistPlan.assistPlanSignDtoList[n].assistUnit=i:n!=t-1&&(c.assistPlan.assistPlanSignDtoList[++n].assistUnit=i),++n==a&&a==t-1&&(s.cancel(c.t),c.isDrawDone=!0),n==t&&(s.cancel(c.t),c.isDrawDone=!0),c.drawAssistUnits.forEach(function(e,t){e.id==i.id&&c.drawAssistUnits.splice(t,1)}))},200)}else l.alert("当前协审单位少于协审项目数，不能抽签！请先到项目计划表中选择参加的协审单位后再进行抽签！")}else l.alert("还没有设置协审单位，无法进行抽签！");else l.alert("没有协审项目，不能进行抽签！")},c.saveDrawAssistUnit=function(){o.saveDrawAssistUnit(c,function(e){e.flag||"ok"==e.reCode?l.alert("操作成功"):l.alert(e.reMsg)})},c.buildDrawTime=function(){var e=!1,t=!1,i=new Date(c.drawTimeDay),o=i.getDay(),n=i.Format("yyyy年MM月dd日")+"("+a[o]+")";c.drawTimeStart&&(e=!0,12<c.drawTimeStart.split(":")[0]?n+="下午":(t=!0,n+="上午"),n+=c.drawTimeStart);c.drawTimeEnd&&(e&&(n+="至"),12<c.drawTimeEnd.split(":")[0]?!t&&e||(n+="下午"):t&&e||(n+="上午"),n+=c.drawTimeEnd);c.assistPlan.drawTime=n},c.buildApprovalTime=function(){var e=!1,t=!1,i=new Date(c.approvalTimeDay),o=i.getDay(),n=i.Format("yyyy年MM月dd日")+"("+a[o]+")";c.approvalStart&&(e=!0,12<c.approvalStart.split(":")[0]?n+="下午":(t=!0,n+="上午"),n+=c.approvalStart);c.approvalTimeEnd&&(e&&(n+="至"),12<c.approvalTimeEnd.split(":")[0]?!t&&e||(n+="下午"):t&&e||(n+="上午"),n+=c.approvalTimeEnd);c.assistPlan.approvalTime=n}}angular.module("app").controller("assistPlanCtrl",e),e.$inject=["$location","$state","assistSvc","$interval","bsWin","ideaSvc"]}(),function(){"use strict";function e(e,n,t,i){var a=this;a.title="协审单位",a.model={},a.resource={},a.stateName=t.current.name,a.queryParams={},a.saveView=function(){i.storeView(a.stateName,{gridParams:a.gridOptions.dataSource.transport.options.read.data(),queryParams:a.queryParams,data:a})},function(){if(i.view[a.stateName]){var e=i.view[a.stateName];e.gridParams&&(a.gridParams=e.gridParams),e.data&&(a.model=e.data.model),e.queryParams&&(a.queryParams=e.queryParams),n.grid(a),i.view[a.stateName]=void 0}else n.grid(a)}(),a.del=function(e){a.id=e,common.confirm({vm:a,title:"",msg:"确认要删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),a.resource={},n.deleteAssistUnit(a,e)}})},a.dels=function(){var o=common.getKendoCheckId(".grid");0==o.length?common.alert({vm:a,msg:"请选择数据"}):common.confirm({vm:a,title:"",msg:"确认要删除数据吗？",fn:function(){$(".confirmDialog").modal("hide");for(var e=[],t=0;t<o.length;t++)e.push(o[t].value);var i=e.join(",");n.deleteAssistUnit(a,i)}})},a.queryAssistUnit=function(){n.queryAssistUnit(a)}}angular.module("app").controller("assistUnitCtrl",e),e.$inject=["$location","assistUnitSvc","$state","$rootScope"]}(),function(){"use strict";function e(o,n,a){var r=rootPath+"/assistUnit",i="#/assistUnit";return{grid:function(e){var t=common.kendoGridDataSource(r+"/fingByOData?$orderby=unitSort",$("#assistUnitform"),e.queryParams.page,e.queryParams.pageSize,e.gridParams),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"unitSort",title:"序号",width:50,filterable:!1},{field:"unitName",title:"单位名称",width:"20%",filterable:!1},{field:"unitShortName",title:"简称",width:"8%",filterable:!1},{field:"principalName",title:"负责人",width:"8%",filterable:!1},{field:"principalPhone",title:"负责人电话",width:"10%",filterable:!1},{field:"contactName",title:"联系人",width:"8%",filterable:!1},{field:"contactTell",title:"联系人电话",width:"10%",filterable:!1},{field:"address",title:"企业地址",width:"20%",filterable:!0},{field:"isUse",title:"状态",width:"5%",filterable:!1,template:function(e){return e.isUse?"0"==e.isUse?"已停用":"1"==e.isUse?"在用":void 0:""}},{field:"",title:"操作",width:"8%",template:function(e){return common.format($("#columnBtns").html(),"vm.del('"+e.id+"')",e.id,e.isUse)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,pageable:common.kendoGridConfig(e.queryParams).pageable,resizable:!0}},deleteAssistUnit:function(t,e){t.isSubmint=!0;var i={method:"delete",url:r,data:e};common.http({vm:t,$http:o,httpOptions:i,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){a.alert("操作成功",function(){n.go("assistUnit")})}})}})},createAssistUnit:function(t){if(common.initJqValidation(),$("form").valid()&&0==t.isUnitExist){var e={method:"post",url:r,data:t.assistUnit};common.http({vm:t,$http:o,httpOptions:e,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=i}})}})}})}},updateAssistUnit:function(t){if(common.initJqValidation(),$("form").valid()&&0==t.isUnitExist){var e={method:"put",url:r,headers:{contentType:"application/json;charset=utf-8"},dataType:"json",data:angular.toJson(t.assistUnit)};common.http({vm:t,$http:o,httpOptions:e,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){a.alert("操作成功",function(){n.go("assistUnit")})}})}})}},getAssistUnitById:function(t){var e={method:"get",url:r+"/getAssistUnitById",params:{id:t.id}};common.http({vm:t,$http:o,httpOptions:e,success:function(e){t.assistUnit=e.data}})},queryAssistUnit:function(e){e.gridOptions.dataSource._skip="",e.gridOptions.dataSource.read()}}}angular.module("app").factory("assistUnitSvc",e),e.$inject=["$http","$state","bsWin"]}(),function(){"use strict";function e(e,t,i){var o=this;o.title="新增协审单位",o.id=i.params.id,o.isUnitExist=!1,o.id&&(o.isUpdate=!0,o.title="更新协审单位"),o.create=function(){t.createAssistUnit(o)},o.update=function(){t.updateAssistUnit(o)},o.isUpdate&&t.getAssistUnitById(o)}angular.module("app").controller("assistUnitEditCtrl",e),e.$inject=["$location","assistUnitSvc","$state"]}(),function(){"use strict";function e(s,a){return{initPlanPage:function(e,t){var i={method:"post",url:rootPath+"/assistPlan/initPlanManager",params:{isOnlySign:1==e?"9":"0"}};common.http({$http:s,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},initPlanGrid:function(e){var t=common.kendoGridDataSource(rootPath+"/assistPlan/findByOData",$("#searchform"));e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:[{field:"rowNumber",title:"序号",width:50,template:"<span class='row-number'></span>",filterable:!1},{field:"planName",title:"协审计划名称",width:"15%",filterable:!1},{field:"reportTime",title:"报审时间",width:"15%",filterable:!1,format:"{0: yyyy-MM-dd}"},{field:"drawTime",title:"抽签时间",width:"25%",filterable:!1},{field:"createdBy",title:"创建人员",width:"15%",filterable:!1},{field:"createdDate",title:"记录生成时间",width:"15%",filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"",title:"操作",width:"10%",filterable:!1,template:function(e){return'<button class="btn btn-xs btn-primary"  ng-click="vm.showPlanDetail(\''+e.id+'\')"><span class="glyphicon glyphicon-edit"></span>详情</button>'}}],dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})},resizable:!0}},saveAssistPlan:function(e,t,i){!0;var o={method:"post",url:rootPath+"/assistPlan",data:e};common.http({$http:s,httpOptions:o,success:function(e){!1,null!=i&&"function"==typeof i&&i(e.data)},onError:function(){!1}})},deletePlan:function(e,t,i){!0;var o={method:"delete",url:rootPath+"/assistPlan",params:{id:e}};common.http({$http:s,httpOptions:o,success:function(e){!1,null!=i&&"function"==typeof i&&i(e.data)},onError:function(){!1}})},findPlanSign:function(e,t,i,o){var n={method:"post",url:rootPath+"/sign/findByPlanId",params:{planId:e,isOnlySign:t==!0?"9":"0"}};common.http({$http:s,httpOptions:n,success:function(e){null!=o&&"function"==typeof o&&o(e.data)},onError:function(){!1}})},cancelPlanSign:function(t,e,i){var o={method:"delete",url:rootPath+"/assistPlan/cancelPlanSign",params:{planId:t.plan.id,signIds:e}};common.http({$http:s,httpOptions:o,success:function(e){t.isCommit=!1,null!=i&&"function"==typeof i&&i(e.data)},onError:function(){t.isCommit=!1}})},saveLowPlanSign:function(t,a,i){var r=new Array;t.assistSign.forEach(function(e,t){for(var i=0,o=a.length;i<o;i++)if(e.signid==a[i]){var n={};n.signId=e.signid,n.projectName=e.projectname,n.assistType="合并项目",n.isMain="0",r.push(n)}}),t.plan.assistPlanSignDtoList=r,t.isCommit=!0;var e={method:"post",url:rootPath+"/assistPlan/saveLowPlanSign",data:t.plan};common.http({$http:s,httpOptions:e,success:function(e){t.isCommit=!1,null!=i&&"function"==typeof i&&i(e.data)},onError:function(){t.isCommit=!1}})},cancelLowPlanSign:function(t,e,i){t.isCommit=!0;var o={method:"delete",url:rootPath+"/assistPlan/cancelLowPlanSign",params:{planId:t.plan.id,signIds:e}};common.http({vm:t,$http:s,httpOptions:o,success:function(e){t.isCommit=!1,null!=i&&"function"==typeof i&&i(e.data)},onError:function(){t.isCommit=!1}})},queryPlan:function(e){e.gridOptions.dataSource._skip="",e.gridOptions.dataSource.read()},getPlanSignByPlanId:function(e,t){var i={method:"post",url:rootPath+"/assistPlanSign/getPlanSignByPlanId",params:{planId:e}};common.http({$http:s,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},savePlanSign:function(e,t){var i={method:"put",url:rootPath+"/assistPlanSign/savePlanSign",headers:{contentType:"application/json;charset=utf-8"},dataType:"json",data:angular.toJson(e)};common.http({vm:vm,$http:s,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},savePlan:function(e,t){var i={method:"post",url:rootPath+"/assistPlan/savePlanAndSign",data:e};common.http({$http:s,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},initPlanByPlanId:function(e,t){var i={method:"post",url:rootPath+"/assistPlan/findById",params:{id:e}};common.http({$http:s,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},chooseAssistUnit:function(e,t,i,o){var n={method:"post",url:rootPath+"/assistUnit/chooseAssistUnit",params:{planId:e,number:t,drawType:i}};common.http({$http:s,httpOptions:n,success:function(e){null!=o&&"function"==typeof o&&o(e.data)}})},saveDrawAssistUnit:function(t,i){var o="";t.assistPlan.assistPlanSignDtoList.forEach(function(e,t){0<t&&(o+=","),o+=e.id+"|"+e.assistUnit.id});var n="";0<t.drawAssistUnits.length&&t.drawAssistUnits.forEach(function(e,t){0<t&&(n+=","),n+=e.id});t.isCommit=!0;var e={method:"post",url:rootPath+"/assistPlan/saveDrawAssistUnit",params:{planId:t.assistPlan.id,drawAssitUnitIds:o,unSelectedIds:n}};common.http({$http:s,httpOptions:e,success:function(e){null!=i&&"function"==typeof i&&i(e.data)},onError:function(e){t.isCommit=!1}})},getUnitUser:function(t){var e={method:"post",url:rootPath+"/assistUnitUser/findByOData"};common.http({vm:t,$http:s,httpOptions:e,success:function(e){t.unitUserList=e.data.value}})},getAllUnit:function(t){var e={method:"post",url:rootPath+"/assistUnit/fingByOData"};common.http({$http:s,httpOptions:e,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},saveAddChooleUnit:function(e,i,t){var o=!0;if(angular.forEach(e.assistPlan.assistUnitDtoList,function(e,t){if(i.id==e.id)return o=!1,void a.alert("该协审单位已被选中！")}),o){var n={method:"post",url:rootPath+"/assistPlan/saveChooleUnit",params:{planId:e.assistPlan.id,unitId:i.id}};common.http({$http:s,httpOptions:n,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}},initAssistUnitByPlanId:function(e,t){var i={method:"post",url:rootPath+"/assistPlan/initAssistUnit",params:{planId:e}};common.http({$http:s,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},findAssistPlanSignById:function(e,t){var i={method:"post",url:rootPath+"/assistPlanSign/findAssistPlanSignById",params:{signId:e}};common.http({$http:s,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}}}angular.module("app").factory("assistSvc",e),e.$inject=["$http","bsWin"]}(),function(){"use strict";function e(t,i,o){var n=this;n.model={},n.title="项目档案借阅管理",n.id=o.params.id,o.params.id&&t.initArchivesLibrary(o.params.id,function(e){n.model=e}),n.createLibrary=function(){common.initJqValidation(),$("form").valid()&&t.createArchivesLibrary(n.model,function(e){e.flag||"ok"==e.reCode?(n.model=e.reObj,i.alert("操作成功！")):i.error(e.reMsg)})},n.startFlow=function(){common.initJqValidation(),$("form").valid()&&t.createArchivesLibrary(n.model,function(e){e.flag||"ok"==e.reCode?(n.model=e.reObj,t.startFlow(n.model.id,function(e){e.flag||"ok"==e.reCode?i.alert("操作成功！",function(){o.go("archivesLibraryList")}):i.error(e.reMsg)})):i.error(e.reMsg)})},n.del=function(e){common.confirm({vm:n,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteArchivesLibrary(n,e)}})},n.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:n,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");n.del(o)}}}angular.module("app").controller("archivesLibraryCtrl",e),e.$inject=["archivesLibrarySvc","bsWin","$state"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.title="档案借阅管理",t.grid(n),n.search=function(){n.gridOptions.dataSource._skip=0,n.gridOptions.dataSource.read()},n.formReset=function(){$("#searchform")[0].reset()}}angular.module("app").controller("archivesLibraryListCtrl",e),e.$inject=["$location","archivesLibrarySvc","$state","bsWin"]}(),function(){"use strict";function e(o,e){var n=rootPath+"/archivesLibrary";return{initArchivesLibrary:i,startFlow:function(e,t){var i={method:"post",url:rootPath+"/archivesLibrary/startFlow",params:{id:e}};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},initFlowDeal:function(t){i(t.businessKey,function(e){t.model=e})},grid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/archivesLibrary/findByOData",$("#searchform")),schema:{data:"value",total:function(e){return e.count},model:{id:"id",fields:{createdDate:{type:"date"},modifiedDate:{type:"date"}}}},serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"readCompany",title:"项目单位",width:140,filterable:!1},{field:"readProjectName",title:"查阅项目",width:140,filterable:!1},{field:"readUsername",title:"借阅人",width:100,filterable:!1},{field:"readArchivesCode",title:"归档编号",width:100,filterable:!1},{field:"readDate",title:"借阅时间",width:100,filterable:!1},{field:"",title:"操作",width:100,template:function(e){return common.format($("#columnBtns").html(),"archivesLibraryView/"+e.id)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})},resizable:!0}},createArchivesLibrary:function(e,t){var i={method:"post",url:n+"/savaLibrary",data:e};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},createCityLibrary:function(e,t){var i={method:"post",url:n+"/saveCity",data:e};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},getArchivesUserName:function(t){var e={method:"get",url:rootPath+"/archivesLibrary/findByArchivesUser"};common.http({vm:t,$http:o,httpOptions:e,success:function(e){t.userlist=e.data}})},deleteArchivesLibrary:function(t,e){t.isSubmit=!0;var i={method:"delete",url:n,data:e};common.http({vm:t,$http:o,httpOptions:i,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})}})}})}};function i(e,t){var i={method:"post",url:rootPath+"/archivesLibrary/findById",params:{id:e}};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}}angular.module("app").factory("archivesLibrarySvc",e),e.$inject=["$http","bsWin"]}(),function(){"use strict";function e(e,t,i){var o=this;o.model={},o.title="项目档案借阅查看详情",o.id=i.params.id,o.id&&e.initArchivesLibrary(o.id,function(e){o.model=e})}angular.module("app").controller("archivesLibraryViewCtrl",e),e.$inject=["archivesLibrarySvc","bsWin","$state"]}(),function(){"use strict";function e(e,t,i){var r=this;r.title="借书列表",r.model={},r.searchModel={},t.bookBorrowGrid(r,function(e){r.bookBorrowDetailList=e.reObj.bookBorrowDetailList,r.bookBorrowSumDtoList=e.reObj.bookBorrowSumDtoList}),r.searchForm=function(){t.bookBorrowGrid(r,function(e){r.bookBorrowDetailList=e.reObj.bookBorrowDetailList,r.bookBorrowSumDtoList=e.reObj.bookBorrowSumDtoList})},r.formReset=function(){r.searchModel={}},r.returnBook=function(e,t,i,o,n,a){r.model.id=e,r.model.bookNo=t,r.model.booksName=i,r.model.borrowNum=n,r.model.bookBorrower=o,r.model.returnDate=null!=a?new Date(a).Format("yyyy-MM-dd"):"",r.model.returnBorrower=$("#curName").val(),$("#returnBookWindow").kendoWindow({width:"38%",height:"300px",title:"图书借还",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},r.saveReturnBookDetail=function(){t.saveReturnBookDetail(r,function(e){e.flag||"ok"==e.reCode?i.alert("保存成功！",function(){window.parent.$("#returnBookWindow").data("kendoWindow").close(),$state.go("bookBorrowList")}):i.alert(e.reMsg)})},r.returnBookList=function(){window.parent.$("#returnBookWindow").data("kendoWindow").close(),$state.go("bookBorrowList")},r.comparisonStill=function(){r.model.returnNum>r.model.borrowNum&&(r.model.returnNum=r.model.borrowNum),r.model.returnNum<0&&(r.model.returnNum=0)}}angular.module("app").controller("bookBorrowCtrl",e),e.$inject=["$location","bookBuySvc","bsWin"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.title="图书查询",n.model={},n.del=function(e){common.confirm({vm:n,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteBookBuy(n,e)}})},n.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:n,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");n.del(o)}},t.grid(n),n.searchForm=function(){n.gridOptions.dataSource._skip=0,n.gridOptions.dataSource.read()},n.formReset=function(){n.searchModel={}},n.borrowBook=function(e){t.queryBookBuyById(e,function(e){n.model=e,n.model.bookBorrower=$("#curName").val()}),console.log(n.model.bookBorrower),$("#borrowBookWindow").kendoWindow({width:"860px",height:"300px",title:"图书借阅",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},n.saveBooksDetail=function(){console.log(n.model),n.model.borrowNum&&0!=n.model.borrowNum?n.model.borrowDate?n.model.returnDate?t.saveBorrowBookDetail(n,function(e){e.flag||"ok"==e.reCode?o.alert("保存成功！",function(){window.parent.$("#borrowBookWindow").data("kendoWindow").close(),n.searchForm()}):o.alert(e.reMsg)}):o.alert("请填写还书日期！"):o.alert("请填写借书日期！"):o.alert("请填写借书数量！")},n.returnBookList=function(){window.parent.$("#borrowBookWindow").data("kendoWindow").close(),n.searchForm()},n.comparisonSize=function(){n.model.borrowNum>n.model.storeConfirm&&(n.model.borrowNum=n.model.storeConfirm),n.model.borrowNum<0&&(n.model.borrowNum=0)}}angular.module("app").controller("bookBuyCtrl",e),e.$inject=["$location","bookBuySvc","$state","bsWin"]}(),function(){"use strict";function e(e,t,i){var o=this;o.title="添加图书管理信息",o.isuserExist=!1,o.id=i.params.id,o.id&&(o.isUpdate=!0,o.title="更新图书管理信息"),o.create=function(){t.createBookBuy(o)},o.update=function(){t.updateBookBuy(o)},o.isUpdate&&t.getBookBuyById(o)}angular.module("app").controller("bookBuyEditCtrl",e),e.$inject=["$location","bookBuySvc","$state"]}(),function(){"use strict";function e(o){var n=rootPath+"/bookBuy",i="#/bookBuyList";return{grid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/bookBuy/findByOData",$("#bookForm")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"bookNo",title:"图书号",width:100,filterable:!1},{field:"booksName",title:"图书名称",width:100,filterable:!1},{field:"booksType",title:"图书分类",width:100,filterable:!1},{field:"booksPrice",title:"价格",width:100,filterable:!1},{field:"bookNumber",title:"数量",width:100,filterable:!1},{field:"",title:"库存",width:100,attributes:{style:"color:red"},filterable:!1,template:function(e){return e.storeConfirm?e.storeConfirm:0}},{field:"storeTime",title:"入库时间",width:100,filterable:!1},{field:"",title:"操作",width:140,template:function(e){return e.storeConfirm&&0<e.storeConfirm?common.format($("#columnBtns").html(),e.id):""}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})}}},bookBorrowGrid:function(e,t){var i={method:"post",url:rootPath+"/bookBorrow/expertCostDetailTotal",data:e.searchModel};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},getBookBuyById:function(t){var e={method:"get",url:rootPath+"/bookBuy/html/findById",params:{id:t.id}};common.http({vm:t,$http:o,httpOptions:e,success:function(e){t.model=e.data}})},queryBookBuyById:function(e,t){var i={method:"get",url:rootPath+"/bookBuy/html/findById",params:{id:e}};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},createBookBuy:function(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0;var e={method:"post",url:n,data:t.model};common.http({vm:t,$http:o,httpOptions:e,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,location.href=i}})}})}})}},deleteBookBuy:function(t,e){t.isSubmit=!0;var i={method:"delete",url:n,data:e};common.http({vm:t,$http:o,httpOptions:i,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})}})}})},updateBookBuy:function(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0,t.model.id=t.id;var e={method:"put",url:n,data:t.model};common.http({vm:t,$http:o,httpOptions:e,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})}})}},saveBorrowBookDetail:function(e,t){var i={method:"post",url:rootPath+"/bookBuy/saveBorrowDetail",data:e.model};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},saveReturnBookDetail:function(e,t){var i={method:"post",url:rootPath+"/bookBuy/saveReturnDetail",data:e.model};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}}}angular.module("app").factory("bookBuySvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t){var n=this;n.title="图书采购流程查询",n.del=function(e){common.confirm({vm:n,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteBookBuyBusiness(n,e)}})},n.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:n,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");n.del(o)}},t.grid(n),n.searchForm=function(){n.gridOptions.dataSource._skip=0,n.gridOptions.dataSource.read()},n.formReset=function(){n.searchModel={}}}angular.module("app").controller("bookBuyBusinessCtrl",e),e.$inject=["$location","bookBuyBusinessSvc"]}(),function(){"use strict";function e(e,t,i){var o=this;o.model={},o.businessId=i.params.businessId,o.viewDetail=i.params.viewDetail,o.showGoBack=!0,e.getBookBuyBusinessById(o,function(e){if(o.model=e,o.model.bookBuyList)for(var t=0;t<o.model.bookBuyList.length;t++)o.model.bookBuyList[t].totalPrice=parseFloat(o.model.bookBuyList[t].booksPrice)*o.model.bookBuyList[t].bookNumber})}angular.module("app").controller("bookBuyBusinessDetailCtrl",e),e.$inject=["bookBuyBusinessSvc","bsWin","$state"]}(),function(){"use strict";function e(e,a,t,r){var s=this;function i(){var e=$("#buyChannel").val();if(""==e||"undefined"===e)return r.error("购买渠道没有填写，请选择后再进行保存！"),!1;if(common.initJqValidation($("#bookForm")),$("#bookForm").valid()){if(0<s.conditions.length){var i=!0;return s.conditions.forEach(function(e,t){e.booksName=$("#booksName"+e.sort).val(),e.booksType=$("#booksType"+e.sort).val(),e.publishingCompany=$("#publishingCompany"+e.sort).val(),e.bookNo=$("#bookNo"+e.sort).val(),""!=e.bookNo&&"undefined"!==e.bookNo||(r.error("图书号不能为空请核查！"),i=!1),e.author=$("#author"+e.sort).val(),e.bookNumber=$("#bookNumber"+e.sort).val(),""!=e.bookNumber&&"undefined"!==e.bookNumber||(r.error("图书数量不能为空请核查！"),i=!1),o(e.bookNumber)||(r.error("图书数量只能输入正整数请核查！"),i=!1),e.storeConfirm=$("#storeConfirm"+e.sort).val(),e.booksPrice=$("#booksPrice"+e.sort).val();/^(-)?(([1-9]{1}\d*)|([0]{1}))(\.(\d){1,4})?$/.test(e.booksPrice)||(r.error("价格只能输入数字请核查！"),i=!1),e.applyDept=s.model.applyDept,e.operator=s.model.operator,e.buyChannel=s.model.buyChannel,e.businessId=$("#businessId").val(),e.businessName=s.model.businessName,e.applyReason=s.model.applyReason}),i}return r.error("没有分录数据，无法保存！"),!1}r.alert("操作失败，有红色*号的选项为必填项，请按要求填写！")}function o(e){return!!(/^(\+|-)?\d+$/.test(e)&&0<e)}s.model={},s.conMaxIndex=0,s.conditions=new Array,s.title="图书信息录入",s.isuserExist=!1,s.businessId=t.params.businessId,s.viewDetail=t.params.viewDetail,s.showFlag={addBooksDeatail:!0,modBooksDetail:!0,bookBuyApplyTr:!1,bookBuyBzTr:!0,bookBuyFgzrTr:!0,bookBuyZrTr:!0,bookBuyYsrk:!0,buyChannel:!1,isCommit:!1},s.businessId?(s.isUpdate=!0,s.showFlag.modBooksDetail=!0,s.showFlag.addBooksDeatail=!1,$("#businessId").val(s.businessId)):(s.showFlag.modBooksDetail=!1,s.showFlag.addBooksDeatail=!0),"1"==s.viewDetail&&(s.showFlag.bookBuyYsrk=!0,s.showFlag.addBooksDeatail=!0,s.showFlag.modBooksDetail=!0,s.showFlag.bookBuyZrTr=!0,s.showFlag.bookBuyFgzrTr=!0,s.showFlag.bookBuyBzTr=!0,s.showFlag.bookBuyApplyTr=!0,s.showFlag.buyChannel=!0,s.showFlag.isCommit=!0),s.create=function(){a.createBookBuyBusiness(s)},s.update=function(){a.updateBookBuyBusiness(s)},s.addCondition=function(){s.condition={},s.showFlag.addBooksDeatail?s.condition.sort=s.conMaxIndex+1:(s.conMaxIndex=s.conditions.length,s.condition.sort=s.conditions.length+1),s.conditions.push(s.condition),s.conMaxIndex++},s.removeCondition=function(){var o=$("#conditionTable input[name='bookInfos']:checked");0<o.length?r.confirm({title:"询问提示",message:"删除数据不可恢复，确定删除么？",onOk:function(){$(".confirmDialog").modal("hide");for(var n=[],e=0;e<o.length;e++)for(var t=0;t<s.conditions.length;t++){var i=s.conditions[t];if(o[e].value==i.sort){if(!i.id){s.conditions.splice(t,1),$("#conTr"+i.sort).remove();break}n.push(i.id)}}0<n.length&&a.deleteBooksConditions(n.join(","),function(e){if(e.flag||"ok"==e.reCode){r.success("操作成功！");for(var t=0;t<n.length;t++)for(var i=0;i<s.conditions.length;i++){var o=s.conditions[i];if(n[t]==o.sort){s.conditions.splice(i,1),$("#conTr"+o.sort).remove();break}}}else r.error(e.reMsg)})}}):r.alert("请选择要删除的图书信息！")},s.saveCondition=function(){i()&&a.saveBookBuyBusinessDetail(s.conditions,function(e){e.flag||"ok"==e.reCode?($("#businessId").val(e.reObj.businessId),r.success("保存成功！")):r.error(e.reMsg)})},s.startFlow=function(){r.confirm({title:"询问提示",message:"发起流程后，当前页面数据将不能再修改！确认发起流程么？",onOk:function(){i()?a.startFlow(s.conditions,s.showFlag.isCommit,function(e){e.flag||"ok"==e.reCode?r.alert("保存成功！",function(){t.go("myBookBuyBusiness")}):r.alert(e.reMsg)}):r.error("没有分录数据，无法发起流程！")}})},s.checkBookNum=function(e){var t="bookNumber"+e;o($("#"+t).val())?$("span[data-valmsg-for='"+t+"']").html(""):$("span[data-valmsg-for='"+t+"']").html("图书数量只能输入正整数！")},s.checkPrice=function(e){var t="booksPrice"+e,i="bookNumber"+e;if(!/^(-)?(([1-9]{1}\d*)|([0]{1}))(\.(\d){1,4})?$/.test($("#"+t).val()))return $("#"+t).val(""),void $("span[data-valmsg-for='"+t+"']").html("价格只能输入数字！");$("span[data-valmsg-for='"+t+"']").html("");var o=$("#"+t).val(),n=$("#"+i).val();$("#total"+e).val(parseFloat(o)*n)},s.isUpdate&&a.getBookBuyBusinessById(s,function(e){s.model=e,s.conditions=s.model.bookBuyList;for(var t=0;t<s.conditions.length;t++)s.conditions[t].sort=t+1,s.conditions[t].total=parseFloat(s.conditions[t].booksPrice)*s.conditions[t].bookNumber})}angular.module("app").controller("bookBuyBusinessEditCtrl",e),e.$inject=["$location","bookBuyBusinessSvc","$state","bsWin"]}(),function(){"use strict";function e(n){var o=rootPath+"/bookBuyBusiness",i="#/bookBuyBusinessList";return{grid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/bookBuyBusiness/findByOData",$("#bookBuyForm"),{filter:"createdBy eq ${CURRENT_USER.id}"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"applyDept",title:"申请部门",width:"20%",filterable:!1},{field:"operator",title:"申请人",width:"10%",filterable:!1},{field:"buyChannel",title:"购买渠道",width:"15%",filterable:!1},{field:"applyDate",title:"申请日期",width:"15%",filterable:!1},{field:"",title:"状态",width:"15%",filterable:!1,template:function(e){return e.processInstanceId&&e.filer?"已办理":e.processInstanceId?"正在办理":"未确定申购"}},{field:"",title:"操作",width:140,template:function(e){var t=!!e.processInstanceId;return common.format($("#columnBtns").html(),e.businessId,t)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})},resizable:!0}},getBookBuyBusinessById:function(e,t){var i={method:"get",url:rootPath+"/bookBuyBusiness/html/findById",params:{id:e.businessId}};common.http({vm:e,$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},createBookBuyBusiness:function(t){common.initJqValidation();$("form").valid();{t.isSubmit=!0;var e={method:"post",url:o,data:t.model};common.http({vm:t,$http:n,httpOptions:e,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,location.href=i}})}})}})}},deleteBookBuyBusiness:function(t,e){t.isSubmit=!0;var i={method:"delete",url:o,data:e};common.http({vm:t,$http:n,httpOptions:i,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})}})}})},updateBookBuyBusiness:function(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0,t.model.id=t.id;var e={method:"put",url:o,data:t.model};common.http({vm:t,$http:n,httpOptions:e,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})}})}},saveBookBuyBusinessDetail:function(e,t){var i={method:"post",url:rootPath+"/bookBuyBusiness/saveBooksDetailList",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(e)};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},startFlow:function(e,t,i){!0;var o={method:"post",url:rootPath+"/bookBuyBusiness/startFlow",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(e)};common.http({$http:n,httpOptions:o,success:function(e){!1,null!=i&&"function"==typeof i&&i(e.data)},onError:function(){!1}})},initFlowDeal:function(i){var e={method:"get",url:rootPath+"/bookBuyBusiness/html/findById",params:{id:i.businessKey}};common.http({$http:n,httpOptions:e,success:function(e){i.model=e.data;for(var t=0;t<i.model.bookBuyList.length;t++)i.model.bookBuyList[t].totalPrice=parseFloat(i.model.bookBuyList[t].booksPrice)*i.model.bookBuyList[t].bookNumber},onError:function(){}})},deleteBooksConditions:function(e,t){var i={method:"delete",url:o+"/bookDel",params:{ids:e}};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}}}angular.module("app").factory("bookBuyBusinessSvc",e),e.$inject=["$http"]}(),function(){"use strict";angular.module("app");angular.module("app").factory("bsWin",function(){return{success:function(e,t){return this.alert({message:e,type:"success",onClose:t,icon:1})},warning:function(e,t){return this.alert({message:e,type:"warning",onClose:t,icon:5})},error:function(e,t){return this.alert({message:e,type:"error",onClose:t,icon:2})},alert:function(t,e,i){var o;angular.isObject(t)||(!e||angular.isFunction(e)?(i=e,e=t):o=t,t={message:e,onClose:i||function(){}},o&&(t.title=o));t.onClose=t.onClose||function(){},layer.alert(t.message,{title:t.title?t.title:"系统消息",icon:t.icon?t.icon:6,skin:"layui-layer-lan"},function(e){layer.close(e),t.onClose()})},confirm:function(t,e,i,o,n){var a;angular.isObject(t)||(!e||angular.isFunction(e)?(n=o||function(){},o=i||function(){},i=e||function(){},e=t):a=t,t={message:e,onOk:i,onClose:o,onCancel:n},a&&(t.title=a));t.onClose=t.onClose||function(){},layer.confirm(t.message,{title:t.title?t.title:"询问提示",icon:3,skin:"layui-layer-lan",btn:["确认","取消"],end:t.onClose},function(e){layer.close(e),null!=t.onOk&&"function"==typeof t.onOk&&t.onOk()},function(e){layer.close(e),null!=t.onCancel&&"function"==typeof t.onCancel&&t.onCancel()})}}})}(),function(){"use strict";var a={initJqValidation:function(e){e?(e.removeData("validator"),e.removeData("unobtrusiveValidation"),$.validator.unobtrusive.parse(e)):($("form").removeData("validator"),$("form").removeData("unobtrusiveValidation"),$.validator.unobtrusive.parse("form"))},requestSuccess:function(t){var e=function(e){a.alert({vm:t.vm,msg:e,fn:function(){t.vm.isSubmit=!1,$(".alertDialog").modal("hide")}})};if(400<t.response.status)e("发生错误！");else{var i=t.response.data;i&&555==i.reCode?e(i.message):t.fn&&t.fn(i)}},format:function(){for(var e=arguments[0],t=1;t<arguments.length;t++){var i=new RegExp("\\{"+(t-1)+"\\}","gm");e=e.replace(i,arguments[t])}return e},blockNonNumber:function(e){var t=e.toString().replace(/[^0-9]/g,"");return parseInt(t,10)},floatNumberInput:function(e){return isNaN(parseFloat(e,10))?0:parseFloat(e,10)},adminContentHeight:function(){return $(window).height()-180},alert:function(e){e.vm.alertDialogMessage=e.msg,e.vm.alertDialogFn=function(){e.closeDialog&&1==e.closeDialog&&($(".alertDialog").modal("hide"),$(".modal-backdrop").remove()),e.fn?e.fn():$(".alertDialog").modal("hide")},$(".alertDialog").modal({backdrop:"static",keyboard:!1})},confirm:function(e){e.vm.dialogConfirmTitle=e.title,e.vm.dialogConfirmMessage=e.msg,$(".confirmDialog").modal({backdrop:"static"}),e.vm.dialogConfirmSubmit=e.fn,e.cancel?e.vm.dialogConfirmCancel=e.cancel:e.vm.dialogConfirmCancel=function(){$(".confirmDialog").modal("hide")}},getQuerystring:function(e,t){null==t&&(t="");e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.href);return null==i?t:i[1]},kendoGridConfig:r,getKendoCheckId:function(e){var t=$(e).find("tr td:nth-child(1)").find("input:checked"),i=[];return t.each(function(){var e=$(this).attr("relId");i.push({name:"id",value:e})}),i},cookie:t,getToken:function(){var e=t().getAll("data");return null!=e?e.token:""},http:function(t){t.headers={Token:a.getToken()},t.$http(t.httpOptions).then(t.success,function(e){t.onError&&t.onError(e)})},gridDataSource:function(e){return e.error=function(e){401==e.status&&(location.href=window.rootPath+"/home/login")},e},buildOdataFilter:function(e){var t=/^(?:checkbox|radio)$/i,i=/^(?:submit|button|image|reset|file)$/i,o=/^(?:input|select|textarea|keygen)/i;return $(e).map(function(){var e=jQuery.prop(this,"elements");return e?jQuery.makeArray(e):this}).filter(function(){var e=this.type;return this.value&&this.name&&!$(this).is(":disabled")&&o.test(this.nodeName)&&!i.test(e)&&(this.checked||!t.test(e))}).map(function(e,t){var i=$(this),o=i.val();if(!o)return!1;var n=i.attr("data-type")||"String";"array"==n?o="("+o+")":(o="'"+o+"'","String"!=n&&(o=n+o));var a=i.attr("operator")||"eq",r=i.attr("data-role")||"";return"datepicker"==r?o="date"+o:"datetimepicker"==r&&(o="datetime"+o),"like"==a?"substringof("+o+", "+t.name+")":t.name+" "+a+" "+o}).get().join(" and ")},kendoGridDataSource:function(e,t,i,o,n,a){return new kendo.data.DataSource({type:"odata",transport:r().transport(e,t,n,a),schema:r().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:o||10,page:i||1,sort:{field:"createdDate",dir:"desc"}})},getTaskCount:function(e){e.$http({method:"get",url:rootPath+"/admin/myCountInfo"}).then(function(e){e.data.DO_SIGN_COUNT&&$("#DO_SIGN_COUNT").html(e.data.DO_SIGN_COUNT),e.data.DO_TASK_COUNT&&$("#DO_TASK_COUNT").html(e.data.DO_TASK_COUNT),e.data.GET_SIGN_COUNT&&$("#GET_SIGN_COUNT").html(e.data.GET_SIGN_COUNT),e.data.GET_RESERVESIGN_COUNT&&$("#GET_RESERVESIGN_COUNT").html(e.data.GET_RESERVESIGN_COUNT)})},uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,i="x"==e?t:3&t|8;return i.toString(16)}).toUpperCase()},downloadReport:function(e,t,i){var o=new Blob([e],{type:"application/"+i}),n=URL.createObjectURL(o),a=$("<a><span class='forExcel'>下载</span></a>").attr("href",n).attr("download",t);$("body").append(a),$(".forExcel").click(),a.remove()}};function r(n){return{filterable:{extra:!1,operators:{string:{contains:"包含",eq:"等于"},number:{eq:"等于",neq:"不等于",gt:"大于",lt:"小于"},date:{gt:"大于",lt:"小于"}}},pageable:{pageSize:10,previousNext:!0,buttonCount:5,refresh:!0,pageSizes:!0,change:function(){n&&n.page&&(n.page=this.dataSource.page())}},dataBound:function(e){var t=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(t).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)}),n.pageSize=e.sender.dataSource.pageSize(),n.page=e.sender.dataSource.page()},schema:function(e){return{data:"value",total:function(e){return e.count},model:e}},transport:function(e,i,o,n){return{read:{url:e,dataType:"json",type:"post",cache:!1,beforeSend:function(e){e.setRequestHeader("Token",a.getToken())},data:function(){if(i){var e=common.buildOdataFilter(i);if(e){if(o&&o.$filter){var t=o.$filter;return n||(o=void 0),{$filter:e+" and "+t}}return{$filter:e}}return o&&o.$filter?{$filter:o.$filter}:{}}return o||{}}}}},noRecordMessage:{template:"暂时没有数据."}}}function t(){return{get:function(e,t){var i=this.getAll(e);return i?i[t]:null},getAll:function(e){var t=encodeURIComponent(e)+"=",i=document.cookie.indexOf(t),o=null,n={};if(-1<i){var a=document.cookie.indexOf(";",i);if(-1==a&&(a=document.cookie.length),0<(o=document.cookie.substring(i+t.length,a)).length){for(var r=o.split("&"),s=0,l=r.length;s<l;s++){var c=r[s].split("=");n[decodeURIComponent(c[0])]=decodeURIComponent(c[1])}return n}}return null},set:function(e,t,i,o,n,a,r){var s=this.getAll(e)||{};s[t]=i,this.setAll(e,s,o,n,a,r)},setAll:function(e,t,i,o,n,a){var r=encodeURIComponent(e)+"=",s=new Array;for(var l in t)0<l.length&&t.hasOwnProperty(l)&&s.push(encodeURIComponent(l)+"="+encodeURIComponent(t[l]));0<s.length?(r+=s.join("&"),i instanceof Date&&(r+=";expires="+i.toGMTString()),o&&(r+=";path="+o),n&&(r+=";domain="+n),a&&(r+=";secure")):r+=";expires="+new Date(0).toGMTString(),document.cookie=r},unset:function(e,t,i,o,n){var a=this.getAll(e);a&&(delete a[t],this.setAll(e,a,null,i,o,n))},unsetAll:function(e,t,i,o){this.setAll(e,null,new Date(0),t,i,o)}}}window.common=a,$(document).on("click","#checkboxAll",function(){var e=$(this).is(":checked");$(".grid").find("tr td:nth-child(1)").find('input:checkbox[ng-disabled!="true"]').prop("checked",e)})}(),function(){"use strict";var e=angular.module("app");function t(t,i){return{request:function(e){return e.headers.Token=common.getToken(),e.headers["X-Requested-With"]="XMLHttpRequest",e},responseError:function(e){return e.config.headers.commonHttp||l(i,e.status,e.data),t.reject(e)}}}function l(e,t,i){switch(t){case 500:e.error("系统内部错误!");break;case 401:e.warning("登录信息失效或您没有权限,请重新登录!",function(){window.location.href=rootPath+"/"});break;case 403:e.warning("您无权限执行此操作！");break;case 404:e.error("未找到相应的操作！");break;case 408:e.warning("请求超时");break;case 412:e.warning(i.message||"操作失败");break;case 499:e.warning(i.message||"您的账号已在别的地方登录，请确认密码是否被修改！")}}e.factory("commonHttpInterceptor",["$injector","bsWin",t]),e.config(["$httpProvider",function(e){e.interceptors.push(t),e.defaults.headers.get||(e.defaults.headers.get={}),e.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",e.defaults.headers.get["Cache-Control"]="no-cache",e.defaults.headers.get.Pragma="no-cache"}]),jQuery&&jQuery(document).ajaxSend(function(e,t,i){t.setRequestHeader("Token",common.getToken())}).ajaxError(function(e,t,i,o){var n=angular.element("body"),a=n.scope(),r=n.injector().get("bsWin"),s=angular.isString(t.responseText)?JSON.parse(t.responseText||"{}"):t.responseText;a.$apply(function(){l(r,t.status,s||{})})})}(),function(){"use strict";function e(a,r){return{initIdeaData:function(n,t){n.ideaContent="",$("#ideaWindow").kendoWindow({width:"70%",height:"660px",title:"意见选择",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open(),n.ideas||a({method:"post",url:rootPath+"/idea/findMyIdea"}).then(function(e){n.ideas=e.data});n.deleteCommonIdea=function(){var i=$("#commonIdeaTable input[type='checkbox']:checked");if(i.length<1)r.alert("请选择要删除的意见！");else{for(var e=[],o=0;o<i.length;o++)i[o].value&&e.push(i[o].value),$.each(n.ideas,function(e,t){e==i[o].name&&n.ideas.splice(e,1)});if(0<e.length){var t=e.join(",");a({method:"delete",url:rootPath+"/idea",params:{ideas:t}}).then(function(e){r.alert("删除成功！",function(){a({method:"post",url:rootPath+"/idea/findMyIdea"}).then(function(e){n.ideas=e.data})})})}}},n.addCorrentIdea=function(e){n.ideaContent+=e},n.addCommonIdea=function(){n.ideas||(n.ideas=[]),n.newIdea={},n.newIdea.ideaType="1",n.ideas.push(n.newIdea)},n.saveCommonIdea=function(){0!=n.ideas.length?a({method:"post",url:rootPath+"/idea",headers:{contentType:"application/json;charset=utf-8"},dataType:"json",data:angular.toJson(n.ideas)}).then(function(e){e.data.flag||"ok"==e.data.reCode?(n.ideas=e.data.reObj,r.alert("添加成功！")):r.alert(e.data.reMsg)}):r.alert("请编辑你要保存的意见信息！")},n.saveCurrentIdea=function(){var e=$("#"+t.targetId);e.val(e.val()+n.ideaContent),window.parent.$("#ideaWindow").data("kendoWindow").close(),e.focus()}},initIdea:function(t){var e={method:"post",url:rootPath+"/idea/findMyIdea"};common.http({$http:a,httpOptions:e,success:function(e){t.ideas=e.data}})}}}angular.module("app").factory("ideaSvc",e),e.$inject=["$http","bsWin"]}(),function(){"use strict";function e(e,t){var n=this;n.title="单位列表",n.del=function(e){common.confirm({vm:n,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deletecompany(n,e)}})},n.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:n,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");n.del(o)}},n.queryConpany=function(){t.queryConpany(n)},t.grid(n)}angular.module("app").controller("companyCtrl",e),e.$inject=["$location","companySvc"]}(),function(){"use strict";function e(e,t,i){var o=this;o.title="新增单位",o.iscompanyExist=!1,o.id=i.params.id,o.id&&(o.isUpdate=!0,o.title="更新单位"),o.create=function(){t.createcompany(o)},o.update=function(){t.updatecompany(o)},o.isUpdate&&t.getcompanyById(o)}angular.module("app").controller("companyEditCtrl",e),e.$inject=["$location","companySvc","$state"]}(),function(){"use strict";function e(o,e){var n=rootPath+"/company",i="#/company";rootPath;return{grid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(n+"/fingByOData",$("#form")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"coName",title:"单位名称",width:220,filterable:!1},{field:"coPhone",title:"单位电话",width:100,filterable:!1},{field:"coPC",title:"邮编",width:100,filterable:!1},{field:"coAddress",title:"地址",width:160,filterable:!1},{field:"coType",title:"单位类型",width:160,filterable:!1},{field:"",title:"操作",width:200,template:function(e){return common.format($("#columnBtns").html(),"vm.del('"+e.id+"')",e.id)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})},resizable:!0}},createcompany:function(t){if(common.initJqValidation(),$("form").valid()&&0==t.iscompanyExist){t.isSubmit=!0;var e={method:"post",url:n,data:t.model};common.http({vm:t,$http:o,httpOptions:e,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=i}})}})}})}},getcompanyById:function(t){var e={method:"get",url:n+"/html/findByIdCompany",params:{id:t.id}};common.http({vm:t,$http:o,httpOptions:e,success:function(e){t.model=e.data,console.log(t.model)}})},updatecompany:function(t){if(common.initJqValidation(),$("form").valid()&&0==t.iscompanyExist){t.isSubmit=!0,t.model.id=t.id;var e={method:"put",url:n,data:t.model};common.http({vm:t,$http:o,httpOptions:e,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})}})}},deletecompany:function(t,e){t.isSubmit=!0;var i={method:"delete",url:n,data:e};common.http({vm:t,$http:o,httpOptions:i,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})}})},queryConpany:function(e){e.gridOptions.dataSource._skip=0,e.gridOptions.dataSource.read()},saveUnit:function(e,t){var i={method:"put",url:n+"/saveUnitScore",data:e};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}}}angular.module("app").factory("companySvc",e),e.$inject=["$http","$compile"]}(),function(){"use strict";function e(e,t){var n=this;n.title="处室管理",n.del=function(e){common.confirm({vm:n,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteDept(n,e)}})},n.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:n,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");n.del(o)}},n.queryDept=function(){t.queryDept(n)},t.grid(n)}angular.module("app").controller("deptCtrl",e),e.$inject=["$location","deptSvc"]}(),function(){"use strict";function e(e,t,i){var o=this;o.title="编辑处室",o.isuserExist=!1,o.deptId=i.params.deptId,o.deptId&&(o.isUpdate=!0,o.title="更新处室"),o.create=function(){t.createDept(o)},o.update=function(){t.updateDept(o)},o.isUpdate&&t.getDeptById(o)}angular.module("app").controller("deptEditCtrl",e),e.$inject=["$location","deptSvc","$state"]}(),function(){"use strict";function e(o){var n=rootPath+"/dept",i="#/listDept";return{grid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(n+"/fingByOData",$("#formDept")),schema:common.kendoGridConfig().schema({id:"deptId",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.deptId)},filterable:!1,width:20,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:30,filterable:!1,template:"<span class='row-number'></span>"},{field:"deptName",title:"处室名称",width:100,filterable:!1},{field:"deptUserName",title:"负责人",width:100,filterable:!1},{field:"address",title:"地址",width:100,filterable:!1},{field:"deptType",title:"类型",width:100,filterable:!1},{field:"",title:"状态",width:100,filterable:!1,template:function(e){return e.status?5==e.status?"正常":7==e.status?"已删除":void 0:" "}},{field:"",title:"操作",width:140,template:function(e){return common.format($("#columnBtns").html(),"vm.del('"+e.deptId+"')",e.deptId,e.deptId)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})},resizable:!0}},getDeptById:function(t){var e={method:"get",url:rootPath+"/dept/html/findById",params:{deptId:t.deptId}};common.http({vm:t,$http:o,httpOptions:e,success:function(e){e.data.offices&&(t.offices={},t.offiecs=e.data.offices);t.model=e.data}})},createDept:function(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0;var e={method:"post",url:n,data:t.model};common.http({vm:t,$http:o,httpOptions:e,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,location.href=i}})}})}})}},deleteDept:function(t,e){t.isSubmit=!0;var i={method:"delete",url:n,data:e};common.http({vm:t,$http:o,httpOptions:i,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})}})}})},updateDept:function(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0;var e={method:"put",url:n,data:t.model};common.http({vm:t,$http:o,httpOptions:e,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1}})}})}})}},queryDept:function(e){e.gridOptions.dataSource._skip="",e.gridOptions.dataSource.read()}}}angular.module("app").factory("deptSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.title="办事处人员列表",n.id=t.params.deptId,n.showAddUserDialog=function(){$(".addUser").modal({backdrop:"static",keyboard:!1}),n.deptOfficeGrid.dataSource.read()},n.closeAddUserDialog=function(){$(".addUser").modal("hide")},n.addOfficeUser=function(e){o.addOfficeUser(n,e)},n.remove=function(e){common.confirm({vm:n,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),o.deletedeptOfficeUser(n,e)}})},n.removes=function(){var e=common.getKendoCheckId(".deptOfficeGrid");if(0==e.length)common.alert({vm:n,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");n.remove(o)}},o.grid(n),o.deptOfficeGrid(n)}angular.module("app").controller("deptOfficeUserCtrl",e),e.$inject=["$location","$state","deptSvc","deptOfficeUserSvc"]}(),function(){"use strict";function e(o){var i=rootPath+"/dept",n="#/deptList",a=rootPath+"/dept/getDeptOfficeUsers",r=rootPath+"/dept/NotInoDeptfficeUsers";return{grid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(a+"?deptId="+e.id),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.officeID)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"officeUserName",title:"负责人",width:100,filterable:!1},{field:"officePhone",title:"电话",width:100,filterable:!1},{field:"officeDesc",title:"描述",width:100,filterable:!1},{field:"",title:"操作",width:140,template:function(e){return common.format($("#columnBtns").html(),"vm.remove('"+e.officeID+"')",e.officeID)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0}},getdeptById:function(t){var e={method:"get",url:rootPath+"/dept/html/findById",params:{officeID:t.officeID}};common.http({vm:t,$http:o,httpOptions:e,success:function(e){e.data.dept&&(t.depts={});t.model=e.data}})},createdept:function(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0;var e={method:"post",url:i,data:t.model};common.http({vm:t,$http:o,httpOptions:e,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,location.href=n}})}})}})}},deletedeptOfficeUser:function(t,e){t.isSubmit=!0;var i={method:"delete",url:rootPath+"/dept/deleteOfficeUsers",params:{deptId:t.id,officeId:e}};common.http({vm:t,$http:o,httpOptions:i,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})}})}})},updatedept:function(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0,t.model.id=t.id;var e={method:"put",url:i,data:t.model};common.http({vm:t,$http:o,httpOptions:e,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})}})}},getDepts:function(t){var e={method:"get",url:common.format(i+"/getDepts")};common.http({vm:t,$http:o,httpOptions:e,success:function(e){t.depts={},t.depts=e.data}})},deptOfficeGrid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(r+"?deptId="+e.id),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.officeID)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"officeUserName",title:"负责人",width:100,filterable:!1},{field:"officePhone",title:"电话",width:100,filterable:!1},{field:"officeDesc",title:"描述",width:100,filterable:!1},{field:"",title:"操作",width:140,template:function(e){return common.format($("#allUserGridBtns").html(),"vm.addOfficeUser('"+e.officeID+"')",e.officeID)}}];e.deptOfficeGrid={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0}},addOfficeUser:function(t,e){var i={method:"post",url:rootPath+"/dept/addOfficeUser",params:{deptId:t.id,officeId:e}};common.http({vm:t,$http:o,httpOptions:i,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.deptOfficeGrid.dataSource.read(),t.gridOptions.dataSource.read()}})}})}}}angular.module("app").factory("deptOfficeUserSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(t,i,n){var a=this;a.title="字典",a.model={},t.initDictTree(function(e){var t,i={callback:{onClick:function(e,t,i){n.go("dict.edit",{id:i.id})}},data:{simpleData:{enable:!0,idKey:"id",pIdKey:"pId"}}},o=$linq(e.value).select(function(e){var t=null;return e.parentId&&(t=e.parentId),{id:e.dictId,name:e.dictName,pId:t}}).toArray();t=$.fn.zTree.init($("#zTree"),i,o),a.dictsTree=t}),a.del=function(e){i.confirm({title:"询问提示",message:"删除字典将会连下级字典一起删除，确认删除数据吗？",onOk:function(){t.deleteDict(e,a.isSubmit,function(e){a.isSubmit=!1,e.flag||"ok"==e.reCode?i.alert("消息提示","操作成功！",function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),n.go("dict",{},{reload:!0})}):i.alert(e.reMsg)})}})},a.dels=function(){var e=a.dictsTree.getSelectedNodes();e&&0<e.length?a.del(e[0].id):i.alert("请选择要删除的数据！")}}angular.module("app").controller("dictCtrl",e),e.$inject=["dictSvc","bsWin","$state"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.title="增加字典",n.model={},n.id=o.params.id,n.id&&(n.isUpdate=!0,n.title="编辑字典"),n.model.dictSort=0,n.isUpdate?i.getDictById(n.id,function(e){e.flag||"ok"==e.reCode?(n.model=e.reObj,i.getTreeData(function(e){if(n.treeData={},n.treeData=e.value,n.isUpdate&&n.treeData&&n.model.parentId)for(var t=0;t<n.treeData.length;t++)if(n.treeData[t].dictId==n.model.parentId){n.model.parentDictName=n.treeData[t].dictName;break}})):t.alert(e.reMsg)}):(n.model.dictCode="",i.initpZtreeClient(function(e){var t=$linq(e.value).select(function(e){var t;return e.parentId&&(t=e.parentId),{id:e.dictId,name:e.dictName,pId:t}}).toArray();n.zpTree=$.fn.zTree.init($("#pzTree"),{check:{enable:!0,chkStyle:"radio",radioType:"all"},callback:{},data:{simpleData:{enable:!0,idKey:"id",pIdKey:"pId"}}},t)})),n.createDict=function(){if(common.initJqValidation(),$("form").valid()){var e=n.zpTree.getCheckedNodes(!0);e&&0<e.length&&(n.model.parentId=e[0].id),i.createDict(n.model,n.isSubmit,function(e){n.isSubmit=!1,e.flag||"ok"==e.reCode?($(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),t.alert("系统提示","操作成功！",function(){o.go("dict",{},{reload:!0})})):t.alert(e.reMsg)})}else t.alert("数据填写正确，请检查修改后再提交")},n.updateDict=function(){common.initJqValidation(),$("form").valid()?i.updateDict(n.model,n.isSubmit,function(e){n.isSubmit=!1,e.flag||"ok"==e.reCode?($(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),t.alert("系统提示","操作成功！",function(){o.go("dict.edit",{id:n.model.dictId},{reload:!0})})):t.alert(e.reMsg)}):t.alert("数据填写正确，请检查修改后再提交")},n.dictTypeChange=function(){n.model.dictType&&(n.model.dictKey="")},n.apply=function(){e.$apply()}}angular.module("app").controller("dictEditCtrl",e),e.$inject=["$scope","bsWin","dictSvc","$state"]}(),function(){"use strict";function e(n,e,t){rootPath;var i=rootPath+"/dict/dictNameData";return{initDictTree:function(t){var e={method:"post",url:rootPath+"/dict/fingByOdata?$orderby=dictSort"};common.http({$http:n,httpOptions:e,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},createDict:function(e,t,i){!0;var o={method:"post",url:rootPath+"/dict",data:e};common.http({$http:n,httpOptions:o,success:function(e){!1,null!=i&&"function"==typeof i&&i(e.data)},onError:function(){!1}})},getDictById:function(e,t){var i={method:"post",url:rootPath+"/dict/fingById",params:{id:e}};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},updateDict:function(e,t,i){!0;var o={method:"put",url:rootPath+"/dict",data:e};common.http({$http:n,httpOptions:o,success:function(e){!1,null!=i&&"function"==typeof i&&i(e.data)},onError:function(){!1}})},deleteDict:function(e,t,i){!0;var o={method:"delete",url:rootPath+"/dict",data:e};common.http({$http:n,httpOptions:o,success:function(e){!1,null!=i&&"function"==typeof i&&i(e.data)},onError:function(){!1}})},initpZtreeClient:function(t){var e={method:"post",url:rootPath+"/dict/fingByOdata?$orderby=dictSort"};common.http({$http:n,httpOptions:e,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},getTreeData:function(t){var e={method:"post",url:rootPath+"/dict/fingByOdata?$orderby=dictSort"};common.http({$http:n,httpOptions:e,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},getdictItems:function(e){var t={method:"get",url:common.format(i+"?dictCode={0}","DICT_SEX")};common.http({vm:e,$http:n,httpOptions:t,success:function(e){}})}}}angular.module("app").factory("dictSvc",e),e.$inject=["$http","$state","$location"]}(),function(){"dispatch strict";function e(t,e,i,o,n,a,r){var s=this;s.title="项目发文编辑",s.sign={},s.searchSign={},s.dispatchDoc={},s.disData={},s.dispatchDoc.signId=i.params.signid,s.isControl=i.params.isControl,s.dispatchDoc.id="",s.showFlag={buttSysFile:!1,isReveiwDS:!1},s.busiFlag={isMerge:!1,isMain:!1},t.initDispatchData(s),s.watchIsRelated=function(){n.$watch("vm.dispatchDoc.isRelated",function(e,t){0!=e&&"0"!=e||9!=t&&"9"!=t||1!=s.sign.isAssociate?0!=t&&"0"!=t||9!=e&&"9"!=e||s.sign.isAssociate&&0!=s.sign.isAssociate||(signcommon.getReviewStage().OTHERS==s.dispatchDoc.dispatchStage||signcommon.getReviewStage().DEVICE_BILL_HOMELAND==s.dispatchDoc.dispatchStage||signcommon.getReviewStage().DEVICE_BILL_IMPORT==s.dispatchDoc.dispatchStage||signcommon.getReviewStage().IMPORT_DEVICE==s.dispatchDoc.dispatchStage?(o.alert("该阶段不能进行关联！"),s.dispatchDoc.isRelated=0):o.confirm({title:"询问提示",message:"您要进行项目关联么？",onOk:function(){s.ss?s.page.selPage(1):s.page=lgx.page.init({id:"demo5",get:function(e){var t;s.price||(s.price={signid:s.sign.signid,projectname:s.sign.projectname}),s.price.reviewstage=s.sign.reviewstage,t=0!=e.skip?e.skip+1:e.skip,s.price.skip=t,s.price.size=e.size+e.skip,a.getAssociateSignGrid(s,function(e){s.associateSignList=[],e&&(s.associateSignList=e.value,s.page.callback(e.count)),s.ss=!0})}}),$("#associateWindow").kendoWindow({width:"75%",height:"750px",title:"项目关联",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()},onCancel:function(){console.log(1),n.$apply(function(){s.dispatchDoc.isRelated=0})},onClose:function(){s.ss?n.$apply(function(){s.dispatchDoc.isRelated=9}):n.$apply(function(){s.dispatchDoc.isRelated=0})}})):o.confirm({title:"询问提示",message:"该项目已经进行了关联，您要解除关联么？",onOk:function(){s.isdik=!0,$(".confirmDialog").modal("hide"),a.saveAssociateSign(i.params.signid,null,function(){o.alert("项目解除关联成功")})},onCancel:function(){n.$apply(function(){s.dispatchDoc.isRelated=9})},onClose:function(){s.isdik?n.$apply(function(){s.dispatchDoc.isRelated=0}):n.$apply(function(){s.dispatchDoc.isRelated=9})}})})},s.associateQuerySign=function(){a.getAssociateSignGrid(s,function(e){s.associateSignList=[],e&&(s.associateSignList=e.value,s.page.callback(e.count))})},s.saveAssociateSign=function(t){s.sign.signid!=t?a.saveAssociateSign(s.sign.signid,t,function(e){e.flag||"ok"==e.reCode?(t?(s.sign.isAssociate=1,s.associateDispatchs=e.reObj):s.associateDispatchs=[],o.alert(null!=t?"项目关联成功":"项目解除关联成功",function(){window.parent.$("#associateWindow").data("kendoWindow").close()})):o.alert(e.reMsg)}):o.alert("不能关联自身项目")},s.initFileUpload=function(){s.dispatchDoc.id||n.$watch("vm.dispatchDoc.id",function(e,t){e&&e!=t&&!s.initUploadOptionSuccess&&s.initFileUpload()}),s.sysFile={businessId:s.dispatchDoc.id,mainId:s.dispatchDoc.signId,mainType:e.mainTypeValue().SIGN,sysfileType:e.mainTypeValue().DISPATCH,sysBusiType:e.mainTypeValue().DISPATCH},e.initUploadOptions({inputId:"sysfileinput",vm:s})},s.sigleProject=function(){"1"==s.dispatchDoc.dispatchWay?s.busiFlag.isMerge&&s.busiFlag.isMain&&o.confirm({title:"询问提示",message:"该项目已经设为合并发文，并且已经有关联项目，如果现在要取消合并发文，以前的关联信息将被删除，您确定要取消合并发文么?",onOk:function(){t.deleteAllMerge(s.dispatchDoc.signId,function(e){(e.flag||"ok"==e.reCode)&&(s.dispatchDoc.isMainProject="0",s.busiFlag.isMerge=!1,s.busiFlag.isMain=!1),o.alert(e.reMsg)})},onClose:function(){},onCancel:function(){s.dispatchDoc.dispatchWay="2",$(".confirmDialog").modal("hide")}}):"2"==s.dispatchDoc.dispatchWay&&(s.busiFlag.isMerge||(s.busiFlag.isMerge=!0,s.busiFlag.isMain="9"==s.dispatchDoc.isMainProject))},s.create=function(){common.initJqValidation($("#dispatch_form")),$("#dispatch_form").valid()?t.saveDispatch(s,function(e){s.isCommit=!1,(e.flag||"ok"==e.reCode)&&(s.dispatchDoc.dispatchWay&&2==s.dispatchDoc.dispatchWay&&(s.busiFlag.isMerge=!0),s.dispatchDoc.isMainProject&&9==s.dispatchDoc.isMainProject&&(s.busiFlag.isMain=!0),s.dispatchDoc.id||(s.dispatchDoc.id=e.reObj.id)),o.alert(e.reMsg)}):o.alert("提交失败，带红色*的项是必填项，请确认是否已经填写！")},s.count=function(){var e=!1,t=!1,i=/^(-)?(([1-9]{1}\d*)|([0]{1}))(\.(\d){1,4})?$/;if(s.dispatchDoc.declareValue){if(!i.test(s.dispatchDoc.declareValue))return s.dispatchDoc.declareValue=null,void $("span[data-valmsg-for='declareValue']").html("金额只能输入数字！");e=!0}if(s.dispatchDoc.authorizeValue&&(i.test(s.dispatchDoc.authorizeValue)?t=!0:(s.dispatchDoc.authorizeValue=null,$("span[data-valmsg-for='authorizeValue']").html("金额只能输入数字！"))),s.dispatchDoc.approveValue&&!i.test(s.dispatchDoc.approveValue))return s.dispatchDoc.approveValue=null,void $("span[data-valmsg-for='approveValue']").html("金额只能输入数字！");var o="",n="";e&&t&&($("span[data-valmsg-for='declareValue']").html(""),$("span[data-valmsg-for='authorizeValue']").html(""),o=parseFloat(s.dispatchDoc.authorizeValue)>parseFloat(s.dispatchDoc.declareValue)?(parseFloat(s.dispatchDoc.authorizeValue)-parseFloat(s.dispatchDoc.declareValue)).toFixed(2):(parseFloat(s.dispatchDoc.declareValue)-parseFloat(s.dispatchDoc.authorizeValue)).toFixed(2),0<s.dispatchDoc.declareValue&&(n=parseFloat(o/s.dispatchDoc.declareValue*1e4/100).toFixed(2))),s.dispatchDoc.extraRate=n,s.dispatchDoc.extraValue=o},s.gotoMergePage=function(){s.dispatchDoc.id?(s.disData={},t.findDocById(s.dispatchDoc.id,function(e){s.disData=e,s.disData.dispatchWay==s.dispatchDoc.dispatchWay&&s.disData.isMainProject==s.dispatchDoc.isMainProject?(t.initMergeInfo(s,s.dispatchDoc.signId),$("#mergeSign").kendoWindow({width:"75%",height:"700px",title:"合并发文",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()):o.alert("请先保存！")})):o.alert("请先保存！")},s.chooseSign=function(){var e=$("input[name='mergeSign']:checked");if(0==e.length)o.alert("请选择要合并发文的项目！");else{var i=[];$.each(e,function(e,t){i.push(t.value)}),t.chooseProject(s.dispatchDoc.signId,i.join(","),function(e){(e.flag||"ok"==e.reCode)&&t.initMergeInfo(s,s.dispatchDoc.signId),o.alert(e.reMsg)})}},s.cancelSign=function(){var e=$("input[name='cancelMergeSignid']:checked");if(e.length<1)o.alert("请选择要取消合并发文的项目！");else{var i=[];$.each(e,function(e,t){i.push(t.value)}),t.cancelProject(s.dispatchDoc.signId,i.join(","),function(e){(e.flag||"ok"==e.reCode)&&t.initMergeInfo(s,s.dispatchDoc.signId),o.alert(e.reMsg)})}},s.onClose=function(){window.parent.$("#mwindow").data("kendoWindow").close()},s.filterSign=function(e){var t=!0;if(s.searchSign.projectname&&-1==e.projectname.indexOf(s.searchSign.projectname)&&(t=!1),s.searchSign.reviewstage&&e.reviewstage!=s.searchSign.reviewstage&&(t=!1),t)return e},s.formReset=function(){s.searchSign={}},s.updateDisCode=function(){$("#disCodeWin").kendoWindow({width:"660px",height:"400px",title:"发文文号编辑",visible:!1,modal:!0,closable:!0,actions:["Close"]}).data("kendoWindow").center().open()},s.templatePage=function(e){r.templatePage(e)}}angular.module("app").controller("dispatchEditCtrl",e),e.$inject=["dispatchSvc","sysfileSvc","$state","bsWin","$scope","signSvc","templatePrintSvc"]}(),function(){"dispatch strict";function e(e,a,o,t){return{initDispatchData:function(i){i.busiFlag.signleToMerge=!1;var e={method:"get",url:rootPath+"/dispatch/initData",params:{signid:i.dispatchDoc.signId}};common.http({vm:i,$http:a,httpOptions:e,success:function(e){var t=e.data;i.sign=t.sign,i.dispatchDoc=t.dispatch,null==i.dispatchDoc.authorizeValue&&(i.dispatchDoc.authorizeValue=0);i.dispatchDoc.signId=o.params.signid,i.dispatchDoc.dispatchWay&&2==i.dispatchDoc.dispatchWay&&(i.busiFlag.isMerge=!0);i.dispatchDoc.isMainProject&&9==i.dispatchDoc.isMainProject&&(i.busiFlag.isMain=!0);i.associateDispatchs=t.associateDispatchs,i.proofread=t.mainUserList,2==i.dispatchDoc.dispatchWay&&0==i.dispatchDoc.isMainProject&&(i.showFlag.isReveiwDS=!0);i.initFileUpload(),i.watchIsRelated()}})},saveDispatch:function(e,t){e.isCommit=!0;var i={method:"post",url:rootPath+"/dispatch",data:e.dispatchDoc};common.http({$http:a,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)},onError:function(){e.isCommit=!1}})},initMergeInfo:function(t,e){n(e,function(e){t.unMergeSign=[],t.unMergeSign=e}),i(e,function(e){t.mergeSign=[],t.mergeSign=e})},unMergeDISSign:n,getMergeDISSign:i,chooseProject:function(e,t,i){var o={method:"post",url:rootPath+"/signView/mergeSign",params:{signId:e,mergeIds:t,mergeType:"2"}};common.http({$http:a,httpOptions:o,success:function(e){null!=i&&"function"==typeof i&&i(e.data)}})},cancelProject:function(e,t,i){var o={signId:e,mergeType:"2"};t&&(o.cancelIds=t);var n={method:"post",url:rootPath+"/signView/cancelMergeSign",params:o};common.http({$http:a,httpOptions:n,success:function(e){null!=i&&"function"==typeof i&&i(e.data)}})},deleteAllMerge:function(e,t){var i={method:"post",url:rootPath+"/signView/deleteAllMerge",params:{signId:e,mergeType:"2"}};common.http({$http:a,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},findDocById:function(e,t){var i={method:"post",url:rootPath+"/dispatch/findById",params:{dictId:e}};common.http({$http:a,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)},onError:function(){vm.isCommit=!1}})},findMergeDis:function(e,t){var i={method:"post",url:rootPath+"/dispatch/findMergeDisInfo",params:{mainSignId:e}};common.http({$http:a,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)},onError:function(){}})}};function i(e,t){var i={method:"post",url:rootPath+"/signView/getMergeDISSign",params:{signId:e}};common.http({$http:a,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}function n(e,t){var i={method:"post",url:rootPath+"/signView/unMergeDISSign",params:{signId:e}};common.http({$http:a,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}}angular.module("app").factory("dispatchSvc",e),e.$inject=["sysfileSvc","$http","$state","bsWin"]}(),function(){"use strict";function e(e,t,i){var o=this;o.title="专家审核",t.auditGrid(o),o.searchAudit=function(){t.searchAudit(o)},o.auditToOfficial=function(){t.auditTo(o,2)},o.auditToAlternative=function(){t.auditTo(o,3)},o.auditToStop=function(){t.auditTo(o,4)},o.auditToRemove=function(){t.auditTo(o,0)},o.officialToAudit=function(){t.toAudit(o,2)},o.alternativeToAudit=function(){t.toAudit(o,3)},o.stopToAudit=function(){t.toAudit(o,4)},o.temoveToAudit=function(){t.toAudit(o,5)},o.findExportDetail=function(e){o.model={},o.reviewProjectList=[],t.getExpertById(e,function(e){o.model=e,$("#auditExportDetail").kendoWindow({width:"80%",height:"620px",title:"专家详细信息",visible:!1,modal:!0,open:function(){$("#expertPhotoSrc").attr("src",rootPath+"/expert/transportImg?expertId="+o.model.expertID+"&t="+Math.random()),$("#myTab li").click(function(e){var t=$("a",this);e.preventDefault(),t.tab("show");var i=t.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500)}),o.reviewProjectList=[],t.reviewProjectGrid(o.model.expertID,function(e){o.isLoading=!1,e&&0<e.length?(o.reviewProjectList=e,o.noData=!1):o.noData=!0})},closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()})}}angular.module("app").controller("expertAuditCtrl",e),e.$inject=["$scope","expertSvc","templatePrintSvc"]}(),function(){"expert strict";function e(t,i,e,o,n){var a=this;a.data={},a.title="专家列表",a.expertId="",a.headerType="专家类型",a.fileName="专家信息",a.expert={},a.expertList=new Array(10),a.searchmodel={},a.stateName=e.current.name,a.queryParams={},a.saveView=function(){t.storeView(a.stateName,{gridParams:a.gridOptions.dataSource.transport.options.read.data(),queryParams:a.queryParams,data:a})},function(){if(t.view[a.stateName]){var e=t.view[a.stateName];e.gridParams&&(a.gridParams=e.gridParams),e.data&&(a.searchmodel=e.data.searchmodel),e.queryParams&&(a.queryParams=e.queryParams),i.grid(a),t.view[a.stateName]=void 0}else i.grid(a)}(),a.search=function(){a.saveView(),i.searchMuti(a)},a.searchAudit=function(){i.searchMAudit(a)},a.formReset=function(){a.searchmodel={}},a.del=function(e){common.confirm({vm:a,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),i.deleteExpert(a,e,function(e){a.isSubmit=!1,a.gridOptions.dataSource.read()})}})},a.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:a,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");a.del(o)}},a.findExportDetail=function(e){i.getExpertById(e,function(e){a.model=e,$("#queryExportDetail").kendoWindow({width:"80%",height:"620px",title:"专家详细信息",visible:!1,modal:!0,open:function(){$("#expertPhotoSrc").attr("src",rootPath+"/expert/transportImg?expertId="+a.model.expertID+"&t="+Math.random()),$("#myTab li").click(function(e){var t=$("a",this);e.preventDefault(),t.tab("show");var i=t.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500)}),a.editPrint=function(){o.templatePrint("expertApply_templ")},a.reviewProjectList=[],i.reviewProjectGrid(a.model.expertID,function(e){a.isLoading=!1,e&&0<e.length?(a.reviewProjectList=e,a.noData=!1):a.noData=!0})},closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()})},a.exportToExcel=function(){i.exportToExcel(a)},a.selectHeader=function(){n.selectHeaderWindow(a,a.headerType)}}angular.module("app").controller("expertCtrl",e),e.$inject=["$rootScope","expertSvc","$state","templatePrintSvc","headerSvc"]}(),function(){"expert strict";function e(t,o,n,e,i,a,r,s){var l=this;l.model={},l.data={},l.title="专家信息编辑",l.isuserExist=!1,l.expertID=r.params.id,l.showSS=!0,l.showSC=!1,l.showWS=!0,l.showWC=!1,l.MW=!1,l.MS=!1,l.expertList=new Array(10),l.expertID&&e.getExpertById(l.expertID,function(e){var i,t;l.model=e,l.showSS=!1,l.showSC=!0,l.showWS=!1,l.showWC=!0,i=l,t={language:"zh",allowedPreviewTypes:["image"],allowedFileExtensions:["jpg","png","gif"],maxFileSize:2e3,showRemove:!1,uploadUrl:rootPath+"/expert/uploadPhoto",uploadExtraData:{expertId:i.model.expertID}},$("#expertphotofile").fileinput(t).on("filebatchselected",function(e,t){}).on("fileuploaded",function(e,t){$("#expertPhotoSrc").removeAttr("src"),$("#expertPhotoSrc").attr("src",rootPath+"/expert/transportImg?expertId="+i.model.expertID+"&t="+Math.random())}),$("#expertPhotoSrc").attr("src",rootPath+"/expert/transportImg?expertId="+l.model.expertID+"&t="+Math.random())}),l.selReviewProject=function(){l.model.expertID&&$("#reviewProject").kendoWindow({width:"75%",height:"600px",title:"评审项目列表",visible:!1,open:function(){l.isLoading=!0,l.reviewProjectList=[],e.reviewProjectGrid(l.model.expertID,function(e){l.isLoading=!1,e&&0<e.length?(l.reviewProjectList=e,l.noData=!1):l.noData=!0})},modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()},l.queryDetail=function(e,t){$("#reviewProject").data("kendoWindow").close(),r.go("signDetails",{signid:e,processInstanceId:t})},l.showUploadWin=function(){l.model.expertID?$("#uploadWin").kendoWindow({width:"660px",height:"360px",title:"上传头像",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open():common.alert({vm:l,msg:"先保存数据在执行操作！"})},l.saveEP=function(){common.initJqValidation(),$("form").valid()?(l.isSubmit=!0,l.model.birthDay=$("#birthDay").val(),l.model.graduateDate=$("#graduateDate").val(),e.saveExpert(l.model,l.isSubmit,function(e){l.isSubmit=!1,e.flag||"ok"==e.reCode?(l.model.expertID=e.reObj.expertID,l.model.expertNo=e.reObj.expertNo,t.success("保存成功！")):t.error(e.reMsg)})):t.alert("专家信息没有填写完整")},l.gotoWPage=function(){l.model.expertID?$("#wrwindow").kendoWindow({width:"680px",height:"420px",title:"工作简历",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open():t.alert("请先保存专家信息！")},l.saveWorks=function(){common.initJqValidation($("#workForm")),$("#workForm").valid()&&(l.work.expertID||(l.work.expertID=l.model.expertID),n.saveWork(l.work,function(i){i.flag||"ok"==i.reCode?(l.work.weID?$.each(l.model.workDtoList,function(e,t){t.weID==l.work.weID&&(t=i.reObj)}):(l.model.workDtoList||(l.model.workDtoList=[]),l.model.workDtoList.push(i.reObj)),t.success(i.reMsg,function(){l.work={},l.onWClose()})):t.error(i.reMsg)}))},l.updateWork=function(){var e=$("input[name='checkwr']:checked");if(e.length<1)t.alert("请选择要更改的项目经历信息！");else if(1<e.length)t.alert("每次只能更改一条记录！");else{var i=e.val();$.each(l.model.workDtoList,function(e,t){t.weID==i&&(l.work=t)}),l.gotoWPage()}},l.deleteWork=function(){var e=$("input[name='checkwr']:checked");if(e.length<1)t.alert("请选择要删除的工作简历");else{var i=[];$.each(e,function(e,t){i.push(t.value)}),n.deleteWork(i.join(","),function(){$.each(i,function(e,i){$.each(l.model.workDtoList,function(e,t){t&&t.weID==i&&l.model.workDtoList.splice(e,1)})}),t.alert("操作成功！")})}},l.onWClose=function(){window.parent.$("#wrwindow").data("kendoWindow").close()},l.gotoJPage=function(){l.model.expertID?$("#pjwindow").kendoWindow({width:"690px",height:"330px",title:"添加项目经验",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open():t.alert("请先保存专家信息！")},l.saveProject=function(){common.initJqValidation($("#ProjectForm")),$("#ProjectForm").valid()&&(l.project.expertID||(l.project.expertID=l.model.expertID),l.project.projectbeginTime=$("#projectbeginTime").val(),l.project.projectendTime=$("#projectendTime").val(),o.saveProject(l.project,function(i){i.flag||"ok"==i.reCode?(l.project.peID?$.each(l.model.projectDtoList,function(e,t){t.peID==l.project.peID&&(t=i.reObj)}):(l.model.projectDtoList||(l.model.projectDtoList=[]),l.model.projectDtoList.push(i.reObj)),t.success(i.reMsg,function(){l.project={},l.onPClose()})):t.error(i.reMsg)}))},l.updateProjectPage=function(){var e=$("input[name='checkpj']:checked");if(e.length<1)t.alert("请选择要更改的项目经历信息！");else if(1<e.length)t.alert("每次只能更改一条记录！");else{var i=e.val();$.each(l.model.projectDtoList,function(e,t){t.peID==i&&(l.project=t)}),l.gotoJPage()}},l.delertProject=function(){common.initJqValidation();var e=$("input[name='checkpj']:checked");if(e.length<1)t.alert("请选择要删除的操作对象!");else{var i=[];$.each(e,function(e,t){i.push(t.value)}),o.delertProject(i.join(","),function(){$.each(i,function(e,i){$.each(l.model.projectDtoList,function(e,t){t&&t.peID==i&&l.model.projectDtoList.splice(e,1)})}),t.alert("操作成功！")})}},l.onPClose=function(){window.parent.$("#pjwindow").data("kendoWindow").close()},l.gotoExpertType=function(){l.model.expertID?$("#addExpertType").kendoWindow({width:"680px",height:"400px",title:"专家类型",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open():t.alert("请先保存专家信息！")},l.onETlose=function(){a.cleanValue(),window.parent.$("#addExpertType").data("kendoWindow").close()},l.saveExpertType=function(){common.initJqValidation($("#expertTypeForm")),$("#expertTypeForm").valid()&&(l.expertType.expertID||(l.expertType.expertID=l.model.expertID),a.saveExpertType(l.expertType,function(i){i.flag||"ok"==i.reCode?(l.expertType.id?$.each(l.model.expertTypeDtoList,function(e,t){t.id==l.expertType.id&&(t=i.reObj)}):(l.model.expertTypeDtoList||(l.model.expertTypeDtoList=[]),l.model.expertTypeDtoList.push(i.reObj)),t.success(i.reMsg,function(){l.expertType={},l.onETlose()})):t.error(i.reMsg)}))},l.updateProjectType=function(){var e=$("input[name='checkEType']:checked");if(e.length<1)t.alert("请选择要更改的专业信息！");else if(1<e.length)t.alert("每次只能更改一条记录！");else{var i=e.val();$.each(l.model.expertTypeDtoList,function(e,t){t.id==i&&(l.expertType=t)}),l.expertType.majobSmallDicts=s.topSelectChange(l.expertType.maJorBig,s.DICT.MAJOR.dicts),l.gotoExpertType()}},l.delertProjectType=function(){var e=$("input[name='checkEType']:checked");if(e.length<1)t.alert("请选择删除的专家类别信息！");else{var i=[];$.each(e,function(e,t){i.push(t.value)}),a.deleteExpertType(i.join(","),function(){$.each(i,function(e,i){$.each(l.model.expertTypeDtoList,function(e,t){t&&t.id==i&&l.model.expertTypeDtoList.splice(e,1)})}),t.alert("操作成功！")})}},l.gotoOfferPage=function(){l.model.expertID?$("#ep_offer_div").kendoWindow({width:"820px",height:"600px",title:"专家聘书",visible:!1,modal:!0,closable:!0,close:function(){l.showProjectOffer=!1},actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open():t.alert("先保存专家信息！")},l.saveOffer=function(){common.initJqValidation($("#expert_offer_form")),$("#expert_offer_form").valid()&&(l.expertOffer.expertId=l.model.expertID,i.saveOffer(l.expertOffer,function(i){i.flag||"ok"==i.reCode?(l.expertOffer.id?$.each(l.model.expertOfferDtoList,function(e,t){t.id==l.expertOffer.id&&(t=i.reObj)}):(l.model.expertOfferDtoList||(l.model.expertOfferDtoList=[]),l.model.expertOfferDtoList.push(i.reObj)),t.success(i.reMsg,function(){l.expertOffer={},l.onETlose()})):t.error(i.reMsg)}))},l.closeOffer=function(){l.showProjectOffer=!1,window.parent.$("#ep_offer_div").data("kendoWindow").close()},l.showOffer=function(){var e=$("input[name='checkps']:checked");if(e.length<1)t.alert("请选择要查看的聘书信息！");else if(1<e.length)t.alert("每次只能查看一条记录！");else{var i=e.val();$.each(l.model.expertOfferDtoList,function(e,t){t.id!=i||(l.expertOffer=t)}),l.showProjectOffer=!0,l.gotoOfferPage()}},l.chooseMW=function(){l.MW=!0,l.showWS=!0,l.showWC=!1},l.cancelMW=function(){l.showWS=!1,l.showWC=!0},l.sureMW=function(){l.majorWork?(l.model.majorWork=l.majorWork,l.showWS=!1,l.showWC=!0):common.alert({vm:l,msg:"您未选择专业，请选择！",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}})},l.chooseMS=function(){l.MS=!0,l.showSS=!0,l.showSC=!1},l.cancelMS=function(){l.showSS=!1,l.showSC=!0},l.sureMS=function(){l.majorStudy?(l.model.majorStudy=l.majorStudy,l.showSS=!1,l.showSC=!0):common.alert({vm:l,msg:"您未选择专业，请选择！",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}})},l.queryDetail=function(e,t){$("#reviewProject").data("kendoWindow").close(),r.go("signDetails",{signid:e,processInstanceId:t})},l.editPrint=function(){e.expertPrint(l)}}angular.module("app").controller("expertEditCtrl",e),e.$inject=["bsWin","projectExpeSvc","workExpeSvc","expertSvc","expertOfferSvc","expertTypeSvc","$state","$rootScope"]}(),function(){"use strict";function e(e,t,n){var a=this;t.repeatGrid(a),a.findExportDetail=function(e){t.getExpertById(e,function(e){a.model=e,$("#reExportDetail").kendoWindow({width:"80%",height:"auto",title:"专家详细信息",visible:!1,modal:!0,open:function(){$("#expertPhotoSrc").attr("src",rootPath+"/expert/transportImg?expertId="+a.model.expertID+"&t="+Math.random())},closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()})},a.del=function(e){n.confirm("删除数据不可恢复，确认删除数据吗？",function(){t.deleteExpertData(a,e,function(e){n.alert("操作成功",function(){a.repeatGridOptions.dataSource.read()})})})},a.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)n.alert("请选择数据");else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");a.del(o)}}}angular.module("app").controller("expertRepeatCtrl",e),e.$inject=["$location","expertSvc","bsWin"]}(),function(){"expert strict";function e(e,t){var i=this;function o(){i.isSubmit=!0,i.noData=!1,t.expertScoreHis(i.selectHis,function(e){i.isSubmit=!1,i.expScoreList=e,i.expScoreList&&0!=i.expScoreList.length||(i.noData=!0)})}i.data={},i.title="专家评分统计",i.selectHis={},i.selectHis.beginTime=(new Date).yearAgo(1),i.selectHis.endTime=(new Date).Format("yyyy-MM-dd"),i.expScoreList=[],o(),i.search=function(){i.selectHis.scoreBegin?i.selectHis.scoreEnd?i.selectHis.score=i.selectHis.scoreBegin+i.selectHis.scoreEnd:i.selectHis.score=i.selectHis.scoreBegin+5:i.selectHis.score=1+i.selectHis.scoreEnd,o()},i.formReset=function(){i.selectHis={}}}angular.module("app").controller("expertScoreCtrl",e),e.$inject=["$location","expertSvc"]}(),function(){"expert strict";function e(e,t){var i=this;function o(){i.isSubmit=!0,i.noData=!1,t.expertSelectHis(i.selectHis,function(e){i.isSubmit=!1,(i.expSelectList=e)&&0!=e.length||(i.noData=!0)})}i.title="专家抽取统计",i.selectHis={},i.selectHis.beginTime=(new Date).yearAgo(1),i.selectHis.endTime=(new Date).Format("yyyy-MM-dd"),i.expSelectList=[],o(),i.search=function(){o()},i.formReset=function(){i.selectHis={}}}angular.module("app").controller("expertSelectHisCtrl",e),e.$inject=["$location","expertSvc"]}(),function(){"expert strict";function e(n,i,o,e){var a=rootPath+"/expert";return{grid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findByOData",$("#searchform"),e.gridParams),schema:common.kendoGridConfig().schema({id:"expertID",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:e.queryParams.pageSize||10,page:e.queryParams.page||1,sort:{field:"applyDate",dir:"desc"}});e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:r(e),pageable:common.kendoGridConfig(e.queryParams).pageable,dataBound:common.kendoGridConfig(e.queryParams).dataBound,resizable:!0}},auditGrid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findByOData",$("#auditform"),{$filter:"state eq '1'"},!0),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:25,sort:{field:"createdDate",dir:"desc"}}),i=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findByOData",$("#auditform"),{$filter:"state eq '2'"},!0),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:5,sort:{field:"createdDate",dir:"desc"}}),o=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findByOData",$("#auditform"),{$filter:"state eq '3'"},!0),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:5,sort:{field:"createdDate",dir:"desc"}}),n=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findByOData",$("#auditform"),{$filter:"state eq '4'"},!0),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:5,sort:{field:"createdDate",dir:"desc"}}),a=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findByOData",$("#auditform"),{$filter:"state eq '0'"},!0),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:5,sort:{field:"createdDate",dir:"desc"}}),r=function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})};e.gridOptions1={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:s(),dataBound:r,resizable:!0},e.gridOptions2={dataSource:common.gridDataSource(i),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:s(),dataBound:r,resizable:!0},e.gridOptions3={dataSource:common.gridDataSource(o),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:s(),dataBound:r,resizable:!0},e.gridOptions4={dataSource:common.gridDataSource(n),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:s(),dataBound:r,resizable:!0},e.gridOptions5={dataSource:common.gridDataSource(a),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:s(),dataBound:r,resizable:!0}},getExpertById:function(e,t){var i={method:"post",url:a+"/findById",params:{id:e}};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},saveExpert:function(e,t,i){!0;var o={method:"post",url:rootPath+"/expert",data:e};common.http({$http:n,httpOptions:o,success:function(e){!1,null!=i&&"function"==typeof i&&i(e.data)},onError:function(){!1}})},deleteExpert:function(t,e,i){t.isSubmit=!0;var o={method:"delete",url:a,params:{id:e}};common.http({vm:t,$http:n,httpOptions:o,success:function(e){t.isSubmit=!1,null!=i&&"function"==typeof i&&i(e.data)}})},deleteExpertData:function(t,e,i){t.isSubmit=!0;var o={method:"delete",url:rootPath+"/expert/deleteExpertData",params:{id:e}};common.http({vm:t,$http:n,httpOptions:o,success:function(e){t.isSubmit=!1,null!=i&&"function"==typeof i&&i(e.data)}})},searchMuti:function(e){e.gridOptions.dataSource._skip=0,e.gridOptions.dataSource.read()},searchAudit:function(e){e.gridOptions1.dataSource._skip=0,e.gridOptions2.dataSource._skip=0,e.gridOptions3.dataSource._skip=0,e.gridOptions4.dataSource._skip=0,e.gridOptions5.dataSource._skip=0,e.gridOptions1.dataSource.read(),e.gridOptions2.dataSource.read(),e.gridOptions3.dataSource.read(),e.gridOptions4.dataSource.read(),e.gridOptions5.dataSource.read()},repeatGrid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findRepeatByOData"),schema:common.kendoGridConfig().schema({id:"id"}),rowNumber:!0,headerCenter:!0});e.repeatGridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:r(e),dataBound:function(){var e=this.items();$(e).each(function(e){$(this).find(".row-number").html(e+1)})},resizable:!0}},updateAudit:l,toAudit:function(e,t){var i=common.getKendoCheckId("#grid"+t);if(0==i.length)common.alert({vm:e,msg:"请选择数据"});else{for(var o=[],n=0;n<i.length;n++)o.push(i[n].value);var a=o.join(",");l(e,a,1)}},auditTo:function(e,t){var i=common.getKendoCheckId("#grid1");if(0==i.length)common.alert({vm:e,msg:"请选择数据"});else{for(var o=[],n=0;n<i.length;n++)o.push(i[n].value);var a=o.join(",");l(e,a,t)}},formReset:function(e){$("#searchform")[0].reset()},exportToExcel:function(e){var t={method:"post",url:rootPath+"/expert/exportToExcel",responseType:"arraybuffer",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},data:{$filter:common.buildOdataFilter($("#searchform"))},transformRequest:function(e){var t=[];for(var i in e)t.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]));return t.join("&")}};common.http({$http:n,httpOptions:t,success:function(e){var t=new o([e.data],{type:"application/vnd.ms-excel"});i.saveAs(t,"专家信息.xls")}})},expertSelectHis:function(e,t){var i={method:"post",url:rootPath+"/expert/expertSelectHis",data:e};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},expertScoreHis:function(e,t){var i={method:"post",url:rootPath+"/expert/expertScoreHis",data:e};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},reviewProjectGrid:function(e,t){var i={method:"post",url:rootPath+"/expert/reviewProject",params:{expertId:e}};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},expertPrint:function(){e.templatePrint("expertApply_templ")}};function r(e){return[{field:"rowNumber",title:"序号",width:50,attributes:{class:"table-cell",style:"text-align: center"},template:"<span class='row-number'></span>",filterable:!1},{field:"name",title:"姓名",width:80,filterable:!1,template:function(e){return"<a  ng-click=\"vm.findExportDetail('"+e.expertID+"')\">"+e.name+"</a>"}},{field:"comPany",title:"工作单位",width:300,filterable:!1},{field:"phone",title:"办公电话",width:120,filterable:!1},{field:"userPhone",title:"手机号码",width:120,filterable:!1},{field:"job",title:"职位",width:150,filterable:!1},{field:"post",title:"职称",width:120,filterable:!1},{field:"expertSort",title:"专家类型",width:150,filterable:!1},{field:"compositeScore",title:"评分",width:60,filterable:!1},{field:"",title:"操作",width:80,template:function(e){var t=!0;return t="5"!=e.state,common.format($("#columnBtns").html(),"vm.del('"+e.expertID+"')",e.expertID,t)}}]}function s(){return[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.expertID)},filterable:!1,width:25,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"name",title:"姓名",width:60,filterable:!1,template:function(e){return"<a  ng-click=\"vm.findExportDetail('"+e.expertID+"')\">"+e.name+"</a>"}},{field:"degRee",title:"学位",width:50,filterable:!1},{field:"post",title:"职称",width:70,filterable:!1},{field:"applyDate",title:"录入时间",width:70,filterable:!1,format:"{0: yyyy-MM-dd}"},{field:"compositeScore",title:"专家星级",width:70,filterable:!1},{field:"comPany",title:"工作单位",width:120,filterable:!1}]}function l(t,e,i){t.isSubmit=!0;var o={method:"post",url:a+"/updateAudit",params:{ids:e,flag:i}};common.http({vm:t,$http:n,httpOptions:o,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.isSubmit=!1,t.gridOptions1.dataSource.read(),t.gridOptions2.dataSource.read(),t.gridOptions3.dataSource.read(),t.gridOptions4.dataSource.read(),t.gridOptions5.dataSource.read(),common.alert({vm:t,msg:"操作成功"})}})}})}}angular.module("app").factory("expertSvc",e),e.$inject=["$http","FileSaver","Blob","templatePrintSvc"]}(),function(){"expertType strict";function e(o,i,n,e){return{cleanValue:a,getExpertType:function(t){var e={method:"GET",url:rootPath+"/expertType/getExpertType?$filter=expert.expertID eq '"+t.model.expertID+"'"};common.http({vm:t,$http:o,httpOptions:e,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.expertTypeList=e.data}})}})},getExpertTypeById:function(t){var e={method:"get",url:rootPath+"/expertType/getExpertTypeById",params:{expertTypeId:t.expertTypeId}};common.http({vm:t,$http:o,httpOptions:e,success:function(e){t.expertType=e.data,t.expertType.majobSmallDicts=n.topSelectChange(t.expertType.maJorBig,n.DICT.MAJOR.dicts)}})},saveUpdate:function(t){if(common.initJqValidation($("#expertTypeForm")),$("#expertTypeForm").valid()){t.expertType.expertID=t.expertID;var e={method:"put",url:rootPath+"/expertType",data:t.expertType};common.http({vm:t,$http:o,httpOptions:e,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){window.parent.$("#addExpertType").data("kendoWindow").close(),i.getExpertById(t),a(),common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})}})}},deleteExpertType:function(e,t){var i={method:"delete",url:rootPath+"/expertType",params:{ids:e}};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},saveExpertType:function(e,t){var i={method:"post",url:rootPath+"/expertType",data:e};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}};function a(){var e=$("#addExpertType").find("input");$.each(e,function(e,t){t.value=""})}}angular.module("app").factory("expertTypeSvc",e),e.$inject=["$http","expertSvc","$rootScope","bsWin"]}(),function(){"projectExpe strict";function e(o){return{getProject:n,saveProject:function(e,t){var i={method:"post",url:rootPath+"/projectExpe/saveExpe",data:e};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},updateProject:function(t){if(common.initJqValidation($("#ProjectForm")),$("#ProjectForm").valid()){t.isSubmit=!0,t.project.peID=t.peID,t.project.expertID=t.expertID,t.project.projectbeginTime=$("#projectbeginTime").val(),t.project.projectendTime=$("#projectendTime").val();var e={method:"put",url:rootPath+"/projectExpe/updateProject",data:t.project},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){window.parent.$("#pjwindow").data("kendoWindow").close(),n(t),common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})}}common.http({vm:t,$http:o,httpOptions:e,success:i})},updateProjectPage:function(e){var t=$("input[name='checkpj']:checked");t.length<1?common.alert({vm:e,msg:"请选择操作对象",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}}):1<t.length?common.alert({vm:e,msg:"无法同时操作多条数据",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}}):(e.peID=t.val(),i(e),e.expertID=e.model.expertID,gotoJPage(e))},getProjectById:i,delertProject:function(e,t){var i={method:"delete",url:rootPath+"/projectExpe/deleteProject",params:{ids:e}};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},initProjectType:function(t){var e={method:"get",url:rootPath+"/dict/getAllDictByCode",params:{dictCode:"PROJECTTYPE"}};common.http({vm:t,$http:o,httpOptions:e,success:function(e){t.projectTypes=e.data}})}};function i(t){var e={method:"get",url:common.format(rootPath+"/projectExpe/getProject?$filter=peID eq '{0}'",t.peID)};common.http({vm:t,$http:o,httpOptions:e,success:function(e){t.project={},t.project.projectName=e.data[0].projectName,t.project.projectType=e.data[0].projectType,t.project.projectbeginTime=e.data[0].projectbeginTime,t.project.projectendTime=e.data[0].projectendTime,t.isUpdate}})}function n(t){var e={method:"GET",url:rootPath+"/projectExpe/getProject?$filter=expert.expertID eq '"+t.model.expertID+"'"};common.http({vm:t,$http:o,httpOptions:e,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.projectList=e.data}})}})}}angular.module("app").factory("projectExpeSvc",e),e.$inject=["$http"]}(),function(){"workExpe strict";function e(o,e){return{saveWork:function(e,t){var i={method:"post",url:rootPath+"/workExpe/saveWorkExpe",data:e};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},updateWork:function(t){if(common.initJqValidation(),$("form").valid()){t.work.weID=t.weID,t.work.expertID=t.expertID,t.work.beginTime=$("#beginTime").val(),t.work.endTime=$("#endTime").val();var e={method:"put",url:rootPath+"/workExpe/updateWork",data:t.work};common.http({vm:t,$http:o,httpOptions:e,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){window.parent.$("#wrwindow").data("kendoWindow").close(),i(t),cleanValue(),common.alert({vm:t,msg:"操作成功",fn:function(){t.showWorkHistory=!0,$(".alertDialog").modal("hide")}})}})}})}},deleteWork:function(e,t){var i={method:"delete",url:rootPath+"/workExpe/deleteWork",params:{ids:e}};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},updateWorkPage:function(e){var t=$("input[name='checkwr']:checked");t.length<1?common.alert({vm:e,msg:"请选择操作对象",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}}):1<t.length?common.alert({vm:e,msg:"无法同时操作多条数据",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}}):(e.weID=t.val(),n(e),gotoWPage(e),e.expertID=e.model.expertID)},getWorkById:n,getWork:i};function i(t){var e={method:"GET",url:rootPath+"/workExpe/getWork?$filter=expert.expertID eq '"+t.model.expertID+"'"};common.http({vm:t,$http:o,httpOptions:e,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.workList=e.data}})}})}function n(t){var e={method:"get",url:common.format(rootPath+"/workExpe/getWork?$filter=weID eq '{0}'",t.weID)};common.http({vm:t,$http:o,httpOptions:e,success:function(e){t.work={},t.work.companyName=e.data[0].companyName,t.work.workJob=e.data[0].workJob,t.work.beginTime=e.data[0].beginTime,t.work.endTime=e.data[0].endTime}})}}angular.module("app").factory("workExpeSvc",e),e.$inject=["$http","expertSvc"]}(),function(){"use strict";function e(o,i){return{saveOffer:function(e,t){var i={method:"post",url:rootPath+"/expertOffer",data:e};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},updateOffer:function(t){if(common.initJqValidation($("#expert_offer_form")),$("#expert_offer_form").valid()){t.expertOffer.expertId=t.model.expertID;var e={method:"put",url:rootPath+"/expertOffer",data:t.expertOffer};common.http({vm:t,$http:o,httpOptions:e,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){i.getExpertById(t),common.alert({vm:t,msg:"操作成功"})}})}})}}}}angular.module("app").factory("expertOfferSvc",e),e.$inject=["$http","expertSvc"]}(),function(){"use strict";function e(e,t){var n=this;n.title="专家列表",n.del=function(e){common.confirm({vm:n,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteExpertReview(n,e)}})},n.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:n,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");n.del(o)}},t.initExpertGrid(n),t.getReviewList(n)}angular.module("app").controller("expertReviewCtrl",e),e.$inject=["$location","expertReviewSvc"]}(),function(){"use strict";function e(e,t,i){var o=this;o.title="添加附件",o.isuserExist=!1,o.id=i.params.id,o.id&&(o.isUpdate=!0,o.title="更新附件"),o.create=function(){t.createExpertReview(o)},o.update=function(){t.updateExpertReview(o)},o.isUpdate&&t.getExpertReviewById(o)}angular.module("app").controller("expertReviewEditCtrl",e),e.$inject=["$location","expertReviewSvc","$state"]}(),function(){"use strict";function e(n,a,t,e,r,o,s){var l=this;l.title="选择专家",l.conMaxIndex=0,l.customCondition=new Array,l.expertReview={},l.confirmEPList=[],l.confirmEPListReplace=[],l.matchEPMap={},l.selectIds=[],l.businessId=e.params.businessId,l.minBusinessId=e.params.minBusinessId,l.businessType=e.params.businessType,l.taskId=e.params.taskId;e.params.expertID;function c(e){return!!(/^(\+|-)?\d+$/.test(e)&&0<e)}function i(){if(0<l.expertReview.expertSelConditionDtoList.length){var i=!0;return l.expertReview.expertSelConditionDtoList.forEach(function(e,t){l.expertReview.id&&(e.expertReviewDto={},e.expertReviewDto.id=l.expertReview.id),e.officialNum&&c(e.officialNum)||($("#errorsOfficialNum"+e.id).html("必填，且为数字"),i=!1),e.alternativeNum&&c(e.alternativeNum)||($("#errorsAlternativeNum"+e.id).html("必填，且为数字"),i=!1),i&&($("#errorsOfficialNum"+e.id).html(""),$("#errorsAlternativeNum"+e.id).html(""))}),i}return!1}l.isback=e.params.isback,l.processInstanceId=e.params.processInstanceId,l.isSuperUser=isSuperUser,l.saveNewExpertFlag=0,l.reviewType=e.params.reviewType,l.showLastDraf=!0,l.findExportDetail=function(e){t.getExpertById(e,function(e){l.model=e,$("#selectExportDetail").kendoWindow({width:"80%",height:"auto",title:"专家详细信息",visible:!1,modal:!0,open:function(){$("#expertPhotoSrc").attr("src",rootPath+"/expert/transportImg?expertId="+l.model.expertID+"&t="+Math.random())},closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()})},l.reFleshSelEPInfo=function(e){$.each(e,function(e,t){l.confirmEPList.push(t),0<l.confirmEPListReplace.length&&l.confirmEPListReplace.push(t),"专家函评"==l.reviewType&&"9"!=t.isLetterRw?t.isLetterRw=9:"专家评审会"==l.reviewType&&"0"!=t.isLetterRw&&(t.isLetterRw=0),l.selectIds.push(t.expertDto.expertID)}),l.excludeIds=l.selectIds.join(",")},l.reFleshAfterRemove=function(e){$.each(e,function(e,i){$.each(l.confirmEPList,function(e,t){t&&i==t.id&&l.confirmEPList.splice(e,1)}),0<l.confirmEPListReplace.length&&$.each(l.confirmEPListReplace,function(e,t){t&&i==t.id&&l.confirmEPListReplace.splice(e,1)})})},l.reFleshJoinState=function(e,o){$.each(e,function(e,i){$.each(l.confirmEPList,function(e,t){i==t.id&&(t.isJoin=o)}),0<l.confirmEPListReplace.length&&$.each(l.confirmEPListReplace,function(e,t){t&&i==t.id&&(t.isJoin=o)})})},l.reFleshConfirmState=function(e,o){$.each(e,function(e,i){$.each(l.confirmEPList,function(e,t){i==t.id&&(t.isConfrim=o)}),0<l.confirmEPListReplace.length&&$.each(l.confirmEPListReplace,function(e,t){t&&i==t.id&&(t.isConfrim=o)})})},l.updateSelectedIndex=function(i){i?$.each(l.expertReview.expertSelConditionDtoList,function(e,t){t.id==i&&(t.selectIndex=t.selectIndex?t.selectIndex+1:1)}):$.each(l.expertReview.expertSelConditionDtoList,function(e,t){t.selectIndex=t.selectIndex?t.selectIndex+1:1})},l.init=function(e,t){l.expertReview={},l.confirmEPList=[],l.selectIds=[],n.initReview(e,t,function(e){if(l.expertReview=e,!angular.isUndefined(l.expertReview.expertSelectedDtoList)&&angular.isArray(l.expertReview.expertSelectedDtoList)){var i=!(l.autoSelectedEPList=[]);l.expertReview.extractInfo&&l.showLastDraf&&(i=!0),$.each(l.expertReview.expertSelectedDtoList,function(e,t){l.selectIds.push(t.expertDto.expertID),l.confirmEPList.push(t),i&&"1"==t.selectType&&("ALL"==l.expertReview.extractInfo?(t.show=!0,t.official="正选"==t.remark,l.autoSelectedEPList.push(t)):l.expertReview.extractInfo==t.conditionId&&l.expertReview.selectIndex==t.selectIndex&&(t.show=!0,t.official="正选"==t.remark,l.autoSelectedEPList.push(t)))}),0<l.selectIds.length?l.excludeIds=l.selectIds.join(","):l.excludeIds=""}})},n.initExpertGrid(l),l.init(l.businessId,l.minBusinessId),l.showSelfExpertGrid=function(){l.selfExpertOptions.dataSource._skip=0,l.selfExpertOptions.dataSource.read(),$("#selfExpertDiv").kendoWindow({width:"80%",height:"680px",title:"自选评审专家",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},l.saveSelfExpert=function(e){var t=common.getKendoCheckId("#selfExpertGrid");if(0==t.length)r.alert("请先选择专家！");else if(!e&&1<t.length)r.alert("自选专家只能选择一个！");else{var i=[];$.each(t,function(e,t){i.push(t.value)}),n.saveSelfExpert(l.businessId,l.minBusinessId,l.businessType,i.join(","),l.expertReview.id,l.isCommit,function(e){if(e.flag||"ok"==e.reCode){if("SIGN"==l.businessType&&s.updateWPExpertCost(l.minBusinessId),0==e.reObj.moreExpert){var i=[];$.each(l.confirmEPList,function(e,t){"2"==t.selectType&&i.push(t.id)}),l.reFleshAfterRemove(i)}l.expertReview.id||(l.expertReview.id=e.idCode),l.reFleshSelEPInfo(e.reObj.selectedDtoList),r.success("操作成功！",function(){window.parent.$("#selfExpertDiv").data("kendoWindow").close()})}else r.error(e.reMsg)})}},l.delertSelfExpert=function(){var i=$("input[name='seletedEp']:checked");i.length<1?r.alert("请选择要删除的专家"):r.confirm({title:"询问提示",message:"删除数据不可恢复，确定删除么？",onOk:function(){$(".confirmDialog").modal("hide");for(var t=[],e=0;e<i.length;e++)t.push(i[e].value);n.delSelectedExpert(l.expertReview.id,t.join(","),l.isCommit,function(e){e.flag||"ok"==e.reCode?("SIGN"==l.businessType&&s.updateWPExpertCost(l.minBusinessId),l.reFleshAfterRemove(t),r.success("操作成功！")):r.error(e.reMsg)})}})},l.querySelfExpert=function(){l.selfExpertOptions.dataSource._skip=0,l.selfExpertOptions.dataSource.read()},l.showOutExpertGrid=function(){l.outExpertOptions.dataSource._skip=0,l.outExpertOptions.dataSource.read(),$("#outExpertDiv").kendoWindow({width:"70%",height:"680px",title:"自选新专家、市外、境外专家",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},l.delertOutSelfExpert=function(){var i=$("input[name='seletedOutEp']:checked");i.length<1?r.alert("请选择要删除的专家"):r.confirm({title:"询问提示",message:"删除数据不可恢复，确定删除么？",onOk:function(){for(var t=[],e=0;e<i.length;e++)t.push(i[e].value);n.delSelectedExpert(l.expertReview.id,t.join(","),l.isCommit,function(e){e.flag||"ok"==e.reCode?("SIGN"==l.businessType&&s.updateWPExpertCost(l.minBusinessId),l.reFleshAfterRemove(t),r.success("操作成功！")):r.error(e.reMsg)})}})},l.saveOutExpert=function(){var e=common.getKendoCheckId("#outExpertGrid");if(0==e.length)r.alert("请先选择专家！");else{var i=[];$.each(e,function(e,t){i.push(t.value)}),n.saveOutExpert(l.businessId,l.minBusinessId,l.businessType,i.join(","),l.expertReview.id,l.isCommit,function(e){e.flag||"ok"==e.reCode?("SIGN"==l.businessType&&s.updateWPExpertCost(l.minBusinessId),l.expertReview.id||(l.expertReview.id=e.idCode),l.reFleshSelEPInfo(e.reObj.selectedDtoList),r.success("操作成功！",function(){window.parent.$("#outExpertDiv").data("kendoWindow").close()})):r.error(e.reMsg)})}},l.queryOutExpert=function(){l.outExpertOptions.dataSource._skip=0,l.outExpertOptions.dataSource.read()},l.countMatchExperts=function(i){if(l.expertReview.id){var o={};l.expertReview.expertSelConditionDtoList.forEach(function(e,t){e.id==i&&(o=e)}),n.countMatchExperts(o,l.minBusinessId,l.expertReview.id,function(e){l.matchEPMap[i]=e,$("#expertCount"+i).html(e.length)})}else r.alert("请保存整体抽取方案再计算")},l.showMatchExperts=function(e){l.matchExpertList=[],l.matchExpertList=l.matchEPMap[e],$("#matchExpertDiv").kendoWindow({width:"80%",height:"600px",title:"统计专家信息列表",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},l.checkIntegerValue=function(e,t,i){return a.isUnsignedInteger(e)?($("#errorsOfficialNum"+i).html(""),$("#errorsAlternativeNum"+i).html(""),e):($("#errorsOfficialNum"+i).html("只能填写数字"),void $("#errorsAlternativeNum"+i).html("只能填写数字"))},l.addCondition=function(){l.isSuperUser||9!=l.expertReview.state&&"9"!=l.expertReview.state?(l.expertReview.expertSelConditionDtoList||(l.expertReview.expertSelConditionDtoList=[]),l.condition={},l.condition.id=common.uuid(),l.condition.businessId=l.minBusinessId,l.condition.selectType="1",l.expertReview.expertSelConditionDtoList.push(l.condition)):r.alert("当前项目已经进行整体专家方案的抽取，不能再修改方案！")},l.removeCondition=function(){if(l.isSuperUser||9!=l.expertReview.state&&"9"!=l.expertReview.state){var n=$("#conditionTable input[name='epConditionSort']:checked");0<n.length?r.confirm({title:"询问提示",message:"删除数据的同时会删除该条件所抽取的专家，删除数据不可恢复，确定删除么？",onOk:function(){for(var i=[],o=0;o<n.length;o++)$.each(l.expertReview.expertSelConditionDtoList,function(e,t){n[o].value==t.id&&i.push(t.id)});0<i.length?a.deleteSelConditions(l.expertReview.id,i.join(","),l.isCommit,function(e){e.flag||"ok"==e.reCode?("SIGN"==l.businessType&&s.updateWPExpertCost(l.minBusinessId),r.success("操作成功！",function(){l.init(l.businessId,l.minBusinessId)})):r.error(e.reMsg)}):r.success("操作成功！")}}):r.alert("请选择要删除的抽取条件！")}else r.alert("当前项目已经进行整体专家方案的抽取，不能再修改方案！")},l.saveCondition=function(){l.isSuperUser||9!=l.expertReview.state&&"9"!=l.expertReview.state?i()?a.saveCondition(l.businessId,l.minBusinessId,l.businessType,l.expertReview.id,l.expertReview.expertSelConditionDtoList,function(e){e.flag||"ok"==e.reCode?(l.expertReview.expertSelConditionDtoList=e.reObj,l.expertReview.id||(l.expertReview.id=l.expertReview.expertSelConditionDtoList[0].expertReviewId),r.success("保存成功！")):r.error(e.reMsg)}):r.alert("专家抽取条件设置不完整！"):r.alert("当前项目已经进行整体专家方案的抽取，不能再修改方案！")},l.startAutoExpertWin=function(){l.expertReview.id?isSuperUser||9!=l.expertReview.state&&"9"!=l.expertReview.state?i()?a.saveCondition(l.businessId,l.minBusinessId,l.businessType,l.expertReview.id,l.expertReview.expertSelConditionDtoList,function(e){e.flag||"ok"==e.reCode?(l.expertReview.expertSelConditionDtoList=e.reObj,l.expertReview.id||(l.expertReview.id=l.expertReview.expertSelConditionDtoList[0].expertReviewId),n.queryAutoExpert(!0,l.expertReview.expertSelConditionDtoList,l.minBusinessId,l.expertReview.id,function(e){e.flag||"ok"==e.reCode?("SIGN"==l.businessType&&s.updateWPExpertCost(l.minBusinessId),l.showLastDraf=!1,l.reFleshSelEPInfo(e.reObj.autoEPList),l.autoSelectedEPList=[],l.autoSelectedEPList=e.reObj.autoEPList,l.expertReview.finishExtract=1,l.showAutoExpertWin(),n.validateAutoExpert(e.reObj.allEPList,l)):r.error(e.reMsg)})):r.error(e.reMsg)}):r.alert("专家抽取条件设置不完整！"):r.alert("当前项目已经进行整体专家方案的抽取，不能再修改方案！"):r.alert("请先进行整体专家抽取条件设置并保存！")},l.showAutoExpertWin=function(){$("#aotuExpertDiv").kendoWindow({width:"90%",height:"700px",title:"专家抽取",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},l.showAutoMatchResultWin=function(){$("#aotuMatchResultDiv").kendoWindow({width:"90%",height:"700px",title:"专家抽取结果",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},l.repeatAutoExpert=function(i){var o=[];$.each(l.expertReview.expertSelConditionDtoList,function(e,t){t.id==i&&o.push(t)}),n.checkCondition(i,function(e){e&&e.id?n.queryAutoExpert(!1,o,l.minBusinessId,l.expertReview.id,function(e){e.flag||"ok"==e.reCode?(l.showLastDraf=!1,"SIGN"==l.businessType&&s.updateWPExpertCost(l.minBusinessId),l.reFleshSelEPInfo(e.reObj.autoEPList),l.expertReview.finishExtract=1,l.autoSelectedEPList=[],l.autoSelectedEPList=e.reObj.autoEPList,l.updateSelectedIndex(i),l.showAutoExpertWin(),n.validateAutoExpert(e.reObj.allEPList,l)):r.error(e.reMsg)}):r.alert("请先保存，再进行抽取！")})},l.affirmAutoExpert=function(){var e=$("#allAutoEPTable input[name='autoEPCheck']:checked");if(e.length<1)r.confirm({title:"询问提示",message:"您还没选择专家，确定没有合适的专家么？",onOk:function(){o.$apply(function(){$.each(l.expertReview.expertSelConditionDtoList,function(e,t){!t.selectIndex||t.selectIndex<1?t.selectIndex=1:t.selectIndex=t.selectIndex+1,t.showDraftBt=!0})}),window.parent.$("#aotuExpertDiv").data("kendoWindow").close()}});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);n.affirmAutoExpert(l.expertReview.id,l.minBusinessId,l.businessType,t.join(","),"9",function(e){e.flag||"ok"==e.reCode?("SIGN"==l.businessType&&s.updateWPExpertCost(l.minBusinessId),l.reFleshConfirmState(t,"9"),l.checkAutoOfficeExpert=!1,l.checkAutoAntiExpert=!1,r.success(e.reMsg)):r.error(e.reMsg)})}},l.affirmJoinExpert=function(){l.expertReview&&l.expertReview.expertSelectedDtoList&&(l.confirmEPList=l.expertReview.expertSelectedDtoList,$("#confirmJoinExpert").kendoWindow({width:"960px",height:"600px",title:"参加评审会专家确认",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open())},l.expertBack=function(){"1"!=l.saveNewExpertFlag?l.isback?e.go("MaintainProjectEdit",{signid:l.businessId,processInstanceId:l.processInstanceId}):e.go("flowWPEdit",{signid:l.businessId,taskid:l.taskId}):r.alert("拟聘请专家数据有改动，请保存后再返回！")},l.updateToJoin=function(){var e=$("#notJoinExpertTable input[name='notJoinExpert']:checked");if(e.length<1)r.alert("请选择要改为参加会议的专家");else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);n.updateJoinState(l.expertReview.id,l.minBusinessId,l.businessType,t.join(","),"9",l.isCommit,function(e){e.flag||"ok"==e.reCode?("SIGN"==l.businessType&&s.updateWPExpertCost(l.minBusinessId),l.reFleshJoinState(t,"9"),r.success("操作成功！")):r.success(e.reMsg)})}},l.updateToNotJoin=function(){var e=$("#joinExpertTable input[name='joinExpert']:checked");if(e.length<1)r.alert("请选择未参加会议的专家");else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);n.updateJoinState(l.expertReview.id,l.minBusinessId,l.businessType,t.join(","),"0",l.isCommit,function(e){e.flag||"ok"==e.reCode?("SIGN"==l.businessType&&s.updateWPExpertCost(l.minBusinessId),l.reFleshJoinState(t,"0"),r.success("操作成功！")):r.success(e.reMsg)})}},l.checkScore=function(e){e.compositeScoreEnd&&e.compositeScore&&e.compositeScore>e.compositeScoreEnd?($("#compositeScoreEnd_"+e.id).html("分值设置错误"),e.compositeScoreEnd=""):$("#compositeScoreEnd_"+e.id).html("")},l.deleteAutoSelectEP=function(){var i=$("#autoDraftExpertTable input[name='checkSelectExpert']:checked");0<i.length?r.confirm({title:"询问提示",message:"删除数据不可恢复，确定删除么？",onOk:function(){for(var e=[],t=0;t<i.length;t++)e.push(i[t].value);n.delSelectedExpert(l.expertReview.id,e.join(","),l.isCommit,function(e){e.flag||"ok"==e.reCode?("SIGN"==l.businessType&&s.updateWPExpertCost(l.minBusinessId),r.alert("删除成功！",function(){l.removeSelectEP=!1,l.init(l.businessId,l.minBusinessId)})):r.alert(e.reMsg)})}}):r.alert("请选择要删除的抽取专家！")},l.adminSelectEP=function(){var i=$("#autoDraftExpertTable input[name='checkSelectExpert']:checked");0<i.length?r.confirm({title:"询问提示",message:"确认对专家进行修改么？",onOk:function(){for(var t=[],e=0;e<i.length;e++)t.push(i[e].value);n.affirmAutoExpert(l.expertReview.id,l.minBusinessId,l.businessType,t.join(","),"9",function(e){e.flag||"ok"==e.reCode?("SIGN"==l.businessType&&s.updateWPExpertCost(l.minBusinessId),l.reFleshConfirmState(t,"9"),r.success(e.reMsg)):r.error(e.reMsg)})}}):r.alert("您还没选择任何专家！")};var d=function(e,t,i){return e[t]=e.splice(i,1,e[t])[0],e};l.upRecord=function(e,t){l.saveNewExpertFlag="1",l.confirmEPListReplace=0!=t?d(e,t,t-1):e},l.downRecord=function(e,t){l.saveNewExpertFlag="1",t!=e.length-1?l.confirmEPListReplace=d(e,t,t+1):l.confirmEPListReplace=e},l.saveExpert=function(){var i=!0;l.saveNewExpertFlag="0",0<l.confirmEPListReplace.length?angular.forEach(l.confirmEPListReplace,function(e){""!=e.expeRttype&&null!=e.expeRttype||(i=!1,l.saveNewExpertFlag="1")}):$.each(l.confirmEPList,function(e,t){"9"==t.isConfrim&&"9"==t.isJoin&&(""!=t.expeRttype&&null!=t.expeRttype||(i=!1,l.saveNewExpertFlag="1"),l.confirmEPListReplace.push(t))}),i?n.saveNewExpert(l.confirmEPListReplace,function(e){r.success("操作成功！")}):r.alert("拟聘专家的专家类型不能为空")}}angular.module("app").controller("expertSelectCtrl",e),e.$inject=["expertReviewSvc","expertConditionSvc","expertSvc","$state","bsWin","$scope","workprogramSvc"]}(),function(){"use strict";function e(l,s,i){return{initExpertGrid:function(e){var t=function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})},i=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findByOData",$("#selfSelExpertForm")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}});e.selfExpertOptions={dataSource:common.gridDataSource(i),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:n(),dataBound:t,resizable:!0};var o=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findExpertFieldByOData",$("#outSelExpertForm")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}});e.outExpertOptions={dataSource:common.gridDataSource(o),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:n(),dataBound:t,resizable:!0}},saveSelfExpert:function(e,t,i,o,n,a,r){!0;var s={method:"post",url:rootPath+"/expertReview/saveExpertReview",params:{businessId:e,minBusinessId:t,businessType:i,reviewId:angular.isUndefined(n)?"":n,expertIds:o,selectType:"2"}};common.http({$http:l,httpOptions:s,success:function(e){!1,null!=r&&"function"==typeof r&&r(e.data)},onError:function(e){!1}})},saveOutExpert:function(e,t,i,o,n,a,r){!0;var s={method:"post",url:rootPath+"/expertReview/saveExpertReview",params:{businessId:e,minBusinessId:t,businessType:i,reviewId:angular.isUndefined(n)?"":n,expertIds:o,selectType:"3"}};common.http({$http:l,httpOptions:s,success:function(e){!1,null!=r&&"function"==typeof r&&r(e.data)},onError:function(e){!1}})},countMatchExperts:function(e,t,i,o){var n={method:"post",url:rootPath+"/expert/countReviewExpert",data:e,params:{minBusinessId:t,reviewId:i}};common.http({$http:l,httpOptions:n,success:function(e){null!=o&&"function"==typeof o&&o(e.data)}})},getReviewList:function(t){var e={method:"get",url:rootPath+"/expertReview/html/getReviewList"};common.http({vm:t,$http:l,httpOptions:e,success:function(e){t.reviewList=e.data},onError:function(e){t.isCommit=!1}})},initReview:function(e,t,i){var o={method:"post",url:rootPath+"/expertReview/initBybusinessId",params:{businessId:e,minBusinessId:t}};common.http({$http:l,httpOptions:o,success:function(e){null!=i&&"function"==typeof i&&i(e.data)}})},delSelectedExpert:function(e,t,i,o){!0;var n={method:"delete",url:rootPath+"/expertSelected",params:{reviewId:e,id:t,deleteAll:!1}};common.http({$http:l,httpOptions:n,success:function(e){!1,null!=o&&"function"==typeof o&&o(e.data)},onError:function(e){!1}})},deleteExpertNewInfo:function(e){var t={method:"get",url:rootPath+"/expertReview/deleteExpertNewInfo",params:{minBusinessId:e}};common.http({$http:l,httpOptions:t,success:function(e){},onError:function(e){}})},queryAutoExpert:function(e,t,i,o,n){var a={method:"post",url:rootPath+"/expert/autoExpertReview",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(t),params:{isAllExtract:e,minBusinessId:i,reviewId:o}};common.http({$http:l,httpOptions:a,success:function(e){null!=n&&"function"==typeof n&&n(e.data)}})},validateAutoExpert:function(t,i){var o=0,n=i.autoSelectedEPList.length,a=0,r=s(function(){if(0==n)s.cancel(r),i.showLastDraf=!0,i.init(i.businessId,i.minBusinessId);else{var e=Math.floor(Math.random()*t.length);i.showAutoExpertName=t[e].name,++o%10==0&&(i.autoSelectedEPList[a].show=!0,i.autoSelectedEPList[a].official=!0,i.autoSelectedEPList[a+1].show=!0,i.autoSelectedEPList[a+1].official=!1,a+=2,n-=2)}},200)},affirmAutoExpert:function(e,t,i,o,n,a){var r={method:"post",url:rootPath+"/expertReview/affirmAutoExpert",params:{reviewId:e,minBusinessId:t,businessType:i,expertSelId:o,state:n}};common.http({$http:l,httpOptions:r,success:function(e){null!=a&&"function"==typeof a&&a(e.data)},onError:function(e){}})},updateJoinState:function(e,t,i,o,n,a,r){!0;var s={method:"post",url:rootPath+"/expertReview/updateJoinState",params:{reviewId:e,minBusinessId:t,businessType:i,expertSelId:o,state:n}};common.http({$http:l,httpOptions:s,success:function(e){null!=r&&"function"==typeof r&&r(e.data)},onError:function(e){!1}})},findByBusinessId:function(e,t){var i={method:"post",url:rootPath+"/expertReview/initBybusinessId",params:{businessId:e}};common.http({$http:l,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)},onError:function(e){}})},saveMark:function(e,t){var i={method:"put",url:rootPath+"/expertSelected",data:e};common.http({$http:l,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},savePayment:function(e,t,i,o){!0;var n={method:"post",url:rootPath+"/expertReview/saveExpertReviewCostSingle",data:e,params:{isCountTaxes:i}};common.http({$http:l,httpOptions:n,success:function(e){!1,null!=o&&"function"==typeof o&&o(e.data)},onError:function(){!1}})},countTaxes:function(e,t,i,o){var n=rootPath+"/expertReview/getExpertReviewCost?reviewId={0}&expertIds={1}&month={2}",a={method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded"},url:common.format(n,e,t,i)};common.http({$http:l,httpOptions:a,success:function(e){null!=o&&"function"==typeof o&&o(e.data)}})},refleshBusinessEP:function(e,t){var i={method:"post",url:rootPath+"/expertReview/refleshBusinessEP",params:{businessId:e}};common.http({$http:l,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)},onError:function(){}})},saveNewExpert:function(e,t){var i={method:"post",url:rootPath+"/expertReview/expertNewInfo",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(e)};common.http({$http:l,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},initNewExpertInfo:function(e,t){var i={method:"post",url:rootPath+"/expertReview/getExpertInfo",params:{businessId:e}};common.http({$http:l,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)},onError:function(){}})},saveSplit:function(e){var t={method:"put",url:rootPath+"/expertReview/saveSplit",data:e.expertSelect};common.http({$http:l,httpOptions:t,success:function(e){i.success("操作成功！",function(){window.parent.$("#splitPayment").data("kendoWindow").close()})}})},checkCondition:function(e,t){var i={method:"get",url:rootPath+"/expertSelCondition/html/findById",params:{id:e}};common.http({$http:l,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}};function n(){return[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.expertID)},filterable:!1,width:25,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"name",title:"姓名",width:100,filterable:!1,template:function(e){return"<a  ng-click=\"vm.findExportDetail('"+e.expertID+"')\">"+e.name+"</a>"}},{field:"degRee",title:"学位",width:100,filterable:!1},{field:"sex",title:"性别",width:50,filterable:!0},{field:"comPany",title:"工作单位",width:100,filterable:!1},{field:"degRee",title:"职务",width:100,filterable:!1},{field:"",title:"专业大类",width:100,template:function(e){return e.expertTypeDtoList?1<e.expertTypeDtoList.length?"":1==e.expertTypeDtoList.length?e.expertTypeDtoList[0].maJorBig:void 0:""}},{field:"",title:"专业小类",width:100,template:function(e){return e.expertTypeDtoList?1<e.expertTypeDtoList.length?"":1==e.expertTypeDtoList.length?e.expertTypeDtoList[0].maJorSmall:void 0:""}},{field:"",title:"专家类型",width:100,template:function(e){return e.expertTypeDtoList?1<e.expertTypeDtoList.length?"":1==e.expertTypeDtoList.length?e.expertTypeDtoList[0].expertType:void 0:""}}]}}angular.module("app").factory("expertReviewSvc",e),e.$inject=["$http","$interval","bsWin"]}(),function(){"use strict";function e(n,e,t,i){return{saveRootFolder:function(e,t){var i={method:"post",url:rootPath+"/fileLibrary/addFileFolder",data:e};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},saveChildFolder:function(e,t){if(null!=e.fileName){var i={method:"post",url:rootPath+"/fileLibrary/addFileFolder",data:e};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}else common.alert({vm:vm,msg:"文件名不能为空",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}})},initFileFolder:function(e,t,i){var o={method:"get",url:rootPath+"/fileLibrary/initFileFolder",params:{fileType:e.fileLibrary.fileType}};common.http({$http:n,httpOptions:o,success:function(e){null!=i&&"function"==typeof i&&i(e.data)}})},initFileList:function(e,t,i){var o={method:"post",url:rootPath+"/fileLibrary/initFileList",params:{fileId:e,fileType:t}};common.http({$http:n,httpOptions:o,success:function(e){null!=i&&"function"==typeof i&&i(e.data)}})},saveFile:function(e,t){if(common.initJqValidation(),$("form").valid()){var i={method:"post",url:rootPath+"/fileLibrary/saveFile",data:e.fileLibrary};common.http({vm:e,$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}},findFileById:function(e,t){var i={method:"get",url:rootPath+"/fileLibrary/findFileById",params:{fileId:e}};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},updateFile:function(e,t){var i={method:"put",url:rootPath+"/fileLibrary/updateFile",data:e.fileLibrary};common.http({vm:e,$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},deleteFile:function(e,t){var i={method:"delete",url:rootPath+"/fileLibrary/deleteFile",params:{fileId:e}};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t()}})},deleteRootDirectory:function(e,t){var i={method:"delete",url:rootPath+"/fileLibrary/deleteRootDirectory",params:{parentFileId:e}};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},folderById:function(t,e){var i={method:"get",url:rootPath+"/fileLibrary/findFileById",params:{fileId:e}};common.http({vm:t,$http:n,httpOptions:i,success:function(e){t.fileLibrary=e.data,t.addFolderWindow()}})},queryUser:function(e){e.gridOptions.dataSource._skip=0,e.gridOptions.dataSource.read()},getFileUrlById:function(t,e){var i={method:"get",url:rootPath+"/fileLibrary/getFileUrlById",params:{fileId:e}};common.http({vm:t,$http:n,httpOptions:i,success:function(e){t.fileUrl=e.data.fileUrl,t.title=e.data.fileUrl,t.initFileUpload()}})}}}angular.module("app").factory("fileLibrarySvc",e),e.$inject=["$http","$state","$location","sysfileSvc"]}(),function(){"use strict";function e(o,i,e,n,a,r,t){var s=this;function l(){n.initFileFolder(s,o,function(e){var n={check:{enable:!0,chkStyle:"radio",chkboxType:{Y:"",N:""}},edit:{enable:!0,showRenameBtn:!1,showRemoveBtn:!1,showAddBtn:!0,removeTitle:"删除节点"},view:{addHoverDom:function(e,t){if("FOLDER"==t.fileNature){var i=$("#"+t.tId+"_span");if(t.editNameFlag||0<$("#addBtn_"+t.tId).length)return;var o="<span class='button add' id='addBtn_"+t.tId+"' title='添加子节点' onfocus='this.blur();'></span>";i.after(o);var n=$("#addBtn_"+t.tId);n&&n.bind("click",function(){$.fn.zTree.getZTreeObj("zTree");s.addFolderWindow(t.id)})}},removeHoverDom:function(e,t){$("#addBtn_"+t.tId).unbind().remove()},dblClickExpand:!0},callback:{onClick:function(e,t,i){s.parentFileId=i.fileId,"FOLDER"==i.fileNature&&(s.policyList=[],i.children&&(s.policyList=i.children),o.$apply());"FILE"==i.fileNature&&s.fileEdit(s.parentFileId)},beforeRemove:function(e,t,i){var i=$.fn.zTree.getZTreeObj("zTree").getSelectedNodes();s.onRemove(i.id)}},data:{simpleData:{enable:!0,idKey:"id",pIdKey:"pId"},showTitle:!0,key:{title:"fileName"}}};s.zNodes=$linq(e).select(function(e){var t=e;return(t=e).id=e.fileId,t.name=e.fileName,t.pId=e.parentFileId,"FOLDER"==e.fileNature&&(t.icon=rootPath+"/contents/libs/zTree/css/zTreeStyle/img/diy/7.png"),t}).toArray(),s.initFileTreeSucess=!0,o.$watch("vm.initFileTreeSucess",function(e,t){if(1==e)var o=r(function(){for(var e=document.getElementById("zTree"),t=0;t<s.zNodes.length;t++)if(7<s.zNodes[t].name.length){var i=s.zNodes[t].name.substring(0,7);s.zNodes[t].name=i+"..."}null!=e&&($.fn.zTree.init($("#zTree"),n,s.zNodes),r.cancel(o))},500)})}),s.initFileUpload()}s.parentId=i.params.parentId,s.fileId=i.params.fileId,s.fileLibrary={},s.fileLibrary.fileType="POLICY",s.fileType="POLICY",s.initFileUpload=function(){s.fileId||o.$watch("vm.fileId",function(e,t){e&&e!=t&&!s.initUploadOptionSuccess&&s.initFileUpload()}),s.sysFile={businessId:s.fileId,mainId:s.fileId,mainType:t.mainTypeValue().POLICYLIBRARY,sysBusiType:null==s.fileUrl?"":s.fileUrl.substring(s.fileUrl.lastIndexOf(t.mainTypeValue().POLICYLIBRARY),s.fileUrl.lastIndexOf(s.fileName)),showBusiType:!1},t.initUploadOptions({inputId:"sysfileinput",vm:s,uploadSuccess:function(){t.findByBusinessId(s.fileId,function(e){s.sysFilelists=e,n.initFileList(s.parentFileId,s.fileType,function(e){s.policyList=e.reObj})})}})},l(),s.addFolderWindow=function(e){s.fileLibrary={},s.fileLibrary.fileType="POLICY",null!=e&&(s.fileLibrary.parentFileId=e),$("#addRootFolder").kendoWindow({width:"500px",height:"300px",title:"新建文件夹",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()},s.saveRootFolder=function(){null!=s.fileLibrary.fileName?n.saveRootFolder(s.fileLibrary,function(e){e.flag||"ok"==e.reCode?a.alert("保存成功！",function(){window.parent.$("#addRootFolder").data("kendoWindow").close(),i.go("policyLibrary",{},{reload:!0})}):a.error(e.reMsg)}):a.alert("文件名不能为空!")},s.deleteFolder=function(){var e=$.fn.zTree.getZTreeObj("zTree").getCheckedNodes();if(null!=e&&0<e.length){var t=e[0].id;a.confirm("删除的文件将无法恢复，确认删除？",function(){n.deleteRootDirectory(t,function(e){e.flag||"ok"==e.reCode?(a.success("操作成功！"),i.go("policyLibrary",{},{reload:!0})):a.error(e.reMsg)})})}},s.fileEdit=function(e){s.isUpdate=!1,s.fileId=e,s.fileLibrary={},s.sysFilelists={},s.fileLibrary.fileType="POLICY",s.fileId&&(s.isUpdate=!0,n.findFileById(s.fileId,function(e){s.fileLibrary=e,s.fileUrl=s.fileLibrary.fileUrl,s.fileName=s.fileLibrary.fileName,s.initFileUpload()}),t.findByBusinessId(s.fileId,function(e){s.sysFilelists=e})),$("#qualityEdit").kendoWindow({width:"800px",height:"500px",title:"文件编辑",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()},s.createFile=function(){s.fileLibrary.parentFileId=s.parentFileId,common.initJqValidation(),s.fileLibrary.fileName&&n.saveFile(s,function(e){e.flag||"ok"==e.reCode?a.alert("保存成功！",function(){s.isUpdate=!0,l(),s.policyList.push(e.reObj),s.fileId=e.reObj.fileId,n.getFileUrlById(s,s.fileId),s.initFileUpload()}):a.error(e.reMsg)})},s.updateFile=function(){n.updateFile(s,function(e){e.flag||"ok"==e.reCode?a.alert("更新成功！",function(){s.initFileUpload(),window.parent.$("#qualityEdit").data("kendoWindow").close(),l()}):a.error(e.reMsg)})},s.del=function(i){a.confirm("删除的数据将无法恢复，确认删除？",function(){var e=$.fn.zTree.getZTreeObj("zTree"),t=e.getNodeByParam("id",i,null);e.removeNode(t),n.deleteFile(i,function(){s.policyList.forEach(function(e,t){e.fileId==i&&s.policyList.splice(t,1)})})})},s.commonDownloadSysFile=function(e){t.downloadFile(e)},s.delFile=function(i){t.delSysFile(i,function(){$.each(s.sysFilelists,function(e,t){t.sysFileId==i&&s.sysFilelists.splice(e,1)}),n.initFileList(s.parentFileId,s.fileType,function(e){s.policyList=e.reObj})})}}angular.module("app").controller("policyCtrl",e),e.$inject=["$scope","$state","$location","fileLibrarySvc","bsWin","$interval","sysfileSvc"]}(),function(){"use strict";function e(e,t,i,o,n){var a=this;a.parentId=e.params.parentId,a.fileLibrary={},a.fileLibrary.parentFileId=a.parentId,a.fileLibrary.fileType="POLICY",a.fileId=e.params.fileId,a.fileUrl="",a.fileName="",a.businessFlag={isInitFileOption:!1},a.initFileUpload=function(){a.fileId||o.$watch("vm.fileId",function(e,t){e&&e!=t&&!a.initUploadOptionSuccess&&a.initFileUpload()}),a.sysFile={businessId:a.fileId,mainId:"",mainType:i.mainTypeValue().POLICYLIBRARY,sysBusiType:a.fileUrl.substring(a.fileUrl.lastIndexOf(i.mainTypeValue().POLICYLIBRARY),a.fileUrl.lastIndexOf(a.fileName))},i.initUploadOptions({inputId:"sysfileinput",vm:a,uploadSuccess:function(){i.findByBusinessId(a.fileId,function(e){a.sysFilelists=e})}})},function(){a.fileId&&(a.isUpdate=!0,t.findFileById(a,a.fileId),i.findByBusinessId(a.fileId,function(e){a.sysFilelists=e}));a.parentId&&(t.getFileUrlById(a,a.parentId),t.initFileList(a))}(),a.createFile=function(){t.saveFile(a,function(e){e.flag||"ok"==e.reCode?n.alert("保存成功！",function(){a.fileId=e.reObj.fileId,a.initFileUpload()}):n.error(e.reMsg)})},a.updateFile=function(){t.updateFile(a,function(e){e.flag||"ok"==e.reCode?(n.alert("更新成功！"),a.initFileUpload()):n.error(e.reMsg)})}}angular.module("app").controller("policyEditCtrl",e),e.$inject=["$state","fileLibrarySvc","sysfileSvc","$scope","bsWin"]}(),function(){"use strict";function e(t,i,o){var n=this;n.parentId=t.params.parentId,n.fileLibrary={},n.fileLibrary.parentFileId=n.parentId,n.fileLibrary.fileType="POLICY",n.formId="policyForm",i.initFileList(n),n.addFile=function(){t.go("policyLibrary.policyEdit",{parentId:n.parentId,fileId:""})},n.update=function(e){t.go("policyLibrary.policyEdit",{parentId:n.parentId,fileId:e})},n.del=function(e){o.confirm("删除的数据将无法恢复，确认删除？",function(){i.deleteFile(n,e)})},n.queryPolicy=function(){i.queryUser(n)},n.resetPolicy=function(){var e=$("#policyForm").find("input");$.each(e,function(e,t){t.value=""})}}angular.module("app").controller("policyListCtrl",e),e.$inject=["$state","fileLibrarySvc","bsWin"]}(),function(){"use strict";function e(o,i,e,n,r,s,t){var l=this;function a(){n.initFileFolder(l,r,function(e){var n,a={check:{enable:!0,chkStyle:"radio",chkboxType:{Y:"",N:""}},edit:{enable:!0,showRenameBtn:!1,showRemoveBtn:!1,showAddBtn:!0,removeTitle:"删除节点"},view:{addHoverDom:function(e,t){if("FOLDER"==t.fileNature){var i=$("#"+t.tId+"_span");if(t.editNameFlag||0<$("#addBtn_"+t.tId).length)return;var o="<span class='button add' id='addBtn_"+t.tId+"' title='添加子节点' onfocus='this.blur();'></span>";i.after(o);var n=$("#addBtn_"+t.tId);n&&n.bind("click",function(){$.fn.zTree.getZTreeObj("zTree");l.addFolderWindow(t.id)})}},removeHoverDom:function(e,t){$("#addBtn_"+t.tId).unbind().remove()},dblClickExpand:!0},callback:{onClick:function(e,t,i){n.checkNode(i,!i.checked,!0),l.parentFileId=i.fileId,"FOLDER"==i.fileNature&&(l.qualityList=[],i.children&&(l.qualityList=i.children),r.$apply());"FILE"==i.fileNature&&l.fileEdit(l.parentFileId)},beforeRemove:function(e,t,i){l.onRemove(i.id)}},data:{simpleData:{enable:!0,idKey:"id",pIdKey:"pId"},showTitle:!0,key:{title:"fileName"}}};l.zNodes=$linq(e).select(function(e){var t=e;return(t=e).id=e.fileId,t.name=e.fileName,t.pId=e.parentFileId,"FOLDER"==e.fileNature&&(t.icon=rootPath+"/contents/libs/zTree/css/zTreeStyle/img/diy/7.png"),t}).toArray(),l.initFileTreeSucess=!0,r.$watch("vm.initFileTreeSucess",function(e,t){if(1==e)var o=s(function(){for(var e=document.getElementById("zTree"),t=0;t<l.zNodes.length;t++)if(7<l.zNodes[t].name.length){var i=l.zNodes[t].name.substring(0,7);l.zNodes[t].name=i+"..."}null!=e&&(n=$.fn.zTree.init($("#zTree"),a,l.zNodes),s.cancel(o))},500)})}),l.initFileUpload()}l.parentId=i.params.parentId,l.fileId=i.params.fileId,l.fileLibrary={},l.fileLibrary.fileType="QUALITY",l.fileType="QUALITY",l.qualityList=[],l.initFileUpload=function(){l.fileId||r.$watch("vm.fileId",function(e,t){e&&e!=t&&!l.initUploadOptionSuccess&&l.initFileUpload()}),l.sysFile={businessId:l.fileId,mainId:l.fileId,mainType:t.mainTypeValue().FILELIBRARY,sysBusiType:null==l.fileUrl?"":l.fileUrl.substring(l.fileUrl.lastIndexOf(t.mainTypeValue().FILELIBRARY),l.fileUrl.lastIndexOf(l.fileName)),showBusiType:!1},t.initUploadOptions({inputId:"sysfileinput",vm:l,uploadSuccess:function(){t.findByBusinessId(l.fileId,function(e){l.sysFilelists=e,n.initFileList(l.parentFileId,l.fileType,function(e){l.qualityList=e.reObj})})}})},l.query=function(){var e=$.fn.zTree.getZTreeObj("zTree");e.expandAll(!1),e.cancelSelectedNode();for(var t=e.getNodesByParamFuzzy("name",""+l.name,null),i=0,o=t.length;i<o;i++){var n=e.getNodeByParam("tId",t[i].tId,null);e.expandNode(n,!0,!0,!0);var a=n.getParentNode();null!=a&&e.expandNode(a,!0,!0,!0)}},a(),l.addFolderWindow=function(e){console.log(l.fileLibrary),l.fileLibrary={},l.fileLibrary.fileType="QUALITY",null!=e&&(l.fileLibrary.parentFileId=e),$("#addRootFolder").kendoWindow({width:"600px",height:"300px",title:"创建文件夹",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()},l.saveRootFolder=function(){null!=l.fileLibrary.fileName?n.saveRootFolder(l.fileLibrary,function(e){e.flag||"ok"==e.reCode?o.alert("保存成功！",function(){window.parent.$("#addRootFolder").data("kendoWindow").close(),i.go("fileLibrary",{},{reload:!0})}):o.error(e.reMsg)}):o.alert("文件名不能为空!")},r.onRemove=function(e){o.confirm("删除的文件将无法恢复，确认删除？",function(){n.deleteRootDirectory(e,function(e){return e.flag||"ok"==e.reCode?(o.success("操作成功！"),!0):(o.error(e.reMsg),!1)})})},l.deleteFolder=function(){var e=$.fn.zTree.getZTreeObj("zTree").getCheckedNodes();if(null!=e&&0<e.length){var t=e[0].id;o.confirm("删除的文件将无法恢复，确认删除？",function(){n.deleteRootDirectory(t,function(e){e.flag||"ok"==e.reCode?(o.success("操作成功！"),i.go("fileLibrary",{},{reload:!0})):o.error(e.reMsg)})})}},l.fileEdit=function(e){l.isUpdate=!1,l.fileId=e,l.fileLibrary={},l.sysFilelists={},l.fileLibrary.fileType="QUALITY",l.fileId&&(l.isUpdate=!0,n.findFileById(l.fileId,function(e){l.fileLibrary=e,l.fileUrl=l.fileLibrary.fileUrl,l.fileName=l.fileLibrary.fileName,l.initFileUpload()}),t.findByBusinessId(l.fileId,function(e){l.sysFilelists=e})),$("#qualityEdit").kendoWindow({width:"800px",height:"500px",title:"文件编辑",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()},l.createFile=function(){l.fileLibrary.parentFileId=l.parentFileId,common.initJqValidation(),l.fileLibrary.fileName&&n.saveFile(l,function(e){e.flag||"ok"==e.reCode?o.alert("保存成功！",function(){l.isUpdate=!0,l.qualityList.push(e.reObj),l.fileId=e.reObj.fileId,n.getFileUrlById(l,l.fileId),l.initFileUpload(),a()}):o.error(e.reMsg)})},l.updateFile=function(){n.updateFile(l,function(e){e.flag||"ok"==e.reCode?o.alert("更新成功！",function(){l.initFileUpload(),window.parent.$("#qualityEdit").data("kendoWindow").close(),a()}):o.error(e.reMsg)})},l.del=function(i){o.confirm("删除的数据将无法恢复，确认删除？",function(){var e=$.fn.zTree.getZTreeObj("zTree"),t=e.getNodeByParam("id",i,null);e.removeNode(t),n.deleteFile(i,function(){l.qualityList.forEach(function(e,t){e.fileId==i&&l.qualityList.splice(t,1)})})})},l.commonDownloadSysFile=function(e){t.downloadFile(e),g},l.delFile=function(i){t.delSysFile(i,function(){$.each(l.sysFilelists,function(e,t){t.sysFileId==i&&l.sysFilelists.splice(e,1)}),n.initFileList(l.parentFileId,l.fileType,function(e){l.qualityList=e.reObj})})}}angular.module("app").controller("qualityCtrl",e),e.$inject=["bsWin","$state","$location","fileLibrarySvc","$scope","$interval","sysfileSvc"]}(),function(){"use strict";function e(e,t,i,o,n){var a=this;a.parentId=e.params.parentId,a.fileLibrary={},a.fileLibrary.parentFileId=a.parentId,a.fileLibrary.fileType="QUALITY",a.fileId=e.params.fileId,a.fileUrl="",a.fileName="",a.businessFlag={isInitFileOption:!1},a.initFileUpload=function(){a.fileId||o.$watch("vm.fileId",function(e,t){e&&e!=t&&!a.initUploadOptionSuccess&&a.initFileUpload()}),a.sysFile={businessId:a.fileId,mainId:"",mainType:i.mainTypeValue().FILELIBRARY,sysBusiType:a.fileUrl.substring(a.fileUrl.lastIndexOf(i.mainTypeValue().FILELIBRARY),a.fileUrl.lastIndexOf(a.fileName))},i.initUploadOptions({inputId:"sysfileinput",vm:a,uploadSuccess:function(){i.findByBusinessId(a.fileId,function(e){a.sysFilelists=e})}})},function(){a.fileId&&(a.isUpdate=!0,t.findFileById(a,a.fileId),i.findByBusinessId(a.fileId,function(e){a.sysFilelists=e}));a.parentId&&(t.getFileUrlById(a,a.parentId),t.initFileList(a))}(),a.createFile=function(){t.saveFile(a,function(e){e.flag||"ok"==e.reCode?n.alert("保存成功！",function(){a.fileId=e.reObj.fileId,a.initFileUpload()}):n.error(e.reMsg)})},a.updateFile=function(){t.updateFile(a,function(e){e.flag||"ok"==e.reCode?n.alert("更新成功！",function(){a.initFileUpload()}):n.error(e.reMsg)})}}angular.module("app").controller("qualityEditCtrl",e),e.$inject=["$state","fileLibrarySvc","sysfileSvc","$scope","bsWin"]}(),function(){"use strict";function e(t,i,e,o,n){var a=this;a.parentId=t.params.parentId,a.fileLibrary={},a.fileLibrary.parentFileId=a.parentId,a.fileLibrary.fileType="QUALITY",a.formId="fileForm",i.initFileList(a),a.addFile=function(){t.go("fileLibrary.fileEdit",{parentId:a.parentId,fileId:""})},a.update=function(e){t.go("fileLibrary.fileEdit",{parentId:a.parentId,fileId:e})},a.del=function(e){n.confirm("删除的数据将无法恢复，确认删除？",function(){i.deleteFile(a,e)})},a.queryUser=function(){i.queryUser(a)},a.resetUser=function(){var e=$("#fileForm").find("input");$.each(e,function(e,t){t.value=""})}}angular.module("app").controller("qualityListCtrl",e),e.$inject=["$state","fileLibrarySvc","sysfileSvc","$scope","bsWin"]}(),function(){"use strict";function e(s){return{saveCondition:function(e,t,i,o,n,a){var r={method:"post",url:rootPath+"/expertSelCondition/saveConditionList",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(n),params:{businessId:e,minBusinessId:t,reviewId:o,businessType:i}};common.http({$http:s,httpOptions:r,success:function(e){null!=a&&"function"==typeof a&&a(e.data)}})},deleteSelConditions:function(e,t,i,o){!0;var n={method:"delete",url:rootPath+"/expertSelCondition",params:{ids:t,reviewId:e}};common.http({$http:s,httpOptions:n,success:function(e){null!=o&&"function"==typeof o&&o(e.data)},onError:function(e){!1}})},isUnsignedInteger:function(e){return!!(/^(\+|-)?\d+$/.test(e)&&0<e)}}}angular.module("app").factory("expertConditionSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,i,a,o,n,r){var s=this;s.title="项目归档编辑",s.fileRecord={},s.fileRecord.signId=t.params.signid,s.fileRecord.fileRecordId="",s.signId=t.params.signid,s.isControl=t.params.isControl,s.isassistproc=!1,s.drawingFile=[],s.otherFile=[],s.declareFile=[],s.initFileUpload=function(){s.fileRecord.fileRecordId||o.$watch("vm.fileRecord.fileRecordId",function(e,t){e&&e!=t&&!s.initUploadOptionSuccess&&s.initFileUpload()}),s.sysFile={businessId:s.fileRecord.fileRecordId,mainId:s.signId,mainType:i.mainTypeValue().SIGN,sysfileType:i.mainTypeValue().DOFILE,sysBusiType:i.mainTypeValue().DOFILE},i.initUploadOptions({inputId:"sysfileinput",vm:s})},e.initFileRecordData(s),s.create=function(){e.saveFileRecord(s,function(e){s.isCommit=!1,e.flag||"ok"==e.reCode?(s.fileRecord.fileRecordId=e.reObj,a.alert("修改成功！")):a.error(response.data.reMsg)})},s.templatePage=function(e){n.templatePage(e)},s.addOtherFile=function(e,t){s.addRegisters||(s.addRegisters=[]),e?("2"==t?(s.addRegisters=s.drawingFile,s.showFilePage=!0,s.showFileOther=!1):(s.addRegisters=s.otherFile,s.showFileOther=!0,s.showFilePage=!1),s.showSignOther=!1,s.businessId=e,s.businessType=t,$("#addOtherFile").kendoWindow({width:"840px",height:"480px",title:"补充资料编辑",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()):a.alert("请先保存数据！")},s.addRegisterFile=function(){s.addRegister={},s.addRegister.businessId=s.businessId,s.addRegister.id=common.uuid(),s.addRegisters.push(s.addRegister)},s.saveRegisterFile=function(){r.saveRegisterFile(s.addRegisters,function(e){e.flag||"ok"==e.reCode?(s.addRegisters=e.reObj,a.alert("操作成功")):a.alert(e.reMsg)})},s.deleteRegisterFile=function(){var i=$("#addOtherFile input[name='addRegistersCheck']:checked");if(i.length<1)a.alert("请选择要删除的记录！");else{for(var o=[],n=0;n<i.length;n++)s.addRegisters.forEach(function(e,t){e.id&&i[n].value==e.id&&(o.push(i[n].value),s.addRegisters.splice(t,1))});0<o.length&&r.deleteByIds(o.join(","),function(e){a.alert("删除成功！")})}},s.updateFileCode=function(){$("#fileCodeWin").kendoWindow({width:"660px",height:"400px",title:"归档文号编辑",visible:!1,modal:!0,closable:!0,actions:["Close"]}).data("kendoWindow").center().open()}}angular.module("app").controller("fileRecordEditCtrl",e),e.$inject=["fileRecordSvc","$state","sysfileSvc","bsWin","$scope","templatePrintSvc","addRegisterFileSvc"]}(),function(){"use strict";function e(e,o){return{initFileRecordData:function(i){i.otherFile=[];var e={method:"get",url:rootPath+"/fileRecord/initFillPage",params:{signId:i.fileRecord.signId}};common.http({vm:i,$http:o,httpOptions:e,success:function(e){null!=e.data&&""!=e.data&&(i.fileRecord=e.data.file_record,i.fileRecord.signId=i.signId,i.signUserList=e.data.sign_user_List,i.isassistproc="9"==i.fileRecord.isassistproc,i.fileRecord.registerFileDto.forEach(function(e,t){"5"==e.businessType||"6"==e.businessType||"7"==e.businessType?i.otherFile.push(e):"2"==e.businessType&&i.drawingFile.push(e)}),i.initFileUpload())}})},saveFileRecord:function(i,t){if(common.initJqValidation($("#fileRecord_form")),$("#fileRecord_form").valid()){i.signUserList.forEach(function(e,t){i.fileRecord.signUserid==e.id&&(i.fileRecord.signUserName=e.displayName)}),i.isCommit=!0;var e={method:"post",url:rootPath+"/fileRecord",data:i.fileRecord};common.http({$http:o,httpOptions:e,success:function(e){null!=t&&"function"==typeof t&&t(e.data)},onError:function(e){i.isCommit=!1}})}}}}angular.module("app").factory("fileRecordSvc",e),e.$inject=["bsWin","$http"]}(),function(){"use strict";function e(t,e,o,i,n,a){var r=this;function s(){"REVIEW"==r.costType&&(n.initSignList(function(e){(e.flag||"ok"==e.reCode)&&(r.orgDeptList=e.reObj)}),t.initfinancial(r,function(e){r.stageCountList=e})),"ASSIST"==r.costType&&a.findSingAssistCostList(r.signAssistCost,function(e){r.signAssistCostList=e})}r.sign={},r.financial={},r.model={},r.signAssistCost={},r.isuserExist=!1,r.id=e.params.id,r.financial.businessId=e.params.businessId,r.costType=e.params.costType,"REVIEW"==r.costType&&(r.title="评审费统计管理",r.titleName="专家评审费",r.windowName="专家评审费录入"),"ASSIST"==r.costType&&(r.title="协审费统计管理",r.titleName="专家协审费",r.windowName="专家协审费录入"),r.addCostWindow=function(e){r.signAssistCostCounList={},r.expertSelectedDtoList={},r.signAssistCost={},"REVIEW"==r.costType&&(t.sumFinancial(r,e.businessId),r.businessId=e.businessId,r.projectName=e.projectname),"ASSIST"==r.costType&&(r.businessId=e.signId,r.projectName=e.projectName),t.initFinancialProject(r.businessId,function(e){r.financial={},r.financial.businessId=r.businessId,r.financial.projectName=r.projectName,r.financial.paymentData=e.financialDto.paymentData,i.initReview(r.financial.businessId,"",function(e){r.expertReview=e,r.reviewTitle=e.reviewTitle,r.payDate=e.payDate,r.expertSelectedDtoList=e.expertSelectedDtoList,r.expertSelectedDtoList&&0<r.expertSelectedDtoList.length&&(r.showReviewCost=!0)}),r.signAssistCost.signId=r.businessId,a.findSingAssistCostCount(r.signAssistCost,function(e){r.signAssistCostCounList=e,r.signAssistCostCounList&&0<r.signAssistCostCounList.length&&(r.showAssistCost=!0)}),r.financials=e.financiallist,r.countCost(),$("#addCostWindow").kendoWindow({width:"70%",height:"600px;",title:r.windowName,visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()})},r.costExportExcel=function(){var e=r.reviewTitle+"("+r.payDate+")";t.exportExcel(r,r.financial.businessId,e)},r.countCost=function(){var i=0;r.financials&&0<r.financials.length&&angular.forEach(r.financials,function(e,t){e.charge&&(i+=e.charge)}),$("#financialCount").html(i)},r.changeName=function(e,t){if(0<r.financials.length)for(var i=0;i<r.financials.length-1;i++)i!=e&&null!=r.financials[i].chargeName&&r.financials[i].chargeName==t&&(o.alert("该费用已经录入，不能重复录入！"),r.financials[e]={})},r.addFinancial=function(){var e={chargeType:"8"};e.businessId=r.financial.businessId,e.projectName=r.financial.projectName,e.paymentData=r.financial.paymentData,r.financials||(r.financials=[]),r.financials.push(e)},r.saveFinancial=function(){common.initJqValidation($("#fnFrom")),$("#fnFrom").valid()?t.savefinancial(r.financials,function(e){e.flag||"ok"==e.reCode?(r.financials=e.reObj,o.success(e.reMsg),$("#addCostWindow").data("kendoWindow").close()):o.error(e.reMsg)}):o.error("费用信息填写不正确！")},r.deleteFinancial=function(){var i=$("#financialsTable input[name='financialsCheck']:checked");if(i.length<1)common.alert({vm:r,msg:"请选择要删除的记录！"});else for(var o=[],n=0;n<i.length;n++){r.financials.forEach(function(e,t){i[n].value!=e.id&&null!=e.id||r.financials.splice(t,1),o.push(i[n].value)});var e=o.join(",");t.deleteFinancialManager(e,function(e){})}},r.queryUser=function(){s()},r.resetQuery=function(){r.financial={}},s()}angular.module("app").controller("addCostCtrl",e),e.$inject=["financialManagerSvc","$state","bsWin","expertReviewSvc","adminSvc","assistCostCountSvc"]}(),function(){"use strict";function e(o,r,n,s){return{initAddCost:function(a,t,e,i){a.financial={},null==e.businessId&&(null==e.signid?e.businessId=e.signId:e.businessId=e.signid);e.projectname||(e.projectname=e.projectName);"REVIEW"==t?(a.windowName="项目评审费录入",a.financial.businessType="SIGN",a.financial.chargeType="1"):"ASSIST"==t&&(a.windowName="项目协审费录入",a.financial.businessType="SIGN",a.financial.chargeType="2");a.financial.businessId=e.businessId,a.financial.projectName=e.projectname,a.costExportExcel=function(){var e=a.expertReview.reviewTitle+"("+a.expertReview.payDate+")";r.exportExcel(a,a.financial.businessId,e)},a.countCost=function(){var i=0;a.financials&&0<a.financials.length&&angular.forEach(a.financials,function(e,t){e.charge&&(i+=e.charge)}),$("#financialCount").html(i)},a.addFinancial=function(){var e={};e.businessId=a.financial.businessId,e.projectName=a.financial.projectName,e.paymentData=a.financial.paymentData,e.chargeType=a.financial.chargeType,e.isNew=!0,e.id=common.uuid(),a.financials||(a.financials=[]),a.financials.push(e)},a.saveFinancial=function(){common.initJqValidation($("#fnFrom"));var e=$("#fnFrom").valid();e?(angular.forEach(a.financials,function(e,t){e.paymentData=a.financial.paymentData,e.isNew&&(e.id="")}),r.savefinancial(a.financials,function(e){e.flag||"ok"==e.reCode?(a.financials=e.reObj,o.success(e.reMsg,function(){$("#"+i).data("kendoWindow").close()})):o.error(e.reMsg)})):o.error("费用信息填写不正确！")},a.deleteFinancial=function(){var n=$("#financialsTable input[name='financialsCheck']:checked");n.length<1?o.alert("请选择要删除的记录！"):o.confirm({title:"询问提示",message:"确认删除？",onOk:function(){for(var i=[],o=0;o<n.length;o++)a.financials.forEach(function(e,t){n[o].value==e.id&&(a.financials.splice(t,1),n[o].value&&i.push(n[o].value))});if(a.financials&&0!=a.financials.length||(a.financialsCheck=!1),0<i.length){var e=i.join(",");r.deleteFinancialManager(e,function(e){a.countCost()})}}})},a.count=function(){a.countCost()},r.initFinancialProject(a.financial,function(e){a.financials=e.financiallist,a.financials&&0<a.financials.length&&(a.countCost(),a.financials[0].paymentData&&(a.financial.paymentData=new Date(a.financials[0].paymentData.CompatibleDate()).Format("yyyy-MM-dd"))),n.initReview(a.financial.businessId,"",function(e){a.expertReview=e,console.log(a.expertReview)}),"ASSIST"==t&&s.findSignCostBySignId(a.financial.businessId,function(e){a.signAssistCostCounList=e||[]}),$("#"+i).kendoWindow({width:"70%",height:"560",title:a.windowName,visible:!1,modal:!0,closable:!0,close:function(){a.financial={},a.expertReview={},a.financials={},a.signAssistCostCounList={}},actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()})}}}angular.module("app").factory("addCostSvc",e),e.$inject=["bsWin","financialManagerSvc","expertReviewSvc","assistCostCountSvc"]}(),function(){"use strict";function e(t,a,e,i){var r=this;r.title="协审费录入",r.financials=new Array,r.financial={},r.financial.businessId=e.params.signid,a.initAssistProject(r.financial.businessId,function(e){r.model=e.financialDto,r.financials=e.financiallist,r.countCost()}),r.countCost=function(){if(r.financials&&0<r.financials.length){var i=0;angular.forEach(r.financials,function(e,t){e.charge&&(i+=e.charge)}),$("#financialCount").html(i)}},r.addFinancial=function(){var e={chargeType:"8"};e.businessId=r.model.businessId,e.projectName=r.model.projectName,e.paymentData=r.model.paymentData,r.financials||(r.financials=[]),r.financials.push(e)},r.saveFinancial=function(){a.savefinancial(r.financials,function(e){e.flag||"ok"==e.reCode?(r.financials=e.reObj,r.model.paymentData||(r.model.paymentData=r.financials[0].paymentData),r.countCost(),t.success(e.reMsg)):t.error(e.reMsg)})},r.deleteFinancial=function(){var i=$("#financialsTable input[name='financialsCheck']:checked");if(i.length<1)common.alert({vm:r,msg:"请选择要删除的记录！"});else{for(var o=[],n=0;n<i.length;n++)r.financials.forEach(function(e,t){null!=e.id&&i[n].value!=e.id||r.financials.splice(t,1),i[n].value&&o.push(i[n].value)});if(0<o.length){var e=o.join(",");a.deleteFinancialManager(e,function(e){r.countCost(),t.alert("操作成功！！")})}else r.countCost()}}}angular.module("app").controller("assistCostEditCtrl",e),e.$inject=["bsWin","financialManagerSvc","$state","expertReviewSvc"]}(),function(){"use strict";function e(e,t,i,o){var n=this;function a(){n.isSubmit=!0,n.nodata=!1,t.findSingAssistCostList(n.signAssistCost,function(e){n.isSubmit=!1,n.signAssistCostList=e,n.signAssistCostList&&0!=n.signAssistCostList.length||(n.nodata=!0)})}n.title="协审费录入",n.signAssistCost={},n.signAssistCost.beginTime=(new Date).halfYearAgo(),n.signAssistCost.endTime=(new Date).Format("yyyy-MM-dd"),n.costType=o.params.costType,n.financials=[],a(),n.queryAssistCost=function(){a()},n.assistCostReset=function(){n.signAssistCost={}},n.addCostWindow=function(e,t){i.initAddCost(n,n.costType,e,t)}}angular.module("app").controller("assistCostCountEditCtrl",e),e.$inject=["bsWin","assistCostCountSvc","addCostSvc","$state"]}(),function(){"use strict";function e(e,t,i){var o=this;function n(){o.isSubmit=!0,o.nodata=!1,e.findSingAssistCostCount(o.signAssistCost,function(e){o.isSubmit=!1,o.signAssistCostCounList=e,o.signAssistCostCounList&&0!=o.signAssistCostCounList.length||(o.nodata=!0)})}o.signAssistCost={},o.signAssistCost.beginTime=(new Date).halfYearAgo(),o.signAssistCost.endTime=(new Date).Format("yyyy-MM-dd"),n(),o.queryAssistCost=function(){n()},o.assistCostReset=function(){o.signAssistCost={}}}angular.module("app").controller("assistCostCountListCtrl",e),e.$inject=["assistCostCountSvc","$state","addCostSvc"]}(),function(){"use strict";function e(o){var n=rootPath+"/financialManager";return{grid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expertSelected/assistCostList",$("#searchform")),schema:{data:"value",model:{id:"id",fields:{createdDate:{type:"date"}}}},serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{field:"",title:"",width:30,template:function(e){switch(e.lightState){case"4":return $("#span1").html();case"8":return $("#span5").html();case"7":return $("#span4").html();case"6":return $("#span3").html();case"5":return $("#span2").html();case"1":case"2":case"3":default:return""}}},{field:"projectname",title:"项目名称",width:100,filterable:!1},{field:"builtcompanyname",title:"协审单位",width:100,filterable:!1},{field:"principal",title:"项目负责人",width:100,filterable:!1},{field:"signNum",title:"协审登记号",width:100,filterable:!1},{field:"totalCost",title:"计划协审费用",width:120,filterable:!1},{field:"totalCost",title:"实付协审费用",width:120,filterable:!1},{field:"payDate",title:"付款日期",width:100,filterable:!1},{field:"declareValue",title:"申报金额",width:100,filterable:!1},{field:"",title:"操作",width:100,template:function(e){return common.format($("#columnBtns").html(),"vm.addCost('"+e.businessId+"')")}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})},resizable:!0}},deleteassistCostCount:function(e,t){var i={method:"delete",url:n,data:e};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},saveAssistCost:function(e,t){var i={method:"post",url:rootPath+"/financialManager",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(e)};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},sumAssistCount:function(t){var e={method:"get",url:rootPath+"/financialManager/html/sumfinancial",params:{businessId:t.financial.businessId}};common.http({vm:t,$http:o,httpOptions:e,success:function(e){t.financial.stageCount=e.data,$("#financialCount").html(t.financial.stageCount)}})},initAssistlProject:function(e,t){var i={method:"post",url:rootPath+"/financialManager/initfinancial",params:{businessId:e}};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},isUnsignedInteger:function(e){return!!(/^(\+|-)?\d+$/.test(e)&&0<e)},assistExportExcel:function(e,t,i){var i=escape(encodeURIComponent(i));window.open(rootPath+"/financialManager/exportExcel?fileName="+i+"&businessId="+t)},findSingAssistCostCount:function(e,t){var i={method:"post",url:rootPath+"/financialManager/findSingAssistCostCount",data:e};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},findSingAssistCostList:function(e,t){var i={method:"post",url:rootPath+"/financialManager/findSingAssistCostList",data:e};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},findSignCostBySignId:function(e,t){var i={method:"post",url:rootPath+"/financialManager/findSignCostBySignId",params:{signId:e}};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}}}angular.module("app").factory("assistCostCountSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,a,t,i){var r=this;r.title="专家费统计管理",r.financials=[],r.searchModel={},r.searchModel.beginTime=(new Date).halfYearAgo(),r.searchModel.endTime=(new Date).Format("yyyy-MM-dd"),r.model={},r.sign={},r.financial={},r.financial.signid=t.params.signid,r.inputIntegerValue=function(e,t){a.isUnsignedInteger(e)?$("#errorsUnmber"+t).html(""):$("#errorsUnmber"+t).html("只能输入数字")},r.addFinancial=function(){var e=$("#projectName").val(),t=$("#paymentData").val(),i=r.financial.signid;r.financial={},r.financial.chargeType="评审项目",r.financial.signid=i,r.financial.projectName=e,r.financial.paymentData=t,r.financials.push(r.financial),r.i++},r.saveFinancial=function(){a.savefinancial(r)},r.deleteFinancial=function(){var i=$("#financialsTable input[name='financialsCheck']:checked");if(i.length<1)common.alert({vm:r,msg:"请选择要删除的记录！"});else for(var o=[],n=0;n<i.length;n++){r.financials.forEach(function(e,t){i[n].value!=e.id&&null!=e.id||r.financials.splice(t,1),o.push(i[n].value)});var e=o.join(",");a.deleteexportCount(r,e)}},r.searchForm=function(){r.gridOptions.dataSource._skip=0,r.gridOptions.dataSource.read()},r.excelExport=function(){r.fileName="专家评审费明细",r.exportData=$("#statisticalGrid").data("kendoGrid")._data,a.excelExport(r,r.exportData,r.fileName)},r.formReset=function(){r.searchModel={}},a.grid(r)}angular.module("app").controller("exportCountCtrl",e),e.$inject=["$location","exportCountSvc","$state","$http"]}(),function(){"use strict";function e(s){var o=rootPath+"/exportCount";return{grid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expertSelected/findByOData",$("#searchform")),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10});e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:[{field:"rowNumber",title:"序号",width:50,filterable:!1,attributes:{class:"table-cell",style:"text-align: center"},template:"<span class='row-number'></span>"},{field:"expertDto.name",title:"姓名",width:80,filterable:!1},{field:"expertDto.idCard",title:"身份证号",width:170,filterable:!1},{field:"expertDto.openingBank",title:"开户行",width:140,filterable:!1},{field:"expertDto.bankAccount",title:"银行账号",width:200,filterable:!1},{field:"reviewCost",title:"评审费",width:70,filterable:!1},{field:"reviewTaxes",title:"应缴税",width:70,filterable:!1},{field:"expertReviewDto.reviewTitle",title:"项目名称",width:380,filterable:!1},{field:"expertReviewDto.reviewDate",title:"评审/函评日期",width:120,filterable:!1},{field:"principal",title:"负责人",width:140,filterable:!1}],dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})},resizable:!0}},deleteexportCount:function(t,e){t.isSubmit=!0;var i={method:"delete",url:o,data:e};common.http({vm:t,$http:s,httpOptions:i,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,n()}})}})}})},savefinancial:function(t){var e={method:"post",url:rootPath+"/exportCount",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(t.financials)};common.http({vm:t,$http:s,httpOptions:e,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){n()}})}})}})},sumFinancial:function(t){var e={method:"get",url:rootPath+"/exportCount/html/sumfinancial",params:{signId:t.financial.signid}};common.http({vm:t,$http:s,httpOptions:e,success:function(e){t.financial.stageCount=e.data,$("#financialCount").html(t.financial.stageCount)}})},initFinancialProject:function(t){var e={method:"get",url:rootPath+"/exportCount/initfinancial",params:{signid:t.financial.signid}};common.http({vm:t,$http:s,httpOptions:e,success:function(e){t.model=e.data.financialDto,t.financials=e.data.financiallist}})},isUnsignedInteger:function(e){return!!(/^(\+|-)?\d+$/.test(e)&&0<e)},excelExport:function(e,t,i){var o={fileName:window.encodeURIComponent(window.encodeURIComponent(i))},n=rootPath+"/expertSelected/expertDetailExport";if($("#searchform")){var a=common.buildOdataFilter($("#searchform"));a&&(o.$filter=a)}var r={method:"post",url:n,traditional:!0,dataType:"json",responseType:"arraybuffer",params:o};common.http({vm:e,$http:s,httpOptions:r,success:function(e){i+=".xls";common.downloadReport(e.data,i,"vnd.ms-excel")}})}};function n(){window.location.reload()}}angular.module("app").factory("exportCountSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,o,t,i){var n=this;n.title="专家缴税统计管理",n.financials=[],n.sign={},n.financial={},n.model={},n.model.year=t.params.year,n.model.month=t.params.month,n.countExpertCost=function(){o.expertCostTotal(n,function(e){n.expertCostTotalInfo=e.reObj.expertCostTotalInfo,n.tMonthReviewcost=e.reObj.tMonthReviewcost,n.tMonthReviewtaxes=e.reObj.tMonthReviewtaxes,n.tYearReviewcost=e.reObj.tYearReviewcost,n.tYearReviewtaxes=e.reObj.tYearReviewtaxes})},n.getExpertCoustDetail=function(){t.go("expertPaymentDetailCountList",{year:n.model.year,month:n.model.month})},n.printFile=function(){var e=rootPath+"/contents/libs/pdfjs-dist/web/viewer.html?version="+(new Date).getTime()+"&file="+rootPath+"/expertSelected/printPreview/"+n.model.year+"/"+n.model.month;$("#iframePreview").attr("src",e),$("#previewModal").kendoWindow({width:"80%",height:"730px",title:"",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},n.excelExport=function(){o.excelExport(n.expertCostTotalInfo,n.model.year,n.model.month)},function(){if(!n.model.year||!n.model.month){var e=new Date,t=e.getFullYear(),i=e.getMonth()+1;n.model.year=t+"",n.model.month=i+""}o.expertCostTotal(n,function(e){n.expertCostTotalInfo=e.reObj.expertCostTotalInfo,n.tMonthReviewcost=e.reObj.tMonthReviewcost,n.tMonthReviewtaxes=e.reObj.tMonthReviewtaxes,n.tYearReviewcost=e.reObj.tYearReviewcost,n.tYearReviewtaxes=e.reObj.tYearReviewtaxes})}()}angular.module("app").controller("expertPaymentCountCtrl",e),e.$inject=["$location","expertPaymentCountSvc","$state","$http"]}(),function(){"use strict";function e(a,r){var o=rootPath+"/expertPaymentCount";return{grid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expertReview/findByOData",$("#searchform")),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10}),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.signid)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"expretCount",title:"姓名",width:100,filterable:!1},{field:"expretCount",title:"身份证号",width:100,filterable:!1},{field:"expretCount",title:"开户行",width:80,filterable:!1},{field:"expretCount",title:"银行账号",width:120,filterable:!1},{field:"reviewCost",title:"评审费（元）",width:160,filterable:!1},{field:"reviewTaxes",title:"应缴税",width:120,filterable:!1},{field:"reviewTitle",title:"项目名称",width:160,filterable:!1},{field:"reviewDate",title:"评审时间",width:160,filterable:!1},{field:"reviewDate",title:"函评时间",width:120,filterable:!1},{field:"reviewDate",title:"负责人",width:120,filterable:!1},{field:"",title:"操作",width:100,template:function(e){return common.format($("#columnBtns").html(),e.signid)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})},resizable:!0}},deleteexpertPaymentCount:function(t,e){t.isSubmit=!0;var i={method:"delete",url:o,data:e};common.http({vm:t,$http:a,httpOptions:i,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,n()}})}})}})},savefinancial:function(t){var e={method:"post",url:rootPath+"/expertPaymentCount",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(t.financials)};common.http({vm:t,$http:a,httpOptions:e,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){n()}})}})}})},sumFinancial:function(t){var e={method:"get",url:rootPath+"/expertPaymentCount/html/sumfinancial",params:{signId:t.financial.signid}};common.http({vm:t,$http:a,httpOptions:e,success:function(e){t.financial.stageCount=e.data,$("#financialCount").html(t.financial.stageCount)}})},initFinancialProject:function(t){var e={method:"get",url:rootPath+"/expertPaymentCount/initfinancial",params:{signid:t.financial.signid}};common.http({vm:t,$http:a,httpOptions:e,success:function(e){t.model=e.data.financialDto,t.financials=e.data.financiallist}})},isUnsignedInteger:function(e){return!!(/^(\+|-)?\d+$/.test(e)&&0<e)},expertCostTotal:function(e,t){var i={method:"post",url:rootPath+"/expertSelected/expertCostTotal",data:e.model};common.http({$http:a,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},expertCostDetailTotal:function(e,t){var i={method:"post",url:rootPath+"/expertSelected/expertCostDetailTotal",data:e.model};common.http({$http:a,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},excelExport:function(e,t,i){var o="专家缴税统计汇总表("+t+"-"+i+")",n={method:"post",url:rootPath+"/expertSelected/excelExport/"+t+"/"+i,headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",responseType:"arraybuffer",data:angular.toJson(e)};common.http({$http:a,httpOptions:n,success:function(e){var t=new Blob([e.data],{type:"application/vnd.ms-excel"});r.saveAs(t,o+".xls")}})}};function n(){window.location.reload()}}angular.module("app").factory("expertPaymentCountSvc",e),e.$inject=["$http","FileSaver"]}(),function(){"use strict";function e(e,o,n,t){var a=this;function r(e){var t="",i=0;if(0<e.length){for(var o=0;o<e.length;o++)if(t+="<tr id='option"+ ++i+"'>",e[o].name.length,t+="<td  class='text-center'><strong>"+e[o].name+"</strong></td>",t+="<td  class='text-center'><strong>"+e[o].expertNo+"</strong></td>",t+="<td class='text-center'>",t+=e[o].reviewcost,t+="</td>",t+="<td class='text-center'>",t+=e[o].reviewtaxes,t+="</td>",t+="<td  class='text-center'><strong>"+e[o].monthTotal+"</strong></td>",t+="</tr>",null!=e[o].expertCostDetailCountDtoList&&0<e[o].expertCostDetailCountDtoList.length)for(var n=0;n<e[o].expertCostDetailCountDtoList.length;n++){var a="";a+="<tr id='option"+ ++i+"'>",a+="<td class='text-center' colspan='2'>",a+=null==e[o].expertCostDetailCountDtoList[n].reviewTitle?"":e[o].expertCostDetailCountDtoList[n].reviewTitle,a+="</td>",a+="<td class='text-center'>",a+=null==e[o].expertCostDetailCountDtoList[n].reviewType?"":e[o].expertCostDetailCountDtoList[n].reviewType,a+="</td>",a+="<td class='text-center'>",null!=e[o].expertCostDetailCountDtoList[n].reviewDate&&(a+=e[o].expertCostDetailCountDtoList[n].reviewDate),a+="</td>",a+="<td class='text-center'>",null!=e[o].expertCostDetailCountDtoList[n].reviewDate&&(a+=e[o].expertCostDetailCountDtoList[n].reviewDate),a+="</td>",a+="<td class='text-center'>",a+=e[o].expertCostDetailCountDtoList[n].reviewcost,a+="</td>",a+="<td class='text-center'>",a+=e[o].expertCostDetailCountDtoList[n].reviewtaxes,a+="</td>",t+=a+="</tr>"}$("#expertCostHead").after(t)}}a.title="专家缴税统计管理",a.model={},a.financials=new Array,a.sign={},a.financial={},a.model.year=n.params.year,a.model.month=n.params.month,a.getExpertCoust=function(){n.go("expertPaymentCountList",{year:a.model.year,month:a.model.month})},a.countExpertCostDetail=function(){o.expertCostDetailTotal(a,function(e){a.expertCostTotalInfo=e.reObj.expertCostTotalInfo;for(var t=$("#expertCostTable tr").length,i=1;i<t;i++)$("#option"+i).remove();r(a.expertCostTotalInfo)})},function(){if(n.params.year)a.model.year=n.params.year,a.model.month=n.params.month;else{var e=new Date,t=e.getFullYear(),i=e.getMonth()+1;a.model.year=t,a.model.month=i}o.expertCostDetailTotal(a,function(e){a.expertCostTotalInfo=e.reObj.expertCostTotalInfo,r(a.expertCostTotalInfo)})}(),a.printFile=function(){var e=a.model.year+a.model.month,t=rootPath+"/contents/libs/pdfjs-dist/web/viewer.html?version="+(new Date).getTime()+"&file="+rootPath+"/expertSelected/printPreviewDetail/"+e;$("#iframePreview").attr("src",t),$("#previewModal").kendoWindow({width:"80%",height:"730px",title:"",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()}}angular.module("app").controller("expertPaymentDetailCountCtrl",e),e.$inject=["$location","expertPaymentCountSvc","$state","$http"]}(),function(){"use strict";function e(e,d,t,i,o){var n,a,r,s,u=this;function m(){var e=(new Date).getMonth(),t=0;return e<3&&(t=0),2<e&&e<6&&(t=3),5<e&&e<9&&(t=6),8<e&&(t=9),t}function p(e){var t=e.getFullYear(),i=e.getMonth()+1,o=e.getDate();return i<10&&(i="0"+i),o<10&&(o="0"+o),t.toString()+"-"+i.toString()+"-"+o.toString()}u.title="专家评审基本情况统计",u.model={},u.expertRevConCount=function(){3!=u.model.reportType||null!=u.model.beginTime&&""!=u.model.beginTime&&null!=u.model.endTime&&""!=u.model.endTime?d.expertRevConCount(u,function(e){1==u.model.reportType?u.expertReviewConDtoList=e.reObj.expertReviewConDtoList:2==u.model.reportType?u.expertRevConSimDtoList=e.reObj.expertRevConSimDtoList:3==u.model.reportType&&(u.expertRevConCompDtoList=e.reObj.expertRevConCompDtoList)}):o.alert("会议起止时间不能为空")},u.dropSlelectedCount=function(){if(1==u.model.reportType||2==u.model.reportType){var e=new Date,t=e.getFullYear(),i=e.getMonth()+1,o=e.getDate();i=i<10?"0"+i:i,u.model.beginTime=t.toString()+"-01-01",u.model.endTime=t.toString()+"-"+i.toString()+"-"+o}else 3==u.model.reportType&&(u.model.beginTime=(c=(new Date).getFullYear(),p(new Date(c,m(),1))),u.model.endTime=(n=(new Date).getFullYear(),a=m()+2,p(new Date(n,a,(r=a,s=(new Date).getYear(),l=new Date(s,r,1),(new Date(s,r+1,1)-l)/864e5)))));var n,a,r,s,l,c;d.expertRevConCount(u,function(e){1==u.model.reportType?u.expertReviewConDtoList=e.reObj.expertReviewConDtoList:2==u.model.reportType?u.expertRevConSimDtoList=e.reObj.expertRevConSimDtoList:3==u.model.reportType&&(u.expertRevConCompDtoList=e.reObj.expertRevConCompDtoList)})},u.formReset=function(){var e=u.model.reportType;u.model={},u.model.reportType=e},n=new Date,a=n.getFullYear(),r=n.getMonth()+1,s=n.getDate(),r=r<10?"0"+r:r,u.model.beginTime=a.toString()+"-01-01",u.model.endTime=a.toString()+"-"+r.toString()+"-"+s,u.model.reportType=1,d.expertRevConCount(u,function(e){u.expertReviewConDtoList=e.reObj.expertReviewConDtoList})}angular.module("app").controller("expertRevConCountCtrl",e),e.$inject=["$location","expertRevConCountSvc","$state","$http","bsWin"]}(),function(){"use strict";function e(o){return{expertRevConCount:function(e,t){if(1==e.model.reportType)var i={method:"post",url:rootPath+"/expertSelected/expertReviewCondDetailCount",data:e.model};else if(2==e.model.reportType)var i={method:"post",url:rootPath+"/expertSelected/expertReviewCondCount",data:e.model};else if(3==e.model.reportType)var i={method:"post",url:rootPath+"/expertSelected/expertReviewCompliCount",data:e.model};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}}}angular.module("app").factory("expertRevConCountSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(t,a,e,i,o){var r=this;r.title="评审费录入",r.financials=new Array,r.financial={},r.financial.businessId=e.params.businessId,a.initFinancialProject(r.financial.businessId,function(e){r.model=e.financialDto,r.financials=e.financiallist,r.countCost()}),r.countCost=function(){if(r.financials&&0<r.financials.length){var i=0;angular.forEach(r.financials,function(e,t){e.charge&&(i+=e.charge)}),$("#financialCount").html(i)}},r.findStageCostTable=function(){o.initReview(r.financial.businessId,"",function(e){r.expertReview=e,r.reviewTitle=e.reviewTitle,r.payDate=e.payDate,r.expertSelectedDtoList=e.expertSelectedDtoList,$("#stageCostWindow").kendoWindow({width:"70%",height:"600px",title:"评审费用统计表",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()})},r.exportExcel=function(){var e=r.reviewTitle+"("+r.payDate+")";a.exportExcel(r,r.financial.businessId,e)},r.inputIntegerValue=function(e,t){a.isUnsignedInteger(e)?$("#errorsUnmber"+t).html(""):$("#errorsUnmber"+t).html("只能输入数字")},r.addFinancial=function(){var e={chargeType:"1"};e.businessId=r.model.businessId,e.projectName=r.model.projectName,e.paymentData=r.model.paymentData,r.financials||(r.financials=[]),r.financials.push(e)},r.saveFinancial=function(){a.savefinancial(r.financials,function(e){e.flag||"ok"==e.reCode?(r.financials=e.reObj,r.model.paymentData||(r.model.paymentData=r.financials[0].paymentData),r.countCost(),t.success(e.reMsg)):t.error(e.reMsg)})},r.deleteFinancial=function(){var i=$("#financialsTable input[name='financialsCheck']:checked");if(i.length<1)common.alert({vm:r,msg:"请选择要删除的记录！"});else{for(var o=[],n=0;n<i.length;n++)r.financials.forEach(function(e,t){null!=e.id&&i[n].value!=e.id||r.financials.splice(t,1),i[n].value&&o.push(i[n].value)});if(0<o.length){var e=o.join(",");a.deleteFinancialManager(e,function(e){r.countCost(),t.alert("操作成功！！")})}}}}angular.module("app").controller("financialManagerCtrl",e),e.$inject=["bsWin","financialManagerSvc","$state","$http","expertReviewSvc"]}(),function(){"use strict";function e(e,t,i,o,n,a,r,s){var l=this;l.title="评审费录入",l.sign={},l.financial={},l.model={},l.model.beginTime=(new Date).halfYearAgo(),l.model.endTime=(new Date).Format("yyyy-MM-dd"),l.isuserExist=!1,l.id=i.params.id,l.financial.businessId=i.params.businessId,l.costType=i.params.costType,l.id&&(l.isUpdate=!0,l.title="评审费统计管理"),l.businessFlag={expertReviews:[]},t.initfinancial(l.model,function(e){l.stageCountList=e}),r.initSignList(function(e){(e.flag||"ok"==e.reCode)&&(l.orgDeptList=e.reObj)}),l.showCostWindow=function(e,t){s.initAddCost(l,l.costType,e,t)},l.queryFinancl=function(){t.initfinancial(l.model,function(e){l.stageCountList=e})},l.resetQuery=function(){l.model={}}}angular.module("app").controller("financialManagerEditCtrl",e),e.$inject=["$location","financialManagerSvc","$state","signSvc","bsWin","expertReviewSvc","adminSvc","addCostSvc"]}(),function(){"use strict";function e(o){rootPath;return{grid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expertSelected/findProjectReviewCost",$("#searchform")),schema:common.kendoGridConfig().schema({id:"signid",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{field:"",title:"",width:30,template:function(e){if("4"==e.isLightUp)return $("#span4").html();switch(e.processState){case 9:return $("#span5").html();case 4:case 5:return $("#span2").html();case 7:case 8:return $("#span3").html();default:return $("#span1").html()}}},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"projectname",title:"项目名称",width:140,filterable:!1},{field:"builtcompanyname",title:"建设单位",width:180,filterable:!1},{field:"reviewstage",title:"项目阶段",width:80,filterable:!1},{field:"principal",title:"项目负责人",width:120,filterable:!1},{field:"totalCost",title:"计划专家费用",width:160,filterable:!1,template:function(e){return"<button ng-click='vm.reviewCostWindow('"+e.businessId+"') '>"+e.totalCost+"</button>"}},{field:"signdate",title:"签收日期",width:120,filterable:!1,format:"{0: yyyy-MM-dd}"}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})},resizable:!0}},deleteFinancialManager:function(e,t){var i={method:"delete",url:rootPath+"/financialManager",data:e};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},savefinancial:function(e,t){var i={method:"post",url:rootPath+"/financialManager",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(e)};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},sumFinancial:function(e,t){var i={method:"get",url:rootPath+"/financialManager/html/sumfinancial",params:{businessId:t}};common.http({vm:e,$http:o,httpOptions:i,success:function(e){$("#financialCount").html(e.data)}})},initFinancialProject:function(e,t){var i={method:"post",url:rootPath+"/financialManager/initfinancial",params:{businessId:e.businessId,businessType:e.businessType,chargeType:e.chargeType}};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},initAssistProject:function(e,t){var i={method:"post",url:rootPath+"/financialManager/initfinancial",params:{businessId:e,businessType:"SIGN"}};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},isUnsignedInteger:function(e){return!!(/^(\+|-)?\d+$/.test(e)&&0<e)},stageCostCountList:function(t){var e={method:"post",url:rootPath+"/financialManager/findByOData"};common.http({vm:t,$http:o,httpOptions:e,success:function(e){t.stageCountList=e.data.value}})},exportExcel:function(e,t,i){var i=escape(encodeURIComponent(i));window.open(rootPath+"/financialManager/exportExcel?fileName="+i+"&businessId="+t)},initfinancial:function(e,t){var i={method:"post",url:rootPath+"/expertSelected/findProjectReviewCost",data:e};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}}}angular.module("app").factory("financialManagerSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,i,o,n){var a=this;a.title="项目评审费分类统计",a.model={},a.page=0,a.proReviewClassifyDetailDtoList=[],a.proReviewClassifyCountDtoList=[],a.model.beginTime=(new Date).halfYearAgo(),a.model.endTime=(new Date).Format("yyyy-MM-dd"),a.projectCostCountList=function(){o.go("projectCostCountList")},a.initFinancial=function(e){var t=o.href("financialManager",{businessId:e});window.open(t,"_blank")},a.proCostCount=function(){t.projectCostClassifyCout(a,function(e){a.proReviewClassifyCountDtoList=e.reObj.proReviewClassifyCountDtoList,null!=e.reObj&&e.reObj.proReviewClassifyDetailDtoList.forEach(function(e,t){a.proReviewClassifyDetailDtoList.push(e)}),null!=e.reObj.proReviewClassifyDetailDtoList&&0!=e.reObj.proReviewClassifyDetailDtoList.length&&(a.page++,a.proCostCount())})},a.proCostClassifyCount=function(){a.proReviewClassifyDetailDtoList=[],a.proReviewClassifyCountDtoList=[],a.page=0,a.proCostCount()},a.formReset=function(){a.model={}},i.initSignList(function(e){(e.flag||"ok"==e.reCode)&&(a.orgDeptList=e.reObj)}),a.proCostCount()}angular.module("app").controller("proCostClassifyCountCtrl",e),e.$inject=["$location","projectCostCountSvc","adminSvc","$state","$http"]}(),function(){"use strict";function e(e,t,i,o,n,a,r){var s=this;s.title="项目评审费统计",s.model={},s.model.beginTime=(new Date).halfYearAgo(),s.model.endTime=(new Date).Format("yyyy-MM-dd"),s.proCostClassifyCountList=function(){o.go("proCostClassifyCountList")},s.proCostCount=function(){t.projectCostTotal(s,function(e){s.projectReviewCostDtoList=e.reObj.projectReviewCostDtoList})},s.queyCostWindow=function(e){a.initReview(e.businessId,"",function(e){s.titleName="专家评审费",s.expertReview=e,s.reviewTitle=e.reviewTitle,s.payDate=e.payDate,s.businessId=s.expertReview.businessId,s.expertSelectedDtoList=e.expertSelectedDtoList,s.expertSelectedDtoList&&0<s.expertSelectedDtoList.length?(s.showReviewCost=!0,$("#expertCostWindow").kendoWindow({width:"70%",height:"600px;",title:s.titleName,visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()):r.alert("没有专家")})},s.costExportExcel=function(){var e=s.reviewTitle+"("+s.payDate+")";t.exportExcel(s,s.businessId,e)},s.formReset=function(){s.model={}},i.initSignList(function(e){(e.flag||"ok"==e.reCode)&&(s.orgDeptList=e.reObj)}),t.projectCostTotal(s,function(e){s.projectReviewCostDtoList=e.reObj.projectReviewCostDtoList})}angular.module("app").controller("projectCostCountCtrl",e),e.$inject=["$location","projectCostCountSvc","adminSvc","$state","$http","expertReviewSvc","bsWin"]}(),function(){"use strict";function e(n){rootPath;return{grid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expertReview/findByOData",$("#searchform")),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10}),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.signid)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"expretCount",title:"姓名",width:100,filterable:!1},{field:"expretCount",title:"身份证号",width:100,filterable:!1},{field:"expretCount",title:"开户行",width:80,filterable:!1},{field:"expretCount",title:"银行账号",width:120,filterable:!1},{field:"reviewCost",title:"评审费（元）",width:160,filterable:!1},{field:"reviewTaxes",title:"应缴税",width:120,filterable:!1},{field:"reviewTitle",title:"项目名称",width:160,filterable:!1},{field:"reviewDate",title:"评审时间",width:160,filterable:!1},{field:"reviewDate",title:"函评时间",width:120,filterable:!1},{field:"reviewDate",title:"负责人",width:120,filterable:!1},{field:"",title:"操作",width:100,template:function(e){return common.format($("#columnBtns").html(),e.signid)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})},resizable:!0}},projectCostTotal:function(e,t){var i={method:"post",url:rootPath+"/expertSelected/projectCostTotal",data:e.model};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},projectCostClassifyCout:function(e,t){var i={method:"post",url:rootPath+"/expertSelected/proCostClassifyTotal?page="+e.page,data:e.model};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},excelExport:function(e,t,i){var o={method:"post",url:rootPath+"/expertSelected/excelExport",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",responseType:"arraybuffer",data:angular.toJson(t),params:{fileName:i}};common.http({vm:e,$http:n,httpOptions:o,success:function(e){i+=".xls";common.downloadReport(e.data,i,"vnd.ms-excel")}})},exportExcel:function(e,t,i){var i=escape(encodeURIComponent(i));window.open(rootPath+"/financialManager/costExportExcel?fileName="+i+"&businessId="+t)}}}angular.module("app").factory("projectCostCountSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,i,o){var n,a,r,s,l=this;function c(e,t){var i,o,n;try{i=e.toString().split(".")[1].length}catch(e){i=0}try{o=t.toString().split(".")[1].length}catch(e){o=0}return(e*(n=Math.pow(10,Math.max(i,o)))+t*n)/n}function d(){l.total.projectcount=0,l.total.declarevalue=0,l.total.authorizevalue=0,l.total.ljhj=0,l.total.hjl=0,l.protReviewConditionList.forEach(function(e,t){null!=e.proCount&&(l.total.projectcount+=e.proCount),null!=e.declareValue&&(l.total.declarevalue=c(l.total.declarevalue,e.declareValue)),null!=e.authorizeValue&&(l.total.authorizevalue=c(l.total.authorizevalue,e.authorizeValue)),null!=e.ljhj&&(l.total.ljhj=c(l.total.ljhj,e.ljhj))}),l.total.hjl=Math.round(l.total.ljhj/l.total.declarevalue*1e4)/100}l.title="项目评审情况统计",l.model={},l.total={},l.proReviewConCount=function(){if(null!=l.model.beginTime&&""!=l.model.beginTime){var e=l.model.beginTime.split("-");l.year=e[0],l.begMonth=e[1],"0"==l.begMonth.charAt(0)&&(l.begMonth=l.begMonth.charAt(1))}if(null!=l.model.endTime&&""!=l.model.endTime){e=l.model.endTime.split("-");l.year=e[0],l.endMonth=e[1],"0"==l.endMonth.charAt(0)&&(l.endMonth=l.endMonth.charAt(1))}t.proReviewConCount(l,function(e){l.protReviewConditionList=e.reObj.protReviewConditionList,d()})},l.formReset=function(){l.model={}},l.isBeginTime=function(){l.byear=l.model.beginTime.split("-")[0],l.begMonth=l.model.beginTime.split("-")[1],l.endMonth=l.model.endTime.split("-")[1],l.year=l.model.endTime.split("-")[0]},n=new Date,a=n.getFullYear(),r=n.getMonth()+1,s=n.getDate(),r=r<10?"0"+r:r,l.model.beginTime=a.toString()+"-01",l.model.endTime=a.toString()+"-"+r.toString(),l.year=a,l.begMonth="1",l.endMonth=r,l.begDay="31",l.endDay=s,t.proReviewConCount(l,function(e){l.protReviewConditionList=e.reObj.protReviewConditionList,d()})}angular.module("app").controller("proReviewConditionCtrl",e),e.$inject=["$location","proReviewConditionSvc","$state","$http"]}(),function(){"use strict";function e(o){return{proReviewConCount:function(e,t){var i={method:"post",url:rootPath+"/expertSelected/proReviewConditionCount",data:e.model};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}}}angular.module("app").factory("proReviewConditionSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t){var i=this;i.title="",i.changePwd=function(){t.changePwd(i)}}angular.module("app").controller("homeCtrl",e),e.$inject=["$location","homeSvc"]}(),function(){"use strict";function e(i){var o=rootPath+"/account/password";return{changePwd:function(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0;var e={method:"put",url:o,params:{password:t.model.password}};common.http({vm:t,$http:i,httpOptions:e,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})}})}}}}angular.module("app").factory("homeSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(t,e){var n=this;n.header={},n.id="",n.create=function(e){e&&(n.header.id=e,n.isUpdate=!0,t.getHeaderById(n,e)),n.header={},$("#addHeaderWindow").kendoWindow({width:"500px",height:"300px",title:"新建表字段",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()},n.save=function(){t.createHeader(n)},n.queryUser=function(){n.gridOptions.dataSource._skip=0,n.gridOptions.dataSource.read()},n.del=function(e){t.deleteHeader(n,e)},n.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:n,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");n.del(o)}},n.update=function(){t.updateHeader(n)},t.headerGrid(n)}angular.module("app").controller("headerCtrl",e),e.$inject=["headerSvc","bsWin"]}(),function(){"use strict";function e(o,n){return{headerGrid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/header/findAllHeader",$("#headerForm")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"},modifiedDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"headerName",title:"列名",width:100,filterable:!1},{field:"headerKey",title:"key值",width:100,filterable:!1},{field:"headerType",title:"类型",width:100,filterable:!1},{field:"",title:"操作",width:140,template:function(e){return common.format($("#columnBtns").html(),"vm.del('"+e.id+"')","vm.create('"+e.id+"')")}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})},resizable:!0}},createHeader:function(t){common.initJqValidation();$("form").valid();if(null!=t.header.headerKey&&null!=t.header.headerName&&null!=t.header.headerType){var e={method:"post",url:rootPath+"/header/createHeader",data:t.header};common.http({vm:t,$http:o,httpOptions:e,success:function(e){e.data.flag||"ok"==e.data.reCode?n.success("操作成功！",function(){window.parent.$("#addHeaderWindow").data("kendoWindow").close(),t.gridOptions.dataSource.read()}):n.error(e.data.reMsg)}})}},findHeaderListNoSelected:i,updateSelectedHeader:a,updateCancelHeader:r,findHeaderListSelected:s,deleteHeader:function(t,e){var i={method:"delete",url:rootPath+"/header",params:{id:e}};common.http({vm:t,$http:o,httpOptions:i,success:function(e){n.success("删除成功！"),t.gridOptions.dataSource.read()}})},getHeaderById:function(t,e){var i={method:"get",url:rootPath+"/header/getHeaderById",params:{id:e}};common.http({vm:t,$http:o,httpOptions:i,success:function(e){t.header=e.data}})},updateHeader:function(t){common.initJqValidation();$("form").valid();if(null!=t.header.headerKey&&null!=t.header.headerName&&null!=t.header.headerType){var e={method:"put",url:rootPath+"/header/updateHeader",data:t.header};common.http({vm:t,$http:o,httpOptions:e,success:function(e){e.data.flag||"ok"==e.data.reCode?n.success("修改成功!",function(){window.parent.$("#addHeaderWindow").data("kendoWindow").close(),t.gridOptions.dataSource.read()}):n.error(e.data.reMsg)}})}},selectHeaderWindow:function(n,e){i(n),s(n,function(e){n.selectedHeaderList=e,n.header=!0}),$("#selectHeaderWindow").kendoWindow({width:"860px",height:"500px",title:"自定义报表",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open(),n.headerType=e,n.allChecked=function(){var e=$("#selectHeaderForm").find("input");$.each(e,function(e,t){t.checked=!0})},n.allCancel=function(){var e=$("#selectHeaderForm").find("input");$.each(e,function(e,t){t.checked=!1})},n.addHeader=function(){for(var e=[],t=0;t<n.allHeaderList.length;t++){var i={};n.allHeaderList[0].checkbox&&(t=0),(i=n.allHeaderList[t]).checkbox&&(e.push(i.id),n.selectedHeaderList.push(i),n.allHeaderList.splice(t,1),t=0,i.checkbox=!1)}var o=e.join(",");a(n,o)},n.cancelHeader=function(){for(var e=[],t=0;t<n.selectedHeaderList.length;t++){var i={};n.selectedHeaderList[0].checkbox&&(t=0),(i=n.selectedHeaderList[t]).checkbox&&(e.push(i.id),n.allHeaderList.push(i),n.selectedHeaderList.splice(t,1),t=0,i.checkbox=!1)}var o=e.join(",");r(n,o)},n.moveUp=function(e){0!=e&&(n.selectedHeaderList=t(n.selectedHeaderList,e,e-1))},n.moveDown=function(e){e!=n.selectedHeaderList.length-1&&(n.selectedHeaderList=t(n.selectedHeaderList,e,e+1))};var t=function(e,t,i){return e[t]=e.splice(i,1,e[t])[0],e};n.changeType=function(){i(n),n.selectedHeaderList=[]},$("#selectHeaderWindow").data("kendoWindow").center().wrapper.find(".k-i-close").click(function(e){var t,i;t=n.selectedHeaderList,i={method:"post",url:rootPath+"/header/headOrder",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(t)},common.http({$http:o,httpOptions:i,success:function(e){}})})}};function a(e,t){var i={method:"put",url:rootPath+"/header/updateSelectedHeader",params:{idStr:t}};common.http({vm:e,$http:o,httpOptions:i,success:function(e){}})}function r(e,t){var i={method:"put",url:rootPath+"/header/updateCancelHeader",params:{idStr:t}};common.http({vm:e,$http:o,httpOptions:i,success:function(e){}})}function i(t){t.header={},t.header.headerType=t.headerType;var e={method:"post",url:rootPath+"/header/findHeaderListNoSelected",data:t.header};common.http({vm:t,$http:o,httpOptions:e,success:function(e){t.allHeaderList=e.data}})}function s(e,t){e.header={},e.header.headerType=e.headerType;var i={method:"post",url:rootPath+"/header/findHeaderListSelected",data:e.header};common.http({vm:e,$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}}angular.module("app").factory("headerSvc",e),e.$inject=["$http","bsWin"]}(),function(){"use strict";function e(n,e){var a=this;a.selectedHeaderList=[],a.selectList={},a.headerType=e.params.headerType,a.allChecked=function(){var e=$("#selectHeaderForm").find("input");$.each(e,function(e,t){t.checked=!0})},a.allCancel=function(){var e=$("#selectHeaderForm").find("input");$.each(e,function(e,t){t.checked=!1})},a.addHeader=function(){for(var e=[],t=0;t<a.allHeaderList.length;t++){var i=a.allHeaderList[t];i.checkbox&&(e.push(i.id),a.selectedHeaderList.push(i),a.allHeaderList.splice(t,1),t=0,i.checkbox=!1)}var o=e.join(",");n.updateSelectedHeader(a,o)},a.cancelHeader=function(){for(var e=[],t=0;t<a.selectedHeaderList.length;t++){var i=a.selectedHeaderList[t];i.checkbox&&(e.push(i.id),a.allHeaderList.push(i),a.selectedHeaderList.splice(t,1),t=0,i.checkbox=!1)}var o=e.join(",");n.updateCancelHeader(a,o)},a.changeType=function(){n.findHeaderListNoSelected(a),a.selectedHeaderList=[]},n.findHeaderListNoSelected(a),n.findHeaderListSelected(a,function(e){a.selectedHeaderList=e,a.header=!0})}angular.module("app").controller("headerEditCtrl",e),e.$inject=["headerSvc","$state"]}(),function(){"use strict";function e(a,e,n){return{initFlowData:function(i){var e={};if(null!=i.flow){var t=i.flow.processInstanceId;(angular.isUndefined(i.flow.hideFlowImg)||0==i.flow.hideFlowImg)&&(i.picture=rootPath+"/flow/processInstance/img/"+t),e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/flow/processInstance/history/"+t),schema:common.kendoGridConfig().schema({id:"id"}),rowNumber:!0,headerCenter:!0})}i.historygrid={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:[{field:"",title:"序号",template:"<span class='row-number'></span>",width:50},{field:"nodeNameValue",title:"环节名称",width:120,filterable:!1},{field:"displayName",title:"处理人",width:80,filterable:!1},{field:"startTime",title:"开始时间",width:120,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"endTime",title:"结束时间",width:120,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"durationStr",title:"处理时长",width:120,filterable:!1},{field:"message",title:"处理信息",width:300,filterable:!1}],resizable:!0,dataBound:function(){var t=this.items();$(t).each(function(e){e==t.length-1&&o(i),$(this).find(".row-number").html(e+1)})}}},getFlowInfo:function(e,t,i){var o={method:"post",url:rootPath+"/flow/processInstance/flowNodeInfo",params:{taskId:e,processInstanceId:t}};common.http({$http:a,httpOptions:o,success:function(e){null!=i&&"function"==typeof i&&i(e.data)}})},commit:function(e,t,i){if(common.initJqValidation($("#flow_form")),$("#flow_form").valid()){!0;var o={method:"post",url:rootPath+"/flow/commit",data:t};common.http({$http:a,httpOptions:o,success:function(e){!1,null!=i&&"function"==typeof i&&i(e.data)},onError:function(e){!1}})}},rollBackToLast:function(e,t,i){!0;var o={method:"post",url:rootPath+"/flow/rollbacklast",data:e};common.http({$http:a,httpOptions:o,success:function(e){!1,null!=i&&"function"==typeof i&&i(e.data)},onError:function(e){!1}})},rollBack:function(t){var e={method:"post",url:rootPath+"/flow/rollbacklast",data:t.flow};common.http({vm:t,$http:a,httpOptions:e,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:e.data.reMsg})}})}})},initBackNode:o,suspendFlow:function(t,e){var i={method:"post",url:rootPath+"/flow/suspend/"+e,data:t.projectStop};common.http({vm:t,$http:a,httpOptions:i,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:e.data.reMsg,closeDialog:!0,fn:function(){"error"==e.data.reCode?t.isCommit=!1:(window.parent.$("#spwindow").data("kendoWindow").close(),t.gridOptions.dataSource.read())}})}})},onError:function(){t.isCommit=!1}})},activeFlow:function(t,e){t.isCommit=!0;var i={method:"post",url:rootPath+"/flow/active/"+e};common.http({vm:t,$http:a,httpOptions:i,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:e.data.reMsg,closeDialog:!0,fn:function(){"error"==e.data.reCode?t.isCommit=!1:t.gridOptions.dataSource.read()}})}})},onError:function(){t.isCommit=!1}})},deleteFlow:function(e,t,i){if(e){var o={method:"post",url:rootPath+"/flow/deleteFLow",params:{processInstanceId:e,comment:t}};common.http({$http:a,httpOptions:o,success:function(e){null!=i&&"function"==typeof i&&i(e.data)}})}else n.alert("获取流程实例失败！")},historyData:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/flow/processInstance/history/"+e.instanceId),schema:common.kendoGridConfig().schema({id:"hctId"}),rowNumber:!0,headerCenter:!0});e.historygrid={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:[{field:"",title:"序号",template:"<span class='row-number'></span>",width:50},{field:"nodeNameValue",title:"环节名称",width:"20%",filterable:!1},{field:"displayName",title:"处理人",width:"15%",filterable:!1},{field:"startTime",title:"开始时间",width:"15%",filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"endTime",title:"结束时间",width:"15%",filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"durationStr",title:"处理时长",width:"15%",filterable:!1},{field:"message",title:"处理信息",width:"20%",filterable:!1}],resizable:!0,dataBound:function(){var e=this.items();$(e).each(function(e){$(this).find(".row-number").html(e+1)})}}},transTask:function(e,t,i,o){var n={method:"post",url:rootPath+"/flow/taskTransferAssignee",params:{taskId:e,oldUserId:t,newUserId:i}};common.http({$http:a,httpOptions:n,success:function(e){null!=o&&"function"==typeof o&&o(e.data)}})}};function o(e){e.backNode=[];for(var t=e.historygrid.dataSource.data(),i=t.length,o=0;o<i;o++)t[o].assignee&&t[o].endTime&&e.backNode.push({activitiId:t[o].activityId,activitiName:t[o].activityName,assignee:t[o].assignee})}}angular.module("app").factory("flowSvc",e),e.$inject=["$http","$state","bsWin"]}(),function(){"use strict";function e(t,i,o,n,u,a,r,s,l,c,d,m,p,f,h,g,v){var y=this;y.title="待办任务处理",y.businessKey=n.params.businessKey,y.processKey=n.params.processKey,y.taskId=n.params.taskId,y.instanceId=n.params.instanceId,y.currentFlow,y.showFlag={businessNext:!1,businessTr:!1,tabSysFile:!1},function(){$("#myTab li").click(function(e){var t=$("a",this);e.preventDefault(),t.tab("show");var i=t.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500)}),y.picture=rootPath+"/flow/processInstance/img/"+y.instanceId,r.historyData(y),r.getFlowInfo(y.taskId,y.instanceId,function(e){if(y.flow=e,y.flow.taskId)if(y.currentFlow=e,y.flow.end)y.showFlag.nodeNext=!1;else switch(y.processKey){case flowcommon.getFlowDefinedKey().TOPIC_FLOW:a.initFlowNode(y.flow,y.showFlag,y)}else u.alert("该任务已处理！",function(){n.go("gtasks")})});var e=0;switch(y.processKey){case flowcommon.getFlowDefinedKey().TOPIC_FLOW:a.initFlowDeal(y),e=1;break;case flowcommon.getFlowDefinedKey().ASSERT_STORAGE_FLOW:c.initFlowDeal(y),e=1;break;case flowcommon.getFlowDefinedKey().BOOKS_BUY_FLOW:s.initFlowDeal(y),e=1;break;case flowcommon.getFlowDefinedKey().PROJECT_STOP_FLOW:d.initFlowDeal(y),e=2;break;case flowcommon.getFlowDefinedKey().FLOW_ARCHIVES:y.minDate=(new Date).Format("yyyy-MM-dd"),m.initFlowDeal(y),e=1;break;case flowcommon.getFlowDefinedKey().FLOW_APPRAISE_REPORT:p.initFlowDeal(y);break;case flowcommon.getFlowDefinedKey().FLOW_SUPP_LETTER:f.initFlowDeal(y),e=2;break;case flowcommon.getFlowDefinedKey().MONTHLY_BULLETIN_FLOW:h.initFlowDeal(y),e=1;break;case flowcommon.getFlowDefinedKey().ANNOUNT_MENT_FLOW:g.initFlowDeal(y),e=1;break;case flowcommon.getFlowDefinedKey().WORK_HIS_FLOW:v.initFlowDeal(y,t,!0)}1==e?o.findByMianId(y.businessKey,function(e){e&&0<e.length&&(y.showFlag.tabSysFile=!0,y.sysFileList=e,o.initZtreeClient(y,t))}):2==e&&o.findByBusinessId(y.businessKey,function(e){e&&0<e.length&&(y.showFlag.tabSysFile=!0,y.sysFileList=e,o.initZtreeClient(y,t))});i.initIdea(y)}(),y.initFileUpload=function(e,t,i){y.sysFile={businessId:y.businessKey,mainId:y.businessKey,mainType:e,sysfileType:t,sysBusiType:i},o.initUploadOptions({inputId:"sysfileinput",vm:y})},y.commonDownloadSysFile=function(e){o.downloadFile(e)},y.ideaEdit=function(e){angular.isObject(e)||(e={}),i.initIdeaData(y,e)},y.selectedIdea=function(){y.flow.dealOption=y.chooseIdea},y.commitFlow=function(){y.flow.isSuspended?u.error("该流程目前为暂停状态，不能进行流转操作！"):r.commit(y.isCommit,y.flow,function(e){e.flag||"ok"==e.reCode?u.success("操作成功！",function(){n.go("agendaTasks")}):u.alert(e.reMsg)})},y.backFlow=function(){common.initJqValidation($("#flow_form")),$("#flow_form").valid()&&u.confirm({title:"询问提示",message:"确认回退吗？",onOk:function(){r.rollBackToLast(y.flow,y.isCommit,function(e){y.isCommit=!1,e.flag||"ok"==e.reCode?u.alert("回退成功！",function(){n.go("agendaTasks")}):u.alert(e.reMsg)})}})},y.editSelectExpert=function(i){y.scoreExpert={},$.each(y.model.expertReviewDto.expertSelectedDtoList,function(e,t){t.id!=i||(y.scoreExpert=angular.copy(t))}),$("#star_"+y.scoreExpert.id).raty({number:5,score:function(){return $(this).attr("data-num",angular.isUndefined(y.scoreExpert.score)?0:y.scoreExpert.score),$(this).attr("data-num")},starOn:"../contents/libs/raty/lib/images/star-on.png",starOff:"../contents/libs/raty/lib/images/star-off.png",starHalf:"../contents/libs/raty/lib/images/star-half.png",readOnly:!1,halfShow:!0,hints:["不合格","合格","中等","良好","优秀"],size:34,click:function(e,t){y.scoreExpert.score=e}}),$("#score_win").kendoWindow({width:"820px",height:"365px",title:"编辑-专家星级",visible:!1,modal:!0,closable:!0,actions:["Close"]}).data("kendoWindow").center().open()},y.closeEditMark=function(){window.parent.$("#score_win").data("kendoWindow").close()},y.saveMark=function(){y.scoreExpert.score&&0!=y.scoreExpert.score?l.saveMark(y.scoreExpert,function(e){e.flag||"ok"==e.reCode?(angular.forEach(y.model.expertReviewDto.expertSelectedDtoList,function(e,t){e.id==y.scoreExpert.id&&(e.score=y.scoreExpert.score,e.describes=y.scoreExpert.describes)}),u.success("保存成功！",function(){y.closeEditMark()})):u.alert(e.reMsg)}):u.alert("请对专家进行评分！")},y.affirmJoinExpert=function(){y.model.expertReviewDto&&y.model.expertReviewDto.expertSelectedDtoList?(y.confirmEPList=y.model.expertReviewDto.expertSelectedDtoList,$("#confirmJoinExpert").kendoWindow({width:"75%",height:"600px",title:"参加评审会专家确认",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()):u.alert("该项目没有评审专家！")},y.updateToJoin=function(){var e=$("#notJoinExpertTable input[name='notJoinExpert']:checked");if(e.length<1)u.alert("请选择要改为参加会议的专家");else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);l.updateJoinState(y.expertReviewDto.id,"","",t.join(","),"9",y.isCommit,function(e){e.flag||"ok"==e.reCode?(y.reFleshJoinState(t,"9"),u.success("操作成功！")):u.success(e.reMsg)})}},y.updateToNotJoin=function(){var e=$("#joinExpertTable input[name='joinExpert']:checked");if(e.length<1)u.alert("请选择未参加会议的专家");else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);l.updateJoinState(y.expertReviewDto.id,"","",t.join(","),"0",y.isCommit,function(e){e.flag||"ok"==e.reCode?(y.reFleshJoinState(t,"0"),u.success("操作成功！")):u.success(e.reMsg)})}},y.reFleshJoinState=function(e,o){$.each(e,function(e,i){$.each(y.confirmEPList,function(e,t){i==t.id&&(t.isJoin=o)})}),l.refleshBusinessEP(y.model.workPlanDto.id,function(e){y.model.workPlanDto.expertDtoList=e})},y.countTaxes=function(d){if(null!=d)if(null!=d.payDate){if(/^(\d{4}-\d{1,2}-\d{1,2})$/.exec(d.payDate))if(null!=d.expertSelectedDtoList&&0!=d.expertSelectedDtoList.length)common.initJqValidation($("#payform")),$("#payform").valid()?u.confirm({title:"询问提示",message:"确认提交么？提交之后不可修改，请核对正确。",onOk:function(){l.savePayment(d,y.isCommit,!0,function(e){if(e.flag||"ok"==e.reCode){for(var t=e.reObj,i=0,o=0,n=0,a=d.expertSelectedDtoList.length;n<a;n++){var r=d.expertSelectedDtoList[n];if(!("9"!=r.isConfrim&&9!=r.isConfrim||"9"!=r.isJoin&&9!=r.isJoin))for(var s=0,l=t.length;s<l;s++){var c=t[s].EXPERTID;r.expertDto.expertID==c&&(r.reviewTaxes=parseFloat(null==t[s].MONTAXES?0:t[s].MONTAXES).toFixed(2),r.totalCost=(parseFloat(r.reviewCost)+parseFloat(r.reviewTaxes)).toFixed(2),i=parseFloat(i)+parseFloat(r.reviewCost),o=parseFloat(o)+parseFloat(r.reviewTaxes))}}d.reviewCost=parseFloat(i).toFixed(2),d.reviewTaxes=parseFloat(o).toFixed(2),d.totalCost=(parseFloat(i)+parseFloat(o)).toFixed(2),u.alert("操作成功！",function(){y.isCommit=!1,d.state="9"})}else u.alert(e.reMsg)})}}):u.alert("请正确填写专家评审费信息！");else u.alert("该方案还没评审专家");else u.alert("请输入正确的日期格式")}else u.alert("请选择评审费发放日期")},y.savePayment=function(d){null!=d&&(null!=d.expertSelectedDtoList&&0!=d.expertSelectedDtoList.length?(common.initJqValidation($("#payform")),$("#payform").valid()?l.savePayment(d,y.isCommit,!1,function(e){if(e.flag||"ok"==e.reCode){for(var t=e.reObj,i=0,o=0,n=0,a=d.expertSelectedDtoList.length;n<a;n++){var r=d.expertSelectedDtoList[n];if(!("9"!=r.isConfrim&&9!=r.isConfrim||"9"!=r.isJoin&&9!=r.isJoin))for(var s=0,l=t.length;s<l;s++){var c=t[s].EXPERTID;r.expertDto.expertID==c&&(r.reviewTaxes=parseFloat(null==t[s].MONTAXES?0:t[s].MONTAXES).toFixed(2),r.totalCost=(parseFloat(r.reviewCost)+parseFloat(r.reviewTaxes)).toFixed(2),i=parseFloat(i)+parseFloat(r.reviewCost),o=parseFloat(o)+parseFloat(r.reviewTaxes))}}d.reviewCost=parseFloat(i).toFixed(2),d.reviewTaxes=parseFloat(o).toFixed(2),d.totalCost=(parseFloat(i)+parseFloat(o)).toFixed(2),u.alert("操作成功！",function(){y.isCommit=!1})}else u.alert(e.reMsg)}):u.alert("请正确填写专家评审费信息！")):u.alert("该方案还没有选择评审专家，请先选取评审专家！"))},y.closeEditPay=function(){window.parent.$("#payment").data("kendoWindow").close()},y.editUnitScore=function(e){$("#star").raty({number:5,score:function(){return $(this).attr("data-num",angular.isUndefined(y.model.unitScoreDto.score)?0:y.model.unitScoreDto.score),$(this).attr("data-num")},starOn:"../contents/libs/raty/lib/images/star-on.png",starOff:"../contents/libs/raty/lib/images/star-off.png",starHalf:"../contents/libs/raty/lib/images/star-half.png",readOnly:!1,halfShow:!0,hints:["不合格","合格","中等","良好","优秀"],size:34,click:function(e,t){y.model.unitScoreDto.score=e}}),$("#unitscore_win").kendoWindow({width:"820px",height:"365px",title:"编辑-单位星级",visible:!1,modal:!0,closable:!0,actions:["Close"]}).data("kendoWindow").center().open()},y.saveUnit=function(){y.model.unitScoreDto.score&&0!=y.model.unitScoreDto.score?companySvc.saveUnit(y.model.unitScoreDto,function(e){e.flag||"ok"==e.reCode?u.success("保存成功！",function(){y.closeEditUnit()}):u.alert(e.reMsg)}):u.alert("请对单位进行评分！")},y.closeEditUnit=function(){window.parent.$("#unitscore_win").data("kendoWindow").close()},y.updateFlow=function(){common.initJqValidation(),$("form").valid()?h.updatemonthlyMultiyear(y.suppletter,function(e){e.flag||"ok"==e.reCode?y.commitFlow():u.error(e.reMsg)}):u.alert("缺少部分没有填写，请仔细检查")},y.isTime=function(){""!=y.model.readDate&&null!=y.model.readDate&&y.flow.businessMap.RETURNDATE<y.model.readDate&&u.alert("归还时间不能小于查阅时间",function(){y.flow.businessMap.RETURNDATE=y.model.readDate,t.$apply()})}}angular.module("app").controller("flowDealCtrl",e),e.$inject=["$scope","ideaSvc","sysfileSvc","$state","bsWin","topicSvc","flowSvc","bookBuyBusinessSvc","expertReviewSvc","assertStorageBusinessSvc","pauseProjectSvc","archivesLibrarySvc","reviewProjectAppraiseSvc","addSuppLetterSvc","monthlyMultiyearSvc","annountmentSvc","workprogramSvc"]}(),function(){"use strict";function e(t,e,i,o,n,a,r,s,l,c,d,u,m,p){var f=this;f.title="在办任务详情页",f.businessKey=e.params.businessKey,f.processKey=e.params.processKey,f.taskId=e.params.taskId,f.instanceId=e.params.instanceId,f.showFlag={businessNext:!1,businessTr:!1,tabSysFile:!1,buttBack:!1},function(){$("#myTab li").click(function(e){var t=$("a",this);e.preventDefault(),t.tab("show");var i=t.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500)}),f.taskId&&(f.picture=rootPath+"/flow/processInstance/img/"+f.instanceId);o.historyData(f);var e=0;switch(f.processKey){case flowcommon.getFlowDefinedKey().TOPIC_FLOW:o.getFlowInfo(f.taskId,f.instanceId,function(e){if(f.flow=e,f.flow.taskId)if(f.currentFlow=e,f.flow.end)f.showFlag.nodeNext=!1;else switch(f.processKey){case flowcommon.getFlowDefinedKey().TOPIC_FLOW:i.initFlowNode(f.flow,f.showFlag,f)}}),i.initFlowDeal(f),e=1;break;case flowcommon.getFlowDefinedKey().BOOKS_BUY_FLOW:a.initFlowDeal(f),e=1;break;case flowcommon.getFlowDefinedKey().ASSERT_STORAGE_FLOW:r.initFlowDeal(f);break;case flowcommon.getFlowDefinedKey().PROJECT_STOP_FLOW:s.initFlowDeal(f),e=2;break;case flowcommon.getFlowDefinedKey().FLOW_ARCHIVES:l.initFlowDeal(f),e=1;break;case flowcommon.getFlowDefinedKey().FLOW_APPRAISE_REPORT:c.initFlowDeal(f),e=1;break;case flowcommon.getFlowDefinedKey().FLOW_SUPP_LETTER:d.initFlowDeal(f),e=2;break;case flowcommon.getFlowDefinedKey().MONTHLY_BULLETIN_FLOW:u.initFlowDeal(f),e=1;break;case flowcommon.getFlowDefinedKey().ANNOUNT_MENT_FLOW:m.initFlowDeal(f),f.parentLink="#annountment",f.parentName="通知公告管理",f.title="通知公告审批信息",e=1;break;case flowcommon.getFlowDefinedKey().WORK_HIS_FLOW:p.initFlowDeal(f,t,!1)}1==e?n.findByMianId(f.businessKey,function(e){e&&0<e.length&&(f.showFlag.tabSysFile=!0,f.sysFileList=e,n.initZtreeClient(f,t))}):2==e&&n.findByBusinessId(f.businessKey,function(e){e&&0<e.length&&(f.showFlag.tabSysFile=!0,f.sysFileList=e,n.initZtreeClient(f,t))})}()}angular.module("app").controller("flowDetailCtrl",e),e.$inject=["$scope","$state","topicSvc","flowSvc","sysfileSvc","bookBuyBusinessSvc","assertStorageBusinessSvc","pauseProjectSvc","archivesLibrarySvc","reviewProjectAppraiseSvc","addSuppLetterSvc","monthlyMultiyearSvc","annountmentSvc","workprogramSvc"]}(),function(){"use strict";function e(t,e,i,o,n,a,r,s,l,c,d){var u=this;u.title="待办任务处理",u.businessKey=e.params.businessKey,u.processKey=e.params.processKey,u.instanceId=e.params.instanceId,u.showFlag={businessNext:!1,businessTr:!1,tabSysFile:!1,buttBack:!1},function(){switch($("#myTab li").click(function(e){var t=$("a",this);e.preventDefault(),t.tab("show");var i=t.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500)}),o.historyData(u),u.processKey){case flowcommon.getFlowDefinedKey().TOPIC_FLOW:i.initFlowDeal(u);break;case flowcommon.getFlowDefinedKey().BOOKS_BUY_FLOW:a.initFlowDeal(u);break;case flowcommon.getFlowDefinedKey().ASSERT_STORAGE_FLOW:r.initFlowDeal(u);break;case flowcommon.getFlowDefinedKey().PROJECT_STOP_FLOW:s.initFlowDeal(u);break;case flowcommon.getFlowDefinedKey().FLOW_ARCHIVES:l.initFlowDeal(u);break;case flowcommon.getFlowDefinedKey().FLOW_APPRAISE_REPORT:c.initFlowDeal(u);break;case flowcommon.getFlowDefinedKey().FLOW_SUPP_LETTER:d.initFlowDeal(u)}n.findByMianId(u.businessKey,function(e){e&&0<e.length&&(u.showFlag.tabSysFile=!0,u.sysFileList=e,u.urlType="flowEnd",n.initZtreeClient(u,t))})}()}angular.module("app").controller("flowEndCtrl",e),e.$inject=["$scope","$state","topicSvc","flowSvc","sysfileSvc","bookBuyBusinessSvc","assertStorageBusinessSvc","pauseProjectSvc","archivesLibrarySvc","reviewProjectAppraiseSvc","addSuppLetterSvc"]}(),function(){"use strict";var e={SIGN_ZR:"SIGN_ZR",SIGN_QS:"SIGN_QS",SIGN_ZHB:"SIGN_ZHB",SIGN_FGLD_FB:"SIGN_FGLD_FB",SIGN_BMFB1:"SIGN_BMFB1",SIGN_BMFB2:"SIGN_BMFB2",SIGN_BMFB3:"SIGN_BMFB3",SIGN_BMFB4:"SIGN_BMFB4",SIGN_XMFZR1:"SIGN_XMFZR1",SIGN_XMFZR2:"SIGN_XMFZR2",SIGN_XMFZR3:"SIGN_XMFZR3",SIGN_XMFZR4:"SIGN_XMFZR4",SIGN_BMLD_SPW1:"SIGN_BMLD_SPW1",SIGN_BMLD_SPW2:"SIGN_BMLD_SPW2",SIGN_BMLD_SPW3:"SIGN_BMLD_SPW3",SIGN_BMLD_SPW4:"SIGN_BMLD_SPW4",SIGN_FGLD_SPW1:"SIGN_FGLD_SPW1",SIGN_FGLD_SPW2:"SIGN_FGLD_SPW2",SIGN_FGLD_SPW3:"SIGN_FGLD_SPW3",SIGN_FGLD_SPW4:"SIGN_FGLD_SPW4",SIGN_FW:"SIGN_FW",SIGN_QRFW:"SIGN_QRFW",SIGN_BMLD_QRFW_XB:"SIGN_BMLD_QRFW_XB",SIGN_BMLD_QRFW:"SIGN_BMLD_QRFW",SIGN_FGLD_QRFW_XB:"SIGN_FGLD_QRFW_XB",SIGN_FGLD_QRFW:"SIGN_FGLD_QRFW",SIGN_ZR_QRFW:"SIGN_ZR_QRFW",SIGN_FWBH:"SIGN_FWBH",SIGN_CWBL:"SIGN_CWBL",SIGN_GD:"SIGN_GD",SIGN_DSFZR_QRGD:"SIGN_DSFZR_QRGD",SIGN_QRGD:"SIGN_QRGD"},t={TOPIC_JHTC:"TOPIC_JHTC",TOPIC_BZSH_JH:"TOPIC_BZSH_JH",TOPIC_FGLD_JH:"TOPIC_FGLD_JH",TOPIC_ZRSH_JH:"TOPIC_ZRSH_JH",TOPIC_BFGW:"TOPIC_BFGW",TOPIC_LXDW:"TOPIC_LXDW",TOPIC_QDHT:"TOPIC_QDHT",TOPIC_YJSS:"TOPIC_YJSS",TOPIC_NBCS:"TOPIC_NBCS",TOPIC_GZFA:"TOPIC_GZFA",TOPIC_BZSH_FA:"TOPIC_BZSH_FA",TOPIC_FGLD_FA:"TOPIC_FGLD_FA",TOPIC_ZRSH_FA:"TOPIC_ZRSH_FA",TOPIC_CGJD:"TOPIC_CGJD",TOPIC_KTBG:"TOPIC_KTBG",TOPIC_BZSH_BG:"TOPIC_BZSH_BG",TOPIC_FGLD_BG:"TOPIC_FGLD_BG",TOPIC_ZRSH_BG:"TOPIC_ZRSH_BG",TOPIC_KTJT:"TOPIC_KTJT",TOPIC_BZSH_JT:"TOPIC_BZSH_JT",TOPIC_FGLD_JT:"TOPIC_FGLD_JT",TOPIC_ZRSH_JT:"TOPIC_ZRSH_JT",TOPIC_YFZL:"TOPIC_YFZL",TOPIC_ZLGD:"TOPIC_ZLGD"},i={BOOK_LEADER_CGQQ:"BOOK_LEADER_CGQQ",BOOK_BZSP:"BOOK_BZSP",BOOK_FGFZRSP:"BOOK_FGFZRSP",BOOK_ZXZRSP:"BOOK_ZXZRSP",BOOK_YSRK:"BOOK_YSRK"},o={FINAL_SIGN_FLOW:"FINAL_SIGN_FLOW",TOPIC_FLOW:"TOPIC_FLOW",BOOKS_BUY_FLOW:"BOOKS_BUY_FLOW",ASSERT_STORAGE_FLOW:"ASSERT_STORAGE_FLOW",PROJECT_STOP_FLOW:"PROJECT_STOP_FLOW",FLOW_ARCHIVES:"FLOW_ARCHIVES",FLOW_APPRAISE_REPORT:"FLOW_APPRAISE_REPORT",FLOW_SUPP_LETTER:"FLOW_SUPP_LETTER",MONTHLY_BULLETIN_FLOW:"MONTHLY_BULLETIN_FLOW",ANNOUNT_MENT_FLOW:"ANNOUNT_MENT_FLOW",WORK_HIS_FLOW:"WORK_HIS_FLOW"},n={getFlowDefinedKey:function(){return o},getSignFlowNode:function(){return e},getTopicFlowNode:function(){return t},getBooksBuyFlowNode:function(){return i},getAssertStorageFlowNode:function(){return i}};window.flowcommon=n}(),function(){"use strict";function e(e,t){var i=this;i.title="日志列表",t.grid(i),i.queryLog=function(){i.gridOptions.dataSource._skip=0,i.gridOptions.dataSource.read()},i.formReset=function(){var e=$("#logform").find("input,select");$.each(e,function(e,t){t.value=""})}}angular.module("app").controller("logCtrl",e),e.$inject=["$location","logSvc"]}(),function(){"use strict";function e(e,t){return{grid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/log/fingByOData",$("#logform")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}});e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:[{field:"",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"",title:"级别",width:60,filterable:!1,template:function(e){return e.logLevel?"1"==e.logLevel?"高":"2"==e.logLevel?"中":"3"==e.logLevel?"低":void 0:"低"}},{field:"userName",title:"操作者",width:80,filterable:!1},{field:"createdDate",title:"操作时间",width:170,filterable:!1,format:"{0:yyyy/MM/dd HH:mm:ss}"},{field:"ipAdd",title:"IP地址",filterable:!1,width:130},{field:"browserInfo",title:"浏览器",filterable:!1,width:120},{field:"module",title:"操作描述",filterable:!1,width:200},{field:"",title:"结果",filterable:!1,width:80,template:function(e){return e.result?"9"==e.result?'<span class="label label-success">成功</span>':'<span class="label label-danger">失败</span>':""}},{field:"",title:"日志内容",filterable:!1,width:400,template:function(e){return"<textarea rows='4' style='width:100%;'>"+e.message+"</textarea>"}}],dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})},resizable:!0}},gridFgw:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/log/findFgwSignLog",$("#logform")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}});e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:[{field:"",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"",title:"级别",width:60,filterable:!1,template:function(e){return e.logLevel?"1"==e.logLevel?"高":"2"==e.logLevel?"中":"3"==e.logLevel?"低":void 0:"低"}},{field:"userName",title:"操作者",width:80,filterable:!1},{field:"createdDate",title:"操作时间",width:170,filterable:!1,format:"{0:yyyy/MM/dd HH:mm:ss}"},{field:"ipAdd",title:"IP地址",filterable:!1,width:130},{field:"browserInfo",title:"浏览器",filterable:!1,width:120},{field:"module",title:"操作描述",filterable:!1,width:200},{field:"",title:"结果",filterable:!1,width:80,template:function(e){return e.result?"9"==e.result?'<span class="label label-success">成功</span>':'<span class="label label-danger">失败</span>':""}},{field:"",title:"日志内容",filterable:!1,width:400,template:function(e){return"<textarea rows='4' style='width:100%;'>"+e.message+"</textarea>"}}],dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})},resizable:!0}}}}angular.module("app").factory("logSvc",e),e.$inject=["$http","$compile"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.title="委里日志列表",t.gridFgw(n),n.queryLog=function(){n.gridOptions.dataSource._skip=0,n.gridOptions.dataSource.read()},n.formReset=function(){var e=$("#logform").find("input,select");$.each(e,function(e,t){t.value=""})},n.getSignInfo=function(){var e=$("#filecode").val();""!=e&&null!=e?i.getPreSignInfo(e,"0",function(e){if(e.flag||"ok"==e.reCode){if("保存成功！"!=e.reMsg)return void o.alert(e.reMsg);o.alert("委项目获取成功！")}else o.alert(e.reMsg)}):o.alert("收文编号不能为空!")}}angular.module("app").controller("logFgwCtrl",e),e.$inject=["$location","logSvc","reserveSignSvc","bsWin"]}(),function(){"use strict";function e(e,o,n,t){var a=this;a.signid=e.params.signid,a.showExpertConfirm=!0,o.initReview(a.signid,"",function(e){e?(a.expertReviewDto=e,a.expertReviewDto&&a.expertReviewDto.expertSelectedDtoList&&(a.confirmEPList=a.expertReviewDto.expertSelectedDtoList)):a.expertReviewDto={}}),a.updateToJoin=function(){var e=$("#notJoinExpertTable input[name='notJoinExpert']:checked");if(e.length<1)n.alert("请选择要改为参加会议的专家");else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);o.updateJoinState(a.expertReviewDto.id,"","",t.join(","),"9",a.isCommit,function(e){e.flag||"ok"==e.reCode?(a.reFleshJoinState(t,"9"),n.success("操作成功！")):n.success(e.reMsg)})}},a.updateToNotJoin=function(){var e=$("#joinExpertTable input[name='joinExpert']:checked");if(e.length<1)n.alert("请选择未参加会议的专家");else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);o.updateJoinState(a.expertReviewDto.id,"","",t.join(","),"0",a.isCommit,function(e){e.flag||"ok"==e.reCode?(a.reFleshJoinState(t,"0"),n.success("操作成功！")):n.success(e.reMsg)})}},a.reFleshJoinState=function(e,o){$.each(e,function(e,i){$.each(a.confirmEPList,function(e,t){i==t.id&&(t.isJoin=o)})})}}angular.module("app").controller("maintainExpertConfirmCtrl",e),e.$inject=["$state","expertReviewSvc","bsWin","signSvc"]}(),function(){"use strict";function e(e,t,u,i){var m=this;m.signid=t.params.signid,m.showExpertPayment=!0,i.initReview(m.signid,"",function(e){m.expertReviewDto=e||{}}),m.countTaxes=function(d){if(null!=d)if(null!=d.expertSelectedDtoList&&0!=d.expertSelectedDtoList.length)if(null!=d.reviewDate){if(/^(\d{4}-\d{1,2}-\d{1,2})$/.exec(d.reviewDate))d.payDate||(d.payDate=m.curDate),common.initJqValidation($("#payform")),$("#payform").valid()?i.savePayment(d,m.isCommit,!0,function(e){if(e.flag||"ok"==e.reCode){for(var t=e.reObj,i=0,o=0,n=0,a=d.expertSelectedDtoList.length;n<a;n++){var r=d.expertSelectedDtoList[n];if(!("9"!=r.isConfrim&&9!=r.isConfrim||"9"!=r.isJoin&&9!=r.isJoin))for(var s=0,l=t.length;s<l;s++){var c=t[s].EXPERTID;r.expertDto.expertID==c&&(r.reviewTaxes=parseFloat(null==t[s].MONTAXES?0:t[s].MONTAXES).toFixed(2),r.totalCost=(parseFloat(r.reviewCost)+parseFloat(r.reviewTaxes)).toFixed(2),i=parseFloat(i)+parseFloat(r.reviewCost),o=parseFloat(o)+parseFloat(r.reviewTaxes))}}d.reviewCost=parseFloat(i).toFixed(2),d.reviewTaxes=parseFloat(o).toFixed(2),d.totalCost=(parseFloat(i)+parseFloat(o)).toFixed(2),u.alert("操作成功！",function(){m.isCommit=!1,d.state="9"})}else u.alert(e.reMsg)}):u.alert("请正确填写专家评审费信息！");else u.alert("请输入正确的日期格式")}else u.alert("(函评/评审会)日期为空，无法进行专家纳税计算，请联系系统管理员处理！");else u.alert("该方案还没有选择评审专家，请先选取评审专家！")},m.closeEditPay=function(){window.parent.$("#payment").data("kendoWindow").close()},m.savePayment=function(d){null!=d&&(null!=d.expertSelectedDtoList&&0!=d.expertSelectedDtoList.length?(common.initJqValidation($("#payform")),$("#payform").valid()?i.savePayment(d,m.isCommit,!1,function(e){if(e.flag||"ok"==e.reCode){for(var t=e.reObj,i=0,o=0,n=0,a=d.expertSelectedDtoList.length;n<a;n++){var r=d.expertSelectedDtoList[n];if(!("9"!=r.isConfrim&&9!=r.isConfrim||"9"!=r.isJoin&&9!=r.isJoin))for(var s=0,l=t.length;s<l;s++){var c=t[s].EXPERTID;r.expertDto.expertID==c&&(r.reviewTaxes=parseFloat(null==t[s].MONTAXES?0:t[s].MONTAXES).toFixed(2),r.totalCost=(parseFloat(r.reviewCost)+parseFloat(r.reviewTaxes)).toFixed(2),i=parseFloat(i)+parseFloat(r.reviewCost),o=parseFloat(o)+parseFloat(r.reviewTaxes))}}d.reviewCost=parseFloat(i).toFixed(2),d.reviewTaxes=parseFloat(o).toFixed(2),d.totalCost=(parseFloat(i)+parseFloat(o)).toFixed(2),u.alert("操作成功！",function(){m.isCommit=!1})}else u.alert(e.reMsg)}):u.alert("请正确填写专家评审费信息！")):u.alert("该方案还没有选择评审专家，请先选取评审专家！"))}}angular.module("app").controller("maintainExpertPaymentCtrl",e),e.$inject=["signSvc","$state","bsWin","expertReviewSvc"]}(),function(){"use strict";function e(e,t,i,o,n){var a=this;a.signid=o.params.signid,a.showExpertScore=!0,a.showFlag={},a.showFlag.isMainPrinUser=!0,e.initReview(a.signid,"",function(e){a.expertReviewDto=e||{}}),i.findSignUnitScore(a.signid,function(e){e&&(a.unitScoreDto=e)}),a.editSelectExpert=function(i){a.scoreExpert={},$.each(a.expertReviewDto.expertSelectedDtoList,function(e,t){t.id!=i||(a.scoreExpert=angular.copy(t))}),$("#star_"+a.scoreExpert.id).raty({number:5,score:function(){return $(this).attr("data-num",angular.isUndefined(a.scoreExpert.score)?0:a.scoreExpert.score),$(this).attr("data-num")},starOn:"../contents/libs/raty/lib/images/star-on.png",starOff:"../contents/libs/raty/lib/images/star-off.png",starHalf:"../contents/libs/raty/lib/images/star-half.png",readOnly:!1,halfShow:!0,hints:["不合格","合格","中等","良好","优秀"],size:34,click:function(e,t){a.scoreExpert.score=e}}),$("#score_win").kendoWindow({width:"820px",height:"365px",title:"编辑-专家星级",visible:!1,modal:!0,closable:!0,actions:["Close"]}).data("kendoWindow").center().open()},a.closeEditMark=function(){window.parent.$("#score_win").data("kendoWindow").close()},a.saveMark=function(){a.scoreExpert.score&&0!=a.scoreExpert.score?e.saveMark(a.scoreExpert,function(e){e.flag||"ok"==e.reCode?(angular.forEach(a.expertReviewDto.expertSelectedDtoList,function(e,t){e.id==a.scoreExpert.id&&(e.score=a.scoreExpert.score,e.describes=a.scoreExpert.describes)}),t.success("保存成功！",function(){a.closeEditMark()})):t.alert(e.reMsg)}):t.alert("请对专家进行评分！")},a.editUnitScore=function(e){$("#star").raty({number:5,score:function(){return $(this).attr("data-num",angular.isUndefined(a.unitScoreDto.score)?0:a.unitScoreDto.score),$(this).attr("data-num")},starOn:"../contents/libs/raty/lib/images/star-on.png",starOff:"../contents/libs/raty/lib/images/star-off.png",starHalf:"../contents/libs/raty/lib/images/star-half.png",readOnly:!1,halfShow:!0,hints:["不合格","合格","中等","良好","优秀"],size:34,click:function(e,t){a.unitScoreDto.score=e}}),$("#unitscore_win").kendoWindow({width:"820px",height:"365px",title:"编辑-单位星级",visible:!1,modal:!0,closable:!0,actions:["Close"]}).data("kendoWindow").center().open()},a.saveUnit=function(){a.unitScoreDto.score&&0!=a.unitScoreDto.score?n.saveUnit(a.unitScoreDto,function(e){e.flag||"ok"==e.reCode?t.success("保存成功！",function(){a.closeEditUnit()}):t.alert(e.reMsg)}):t.alert("请对单位进行评分！")},a.closeEditUnit=function(){window.parent.$("#unitscore_win").data("kendoWindow").close()}}angular.module("app").controller("maintainExpertScoreCtrl",e),e.$inject=["expertReviewSvc","bsWin","signSvc","$state","companySvc"]}(),function(){"use strict";function e(n,a,r,e,t,i,o,s){var l=this;l.work={},l.model={},l.title="评审方案编辑",l.startDateTime=new Date("2006/6/1 08:00"),l.endDateTime=new Date("2030/6/1 21:00"),l.work.signId=a.params.signid,l.work.id="",l.sign={},l.unSeledWork={},l.searchSign={},l.businessFlag={isSelfReview:!1,isSingleReview:!0,isMainWorkProj:!1,isLoadMeetRoom:!1,isReveiwAWP:!1},l.expertList=new Array(15),l.showAll=!0,n.workMaintainList(l,function(e){l.workProgramDtoList=e.WPList,"9"==e.showTotalInvestment||9==e.showTotalInvestment?l.showTotalInvestment=!0:l.showTotalInvestment=!1,l.workProgramDtoList&&0<l.workProgramDtoList.length&&angular.forEach(l.workProgramDtoList,function(e,t){e.projectTypeDicts=o.topSelectChange(e.projectType,o.DICT.PROJECTTYPE.dicts)})}),l.goBackMain=function(){a.go("MaintainProjectEdit",{signid:a.params.signid,processInstanceId:null})},l.reviewTypeChange=function(i){n.findById(i.id,function(e){if(e.expertCost&&(i.expertCost=e.expertCost),"合并评审"==e.isSigle&&"9"==e.isMainProject&&"单个评审"==i.isSigle)r.confirm({title:"询问提示",message:"该项目已关联其他项目，您确定要改为单个评审吗？",onOk:function(){n.deleteAllMerge(a.params.signid,i.id,function(e){e.flag||"ok"==e.reCode?r.alert("操作成功！",function(){a.reload("maintWorkprogramEdit",{signid:a.params.signid})}):r.error("操作失败！")})},onCancel:function(){a.reload("maintWorkprogramEdit",{signid:a.params.signid})}});else if("专家评审会"==e.reviewType&&"专家函评"==i.reviewType&&i.roomBookingDtos&&0<i.roomBookingDtos.length)r.confirm({title:"询问提示",message:"改成专家函评，预定会议室将会删除，确定修改么？",onOk:function(){n.updateReviewType(a.params.signid,i.id,i.reviewType,function(e){e.flag||"ok"==e.reCode?r.alert("操作成功！",function(){a.reload("maintWorkprogramEdit",{signid:a.params.signid})}):r.error("操作失败！")})},onCancel:function(){a.reload("maintWorkprogramEdit",{signid:a.params.signid})}});else if(("专家评审会"==e.reviewType||"专家函评"==e.reviewType)&&"自评"==i.reviewType){var t=!1;i.roomBookingDtos&&0<i.roomBookingDtos.length&&(t=!0),i.expertSelectedDtoList&&0<i.expertSelectedDtoList.length&&(t=!0),t&&r.confirm({title:"询问提示",message:"评审方式改成自评，预定会议室和抽取专家将会删除，确定修改么？",onOk:function(){n.updateReviewType(a.params.signid,i.id,i.reviewType,function(e){e.flag||"ok"==e.reCode?r.alert("操作成功！",function(){a.reload("maintWorkprogramEdit",{signid:a.params.signid})}):r.error("操作失败！")})},onCancel:function(){a.reload("maintWorkprogramEdit",{signid:a.params.signid})}})}})},l.onWorkClose=function(){window.parent.$(".workPro").data("kendoWindow").close()},l.formReset=function(){l.searchSign={}},l.filterSign=function(e){var t=!0;if(l.searchSign.projectname&&-1==e.projectname.indexOf(l.searchSign.projectname)&&(t=!1),t&&l.searchSign.reviewstage&&-1==e.reviewstage.indexOf(l.searchSign.reviewstage)&&(t=!1),t)return e},l.initMergeWP=function(t){n.findById(t.id,function(e){"合并评审"==e.isSigle&&"9"==e.isMainProject?(n.initMergeInfo(l,t.signId),$("#mergeSign").kendoWindow({width:"75%",height:"700px",title:"合并评审",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()):r.alert("请先保存工作方案！")})},l.chooseSign=function(){var e=$("input[name='mergeSign']:checked");if(0==e.length)r.alert("请选择要合并评审的项目！");else{var i=[];$.each(e,function(e,t){i.push(t.value)}),n.chooseSign(l.work.signId,i.join(","),function(e){(e.flag||"ok"==e.reCode)&&n.initMergeInfo(l,l.work.signId),r.alert(e.reMsg)})}},l.cancelSign=function(){var e=$("input[name='cancelMergeSignid']:checked");if(0==e.length)r.alert("请选择要取消合并评审的项目！");else{var i=[];$.each(e,function(e,t){i.push(t.value)})}n.cancelMergeSign(l.work.signId,i.join(","),function(e){(e.flag||"ok"==e.reCode)&&n.initMergeInfo(l,l.work.signId),r.alert(e.reMsg)})},l.addTimeStage=function(t){t?n.findById(t,function(e){"专家评审会"==e.reviewType?a.go("room",{businessId:t,businessType:"SIGN_WP"}):r.alert("请先保存工作方案！")}):r.alert("请先保存！")},l.findUsersByOrgId=function(e){n.findUsersByOrgId(l,e)},l.compare=function(e,t){var i=parseInt(e.split(":")[0]),o=parseInt(t.split(":")[0]);if(i==o){var n=parseInt(e.split(":")[1]),a=parseInt(t.split(":")[1]);l.isTime=a<n}else l.isTime=o<i},l.selectExpert=function(t,i,o){t?n.findById(t,function(e){"专家评审会"==e.reviewType||"专家函评"==e.reviewType?"专家评审会"!=i||o&&0!=o.length?"专家函评"!=i||e.letterDate?a.go("expertReviewEdit",{businessId:l.work.signId,minBusinessId:t,businessType:"SIGN",reviewType:i,isback:!0}):r.alert("请先选择函评日期并保存！"):r.alert("请先预定评审会日期！"):r.alert("请先保存工作方案！")}):r.alert("请先保存当前信息，再继续操作！")},l.printpage=function(e){var t=$(e.target).attr("id");s.workProgramPrint(t)},l.createMaintain=function(e,t){common.initJqValidation($("#"+t)),$($("#"+t)).valid()?n.createWP(e,!1,l.iscommit,function(){r.alert("操作成功")}):r.alert("操作失败，有红色*号的选项为必填项，请按要求填写！")}}angular.module("app").controller("maintWorkprogramEditCtrl",e),e.$inject=["workprogramSvc","$state","bsWin","sysfileSvc","$scope","$window","$rootScope","signSvc"]}(),function(){"use strict";function e(t,i,e,o,n){var a=this;a.title="修改意见",a.model={},a.dispatchDoc={},a.model.signid=e.params.signid,a.model.processInstanceId=e.params.processInstanceId,i.initFlowPageData(a.model.signid,function(e){if(a.model=e,a.model.ministerhandlesug=a.model.ministerhandlesug.replace(/<br>/g,"\n"),a.dispatchDoc=a.model.dispatchDocDto,a.dispatchDoc&&(a.dispatchDoc.ministerSuggesttion&&(a.dispatchDoc.ministerSuggesttion=a.dispatchDoc.ministerSuggesttion.replace(/<br>/g,"\n")),a.dispatchDoc.viceDirectorSuggesttion&&(a.dispatchDoc.viceDirectorSuggesttion=a.dispatchDoc.viceDirectorSuggesttion.replace(/<br>/g,"\n"))),a.model.workProgramDtoList){a.workList=a.model.workProgramDtoList;for(var t=0;t<a.model.workProgramDtoList.length;t++)"1"==a.model.workProgramDtoList[t].branchId&&(a.work=a.model.workProgramDtoList[t],a.work.reviewOrgName&&(a.reviewOrgName=a.work.reviewOrgName.split(",")));for(var t=0;t<a.workList.length;t++)a.workList[t].orgName=a.reviewOrgName[a.model.workProgramDtoList[t].branchId-1]}}),a.goBackMain=function(){e.go("MaintainProjectEdit",{signid:a.model.signid,processInstanceId:a.model.processInstanceId})},a.create=function(){if(a.model.ministerhandlesug=a.model.ministerhandlesug.replace(/\n/g,"<br>"),i.updateFillin(a.model,function(e){a.model.ministerhandlesug=a.model.ministerhandlesug.replace(/<br>/g,"\n")}),null!=a.workList&&0!=a.workList.length)for(var e=0;e<a.workList.length;e++)n.createWP(a.workList[e],!1,a.iscommit);a.dispatchDoc?(a.dispatchDoc.signid=a.model.signid,a.dispatchDoc.ministerSuggesttion&&(a.dispatchDoc.ministerSuggesttion=a.dispatchDoc.ministerSuggesttion.replace(/\n/g,"<br>")),a.dispatchDoc.viceDirectorSuggesttion&&(a.dispatchDoc.viceDirectorSuggesttion=a.dispatchDoc.viceDirectorSuggesttion.replace(/\n/g,"<br>")),o.saveDispatch(a,function(e){a.dispatchDoc.ministerSuggesttion&&(a.dispatchDoc.ministerSuggesttion=a.dispatchDoc.ministerSuggesttion.replace(/<br>/g,"\n")),a.dispatchDoc.viceDirectorSuggesttion&&(a.dispatchDoc.viceDirectorSuggesttion=a.dispatchDoc.viceDirectorSuggesttion.replace(/<br>/g,"\n")),t.alert(e.reMsg)})):t.alert("操作成功")}}angular.module("app").controller("reviewOpinionCtrl",e),e.$inject=["bsWin","signSvc","$state","dispatchSvc","workprogramSvc"]}(),function(){"use strict";function e(e,t,i){var o=this;o.signId=e.params.signid,o.sign={},o.totalReviewDays=0,o.lengthenDays=0,t.initReviewWorkDays(o,function(e){o.sign=e,o.oldSignDate=o.sign.signdate,o.totalReviewDays=o.sign.totalReviewdays,o.lengthenDays=o.sign.lengthenDays,o.sign.reviewdays=o.totalReviewDays-o.sign.surplusdays}),o.saveReview=function(){common.initJqValidation(),$("form").valid()&&t.saveReview(o,function(e){(e.flag||"ok"==e.reCode)&&i.success("操作成功！")})},o.changeTotalReviewDays=function(){o.sign.lengthenDays=o.sign.totalReviewdays-o.totalReviewDays+o.lengthenDays,o.sign.surplusdays=o.sign.totalReviewdays-o.sign.reviewdays},o.changeLengthenDays=function(){o.sign.surplusdays+=o.sign.lengthenDays,o.sign.totalReviewdays+=o.sign.lengthenDays},o.changeSignDate=function(){t.countWeekDays(o.oldSignDate,o.sign.signdate,function(e){o.sign.surplusdays+=e.reObj,o.sign.reviewdays-=e.reObj})}}angular.module("app").controller("reviewWorkdayCtrl",e),e.$inject=["$state","reviewWorkdaysSvc","bsWin"]}(),function(){"use strict";function e(n){return{initReviewWorkDays:function(e,t){var i={method:"post",url:rootPath+"/maintainProject/initReviewDays",params:{signId:e.signId}};common.http({$http:n,httpOptions:i,success:function(e){if(null!=t&&"function"==typeof t)return t(e.data)}})},saveReview:function(e,t){var i={method:"put",url:rootPath+"/maintainProject/saveReview",data:e.sign};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},countWeekDays:function(e,t,i){var o={method:"post",url:rootPath+"/signView/admin/countWeekDays",params:{oldSignDate:e,signDate:t}};common.http({$http:n,httpOptions:o,success:function(e){if(null!=i&&"function"==typeof i)return i(e.data)}})}}}angular.module("app").factory("reviewWorkdaysSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(n,t){var a=this;a.title="会议室列表",a.model={},a.del=function(e){n.confirm({title:"询问提示",message:"确认删除数据吗？",onOk:function(){t.deleteMeeting(e,a.isSubmit,function(e){a.isSubmit=!1,e.flag||"ok"==e.reCode?n.alert("消息提示","操作成功！",function(){a.gridOptions.dataSource.read()}):n.alert(e.reMsg)})}})},a.used=function(e){a.model.id=e,a.model.mrStatus="1",t.roomUseState(a.model,function(e){n.alert("操作成功！",function(){a.gridOptions.dataSource.read()})})},a.stoped=function(e){n.confirm({title:"询问提示",message:"确认停用么？",onOk:function(){a.model.id=e,a.model.mrStatus="2",t.roomUseState(a.model,function(e){n.alert("操作成功！",function(){a.gridOptions.dataSource.read()})})}})},a.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)n.alert("请选择数据");else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");a.del(o)}},a.queryMeeting=function(){a.gridOptions.dataSource._skip=0,a.gridOptions.dataSource.read()},a.formReset=function(){var e=$("#meetingForm").find("input,select");$.each(e,function(e,t){t.value=""})},t.grid(a)}angular.module("app").controller("meetingCtrl",e),e.$inject=["bsWin","meetingSvc"]}(),function(){"use strict";function e(t,e,i){var o=this;o.title="添加会议室",o.isuserExist=!1,o.id=i.params.id,o.id&&(o.isUpdate=!0,o.title="更新会议室"),o.create=function(){common.initJqValidation(),$("form").valid()?e.createMeeting(o.model,o.isSubmit,function(e){e.flag||"ok"==e.reCode?t.alert("消息提示","操作成功！",function(){location.href="#/meeting"}):t.alert(e.reMsg)}):t.alert("信息没填写正确！")},o.update=function(){common.initJqValidation(),$("form").valid()?(o.model.id=o.id,e.updateMeeting(o.model,o.isSubmit,function(e){e.flag||"ok"==e.reCode?t.alert("操作成功"):t.alert(e.reMsg)})):t.alert("信息没填写正确！")},o.isUpdate&&e.getMeetingById(o)}angular.module("app").controller("meetingEditCtrl",e),e.$inject=["bsWin","meetingSvc","$state"]}(),function(){"use strict";function e(n){var a=rootPath+"/meeting";return{grid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(a+"/fingByOData",$("#meetingForm")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"num",title:"编号",width:"8%",filterable:!1},{field:"mrName",title:"会议室名称",width:"25%",filterable:!1},{field:"mrType",title:"类型",width:"10%",filterable:!1},{field:"addr",title:"会议室地点",width:"25%",filterable:!1},{field:"capacity",title:"容量",width:"10%",filterable:!1},{field:"",title:"状态",width:"8%",template:function(e){return"2"==e.mrStatus?"停用":"正常"}},{field:"",title:"操作",width:"14%",template:function(e){var t=!1;return t="2"==e.mrStatus,common.format($("#columnBtns").html(),"vm.stoped('"+e.id+"')",t,"vm.used('"+e.id+"')",t,e.id)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})},resizable:!0}},getMeetingById:function(t){var e={method:"get",url:a+"/html/findByIdMeeting",params:{id:t.id}};common.http({vm:t,$http:n,httpOptions:e,success:function(e){t.model=e.data}})},createMeeting:function(e,t,i){!0;var o={method:"post",url:a,data:e};common.http({$http:n,httpOptions:o,success:function(e){null!=i&&"function"==typeof i&&i(e.data)},onError:function(e){!1}})},deleteMeeting:function(e,t,i){!0;var o={method:"delete",url:a,params:{id:e}};common.http({$http:n,httpOptions:o,success:function(e){!1,null!=i&&"function"==typeof i&&i(e.data)}})},updateMeeting:function(e,t,i){!0;var o={method:"put",url:a,data:e};common.http({$http:n,httpOptions:o,success:function(e){!1,null!=i&&"function"==typeof i&&i(e.data)}})},roomUseState:function(e,t){var i={method:"put",url:a+"/roomUseState",data:e};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},findAllMeeting:function(t){var e={method:"post",url:rootPath+"/meeting/findAll"};common.http({$http:n,httpOptions:e,success:function(e){null!=t&&"function"==typeof t&&t(e.data)},onError:function(){}})}}}angular.module("app").factory("meetingSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,i,o){this.title="短信列表",this.model={}}angular.module("app").controller("msgCtrl",e),e.$inject=["$location","msgSvc","$state","$http"]}(),function(){"use strict";function e(e,i){return{initGrid:function(){},initOrgAndUser:function(t){var e={method:"post",url:rootPath+"/sharingPlatlform/initOrgAndUser"};common.http({$http:i,httpOptions:e,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},saveMsgInfo:function(e,t){}}}angular.module("app").factory("msgSvc",e),e.$inject=["$rootScope","$http"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.title="短信编辑",n.model={},n.businessFlag={isLoadOrgUser:!1},t.initOrgAndUser(function(e){n.shareOrgList=e.orgDtoList,n.noOrgUsetList=e.noOrgUserList,n.businessFlag.isLoadOrgUser=!0}),n.create=function(){t.saveMsgInfo(n)}}angular.module("app").controller("msgEditCtrl",e),e.$inject=["$location","msgSvc","sharingPlatlformSvc","$http"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.title="待办事项",n.addregister={},n.model={},n.model.signid=i.params.signid,n.showPrint=!1,t.grid(n),n.print=function(){signcommon.registerFilePrint(n,{$http:o})},n.findbySuppleDate=function(e){}}angular.module("app").controller("registerFileCtrl",e),e.$inject=["$location","registerFileSvc","$state","$http"]}(),function(){"use strict";function e(e,t){var i=rootPath+"/addRegisterFile";return{grid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridinlineConfig().transport(e,{readUrl:i+"/findByOData",updateUrl:i+"/update",destroyUrl:i+"/delete",createUrl:i+"/create/"+e.model.signid},{filter:"signid eq '"+e.model.signid+"'"}),schema:common.kendoGridConfig().schema({id:"id",fields:{fileName:{validation:{required:!0},type:"String"},totalNum:{type:"number",validation:{required:!0,min:1}},isHasOriginfile:{type:"boolean"},isHasCopyfile:{type:"boolean"},suppleDeclare:{type:"string"},suppleDate:{type:"date"},createdDate:{type:"date"},modifiedDate:{type:"date"}}}),batch:!0,pageSize:10,serverPaging:!0,serverSorting:!0,serverFiltering:!0,sort:{field:"createdDate",dir:"desc"}});e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridinlineConfig().filterable,pageable:common.kendoGridinlineConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:[{field:"",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"fileName",title:"资料名称",width:"120px",filterable:!1},{field:"totalNum",title:"份数",width:"120px",filterable:!1},{field:"isHasOriginfile",title:"原件",width:"120px",filterable:!1,template:function(e){return e.isHasOriginfile?"是":"否"}},{field:"isHasCopyfile",title:"复印件",width:"120px",filterable:!1,template:function(e){return e.isHasCopyfile?"是":"否"}},{field:"suppleDeclare",title:"补充说明",width:"120px",filterable:!1},{field:"suppleDate",title:"补充日期",width:"120px",format:"{0:yyyy-MM-dd}",filterable:!1},{command:["destroy"],title:"&nbsp;",width:"250px"}],toolbar:["create","save","cancel"],dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})},editable:!0,navigatable:!0,resizable:!0}}}}angular.module("app").factory("registerFileSvc",e),e.$inject=["$rootScope","$http"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.showsupp=!1,n.title="拟补资料函",n.suppletter={},n.model={},n.model.signid=i.params.signid,n.suppletter.id=i.params.id,n.addSuppContent=function(){n.showsupp=!0,$("#addsuppContent").kendoWindow({width:"50%",height:"80%",title:"拟补资料函正文",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()}}angular.module("app").controller("suppletterCtrls",e),e.$inject=["$location","suppletterSvc","$state","$http"]}(),function(){"use strict";function e(e,t){return{}}angular.module("app").factory("suppletterSvc",e),e.$inject=["$rootScope","$http"]}(),function(){"use strict";function e(e,t){var n=this;n.title="部门列表",n.del=function(e){common.confirm({vm:n,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteOrg(n,e)}})},n.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:n,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");n.del(o)}},n.queryOrg=function(){t.queryOrg(n)},t.grid(n)}angular.module("app").controller("orgCtrl",e),e.$inject=["$location","orgSvc"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.model={},n.title="新增部门",n.isorgExist=!1,n.model.id=i.params.id,n.model.id&&(n.isUpdate=!0,n.title="更新部门"),t.initRoleUsers(function(e){n.orgMLeaderUsers=e.DIRECTOR,n.orgSLeaderUser=e.VICE_DIRECTOR,n.OrgDirectorUsers=e.DEPT_LEADER}),n.isUpdate&&t.getOrgById(n.model.id,function(e){n.model=e}),n.create=function(){common.initJqValidation(),$("form").valid()?($.each(n.OrgDirectorUsers,function(e,t){t.id==n.model.orgDirector&&(n.model.orgDirectorName=t.displayName)}),$.each(n.orgMLeaderUsers,function(e,t){t.id==n.model.orgMLeader&&(n.model.orgMLeaderName=t.displayName)}),$.each(n.orgSLeaderUser,function(e,t){t.id==n.model.orgSLeader&&(n.model.orgSLeaderName=t.displayName)}),t.createOrg(n.model,n.isSubmit,function(e){n.isSubmit=!1,e.flag||"ok"==e.reCode?(n.model.id||(n.model.id=e.idCode),o.success("操作成功！")):o.error(e.reMsg)})):o.alert("保存失败，有红色*号的选项是必填项，请按要求填写！")},n.update=function(){common.initJqValidation(),$("form").valid()?($.each(n.OrgDirectorUsers,function(e,t){t.id==n.model.orgDirector&&(n.model.orgDirectorName=t.displayName)}),$.each(n.orgMLeaderUsers,function(e,t){t.id==n.model.orgMLeader&&(n.model.orgMLeaderName=t.displayName)}),$.each(n.orgSLeaderUser,function(e,t){t.id==n.model.orgSLeader&&(n.model.orgSLeaderName=t.displayName)}),t.updateOrg(n.model,n.isSubmit,function(e){n.isSubmit=!1,e.flag||"ok"==e.reCode?o.success("操作成功！"):o.alert(e.reMsg)})):o.alert("保存失败，有红色*号的选项是必填项，请按要求填写！")}}angular.module("app").controller("orgEditCtrl",e),e.$inject=["$location","orgSvc","$state","bsWin"]}(),function(){"use strict";function e(n,e){var a=rootPath+"/org";rootPath;return{grid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(a+"/fingByOData",$("#orgForm")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"sort",dir:"asc"}}),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"name",title:"部门名称",width:130,filterable:!1},{field:"orgFunction",title:"职能",width:130,filterable:!1},{field:"orgDirectorName",title:"部门负责人",width:100,filterable:!1},{field:"orgSLeaderName",title:"分管副领导",width:100,filterable:!1},{field:"orgPhone",title:"电话",width:130,filterable:!1},{field:"",title:"操作",width:200,template:function(e){return common.format($("#columnBtns").html(),"vm.del('"+e.id+"')",e.id)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})},resizable:!0}},createOrg:function(e,t,i){!0;var o={method:"post",url:a,data:e};common.http({$http:n,httpOptions:o,success:function(e){!1,null!=i&&"function"==typeof i&&i(e.data)},onError:function(){!1}})},getOrgById:function(e,t){var i={method:"post",url:rootPath+"/org/getOrgById",params:{id:e}};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},updateOrg:function(e,t,i){!0;var o={method:"post",url:rootPath+"/org/updateOrg",data:e};common.http({$http:n,httpOptions:o,success:function(e){!1,null!=i&&"function"==typeof i&&i(e.data)},onError:function(){!1}})},deleteOrg:function(t,e){t.isSubmit=!0;var i={method:"delete",url:a,data:e};common.http({vm:t,$http:n,httpOptions:i,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})}})},getCompany:function(t){var e={method:"get",url:common.format(a+"/getCompany")};common.http({vm:t,$http:n,httpOptions:e,success:function(e){t.company={},t.company=e.data}})},initRoleUsers:function(t){var e={method:"post",url:rootPath+"/user/initRoleUsers"};common.http({$http:n,httpOptions:e,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},queryOrg:function(e){e.gridOptions.dataSource._skip=0,e.gridOptions.dataSource.read()},queryOrgList:function(e,t){var i={method:"post",url:rootPath+"/org/queryOrgList"};common.http({vm:e,$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}}}angular.module("app").factory("orgSvc",e),e.$inject=["$http","$compile"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.id=t.params.id,n.showAddUserDialog=function(){$(".addUser").modal({backdrop:"static",keyboard:!1}),n.orgUserGrid.dataSource.read()},n.closeAddUserDialog=function(){$(".addUser").modal("hide")},n.add=function(e){o.add(n,e)},n.remove=function(e){o.remove(n,e)},n.removes=function(){var e=common.getKendoCheckId(".gird");if(0==e.length)common.alert({vm:n,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");n.remove(o)}},n.query=function(){n.gridOptions.dataSource._skip=0,n.gridOptions.dataSource.read()},n.formReset=function(){var e=$("#form").find("input,select").not(":submit, :reset, :image, :disabled,:hidden");$.each(e,function(e,t){t.value=""})},o.orgUserGrid(n),o.allUserGrid(n)}angular.module("app").controller("orgUserCtrl",e),e.$inject=["$location","$state","orgSvc","orgUserSvc"]}(),function(){"use strict";function e(o,e){var n=rootPath+"/org/userNotIn";return{orgUserGrid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/org/users?orgId="+e.id,$("#form")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!1,serverSorting:!1,serverFiltering:!1,pageSize:10,sort:{field:"jobState",dir:"desc"}}),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"loginName",title:"登录名",width:200,filterable:!1},{field:"displayName",title:"显示名",width:200,filterable:!1},{field:"",title:"在职情况",width:160,filterable:!1,template:function(e){return e.jobState&&"t"==e.jobState?"在职":"已撤销"}},{field:"remark",title:"描述",filterable:!1},{field:"",title:"操作",width:180,template:function(e){return common.format($("#columnBtns").html(),"vm.remove('"+e.id+"')")}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0}},allUserGrid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(n+"?orgId="+e.id),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"jobState",dir:"desc"}}),i=[{field:"loginName",title:"登录名",width:200,filterable:!0},{field:"displayName",title:"显示名",width:200,filterable:!0},{field:"remark",title:"描述",filterable:!1},{field:"",title:"操作",width:80,template:function(e){return common.format($("#allUserGridBtns").html(),"vm.add('"+e.id+"')")}}];e.orgUserGrid={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0}},add:function(t,e){var i={method:"post",url:rootPath+"/org/addUsers",params:{orgId:t.id,userId:e}};common.http({vm:t,$http:o,httpOptions:i,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.orgUserGrid.dataSource.read(),t.gridOptions.dataSource.read()}})}})},remove:function(t,e){var i={method:"delete",url:rootPath+"/org/deleteUsers",params:{orgId:t.id,userId:e}};common.http({vm:t,$http:o,httpOptions:i,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.gridOptions.dataSource.read()}})}})}}}angular.module("app").factory("orgUserSvc",e),e.$inject=["$http","$compile"]}(),function(){"use strict";function e(e,t){var n=this;n.title="月报简报历史数据管理",n.del=function(e){common.confirm({vm:n,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deletemonthlyHistory(n,e)}})},n.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:n,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");n.del(o)}},t.monthlyHistoryGrid(n),t.deleteGridOptions(n)}angular.module("app").controller("monthlyHistoryCtrl",e),e.$inject=["$location","monthlyHistorySvc"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.title="添加月报简报历史数据",n.isuserExist=!1,n.id=i.params.id,n.monthly={},n.id&&(n.isUpdate=!0,n.title="更新月报简报"),n.createHistory=function(){common.initJqValidation(),$("form").valid()?t.createmonthlyHistory(n.monthly,function(e){e.flag||"ok"==e.reCode?(n.monthly=e.reObj,o.alert("操作成功！")):o.error(e.reMsg)}):o.alert("缺少部分没有填写，请仔细检查")},n.updateMonthly=function(){t.updatemonthlyHistory(n)},n.isUpdate&&t.getmonthlyHistoryById(n)}angular.module("app").controller("monthlyHistoryEditCtrl",e),e.$inject=["$location","monthlyHistorySvc","$state","bsWin"]}(),function(){"use strict";function e(o){var n=rootPath+"/monthlyNewsletter";return{monthlyHistoryGrid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(n+"/mothlyHistoryList"),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"startDay",title:"开始时间",width:100,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"startDay",title:"结束时间",width:100,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"stageMunber",title:"已评审项目数",width:120,filterable:!1},{field:"declarationSum",title:"报审总投资",width:100,filterable:!1},{field:"assessorSum",title:"审核总投资",width:100,filterable:!1},{field:"authorizedUser",title:"录入人",width:100,filterable:!1},{field:"authorizedTime",title:"录入时间",width:100,filterable:!1},{field:"",title:"操作",width:100,template:function(e){return common.format($("#columnBtns").html(),e.id,"vm.del('"+e.id+"')")}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})},columns:i,resizable:!0}},deleteGridOptions:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(n+"/deleteHistoryList"),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"startDay",title:"开始时间",width:100,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"startDay",title:"结束时间",width:100,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"stageMunber",title:"已评审项目数",width:120,filterable:!1},{field:"declarationSum",title:"报审总投资",width:100,filterable:!1},{field:"assessorSum",title:"审核总投资",width:100,filterable:!1},{field:"authorizedUser",title:"录入人",width:100,filterable:!1},{field:"authorizedTime",title:"录入时间",width:100,filterable:!1}];e.deleteGridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})},columns:i,resizable:!0}},createmonthlyHistory:function(e,t){var i={method:"post",url:n+"/savaHistory",data:e};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},deletemonthlyHistory:function(t,e){t.isSubmit=!0;var i={method:"delete",url:n+"/deleteHistory",data:e};common.http({vm:t,$http:o,httpOptions:i,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read(),window.location.reload()}})}})}})},getmonthlyHistoryById:function(t){var e={method:"get",url:rootPath+"/monthlyNewsletter/html/findById",params:{id:t.id}};common.http({vm:t,$http:o,httpOptions:e,success:function(e){t.monthly=e.data}})},updatemonthlyHistory:function(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0,t.monthly.id=t.id;var e={method:"put",url:n+"/monthlyEdit",data:t.monthly};common.http({vm:t,$http:o,httpOptions:e,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})}})}}}}angular.module("app").factory("monthlyHistorySvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,i,o,n){var a=this;a.title="月报简报查询",a.stateName=i.current.name,a.queryParams={},a.saveView=function(){n.storeView(a.stateName,{gridParams:a.multiyearGrid.dataSource.transport.options.read.data(),queryParams:a.queryParams,data:a})},function(){if(n.view[a.stateName]){var e=n.view[a.stateName];e.gridParams&&(a.gridParams=e.gridParams),e.data&&(a.model=e.data.model),e.queryParams&&(a.queryParams=e.queryParams),t.monthlyMultiyearGrid(a),n.view[a.stateName]=void 0}else t.monthlyMultiyearGrid(a)}(),a.addSuppQuery=function(){a.multiyearGrid.dataSource._skip=0,a.multiyearGrid.dataSource.read()},a.resetAddSupp=function(){var e=$("#form").find("input,select");$.each(e,function(e,t){t.value=""})}}angular.module("app").controller("monthlyMultiFileCtrl",e),e.$inject=["$location","monthlyMultiyearSvc","$state","bsWin","$rootScope"]}(),function(){"use strict";function e(e,t,i,o,n){var a=this;a.title="年度月报简报",a.suppletter={},a.suppletter.fileYear=i.params.year,$("#fileYear").val(a.suppletter.fileYear),a.stateName=i.current.name,a.queryParams={},a.saveView=function(){n.storeView(a.stateName,{gridParams:a.monthlyYearGrid.dataSource.transport.options.read.data(),queryParams:a.queryParams,data:a})},function(){if(n.view[a.stateName]){var e=n.view[a.stateName];e.gridParams&&(a.gridParams=e.gridParams),e.data&&(a.model=e.data.model),e.queryParams&&(a.queryParams=e.queryParams),t.monthlyYearGrid(a),n.view[a.stateName]=void 0}else t.monthlyYearGrid(a);t.findAllOrg(a)}(),a.addSuppQuery=function(){t.addSuppQuery(a)},a.resetAddSupp=function(){var e=$("#form_monthly").find("input,select");$.each(e,function(e,t){t.value=""})},a.del=function(e){common.confirm({vm:a,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deletemonthlyMultiyear(a,e)}})},a.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:a,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");a.del(o)}}}angular.module("app").controller("monthlyMultiyearCtrl",e),e.$inject=["$location","monthlyMultiyearSvc","$state","bsWin","$rootScope"]}(),function(){"use strict";function e(i,e,t,o,n){var a=this;a.title="添加月报简报稿纸",a.isuserExist=!1,a.isSubmit=!0,a.suppletter={},a.id=t.params.id,a.type=t.params.type,a.suppletter.id=t.params.id,a.suppletter.fileYear=t.params.year,a.id&&(a.isUpdate=!0,a.isflow=!0,a.title="更新月报简报稿纸"),a.businessFlag={isInitFileOption:!1},a.isUpdate?i.getmonthlyMultiyearById(a.id,function(e){a.suppletter=e,a.initFileUpload()}):i.initMonthlyMultiyear(function(e){a.suppletter=e,a.suppletter.fileYear=t.params.year,a.initFileUpload()}),a.initFileUpload=function(){a.suppletter.id||n.$watch("vm.suppletter.id",function(e,t){e&&e!=t&&!a.initUploadOptionSuccess&&a.initFileUpload()}),a.sysFile={businessId:a.suppletter.id,mainId:a.suppletter.id,mainType:e.mainTypeValue().SIGN,sysfileType:e.mainTypeValue().MONTH_FILE,sysBusiType:e.mainTypeValue().MONTH_FILE},e.initUploadOptions({inputId:"sysfileinput",vm:a})},a.saveAddSuppletter=function(){common.initJqValidation(),$("form").valid()?(a.suppletter.fileType="2",i.createmonthlyMultiyear(a.suppletter,function(e){e.flag||"ok"==e.reCode?(a.suppletter=e.reObj,a.id=e.reObj.id,o.alert("操作成功！")):o.error(e.reMsg)})):o.alert("缺少部分没有填写，请仔细检查")},a.updateAddSuppletter=function(){common.initJqValidation(),$("form").valid()?i.updatemonthlyMultiyear(a.suppletter,function(e){e.flag||"ok"==e.reCode?o.alert("操作成功！"):o.error(e.reMsg)}):o.alert("缺少部分没有填写，请仔细检查")},a.startNewFlow=function(t){o.confirm({title:"询问提示",message:"确认已经完成填写，并且发起流程么？",onOk:function(){$(".confirmDialog").modal("hide"),t?i.updatemonthlyMultiyear(a.suppletter,function(e){e.flag||"ok"==e.reCode?i.startFlow(t,function(e){e.flag||"ok"==e.reCode?o.success("操作成功！",function(){location.href="#/theMonthsList"}):o.error(e.reMsg)}):o.error(e.reMsg)}):(a.suppletter.fileType="2",i.createmonthlyMultiyear(a.suppletter,function(e){e.flag||"ok"==e.reCode?(a.suppletter=e.reObj,a.id=e.reObj.id,i.startFlow(a.id,function(e){e.flag||"ok"==e.reCode?o.success("操作成功！",function(){location.href="#/theMonthsList"}):o.error(e.reMsg)})):o.error(e.reMsg)}))}})}}angular.module("app").controller("monthlyMultiyearEditCtrl",e),e.$inject=["monthlyMultiyearSvc","sysfileSvc","$state","bsWin","$scope"]}(),function(){"use strict";function e(o,n){var a=rootPath+"/monthlyNewsletter",i=rootPath+"/user";return{createmonthlyMultiyear:function(e,t){var i={method:"post",url:a+"/saveMonthlyMultiyear",data:e};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},initMonthlyMultiyear:function(t){var e={method:"post",url:rootPath+"/monthlyNewsletter/initMonthlyMultiyear"};common.http({$http:o,httpOptions:e,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},monthlyMultiyearGrid:function(e){var t=common.kendoGridDataSource(rootPath+"/addSuppLetter/monthlyMultiyearList",$("#form"),e.queryParams.page,e.queryParams.pageSize,e.gridParams),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"title",title:"文件标题",width:"30%",filterable:!1,template:function(e){return'<a ng-click="vm.saveView()" href="#/monthlyMultiyView/'+e.id+'" >'+e.title+"</a>"}},{field:"orgName",title:"拟办部门",width:"10%",filterable:!1},{field:"userName",title:"拟稿人",width:"10%",filterable:!1},{field:"suppLetterTime",title:"拟稿时间",width:"10%",filterable:!1},{field:"secretLevel",title:"秘密等级",width:"10%",filterable:!1},{field:"",title:"操作",width:80,template:function(e){return common.format($("#columnBtns").html(),e.id,e.appoveStatus)}}];e.multiyearGrid={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,pageable:common.kendoGridConfig(e.queryParams).pageable,dataBound:common.kendoGridConfig(e.queryParams).dataBound,columns:i,resizable:!0}},monthlyYearGrid:function(i){var e=common.kendoGridDataSource(rootPath+"/addSuppLetter/monthlyMultiyearList",$("#form_monthly"),i.queryParams.page,i.queryParams.pageSize,i.gridParams),t=[{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"title",title:"文件标题",width:180,filterable:!1,template:function(e){return e.processInstanceId?'<a ng-click="vm.saveView()" href="#/monthlyMultiyView/'+e.id+'" >'+e.title+"</a>":'<a ng-click="vm.saveView()" href="#/monthlyMultiyearEdit/'+i.suppletter.fileYear+"/"+e.id+'" >'+e.title+"</a>"}},{field:"orgName",title:"拟办部门",width:100,filterable:!1},{field:"userName",title:"拟稿人",width:120,filterable:!1},{field:"suppLetterTime",title:"拟稿时间",width:100,filterable:!1},{field:"secretLevel",title:"秘密等级",width:100,filterable:!1},{field:"",title:"操作",width:140,template:function(e){var t=!0;return(angular.isUndefined(e.processInstanceId)||""==e.processInstanceId)&&(t=!1),common.format($("#columnBtns").html(),i.suppletter.fileYear,e.id,t,e.createdBy,e.id,"vm.del('"+e.id+"')")}}];i.monthlyYearGrid={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,pageable:common.kendoGridConfig(i.queryParams).pageable,dataBound:common.kendoGridConfig(i.queryParams).dataBound,columns:t,resizable:!0}},getmonthlyMultiyearById:e,updatemonthlyMultiyear:function(e,t){var i={method:"post",url:a+"/saveMonthlyMultiyear",data:e};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},addSuppQuery:function(e){e.monthlyYearGrid.dataSource._skip=0,e.monthlyYearGrid.dataSource.read()},findAllOrg:function(t){var e={method:"get",url:common.format(i+"/getOrg")};common.http({vm:t,$http:o,httpOptions:e,success:function(e){t.orglist={},t.orglist=e.data}})},findAllUser:function(t){var e={method:"get",url:common.format(i+"/findAllUsers")};common.http({vm:t,$http:o,httpOptions:e,success:function(e){t.userlist={},t.userlist=e.data}})},deletemonthlyMultiyear:function(t,e){t.isSubmit=!0;var i={method:"delete",url:a+"/deleteMutiyear",data:e};common.http({vm:t,$http:o,httpOptions:i,success:function(e){n.alert("操作成功",function(){t.isSubmit=!1,t.monthlyYearGrid.dataSource.read()})}})},startFlow:function(e,t){var i={method:"post",url:rootPath+"/monthlyNewsletter/startFlow",params:{id:e}};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},initFlowDeal:function(t){e(t.businessKey,function(e){t.suppletter=e})}};function e(e,t){var i={method:"post",url:rootPath+"/addSuppLetter/findById",params:{id:e}};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}}angular.module("app").factory("monthlyMultiyearSvc",e),e.$inject=["$http","bsWin"]}(),function(){"use strict";function e(e,t,i,o,n){var a=this;a.title="月报详情页面",a.suppletter={},a.id=i.params.id,e.getmonthlyMultiyearById(a.id,function(e){a.suppletter=e,t.findByBusinessId(a.id,function(e){a.sysFilelists=e,a.initFileUpload()})}),a.initFileUpload=function(){a.suppletter.id||n.$watch("vm.suppletter.id",function(e,t){e&&e!=t&&!a.initUploadOptionSuccess&&(console.log(e),console.log(t),a.initFileUpload())}),a.sysFile={businessId:a.suppletter.id,mainId:a.suppletter.id,mainType:t.mainTypeValue().SIGN,sysfileType:t.mainTypeValue().MONTH_FILE,sysBusiType:t.mainTypeValue().MONTH_FILE},t.initUploadOptions({inputId:"sysfileinput",vm:a})}}angular.module("app").controller("monthlyMultiyViewCtrl",e),e.$inject=["monthlyMultiyearSvc","sysfileSvc","$state","bsWin","$scope"]}(),function(){"use strict";function e(n,t){var a=this;a.title="月报简报列表",t.monthlyNewsletterGrid(a),t.monthlyDeleteGrid(a),a.del=function(e){n.confirm({title:"询问提示",message:"确认删除数据吗？",onOk:function(){t.deleteMonthlyNewsletter(e,function(e){(e.flag||"ok"==e.reCode)&&n.alert("操作成功！",function(){a.gridOptions.dataSource.read(),a.monthlyDeleteGridOptions.dataSource.read()})})}})},a.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)n.alert("请选择要删除的数据！");else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");a.del(o)}}}angular.module("app").controller("monthlyNewsletterCtrl",e),e.$inject=["bsWin","monthlyNewsletterSvc"]}(),function(){"use strict";function e(e,t,i,o){var n,a,r,s=this;s.title="添加月报简报",s.isuserExist=!1,s.id=i.params.id,s.monthly={},s.id&&(s.isUpdate=!0,s.title="更新月报简报"),s.selectMonthly=function(){s.monthly.endTheMonths=s.monthly.theMonths,s.monthly.staerTheMonths="1"},s.reportYear=function(){var e=s.monthly.reportMultiyear;s.monthly.startMoultiyear=e,s.monthly.endMoultiyear=e},s.startMonthly=function(){parseInt(s.monthly.endTheMonths)<parseInt(s.monthly.staerTheMonths)&&(o.alert("开始月份不能大于结束月份"),s.monthly.staerTheMonths=" ")},s.createMothlyNewsletter=function(){common.initJqValidation(),$("#form").valid()?t.createMonthlyNewsletter(s.monthly,function(e){e.flag||"ok"==e.reCode?(s.monthly=e.reObj,o.alert("操作成功！")):o.error(e.reMsg)}):o.alert("缺少部分没有填写，请仔细检查")},s.updateMonthly=function(){t.updateMonthlyNewsletter(s)},s.createMonthReport=function(){t.createMonthReport(s)},s.isUpdate?t.getMonthlyNewsletterById(s):(n=new Date,a=n.getFullYear(),1==(r=n.getMonth()+1)?(s.monthly.reportMultiyear=a-1+"",s.monthly.startMoultiyear=a-1+"",s.monthly.endMoultiyear=a-1+"",s.monthly.theMonths="12",s.monthly.staerTheMonths="1",s.monthly.endTheMonths="12"):(s.monthly.reportMultiyear=a+"",s.monthly.startMoultiyear=a+"",s.monthly.endMoultiyear=a+"",s.monthly.theMonths=r-1+"",s.monthly.staerTheMonths="1",s.monthly.endTheMonths=r-1+""))}angular.module("app").controller("monthlyNewsletterEditCtrl",e),e.$inject=["$location","monthlyNewsletterSvc","$state","bsWin"]}(),function(){"use strict";function e(o){var n=rootPath+"/monthlyNewsletter";return{monthlyNewsletterGrid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(n+"/findByOData",$("#monthlyForm"),{$filter:"monthlyType eq '1'"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"reportMultiyear",title:"报告年度",width:100,filterable:!1},{field:"theMonths",title:"报告月份",width:100,filterable:!1},{field:"remark",title:"报告说明",width:100,filterable:!1},{field:"authorizedUser",title:"编制人",width:100,filterable:!1},{field:"authorizedTime",title:"编制时间",width:100,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"",title:"操作",width:140,template:function(e){return common.format($("#columnBtns").html(),e.id,"vm.del('"+e.id+"')")}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})},columns:i,resizable:!0}},monthlyDeleteGrid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(n+"/findByOData",$("#monthlyForm"),{$filter:"monthlyType eq '2'"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"reportMultiyear",title:"报告年度",width:100,filterable:!1},{field:"theMonths",title:"报告月份",width:100,filterable:!1},{field:"remark",title:"报告说明",width:100,filterable:!1},{field:"authorizedUser",title:"编制人",width:100,filterable:!1},{field:"authorizedTime",title:"编制时间",width:100,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"}];e.monthlyDeleteGridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})},columns:i,resizable:!0}},theMonthGrid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/monthlyNewsletter/getMonthlyList"),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}})});e.theMonthGridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,dataBound:function(){var e=this.items();$(e).each(function(){var e=$(this).index()+1,t=$(this).find(".row-number");$(t).html(e)})},columns:[{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"monthlyNewsletterName",title:"名称",width:"30%",filterable:!1,template:function(e){return'<a href="#/monthlyFindByMultiyear/'+e.reportMultiyear+'" >'+e.monthlyNewsletterName+"</a>"}},{field:"reportMultiyear",title:"年份",width:"15%",filterable:!1},{field:"remark",title:"备注",width:"40%",filterable:!1},{field:"authorizedTime",title:"添加时间",width:"15%",filterable:!1}],resizable:!0}},createMonthlyNewsletter:function(e,t){var i={method:"post",url:n+"/savaMonthlyNewsletter",data:e};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},updateMonthlyNewsletter:function(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0,t.monthly.id=t.id;var e={method:"put",url:n+"/monthlyEdit",data:t.monthly};common.http({vm:t,$http:o,httpOptions:e,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})}})}},deleteMonthlyNewsletter:function(e,t){var i={method:"delete",url:n+"/deleteMonthlyData",params:{id:e}};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},getMonthlyNewsletterById:function(t){var e={method:"get",url:rootPath+"/monthlyNewsletter/html/findById",params:{id:t.id}};common.http({vm:t,$http:o,httpOptions:e,success:function(e){t.monthly=e.data}})},createMonthReport:function(e){null==e.monthly.reportMultiyear&&(e.monthly.reportMultiyear="");null==e.monthly.theMonths&&(e.monthly.theMonths="");null==e.monthly.startMoultiyear&&(e.monthly.startMoultiyear="");null==e.monthly.endMoultiyear&&(e.monthly.endMoultiyear="");null==e.monthly.staerTheMonths&&(e.monthly.staerTheMonths="");null==e.monthly.endTheMonths&&(e.monthly.endTheMonths="");window.open(rootPath+"/monthlyNewsletter/createMonthReport?reportMultiyear="+e.monthly.reportMultiyear+"&theMonths="+e.monthly.theMonths+"&startMoultiyear="+e.monthly.startMoultiyear+"&endMoultiyear="+e.monthly.endMoultiyear+"&staerTheMonths="+e.monthly.staerTheMonths+"&endTheMonths="+e.monthly.endTheMonths)}}}angular.module("app").factory("monthlyNewsletterSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t){var i=this;i.title="年度月报简报列表",t.theMonthGrid(i)}angular.module("app").controller("yearMonthlyNewsletterCtrl",e),e.$inject=["$location","monthlyNewsletterSvc"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.title="处室人员管理",n.stateName=i.current.name,n.queryParams={},n.saveView=function(){o.storeView(n.stateName,{gridParams:n.gridOptions.dataSource.transport.options.read.data(),queryParams:n.queryParams,data:n})},n.del=function(e){common.confirm({vm:n,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteOfficeUser(n,e)}})},n.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:n,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");n.del(o)}},n.queryOffice=function(){t.queryOffice(n)},function(){if(o.view[n.stateName]){var e=o.view[n.stateName];e.gridParams&&(n.gridParams=e.gridParams),e.data&&(n.model=e.data.model),e.queryParams&&(n.queryParams=e.queryParams),t.grid(n),o.view[n.stateName]=void 0}else t.grid(n)}()}angular.module("app").controller("officeUserCtrl",e),e.$inject=["$location","officeUserSvc","$state","$rootScope"]}(),function(){"use strict";function e(e,t,i){var o=this;o.title="添加人员",o.isuserExist=!1,o.officeID=i.params.officeID,o.officeID&&(o.isUpdate=!0,o.title="更新人员"),o.create=function(){t.createOfficeUser(o)},o.update=function(){t.updateOfficeUser(o)},function(){o.isUpdate&&t.getOfficeUserById(o);t.getDepts(o)}()}angular.module("app").controller("officeUserEditCtrl",e),e.$inject=["$location","officeUserSvc","$state"]}(),function(){"use strict";function e(o,n){var a=rootPath+"/officeUser";return{grid:function(e){var t=common.kendoGridDataSource(a+"/fingByOData",$("#formOffice"),e.queryParams.page,e.queryParams.pageSize,e.gridParams),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.officeID)},filterable:!1,width:20,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:30,filterable:!1,template:"<span class='row-number'></span>"},{field:"officeUserName",title:"负责人",width:100,filterable:!1},{field:"deptName",title:"所在办事处",width:100,filterable:!1},{field:"officePhone",title:"电话",width:100,filterable:!1},{field:"officeEmail",title:"邮件",width:100,filterable:!1},{field:"officeDesc",title:"描述",width:100,filterable:!1},{field:"",title:"操作",width:140,template:function(e){return common.format($("#columnBtns").html(),"vm.del('"+e.officeID+"')",e.officeID)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,pageable:common.kendoGridConfig(e.queryParams).pageable,dataBound:common.kendoGridConfig(e.queryParams).dataBound,resizable:!0}},getOfficeUserById:function(t){var e={method:"get",url:rootPath+"/officeUser/html/findById",params:{officeID:t.officeID}};common.http({vm:t,$http:o,httpOptions:e,success:function(e){e.data.dept;t.model=e.data}})},createOfficeUser:function(t){if(common.initJqValidation(),$("#form").valid()){t.isSubmit=!0;var e={method:"post",url:a,data:t.model};common.http({vm:t,$http:o,httpOptions:e,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){n.alert("操作成功"),t.isSubmit=!1}})}})}},deleteOfficeUser:function(t,e){t.isSubmit=!0;var i={method:"delete",url:a,data:e};common.http({vm:t,$http:o,httpOptions:i,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){n.alert("操作成功"),t.isSubmit=!1}})}})},updateOfficeUser:function(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0,t.model.id=t.id;var e={method:"put",url:a,data:t.model};common.http({vm:t,$http:o,httpOptions:e,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){n.alert("操作成功"),t.isSubmit=!1}})}})}},getDepts:function(t){var e={method:"get",url:common.format(a+"/getDepts")};common.http({vm:t,$http:o,httpOptions:e,success:function(e){t.depts={},t.depts=e.data}})},queryOffice:function(e){e.gridOptions.dataSource._skip=0,e.gridOptions.dataSource.read()}}}angular.module("app").factory("officeUserSvc",e),e.$inject=["$http","bsWin"]}(),function(){"use strict";function e(o,e,t,i){return{createParty:function(e,t){var i={method:"post",url:rootPath+"/partyManager/createParty",data:e.party};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},partyGrid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/partyManager/findByOData",$("#partyform")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.pmId)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox' />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"",title:"名称",width:100,filterable:!1,template:function(e){return"<a  ng-click=\"vm.partyDetail('"+e.pmId+"')\">"+e.pmName+"</a>"}},{field:"pmSex",title:"性别",width:50,filterable:!1},{field:"pmIDCard",title:"身份证号",width:160,filterable:!1},{field:"pmNation",title:"民族",width:50,filterable:!1},{field:"pmEducation",title:"学历",width:80,filterable:!1},{field:"pmPhone",title:"手机号",width:80,filterable:!1},{field:"pmTel",title:"固定电话",width:80,filterable:!1},{field:"",title:"人员类别",width:80,filterable:!1,template:function(e){return"1"==e.pmCategory?"正式党员":"2"==e.pmCategory?"预备党员":""}},{field:"pmJoinPartyDate",title:"入党日期",width:80,filterable:!1},{field:"pmTurnToPatryDate",title:"转正日期",width:80,filterable:!1},{field:"",title:"在编情况",width:60,filterable:!1,template:function(e){return e.isEnrolled&&"9"==e.isEnrolled?"是":"否"}},{field:"",title:"操作",width:120,template:function(e){return 9==e.curState&&!0,common.format($("#columnBtns").html(),"vm.partyDetail('"+e.pmId+"')",e.pmId,"vm.deleteParty('"+e.pmId+"')")}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})},resizable:!0}},findById:function(e,t){var i={method:"post",url:rootPath+"/partyManager/findById",params:{pmId:e}};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},updateParty:function(e,t){var i={method:"put",url:rootPath+"/partyManager/updateParty",data:e.party};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},exportPartyWord:function(e,t){var i={method:"post",url:rootPath+"/partyManager/exportPartyWord",params:{pmId:t}};common.http({$http:o,httpOptions:i,success:function(e){common.downloadReport(e.data,"党员基本信息采集表.doc","msword")}})},deleteParty:function(e,t){var i={method:"put",url:rootPath+"/partyManager/deleteParty",params:{pmId:e}};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},exportSignInSheet:function(e){var t={method:"post",url:rootPath+"/partyManager/exportSignInSheet",params:{pmIds:e}};common.http({$http:o,httpOptions:t,success:function(e){common.downloadReport(e.data,"签到表.doc","msword")}})}}}angular.module("app").factory("partySvc",e),e.$inject=["$http","$state","bsWin","$rootScope"]}(),function(){"use strict";function e(e,t,i){var o=this;o.title="党员信息录入",o.party={},o.patryId=i.params.id,o.patryId&&(o.isShow=!0,e.findById(o.patryId,function(e){(e.flag||"ok"==e.reCode)&&(o.party=e.reObj)})),o.saveParty=function(){common.initJqValidation(),$("form").valid()&&e.createParty(o,function(e){(e.flag||"ok"==e.reCode)&&t.alert("保存成功！",function(){location.href="#/partyList"})})},o.updateParty=function(){common.initJqValidation(),$("form").valid()&&e.updateParty(o,function(e){(e.flag||"ok"==e.reCode)&&t.alert("保存成功！")})}}angular.module("app").controller("partyEditCtrl",e),e.$inject=["partySvc","bsWin","$state"]}(),function(){"use strict";function e(n,a,e){var o=this;o.title="党员信息查询",n.partyGrid(o),o.partyDetail=function(e){$("#partyDetail").kendoWindow({width:"1000px",height:"600px",title:"党员信息表",visible:!1,open:function(){n.findById(e,function(e){o.party=e.reObj})},modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},o.formReset=function(){o.party={}},o.queryParty=function(){o.gridOptions.dataSource.read()},o.exportPartyWord=function(e){n.exportPartyWord(o,e)},o.deleteParty=function(e){a.confirm("删除的数据无法恢复，确定删除？",function(){n.deleteParty(e,function(e){a.alert("删除成功！"),o.gridOptions.dataSource.read()})})},o.exportSignInSheet=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)a.alert("请选择要导出数据！");else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");n.exportSignInSheet(o)}},o.importExcel=function(){$("importFile").val(""),$("#importDiv").kendoWindow({width:"500px",height:"200px",title:"导入文件",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},o.formReset=function(){var e=$("#partyform").find("input,select");$.each(e,function(e,t){t.value=""})},o.importFile=function(){var e=(i=$("#importFile").val()).split(".");if(""==i||null==e[1]||"xls"!=e[1]&&"xlsx"!=e[1])""==i?a.alert("请上传导入文件！"):a.alert("上传文件类型不匹配，请重新上传！");else{var t=new FormData,i=document.querySelector("input[type=file]").files[0];t.append("file",i),$.ajax({type:"post",url:rootPath+"/partyManager/importFile",data:t,enctype:"multipart/form-data",contentType:!1,cache:!1,processData:!1}).success(function(e){e.reObj;null!=e.reObj&&e.reObj,a.alert(e.reObj,function(){window.parent.$("#importDiv").data("kendoWindow").close(),o.gridOptions.dataSource.read()})})}}}angular.module("app").controller("partyListCtrl",e),e.$inject=["partySvc","bsWin","$state"]}(),function(){"use strict";function e(o,e,t){return{partyMeetGrid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/partyMeet/findByDataList"),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.mId)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox' />"},{field:"rowNumber",title:"序号",width:20,filterable:!1,template:"<span class='row-number'></span>"},{field:"",title:"会议标题",width:100,filterable:!1,template:function(e){return'<a  href="#/partyMeetDetail/'+e.mId+'">'+e.mTitle+"</a>"}},{field:"mDate",title:"会议时间",width:50,filterable:!1},{field:"mAddress",title:"会议地点",width:160,filterable:!1},{field:"",title:"操作",width:120,template:function(e){return 9==e.curState&&!0,common.format($("#columnBtns").html(),e.mId,"vm.deletePartyMeet('"+e.mId+"')")}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})},resizable:!0}},createPartyMeet:function(e,t){var i={method:"post",url:rootPath+"/partyMeet/createPartyMeet",data:e.partyMeet};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},findMeetById:function(e,t){var i={method:"post",url:rootPath+"/partyMeet/findMeetById",params:{mId:e}};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},updatePartyMeet:function(e,t){var i={method:"put",url:rootPath+"/partyMeet/updatePartyMeet",data:e.partyMeet};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},deletePartyMeet:function(e,t){var i={method:"delete",url:rootPath+"/partyMeet/deletePartyMeet",params:{mId:e}};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}}}angular.module("app").factory("partyMeetSvc",e),e.$inject=["$http","$state","bsWin"]}(),function(){"use strict";function e(t,i,e,o,n){var a=this;a.title="党员会议管理",a.party={},a.businessFlag={},a.id=o.params.id,a.initFileUpload=function(){a.id||e.$watch("vm.id",function(e,t){e&&e!=t&&!a.initUploadOptionSuccess&&a.initFileUpload()}),a.sysFile={businessId:a.id,mainId:a.id,mainType:"党务会议附件",sysBusiType:"",showBusiType:!1},n.initUploadOptions({inputId:"sysfileinput",vm:a,uploadSuccess:function(){n.findByBusinessId(a.id,function(e){a.sysFilelists=e})}})},function(){t.partyMeetGrid(a),a.id&&(a.isShowUpdate=!0,t.findMeetById(a.id,function(e){a.partyMeet=e}),n.findByBusinessId(a.id,function(e){a.sysFilelists=e}));a.initFileUpload()}(),a.savePartyMeet=function(){common.initJqValidation(),$("form").valid()&&t.createPartyMeet(a,function(e){(e.flag||"ok"==e.reCode)&&(a.id=e.reObj,a.isShowUpdate=!0,i.alert("保存成功！"))})},a.UpdatePartyMeet=function(){common.initJqValidation(),$("form").valid()&&t.updatePartyMeet(a,function(e){i.alert("保存成功！")})},a.deletePartyMeet=function(e){i.confirm("确定删除？",function(){t.deletePartyMeet(e,function(e){(e.flag||"ok"==e.reCode)&&(i.alert("删除成功！"),a.gridOptions.dataSource.read())})})}}angular.module("app").controller("partyMeetingCtrl",e),e.$inject=["partyMeetSvc","bsWin","$scope","$state","sysfileSvc"]}(),function(){"use strict";function e(e,i,t,o,n){var a=this;a.title="项目暂停审批",i.grid(a),n.initIdea(a),a.pauseProjectWindow=function(e,t){i.pauseProjectWindow(a,e,t)},a.commitProjectStop=function(){i.updateProjectStop(a)},a.closewin=function(){window.parent.$("#spwindow").data("kendoWindow").close()},a.selectMinisterIdea=function(){a.projectStop.directorIdeaContent+=a.directorIdea},a.selectDirectorIdea=function(){a.projectStop.leaderIdeaContent+=a.leaderIdea}}angular.module("app").controller("pauseProjectCtrl",e),e.$inject=["$location","pauseProjectSvc","$state","adminSvc","ideaSvc"]}(),function(){"use strict";function e(o,n,a){return{initProject:function(e,t){var i={method:"post",url:rootPath+"/projectStop/initProjectBySignId",params:{signId:e}};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},pauseProject:function(e,t){var i={method:"post",url:rootPath+"/projectStop/savePauseProject",data:e};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},initFlowDeal:function(t){e(t.businessKey,function(e){t.model=e,t.sign=t.model.signDispaWork})},grid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/projectStop/findByOData"),schema:{data:"value",total:function(e){return e.count?$("#PAUSE_COUNT").html(e.count):$("#PAUSE_COUNT").html(0),e.count},model:{id:"id",fields:{createdDate:{type:"date"},modifiedDate:{type:"date"}}}},serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{field:"",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"",title:"项目名称",width:200,filterable:!1,template:function(e){return e.sign.projectname}},{field:"",title:"评审阶段",width:100,filterable:!1,template:function(e){return e.sign.reviewstage}},{field:"createdDate",title:"申请日期",width:100,format:"{0:yyyy-MM-dd}",filterable:!1},{field:"",title:"操作",width:100,filterable:!1,template:function(e){return common.format($("#columnBtns").html(),e.sign.signid,e.stopid)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})}}},getProjectStopByStopId:e,updateProjectStop:function(e){if(common.initJqValidation(),$("#form").valid()){var t={method:"post",url:rootPath+"/projectStop/updateProjectStop",data:e.projectStop};common.http({vm:e,$http:o,httpOptions:t,success:function(e){a.success("操作成功"),n.go("pauseProject")}})}},findPausingProject:function(e,i){var t={method:"post",url:rootPath+"/projectStop/findPausingProject",params:{signId:i}};common.http({vm:e,$http:o,httpOptions:t,success:function(e){var t=e.data;t.flag||"ok"==t.reCode?n.go("projectStopForm",{signId:i,stopId:""}):a.alert("该项目暂停申请正在处理")}})},getListInfo:function(e,t){var i={method:"post",url:rootPath+"/projectStop/getListInfo",params:{signId:e}};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},getProjectStopBySignId:function(e,t){var i={method:"post",url:rootPath+"/projectStop/getProjectStopBySignId",params:{signId:e}};common.http({$http:o,httpOptions:i,success:function(e){if(null!=t&&"function"==typeof t)return t(e.data)}})},saveProjectStop:function(e,t){var i={method:"post",url:rootPath+"/projectStop/saveProjectStop",data:e};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}};function e(e,t){var i={method:"post",url:rootPath+"/projectStop/getProjectStopByStopId",params:{stopId:e}};common.http({$http:o,httpOptions:i,success:function(e){if(null!=t&&"function"==typeof t)return t(e.data)}})}}angular.module("app").factory("pauseProjectSvc",e),e.$inject=["$http","$state","bsWin"]}(),function(){"use strict";function e(t,e,i,o,n){var a=this;a.sign={};var r=t.params.signId;a.projectStop={},a.projectStop.signid=r,a.projectStop.stopId=t.params.stopId,a.signId=r,a.showStartFlow=!0,""!=a.projectStop.stopId&&(a.showStartFlow=!1),a.initFileUpload=function(){a.projectStop.stopid||o.$watch("vm.projectStop.stopid",function(e,t){e&&e!=t&&!a.initUploadOptionSuccess&&a.initFileUpload()}),a.sysFile={businessId:a.projectStop.stopid,mainId:a.signId,mainType:"暂停项目",sysBusiType:a.projectStop.sysBusiType,showBusiType:!1},n.initUploadOptions({inputId:"sysfileinput",vm:a,uploadSuccess:function(){n.findByBusinessId(a.projectStop.stopid,function(e){a.sysFilelists=e})}})},e.initProject(r,function(e){a.sign=e,"可行性研究报告"==a.sign.reviewstage||"项目概算"==a.sign.reviewstage?a.sign.countUsedWorkday=15-a.sign.surplusdays:a.sign.countUsedWorkday=12-a.sign.surplusdays}),e.getProjectStopBySignId(r,function(e){0<e.length&&(a.projectStop=e[0],"9"==a.projectStop.isSupplementMaterial&&(a.projectStop.sysBusiType="中心发补充材料函"),"9"==a.projectStop.isPuaseApprove&&(a.projectStop.sysBusiType="申报单位要求暂停审核函"),n.findByBusinessId(a.projectStop.stopid,function(e){a.sysFilelists=e})),a.initFileUpload()}),a.Checked=function(e,t){var i=e.target.checked;t?a.noFile=9!=i&&"9"!=i:a.noFile&&(a.projectStop.isSupplementMaterial=0,a.projectStop.isPuaseApprove=0)},a.commitProjectStop=function(){common.initJqValidation(),$("#form").valid()?(a.projectStop.processName="《"+a.sign.projectname+"》暂停申请",a.projectStop.userDays||(a.projectStop.userDays=a.sign.countUsedWorkday),a.projectStop.signid=a.sign.signid,e.pauseProject(a.projectStop,function(e){e.flag||"ok"==e.reCode?i.alert("操作成功！",function(){t.go("personDtasks")}):i.alert(e.reMsg)})):i.alert("项目暂停表填写不符合要求！")},a.saveProjectStop=function(){common.initJqValidation(),$("#form").valid()?(a.projectStop.signid=a.sign.signid,e.saveProjectStop(a.projectStop,function(e){e.flag||"ok"==e.reCode?(i.alert("操作成功！"),a.projectStop=e.reObj,"9"==a.projectStop.isSupplementMaterial&&(a.projectStop.sysBusiType="中心发补充材料函"),"9"==a.projectStop.isPuaseApprove&&(a.projectStop.sysBusiType="申报单位要求暂停审核函")):i.alert(e.reMsg)})):i.alert("项目暂停表填写不符合要求！")},a.selectMinisterIdea=function(){a.projectStop.directorIdeaContent+=a.directorIdea},a.selectDirectorIdea=function(){a.projectStop.leaderIdeaContent+=a.leaderIdea}}angular.module("app").controller("projectStopFormCtrl",e),e.$inject=["$state","pauseProjectSvc","bsWin","$scope","sysfileSvc"]}(),function(){"use strict";function e(e,t,i,o,n){var a=this;a.stopId=e.params.stopId,a.initFileUpload=function(){a.projectStop.stopid||o.$watch("vm.projectStop.stopid",function(e,t){e&&e!=t&&!a.initUploadOptionSuccess&&a.initFileUpload()}),a.sysFile={businessId:a.projectStop.stopid,mainId:a.projectStop.stopid,mainType:"暂停项目",sysBusiType:a.projectStop.sysBusiType,showBusiType:!0},n.initUploadOptions({inputId:"sysfileinput",vm:a,uploadSuccess:function(){n.findByBusinessId(a.projectStop.stopid,function(e){a.sysFilelists=e})}})},t.getProjectStopByStopId(a.stopId,function(e){a.projectStop=e,a.sign=a.projectStop.signDispaWork,a.sign.countUsedWorkday=a.sign.reviewdays-a.sign.surplusdays,"9"==a.projectStop.isSupplementMaterial&&(a.projectStop.sysBusiType="中心发补充材料函"),"9"==a.projectStop.isPuaseApprove&&(a.projectStop.sysBusiType="申报单位要求暂停审核函"),n.findByBusinessId(a.projectStop.stopid,function(e){a.sysFilelists=e}),a.initFileUpload()}),a.saveProjectStop=function(){common.initJqValidation(),$("#form").valid()?t.saveProjectStop(a.projectStop,function(e){e.flag||"ok"==e.reCode?i.alert("操作成功！"):i.alert(e.reMsg)}):i.alert("项目暂停表填写不符合要求！")}}angular.module("app").controller("projectStopFormEditCtrl",e),e.$inject=["$state","pauseProjectSvc","bsWin","$scope","sysfileSvc"]}(),function(){"use strict";function e(e,t){var i=this,o=e.params.signId;i.sign={},t.initProject(o,function(e){i.sign=e,i.sign.countUsedWorkday=i.sign.reviewdays-i.sign.surplusdays}),t.getListInfo(o,function(e){i.projectStopList=e})}angular.module("app").controller("projectStopInfoCtrl",e),e.$inject=["$state","pauseProjectSvc"]}(),function(){"use strict";function e(t,i,o,n,e,a){var r=this;r.title="个人代办",r.model={},i.getUser(function(e){r.model=e,i.initAllUser(function(e){r.takeUserList=e,r.initTaskUser(r.model.takeUserId)}),o.getAllTaskList(r.model.id,function(e){e.ruTaskList&&(r.ruTaskList=e.ruTaskList),e.ruProcessTaskList&&(r.ruProcessTaskList=e.ruProcessTaskList)})}),i.agentGrid(r),r.queryAgentList=function(){r.agentGridOptions.dataSource._skip=0,r.agentGridOptions.dataSource.read()},r.formReset=function(){r.querymodel={}},r.cancelTakeUser=function(){r.model.takeUserId?t.confirm({title:"询问提示",message:"确认取消代办人么？",onOk:function(){i.cancelTakeUser(function(){r.model.takeUserId="",r.taskUserName="",t.alert("操作成功!")})}}):t.alert("你还没有设置代办人！")},r.saveTakeUser=function(){r.takeUserId?i.saveTakeUser(r.takeUserId,function(e){(e.flag||"ok"==e.reCode)&&(r.model.takeUserId=r.takeUserId,r.initTaskUser(r.takeUserId),t.alert("操作成功！"))}):t.alert("请选择代办人！")},r.initTaskUser=function(i){angular.forEach(r.takeUserList,function(e,t){e.id==i&&(r.taskUserName=e.displayName,r.takeUserId=i)})},r.transTask=function(e){r.takeUserId?r.takeUserId==r.model.takeUserId?n.transTask(e,r.model.id,r.model.takeUserId,function(e){e.flag||"ok"==e.reCode?(o.getAllTaskList(r.model.id,function(e){e.ruTaskList&&(r.ruTaskList=e.ruTaskList),e.ruProcessTaskList&&(r.ruProcessTaskList=e.ruProcessTaskList)}),t.alert("操作成功！")):t.alert(e.reMsg)}):t.alert("您设置的待办人有更改，请保存后再操作！"):t.alert("您还没设置代办人，不能进行任务转办")}}angular.module("app").controller("takeUserCtrl",e),e.$inject=["bsWin","takeUserSvc","userSvc","flowSvc","$state","$rootScope"]}(),function(){"use strict";function e(n){return{initAllUser:function(t){var e={method:"post",url:rootPath+"/user/getAllUserDisplayName"};common.http({$http:n,httpOptions:e,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},saveTakeUser:function(e,t){var i={method:"post",url:rootPath+"/user/saveTakeUser",params:{takeUserId:e}};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},getUser:function(t){var e={method:"post",url:rootPath+"/user/findCurrentUser"};common.http({$http:n,httpOptions:e,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},cancelTakeUser:function(t){var e={method:"get",url:rootPath+"/user/cancelTakeUser"};common.http({$http:n,httpOptions:e,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},initZtreeClient:function(o){var e={method:"post",url:rootPath+"/role/findAllRoles"};common.http({vm:o,$http:n,httpOptions:e,success:function(i){common.requestSuccess({vm:o,response:i,fn:function(){var e=$linq(i.data).select(function(e){return{id:e.id,name:e.roleName}}).toArray(),t={id:"",name:"角色集合",children:e};$.fn.zTree.init($("#zTree"),{check:{chkboxType:{Y:"ps",N:"ps"},enable:!0}},t),a(o)}})}})},updateZtree:a,agentGrid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/personalCenter/findByOData",$("#searchform")),schema:common.kendoGridConfig().schema({id:"agentId",fields:{transDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"transDate",dir:"desc"}});e.agentGridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:[{field:"",title:"序号",width:50,attributes:{style:"text-align: center;"},template:function(){return"<span class='row-number'></span>"}},{field:"flowName",title:"流程名称",filterable:!1},{field:"nodeNameValue",title:"代办环节",filterable:!1,width:120},{field:"transDate",title:"转办时间",filterable:!1,width:220,format:"{0: yyyy-MM-dd}"},{field:"userName",title:"原处理人",width:100,filterable:!1}],resizable:!0,dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})}}}};function a(e){for(var t=$.fn.zTree.getZTreeObj("zTree"),i=$linq(e.model.roleDtoList).select(function(e){return e.roleName}).toArray(),o=t.getNodesByParam("level",1,null),n=$linq(o).where(function(e){return $linq(i).contains(e.name)}).toArray(),a=0,r=n.length;a<r;a++)t.checkNode(n[a],!0,!0)}}angular.module("app").factory("takeUserSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(t,n,a,i,o,r){var l=this;l.title="评审费发放",l.reviewFee={},l.stateName=i.current.name,l.queryParams={},l.saveView=function(){o.storeView(l.stateName,{gridParams:l.gridOptions.dataSource.transport.options.read.data(),queryParams:l.queryParams,data:l})},function(){if(o.view[l.stateName]){var e=o.view[l.stateName];e.gridParams&&(l.gridParams=e.gridParams),e.data&&(l.reviewFee=e.data.reviewFee),e.queryParams&&(l.queryParams=e.queryParams),t.projectGrid(l),o.view[l.stateName]=void 0}else t.projectGrid(l)}(),l.query=function(){l.gridOptions.dataSource._skip=0,l.gridOptions.dataSource.read()},l.dealWindow=function(e){t.findExpertReview(l,e,function(e){l.expertReview=e,l.expertReview.payDate=(new Date).Format("yyyy-MM-dd"),$("#payFromWindow").kendoWindow({width:"70%",height:"600px",title:"专家评审费发放",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()})},l.countTaxes=function(s){if(null!=s)if(null!=s.payDate){if(/^(\d{4}-\d{1,2}-\d{1,2})$/.exec(s.payDate))if(null!=s.expertSelectedDtoList&&0!=s.expertSelectedDtoList.length)if(common.initJqValidation($("#payform")),$("#payform").valid()){var e,i=s.expertSelectedDtoList.length,o="";$.each(s.expertSelectedDtoList,function(e,t){o+="'"+t.id+"'",e!=i-1&&(o+=",")});var t=s.payDate;e=t.substring(0,t.lastIndexOf("-")),n.countTaxes(o,e,function(e){var r=e;s.reviewCost=0,s.reviewTaxes=0,s.totalCost=0,$.each(s.expertSelectedDtoList,function(e,t){if("9"==t.isConfrim&&"9"==t.isJoin){var i=t.EXPERTID,o=t.id,n=0;null!=r&&0<r.length&&r.forEach(function(e,t){e.EXPERTID==i&&e.ESID!=o&&(e.REVIEWCOST=null==e.REVIEWCOST?0:e.REVIEWCOST,e.REVIEWCOST=parseFloat(e.REVIEWCOST),n=parseFloat(n)+e.REVIEWCOST)}),t.reviewCost=null==t.reviewCost?0:t.reviewCost;var a=n+parseFloat(t.reviewCost);t.reviewTaxes=function(e){e=null==e?0:e;var t=0;800<e&&e<=4e3?t=.2*(e-800):4e3<e&&e<=2e4?t=.8*e*.2:2e4<e&&e<=5e4&&(t=.8*e*.3-2e3);return t}(a).toFixed(2),t.totalCost=(parseFloat(t.reviewCost)+parseFloat(t.reviewTaxes)).toFixed(2),s.reviewCost=(parseFloat(s.reviewCost)+parseFloat(t.reviewCost)).toFixed(2),s.reviewTaxes=(parseFloat(s.reviewTaxes)+parseFloat(t.reviewTaxes)).toFixed(2),s.totalCost=(parseFloat(s.reviewCost)+parseFloat(s.reviewTaxes)).toFixed(2)}}),n.savePayment(s,l.isCommit,function(e){e.flag||"ok"==e.reCode?a.alert("操作成功！",function(){l.isCommit=!1,window.parent.$("#payFromWindow").data("kendoWindow").close(),l.gridOptions.dataSource.read()}):a.alert(e.reMsg)})})}else a.alert("请正确填写专家评审费信息！");else a.alert("该方案还没评审专家");else a.alert("请输入正确的日期格式")}else a.alert("请选择评审费发放日期")},l.savePayment=function(e){if(common.initJqValidation($("#payform")),$("#payform").valid()){if(e.expertSelectedDtoList)for(var t=!1,i=0;i<e.expertSelectedDtoList.length;i++)if(0==e.expertSelectedDtoList[i].reviewCost)t=!0;else{if(null==e.expertSelectedDtoList[i].expertDto.bankAccount||null==e.expertSelectedDtoList[i].expertDto.openingBank){t=!1;break}t=!0}else t=!0;t?n.savePayment(e,l.isCommit,function(e){e.flag||"ok"==e.reCode?a.alert("操作成功！",function(){l.isCommit=!1}):a.alert(e.reMsg)}):a.alert("评审费不为0的专家，开户行和银行账户不完整，请写完整！")}else a.alert("请正确填写专家评审费信息！")},l.detail=function(t,e){l.saveView(),"SIGN"==e.trim()&&r.initFlowPageData(t,function(e){l.model=e,i.go("signDetails",{signid:t,processInstanceId:l.model.processInstanceId})}),"TOPIC"==e.trim()&&i.go("flowDetail",{businessKey:t})}}angular.module("app").controller("reviewFeeCtrl",e),e.$inject=["reviewFeeSvc","expertReviewSvc","bsWin","$state","$rootScope","signSvc"]}(),function(){"use strict";function e(n){return{projectGrid:function(e){var t=common.kendoGridDataSource(rootPath+"/reviewFee/findReviewFee",$("#reviewFeeForm"),e.queryParams.page,e.queryParams.pageSize,e.gridParams),i=[{field:"",title:"序号",template:"<span class='row-number'></span>",width:50},{field:"reviewTitle",title:"评审费标题",width:"40%",filterable:!1},{field:"",title:"评审费类型",width:"20%",filterable:!1,template:function(e){return e.businessType&&"SIGN"==e.businessType.trim()?"项目评审费":e.businessType&&"TOPIC"==e.businessType.trim()?"课题评审费":""}},{field:"reviewDate",title:"评审(函评)日期",width:"15%",filterable:!1,format:"{0: yyyy-MM-dd}"},{field:"",title:"操作",width:"20%",template:function(e){return common.format($("#columnBtns").html(),"vm.dealWindow('"+e.businessId+"')","vm.detail('"+e.businessId+"','"+e.businessType+"')")}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,pageable:common.kendoGridConfig(e.queryParams).pageable,dataBound:common.kendoGridConfig(e.queryParams).dataBound,resizable:!0}},findExpertReview:function(e,t,i){var o={method:"post",url:rootPath+"/expertReview/initBybusinessId",params:{businessId:t,minBusinessId:""}};common.http({vm:e,$http:n,httpOptions:o,success:function(e){null==i&&"function"!=typeof i||i(e.data)}})}}}angular.module("app").factory("reviewFeeSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(t,i){var o=this;o.title="定时器配置",i.grid(o),o.addQuartz=function(){o.quartz={},$("#quartz_edit_div").kendoWindow({width:"680px",height:"400px",title:"定时器编辑",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},o.edit=function(e){$("#quartz_edit_div").kendoWindow({width:"600px",height:"400px",title:"定时器修改",visible:!1,modal:!0,open:function(){i.getQuartzById(e,function(e){o.quartz=e})},closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},o.colseQuartz=function(){window.parent.$("#quartz_edit_div").data("kendoWindow").close()},o.saveQuartz=function(){common.initJqValidation($("#quartz_form")),$("#quartz_form").valid()&&i.saveQuartz(o.quartz,function(e){e.flag||"ok"==e.reCode?t.alert("操作成功！",function(){o.colseQuartz(),o.gridOptions.dataSource.read()}):t.alert(e.reMsg)})},o.execute=function(e){i.quartzExecute(e,function(e){e.flag||"ok"==e.reCode?t.alert("操作成功！",function(){o.gridOptions.dataSource.read()}):t.alert(e.reMsg)})},o.stop=function(e){i.quartzStop(e,function(e){e.flag||"ok"==e.reCode?t.alert("操作成功！",function(){o.gridOptions.dataSource.read()}):t.alert(e.reMsg)})},o.del=function(e){t.confirm("确认删除？删除数据无法恢复，请谨慎操作！",function(){i.deleteQuartz(e,function(e){e.flag||"ok"==e.reCode?t.alert("操作成功！",function(){o.gridOptions.dataSource.read()}):t.alert(e.reMsg)})})},o.runOnce=function(e){i.runOnce(e,function(e){e.flag||"ok"==e.reCode?t.alert("操作成功！"):t.alert(e.reMsg)})}}angular.module("app").controller("quartzCtrl",e),e.$inject=["bsWin","quartzSvc"]}(),function(){"use strict";function e(o){var n=rootPath+"/quartz";return{grid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/quartz/findByOData"),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"quartzName",title:"定时任务名称",width:220,filterable:!1},{field:"cronExpression",title:"时间表达式",width:150,filterable:!1},{field:"",title:"当前状态",width:80,filterable:!1,template:function(e){return e.curState?"9"==e.curState?"<span class='label label-success'>正在执行</span>":"0"==e.curState?"<span class='label label-warning'>已暂停</span>":void 0:""}},{field:"descInfo",title:"描述",width:120,filterable:!1},{field:"",title:"操作",width:280,template:function(e){var t=!1;return 9==e.curState&&(t=!0),common.format($("#columnBtns").html(),"vm.edit('"+e.id+"')","vm.execute('"+e.id+"')",!t,"vm.stop('"+e.id+"')",t,"vm.runOnce('"+e.id+"')",t)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})},resizable:!0}},getQuartzById:function(e,t){var i={method:"post",url:rootPath+"/quartz/html/findById",params:{id:e}};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},saveQuartz:function(e,t){var i={method:"post",url:rootPath+"/quartz",data:e};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},deleteQuartz:function(e,t){var i={method:"delete",url:n,params:{id:e}};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},quartzExecute:function(e,t){var i={method:"put",url:n+"/quartzExecute",params:{quartzId:e}};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},quartzStop:function(e,t){var i={method:"post",url:n+"/quartzStop",params:{quartzId:e}};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},runOnce:function(e,t){var i={method:"post",url:n+"/runOne",params:{quartzId:e}};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}}}angular.module("app").factory("quartzSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t){var n=this;n.title="角色列表",n.del=function(e){common.confirm({vm:n,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteRole(n,e)}})},n.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:n,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");n.del(o)}},t.grid(n)}angular.module("app").controller("roleCtrl",e),e.$inject=["$location","roleSvc"]}(),function(){"use strict";function e(e,t,i){var o=this;o.title="添加角色",o.isRoleExist=!1,o.id=i.params.id,o.id&&(o.isUpdate=!0,o.title="更新角色"),o.create=function(){t.createRole(o)},o.update=function(){t.updateRole(o)},o.checkRole=function(){t.checkRole(o)},o.isUpdate?t.getRoleById(o):t.initZtreeClient(o)}angular.module("app").controller("roleEditCtrl",e),e.$inject=["$location","roleSvc","$state"]}(),function(){"use strict";function e(n,e){var a=rootPath+"/role",r="#/role",t=rootPath+"/sys/resource";return{grid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(a+"/fingByOData"),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:70,filterable:!1,template:"<span class='row-number'></span>"},{field:"roleName",title:"角色名称",width:200,filterable:!1},{field:"remark",title:"描述",filterable:!1},{field:"createdDate",title:"创建时间",width:180,filterable:!1,format:"{0:yyyy-MM-dd HH:mm:ss}"},{field:"",title:"操作",width:180,template:function(e){return common.format($("#columnBtns").html(),"vm.del('"+e.id+"')",e.id)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})},resizable:!0}},createRole:function(t){if(common.initJqValidation(),$("form").valid()&&0==t.isRoleExist){t.isSubmit=!0;var e=s(),i=$linq(e).where(function(e){return 0==e.isParent}).select(function(e){return{id:e.id,name:e.name,path:e.path,method:e.method}}).toArray();t.model.resources=i;var o={method:"post",url:a,data:t.model};common.http({vm:t,$http:n,httpOptions:o,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=r}})}})}})}},checkRole:function(e){},getRoleById:function(t){var e={method:"post",url:rootPath+"/role/findById",params:{roleId:t.id}};common.http({vm:t,$http:n,httpOptions:e,success:function(e){t.model=e.data,t.isUpdate&&i(t)}})},updateRole:function(t){if(common.initJqValidation(),$("form").valid()&&0==t.isRoleExist){t.isSubmit=!0,t.model.id=t.id;var e=s(),i=$linq(e).where(function(e){return!0}).select(function(e){return{id:e.id,name:e.name,path:e.path,method:e.method}}).toArray();t.model.resources=i;var o={method:"put",url:a,data:t.model};common.http({vm:t,$http:n,httpOptions:o,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})}})}},deleteRole:function(t,e){t.isSubmit=!0;var i={method:"delete",url:a,data:e};common.http({vm:t,$http:n,httpOptions:i,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})}})},initZtreeClient:i};function s(){return $.fn.zTree.getZTreeObj("zTree").getCheckedNodes(!0)}function i(i){var e={method:"get",url:t};common.http({vm:i,$http:n,httpOptions:e,success:function(t){common.requestSuccess({vm:i,response:t,fn:function(){var e=t.data;$.fn.zTree.init($("#zTree"),{check:{chkboxType:{Y:"ps",N:"ps"},enable:!0}},e),i.isUpdate&&function(e){for(var t=$.fn.zTree.getZTreeObj("zTree"),i=$linq(e.model.resources).select(function(e){return e.path}).toArray(),o=t.getNodesByParam("level",1,null),n=$linq(o).where(function(e){return $linq(i).contains(e.path)}).toArray(),a=0,r=n.length;a<r;a++)t.checkNode(n[a],!0,!0)}(i)}})}})}}angular.module("app").factory("roleSvc",e),e.$inject=["$http","$compile"]}(),function(){"use strict";function e(e){var t=this;t.approve=!0,t.idea=!1,t.appraise={},e.approveListGrid(t)}angular.module("app").controller("approveListCtrl",e),e.$inject=["reviewProjectAppraiseSvc"]}(),function(){"use strict";function e(t,i,o){var n=this,e=t.params.signId;n.model={},i.initBySignId(e,function(e){n.model=e}),n.commitApprove=function(){common.initJqValidation(),$("#form").valid()?i.saveApply(n.model,function(e){e.flag||"ok"==e.reCode?(n.model=e.reObj,i.startFlow(n.model.id,function(e){(e.flag||"ok"==e.reCode)&&o.success("操作成功！",function(){t.go("personDtasks")})})):o.alert(e.reMsg)}):o.alert("优秀评审报告填报表单未填写正确！")}}angular.module("app").controller("approveWindowCtrl",e),e.$inject=["$state","reviewProjectAppraiseSvc","bsWin"]}(),function(){"use strict";function e(e,t,i){var o=this,n=e.params.id;o.model={},o.addApprove=function(){t.saveApply(o.model,function(){i.alert("操作成功")})},t.getAppraiseById(n,function(e){o.model=e})}angular.module("app").controller("approveWindowEditCtrl",e),e.$inject=["$state","reviewProjectAppraiseSvc","bsWin"]}(),function(){"use strict";function e(t,i,e,o){var n=this;n.title="优秀评审报告列表",n.orgDeptList=[],n.model={},n.stateName=e.current.name,n.queryParams={},n.saveView=function(){o.storeView(n.stateName,{gridParams:n.gridOptions.dataSource.transport.options.read.data(),queryParams:n.queryParams,data:n})},function(){if(t.initSignList(function(e){(e.flag||"ok"==e.reCode)&&(n.orgDeptList=e.reObj)}),o.view[n.stateName]){var e=o.view[n.stateName];e.gridParams&&(n.gridParams=e.gridParams),e.data&&(n.model=e.data.model),e.queryParams&&(n.queryParams=e.queryParams),i.appraisingProjectGrid(n),o.view[n.stateName]=void 0}else i.appraisingProjectGrid(n)}(),n.searchSignList=function(){n.saveView(),n.gridOptions.dataSource._skip=0,n.gridOptions.dataSource.read()},n.formReset=function(){n.model={}}}angular.module("app").controller("reviewProjectAppraiseCtrl",e),e.$inject=["adminSvc","reviewProjectAppraiseSvc","$state","$rootScope"]}(),function(){"use strict";function e(o,e,t){return{initBySignId:function(e,t){var i={method:"post",url:rootPath+"/reviewProjectAppraise/initBySignId",params:{signId:e}};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},appraisingProjectGrid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/reviewProjectAppraise/findAppraisingProject",$("#searchform"),e.gridParams),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:e.queryParams.pageSize||10,page:e.queryParams.page||1});e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,pageable:common.kendoGridConfig(e.queryParams).pageable,dataBound:common.kendoGridConfig(e.queryParams).dataBound,columns:[{field:"",title:"序号",template:"<span class='row-number'></span>",width:50},{field:"",title:"项目名称",width:160,filterable:!1,template:function(e){return e.processInstanceId?'<a href="#/signDetails/'+e.signid+"/"+e.processInstanceId+'" >'+e.projectname+"</a>":'<a href="#/signDetails/'+e.signid+'/" >'+e.projectname+"</a>"}},{field:"reviewstage",title:"评审阶段",width:140,filterable:!1},{field:"signdate",title:"收文日期",width:200,filterable:!1},{field:"dispatchDate",title:"发文日期",width:160,filterable:!1},{field:"reviewOrgName",title:"评审部门",width:140,filterable:!1},{field:"aUserName",title:"项目负责人",width:140,filterable:!1},{field:"ffilenum",title:"归档编号",width:140,filterable:!1},{field:"dfilenum",title:"文件字号",width:140,filterable:!1},{field:"appalyInvestment",title:"申报投资",width:140,filterable:!1},{field:"authorizeValue",title:"审定投资",width:140,filterable:!1},{field:"extraValue",title:"核减（增）投资",width:140,filterable:!1},{field:"extraRate",title:"核减率",width:140,filterable:!1},{field:"approveValue",title:"批复金额",width:140,filterable:!1},{field:"dispatchType",title:"发文类型",width:140,filterable:!1},{field:"fileDate",title:"归档日期",width:140,filterable:!1},{field:"builtcompanyname",title:"建设单位",width:140,filterable:!1}],resizable:!0}},appraiseWindow:function(e){$("#appraiseWindow").kendoWindow({width:"800px",height:"400px",title:"评审报告评优申请",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},saveApply:function(e,t){var i={method:"post",url:rootPath+"/reviewProjectAppraise/saveApply",data:e};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},approveListGrid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/reviewProjectAppraise/getAppraiseReport"),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{field:"",title:"序号",template:"<span class='row-number'></span>",width:50},{field:"",title:"项目名称",width:160,filterable:!1,template:function(e){return e.processInstanceId?'<a href="#/signDetails/'+e.signid+"/"+e.processInstanceId+'" >'+e.projectName+"</a>":'<a href="#/signDetails/'+e.signid+'/" >'+e.projectName+"</a>"}},{field:"appraiseReportName",title:"评审报告名称",width:160,filterable:!1},{field:"proposerName",title:"申请人",width:160,filterable:!1},{field:"proposerTime",title:"申请时间",width:160,filterable:!1,format:"{0: yyyy-MM-dd}"},{field:"",title:"操作",width:100,template:function(e){return common.format($("#columnBtns").html(),e.signid,e.projectname,e.id)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})}}},getAppraiseById:i,startFlow:function(e,t){var i={method:"post",url:rootPath+"/reviewProjectAppraise/startFlow",params:{id:e}};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},initFlowDeal:function(t){i(t.businessKey,function(e){t.model=e})}};function i(e,t){var i={method:"post",url:rootPath+"/reviewProjectAppraise/getAppraiseById",params:{id:e}};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}}angular.module("app").factory("reviewProjectAppraiseSvc",e),e.$inject=["$http","bsWin","$state"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.title="资料共享详情页",n.model={},n.model.sharId=t.params.sharId,n.downloadSysFile=function(e){i.downloadFile(e)},o.getSharingDetailById(n,n.model.sharId),i.findByBusinessId(n.model.sharId,function(e){n.sysFilelists=e})}angular.module("app").controller("sharingDetailCtrl",e),e.$inject=["$location","$state","sysfileSvc","sharingPlatlformSvc"]}(),function(){"use strict";function e(e,t,i,o,n,a){var r=this;r.title="共享资料管理",r.stateName=t.current.name,r.queryParams={},r.saveView=function(){n.storeView(r.stateName,{gridParams:r.gridOptions.dataSource.transport.options.read.data(),queryParams:r.queryParams,data:r})},function(){if(n.view[r.stateName]){var e=n.view[r.stateName];e.gridParams&&(r.gridParams=e.gridParams),e.data&&(r.model=e.data.model),e.queryParams&&(r.queryParams=e.queryParams),o.grid(r),n.view[r.stateName]=void 0}else o.grid(r)}(),r.del=function(e){common.confirm({vm:r,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),o.deleteSharingPlatlform(r,e)}})},r.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:r,msg:"请选择要删除的数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");r.del(o)}},r.bathPublish=function(){o.updatePublish(r,!0)},r.bathDown=function(){o.updatePublish(r,!1)},r.querySharing=function(){r.gridOptions.dataSource._skip=0,r.gridOptions.dataSource.read()},r.resetSharing=function(){var e=$("#formSharing").find("input,select");$.each(e,function(e,t){t.value=""})}}angular.module("app").controller("sharingPlatlformCtrl",e),e.$inject=["$location","$state","$http","sharingPlatlformSvc","$rootScope","monthlyMultiyearSvc"]}(),function(){"use strict";function e(t,e,i,o){var n=this;n.title="新增共享资料",n.model={},n.businessFlag={isUpdate:!1,isLoadModel:!1,isLoadOrgUser:!1},n.model.sharId=e.params.sharId,n.model.sharId&&(n.businessFlag.isUpdate=!0,n.title="更改共享资料"),n.initFileUpload=function(){n.model.sharId||o.$watch("vm.model.sharId",function(e,t){e&&e!=t&&!n.initUploadOptionSuccess&&n.initFileUpload()}),n.sysFile={businessId:n.model.sharId,mainId:n.model.sharId,mainType:i.mainTypeValue().SHARE,showBusiType:!1},i.initUploadOptions({inputId:"sysfileinput",vm:n,uploadSuccess:function(){i.findByBusinessId(n.model.sharId,function(e){n.sysFilelists=e})}})},function(){n.model.sharId?t.getSharingPlatlformById(n,function(e){n.model=e,n.businessFlag.isLoadModel=!0,t.initSeleObj(n),i.findByBusinessId(n.model.sharId,function(e){n.sysFilelists=e,n.initFileUpload()})}):n.initFileUpload();t.initOrgAndUser(n)}(),n.resetSharing=function(){var e=$("#formSharing").find("input,select");$.each(e,function(e,t){t.value=""})},n.create=function(){t.createSharingPlatlform(n)},n.checkBox=function(e){var t=e.target,i=t.checked,o=t.value;i?$('input[tit="'+o+'"]').each(function(){$(this).attr("disabled","disabled"),$(this).removeAttr("checked")}):$('input[tit="'+o+'"]').each(function(){$(this).removeAttr("disabled")})},n.checkDeptBox=function(e,t){for(var i=e.target.checked,o=[],n=0,a=t.userDtoList.length;n<a;n++)o.push(t.userDtoList[n].id);i?$('input[name="shareUser"]').each(function(e,t){-1<jQuery.inArray(t.value,o)&&($(this).attr("disabled","disabled"),$(this).removeAttr("checked"))}):$('input[name="shareUser"]').each(function(e,t){-1<jQuery.inArray(t.value,o)&&$(this).removeAttr("disabled")})}}angular.module("app").controller("sharingPlatlformEditCtrl",e),e.$inject=["sharingPlatlformSvc","$state","sysfileSvc","$scope"]}(),function(){"use strict";function e(c,d){var o=rootPath+"/sharingPlatlform";return{grid:function(e){var t=common.kendoGridDataSource(o+"/findByCurUser",$("#formSharing"),e.queryParams.page,e.queryParams.pageSize,e.gridParams),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.sharId)},filterable:!1,width:30,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"unitSort",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"theme",title:"主题",width:"35%",filterable:!1},{field:"publishUsername",title:"发布人",width:"10%",filterable:!1},{field:"publishDate",title:"发布时间",format:"{0:yyyy-MM-dd hh24:mm:ss}",width:"18%",filterable:!1},{field:"isPublish",title:"发布状态",width:"12%",template:function(e){return e.isPublish&&9==e.isPublish?"已发布":"未发布"},filterable:!1},{field:"",title:"操作",width:"20%",template:function(e){return common.format($("#columnBtns").html(),e.sharId,e.sharId,"vm.del('"+e.sharId+"')")}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,pageable:common.kendoGridConfig(e.queryParams).pageable,dataBound:common.kendoGridConfig(e.queryParams).dataBound,columns:i,resizable:!0}},getSharingPlatlformById:function(e,t){var i={method:"get",url:o+"/html/findById",params:{id:e.model.sharId}};common.http({vm:e,$http:c,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},createSharingPlatlform:function(t){if($("form").valid()){if(t.isSubmit=!0,9!=t.model.isNoPermission){t.model.privilegeDtoList=[];var e=$("input[name='shareOrg']:checked");if(0<e.length)for(var i=0;i<e.length;i++){var o={};o.businessId=e[i].value,o.businessType="1",t.model.privilegeDtoList.push(o)}var n=$("input[name='shareUser']:not(:disabled):checked");if(0<n.length)for(var i=0;i<n.length;i++){var a={};a.businessId=n[i].value,a.businessType="2",t.model.privilegeDtoList.push(a)}var r=$("input[name='shareDept']:checked");if(0<r.length)for(var i=0;i<r.length;i++){var s={};s.businessId=r[i].value,s.businessType="3",t.model.privilegeDtoList.push(s)}}var l={method:"post",url:rootPath+"/sharingPlatlform/saveSharing",data:t.model};common.http({$http:c,httpOptions:l,success:function(e){t.isSubmit=!1,t.model.sharId=e.data.sharId,d.alert("操作成功")},onError:function(){t.isSubmit=!1}})}},deleteSharingPlatlform:function(t,e){t.isSubmit=!0;var i={method:"delete",url:o+"/sharingDelete",data:e};common.http({vm:t,$http:c,httpOptions:i,success:function(e){t.isSubmit=!1,t.gridOptions.dataSource.read(),d.alert("操作成功")}})},getSharingDetailById:function(t,e){var i={method:"get",url:o+"/html/sharingDeatilById",params:{id:e}};common.http({vm:t,$http:c,httpOptions:i,success:function(e){t.model=e.data}})},initOrgAndUser:function(t){var e={method:"post",url:rootPath+"/sharingPlatlform/initOrgAndUser"};common.http({vm:t,$http:c,httpOptions:e,success:function(e){t.shareOrgList=e.data.orgDtoList,t.deptDtoList=e.data.deptDtoList,t.noOrgUsetList=e.data.noOrgUserList,t.businessFlag.isLoadOrgUser=!0,i(t)}})},initSeleObj:i,updatePublish:function(t,e){var i=common.getKendoCheckId(".grid");if(0==i.length)common.alert({vm:t,msg:"请选择要批量发布的数据"});else{for(var o=[],n=0;n<i.length;n++)o.push(i[n].value);var a={method:"post",url:rootPath+"/sharingPlatlform/updatePublish",params:{ids:o.join(","),status:1==e?"9":"0"}};common.http({vm:t,$http:c,httpOptions:a,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read(),common.alert({vm:t,msg:"操作成功",closeDialog:!0})}})}})}}};function i(o){if(o.businessFlag.isLoadOrgUser&&o.businessFlag.isLoadModel&&(!o.model.isNoPermission||"9"!=o.model.isNoPermission)&&o.shareOrgList&&0<o.shareOrgList.length){if(o.model.privilegeDtoList&&0<o.model.privilegeDtoList.length){var n=[];o.shareOrgList.forEach(function(t,e){o.model.privilegeDtoList.forEach(function(i,e){1==i.businessType||"1"==i.businessType?i.businessId==t.id&&(t.isChecked=!0,t.userDtos.forEach(function(e,t){e.isDisabled=!0,n.push(e)})):2!=i.businessType&&"2"!=i.businessType||t.userDtos.forEach(function(e,t){i.businessId==e.id&&(e.isChecked=!0)})})});var a=[];o.deptDtoList.forEach(function(i,e){o.model.privilegeDtoList.forEach(function(e,t){3!=e.businessType&&"3"!=e.businessType||e.businessId==i.id&&(i.isChecked=!0,i.userDtoList.forEach(function(e,t){a.push(e.id)}))})}),a&&0<a.length&&o.shareOrgList.forEach(function(e,t){e.userDtos.forEach(function(e,t){n.push(e)})}),n.forEach(function(e,t){-1<jQuery.inArray(e.id,a)&&(e.isDisabled=!0)})}o.noOrgUsetList&&0<o.noOrgUsetList.length&&null!=o.model.privilegeDtoList&&o.noOrgUsetList.forEach(function(i,e){o.model.privilegeDtoList.forEach(function(e,t){2!=e.businessType&&"2"!=e.businessType||e.businessId!=i.id||(i.isChecked=!0)})}),o.businessFlag.isInitSeled=!0}}}angular.module("app").factory("sharingPlatlformSvc",e),e.$inject=["$http","bsWin"]}(),function(){"use strict";function e(e,t,i,o,n){var a=this;a.title="共享资料列表",a.model={},a.stateName=t.current.name,a.queryParams={},a.saveView=function(){n.storeView(a.stateName,{gridParams:a.gridOptions.dataSource.transport.options.read.data(),queryParams:a.queryParams,data:a})},function(){if(n.view[a.stateName]){var e=n.view[a.stateName];e.gridParams&&(a.gridParams=e.gridParams),e.data&&(a.model=e.data.model),e.queryParams&&(a.queryParams=e.queryParams),o.grid(a),n.view[a.stateName]=void 0}else o.grid(a)}(),a.findSharing=function(){a.gridOptions.dataSource._skip=0,a.gridOptions.dataSource.read()},a.resetShared=function(){var e=$("#formSharingPub").find("select");$.each(e,function(e,t){t.value=""})}}angular.module("app").controller("sharingPlatlformYetCtrl",e),e.$inject=["$location","$state","$http","sharingPlatlformYetSvc","$rootScope"]}(),function(){"use strict";function e(e){return{grid:function(e){var t=common.kendoGridDataSource(rootPath+"/sharingPlatlform/findByReception",$("#formSharingPub"),e.queryParams.page,e.queryParams.pageSize,e.gridParams),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.sharId)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"unitSort",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"theme",title:"共享主题",width:180,filterable:!0},{field:"publishUsername",title:"发布人",width:100,filterable:!0},{field:"publishDate",title:"发布时间",width:100,filterable:!0},{field:"",title:"操作",width:140,template:function(e){return common.format($("#columnBtns").html(),e.sharId)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,pageable:common.kendoGridConfig(e.queryParams).pageable,dataBound:common.kendoGridConfig(e.queryParams).dataBound,resizable:!0}}}}angular.module("app").factory("sharingPlatlformYetSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t){var i=this;i.title="预定会议统计列表",i.queryRoomCount=function(){t.queryRoomCount(i)},i.ResetRoomCount=function(){t.cleanValue()},t.grid(i),t.roomList(i),t.findAllUsers(i,function(e){i.userlist={},i.userlist=e}),e.initSignList(function(e){(e.flag||"ok"==e.reCode)&&(i.orgDeptList=e.reObj)})}angular.module("app").controller("roomCountCtrl",e),e.$inject=["adminSvc","roomCountSvc"]}(),function(){"use strict";function e(o,e){rootPath;var n=rootPath+"/room",a=rootPath+"/user";a=rootPath+"/user";return{grid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(n+"/fingByOData",$("#roomCountform")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"rbName",title:"会议名称",width:"30%",filterable:!1},{field:"addressName",title:"会议室地点",width:"20%",filterable:!1},{field:"rbDay",title:"会议日期",width:"10%",filterable:!1},{field:"",title:"会议开始时间",width:"10%",filterable:!1,template:function(e){return e.beginTime?new Date(e.beginTime.CompatibleDate()).Format("hh:mm"):""}},{field:"",title:"会议结束时间",type:"date",width:"10%",filterable:!1,template:function(e){return e.endTime?new Date(e.endTime.CompatibleDate()).Format("hh:mm"):""}},{field:"dueToPeople",title:"会议预定人",width:"10%",filterable:!1}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})},resizable:!0}},queryRoomCount:function(e){e.gridOptions.dataSource._skip="",e.gridOptions.dataSource.read()},roomList:function(t){var e={method:"get",url:common.format(n+"/meeting")};common.http({vm:t,$http:o,httpOptions:e,success:function(e){t.roomlists={},t.roomlists=e.data}})},cleanValue:function(){var e=$("#roomCountform").find("input,select");$.each(e,function(e,t){t.value=""})},findAllUsers:function(e,t){var i={method:"get",url:common.format(a+"/findAllUsers")};common.http({vm:e,$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}}}angular.module("app").factory("roomCountSvc",e),e.$inject=["$http","$compile"]}(),function(){"use strict";function e(t,l,e,i){var c=this;c.title="会议室预定列表",c.initSuccess=!1,c.model={businessId:e.params.businessId,businessType:e.params.businessType},c.startDateTime=new Date("2005/6/1 08:00"),c.startRbDate=new Date,c.endDateTime=new Date("2030/6/1 21:00"),c.currentDate="",c.reportName="会议室安排表",c.search={},c.loadScheduler=!1,l.showMeeting(c,function(e){l.initScheduler(c),c.meetings={},c.meetings=e,l.initDefaultValue(c.model.businessId,c.model.businessType,function(e){c.model=e,c.meetings&&0<c.meetings.length&&(c.search.mrID=c.meetings[0].id,c.model.mrID=c.meetings[0].id,c.findMeeting())}),$("#menu_offcanvas_id").click(function(){$("body").hasClass("sidebar-collapse")?c.t=i(function(){50<$("#main-sidebar").width()&&(c.findMeeting(),i.cancel(c.t))},300):c.t=i(function(){$("#main-sidebar").width()<=50&&(c.findMeeting(),i.cancel(c.t))},300)})}),c.refleshData=function(e){c.findMeeting(),e.flag||"ok"==e.reCode?t.alert("操作成功"):t.error(e.reMsg)},c.reQueryDate=function(e){var t,i,o=e.date,n=o.getDay();0==n?(t=o.Days(-6),i=o.Format("yyyy-MM-dd")):1==n?(t=o.Format("yyyy-MM-dd"),i=o.Days(6)):(t=o.Days(-(n-1)),i=o.Days(7-n)),c.search.beginTimeStr=t,c.search.endTimeStr=i,c.findMeeting()},c.findMeeting=function(){l.queryBookRoom(c.search,function(e){c.model.mrID=c.search.mrID,l.setSCDataSource(c,e)})},c.exportThisWeekStage=function(){c.currentDate=$(".k-sm-date-format").html(),c.rbType="0",c.reportName="本周评审会会议安排表",l.exportThisWeekStage(c)},c.exportThisWeek=function(){c.currentDate=$(".k-sm-date-format").html(),c.rbType="1",c.reportName="本周全部会议安排表",l.exportThisWeekStage(c)},c.exportNextWeek=function(){var e=$(".k-sm-date-format").html().split("-")[0].split("/"),t=e[0],i=2==e[1].length?e[1]:"0"+e[1],o=2<=e[2].length?e[2].substr(0,2):"0"+e[2].substr(0,1),n=new Date(i+"/"+o+"/"+t),a=new Date(i+"/"+o+"/"+t);n.setDate(n.getDate()+8-n.getDay()),a.setDate(a.getDate()+15-a.getDay());var r=new Date(n),s=new Date(a);c.currentDate=r.getFullYear()+"/"+(r.getMonth()+1)+"/"+r.getDate()+"-"+s.getFullYear()+"/"+(s.getMonth()+1)+"/"+s.getDate(),c.rbType="1",c.reportName="下周全部会议安排表",l.exportThisWeekStage(c)},c.exportNextWeekStage=function(){var e=$(".k-sm-date-format").html().split("-")[0].split("/"),t=e[0],i=2==e[1].length?e[1]:"0"+e[1],o=2<=e[2].length?e[2].substr(0,2):"0"+e[2].substr(0,1),n=new Date(i+"/"+o+"/"+t),a=new Date(i+"/"+o+"/"+t);n.setDate(n.getDate()+8-n.getDay()),a.setDate(a.getDate()+15-a.getDay());var r=new Date(n),s=new Date(a);c.currentDate=r.getFullYear()+"/"+(r.getMonth()+1)+"/"+r.getDate()+"-"+s.getFullYear()+"/"+(s.getMonth()+1)+"/"+s.getDate(),c.rbType="0",c.reportName="下周评审会会议安排表",l.exportThisWeekStage(c)}}angular.module("app").controller("roomCtrl",e),e.$inject=["bsWin","roomSvc","$state","$interval"]}(),function(){"use strict";function e(e,t,i){var o=this;o.title="添加会议室预定",o.isuserExist=!1,o.id=i.params.id,o.id&&(o.isUpdate=!0,o.title="更新会议室"),o.isUpdate&&t.getroomById(o)}angular.module("app").controller("roomEditCtrl",e),e.$inject=["$location","roomSvc","$state"]}(),function(){"use strict";function e(s,e){var i=rootPath+"/room";return{initScheduler:function(t){$("#scheduler").kendoScheduler({date:new Date,width:"100%",startTime:new Date("2005/6/1 08:00"),endTime:new Date("2030/6/1 21:00"),views:[{type:"week",selected:!0,allDaySlot:!1}],editable:{destroy:!0,template:$("#customEditorTemplate").html()},navigate:function(e){t.reQueryDate(e)},edit:function(e){},save:function(e){n(e.event,function(e){t.refleshData(e)})},remove:function(e){o(e.event,function(e){t.refleshData(e)})},eventTemplate:$("#event-template").html(),timezone:"Etc/UTC",footer:!1});var e=$("#scheduler").data("kendoScheduler")._model.formattedShortDate.split("-");t.search.beginTimeStr=new Date(e[0].trim()).Format("yyyy-MM-dd"),t.search.endTimeStr=new Date(e[1].trim()).Format("yyyy-MM-dd")},queryBookRoom:function(e,t){var i={method:"post",url:rootPath+"/room/queryBookInfo",data:e};common.http({$http:s,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},setSCDataSource:function(e,t){var i=$("#scheduler").data("kendoScheduler"),o=new kendo.data.SchedulerDataSource({data:t,schema:{model:{id:"bookId",fields:{bookId:{from:"id"},title:{from:"addressName",defaultValue:"会议室",validation:{required:!0}},start:{type:"date",from:"beginTime"},end:{type:"date",from:"endTime"},rbDay:{type:"date",from:"rbDay",format:"yyyy-MM-dd"},businessId:{from:"businessId",defaultValue:e.model.businessId},businessType:{from:"businessType",defaultValue:e.model.businessType},rbName:{from:"rbName",defaultValue:e.model.rbName},stageOrgName:{from:"stageOrgName",defaultValue:e.model.stageOrgName},host:{from:"host",defaultValue:e.model.host},dueToPeople:{from:"dueToPeople",defaultValue:e.model.dueToPeople},mrID:{from:"mrID",defaultValue:e.model.mrID},content:{from:"content",defaultValue:e.model.content},remark:{from:"remark",defaultValue:e.model.remark}}}}});i.setDataSource(o)},showMeeting:function(e,t){var i={method:"get",url:rootPath+"/room/meeting"};common.http({$http:s,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},exportThisWeekStage:function(e){var t=escape(encodeURIComponent(e.reportName));window.open(i+"/exportThisWeekStage?currentDate="+e.currentDate+"&rbType="+e.rbType+"&mrId="+e.mrID+"&fileName="+t)},initDefaultValue:function(e,t,i){var o={method:"post",url:rootPath+"/room/initDefaultValue",params:{businessId:e,businessType:t}};common.http({$http:s,httpOptions:o,success:function(e){null!=i&&"function"==typeof i&&i(e.data)}})},saveBookRoom:n,deleteRoom:o};function o(e,t){var i={method:"delete",url:rootPath+"/room",params:{id:e.id,dueToPeople:e.dueToPeople}};common.http({httpOptions:i,$http:s,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}function n(e,t){var i=e;if(i.rbName&&i.dueToPeople&&i.rbDay&&i.start&&i.end&&i.content){i.id=i.bookId;var o=i.start.Format("yyyy-MM-dd hh:mm:ss");i.beginTime=o,i.rbDay=i.start.Format("yyyy-MM-dd");var n=i.end.Format("hh:mm:ss");i.endTime=i.rbDay+" "+n;a={method:"post",url:rootPath+"/room/addRoom",data:i},r=function(e){null!=t&&"function"==typeof t&&t(e.data)};common.http({$http:s,httpOptions:a,success:r})}else{var a={method:"post",url:rootPath+"/room/errorResult"},r=function(e){null!=t&&"function"==typeof t&&t(e.data)};common.http({$http:s,httpOptions:a,success:r})}}}angular.module("app").factory("roomSvc",e),e.$inject=["$http","bsWin"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.model={},n.title="新增收文",n.create=function(){common.initJqValidation(),$("form").valid()&&t.createSign(n.model,function(e){e.flag||"ok"==e.reCode?e.reObj.processInstanceId?o.alert("操作成功！"):o.success("操作成功，请继续填写项目审核登记表",function(){i.go("fillSign",{signid:e.reObj.signid},{reload:!0})}):o.error(e.reMsg)})}}angular.module("app").controller("signCreateCtrl",e),e.$inject=["$location","signSvc","$state","bsWin"]}(),function(){"use strict";function e(t,e,i,o,n,a){var r=this;r.model={},r.stateName=e.current.name,r.queryParams={},r.saveView=function(){a.storeView(r.stateName,{gridParams:r.gridOptions.dataSource.transport.options.read.data(),queryParams:r.queryParams,data:r})},function(){if(a.view[r.stateName]){var e=a.view[r.stateName];e.gridParams&&(r.gridParams=e.gridParams),e.data&&(r.model=e.data.model),e.queryParams&&(r.queryParams=e.queryParams),t.signGrid(r),a.view[r.stateName]=void 0}else t.signGrid(r)}(),r.getSignInfo=function(){""!=r.model.filecode&&null!=r.model.filecode?t.getSignInfo(r.model.filecode,"0",function(e){if(e.flag||"ok"==e.reCode){if("保存成功！"!=e.reMsg)return void n.alert(e.reMsg);r.gridOptions.dataSource.read()}else n.alert(e.reMsg)}):n.alert("收文编号不能为空!")},r.querySign=function(){r.gridOptions.dataSource._skip=0,r.gridOptions.dataSource.read()},r.check=function(){r.isAssociate=r.ischeck?9:0},r.del=function(e){n.confirm({title:"询问提示",message:"确认删除该条项目数据吗？",onOk:function(){t.deleteSign(e,function(e){e.flag||"ok"==e.reCode?n.alert("删除成功！",function(){r.gridOptions.dataSource.read()}):n.alert(e.reMsg)})}})},r.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:r,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");r.del(o)}},r.startNewFlow=function(e){n.confirm({title:"询问提示",message:"确认已经完成填写，并且发起流程么？",onOk:function(){$(".confirmDialog").modal("hide"),o.startFlow(e,function(e){e.flag||"ok"==e.reCode?n.success("操作成功！",function(){r.gridOptions.dataSource.read()}):n.error(e.reMsg)})}})},r.realSign=function(e){n.confirm({title:"询问提示",message:"确认正式签收了么？",onOk:function(){$(".confirmDialog").modal("hide"),t.realSign(e,function(e){e.flag||"ok"==e.reCode?n.success("操作成功！",function(){r.gridOptions.dataSource.read()}):n.error(e.reMsg)})}})}}angular.module("app").controller("signCtrl",e),e.$inject=["signSvc","$state","flowSvc","signFlowSvc","bsWin","$rootScope"]}(),function(){"use strict";function e(i,t,o,n,a,e,r){var s=this;s.model={},s.title="填写报审登记表",s.model.signid=o.params.signid,s.flowDeal=!1,s.busiObj={},s.otherFile=[],s.supply={},s.isControl=o.params.isControl,i.initFillData(s.model.signid,function(e){s.model=e.reObj.sign,s.deptlist=e.reObj.deptlist,e.reObj.mainOfficeList&&(s.mainOfficeList=e.reObj.mainOfficeList),e.reObj.assistOfficeList&&(s.assistOfficeList=e.reObj.assistOfficeList),s.companyList=e.reObj.companyList,s.busiObj.leaderList=e.reObj.leaderList,s.sysFile={businessId:s.model.signid,mainId:s.model.signid,mainType:t.mainTypeValue().SIGN,sysfileType:t.mainTypeValue().FILLSIGN},t.initUploadOptions({inputId:"sysfileinput",vm:s}),"项目建议书"==s.model.reviewstage||"可行性研究报告"==s.model.reviewstage?s.stageType="STAGESUG":"资金申请报告"==s.model.reviewstage?s.stageType="STAGEREPORT":"设备清单（国产）"==s.model.reviewstage||"设备清单（进口）"==s.model.reviewstage?s.stageType="STAGEHOMELAND":"进口设备"==s.model.reviewstage?s.stageType="STAGEDEVICE":"项目概算"==s.model.reviewstage&&(s.stageType="STAGEBUDGET"),null!=e.reObj.registerFileDtoDtoList&&e.reObj.registerFileDtoDtoList.forEach(function(e,t){"3"==e.businessType?s.supply.push(e):"2"==e.businessType?s.drawingFile.push(e):s.otherFile.push(e)})}),s.checkOrgType=function(e){var t=e.target,i=t.checked,o=t.value;i&&(s.model.leaderName=signcommon.getDefaultLeader(o),$.each(s.busiObj.leaderList,function(e,t){t.mngOrgType==o&&(s.model.leaderId=t.id,s.model.leaderName=t.displayName,s.model.comprehensivehandlesug="请"+t.displayName+"同志阅示。")}),o==signcommon.getBusinessType().GX?s.model.leaderhandlesug="请（概算一部         概算二部）组织评审。":s.model.leaderhandlesug="请（评估一部         评估二部         评估一部信息化组）组织评审。",s.model.leaderId||a.alert("选择的默认办理部门没有合适的分管领导，请先设置分管领导角色用户！"))},s.startNewFlow=function(){common.initJqValidation($("#sign_fill_form")),$("#sign_fill_form").valid()?(s.isSubmit=!0,a.confirm({title:"询问提示",message:"确定发起流程么，请确保填写的信息已经保存正确！",onOk:function(){i.updateFillin(s.model,function(e){var t={method:"post",url:rootPath+"/sign/startNewFlow",params:{signid:s.model.signid}};common.http({$http:n,httpOptions:t,success:function(e){s.isSubmit=!1,"ok"==e.data.reCode?a.success("操作成功！",function(){o.go("gtasks")}):a.error(e.data.reMsg)}})})}})):a.alert("操作失败，有红色*号的选项为必填项，请按要求填写！")},s.signPreview=function(e){var t=$(".well").parents("body"),i=t.find(".main-sidebar"),o=t.find(".main-header"),n=t.find(".content-wrapper");i.hide(),o.hide(),$(".toolbar").hide(),$(".well input").each(function(){var e=$(this).attr("type");"text"==e&&$(this).before('<span class="printmesge" data="text" style="white-space : nowrap;">'+$(this).val()+"</span>"),"checkbox"==e&&($(this).is(":checked")?$(this).before('<span class="printmesge" data="text">有</span>'):$(this).before('<span class="printmesge" data="text">无</span>'))}),$(".printmesge").show(),$(".well input[type=text]").hide(),$(".well input[type=checkbox]").hide(),$(".well button").hide(),n.find("td div select").hide(),n.find("td div span").css("margin","0"),$(".well").addClass("printbody"),$(".well .table-bordered").addClass("tableBOX"),n.find("input").addClass("noborder"),n.addClass("nomargin"),window.print(),i.show(),o.show(),$(".toolbar").show(),$(".printmesge").hide(),$(".well input[type=text]").show(),$(".well input[type=checkbox]").show(),$(".well button").show(),n.find("td div select").show(),n.find("td div span").css("margin-left","100px"),$(".well").removeClass("printbody"),$(".well .table-bordered").removeClass("tableBOX"),$("[data=text]").remove(),n.find("input").removeClass("noborder"),n.removeClass("nomargin")},s.updateFillin=function(){common.initJqValidation($("#sign_fill_form")),$("#sign_fill_form").valid()?(s.isSubmit=!0,s.model.leaderhandlesug=$("#leaderhandlesug").val(),i.updateFillin(s.model,function(e){s.isSubmit=!1,a.alert("操作成功！")})):a.alert("操作失败，有红色*号的选项为必填项，请按要求填写！")},s.findOfficeUsersByDeptName=function(t){var e={};"main"==t?e.maindeptName=s.model.maindeptName:e.assistdeptName=s.model.assistdeptName,i.findOfficeUsersByDeptName(e,function(e){"main"==t?(s.mainOfficeList={},s.mainOfficeList=e):(s.assistOfficeList={},s.assistOfficeList=e)})},s.addOtherFile=function(e,t){s.addRegisters||(s.addRegisters=[]),e?("4"==t&&(s.addRegisters=s.otherFile,s.showFilePage=!1,s.showFileOther=!1,s.showSignOther=!0),"2"==t&&(s.addRegisters=s.drawingFile,s.showFilePage=!0,s.showFileOther=!1,s.showSignOther=!1),s.businessId=e,s.businessType=t,$("#addOtherFile").kendoWindow({width:"840px",height:"480px",title:"补充资料编辑",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()):a.alert("请先保存数据！")},s.addRegisterFile=function(){s.addRegister={},s.addRegister.businessId=s.businessId,s.addRegister.businessType=s.businessType,s.addRegister.id=common.uuid(),s.addRegisters.push(s.addRegister)},s.saveRegisterFile=function(){r.saveRegisterFile(s.addRegisters,function(e){e.flag||"ok"==e.reCode?(a.alert("操作成功"),s.addRegisters=e.reObj):a.alert(e.reMsg)})},s.deleteRegisterFile=function(){var i=$("#addOtherFile input[name='addRegistersCheck']:checked");if(i.length<1)a.alert("请选择要删除的记录！");else{for(var o=[],n=0;n<i.length;n++)s.addRegisters.forEach(function(e,t){e.id&&i[n].value==e.id&&(o.push(i[n].value),s.addRegisters.splice(t,1))});0<o.length&&r.deleteByIds(o.join(","),function(e){a.alert("删除成功！")})}},s.updateProjCode=function(){$("#projCodeWin").kendoWindow({width:"660px",height:"400px",title:"项目文号编辑",visible:!1,modal:!0,closable:!0,actions:["Close"]}).data("kendoWindow").center().open()}}angular.module("app").controller("signFillinCtrl",e),e.$inject=["signSvc","sysfileSvc","$state","$http","bsWin","$scope","addRegisterFileSvc"]}(),function(){"use strict";function e(t,e,i,o,n,a){var r=this;r.title="已办结项目详情",r.model={},r.flow={},r.model.signid=i.params.signid,r.flow.processInstanceId=i.params.processInstanceId,r.flow.hideFlowImg=!0,r.showFlag={tabWorkProgram:!1,tabBaseWP:!1,tabDispatch:!1,tabFilerecord:!1,tabExpert:!1,tabSysFile:!1,tabAssociateSigns:!1},r.businessFlag={expertReviews:[]},$("#myTab li").click(function(e){var t=$("a",this);e.preventDefault(),t.tab("show");var i=t.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500),r.model.showDiv=i}),o.initFlowData(r),e.initFlowPageData(r.model.signid,function(e){r.model=e;var t=$("#myTab .active"),i=$("a",t);r.model.showDiv=i.attr("for-div"),r.model.dispatchDocDto&&(r.showFlag.tabDispatch=!0,r.dispatchDoc=r.model.dispatchDocDto),r.model.fileRecordDto&&(r.showFlag.tabFilerecord=!0,r.fileRecord=r.model.fileRecordDto),1<r.model.processState&&(r.showFlag.tabWorkProgram=!0),r.model.suppLetterDtoList&&(r.showSupperIndex=0),null!=r.model.registerFileDtoDtoList&&(r.supply=[],r.registerFile=[],r.drawingFile=[],r.otherFile=[],r.model.registerFileDtoDtoList.forEach(function(e,t){"3"==e.businessType?r.supply.push(e):"2"==e.businessType?r.drawingFile.push(e):"1"==e.businessType||"4"==e.businessType?r.registerFile.push(e):"5"!=e.businessType&&"6"!=e.businessType&&"7"!=e.businessType||r.otherFile.push(e)}))}),t.findByMianId(r.model.signid,function(e){e&&0<e.length&&(r.showFlag.tabSysFile=!0,r.sysFileList=e,t.initZtreeClient(r,n))}),r.commonDownloadSysFile=function(e){t.downloadFile(e)},r.commonEditSysFile=function(e){$("#editSysFileWindow").kendoWindow({width:"80%",title:"在线编辑",content:rootPath+"/file/editFile?sysFileId="+e})},r.printpage=function(e){a.templatePrint(e.target,r.model)}}angular.module("app").controller("signEndCtrl",e),e.$inject=["sysfileSvc","signSvc","$state","flowSvc","$scope","templatePrintSvc"]}(),function(){"use strict";function e(o,e,t){return{startFlow:function(e,t){var i={method:"post",url:rootPath+"/sign/startNewFlow",params:{signid:e}};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},initBusinessParams:function(i){switch(i.flow.curNode.activitiId){case flowcommon.getSignFlowNode().SIGN_QS:i.showFlag.businessTr=!0,i.showFlag.nodeSign=!0;break;case flowcommon.getSignFlowNode().SIGN_ZHB:i.showFlag.buttBack=!0,i.showFlag.businessNext=!0,i.showFlag.nodeSelViceMgr=!0,i.flow.businessMap&&(i.viceDirectors=i.flow.businessMap.viceDirectors);break;case flowcommon.getSignFlowNode().SIGN_FGLD_FB:i.showFlag.buttBack=!0,i.showFlag.businessNext=!0,i.showFlag.nodeSelOrgs=!0,i.flow.businessMap&&(i.orgs=i.flow.businessMap.orgs);break;case flowcommon.getSignFlowNode().SIGN_BMFB1:i.businessFlag.isMainBranch=!0;case flowcommon.getSignFlowNode().SIGN_BMFB2:case flowcommon.getSignFlowNode().SIGN_BMFB3:case flowcommon.getSignFlowNode().SIGN_BMFB4:i.showFlag.businessNext=!0,i.showFlag.nodeSelPrincipal=!0,i.flow.businessMap&&i.flow.businessMap.users&&(i.users=i.flow.businessMap.users,i.users.forEach(function(e,t){e.isSelected=!1}));break;case flowcommon.getSignFlowNode().SIGN_XMFZR1:i.businessFlag.isMainBranch=!0,i.businessFlag.curBranchId="1";case flowcommon.getSignFlowNode().SIGN_XMFZR2:i.businessFlag.curBranchId||(i.businessFlag.curBranchId="2");case flowcommon.getSignFlowNode().SIGN_XMFZR3:i.businessFlag.curBranchId||(i.businessFlag.curBranchId="3");case flowcommon.getSignFlowNode().SIGN_XMFZR4:i.businessFlag.curBranchId||(i.businessFlag.curBranchId="4"),i.showFlag.businessTr=!0,i.showFlag.nodeWorkProgram=!0,i.businessFlag.isFinishWP=i.flow.businessMap.isFinishWP,i.businessFlag.isNeedWP=i.flow.businessMap.isNeedWP,2<=i.model.processState&&("1"==i.businessFlag.curBranchId&&i.model.projBaseInfoDto?$("#show_baseinfo_a").click():i.model.workProgramDtoList&&0<i.model.workProgramDtoList.length&&($.each(i.model.workProgramDtoList,function(e,t){t.branchId==i.businessFlag.curBranchId&&(i.businessFlag.editEPReviewId=t.expertReviewId)}),i.businessFlag.editExpertSC=!0,i.showFlag.tabWorkProgram=!0)),i.businessFlag.isFinishWP?$("#show_workprogram_a").click():$("#show_sign_a").click();break;case flowcommon.getSignFlowNode().SIGN_BMLD_SPW1:case flowcommon.getSignFlowNode().SIGN_BMLD_SPW2:case flowcommon.getSignFlowNode().SIGN_BMLD_SPW3:case flowcommon.getSignFlowNode().SIGN_BMLD_SPW4:case flowcommon.getSignFlowNode().SIGN_FGLD_SPW1:case flowcommon.getSignFlowNode().SIGN_FGLD_SPW2:case flowcommon.getSignFlowNode().SIGN_FGLD_SPW3:case flowcommon.getSignFlowNode().SIGN_FGLD_SPW4:i.showFlag.buttBack=!0,i.showFlag.tabWorkProgram=!0,$("#show_workprogram_a").click();break;case flowcommon.getSignFlowNode().SIGN_FW:i.showFlag.businessTr=!0,i.showFlag.nodeDispatch=!0,i.showFlag.isMainPrinUser=!0,i.showFlag.expertEdit=!0,i.flow.businessMap.prilUserList&&(i.businessFlag.principalUsers=i.flow.businessMap.prilUserList,i.showFlag.businessNext=!0),4<=i.model.processState&&(i.showFlag.tabDispatch=!0,$("#show_dispatch_a").click());break;case flowcommon.getSignFlowNode().SIGN_QRFW:case flowcommon.getSignFlowNode().SIGN_BMLD_QRFW_XB:case flowcommon.getSignFlowNode().SIGN_FGLD_QRFW_XB:i.watchPassDis(),i.showFlag.buttBack=!1,i.showFlag.businessTr=!0,i.showFlag.nodeConfirmDis=!0,i.businessFlag.passDis="9",i.showFlag.tabDispatch=!0,$("#show_dispatch_a").click();break;case flowcommon.getSignFlowNode().SIGN_BMLD_QRFW:case flowcommon.getSignFlowNode().SIGN_FGLD_QRFW:case flowcommon.getSignFlowNode().SIGN_ZR_QRFW:i.showFlag.buttBack=!0,i.showFlag.tabWorkProgram=!0,i.showFlag.tabDispatch=!0,$("#show_dispatch_a").click();break;case flowcommon.getSignFlowNode().SIGN_FWBH:i.showFlag.tabWorkProgram=!0,i.showFlag.tabDispatch=!0,$("#show_dispatch_a").click(),i.showFlag.businessTr=!0,i.showFlag.nodeCreateDisNum=!0,i.showFlag.isMainPrinUser=!0;break;case flowcommon.getSignFlowNode().SIGN_CWBL:i.showFlag.tabWorkProgram=!0,i.showFlag.tabDispatch=!0,i.showFlag.businessTr=!0,i.showFlag.financialCode=!0;break;case flowcommon.getSignFlowNode().SIGN_GD:i.showFlag.tabWorkProgram=!0,i.showFlag.tabDispatch=!0,i.showFlag.isMainPrinUser=!0,i.flow.businessMap.checkFileUser&&(i.showFlag.businessNext=!0),i.showFlag.businessTr=!0,i.showFlag.nodeFileRecord=!0,6<i.model.processState&&(i.showFlag.tabFilerecord=!0,$("#show_filerecord_a").click());break;case flowcommon.getSignFlowNode().SIGN_DSFZR_QRGD:i.showFlag.tabWorkProgram=!0,i.showFlag.tabDispatch=!0,i.showFlag.tabFilerecord=!0,$("#show_filerecord_a").click(),i.showFlag.buttBack=!0;break;case flowcommon.getSignFlowNode().SIGN_QRGD:i.showFlag.tabWorkProgram=!0,i.showFlag.tabDispatch=!0,i.showFlag.tabFilerecord=!0,i.showFlag.businessTr=!0,i.showFlag.nodeFileRecord=!0,$("#show_filerecord_a").click(),i.showFlag.buttBack=!0,i.showFlag.nodeNext=!1}},checkBusinessFill:function(e){e.flow.businessMap||(e.flow.businessMap={});var i={resultTag:!0};switch(e.flow.curNode.activitiId){case flowcommon.getSignFlowNode().SIGN_ZHB:$("#viceDirector").val()?e.flow.businessMap.FGLD=$("#viceDirector").val():i.resultTag=!1;break;case flowcommon.getSignFlowNode().SIGN_FGLD_FB:if(i.resultTag=!1,$('.seleteTable input[selectType="main"]:checked').each(function(){e.flow.businessMap.MAIN_ORG=$(this).val(),i.resultTag=!0}),i.resultTag){var t=[];$('.seleteTable input[selectType="assist"]:checked').each(function(){t.push($(this).val())}),3<t.length?(i.resultTag=!1,i.resultMsg="协办部门最多只能选择3个！"):e.flow.businessMap.ASSIST_ORG=t.join(",")}else i.resultMsg="主办部门不为空！";break;case flowcommon.getSignFlowNode().SIGN_BMFB1:if(!e.model.isassistflow||9!=e.model.isassistflow&&"9"!=e.model.isassistflow){var o=$("#selPrincipalMainUser").val();if(!o){i.resultTag=!1,i.resultMsg="必须要选择一个第一负责人！";break}i.resultTag=!0,e.flow.businessMap.M_USER_ID=o;var n=[];$('#principalAssistUser input[selectType="assistUser"]:checked').each(function(){n.push($(this).val())}),0<n.length&&(e.flow.businessMap.A_USER_ID=n.join(","))}else e.businessFlag.principalUsers&&0!=e.businessFlag.principalUsers.length?(i.resultTag=!1,$.each(e.businessFlag.principalUsers,function(e,t){"9"!=t.isMainUser&&9!=t.isMainUser||(i.resultTag=!0)}),i.resultTag||(i.resultMsg="必须要选择一个第一负责人！")):(i.resultTag=!1,i.resultMsg="请先选择项目负责人！"),i.resultTag&&(e.flow.businessMap.PRINCIPAL=e.businessFlag.principalUsers);break;case flowcommon.getSignFlowNode().SIGN_BMFB2:case flowcommon.getSignFlowNode().SIGN_BMFB3:case flowcommon.getSignFlowNode().SIGN_BMFB4:if(!e.model.isassistflow||9!=e.model.isassistflow&&"9"!=e.model.isassistflow){var n=[];$('#principalAssistUser input[selectType="assistUser"]:checked').each(function(){n.push($(this).val())}),0<n.length?e.flow.businessMap.A_USER_ID=n.join(","):(i.resultTag=!1,i.resultMsg="必须要选择负责人！")}else e.businessFlag.principalUsers&&0!=e.businessFlag.principalUsers.length||(i.resultTag=!1,i.resultMsg="请先选择项目负责人！"),i.resultTag&&(e.flow.businessMap.PRINCIPAL=e.businessFlag.principalUsers);break;case flowcommon.getSignFlowNode().SIGN_XMFZR1:case flowcommon.getSignFlowNode().SIGN_XMFZR2:case flowcommon.getSignFlowNode().SIGN_XMFZR3:case flowcommon.getSignFlowNode().SIGN_XMFZR4:e.flow.businessMap.IS_NEED_WP=e.businessFlag.isNeedWP;break;case flowcommon.getSignFlowNode().SIGN_BMLD_SPW1:case flowcommon.getSignFlowNode().SIGN_BMLD_SPW2:case flowcommon.getSignFlowNode().SIGN_BMLD_SPW3:case flowcommon.getSignFlowNode().SIGN_BMLD_SPW4:break;case flowcommon.getSignFlowNode().SIGN_FGLD_SPW1:case flowcommon.getSignFlowNode().SIGN_FGLD_SPW2:case flowcommon.getSignFlowNode().SIGN_FGLD_SPW3:case flowcommon.getSignFlowNode().SIGN_FGLD_SPW4:break;case flowcommon.getSignFlowNode().SIGN_FW:e.model.processState<4&&(i.resultTag=!1,i.resultMsg="您还没完成发文操作，不能进行下一步操作！"),e.flow.businessMap.DIS_ID=e.dispatchDoc.id;break;case flowcommon.getSignFlowNode().SIGN_QRFW:case flowcommon.getSignFlowNode().SIGN_BMLD_QRFW_XB:case flowcommon.getSignFlowNode().SIGN_FGLD_QRFW_XB:"9"==e.businessFlag.passDis||9==e.businessFlag.passDis?e.flow.businessMap.AGREE="9":e.flow.businessMap.AGREE="0",e.flow.businessMap.DIS_ID=e.dispatchDoc.id;break;case flowcommon.getSignFlowNode().SIGN_BMLD_QRFW_XB:case flowcommon.getSignFlowNode().SIGN_BMLD_QRFW:case flowcommon.getSignFlowNode().SIGN_FGLD_QRFW_XB:case flowcommon.getSignFlowNode().SIGN_FGLD_QRFW:case flowcommon.getSignFlowNode().SIGN_ZR_QRFW:case flowcommon.getSignFlowNode().SIGN_FWBH:e.flow.businessMap.DIS_ID=e.dispatchDoc.id;break;case flowcommon.getSignFlowNode().SIGN_CWBL:case flowcommon.getSignFlowNode().SIGN_GD:break;case flowcommon.getSignFlowNode().SIGN_DSFZR_QRGD:case flowcommon.getSignFlowNode().SIGN_QRGD:e.flow.businessMap.GD_ID=e.fileRecord.fileRecordId}return i},getChargeDispatch:function(t){var e={method:"get",url:rootPath+"/dispatch/html/initDispatchBySignId",params:{signId:t.model.signid}};common.http({vm:t,$http:o,httpOptions:e,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.dispatchDoc=e.data,$("#show_dispatch_a").click()}})}})},getChargeFilerecord:function(t){var e={method:"get",url:rootPath+"/fileRecord/html/initBySignId",params:{signId:t.model.signid}};common.http({vm:t,$http:o,httpOptions:e,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.fileRecord=e.data,$("#show_filerecord_a").click()}})}})},endSignDetail:function(i){var e={method:"get",url:rootPath+"/sign/html/initDetailPageData",params:{signid:i.model.signid,queryAll:!0}};common.http({vm:i,$http:o,httpOptions:e,success:function(e){common.requestSuccess({vm:i,response:e,fn:function(){i.model=e.data,i.model.workProgramDtoList&&0<i.model.workProgramDtoList.length&&(i.show_workprogram=!0,i.model.workProgramDtoList.forEach(function(e,t){9==e.isMain?(i.showMainwork=!0,i.mainwork={},i.mainwork=e):0==e.isMain&&(i.showAssistwork=!0,i.assistwork={},i.assistwork=e)})),i.model.dispatchDocDto&&(i.show_dispatch=!0,i.dispatchDoc=i.model.dispatchDocDto),i.model.fileRecordDto&&(i.show_filerecord=!0,i.fileRecord=i.model.fileRecordDto)}})}})}}}angular.module("app").factory("signFlowSvc",e),e.$inject=["$http","$state","bsWin"]}(),function(){"use strict";function e(t,o,m,n,i,p,a,r,s,l,u,e,c,d,f,h){var g=this;function v(){$("#myTab li").click(function(e){var t=$("a",this);e.preventDefault(),t.tab("show");var i=t.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500),g.model.showDiv=i}),g.sysFile={businessId:n.params.signid,mainId:n.params.signid,mainType:t.mainTypeValue().SIGN,sysfileType:t.mainTypeValue().FILLSIGN},t.initUploadOptions({inputId:"sysfileinput",vm:g,uploadSuccess:function(){t.findByMianId(g.model.signid,function(e){e&&0<e.length&&(g.showFlag.tabSysFile=!0,g.sysFileList=e,t.initZtreeClient(g,l))})}}),o.initFlowPageData(g.model.signid,function(e){g.model=e,g.curDate=e.curDate;var t=$("#myTab .active"),i=$("a",t);if(g.model.showDiv=i.attr("for-div"),3!=g.model.processState&&4!=g.model.processState||(g.showMeterial=!0),g.model.dispatchDocDto&&(g.showFlag.tabDispatch=!0,g.dispatchDoc=g.model.dispatchDocDto,2==g.dispatchDoc.dispatchWay&&0==g.dispatchDoc.isMainProject||g.dispatchDoc.fileNum?g.businessFlag.isCreateDisFileNum=!0:g.showFlag.buttDisFileNum=!0,2==g.dispatchDoc.dispatchWay&&9==g.dispatchDoc.isMainProject&&m.findMergeDis(g.model.signid,function(e){e&&(g.mergeDisDtoList=e)})),g.model.fileRecordDto&&(g.showFlag.tabFilerecord=!0,g.fileRecord=g.model.fileRecordDto),g.model.workProgramDtoList&&0<g.model.workProgramDtoList.length){var o;(o="1"==g.model.workProgramDtoList[0].branchId?g.model.workProgramDtoList[0].reviewOrgName:g.model.workProgramDtoList[0].mainWorkProgramDto.reviewOrgName)&&1<o.split(",").length&&(g.showTotalInvestment=!0);for(var n=0;n<g.model.workProgramDtoList.length;n++){var a=g.model.workProgramDtoList;if(a[n].expertDtoList)for(var r=a[n].expertDtoList,s=0;s<r.length;s++)if(r[s].expertTypeDtoList){for(var l=r[s].expertTypeDtoList,c="",d="",u=0;u<l.length;u++)d.indexOf(l[u].expertType)<0&&(0<u&&(d+="、"),d+=l[u].expertType),0<u&&(c+="、"),c+=l[u].maJorBig+"、"+l[u].maJorSmall;r[s].expertCategory=d,r[s].major=c}}}g.businessFlag.isLoadSign=!0,g.businessFlag.isLoadSign&&g.businessFlag.isLoadFlow&&p.initBusinessParams(g),g.model.suppLetterDtoList&&(g.showSupperIndex=0),null!=g.model.registerFileDtoDtoList&&(g.supply=[],g.registerFile=[],g.drawingFile=[],g.otherFile=[],g.model.registerFileDtoDtoList.forEach(function(e,t){3==e.businessType||"5"==e.businessType||"6"==e.businessType||"7"==e.businessType?g.supply.push(e):2==e.businessType?g.drawingFile.push(e):1==e.businessType||4==e.businessType?g.registerFile.push(e):5!=e.businessType&&6!=e.businessType&&7!=e.businessType||g.otherFile.push(e)}))}),i.getFlowInfo(g.flow.taskId,g.flow.processInstanceId,function(e){g.flow=e,g.flow.taskId?(g.flow.end&&(g.showFlag.nodeNext=!1),g.businessFlag.isLoadFlow=!0,g.businessFlag.isLoadSign&&g.businessFlag.isLoadFlow&&p.initBusinessParams(g)):u.alert("该任务已处理！",function(){n.go("gtasks")})}),i.initFlowData(g),t.findByMianId(g.model.signid,function(e){e&&0<e.length&&(g.showFlag.tabSysFile=!0,g.sysFileList=e,t.initZtreeClient(g,l))}),g.delFile=function(e){u.confirm({title:"询问提示",message:"确认删除么？",onOk:function(){t.delSysFile(e,function(){u.alert("删除成功",function(){t.findByMianId(g.model.signid,function(e){e&&0<e.length?(g.showFlag.tabSysFile=!0,g.sysFileList=e,t.initZtreeClient(g,l)):(g.showFlag.tabSysFile=!1,$("#myTab a:first").tab("show"),$(".tab-pane").removeClass("active").removeClass("in"),$("#sign_detail").addClass("active").addClass("in").show(500))})})})}})},a.initIdea(g)}g.title="项目流程处理",g.model={},g.flow={},g.mainwork={},g.assistwork={},g.dispatchDoc={},g.fileRecord={},g.expertReview={},g.queryParams={},g.work={},g.isDisplay=!0,g.reworkWorkPlanObject={},g.expertList=new Array(15),g.showFlag={businessTr:!1,businessDis:!1,businessNext:!1,nodeNext:!0,nodeSelViceMgr:!1,nodeSelOrgs:!1,nodeSelPrincipal:!1,isMainBranch:!1,nodeSign:!1,nodeWorkProgram:!1,nodeDispatch:!1,nodeConfirmDis:!1,nodeCreateDisNum:!1,nodeFileRecord:!1,nodeXSWorkProgram:!1,tabWorkProgram:!1,tabBaseWP:!1,tabDispatch:!1,tabFilerecord:!1,tabExpert:!1,tabSysFile:!1,buttBack:!1,expertRemark:!1,expertpayment:!1,expertEdit:!1,isMainPrinUser:!1,showFilecodeBt:!1,showReworkWorkPlanBt:!1},g.businessFlag={isLoadSign:!1,isLoadFlow:!1,isGotoDis:!1,isMakeDisNum:!1,principalUsers:[],isSelMainPriUser:!1,editExpertSC:!1,expertScore:{},isNeedWP:9,isMainBranch:!1,isFinishWP:!1,passDis:!1,curBranchId:"",editEPReviewId:"",isReworkWorkPlan:!1},g.model.signid=n.params.signid,g.work.id=n.params.id,g.flow.taskId=n.params.taskId,g.flow.processInstanceId=n.params.processInstanceId,g.signId=g.model.signid,g.expertList=new Array(10),g.curDate="",v(),g.ideaEdit=function(e){angular.isObject(e)||(e={}),a.initIdeaData(g,e)},g.selectedIdea=function(){g.flow.dealOption=g.chooseIdea},g.editSelectExpert=function(i){g.scoreExpert={},$.each(g.model.expertReviewDto.expertSelectedDtoList,function(e,t){t.id!=i||(g.scoreExpert=angular.copy(t))}),$("#star_"+g.scoreExpert.id).raty({number:5,score:function(){return $(this).attr("data-num",angular.isUndefined(g.scoreExpert.score)?0:g.scoreExpert.score),$(this).attr("data-num")},starOn:"../contents/libs/raty/lib/images/star-on.png",starOff:"../contents/libs/raty/lib/images/star-off.png",starHalf:"../contents/libs/raty/lib/images/star-half.png",readOnly:!1,halfShow:!0,hints:["不合格","合格","中等","良好","优秀"],size:34,click:function(e,t){g.scoreExpert.score=e}}),$("#score_win").kendoWindow({width:"820px",height:"365px",title:"编辑-专家星级",visible:!1,modal:!0,closable:!0,actions:["Close"]}).data("kendoWindow").center().open()},g.closeEditMark=function(){window.parent.$("#score_win").data("kendoWindow").close()},g.saveMark=function(){g.scoreExpert.score&&0!=g.scoreExpert.score?s.saveMark(g.scoreExpert,function(e){e.flag||"ok"==e.reCode?(angular.forEach(g.model.expertReviewDto.expertSelectedDtoList,function(e,t){e.id==g.scoreExpert.id&&(e.score=g.scoreExpert.score,e.describes=g.scoreExpert.describes)}),u.success("保存成功！",function(){g.closeEditMark()})):u.alert(e.reMsg)}):u.alert("请对专家进行评分！")},g.countTaxes=function(d){if(null!=d)if(null!=d.expertSelectedDtoList&&0!=d.expertSelectedDtoList.length)if(null!=d.reviewDate){if(/^(\d{4}-\d{1,2}-\d{1,2})$/.exec(d.reviewDate))d.payDate||(d.payDate=g.curDate),common.initJqValidation($("#payform")),$("#payform").valid()?u.confirm({title:"询问提示",message:"确认提交么？提交之后不可修改，请核对正确。",onOk:function(){s.savePayment(d,g.isCommit,!0,function(e){if(e.flag||"ok"==e.reCode){for(var t=e.reObj,i=0,o=0,n=0,a=d.expertSelectedDtoList.length;n<a;n++){var r=d.expertSelectedDtoList[n];if(!("9"!=r.isConfrim&&9!=r.isConfrim||"9"!=r.isJoin&&9!=r.isJoin))for(var s=0,l=t.length;s<l;s++){var c=t[s].EXPERTID;r.expertDto.expertID==c&&(r.reviewTaxes=parseFloat(null==t[s].MONTAXES?0:t[s].MONTAXES).toFixed(2),r.totalCost=(parseFloat(r.reviewCost)+parseFloat(r.reviewTaxes)).toFixed(2),i=parseFloat(i)+parseFloat(r.reviewCost),o=parseFloat(o)+parseFloat(r.reviewTaxes))}}d.reviewCost=parseFloat(i).toFixed(2),d.reviewTaxes=parseFloat(o).toFixed(2),d.totalCost=(parseFloat(i)+parseFloat(o)).toFixed(2),u.alert("操作成功！",function(){g.isCommit=!1,d.state="9"})}else u.alert(e.reMsg)})}}):u.alert("请正确填写专家评审费信息！");else u.alert("请输入正确的日期格式")}else u.alert("(函评/评审会)日期为空，无法进行专家纳税计算，请联系系统管理员处理！");else u.alert("该方案还没有选择评审专家，请先选取评审专家！")},g.closeEditPay=function(){window.parent.$("#payment").data("kendoWindow").close()},g.savePayment=function(d){null!=d&&(null!=d.expertSelectedDtoList&&0!=d.expertSelectedDtoList.length?(common.initJqValidation($("#payform")),$("#payform").valid()?s.savePayment(d,g.isCommit,!1,function(e){if(e.flag||"ok"==e.reCode){for(var t=e.reObj,i=0,o=0,n=0,a=d.expertSelectedDtoList.length;n<a;n++){var r=d.expertSelectedDtoList[n];if(!("9"!=r.isConfrim&&9!=r.isConfrim||"9"!=r.isJoin&&9!=r.isJoin))for(var s=0,l=t.length;s<l;s++){var c=t[s].EXPERTID;r.expertDto.expertID==c&&(r.reviewTaxes=parseFloat(null==t[s].MONTAXES?0:t[s].MONTAXES).toFixed(2),r.totalCost=(parseFloat(r.reviewCost)+parseFloat(r.reviewTaxes)).toFixed(2),i=parseFloat(i)+parseFloat(r.reviewCost),o=parseFloat(o)+parseFloat(r.reviewTaxes))}}d.reviewCost=parseFloat(i).toFixed(2),d.reviewTaxes=parseFloat(o).toFixed(2),d.totalCost=(parseFloat(i)+parseFloat(o)).toFixed(2),u.alert("操作成功！",function(){g.isCommit=!1})}else u.alert(e.reMsg)}):u.alert("请正确填写专家评审费信息！")):u.alert("该方案还没有选择评审专家，请先选取评审专家！"))},g.editUnitScore=function(e){$("#star").raty({number:5,score:function(){return $(this).attr("data-num",angular.isUndefined(g.model.unitScoreDto.score)?0:g.model.unitScoreDto.score),$(this).attr("data-num")},starOn:"../contents/libs/raty/lib/images/star-on.png",starOff:"../contents/libs/raty/lib/images/star-off.png",starHalf:"../contents/libs/raty/lib/images/star-half.png",readOnly:!1,halfShow:!0,hints:["不合格","合格","中等","良好","优秀"],size:34,click:function(e,t){g.model.unitScoreDto.score=e}}),$("#unitscore_win").kendoWindow({width:"820px",height:"365px",title:"编辑-单位星级",visible:!1,modal:!0,closable:!0,actions:["Close"]}).data("kendoWindow").center().open()},g.saveUnit=function(){g.model.unitScoreDto.score&&0!=g.model.unitScoreDto.score?h.saveUnit(g.model.unitScoreDto,function(e){e.flag||"ok"==e.reCode?u.success("保存成功！",function(){g.closeEditUnit()}):u.alert(e.reMsg)}):u.alert("请对单位进行评分！")},g.closeEditUnit=function(){window.parent.$("#unitscore_win").data("kendoWindow").close()},g.commitNextStep=function(){if(g.flow.isSuspended)u.error("该流程目前为暂停状态，不能进行流转操作！");else{var e=p.checkBusinessFill(g);e.resultTag?i.commit(g.isCommit,g.flow,function(e){e.flag||"ok"==e.reCode?u.success("操作成功！",function(){n.go("gtasks")}):u.alert(e.reMsg)}):u.alert(e.resultMsg)}},g.commitBack=function(){common.initJqValidation($("#flow_form")),$("#flow_form").valid()&&u.confirm({title:"询问提示",message:"确认回退吗？",onOk:function(){i.rollBackToLast(g.flow,g.isCommit,function(e){e.flag||"ok"==e.reCode?(g.isCommit=!1,u.alert("回退成功！",function(){n.go("gtasks")})):u.alert(e.reMsg)})}})},g.deleteFlow=function(){u.confirm({title:"询问提示",message:"终止流程将无法恢复，确认删除么？？",onOk:function(){$(".confirmDialog").modal("hide"),i.deleteFlow(g)}})},g.editSign=function(){n.go("fillSign",{signid:g.model.signid})},g.addWorkProgram=function(){n.go("flowWPEdit",{signid:g.model.signid,taskid:g.flow.taskId})},g.addBaseInfo=function(){n.go("initProjBase",{signid:g.model.signid,isadmin:null})},g.addSuppLetter=function(){c.checkIsApprove(g.model.signid,"1",function(e){e.flag||"ok"==e.reCode?n.go("addSupp",{businessId:g.model.signid,businessType:"SIGN"}):u.confirm({title:"询问提示",message:"该项目还有拟补充资料函未审批完成，确定要新增拟补充资料函么？如果要修改拟补充资料函，请到“查询统计”->“拟补充资料函查询”菜单进行修改即可！",onOk:function(){n.go("addSupp",{businessId:g.model.signid,businessType:"SIGN"})}})})},g.addSuppLetterList=function(){n.go("addSuppletterList",{businessId:g.model.signid})},g.addRegisterFile=function(){n.go("registerFile",{businessId:g.model.signid})},g.addBaseWP=function(){n.go("workprogramBaseEdit",{signid:g.model.signid})},g.addDisPatch=function(){g.model.isAssociate&&0!=g.model.isAssociate||signcommon.getReviewStage().STAGE_STUDY!=g.model.reviewstage&&signcommon.getReviewStage().STAGE_BUDGET!=g.model.reviewstage?n.go("dispatchEdit",{signid:g.model.signid}):u.confirm({title:"询问提示",message:"该项目还没进行项目关联，是否需要进行关联设置？",onOk:function(){g.ss?g.page.selPage(1):(g.page=lgx.page.init({id:"demo5",get:function(e){var t;g.price||(g.price={signid:g.model.signid,mUserName:g.model.mUserName}),g.price.reviewstage=g.model.reviewstage,t=0!=e.skip?e.skip+1:e.skip,g.price.skip=t,g.price.size=e.size+e.skip,o.getAssociateSignGrid(g,function(e){g.associateSignList=[],e?(g.noassociateSign=!1,g.associateSignList=e.value,g.page.callback(e.count)):g.noassociateSign=!0})}}),g.ss=!0),$("#associateWindow").kendoWindow({width:"80%",height:"800px",title:"项目关联",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()},onCancel:function(){n.go("dispatchEdit",{signid:g.model.signid})}})},g.reworkWorkPlanViem=function(){r.getProjBranchInfo(n.params.signid,function(e){g.signBranchData=e,$("#reworkWorkPlanWindow").kendoWindow({width:"720px",height:"400px",title:"重写工作方案",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()})},g.reWorkFlow=function(){var e=$("#rework input[name='checBrands']:checked");if(e&&0!=e.length){for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");u.confirm("确定重做么？",function(){r.reStartWorkFlow(n.params.signid,o,function(e){console.log(e),e.flag||"ok"==e.reCode?u.success("操作成功！",function(){window.parent.$("#reworkWorkPlanWindow").data("kendoWindow").close()}):u.alert(e.reMsg)})})}else u.alert("请选择要重做工作方案的分支！")},g.associateQuerySign=function(){o.getAssociateSignGrid(g,function(e){g.associateSignList=[],e?(g.noassociateSign=!1,g.associateSignList=e.value,g.page.callback(e.count)):g.noassociateSign=!0})},g.saveAssociateSign=function(e){g.model.signid!=e?o.saveAssociateSign(g.model.signid,e,function(){e&&(g.model.isAssociate=1),u.alert(null!=e?"项目关联成功":"项目解除关联成功"),window.parent.$("#associateWindow").data("kendoWindow").close()}):u.alert("不能关联自身项目")},g.addFinancialApply=function(e){g.costType="REVIEW",d.initAddCost(g,g.costType,g.model,e)},g.addDoFile=function(){n.go("fileRecordEdit",{signid:g.model.signid})},g.addRegisterFileRecord=function(){g.fileRecord.fileRecordId?n.go("registerFile",{signid:g.fileRecord.fileRecordId}):u.alert("请保存归档再操作！")},g.mainOrg=function(e){var t=e.target,i=t.checked,o=t.value;i?$('.seleteTable input[selectType="main"]').each(function(){var e=$(this).attr("value");e!=o?($(this).removeAttr("checked"),$("#assist_"+e).removeAttr("disabled")):($("#assist_"+o).removeAttr("checked"),$("#assist_"+o).attr("disabled","disabled"))}):$("#assist_"+o).removeAttr("disabled"),g.initOption(e)};var y=[];g.initOption=function(e){var t=e.target,i=$(t),o=i.attr("selectType"),n=t.checked;if(n&&"main"==o?(y.splice(0,1),y.splice(0,0,i.attr("tit"))):n||"main"!=o||(y[0]=""),n&&"assist"==o)y.push(i.attr("tit"));else if(!n&&"assist"==o){var a=i.attr("tit");angular.forEach(y,function(e,t){e==a&&y.splice(t,1)})}if(0<y.length){for(var r=0;r<y.length;r++)y[0]==y[r]&&0!=r&&y.splice(r,1);g.flow.dealOption="请（"+y.join("，")+"）组织评审"}},g.checkPrincipal=function(){var e=$("#selPrincipalMainUser").val();e&&$('#principalAssistUser input[selectType="assistUser"]').each(function(){$(this).attr("value")==e?($(this).removeAttr("checked"),$(this).attr("disabled","disabled")):$(this).removeAttr("disabled")}),g.initUserOption()};var w=[];g.initUserOption=function(i){var o=$("#selPrincipalMainUser").val(),n=!1,a="请（";o?$.each(g.users,function(e,t){t.id==o&&(a+=t.displayName,g.selUserName=t.displayName,n=!0)}):g.selUserName=i,$("input[name='"+i+"']").is(":checked")?w.push(i):angular.forEach(w,function(e,t){e!=g.selUserName&&e!=i||w.splice(t,1)}),0<w.length&&(n&&(a+=", "),a+=w.join(", ")),a+=" )组织评审。",g.flow.dealOption=a},g.checkBoxSingle=function(e,i){var t=e.target,o=t.checked,n=t.value;o?$('.seleteTable input[selectType="'+i+'"]').each(function(){var e=$(this).attr("id"),t=$(this).attr("value");e!=i+"_"+n?($("#"+disabletype+"_"+t).removeAttr("disabled"),$(this).removeAttr("checked")):$("#"+disabletype+"_"+n).attr("disabled","disabled")}):$("#"+disabletype+"_"+n).removeAttr("disabled")},g.checkBoxSingle=function(e,t){var i=e.target,o=i.checked,n=i.value;o&&$('#xs_table input[selectType="'+t+'"]').each(function(){$(this).attr("id");$(this).attr("value")!=n&&$(this).removeAttr("checked")})},g.addPriUser=function(){var i=$("#xs_bmfb input[name='unSelPriUser']:checked");if(i.length<1)u.alert("请选择负责人");else{if(g.businessFlag.isMainBranch){if(9==g.isMainPriUser&&1<i.length)return void u.alert("总负责人只能选一个");if(0==g.businessFlag.isSelMainPriUser&&(angular.isUndefined(g.isMainPriUser)||0==g.isMainPriUser))return void u.alert("请先选择总负责人");if(1==g.businessFlag.isSelMainPriUser&&9==g.isMainPriUser)return void u.alert("你已经选择了一个总负责人！")}for(var o=0;o<i.length;o++){var n={};n.userId=i[o].value,n.userType=$("#userType").val(),9==g.isMainPriUser?(g.businessFlag.isSelMainPriUser=!0,n.isMainUser=9,g.isMainPriUser=0):n.isMainUser=0,g.users.forEach(function(e,t){e.id==i[o].value&&(e.isSelected=!0,n.userId=e.id,n.userName=e.displayName)}),g.businessFlag.principalUsers.push(n),g.businessFlag.principalUsers.sort(b("isMainUser")),g.initDealUserName(g.businessFlag.principalUsers)}}};var b=function(n){return function(e,t){var i,o;if("object"==typeof e&&"object"==typeof t&&e&&t)return i=e[n],o=t[n],console.log(i,o),i===o?0:typeof i==typeof o?o<i?-1:1:typeof o<typeof i?-1:1;throw"error"}};g.delPriUser=function(){var i=$("#xs_bmfb input[name='selPriUser']:checked");if(i.length<1)u.alert("请选择取消的负责人");else{for(var o=0;o<i.length;o++)g.users.forEach(function(e,t){e.id==i[o].value&&(e.isSelected=!1)}),g.businessFlag.principalUsers.forEach(function(e,t){e.userId==i[o].value&&(9==e.isMainUser&&(g.businessFlag.isSelMainPriUser=!1),g.businessFlag.principalUsers.splice(t,1))});g.initDealUserName(g.businessFlag.principalUsers)}},g.initDealUserName=function(e){if(e&&0<e.length){var i="请（";angular.forEach(e,function(e,t){0<t&&(i+=","),i+=e.userName}),i+=" )组织评审。",g.flow.dealOption=i}else g.flow.dealOption=""},g.checkNeedWP=function(e){var t=e.target,i=t.checked;i?g.businessFlag.isNeedWP=9:g.businessFlag.isFinishWP?u.confirm({title:"询问提示",message:"不做工作方案系统将会删除工作方案数据，确认不做工作方案么？",onOk:function(){g.isSubmit=!0,g.businessFlag.isNeedWP=0,o.removeWP(g,function(e){e.flag||"ok"==e.reCode?u.success("操作成功！",function(){v()}):u.error(e.reMsg)})},onClose:function(){t.checked=!i,g.businessFlag.isNeedWP=9}}):g.businessFlag.isNeedWP=0},g.meetingDoc=function(){u.confirm({title:"",message:"如果之前已经生成会前准备材料，则本次生成的文档会覆盖之前产生的文档，确定执行操作么？",onOk:function(){o.meetingDoc(g,function(e){e.flag||"ok"==e.reCode?(u.success(e.reMsg),t.findByMianId(g.model.signid,function(e){(e||0<e.length)&&(g.showFlag.tabSysFile=!0,g.sysFileList=e,t.initZtreeClient(g,l))})):u.alert(e.reMsg)})}})},g.commonDownloadSysFile=function(e){t.downloadFile(e)},g.createDispatchFileNum=function(){o.createDispatchFileNum(g.model.signid,g.dispatchDoc.id,function(e){(e.flag||"ok"==e.reCode)&&(g.dispatchDoc.fileNum=e.reObj),u.alert(e.reMsg)})},g.dispatchTemplate=function(){o.createDispatchTemplate(g,function(e){e.flag||"ok"==e.reCode?(u.success(e.reMsg),t.findByMianId(g.model.signid,function(e){(e||0<e.length)&&(g.showFlag.tabSysFile=!0,g.sysFileList=e,t.initZtreeClient(g,l))})):u.alert(e.reMsg)})},g.watchPassDis=function(){l.$watch("vm.businessFlag.passDis",function(e,t){g.flow.dealOption=9==e?"核稿无误":"核稿有误"})},g.affirmJoinExpert=function(){g.model.expertReviewDto&&g.model.expertReviewDto.expertSelectedDtoList?(g.confirmEPList=g.model.expertReviewDto.expertSelectedDtoList,$("#confirmJoinExpert").kendoWindow({width:"75%",height:"600px",title:"参加评审会专家确认",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()):u.alert("该项目没有评审专家！")},g.updateToJoin=function(){var e=$("#notJoinExpertTable input[name='notJoinExpert']:checked");if(e.length<1)u.alert("请选择要改为参加会议的专家");else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);console.log(t.join(",")),s.updateJoinState(g.expertReview.id,"","",t.join(","),"9",g.isCommit,function(e){e.flag||"ok"==e.reCode?(g.reFleshJoinState(t,"9"),u.success("操作成功！")):u.success(e.reMsg)})}},g.updateToNotJoin=function(){var e=$("#joinExpertTable input[name='joinExpert']:checked");if(e.length<1)u.alert("请选择未参加会议的专家");else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);s.updateJoinState(g.expertReview.id,"","",t.join(","),"0",g.isCommit,function(e){e.flag||"ok"==e.reCode?(g.reFleshJoinState(t,"0"),u.success("操作成功！")):u.success(e.reMsg)})}},g.reFleshJoinState=function(e,o){$.each(e,function(e,i){$.each(g.confirmEPList,function(e,t){i==t.id&&(t.isJoin=o)})}),$.each(g.model.workProgramDtoList,function(e,t){s.refleshBusinessEP(t.id,function(e){t.expertDtoList=e})})},g.printpage=function(e){var t=$(e.target).attr("id");o.workProgramPrint(t)},g.reviewReportDoc=function(){u.confirm({title:"",message:"如果之前已经生成评审报告，则本次操作会覆盖之前生成的文档，确定执行操作么？",onOk:function(){o.createDispatchTemplate(g,function(e){e.flag||"ok"==e.reCode?u.success("操作成功！",function(){t.findByMianId(g.model.signid,function(e){(e||0<e.length)&&(g.showFlag.tabSysFile=!0,g.sysFileList=e,t.initZtreeClient(g,l))})}):u.alert(e.reMsg)})}})},g.templatePage=function(e){f.templatePage(e)},g.splitPayment=function(e,t,i){g.expertSelect={},g.expertSelect.id=e,g.expertSelect.isSplit=9,g.expertSelect.oneCost="1000",g.expertName=t.name,g.reviewCost=i,$("#splitPayment").kendoWindow({width:"50%",height:"300px",title:"专家评审费打印方案",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open(),l.$watch("vm.expertSelect.isSplit",function(e,t){e!=t&&(9==g.expertSelect.isSplit&&(g.expertSelect.oneCost="1000"),0==g.expertSelect.isSplit&&(g.expertSelect.oneCost="0"))})},g.saveSplit=function(){common.initJqValidation(),$("form").valid()&&s.saveSplit(g)}}angular.module("app").controller("signFlowDealCtrl",e),e.$inject=["sysfileSvc","signSvc","dispatchSvc","$state","flowSvc","signFlowSvc","ideaSvc","workprogramSvc","expertReviewSvc","$scope","bsWin","financialManagerSvc","addSuppLetterQuerySvc","addCostSvc","templatePrintSvc","companySvc"]}(),function(){"use strict";function e(t,e,i,o,n,a,r,s){var l=this;l.title="项目流程信息",l.model={},l.flow={},l.work={},l.dispatchDoc={},l.fileRecord={},l.model.signid=i.params.signid,l.flow.taskId=i.params.taskId,l.flow.processInstanceId=i.params.processInstanceId,l.showFlag={tabWorkProgram:!1,tabBaseWP:!1,tabDispatch:!1,tabFilerecord:!1,tabExpert:!1,tabSysFile:!1,tabAssociateSigns:!1},l.businessFlag={expertReviews:[]},l.expertList=new Array(10),$("#myTab li").click(function(e){var t=$("a",this);e.preventDefault(),t.tab("show");var i=t.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500),l.model.showDiv=i}),o.initFlowData(l),e.initFlowPageData(l.model.signid,function(e){l.model=e;var t,i=$("#myTab .active"),o=$("a",i);l.model.showDiv=o.attr("for-div"),l.model.dispatchDocDto&&(l.showFlag.tabDispatch=!0,l.dispatchDoc=l.model.dispatchDocDto,2==l.dispatchDoc.dispatchWay&&0==l.dispatchDoc.isMainProject||l.dispatchDoc.fileNum?l.businessFlag.isCreateDisFileNum=!0:l.showFlag.buttDisFileNum=!0),l.model.fileRecordDto&&(l.showFlag.tabFilerecord=!0,l.fileRecord=l.model.fileRecordDto),l.model.workProgramDtoList&&0<l.model.workProgramDtoList.length&&""!=(t="1"==l.model.workProgramDtoList[0].branchId||"1"==l.model.workProgramDtoList[0].branchId?l.model.workProgramDtoList[0].reviewOrgName:l.model.workProgramDtoList[0].mainWorkProgramDto.reviewOrgName)&&1<t.split(",").length&&(l.showTotalInvestment=!0),1<l.model.processState&&(l.showFlag.tabWorkProgram=!0),l.model.suppLetterDtoList&&(l.showSupperIndex=0),null!=l.model.registerFileDtoDtoList&&(l.supply=[],l.registerFile=[],l.drawingFile=[],l.otherFile=[],l.model.registerFileDtoDtoList.forEach(function(e,t){"3"==e.businessType||"5"==e.businessType||"6"==e.businessType||"7"==e.businessType?l.supply.push(e):"2"==e.businessType?l.drawingFile.push(e):"1"==e.businessType||"4"==e.businessType?l.registerFile.push(e):"5"!=e.businessType&&"6"!=e.businessType&&"7"!=e.businessType||l.otherFile.push(e)}))}),t.findByMianId(l.model.signid,function(e){e&&0<e.length&&(l.showFlag.tabSysFile=!0,l.sysFileList=e,t.initZtreeClient(l,a))}),l.commonDownloadSysFile=function(e){t.downloadFile(e)},l.templatePage=function(e){r.templatePage(e)},l.splitPayment=function(e,t,i){l.expertSelect={},l.expertSelect.id=e,l.expertSelect.isSplit=9,l.expertSelect.oneCost="1000",l.expertName=t.name,l.reviewCost=i,$("#splitPayment").kendoWindow({width:"50%",height:"300px",title:"专家评审费打印方案",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open(),a.$watch("vm.expertSelect.isSplit",function(e,t){e!=t&&(9==l.expertSelect.isSplit&&(l.expertSelect.oneCost="1000"),0==l.expertSelect.isSplit&&(l.expertSelect.oneCost="0"))})},l.saveSplit=function(){common.initJqValidation(),$("form").valid()&&s.saveSplit(l)}}angular.module("app").controller("signFlowDetailCtrl",e),e.$inject=["sysfileSvc","signSvc","$state","flowSvc","signFlowSvc","$scope","templatePrintSvc","expertReviewSvc"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.model={},n.title="新增预签收收文",n.reserveAdd=function(){common.initJqValidation($("#reserveform")),$("#reserveform").valid()?t.reserveAdd(n.model,function(e){e.flag||"ok"==e.reCode?o.success("操作成功，请继续填写项目审核登记表",function(){i.go("fillSign",{signid:e.reObj.signid},{reload:!0})}):o.error(e.reMsg)}):o.alert("操作失败，有红色*号的选项为必填项，请按要求填写！")}}angular.module("app").controller("signReserveAddCtrl",e),e.$inject=["$location","reserveSignSvc","$state","bsWin"]}(),function(){"use strict";function e(e,t,i,o,n,a,r){var s=this;s.model={},s.title="预签收列表",s.stateName=i.current.name,s.queryParams={},s.saveView=function(){o.storeView(s.stateName,{gridParams:s.gridOptions.dataSource.transport.options.read.data(),queryParams:s.queryParams,data:s})},s.querySign=function(){s.gridOptions.dataSource._skip=0,s.gridOptions.dataSource.read()},s.del=function(e){a.confirm({title:"询问提示",message:"确认删除该条项目数据吗？",onOk:function(){n.deleteSign(e,function(e){e.flag||"ok"==e.reCode?a.alert("删除成功！",function(){s.gridOptions.dataSource.read()}):a.alert(e.reMsg)})}})},s.realSign=function(e){a.confirm({title:"询问提示",message:"确认正式签收了么？",onOk:function(){n.realSign(e,function(e){e.flag||"ok"==e.reCode?a.success("操作成功！",function(){s.gridOptions.dataSource.read()}):a.error(e.reMsg)})}})},s.startNewFlow=function(e){a.confirm({title:"询问提示",message:"确认已经完成填写，并且发起流程么？",onOk:function(){$(".confirmDialog").modal("hide"),r.startFlow(e,function(e){e.flag||"ok"==e.reCode?a.success("操作成功！",function(){s.gridOptions.dataSource.read()}):a.error(e.reMsg)})}})},s.getPreSignInfo=function(){""!=s.model.filecode&&null!=s.model.filecode?t.getPreSignInfo(s.model.filecode,"1",function(e){if(e.flag||"ok"==e.reCode){if("保存成功！"!=e.reMsg)return void a.alert(e.reMsg);s.gridOptions.dataSource.read()}else a.alert(e.reMsg)}):a.alert("收文编号不能为空!")},function(){if(o.view[s.stateName]){var e=o.view[s.stateName];e.gridParams&&(s.gridParams=e.gridParams),e.data&&(s.model=e.data.model),e.queryParams&&(s.queryParams=e.queryParams),t.grid(s),o.view[s.stateName]=void 0}else t.grid(s)}()}angular.module("app").controller("signReserveCtrl",e),e.$inject=["$location","reserveSignSvc","$state","$rootScope","signSvc","bsWin","signFlowSvc"]}(),function(){"use strict";function e(n,e){var o=rootPath+"/sign";return{grid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(o+"/reserveListSign",$("#reserveFrom"),e.gridParams),schema:{data:"value",total:function(e){return e.count?$("#GET_RESERVESIGN_COUNT").html(e.count):$("#GET_RESERVESIGN_COUNT").html(0),e.count},model:{id:"signid"}},serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:e.queryParams.pageSize||10,page:e.queryParams.page||1,sort:{field:"createdDate",dir:"desc"}}),i=[{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{title:"项目名称",width:280,template:function(e){return'<a ng-click="vm.saveView()"  href="#/signDetails/'+e.signid+"/"+e.processInstanceId+'" >'+e.projectname+"</a>"}},{field:"filecode",title:"委里收文编号",width:120,filterable:!1},{field:"designcompanyName",title:"项目单位",width:220,filterable:!1},{field:"reviewstage",title:"项目阶段",width:130,filterable:!1},{field:"projectcode",title:"项目代码",width:210,filterable:!1},{field:"receivedate",title:"收文日期",width:160,filterable:!1,format:"{0:yyyy-MM-dd HH:mm:ss}"},{field:"",title:"操作",width:320,template:function(e){var t=!1;e.processInstanceId&&(t=!0);var i=!1;return!e.issign||9!=e.issign&&"9"!=e.issign||(i=!0),common.format($("#columnBtns").html(),e.signid,t,e.signid+"/"+e.processInstanceId,"vm.del('"+e.signid+"')","vm.startNewFlow('"+e.signid+"')","vm.realSign('"+e.signid+"')",i)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig(e.queryParams).pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:common.kendoGridConfig(e.queryParams).dataBound,resizable:!0}},getsignById:function(t){var e={method:"get",url:o+"/html/findByIdsign",params:{id:t.id}};common.http({vm:t,$http:n,httpOptions:e,success:function(e){t.model=e.data}})},reserveAdd:function(e,t){var i={method:"post",url:rootPath+"/sign/html/reserveAddPost",data:e};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},deleteReserveSign:function(t,e){t.isSubmit=!0;var i={method:"delete",url:o+"/deleteReserve",params:{signid:e}};common.http({vm:t,$http:n,httpOptions:i,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})}})},getPreSignInfo:function(e,t,i){var o={method:"get",url:rootPath+"/intfc/getPreSign",params:{fileCode:e,signType:t}};common.http({$http:n,httpOptions:o,success:function(e){null!=i&&"function"==typeof i&&i(e.data)}})}}}angular.module("app").factory("reserveSignSvc",e),e.$inject=["$http","$state"]}(),function(){"use strict";function e(t,e,i,o,n,a,r,s){var l=this;l.model={},l.flow={},l.model.signid=i.params.signid,l.flow.processInstanceId=i.params.processInstanceId,l.showFlag={tabWorkProgram:!1,tabBaseWP:!1,tabDispatch:!1,tabFilerecord:!1,tabExpert:!1,tabSysFile:!1,tabAssociateSigns:!1},l.businessFlag={expertReviews:[]},l.expertList=new Array(15),function(){$("#myTab li").click(function(e){var t=$("a",this);e.preventDefault(),t.tab("show");var i=t.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500),l.model.showDiv=i}),i.params.processInstanceId&&o.initFlowData(l);e.initFlowPageData(l.model.signid,function(e){l.model=e;var t,i=$("#myTab .active"),o=$("a",i);(l.model.showDiv=o.attr("for-div"),l.model.dispatchDocDto&&(l.showFlag.tabDispatch=!0,l.dispatchDoc=l.model.dispatchDocDto,r.findAssistPlanSignById(l.model.signid,function(e){l.assistPlanSign=e})),l.model.workProgramDtoList&&0<l.model.workProgramDtoList.length)&&(""!=(t="1"==l.model.workProgramDtoList[0].branchId||"1"==l.model.workProgramDtoList[0].branchId?l.model.workProgramDtoList[0].reviewOrgName:l.model.workProgramDtoList[0].mainWorkProgramDto.reviewOrgName)&&1<t.split(",").length&&(l.showTotalInvestment=!0));l.model.fileRecordDto&&(l.showFlag.tabFilerecord=!0,l.fileRecord=l.model.fileRecordDto),1<l.model.processState&&(l.showFlag.tabWorkProgram=!0),l.model.suppLetterDtoList&&(l.showSupperIndex=0),null!=l.model.registerFileDtoDtoList&&(l.supply=[],l.registerFile=[],l.drawingFile=[],l.otherFile=[],l.model.registerFileDtoDtoList.forEach(function(e,t){"3"==e.businessType||"5"==e.businessType||"6"==e.businessType||"7"==e.businessType?l.supply.push(e):"2"==e.businessType?l.drawingFile.push(e):"1"==e.businessType||"4"==e.businessType?l.registerFile.push(e):"5"!=e.businessType&&"6"!=e.businessType&&"7"!=e.businessType||l.otherFile.push(e)}))}),t.findByMianId(l.model.signid,function(e){e&&0<e.length&&(l.showFlag.tabSysFile=!0,l.sysFileList=e,t.initZtreeClient(l,n))})}(),l.templatePage=function(e){a.templatePage(e)},l.commonDownloadSysFile=function(e){t.downloadFile(e)},l.splitPayment=function(e,t,i){l.expertSelect={},l.expertSelect.id=e,l.expertSelect.isSplit=9,l.expertSelect.oneCost="1000",l.expertName=t.name,l.reviewCost=i,$("#splitPayment").kendoWindow({width:"50%",height:"300px",title:"专家评审费打印方案",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open(),n.$watch("vm.expertSelect.isSplit",function(e,t){e!=t&&(9==l.expertSelect.isSplit&&(l.expertSelect.oneCost="1000"),0==l.expertSelect.isSplit&&(l.expertSelect.oneCost="0"))})},l.saveSplit=function(){common.initJqValidation(),$("form").valid()&&s.saveSplit(l)}}angular.module("app").controller("signDetailsCtrl",e),e.$inject=["sysfileSvc","signSvc","$state","flowSvc","$scope","templatePrintSvc","assistSvc","expertReviewSvc"]}(),function(){"use strict";function e(n,e,t,i,o){return{signGrid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/sign/findBySignUser",$("#searchform"),e.gridParams),schema:{data:"value",total:function(e){return e.count?$("#GET_SIGN_COUNT").html(e.count):$("#GET_SIGN_COUNT").html(0),e.count},model:{id:"signid"}},serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:e.queryParams.pageSize||10,page:e.queryParams.page||1,sort:{field:"createdDate",dir:"desc"}}),i=[{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"",title:"项目名称",width:280,filterable:!1,template:function(e){return'<a ng-click="vm.saveView()"  href="#/fillSign/'+e.signid+'/" >'+e.projectname+"</a>"}},{field:"filecode",title:"委里收文编号",width:140,filterable:!1},{field:"designcompanyName",title:"项目单位",width:260,filterable:!1},{field:"reviewstage",title:"评审阶段",width:130,filterable:!1},{field:"projectcode",title:"项目代码",width:210,filterable:!1},{field:"signdate",title:"签收日期",width:100,filterable:!1,format:"{0:yyyy-MM-dd HH:mm:ss}"},{field:"",title:"流程状态",width:80,filterable:!1,template:function(e){return e.signState?1==e.signState?'<span style="color:green;">进行中</span>':2==e.signState?'<span style="color:orange;">已暂停</span>':8==e.signState?'<span style="color:red;">强制结束</span>':9==e.signState?'<span style="color:blue;">已完成</span>':5==e.signState?"未发起":"":"未发起"}},{field:"",title:"操作",width:320,template:function(e){var t=!1;e.processInstanceId&&(t=!0);var i=!1;return!e.issign||9!=e.issign&&"9"!=e.issign||(i=!0),common.format($("#columnBtns").html(),e.signid,t,e.signid+"/"+e.processInstanceId,"vm.del('"+e.signid+"')",t,"vm.startNewFlow('"+e.signid+"')",t,"vm.realSign('"+e.signid+"')",i)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,pageable:common.kendoGridConfig(e.queryParams).pageable,dataBound:common.kendoGridConfig(e.queryParams).dataBound,resizable:!0}},createSign:function(e,t){var i={method:"post",url:rootPath+"/sign",data:e};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},initFillData:function(e,t){var i={method:"post",url:rootPath+"/sign/html/initFillPageData",params:{signid:e}};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},initDetailData:function(e,t){var i={method:"get",url:rootPath+"/sign/html/initDetailPageData",params:{signid:e}};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},updateFillin:function(e,t){var i={method:"put",url:rootPath+"/sign",data:e};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},deleteSign:function(e,t){var i={method:"delete",url:rootPath+"/sign",params:{signid:e}};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},findOfficeUsersByDeptName:function(e,t){var i={method:"post",url:rootPath+"/officeUser/findOfficeUsersByDeptName",data:e};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},initFlowPageData:function(e,t){var i={method:"get",url:rootPath+"/sign/initFlowPageData",params:{signid:e,queryAll:!0}};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},removeWP:function(t,i){var e={method:"delete",url:rootPath+"/workprogram/deleteBySignId",params:{signId:t.model.signid}};common.http({vm:t,$http:n,httpOptions:e,success:function(e){t.isSubmit=!1,null!=i&&"function"==typeof i&&i(e.data)}})},associateGrid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/sign/fingByOData",$("#searchAssociateform"),{filter:"isAssociate eq 0"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}});e.associateGridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:[{field:"projectname",title:"项目名称",width:160,filterable:!1},{field:"projectcode",title:"收文编号",width:140,filterable:!1},{field:"designcompanyName",title:"项目单位",width:200,filterable:!1},{field:"reviewstage",title:"项目阶段",width:160,filterable:!1},{field:"projectcode",title:"项目代码",width:140,filterable:!1}],resizable:!0}},getAssociateSign:function(e,t){var i={method:"post",url:rootPath+"/sign/findAssociateSign",data:e};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},getAssociateSignGrid:function(e,t){n({method:"post",url:rootPath+"/sign/findAssociateSignList",params:{signid:e.price.signid,reviewstage:e.price.reviewstage,projectname:e.price.projectname,mUserName:e.price.mUserName,skip:e.price.skip,size:e.price.size}}).then(function(e){"function"==typeof t&&t(e.data)})},saveAssociateSign:function(e,t,i){t="undefined"==t?null:t;var o={method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},url:rootPath+"/sign/associate",data:$.param({signId:e,associateId:t},!0)};common.http({$http:n,httpOptions:o,success:function(e){null!=i&&"function"==typeof i&&i(e.data)}})},initAssociateSigns:function(r,e){var t={method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded"},url:rootPath+"/sign/associate?signId="+e};common.http({vm:r,$http:n,httpOptions:t,success:function(a){common.requestSuccess({vm:r,response:a,fn:function(){if(null!=a.data){r.associateSign=a.data;for(var e=a.data,t="",i=e.length-1;0<=i;i--){var o=e[i],n=o.signdate||"";t+='<div class="intro-list"><div class="intro-list-left">项目阶段：'+o.reviewstage+"<br/>签收时间："+n+'</div><div class="intro-list-right"><span></span><div class="intro-list-content">名称：<span style="color:red;">'+o.projectname+'</span><br/>送件人：<span style="color:red;">'+o.sendusersign+"</span><br/></div></div></div>"}$("#introFlow").html(t);$("#myStep").step({animate:!0,initStep:1,speed:1e3})}}})}})},meetingDoc:function(e,t){var i={method:"get",url:rootPath+"/workprogram/createMeetingDoc",params:{signId:e.model.signid}};common.http({vm:e,$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},createDispatchFileNum:function(e,t,i){var o={method:"post",url:rootPath+"/dispatch/createFileNum",params:{signId:e,dispatchId:t}};common.http({$http:n,httpOptions:o,success:function(e){null!=i&&"function"==typeof i&&i(e.data)}})},realSign:function(e,t){var i={method:"post",url:rootPath+"/sign/realSign",params:{signid:e}};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},createDispatchTemplate:function(e,t){var i={method:"post",url:rootPath+"/dispatch/createDispatchTemplate",params:{signId:e.model.signid}};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},signGetBackGrid:function(e){var t=common.kendoGridDataSource(rootPath+"/sign/fingByGetBack",$("#signBackform"),e.queryParams.page,e.queryParams.pageSize,e.gridParams),i=[{field:"",title:"序号",template:"<span class='row-number'></span>",width:50},{field:"projectName",title:"项目名称",width:"25%",filterable:!1},{field:"nodeNameValue",title:"当前环节",width:"10",filterable:!1},{field:"displayName",title:"处理人",width:"10",filterable:!1},{field:"",title:"合并评审",width:"12%",filterable:!1,template:function(e){return e.reviewType?9==e.reviewType||"9"==e.reviewType?"合并评审[主项目]":"合并评审[次项目]":"否"}},{field:"reviewStage",title:"项目阶段",width:"15%",filterable:!1},{field:"signDate",title:"签收时间",width:"10%",filterable:!1},{field:"",title:"操作",width:"12%",template:function(e){return common.format($("#columnBtns").html(),"signFlowDetail",e.businessKey,e.taskId,e.processInstanceId,"vm.getBack")}}];e.signGetBackGrid={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,pageable:common.kendoGridConfig(e.queryParams).pageable,dataBound:common.kendoGridConfig(e.queryParams).dataBound,resizable:!0}},getBack:function(e,t,i){var o={method:"post",url:rootPath+"/sign/getBack",params:{taskId:e,businessKey:t}};common.http({$http:n,httpOptions:o,success:function(e){null!=i&&"function"==typeof i&&i(e.data)}})},editTemplatePrint:function(e){"项目建议书"==e.model.reviewstage||"可行性研究报告"==e.model.reviewstage||"其它"==e.model.reviewstage?o.templatePrint("sign_fill_xmjys_templ"):"资金申请报告"==e.model.reviewstage?o.templatePrint("sign_fill_zjsq_templ"):"进口设备"==e.model.reviewstage?o.templatePrint("sign_fill_jksb_templ"):"设备清单（国产）"==e.model.reviewstage||"设备清单（进口）"==e.model.reviewstage?o.templatePrint("sign_fill_sbqd_templ"):"项目概算"==e.model.reviewstage&&o.templatePrint("sign_fill_xmgs_templ")},signDeletGrid:function(e){var t=common.kendoGridDataSource(rootPath+"/signView/getSignList?$orderby=receivedate",$("#deletform"),e.queryParams.page,e.queryParams.pageSize,e.gridParams),i=[{field:"",title:"序号",template:"<span class='row-number text-center'></span>",width:40},{field:"",title:"项目名称",width:160,filterable:!1,template:function(e){return e.processInstanceId?'<a ng-click="vm.saveView()" href="#/signDetails/'+e.signid+"/"+e.processInstanceId+'" >'+e.projectname+"</a>":'<a ng-click="vm.saveView()" href="#/signDetails/'+e.signid+'/" >'+e.projectname+"</a>"}},{field:"reviewstage",title:"项目阶段",width:110,filterable:!1},{field:"projectcode",title:"项目代码",width:100,filterable:!1},{field:"signdate",title:"签收日期",width:100,filterable:!1,format:"{0:yyyy/MM/dd HH:mm:ss}"},{field:"",title:"操作",width:90,filterable:!1,template:function(e){return common.format($("#columnBtns").html(),"vm.editSignState('"+e.signid+"')")}}];e.signListOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,pageable:common.kendoGridConfig(e.queryParams).pageable,dataBound:common.kendoGridConfig(e.queryParams).dataBound}},editSignState:function(e,t){var i={method:"post",url:rootPath+"/sign/editSignState",params:{signId:e.signid,stateProperty:"signState",stateValue:e.stateValue}};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},sumExistDays:function(e,t){var i={method:"post",url:rootPath+"/sign/sumExistDays",params:{signIds:e}};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},MaintenanProjectGrid:function(e){var t=common.kendoGridDataSource(rootPath+"/signView/getSignList",$("#Maintenanform"),e.queryParams.page,e.queryParams.pageSize,e.gridParams);e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:[{field:"",title:"序号",template:"<span class='row-number text-center'></span>",width:50},{field:"",title:"项目名称",width:260,filterable:!1,template:function(e){return e.processInstanceId?'<a ng-click="vm.saveView()" href="#/MaintainProjectEdit/'+e.signid+"/"+e.processInstanceId+'" >'+e.projectname+"</a>":'<a ng-click="vm.saveView()" href="#/MaintainProjectEdit/'+e.signid+'/" >'+e.projectname+"</a>"}},{field:"builtcompanyname",title:"建设单位",width:210,filterable:!1},{field:"reviewstage",title:"评审阶段",width:120,filterable:!1},{field:"",title:"项目状态",width:80,filterable:!1,template:function(e){var t="";switch(e.signState){case"1":t="进行中";break;case"2":t="暂停";break;case"8":t="强制结束";break;case"9":t="已完成"}return t}},{field:"signNum",title:"收文编号",width:100,filterable:!1},{field:"signdate",title:"收文日期",width:100,filterable:!1},{field:"dfilenum",title:"发文号",width:100,filterable:!1},{field:"ffilenum",title:"归档编号",width:130,filterable:!1},{field:"reviewOrgName",title:"所属部门",width:100,filterable:!1},{field:"allPriUser",title:"项目负责人",width:100,filterable:!1},{field:"dispatchType",title:"发文类型",width:100,filterable:!1},{field:"appalyInvestment",title:"申报金额",width:100,filterable:!1},{field:"authorizeValue",title:"审定金额",width:100,filterable:!1},{field:"extraValue",title:"核减",width:100,filterable:!1},{field:"approveValue",title:"批复金额",width:100,filterable:!1}],resizable:!0,pageable:common.kendoGridConfig(e.queryParams).pageable,dataBound:common.kendoGridConfig(e.queryParams).dataBound}},excelExport:function(e){var t=$("#countSignDayForm");t.attr("target",""),t.attr("method","post"),t.attr("action",rootPath+"/signView/excelExport"),t.find("input[name='signIds']").val(e),t.submit()},excelExport2:function(e){var t=$("#countSignDayForm");t.attr("target",""),t.attr("method","post"),t.attr("action",rootPath+"/signView/excelExport2"),t.find("input[name='signIds']").val(e),t.submit()},findExpertReview:function(e,t){var i={method:"post",url:rootPath+"/signwork/fingSignWorkById",params:{signId:e}};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},getSignInfo:function(e,t,i){var o={method:"get",url:rootPath+"/intfc/getPreSign",params:{fileCode:e,signType:t}};common.http({$http:n,httpOptions:o,success:function(e){null!=i&&"function"==typeof i&&i(e.data)}})},findSignUnitScore:function(e,t){var i={method:"post",url:rootPath+"/sign/findSignUnitScore",params:{signId:e}};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},findAVGDayById:function(e,t){var i={method:"post",url:rootPath+"/sign/findAVGDayId",params:{signIds:e}};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},addAOrg:function(e,t,i){var o={method:"post",url:rootPath+"/sign/addAOrg",params:{signId:t,orgIds:e}};common.http({$http:n,httpOptions:o,success:function(e){null==i&&"function"!=typeof i||i(e.data)}})},deleteAOrg:function(e,t,i){var o={method:"delete",url:rootPath+"/sign/deleteOrg",params:{orgIds:e,signId:t}};common.http({$http:n,httpOptions:o,success:function(e){null==i&&"function"!=typeof i||i(e.data)}})},addSecondUser:function(e,t,i){var o={method:"post",url:rootPath+"/sign/addSecondUser",params:{userId:e,signId:t}};common.http({$http:n,httpOptions:o,success:function(e){null==i&&"function"!=typeof i||i(e.data)}})},deleteSecondUser:function(e,t,i){var o={method:"delete",url:rootPath+"/sign/deleteSecondUser",params:{userId:e,signId:t}};common.http({$http:n,httpOptions:o,success:function(e){null==i&&"function"!=typeof i||i(e.data)}})},saveMoreExpert:function(e,t,i){var o={method:"post",url:rootPath+"/sign/saveMoreExpert",params:{signId:e,isMoreExpert:t}};common.http({$http:n,httpOptions:o,success:function(e){null!=i&&"function"==typeof i&&i(e.data)}})},updateFGWState:function(e,t,i){var o={method:"post",url:rootPath+"/sign/updateSendFGWState",params:{signId:e,state:t}};common.http({$http:n,httpOptions:o,success:function(e){null!=i&&"function"==typeof i&&i(e.data)}})}}}angular.module("app").factory("signSvc",e),e.$inject=["$http","$state","bsWin","sysfileSvc","templatePrintSvc"]}(),function(){"use strict";function e(e,n){var s=this;function t(){s.review=["项目建议书","可行性研究报告","项目概算","资金申请报告","其它"],s.title="项目申报投资金额分布情况",s.capital=["申报金额","审定金额"],s.yAxisName="金额（亿元）",s.lineLegendData=["审定/申报"],s.lineResultValue=[],s.LineYAxisName="百分比（%）",s.appalyinvestment=[],s.authorizeValue=[],s.extraRate=[],s.resultData=[],e.findByTime(s,function(e){if(e.flag||"ok"==e.reCode){var t=e.reObj;if(null!=t&&0<t.length){for(var i=0;i<s.review.length;i++)for(var o=0;o<t.length;o++)$.each(t[o],function(e,t){e==s.review[i]&&(s.appalyinvestment.push(t[0]),s.authorizeValue.push(t[1]),s.lineResultValue.push(null==t[3]?0:t[3]),s.extraRate.push({reviewStage:e,value:null==t[4]?0:t[4]}))});s.resultData.push(s.appalyinvestment,s.authorizeValue),s.gotoLineChart()}}else n.error(e.reMsg)})}s.startTime=(new Date).halfYearAgo(),s.endTime=(new Date).Format("yyyy-MM-dd"),s.statsType="1",s.chartType="lineChart",s.reviewStage=[],$("input[type='radio']").click(function(){var e=$("input[type='radio']:checked").val();"lineChart"==e?s.gotoLineChart():"histogram"==e?s.gotoHistogram():"pie"==e&&s.gotoPie()}),s.resetChart=function(){s.resultData=[],"1"==s.statsType&&(s.chartType="lineChart",t()),"2"==s.statsType&&(s.chartType="histogram",s.review=["项目建议书","可行性研究报告","项目概算","资金申请报告","设备清单（进口）","设备清单（国产）","进口设备","其它"],s.title="项目类别分布情况",s.capital=["市政工程","房建工程","信息工程","设备采购","其他"],s.yAxisName="项目个数",s.sz=[],s.fj=[],s.xx=[],s.sb=[],s.qt=[],s.lineLegendData=["审定/申报"],s.lineResultValue=[],s.LineYAxisName="百分比（%）",e.findByTypeAndReview(s,function(e){if(e.flag||"ok"==e.reCode){for(var t=e.reObj,i=0;i<s.review.length;i++)for(var o=0;o<t.length;o++)$.each(t[o],function(e,t){e==s.review[i]&&(s.sz.push(t[0]),s.fj.push(t[1]),s.xx.push(t[2]),s.sb.push(t[3]),s.qt.push(t[4]))});s.resultData.push(s.sz,s.fj,s.xx,s.sb,s.qt),s.gotoHistogram()}else n.error(e.reMsg)})),"3"==s.statsType&&(s.chartType="pie",s.title="项目申报投资金额分布情况",s.stage=["3000万以下","3000万-1亿","1亿-10亿","10亿以上"],e.pieData(s,function(e){e.flag||"ok"==e.reCode?(s.resultData=e.reObj,null!=s.resultData&&null!=s.resultData?s.gotoPie():n.error("该时间段没有数据！")):n.error(e.reMsg)}))},s.gotoHistogram=function(){s.showHistogram=!0,s.showLineChart=!1,s.showPie=!1,s.series=[];for(var e=0;e<s.capital.length;e++)s.series.push({name:s.capital[e],type:"bar",data:s.resultData[e],barWidth:10,itemStyle:{normal:{label:{show:!0,position:"top",formatter:function(e){return e.value}}}}});s.initHistogram()},s.initHistogram=function(){var e=echarts.init(document.getElementById("histogram")),t={title:{text:s.title,x:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#283b56"}}},legend:{orient:"vertical",left:"left",data:s.capital},toolbox:{show:!0,x:"80%",feature:{dataView:{show:!0,readOnly:!0},restore:{show:!0},saveAsImage:{show:!0}},optionToContent:function(e){var t=e.xAxis[0].data,i=e.series,o='<table id="test" class="table-bordered table-striped" style="width:100%;text-align:center">';o+="<tbody><tr>",o+='<th style="text-align: center;">评审阶段</th>';for(var n=0;n<i.length;n++)"1"==s.statsType&&(o+='<th style="text-align: center;">'+i[n].name+"(亿元)</th>"),"2"==s.statsType&&(o+='<th style="text-align: center;">'+i[n].name+"(个)</th>");o+="</tr>";n=0;for(var a=t.length;n<a;n++){o+="<tr><td>"+t[n]+"</td>";for(var r=0;r<i.length;r++)o+="<td>"+i[r].data[n]+"</td>"}return o+="</tbody>"}},grid:{left:"13%",right:"10%",bottom:"10%",containLabel:!0},xAxis:{type:"category",name:"评审阶段",data:s.review,axisTick:{alignWithLabel:!0},axisLabel:{interval:0,rotate:35,margin:2,textStyle:{fontWeight:"bolder",color:"#295645"}}},yAxis:{type:"value",name:s.yAxisName,min:0},series:s.series,itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0,0,0,0.5)"}}};e.clear(),e.setOption(t)},s.gotoLineChart=function(){s.showHistogram=!1,s.showPie=!1,s.showLineChart=!0,s.lineSeries=[];for(var e=0;e<s.lineLegendData.length;e++)s.lineSeries.push({name:s.lineLegendData[e],type:"line",data:s.lineResultValue,itemStyle:{normal:{label:{show:!0,position:"top",textStyle:{fontWeight:"normal",fontSize:15},formatter:function(e){return e.value}}}}});s.initLineChart()},s.initLineChart=function(){var e=echarts.init(document.getElementById("lineChart")),t={title:{text:s.title,x:"center"},tooltip:{trigger:"item",formatter:function(e){for(var t=0;t<s.extraRate.length;t++)if(e.name==s.extraRate[t].reviewStage)return e.name+"<br/> 核减率 : "+s.extraRate[t].value+"%"}},grid:{left:"13%",right:"10%",bottom:"10%",containLabel:!0},toolbox:{show:!0,x:"80%",feature:{dataView:{show:!0,readOnly:!0},restore:{show:!0},saveAsImage:{show:!0}},optionToContent:function(e){var t=e.xAxis[0].data,i=e.series,o='<table id="test" class="table-bordered table-striped" style="width:100%;text-align:center">';o+="<tbody><tr>",o+='<th style="text-align: center;">评审阶段</th>';for(var n=0;n<i.length;n++)o+='<th style="text-align: center;">'+i[n].name+"</th>";o+="</tr>";n=0;for(var a=t.length;n<a;n++){o+="<tr><td>"+t[n]+"</td>";for(var r=0;r<i.length;r++)o+="<td>"+i[r].data[n]+"</td>"}return o+="</tbody>"}},legend:{orient:"vertical",left:"left",data:s.lineLegendData},xAxis:{type:"category",name:"评审阶段",splitLine:{show:!1},data:s.review,axisLabel:{interval:0,rotate:35,margin:2,textStyle:{fontWeight:"bolder",color:"#295645"}}},yAxis:{type:"value",name:s.LineYAxisName,min:0},series:s.lineSeries,lineStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0,0,0,0.5)"}}};e.clear(),e.setOption(t)},s.gotoPie=function(){s.showHistogram=!1,s.showLineChart=!1,s.showPie=!0,s.series=[],s.tooltipFormater=[];for(var e=0;e<s.resultData[1].length;e++)s.series.push({value:s.resultData[1][e],name:s.stage[e],label:{normal:{formatter:" {b} : {c}%",textStyle:{fontWeight:"normal",fontSize:15}}}}),s.tooltipFormater.push({seriesName:"项目数",totalName:"项目总数",totalValue:s.resultData[2],name:s.stage[e],pidName:"占百分比",data:s.resultData[0][e],value:s.resultData[1][e]});s.initPie()},s.initPie=function(){var e=echarts.init(document.getElementById("pie")),t={title:{text:s.title,x:"center"},tooltip:{trigger:"item",width:150,formatter:function(e){for(var t=0;t<s.tooltipFormater.length;t++)if(s.tooltipFormater[t].name==e.name)return e.name+"<br/>"+s.tooltipFormater[t].seriesName+" : "+s.tooltipFormater[t].data+"<br/>"+s.tooltipFormater[t].totalName+" : "+s.tooltipFormater[t].totalValue+"<br/>"+s.tooltipFormater[t].pidName+" : "+s.tooltipFormater[t].value+"%"}},grid:{left:"10%",right:"10%",bottom:"10%",containLabel:!0},toolbox:{show:!0,x:"80%",feature:{dataView:{show:!0,readOnly:!0},restore:{show:!0},saveAsImage:{show:!0}},optionToContent:function(e){var t=e.series[0].data,i='<table id="test" class="table-bordered table-striped" style="width:100%;text-align:center">';i+="<tbody><tr>",i+='<th style="text-align: center;">申报金额范围</th>',i+='<th style="text-align: center;">占百分比(%)</th>',i+="</tr>";for(var o=0,n=t.length;o<n;o++)i+="<tr><td>"+t[o].name+"</td>",i+="<td>"+t[o].value+"</td>";return i+="</tbody>"}},legend:{orient:"vertical",left:"left",data:s.stage},series:[{type:"pie",radius:"30%",center:["50%","50%"],selectMode:"single",data:s.series,itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0,0,0,0.5)"}}}]};e.clear(),e.setOption(t)},t()}angular.module("app").controller("signChartCtrl",e),e.$inject=["signChartSvc","bsWin"]}(),function(){"use strict";function e(o){return{findByTime:function(e,t){var i={method:"post",url:rootPath+"/signView/findByTime",params:{startTime:e.startTime,endTime:e.endTime}};common.http({vm:e,httpOptions:i,$http:o,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},pieData:function(e,t){var i={method:"post",url:rootPath+"/signView/pieDate",params:{startTime:e.startTime,endTime:e.endTime}};common.http({vm:e,httpOptions:i,$http:o,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},findByTypeAndReview:function(e,t){var i={method:"post",url:rootPath+"/signView/findByTypeAndReview",params:{startTime:e.startTime,endTime:e.endTime}};common.http({vm:e,httpOptions:i,$http:o,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},getDate:function(t){var e={method:"post",url:rootPath+"/signView/getDate"};common.http({httpOptions:e,$http:o,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}}}angular.module("app").factory("signChartSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(t,e,i,o,n,a,r){var s=this;s.title="作废项目列表",s.stateName=n.current.name,s.queryParams={},s.saveView=function(){a.storeView(s.stateName,{gridParams:s.signListOptions.dataSource.transport.options.read.data(),queryParams:s.queryParams,data:s})},s.query=function(){s.signListOptions.dataSource._skip=0,s.signListOptions.dataSource.read()},s.editSignState=function(e){s.signid=e,r.getProjectStopBySignId(e,function(e){"9"==e[0].isactive&&"9"==e[0].isOverTime?s.stateValue="2":s.stateValue="1"}),o.confirm({title:"询问提示",message:"确认要恢复项目吗？",onOk:function(){t.editSignState(s,function(e){e.flag||"ok"==e.reCode?o.alert("恢复成功！",function(){s.signListOptions.dataSource.read()}):o.alert(e.reMsg)})}})},s.formReset=function(){var e=$("#deletform").find("input,select").not(":submit, :reset, :image, :disabled,:hidden");$.each(e,function(e,t){t.value=""})},function(){if(a.view[s.stateName]){var e=a.view[s.stateName];e.gridParams&&(s.gridParams=e.gridParams),e.data&&(s.project=e.data.project),e.queryParams&&(s.queryParams=e.queryParams),t.signDeletGrid(s),a.view[s.stateName]=void 0}else t.signDeletGrid(s)}()}angular.module("app").controller("signDeletCtrl",e),e.$inject=["signSvc","flowSvc","signFlowSvc","bsWin","$state","$rootScope","pauseProjectSvc"]}(),function(){"use strict";function e(i,e,t,o,n,a){var r=this;r.stateName=n.current.name,r.queryParams={},r.saveView=function(){a.storeView(r.stateName,{gridParams:r.signGetBackGrid.dataSource.transport.options.read.data(),queryParams:r.queryParams,data:r})},r.getBack=function(e,t){o.confirm({title:"询问提示",message:"确认取回吗？",onOk:function(){i.getBack(e,t,function(e){e.flag||"ok"==e.reCode?o.alert("取回项目成功",function(){r.signGetBackGrid.dataSource.read();var e=parseInt($("#DO_SIGN_COUNT").html());$("#DO_SIGN_COUNT").html(e+1)}):o.alert(e.reMsg)})}})},r.query=function(){r.signGetBackGrid.dataSource._skip=0,r.signGetBackGrid.dataSource.read()},function(){if(a.view[r.stateName]){var e=a.view[r.stateName];e.gridParams&&(r.gridParams=e.gridParams),e.data&&(r.model=e.data.model),e.queryParams&&(r.queryParams=e.queryParams),i.signGetBackGrid(r),a.view[r.stateName]=void 0}else i.signGetBackGrid(r)}()}angular.module("app").controller("signGetBackCtrl",e),e.$inject=["signSvc","flowSvc","signFlowSvc","bsWin","$state","$rootScope"]}(),function(){"use strict";function e(t,e,i,o,n,a){var r=this;r.title="维护项目列表",r.model={},r.stateName=n.current.name,r.queryParams={},r.saveView=function(){a.storeView(r.stateName,{gridParams:r.gridOptions.dataSource.transport.options.read.data(),queryParams:r.queryParams,data:r})},r.query=function(){r.gridOptions.dataSource._skip=0,r.gridOptions.dataSource.read()},r.formReset=function(){var e=$("#deletform").find("input,select").not(":submit, :reset, :image, :disabled,:hidden");$.each(e,function(e,t){t.value=""})},function(){if(a.view[r.stateName]){var e=a.view[r.stateName];e.gridParams&&(r.gridParams=e.gridParams),e.data&&(r.model=e.data.model),e.queryParams&&(r.queryParams=e.queryParams),t.MaintenanProjectGrid(r),a.view[r.stateName]=void 0}else t.MaintenanProjectGrid(r)}()}angular.module("app").controller("MaintainProjectCtrl",e),e.$inject=["signSvc","flowSvc","signFlowSvc","bsWin","$state","$rootScope"]}(),function(){"use strict";function e(e,a,t,i,o,n,r,s,l,c){var d=this;d.title="维护项目修改",d.model={},d.model.signid=t.params.signid,d.model.processInstanceId=t.params.processInstanceId,d.isHaveWork=!1,d.isHaveDis=!1,d.isHaveFile=!1,d.isHaveBaseInfo=!1,d.isHaveNoWP=!1,d.signWorkList={},d.initFileUpload=function(){d.sysFile={businessId:d.model.signid,mainId:d.model.signid,mainType:n.mainTypeValue().SIGN,sysfileType:n.mainTypeValue().WORKPROGRAM,sysBusiType:n.mainTypeValue().WORKPROGRAM},n.initUploadOptions({inputId:"sysfileinput",vm:d,uploadSuccess:function(){n.findByMianId(d.model.signid,function(e){e&&0<e.length&&(d.isDisplay=!0,d.sysFileList=e,n.initZtreeClient(d,o))})}})},$("#myTab li").click(function(e){var t=$("a",this);e.preventDefault(),t.tab("show");var i=t.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500),d.model.showDiv=i}),a.initFlowPageData(d.model.signid,function(e){if(d.model=e,d.model.dispatchDocDto&&(d.dispatchDoc=d.model.dispatchDocDto,d.isHaveDis=!0),d.model.fileRecordDto&&(d.fileRecordDto=d.model.fileRecordDto,d.isHaveFile=!0),d.model.workProgramDtoList){var t=d.model.workProgramDtoList.length;if(0<t){d.isHaveWork=!0;for(var i=0;i<t;i++)"1"==d.model.workProgramDtoList[i].branchId&&(d.work=d.model.workProgramDtoList[i])}}d.model.projBaseInfoDto&&(d.isHaveBaseInfo=!0),d.isHaveWork||d.isHaveBaseInfo||(d.isHaveNoWP=!0),d.orgName=d.model.mOrgName,d.orgName?d.orgName+=null==d.model.aOrgName?"":","+d.model.aOrgName:d.orgName=d.model.aOrgName,d.secondChargeUserName=[],d.model.aUserName&&(d.secondChargeUserName=d.model.aUserName.split(",")),n.findByMianId(d.model.signid,function(e){e&&0<e.length&&(d.isDisplay=!0,d.sysFileList=e,n.initZtreeClient(d,o))})}),d.initFileUpload(),d.addRegisterFile=function(){t.go("registerFile",{businessId:d.model.signid})},d.addWorkProgram=function(){d.isHaveWork?t.go("maintWorkprogramEdit",{signid:d.model.signid}):s.alert("该项目没有工作方案！")},d.addBaseInfo=function(){t.go("initProjBase",{signid:d.model.signid,isadmin:!0})},d.addDisPatch=function(){d.isHaveDis?t.go("dispatchEdit",{signid:d.model.signid,isControl:!0}):s.alert("该项目没有发文！")},d.addDoFile=function(){d.isHaveFile?t.go("fileRecordEdit",{signid:d.model.signid,isControl:!0}):s.alert("该项目还没有填写归档")},d.scrap=function(e){s.confirm({title:"询问提示",message:"确认作废该条项目吗？",onOk:function(){a.deleteSign(e,function(e){e.flag||"ok"==e.reCode?s.alert("操作成功！",function(){t.go("MaintainProjectList")}):s.alert(e.reMsg)})}})},d.pauseProject=function(){e.findPausingProject(d,d.model.signid)},d.addSuppLetter=function(){t.go("addSupp",{businessId:d.model.signid,businessType:"SIGN",isControl:!0})},d.relation=function(){d.model.dispatchDocDto?(d.ss?d.page.selPage(1):d.page=lgx.page.init({id:"demo5",get:function(e){var t;d.price||(d.price={signid:d.model.signid,projectname:d.model.projectname}),d.price.reviewstage=d.model.reviewstage,t=0!=e.skip?e.skip+1:e.skip,d.price.skip=t,d.price.size=e.size+e.skip,a.getAssociateSignGrid(d,function(e){d.associateSignList=[],e&&(d.associateSignList=e.value,d.page.callback(e.count)),d.ss=!0})}}),$("#associateWindow").kendoWindow({width:"75%",height:"750px",title:"项目关联",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()):s.alert("该项目还没有填写发文")},d.findExpertReview=function(e,t){9==t?s.alert("该项目已归档，不能再修改！"):(d.signWorkList={},a.findExpertReview(e,function(e){(e||0<e.length)&&(d.signWorkList=e,$("#signWorkDiv").kendoWindow({width:"860px",height:"320px",title:"抽取专家维护",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open())}))},d.colseOpenWin=function(){window.parent.$("#signWorkDiv").data("kendoWindow").close()},d.commonDownloadSysFile=function(e){n.downloadFile(e)},d.delFile=function(e){s.confirm({title:"询问提示",message:"确认删除么？",onOk:function(){n.delSysFile(e,function(){s.alert("删除成功",function(){n.findByMianId(d.model.signid,function(e){e&&0<e.length&&(d.sysFileList=e,n.initZtreeClient(d,o))})})})}})},d.associateQuerySign=function(){a.getAssociateSignGrid(d,function(e){d.associateSignList=[],e&&(d.associateSignList=e.value,d.page.callback(e.count))})},d.saveAssociateSign=function(t){d.model.signid!=t?a.saveAssociateSign(d.model.signid,t,function(e){e.flag||"ok"==e.reCode?(t?(d.model.isAssociate=1,d.associateDispatchs=e.reObj):d.associateDispatchs=[],s.alert(null!=t?"项目关联成功":"项目解除关联成功",function(){window.parent.$("#associateWindow").data("kendoWindow").close()})):s.alert(e.reMsg)}):s.alert("不能关联自身项目")},d.addReviewDept=function(){$("#addReviewDeptWindow").kendoWindow({width:"600px",height:"400px",title:"评审部门管理",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open(),l.queryOrgList(d,function(e){if(d.orgs=e,d.work&&d.work.reviewOrgName)for(var o=d.work.reviewOrgName.split(","),n=0;n<o.length;n++)$.each(d.orgs,function(e,t){if(t.name==o[n]){var i=t.id;$("#"+i).attr("disabled","disabled")}})})},d.saveReviewDept=function(e,t){a.addAOrg(e,d.model.signid,function(e){e.flag||"ok"==e.reCode?(s.alert(e.reMsg),d.orgName+=(null==d.orgName?"":",")+t):s.error(e.reMsg)})},d.deleteReviewDept=function(e,o){a.deleteAOrg(e,d.model.signid,function(e){if(e.flag||"ok"==e.reCode){s.alert(e.reMsg);for(var t=d.orgName.split(","),i=0;i<t.length;i++)if(t[i]==o){t.splice(i,1);break}d.orgName=t.join(",")}else s.error(e.reMsg)})},d.addSecondChargeUser=function(){$("#addSecondChargeUserWindow").kendoWindow({width:"600px",height:"400px",title:"负责人管理",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open(),c.findUserAndOrg(function(e){d.user=e})},d.saveSecondUser=function(n){a.addSecondUser(n.id,d.model.signid,function(e){if(e.flag||"ok"==e.reCode){s.alert(e.reMsg),d.secondChargeUserName.push(n.displayName);for(var t=d.orgName.split(","),i=!0,o=0;o<t.length;o++)if(t[o]==n.orgDto.name){i=!1;break}i&&(t.push(n.orgDto.name),d.orgName=t.join(","))}else s.error(e.reMsg)})},d.deleteSecondUser=function(i){a.deleteSecondUser(i.id,d.model.signid,function(e){if(e.flag||"ok"==e.reCode){s.alert(e.reMsg);for(var t=0;t<d.secondChargeUserName.length;t++)if(d.secondChargeUserName[t]==i.displayName){d.secondChargeUserName.splice(t,1);break}}else s.error(e.reMsg)})},d.addMoreExp=function(){$("#isMoreExpert").is(":checked")?s.confirm("确认能自选多个专家？",function(){a.saveMoreExpert(d.model.signid,d.model.isMoreExpert,function(e){(e.flag||"ok"==e.reCode)&&s.alert(e.reMsg)})}):s.confirm("确认取消自选多个专家？",function(){a.saveMoreExpert(d.model.signid,d.model.isMoreExpert,function(e){(e.flag||"ok"==e.reCode)&&s.alert(e.reMsg)})})},d.updateFGWState=function(){$("#isSendFGW").is(":checked")?s.confirm("该项目已经回传委里？",function(){a.updateFGWState(d.model.signid,"9",function(e){e.flag||"ok"==e.reCode?s.alert("操作成功"):s.alert(e.reMsg)})}):s.confirm("确定更改？",function(){a.updateFGWState(d.model.signid,"0",function(e){e.flag||"ok"==e.reCode?s.alert("操作成功"):s.alert(e.reMsg)})})}}angular.module("app").controller("MaintainProjectEditCtrl",e),e.$inject=["pauseProjectSvc","signSvc","$state","flowSvc","$scope","sysfileSvc","addRegisterFileSvc","bsWin","orgSvc","userSvc"]}(),function(){"use strict";var i={PX:"PX",GX:"GX"},o={ZHANG_YF:"张一帆",LI_J:"李军"},e={godispatch:"godispatch",principaluser:"principaluser",seconduser:"seconduser"},t={getBusinessType:function(){return i},getDefaultLeader:function(e){var t="";switch(e){case i.PD:t=o.ZHANG_YF;break;case i.GD:t=o.LI_J}return t},getDefaultZHBYJ:function(e){var t="";switch(e){case i.PD:t="请张一帆同志阅示。";break;case i.GD:t="请李军同志阅示。"}return t},getFlowParams:function(){return e},getReviewStage:function(){return{STAGE_SUG:"项目建议书",STAGE_STUDY:"可行性研究报告",STAGE_BUDGET:"项目概算",APPLY_REPORT:"资金申请报告",OTHERS:"其它",DEVICE_BILL_HOMELAND:"设备清单（国产）",DEVICE_BILL_IMPORT:"设备清单（进口）",IMPORT_DEVICE:"进口设备"}}};window.signcommon=t}(),function(){"use strict";function e(e,t,i){var o=this;function n(){o.signWorkList=[],e.signWorkList(function(e){o.signWorkList=e,o.signWorkList&&0!=o.signWorkList.length?o.nodata=!1:o.nodata=!0})}o.signId=i.params.signid,n(),o.querySignWork=function(){n()},o.resetForm=function(){var e=$("#signworkform").find("input,select");$.each(e,function(e,t){t.value=""})}}angular.module("app").controller("signworkCtrl",e),e.$inject=["signworkSvc","bsWin","$state"]}(),function(){"use strict";function e(i,e,t){return{signWorkList:function(t){var e={method:"post",url:rootPath+"/signwork/fingSignWorkList",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{$filter:common.buildOdataFilter($("#signworkform"))},transformRequest:function(e){var t=[];for(var i in e)t.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]));return t.join("&")}};common.http({$http:i,httpOptions:e,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}}}angular.module("app").factory("signworkSvc",e),e.$inject=["$http","$state","bsWin"]}(),function(){"use strict";function e(e,t,i){var o=this;function n(){t.queryList(o)}o.model={},o.title="系统配置",n(),o.addConfig=function(){o.model={},o.model.isShow="9",$("#configdiv").kendoWindow({width:"760px",height:"500px",title:"系统参数编辑",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},o.closeWin=function(){window.parent.$("#configdiv").data("kendoWindow").close(),n()},o.doCommit=function(){common.initJqValidation(),$("#configForm").valid()&&t.saveConfig(o,function(e){e.flag||"ok"==e.reCode?(i.success("操作成功！"),window.parent.$("#configdiv").data("kendoWindow").close(),n()):i.error(e.reMsg)})},o.editConfig=function(i){o.configList.forEach(function(e,t){e.id==i&&(o.model=e)}),$("#configdiv").kendoWindow({width:"700px",height:"440px",title:"参数编辑",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()}}angular.module("app").controller("sysConfigCtrl",e),e.$inject=["$location","sysConfigSvc","bsWin"]}(),function(){"use strict";function e(o){return{queryList:n,deleteConfig:function(t,e){var i={method:"delete",url:rootPath+"/sysConfig",params:{id:e}};common.http({vm:t,$http:o,httpOptions:i,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),t.isSubmit=!1,n(t)}})}})}})},saveConfig:function(e,t){var i={method:"post",url:rootPath+"/sysConfig",data:e.model};common.http({vm:e,$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}};function n(t){var e={method:"get",url:rootPath+"/sysConfig/queryList"};common.http({vm:t,$http:o,httpOptions:e,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.configList=new Array,t.configList=e.data}})}})}}angular.module("app").factory("sysConfigSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t){var i=this;i.title="短信列表",t.msgGrid(i),t.select(i),i.querySMSLog=function(){i.gridOptions.dataSource._skip=0,i.gridOptions.dataSource.read()},i.formSMSReset=function(){var e=$("#smsLogform").find("input,select");$.each(e,function(e,t){t.value=""})}}angular.module("app").controller("smslogCtrl",e),e.$inject=["$location","smslogSvc"]}(),function(){"use strict";function e(e,t,i,o,n,a){var r=this;r.model={},r.title="发送短信",r.issmslogSendExist=!1,r.model.id=n.params.id,r.model.id&&(r.isUpdate=!0,r.title="查看短信"),activate(),r.selectsend=function(){common.http({$http:o,httpOptions:{method:"get",url:"/szcshl-web/smslog/querySMSLogType",params:{type:"send"}},success:function(e){r.select=e.data}}),t.initRoleUsers(function(e){r.orgMLeaderUsers=e.DIRECTOR,r.orgSLeaderUser=e.VICE_DIRECTOR,r.OrgDirectorUsers=e.DEPT_LEADER}),r.isUpdate&&orgSvc.getOrgById(r.model.id,function(e){r.model=e})}}angular.module("app").controller("smslogSendCtrl",e),e.$inject=["$location","smslogSendSvc","smslogSvc","$http","$state","bsWin"]}(),function(){"use strict";function e(e,t){return{msgGrid:function(e){var t=$("#smsLogform"),i=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/smslog/fingByOData",t),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"},smsLogType:"smsLogType"}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}});e.gridOptions={dataSource:common.gridDataSource(i),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:[{field:"",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"",title:"应发人",width:150,filterable:!1,template:function(e){return"<textarea rows='4' style='width:100%;'>"+e.userName+"</textarea>"}},{field:"smsUserName",title:"实发人",width:150,filterable:!1,template:function(e){var t="";return e.smsUserName&&(t=e.smsUserName),"<textarea rows='4' style='width:100%;'>"+t+"</textarea>"}},{field:"",title:"接收手机号码",width:150,filterable:!1,template:function(e){var t="";return e.smsUserPhone&&(t=e.smsUserPhone),"<textarea rows='4' style='width:100%;'>"+t+"</textarea>"}},{field:"",title:"短信内容",filterable:!1,width:220,template:function(e){return"<textarea rows='4' style='width:100%;'>"+e.message+"</textarea>"}},{field:"",title:"返回信息",filterable:!1,width:220,template:function(e){return"<textarea rows='4' style='width:100%;'>"+e.resultCode+"["+e.customMessage+"]</textarea>"}},{field:"createdDate",title:"创建时间",width:100,filterable:!1,format:"{0:yyyy/MM/dd HH:mm:ss}"},{field:"",title:"结果",filterable:!1,width:50,template:function(e){return e.result?"9"==e.result?'<span class="label label-success">成功</span>':'<span class="label label-danger">失败</span>':""}}],dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})},resizable:!0}},select:function(t){common.http({$http:e,httpOptions:{method:"get",url:"/szcshl-web/smslog/querySMSLogType",params:{type:"all"}},success:function(e){t.select=e.data}})}}}angular.module("app").factory("smslogSvc",e),e.$inject=["$http","$compile"]}(),function(){"use strict";function e(e){var t=this;t.model={},t.title="部门小组列表",e.listGrid(t.gridOptions)}angular.module("app").controller("sysdeptCtrl",e),e.$inject=["sysdeptSvc"]}(),function(){"use strict";function e(e){var t=this;t.model={},t.title="部门小组编辑",t.model.id=$state.params.id,t.model.id&&(t.isUpdate=!0,t.title="更新部门"),t.isUpdate&&e.findById(t.model.id,function(e){t.model=e})}angular.module("app").controller("sysdeptEditCtrl",e),e.$inject=["sysdeptSvc"]}(),function(){"use strict";function e(o){return{listGrid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/sysdept/fingByOData",$("#sysDeptForm")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"name",title:"小组名称",width:160,filterable:!1},{field:"",title:"操作",width:200,template:function(e){return common.format($("#columnBtns").html(),"vm.del('"+e.id+"')",e.id)}}];({dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})},resizable:!0})},findById:function(e,t){var i={method:"post",url:rootPath+"/sysdept/getSysDeptById",params:{id:e}};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}}}angular.module("app").factory("sysdeptSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,i){var o=this;o.model={},o.model.signid=i.params.id,o.model.type=i.params.type,o.commonDownloadSysFile=function(e){t.downloadFile(e)},t.queryFile(o.model.signid,o.model.type,function(e){e&&0<e.length&&(o.sysFileList=e)})}angular.module("app").controller("fileListCtrl",e),e.$inject=["$location","sysfileSvc","$state"]}(),function(){"use strict";function e(e,t){var i=this;i.title="系统安装包列表",t.queryPluginfile(i)}angular.module("app").controller("pluginfileCtrl",e),e.$inject=["$location","sysfileSvc"]}(),function(){"use strict";function e(n,a,e,m){return{initUploadOptions:function(n){n.vm.initUploadOptionSuccess=!1;var o={width:"70%",height:"460px",uploadBt:"upload_file_bt",detailBt:"detail_file_bt",inputId:"sysfileinput",mainType:"没有归类附件",sysBusiType:"",showBusiType:!0};if(!n.vm.sysFile)return void a.alert("初始化附件控件失败，请先定义附件对象！");n.sysBusiType&&(o.sysBusiType=n.sysBusiType);n.width&&(o.width=n.width);n.height&&(o.height=n.height);angular.isUndefined(n.vm.sysFile.showBusiType)&&(n.vm.sysFile.showBusiType=o.showBusiType);if(n.vm.downloadSysFile=function(e){t(e)},n.vm.delSysFile=function(i){a.confirm({title:"询问提示",message:"确认删除么？",onOk:function(){r(i,function(e){a.alert(e.reMsg||"删除成功！"),$.each(n.vm.sysFilelists,function(e,t){angular.isUndefined(t)||t.sysFileId!=i||n.vm.sysFilelists.splice(e,1)})})}})},n.vm.clickUploadBt=function(){n.vm.sysFile.businessId?(n.vm.sysFile.sysBusiType="",angular.element("#sysfileinput").fileinput("clear"),$("#commonUploadWindow").kendoWindow({width:o.width,height:o.height,title:"附件上传",visible:!1,modal:!0,closable:!0}).data("kendoWindow").center().open()):a.alert("请先保存业务数据！")},n.vm.clickDetailBt=function(){n.vm.sysFile.businessId?i(n.vm.sysFile.businessId,function(e){n.vm.sysFilelists=[],n.vm.sysFilelists=e,$("#commonQueryWindow").kendoWindow({width:"75%",height:"500px",title:"附件上传列表",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()}):a.alert("请先保存业务数据！")},n.vm.sysFile.businessId){var e={language:"zh",allowedPreviewTypes:["image"],allowedFileExtensions:["sql","exe","lnk"],maxFileSize:0,showRemove:!1,previewFileIcon:"<i class='glyphicon glyphicon-king'></i>",uploadAsync:!1,enctype:"multipart/form-data",uploadUrl:rootPath+"/file/fileUpload",previewFileIconSettings:{doc:'<i class="fa fa-file-word-o text-primary"></i>',xls:'<i class="fa fa-file-excel-o text-success"></i>',ppt:'<i class="fa fa-file-powerpoint-o text-danger"></i>',docx:'<i class="fa fa-file-word-o text-primary"></i>',xlsx:'<i class="fa fa-file-excel-o text-success"></i>',pptx:'<i class="fa fa-file-powerpoint-o text-danger"></i>',pdf:'<i class="fa fa-file-pdf-o text-danger"></i>',zip:'<i class="fa fa-file-archive-o text-muted"></i>'},uploadExtraData:function(e,t){var i={};return i.businessId=n.vm.sysFile.businessId,i.mainId=n.vm.sysFile.mainId,i.mainType=n.vm.sysFile.mainType||o.mainType,i.sysfileType=n.vm.sysFile.sysfileType||"",i.sysBusiType=n.vm.sysFile.sysBusiType||o.sysBusiType,i}};$("#"+n.inputId||o.inputId).fileinput(e).on("filebatchselected",function(e,t){t.length}).on("filepreupload",function(e,t,i,o){t.form,t.files,t.extra,t.response,t.reader}).on("filebatchuploaderror",function(e,t,i){}).on("filebatchuploadsuccess",function(e,t,i,o){console.log("同步上传成功"),console.log(t),null!=n.uploadSuccess&&"function"==typeof n.uploadSuccess&&n.uploadSuccess(e,t,i,o)}),n.vm.initUploadOptionSuccess=!0}},delSysFile:r,downloadFile:t,queryPluginfile:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/file/getPluginFile"),schema:common.kendoGridConfig().schema(),serverPaging:!1,serverSorting:!0,serverFiltering:!0,sort:{field:"createdDate",dir:"desc"}}),i=[{field:"fileName",title:"名称",filterable:!1},{field:"fileLength",title:"大小",width:160,filterable:!1},{field:"",title:"操作",width:150,template:function(e){return common.format($("#columnBtns").html(),rootPath+"/"+e.relativePath)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0}},findByMianId:function(e,t){var i={method:"post",url:rootPath+"/file/findByMainId",params:{mainId:e}};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},findByBusinessId:i,mainTypeValue:function(){return{SIGN:"项目附件",FILLSIGN:"审批登记",HUMAN:"人事附件",BOOKS:"图书附件",NOTICE:"通知公告",SHARE:"资料共享",MEETTINGROOM:"会议室预定",WORKPROGRAM:"工作方案",DISPATCH:"发文",DOFILE:"归档",MEETING:"会前准备材料",SUPPLEMENT:"补充函",STAGEMEETING:"评审会会议",FILELIBRARY:"质量管理文件库",POLICYLIBRARY:"政策标准库",TOPIC:"课题附件",TOPIC_PLAN:"课题计划书",TOPIC_WORKPLAN:"课题工作方案",TOPIC_FILING:"课题归档",MONTH_FILE:"月报简报",AADSUPP_FILE:"拟补充资料函"}},previewFile:function(){},initZtreeClient:function(r,a){var s,l={check:{chkboxType:{Y:"ps",N:"ps"},enable:!1},callback:{onClick:function(e,t,i){if(r.sysFileList=[],0==i.check_Child_State)i.children&&(r.sysFileList=i.children);else{var o=i.parentTId,n=s.getNodeByTId(o);null!=n&&(r.sysFileList=n.children)}a.$apply()}}},e=r.sysFileList;r.zNodes=[],r.initFileTreeSucess=!1;for(var t=[],i=0,o=e.length;i<o;i++){e[i].sysBusiType||(e[i].sysBusiType="其他文件");var n=new Object;if((n=e[i]).name=e[i].showName,n.id=e[i].sysFileId,t[e[i].sysBusiType])t[e[i].sysBusiType].push(n);else{var c=new Object;c.id=(new Date).getTime(),c.name=e[i].sysBusiType,r.zNodes.push(c);var d=[];d.push(n),t[e[i].sysBusiType]=d}}for(var i=0,o=r.zNodes.length;i<o;i++){for(var u in t)r.zNodes[i].name==u&&(r.zNodes[i].children=t[u]);i==o-1&&(r.initFileTreeSucess=!0)}a.$watch("vm.initFileTreeSucess",function(e,t){if(1==e)var a=m(function(){var e=document.getElementById("zTree");if(null!=e){var t=$.fn.zTree.getZTreeObj("zTree");if(null!=t){var i=t.getSelectedNodes();if(null!=i&&0<i.length){var o=i[0].tId,n=(s=$.fn.zTree.init($("#zTree"),l,r.zNodes)).getNodeByTId(o);null!=n&&(r.sysFileList=[],r.sysFileList=n.children,s.selectNode(n),s.expandNode(n,!0,!1))}}else{var n=(s=$.fn.zTree.init($("#zTree"),l,r.zNodes)).getNodes();0<n.length&&(s.selectNode(n[0]),s.expandNode(n[0],!0,!1),r.sysFileList=n[0].children)}m.cancel(a)}},500)})},queryFile:function(e,t,i){var o={method:"post",url:rootPath+"/file/queryFile",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},data:$.param({mainId:e,sysBusiType:t})};common.http({$http:n,httpOptions:o,success:function(e){null!=i&&"function"==typeof i&&i(e.data)}})}};function t(i){var e={method:"post",url:rootPath+"/file/fileSysCheck",params:{sysFileId:i}};common.http({$http:n,httpOptions:e,success:function(e){var t=$("#szecSysFileDownLoadForm");t.attr("target",""),t.attr("method","post"),e.data.flag||"ok"==e.data.reCode?(t.attr("action",rootPath+"/file/fileDownload"),t.find("input[name='sysfileId']").val(i),t.submit()):(t.attr("action",""),t.find("input[name='sysfileId']").val(""),a.error(e.data.reMsg))}})}function i(e,t){var i={method:"post",url:rootPath+"/file/findByBusinessId",params:{businessId:e}};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}function r(e,t){var i={method:"delete",url:rootPath+"/file/deleteSysFile",params:{id:e}};common.http({$http:n,httpOptions:i,success:function(e){e.data.flag||"ok"==e.data.reCode?null!=t&&"function"==typeof t&&t(e.data):a.alert(e.data.reMsg)}})}}angular.module("app").factory("sysfileSvc",e),e.$inject=["$http","bsWin","$state","$interval"]}(),function(){"use strict";function e(e,t,i){return this.model={},{templatePrint:function(e){var t=getLodop(),i="<head><link href="+rootPath+"/contents/shared/templatePrint.css type='text/css' rel='stylesheet'></head><body>"+$("#"+e).html()+"</body>";t.PRINT_INIT(""),t.ADD_PRINT_HTML(10,20,"100%","100%",i),t.PREVIEW()},getBrowserType:function(){var e=navigator.userAgent;if(console.log(e),-1<e.indexOf("Opera"))return"Opera";if(-1<e.indexOf("Firefox"))return"FF";if(-1<e.indexOf("Chrome"))return"Chrome";if(-1<e.indexOf("Safari"))return"Safari";if(window.ActiveXObject||"ActiveXObject"in window)return"IE"},templatePage:function(e){var t=getLodop(),i="<link href="+rootPath+"/contents/shared/templatePrint.css type='text/css' rel='stylesheet'>",o="<head>"+i+"</head><body>"+$("#"+e+"_templ1").html()+"</body>";if(t.PRINT_INIT(""),t.ADD_PRINT_HTML(10,20,"100%","100%",o),$("#"+e+"_templ2").html()){t.NewPage();var n="<head>"+i+"</head><body>"+$("#"+e+"_templ2").html()+"</body>";t.ADD_PRINT_HTML(50,20,"100%","100%",n)}if($("#"+e+"_templ3").html()){t.NewPage();var a="<head>"+i+"</head><body>"+$("#"+e+"_templ3").html()+"</body>";t.ADD_PRINT_HTML(50,20,"100%","100%",a)}t.PREVIEW()}}}angular.module("app").factory("templatePrintSvc",e),e.$inject=["$http","bsWin","$state"]}(),function(){"use strict";function e(a,e,t,r,i){var s=this;s.title="新增课题研究",s.model={},s.model.fgwlx=0,s.model.sendFgw=0,s.conMaxIndex=0,s.conditions=[],s.isCreate=!1,s.endTopic=!1,i.params.id&&(s.model.id=i.params.id),i.params.curNodeId&&(s.curNodeId=i.params.curNodeId,"TOPIC_KTFZR_QR"!=s.curNodeId&&"TOPIC_ZLGD"!=s.curNodeId||(s.endTopic=!0)),s.model.id?s.isUpdate=!0:s.isUpdate=!1,s.initFileUpload=function(){s.model.id||e.$watch("vm.model.id",function(e,t){e&&e!=t&&!s.initUploadOptionSuccess&&s.initFileUpload()}),s.sysFile={businessId:s.model.id,mainId:s.model.id,mainType:t.mainTypeValue().TOPIC,sysfileType:t.mainTypeValue().TOPIC_PLAN,sysBusiType:t.mainTypeValue().TOPIC_PLAN,showBusiType:!1},t.initUploadOptions({inputId:"sysfileinput",vm:s})},function(){s.model.id&&r.initDetail(s.model.id,function(e){if(s.model=e,null!=s.model.contractDtoList){s.conditions=s.model.contractDtoList;for(var t=0;t<s.conditions.length;t++)s.conditions[t].sort=t+1}});r.findOrgUser(function(e){s.principalUsers=e}),s.initFileUpload()}(),s.checkPrincipal=function(){var e=$("#mainPrinUserId").val();e&&$('#principalUser_ul input[selectType="assistUser"]').each(function(){$(this).attr("value")==e?($(this).removeAttr("checked"),$(this).attr("disabled","disabled")):$(this).removeAttr("disabled")})},s.create=function(){if(common.initJqValidation($("#topicform")),$("#topicform").valid()){var e=[];$('#principalUser_ul input[selectType="assistUser"]:checked').each(function(){e.push($(this).attr("value"))}),s.model.prinUserIds=e.join(","),r.createTopic(s.model,s.isCommit,function(e){e.flag||"ok"==e.reCode?(s.model=e.reObj,s.isCreate=!0,a.alert("操作成功！")):a.alert(e.reMsg)})}else a.alert("页面未填报完整或者为正确，请检查！")},s.saveEndTopic=function(){common.initJqValidation($("#endTopicform")),$("#endTopicform").valid()?r.updateTopic(s.model,s.isCommit,function(e){e.flag||"ok"==e.reCode?(s.model=e.reObj,s.isCreate=!0,a.alert("操作成功！")):a.alert(e.reMsg)}):a.alert("页面未填报完整或者为正确，请检查！")},s.startFlow=function(){common.initJqValidation($("#topicform")),$("#topicform").valid()?a.confirm({title:"询问提示",message:"发起流程后，当前页面数据将不能再修改！确认发起流程么？",onOk:function(){var e=[];$('#principalUser_ul input[selectType="assistUser"]:checked').each(function(){e.push($(this).attr("value"))}),s.model.prinUserIds=e.join(","),r.startFlow(s.model,s.isCommit,function(e){e.flag||"ok"==e.reCode?a.alert("保存成功！",function(){i.go("myTopic")}):a.alert(e.reMsg)})}}):a.alert("页面未填报完整或者为正确，请检查！")},s.addContract=function(){s.isCreate||s.model.id?(s.condition={},s.isUpdate?(s.conMaxIndex=s.conditions.length,s.condition.sort=s.conditions.length+1):s.condition.sort=s.conMaxIndex+1,s.conditions.push(s.condition),s.conMaxIndex++):a.alert("请先保存课题，再添加合同信息！")},s.saveContract=function(){if(function(){{if(common.initJqValidation($("#contractform")),$("#contractform").valid()){if(0<s.conditions.length){var i=!0;return s.conditions.forEach(function(e,t){if(e.cooperator=$("#cooperator"+e.sort).val(),e.entrustValue=$("#entrustValue"+e.sort).val(),e.purchaseType=$("#purchaseType"+e.sort).val(),e.contractPerson=$("#contractPerson"+e.sort).val(),e.contractTel=$("#contractTel"+e.sort).val(),e.topicId=s.model.id,""==e.cooperator||"undefined"===e.cooperator)return a.error("合作单位不能为空！"),i=!1;if(""==e.purchaseType||"undefined"===e.purchaseType)return a.error("采购方式不能为空！"),i=!1;return/^(-)?(([1-9]{1}\d*)|([0]{1}))(\.(\d){1,4})?$/.test(e.entrustValue)?void 0:(a.error("委托金额只能输入数字请核查！"),i=!1)}),i}return a.error("没有分录数据，无法保存！"),!1}return a.alert("页面未填报完整或者为正确，请检查！"),!1}}()){var t=s.model.mainPrinUserId,i=s.model.prinUserIds;r.saveContractDetailList(s.conditions,function(e){e.flag||"ok"==e.reCode?(s.model=e.reObj,s.model.mainPrinUserId=t,s.model.prinUserIds=i,a.success("保存成功！")):a.error(e.reMsg)})}},s.removeContract=function(){var o=$("#contractTable input[name='contractInfo']:checked");0<o.length?a.confirm({title:"询问提示",message:"删除数据不可恢复，确定删除么？",onOk:function(){$(".confirmDialog").modal("hide");for(var n=[],e=0;e<o.length;e++)for(var t=0;t<s.conditions.length;t++){var i=s.conditions[t];if(o[e].value==i.sort){if(!i.contractId){s.conditions.splice(t,1),$("#conTr"+i.sort).remove();break}n.push(i.contractId)}}0<n.length&&r.deleteContractConditions(n.join(","),function(e){if(e.flag||"ok"==e.reCode){a.success("操作成功！");for(var t=0;t<n.length;t++)for(var i=0;i<s.conditions.length;i++){var o=s.conditions[i];if(n[t]==o.contractId){s.conditions.splice(i,1),$("#conTr"+o.sort).remove();break}}}else a.error(e.reMsg)})}}):a.alert("请选择要删除的合同信息！")},s.checkPrice=function(e){var t="entrustValue"+e;if(!/^(-)?(([1-9]{1}\d*)|([0]{1}))(\.(\d){1,4})?$/.test($("#"+t).val()))return $("#"+t).val(""),void $("span[data-valmsg-for='"+t+"']").html("价格只能输入数字！");$("span[data-valmsg-for='"+t+"']").html("")}}angular.module("app").controller("topicAddCtrl",e),e.$inject=["bsWin","$scope","sysfileSvc","topicSvc","$state"]}(),function(){"use strict";function e(t,e,n,i,o,a){var r=this;r.title="课题研究存档表",r.filing={},r.zlList=[],o.params.curNodeId&&(r.curNodeId=o.params.curNodeId),i.findByTopicId(o.params.topicId,function(e){r.filing=e.file_record,r.topicUserList=e.topic_user_List,r.filing.topicId=o.params.topicId,r.initFileUpload()}),r.initFileUpload=function(){r.filing.id||e.$watch("vm.filing.id",function(e,t){e&&e!=t&&!r.initUploadOptionSuccess&&r.initFileUpload()}),r.sysFile={businessId:r.filing.id,mainId:r.filing.topicId,mainType:a.mainTypeValue().TOPIC,sysfileType:a.mainTypeValue().TOPIC_FILING,sysBusiType:a.mainTypeValue().TOPIC_FILING},a.initUploadOptions({inputId:"sysfileinput",vm:r})},r.saveFiling=function(){"TOPIC_ZLGD"==r.curNodeId&&(r.filing.isGdy="1"),i.save(r.filing,function(e){e.flag||"ok"==e.reCode?(r.filing.topicId=o.params.topicId,t.alert("保存成功！")):t.error(e.reMsg)})},r.addZL=function(){r.filing.registerFileDto||(r.filing.registerFileDto=[]);var e={};e.id=common.uuid(),r.filing.registerFileDto.push(e)},r.delZL=function(){var i=$("#filingform input[tit='dynamicCheckbox']:checked");if(i.length<1)t.alert("请选择要删除的意见！");else{for(var e=[],o=0;o<i.length;o++)i[o].value&&e.push(i[o].value),$.each(r.filing.registerFileDto,function(e,t){t.id==i[o].value&&r.filing.registerFileDto.splice(e,1)});0<e.length&&n.deleteByIds(e.join(","),function(e){t.alert("删除成功！")})}}}angular.module("app").controller("filingEditCtrl",e),e.$inject=["bsWin","$scope","addRegisterFileSvc","filingSvc","$state","sysfileSvc"]}(),function(){"use strict";function e(o,e){return{findByTopicId:function(e,t){var i={method:"post",url:rootPath+"/filing/initByTopicId",params:{topicId:e}};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},save:function(e,t){var i={method:"post",url:rootPath+"/filing",data:e};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}}}angular.module("app").factory("filingSvc",e),e.$inject=["$http","bsWin"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.title="我的课题列表",o.initMyGird(n),n.searchForm=function(){n.myTopicOptions.dataSource._skip=0,n.myTopicOptions.dataSource.read()},n.formReset=function(){n.searchModel={}}}angular.module("app").controller("myTopicCtrl",e),e.$inject=["bsWin","$scope","sysfileSvc","topicSvc"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.title="课题查询",o.queryGrid(n),n.searchForm=function(){n.queryTopicOptions.dataSource._skip=0,n.queryTopicOptions.dataSource.read()},n.formReset=function(){n.searchModel={}}}angular.module("app").controller("queryTopicCtrl",e),e.$inject=["bsWin","$scope","sysfileSvc","topicSvc"]}(),function(){"use strict";function e(n,e,o){return{findOrgUser:function(t){var e={method:"get",url:rootPath+"/user/findChargeUsers"};common.http({$http:n,httpOptions:e,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},createTopic:function(e,t,i){!0;var o={method:"post",url:rootPath+"/topicInfo",data:e};common.http({$http:n,httpOptions:o,success:function(e){!1,null!=i&&"function"==typeof i&&i(e.data)},onError:function(){!1}})},updateTopic:function(e,t,i){!0;var o={method:"post",url:rootPath+"/topicInfo/updateTopic",data:e};common.http({$http:n,httpOptions:o,success:function(e){!1,null!=i&&"function"==typeof i&&i(e.data)},onError:function(){!1}})},startFlow:function(e,t,i){!0;var o={method:"post",url:rootPath+"/topicInfo/startFlow",data:e};common.http({$http:n,httpOptions:o,success:function(e){!1,null!=i&&"function"==typeof i&&i(e.data)},onError:function(){!1}})},initFlowDeal:function(t){var e={method:"post",url:rootPath+"/topicInfo/findById",params:{id:t.businessKey}};common.http({$http:n,httpOptions:e,success:function(e){t.model={},t.model=e.data},onError:function(){}})},initFlowNode:function(e,t,i){switch(e.curNode.activitiId){case flowcommon.getTopicFlowNode().TOPIC_BZSH_JH:case flowcommon.getTopicFlowNode().TOPIC_FGLD_JH:case flowcommon.getTopicFlowNode().TOPIC_ZRSH_JH:case flowcommon.getTopicFlowNode().TOPIC_BZSH_FA:case flowcommon.getTopicFlowNode().TOPIC_FGLD_FA:case flowcommon.getTopicFlowNode().TOPIC_ZRSH_FA:case flowcommon.getTopicFlowNode().TOPIC_BZSH_BG:case flowcommon.getTopicFlowNode().TOPIC_FGLD_BG:case flowcommon.getTopicFlowNode().TOPIC_ZRSH_BG:case flowcommon.getTopicFlowNode().TOPIC_BZSH_JT:case flowcommon.getTopicFlowNode().TOPIC_FGLD_JT:case flowcommon.getTopicFlowNode().TOPIC_ZRSH_JT:case flowcommon.getTopicFlowNode().TOPIC_BZSH_GD:case flowcommon.getTopicFlowNode().TOPIC_GDY_QR:t.buttBack=!0;break;case flowcommon.getTopicFlowNode().TOPIC_CGJD:case flowcommon.getTopicFlowNode().TOPIC_KTBG:case flowcommon.getTopicFlowNode().TOPIC_KTJT:e.businessMap&&(i.showFlag.isMainPrinUser=e.businessMap.MAIN_USER,i.showFlag.expertEdit=!0);break;case flowcommon.getTopicFlowNode().TOPIC_LXDW:case flowcommon.getTopicFlowNode().TOPIC_QDHT:case flowcommon.getTopicFlowNode().TOPIC_YJSS:case flowcommon.getTopicFlowNode().TOPIC_NBCS:case flowcommon.getTopicFlowNode().TOPIC_YFZL:t.showUploadBT=!0,i.initFileUpload(o.mainTypeValue().TOPIC,o.mainTypeValue().TOPIC,o.mainTypeValue().TOPIC);break;case flowcommon.getTopicFlowNode().TOPIC_JHTC:case flowcommon.getTopicFlowNode().TOPIC_GZFA:t.businessTr=!0;break;case flowcommon.getTopicFlowNode().TOPIC_ZLGD:t.businessTr=!0,i.showFlag.isMainPrinUser=!0,i.showFlag.expertEdit=!0}},initMyGird:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/topicInfo/findByOData",$("#myTopicForm"),{filter:"createdBy eq ${CURRENT_USER.id}"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"topicName",title:"课题名称",width:"25%",filterable:!1},{field:"cooperator",title:"合作单位",width:"20%",filterable:!1},{field:"createdDate",title:"创建日期",width:"25%",filterable:!1,format:"{0:yyyy/MM/dd HH:mm:ss}"},{field:"",title:"已发起流程",width:"15%",filterable:!1,template:function(e){return e.processInstanceId?"是":"否"}},{field:"",title:"操作",width:"15%",template:function(e){var t=!!e.processInstanceId;return common.format($("#columnBtns").html(),e.id,t,"flowEnd/"+e.id+"/"+flowcommon.getFlowDefinedKey().TOPIC_FLOW+"/"+e.processInstanceId,!t)}}];e.myTopicOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})},resizable:!0}},initDetail:function(e,t){var i={method:"post",url:rootPath+"/topicInfo/findDetailById",params:{id:e}};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)},onError:function(){}})},queryGrid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/topicInfo/findByOData",$("#queryTopicForm")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}});e.queryTopicOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:[{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"",title:"课题名称",width:200,filterable:!1,template:function(e){return e.processInstanceId?'<a href="#/topicDetail/'+e.id+"/"+e.processInstanceId+'">'+e.topicName+"</a>":'<a href="#/topicDetail/'+e.id+'/">'+e.topicName+"</a>"}},{field:"cooperator",title:"合作单位",width:200,filterable:!1},{field:"createdDate",title:"创建日期",width:100,filterable:!1,format:"{0:yyyy/MM/dd}"},{field:"endTime",title:"结题日期",width:100,filterable:!1,format:"{0:yyyy/MM/dd}"},{field:"orgName",title:"申报部门",width:100,filterable:!1},{field:"",title:"操作",width:100,template:function(e){return""}}],dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})},resizable:!0}},saveContractDetailList:function(e,t){var i={method:"post",url:rootPath+"/topicInfo/saveContractDetailList",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(e)};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},deleteContractConditions:function(e,t){var i={method:"delete",url:rootPath+"/topicInfo/contractDel",params:{ids:e}};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}}}angular.module("app").factory("topicSvc",e),e.$inject=["$http","bsWin","sysfileSvc"]}(),function(){"use strict";function e(e,t,i,o,n){var a=this;a.businessKey=i.params.businessId,a.flow={},a.flow.processInstanceId=i.params.processInstanceId,function(){$("#myTab li").click(function(e){var t=$("a",this);e.preventDefault(),t.tab("show");var i=t.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500)}),i.params.processInstanceId&&o.initFlowData(a);n.initFlowDeal(a)}()}angular.module("app").controller("topicDetailCtrl",e),e.$inject=["bsWin","$scope","$state","flowSvc","topicSvc"]}(),function(){"use strict";function e(t,e,i,o,n,a,r){var s=this;s.title="课题研究成果鉴定会工作方案",s.workplan={},n.params.topicId&&(s.workplan.topicId=n.params.topicId),s.workplan.topicId&&o.findByTopicId(s.workplan.topicId,function(e){s.workplan=e,s.workplan.topicId=n.params.topicId,s.initFileUpload()}),s.saveWorkPlan=function(){o.save(s.workplan,function(e){e.flag||"ok"==e.reCode?(s.workplan=e.reObj,t.alert("保存成功！")):t.error(e.reMsg)})},s.initFileUpload=function(){s.workplan.id||a.$watch("vm.workplan.id",function(e,t){e&&e!=t&&!s.initUploadOptionSuccess&&s.initFileUpload()}),s.sysFile={businessId:s.workplan.id,mainId:s.workplan.topicId,mainType:r.mainTypeValue().TOPIC,sysfileType:r.mainTypeValue().TOPIC_WORKPLAN,sysBusiType:r.mainTypeValue().TOPIC_WORKPLAN},r.initUploadOptions({inputId:"sysfileinput",vm:s})},s.bookMeeting=function(){s.workplan.id?n.go("room",{businessId:s.workplan.id,businessType:"TOPIC_WP"}):t.alert("请先保存当前信息！")},s.selectExpert=function(){s.workplan.id?n.go("expertReviewEdit",{businessId:n.params.topicId,minBusinessId:s.workplan.id,businessType:"TOPIC",reviewType:s.workplan.reviewType}):t.alert("请先保存当前信息，再继续操作！")},s.updateBookRoom=function(i){s.meetingList||e.findAllMeeting(function(e){s.meetingList=e}),$.each(s.workplan.roomDtoList,function(e,t){i==t.id&&(s.roombook=t)}),$("#roomBookDetailWindow").kendoWindow({width:"50%",height:"620px",title:"会议预定信息",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},s.saveRoom=function(){i.saveRoom(s.roombook,function(i){i.flag||"ok"==i.reCode?($.each(s.workplan.roomDtoList,function(e,t){s.roombook.id==t.id&&(t=i.reObj)}),t.success("操作成功！",function(){s.onRoomClose()})):t.error(i.reMsg)})},s.onRoomClose=function(){window.parent.$("#roomBookDetailWindow").data("kendoWindow").close()}}angular.module("app").controller("workPlanEditCtrl",e),e.$inject=["bsWin","meetingSvc","roomSvc","workPlanSvc","$state","$scope","sysfileSvc"]}(),function(){"use strict";function e(o,e){return{findByTopicId:function(e,t){var i={method:"post",url:rootPath+"/workPlan/initByTopicId",params:{topicId:e}};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},save:function(e,t){var i={method:"post",url:rootPath+"/workPlan",data:e};common.http({$http:o,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}}}angular.module("app").factory("workPlanSvc",e),e.$inject=["$http","bsWin"]}(),function(){"use strict";function e(e,n,a){var r=this;r.title="用户列表",r.del=function(e){a.confirm({title:"温馨提示",message:"确认删除数据吗？",onOk:function(){n.deleteUser(r,e,function(e){e.flag||"ok"==e.reCode?a.success("操作成功！",function(){r.gridOptions.dataSource.read()}):a.error(e.reMsg)})}})},r.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)a.alert("请选择要删除数据！");else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");r.del(o)}},r.queryUser=function(){n.queryUser(r)},r.resetPwd=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)a.alert("请选择数据");else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");a.confirm({title:"温馨提示",message:"确认重置密码？",onOk:function(){n.resetPwd(r,o)}})}},function(){r.model||(r.model={});r.model.jobState||(r.model.jobState="t");n.grid(r)}()}angular.module("app").controller("userCtrl",e),e.$inject=["$location","userSvc","bsWin"]}(),function(){"use strict";function e(e,i,t,o){var n=this;n.title="新增用户",n.isuserExist=!1,n.id=t.params.id,n.id&&(n.isUpdate=!0,n.title="编辑用户"),function(){n.isUpdate?i.getUserById(n):i.initZtreeClient(n);i.getOrg(function(e){n.org={},n.org=e})}(),n.create=function(){if(common.initJqValidation(),$("form").valid()){var e=i.getZtreeChecked(),t=$linq(e).where(function(e){return 0==e.isParent}).select(function(e){return{id:e.id,roleName:e.name}}).toArray();n.model.roleDtoList=t,i.createUser(n.model,n.isSubmit,function(e){e.flag||"ok"==e.reCode?(n.model.id||(n.model.id=e.idCode,n.isUpdate=!0),o.success("操作成功！")):o.error(e.reMsg)})}},n.update=function(){i.updateUser(n)}}angular.module("app").controller("userEditCtrl",e),e.$inject=["$location","userSvc","$state","bsWin"]}(),function(){"use strict";function e(n,o){var a=rootPath+"/user";rootPath,rootPath;return{grid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/user/fingByOData",$("#usersform"),{filter:"loginName ne 'admin'"}),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!1,serverSorting:!1,serverFiltering:!1,pageSize:10}),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox' />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"loginName",title:"登录名",width:100,filterable:!1},{field:"displayName",title:"显示名",width:100,filterable:!1},{field:"orgDto.name",title:"所属部门",width:100,filterable:!1},{field:"userIP",title:"登录IP",width:160,filterable:!1},{field:"lastLogin",title:"最后登录时间",width:160,filterable:!1},{field:"",title:"所属角色",width:160,filterable:!1,template:function(e){if(e.roleDtoList){for(var t="",i=0,o=e.roleDtoList.length;i<o;i++)t+=0==i?e.roleDtoList[i].roleName:", "+e.roleDtoList[i].roleName;return t}return" "}},{field:"",title:"在职情况",width:80,filterable:!1,template:function(e){return e.jobState&&"t"==e.jobState?"在职":"已撤销"}},{field:"",title:"操作",width:140,template:function(e){return common.format($("#columnBtns").html(),"vm.del('"+e.id+"')",e.id)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})},resizable:!0}},getUserById:function(t){var e={method:"post",url:rootPath+"/user/findUserById",params:{userId:t.id}};common.http({vm:t,$http:n,httpOptions:e,success:function(e){t.model=e.data,t.isUpdate&&i(t)}})},initZtreeClient:i,createUser:function(e,t,i){!0;var o={method:"post",url:rootPath+"/user",data:e};common.http({$http:n,httpOptions:o,success:function(e){null!=i&&"function"==typeof i&&i(e.data)},onError:function(){!1}})},deleteUser:function(t,e,i){t.isSubmit=!0;var o={method:"delete",url:a,data:e};common.http({vm:t,$http:n,httpOptions:o,success:function(e){t.isSubmit=!1,null!=i&&"function"==typeof i&&i(e.data)},onError:function(){t.isSubmit=!1}})},updateUser:function(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0;var e=r(),i=$linq(e).where(function(e){return 0==e.isParent}).select(function(e){return{id:e.id,roleName:e.name}}).toArray();t.model.roleDtoList=i;var o={method:"put",url:a,data:t.model};common.http({vm:t,$http:n,httpOptions:o,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})}})}},getOrg:function(t){var e={method:"post",url:rootPath+"/org/listAll"};common.http({$http:n,httpOptions:e,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},queryUser:function(e){e.gridOptions.dataSource._skip=0,e.gridOptions.dataSource.read()},getZtreeChecked:r,resetPwd:function(t,e){var i={method:"put",url:a+"/resetPwd",params:{ids:e}};common.http({vm:t,httpOptions:i,success:function(e){o.success("重置密码成功！",function(){t.gridOptions.dataSource.read()})},$http:n})},findUserAndOrg:function(t){var e={method:"post",url:rootPath+"/user/findUserAndOrg"};common.http({$http:n,httpOptions:e,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},getAllTaskList:function(e,t){var i={method:"post",url:rootPath+"/user/findAllTaskList",params:{userId:e}};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}};function i(i){var e={method:"post",url:rootPath+"/role/findAllRoles"};common.http({vm:i,$http:n,httpOptions:e,success:function(t){common.requestSuccess({vm:i,response:t,fn:function(){var e={id:"",name:"角色集合",children:$linq(t.data).select(function(e){return{id:e.id,name:e.roleName}}).toArray()};$.fn.zTree.init($("#zTree"),{check:{chkboxType:{Y:"ps",N:"ps"},enable:!0}},e),i.isUpdate&&function(e){for(var t=$.fn.zTree.getZTreeObj("zTree"),i=$linq(e.model.roleDtoList).select(function(e){return e.roleName}).toArray(),o=t.getNodesByParam("level",1,null),n=$linq(o).where(function(e){return $linq(i).contains(e.name)}).toArray(),a=0,r=n.length;a<r;a++)t.checkNode(n[a],!0,!0)}(i)}})}})}function r(){return $.fn.zTree.getZTreeObj("zTree").getCheckedNodes(!0)}}angular.module("app").factory("userSvc",e),e.$inject=["$http","bsWin"]}(),function(){"use strict";function e(e,t){var n=this;n.title="工作日列表",t.grid(n),n.addWorkDay=function(){$("#workDay").kendoWindow({width:"45%",height:"auto",title:"新增工作日",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},n.create=function(){common.initJqValidation($("#form")),$("#form").valid()&&t.createWorkday(n)},n.del=function(e){common.confirm({vm:n,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteWorkday(n,e)}})},n.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:n,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");n.del(o)}},n.queryWorkday=function(){t.queryWorkday(n)},n.ResetWorkday=function(){t.clearValue(n)}}angular.module("app").controller("workdayCtrl",e),e.$inject=["$location","workdaySvc"]}(),function(){"use strict";function e(o,e,i){var n=rootPath+"/workday",a="#/workday";return{grid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(n+"/findByOdataObj",$("#workdayForm")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"},modifiedDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"dates",dir:"desc"}}),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"dates",title:"时间",width:200,format:"{0:yyyy-MM-dd}",filterable:!1},{field:"",title:"状态",width:100,filterable:!1,template:function(e){return e.status?"1"==e.status?"调休":"2"==e.status?"加班":void 0:""}},{field:"remark",title:"备注",width:140,filterable:!1},{field:"",title:"操作",width:140,template:function(e){return common.format($("#columnBtns").html(),"vm.del('"+e.id+"')",e.id)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})},resizable:!0}},createWorkday:function(t){var e={method:"post",url:n+"/createWorkday",data:t.workday};common.http({vm:t,$http:o,httpOptions:e,success:function(e){console.log(e),e.data.flag?i.alert("保存成功！",function(){t.gridOptions.dataSource.read(),window.parent.$("#workDay").data("kendoWindow").close(),t.workday=""}):i.alert(e.data.reMsg+"已存在，不能重复添加！",function(){t.gridOptions.dataSource.read(),window.parent.$("#workDay").data("kendoWindow").close(),t.workday=""})}})},getWorkdayById:function(t){var e={method:"get",url:n+"/getWorkdayById",params:{id:t.id}};common.http({vm:t,$http:o,httpOptions:e,success:function(e){t.workday=e.data}})},updateWorkday:function(t){var e={method:"put",url:n,data:t.workday};common.http({vm:t,$http:o,httpOptions:e,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=a}})}})}})},deleteWorkday:function(t,e){var i={method:"delete",url:n,data:e};common.http({vm:t,$http:o,httpOptions:i,success:function(e){t.gridOptions.dataSource.read()}})},queryWorkday:function(e){e.gridOptions.dataSource.read()},clearValue:function(e){var t=$("#workdayForm").find("input,select");$.each(t,function(e,t){t.value=""}),e.gridOptions.dataSource.read()}}}angular.module("app").factory("workdaySvc",e),e.$inject=["$http","$state","bsWin"]}(),function(){"use strict";function e(e,t,i){var o=this;o.title="添加工作日",o.id=i.params.id,o.workday={},o.workday.status="1",o.id&&(o.isUpdate=!0,o.title="更新工作日"),o.isUpdate&&t.getWorkdayById(o),o.create=function(){t.createWorkday(o)},o.update=function(){t.updateWorkday(o)}}angular.module("app").controller("workdayEditCtrl",e),e.$inject=["$location","workdaySvc","$state"]}(),function(){"use strict";function e(s,l,o,e,t,c){var d=this;d.work={},d.model={},d.startDateTime=new Date("2006/6/1 08:00"),d.endDateTime=new Date("2060/6/1 21:00"),d.signid=l.params.signid,d.taskid=l.params.taskid,d.branchId=l.params.branchId,d.work.signId=l.params.signid,d.work.id="",d.sign={},d.unSeledWork={},d.searchSign={},d.businessFlag={isSelfReview:!1,isSingleReview:!0,isMainWorkProj:!1,isLoadMeetRoom:!1,isReveiwAWP:!1},d.showAll=!0,s.initFlowWP(d.work.signId,d.taskid,l.params.branchId,function(e){if(d.work=e.eidtWP,d.work.reviewType||(d.work.reviewType="自评"),d.work.isSigle||(d.work.isSigle="单个评审"),d.work.expertDtoList&&0<d.work.expertDtoList.length&&((!d.work.expertCost||d.work.expertCost<1e3*d.work.expertDtoList.length)&&(d.work.expertCost=1e3*d.work.expertDtoList.length),d.work.expertDtoList))for(var t=d.work.expertDtoList,i=0;i<t.length;i++)if(t[i].expertTypeDtoList){for(var o=t[i].expertTypeDtoList,n="",a="",r=0;r<o.length;r++)a.indexOf(o[r].expertType)<0&&(0<r&&(a+="、"),a+=o[r].expertType),0<r&&(n+="、"),n+=o[r].maJorBig+"、"+o[r].maJorSmall;t[i].expertCategory=a,t[i].major=n}d.model.workProgramDtoList={},("9"==e.showTotalInvestment||9==e.showTotalInvestment||e.WPList&&0<e.WPList.length)&&(d.model.workProgramDtoList=e.WPList,d.showTotalInvestment=!0),"1"==d.work.branchId&&s.findCompanys(d),d.work.signId=l.params.signid,d.work.projectType&&(d.work.projectTypeDicts=c.topSelectChange(d.work.projectType,c.DICT.PROJECTTYPE.dicts)),"合并评审"!=d.work.isSigle||"0"!=d.work.isMainProject&&0!=d.work.isMainProject||(d.businessFlag.isReveiwAWP=!0),d.initFileUpload()}),$("#wpTab li").click(function(e){var t=$("a",this);e.preventDefault(),t.tab("show");var i=t.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500)}),d.initFileUpload=function(){d.work.id||t.$watch("vm.work.id",function(e,t){e&&e!=t&&!d.initUploadOptionSuccess&&d.initFileUpload()}),d.sysFile={businessId:d.work.id,mainId:d.work.signId,mainType:e.mainTypeValue().SIGN,sysfileType:e.mainTypeValue().WORKPROGRAM,sysBusiType:e.mainTypeValue().WORKPROGRAM},e.initUploadOptions({inputId:"sysfileinput",vm:d})},d.reviewTypeChange=function(){"自评"==d.work.reviewType&&(d.work.expertCost=""),"合并评审"==d.work.reviewType&&(d.work.isMainProject="9"),d.work.id&&s.findById(d.work.id,function(e){if(null!=e.expertCost&&""==d.work.expertCost&&(d.work.expertCost=e.expertCost),"合并评审"==e.isSigle&&"9"==e.isMainProject&&"单个评审"==d.work.isSigle)o.confirm({title:"询问提示",message:"该项目已关联其他项目，您确定要改为单个评审吗？",onOk:function(){s.deleteAllMerge(l.params.signid,d.work.id,function(e){e.flag||"ok"==e.reCode?o.alert("操作成功！",function(){d.work.isMainProject="0"}):o.error("操作失败！")})},onCancel:function(){d.work.isSigle="合并评审",d.work.isMainProject="9"}});else if("专家评审会"==e.reviewType&&"专家函评"==d.work.reviewType&&d.work.roomBookingDtos&&0<d.work.roomBookingDtos.length)o.confirm({title:"询问提示",message:"改成专家函评，预定会议室将会删除，确定修改么？",onOk:function(){s.updateReviewType(l.params.signid,d.work.id,d.work.reviewType,function(e){e.flag||"ok"==e.reCode?(d.work=e.reObj,d.work.signId=l.params.signid,o.alert("操作成功！")):o.error("操作失败！")})},onCancel:function(){d.work.reviewType=e.reviewType}});else if(("专家评审会"==e.reviewType||"专家函评"==e.reviewType)&&"自评"==d.work.reviewType){var t=!1;d.work.roomBookingDtos&&0<d.work.roomBookingDtos.length?t=!0:d.work.expertDtoList&&0<d.work.expertDtoList.length&&(t=!0),t&&o.confirm({title:"询问提示",message:"评审方式改成自评，预定会议室和抽取专家将会删除，确定修改么？",onOk:function(){s.updateReviewType(l.params.signid,d.work.id,d.work.reviewType,function(e){e.flag||"ok"==e.reCode?(d.work=e.reObj,d.work.signId=l.params.signid,o.alert("操作成功！")):o.error("操作失败！")})},onCancel:function(){d.work.reviewType=e.reviewType}})}})},d.onWorkClose=function(){window.parent.$(".workPro").data("kendoWindow").close()},d.formReset=function(){d.searchSign={}},d.filterSign=function(e){var t=!0;if(d.searchSign.projectname&&-1==e.projectname.indexOf(d.searchSign.projectname)&&(t=!1),t&&d.searchSign.reviewstage&&-1==e.reviewstage.indexOf(d.searchSign.reviewstage)&&(t=!1),t)return e},d.initMergeWP=function(){d.work.id?s.findById(d.work.id,function(e){"合并评审"==e.isSigle&&"9"==e.isMainProject?(s.initMergeInfo(d,d.work.signId),$("#mergeSign").kendoWindow({width:"75%",height:"700px",title:"合并评审",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()):o.alert("请先保存工作方案！")}):o.alert("请先保存工作方案！")},d.chooseSign=function(){var e=$("input[name='mergeSign']:checked");if(0==e.length)o.alert("请选择要合并评审的项目！");else{var i=[];$.each(e,function(e,t){i.push(t.value)}),s.chooseSign(d.work.signId,i.join(","),function(e){(e.flag||"ok"==e.reCode)&&s.initMergeInfo(d,d.work.signId),o.alert(e.reMsg)})}},d.cancelSign=function(){var e=$("input[name='cancelMergeSignid']:checked");if(0==e.length)o.alert("请选择要取消合并评审的项目！");else{var i=[];$.each(e,function(e,t){i.push(t.value)})}s.cancelMergeSign(d.work.signId,i.join(","),function(e){(e.flag||"ok"==e.reCode)&&s.initMergeInfo(d,d.work.signId),o.alert(e.reMsg)})},d.addTimeStage=function(){d.work.id?s.findById(d.work.id,function(e){"专家评审会"==e.reviewType?l.go("room",{businessId:d.work.id,businessType:"SIGN_WP"}):o.alert("请先保存工作方案！")}):o.alert("请先保存！")},d.findUsersByOrgId=function(e){s.findUsersByOrgId(d,e)},d.create=function(){common.initJqValidation($("#work_program_form")),$("#work_program_form").valid()?d.isTime?o.alert("结束时间必须大于开始时间！"):("全天"==d.work.studyQuantum?(d.work.studyBeginTime="",d.work.studyEndTime=""):($("#studyBeginTime").val()&&(d.work.studyBeginTimeStr=$("#studyBeginTime").val()),$("#studyEndTime").val()&&(d.work.studyEndTimeStr=$("#studyEndTime").val()),$("#studyAllDay").val()&&$("#studyBeginTime").val()&&(d.work.studyBeginTime=$("#studyAllDay").val()+" "+$("#studyBeginTime").val()+":00"),$("#studyAllDay").val()&&$("#studyEndTime").val()&&(d.work.studyEndTime=$("#studyAllDay").val()+" "+$("#studyEndTime").val()+":00")),s.createWP(d.work,!1,d.iscommit,function(e){e.flag||"ok"==e.reCode?(d.work.id=e.reObj.id,o.success("操作成功！")):o.error(e.reMsg)})):o.alert("操作失败，有红色*号的选项为必填项，请按要求填写！")},d.compare=function(){var e=parseInt(d.work.studyBeginTimeStr.split(":")[0]),t=parseInt(d.work.studyEndTimeStr.split(":")[0]);if(e==t){var i=parseInt(d.work.studyBeginTimeStr.split(":")[1]),o=parseInt(d.work.studyEndTimeStr.split(":")[1]);d.isTime=o<i}else d.isTime=t<e},d.selectExpert=function(){d.work.id?s.findById(d.work.id,function(e){"专家评审会"==e.reviewType||"专家函评"==e.reviewType?"专家评审会"!=d.work.reviewType||d.work.roomBookingDtos&&0!=d.work.roomBookingDtos.length?"专家函评"!=d.work.reviewType||e.letterDate?l.go("expertReviewEdit",{businessId:d.signid,minBusinessId:d.work.id,businessType:"SIGN",reviewType:d.work.reviewType,taskId:d.taskid}):o.alert("请先选择函评日期并保存！"):o.alert("请先预定评审会日期！"):o.alert("请先保存工作方案！")}):o.alert("请先保存当前信息，再继续操作！")}}angular.module("app").controller("flowWPEditCtrl",e),e.$inject=["workprogramSvc","$state","bsWin","sysfileSvc","$scope","$rootScope"]}(),function(){"use strict";function e(t,e,i,o){var n=this;n.work={},n.title="项目基本信息",n.signId=i.params.signid,n.isadmin=i.params.isadmin,e.initBaseInfo(n.signId,function(e){n.work=e,n.work.projectType&&(n.projectTypes=o.topSelectChange(n.work.projectType,o.DICT.PROJECTTYPE.dicts))}),n.goBack=function(){n.isadmin?i.go("MaintainProjectEdit",{signid:i.params.signid,processInstanceId:null}):o.back()},n.create=function(){common.initJqValidation($("#work_program_form")),$("#work_program_form").valid()?(n.iscommit=!0,e.saveBaseInfo(n.work,n.iscommit,function(e){n.iscommit=!1,e.flag||"ok"==e.reCode?(n.work.id=e.idCode,t.success("操作成功！")):t.error(e.reMsg)})):t.alert("操作失败，有红色*号的选项为必填项，请按要求填写！")}}angular.module("app").controller("wpBaseCtrl",e),e.$inject=["bsWin","workprogramSvc","$state","$rootScope"]}(),function(){"use strict";function e(o,i,n,e,t,a,r,s){var l=this;l.work={},l.model={},l.title="评审方案编辑",l.startDateTime=new Date("2006/6/1 08:00"),l.endDateTime=new Date("2030/6/1 21:00"),l.work.signId=i.params.signid,l.isControl=i.params.isControl,l.work.id="",l.sign={},l.unSeledWork={},l.searchSign={},l.businessFlag={isSelfReview:!1,isSingleReview:!0,isMainWorkProj:!1,isLoadMeetRoom:!1,isReveiwAWP:!1},l.expertList=new Array(15),function(){l.showAll=!0,l.isControl?o.workMaintainList(l):o.initPage(l);$("#wpTab li").click(function(e){var t=$("a",this);e.preventDefault(),t.tab("show");var i=t.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500)})}(),l.initFileUpload=function(){l.work.id||t.$watch("vm.work.id",function(e,t){e&&e!=t&&!l.initUploadOptionSuccess&&l.initFileUpload()}),l.sysFile={businessId:l.work.id,mainId:l.work.signId,mainType:e.mainTypeValue().SIGN,sysfileType:e.mainTypeValue().WORKPROGRAM,sysBusiType:e.mainTypeValue().WORKPROGRAM},e.initUploadOptions({inputId:"sysfileinput",vm:l})},l.reviewTypeChange=function(){"自评"==l.work.reviewType&&(l.work.expertCost=""),"合并评审"==l.work.reviewType&&(l.work.isMainProject="9"),l.work.id&&o.findById(l.work.id,function(e){if(null!=e.expertCost&&""==l.work.expertCost&&(l.work.expertCost=e.expertCost),"合并评审"==e.isSigle&&"9"==e.isMainProject&&"单个评审"==l.work.isSigle)n.confirm({title:"询问提示",message:"该项目已关联其他项目，您确定要改为单个评审吗？",onOk:function(){o.deleteAllMerge(i.params.signid,l.work.id,function(e){e.flag||"ok"==e.reCode?n.alert("操作成功！",function(){l.work.isMainProject="0"}):n.error("操作失败！")})},onCancel:function(){l.work.isSigle="合并评审",l.work.isMainProject="9"}});else if("专家评审会"==e.reviewType&&"专家函评"==l.work.reviewType&&l.work.roomBookingDtos&&0<l.work.roomBookingDtos.length)n.confirm({title:"询问提示",message:"改成专家函评，预定会议室将会删除，确定修改么？",onOk:function(){o.updateReviewType(i.params.signid,l.work.id,l.work.reviewType,function(e){e.flag||"ok"==e.reCode?(l.work=e.reObj,l.work.signId=i.params.signid,n.alert("操作成功！")):n.error("操作失败！")})},onCancel:function(){l.work.reviewType=e.reviewType}});else if(("专家评审会"==e.reviewType||"专家函评"==e.reviewType)&&"自评"==l.work.reviewType){var t=!1;l.work.roomBookingDtos&&0<l.work.roomBookingDtos.length&&(t=!0),l.work.expertDtoList&&0<l.work.expertDtoList.length&&(t=!0),t&&n.confirm({title:"询问提示",message:"评审方式改成自评，预定会议室和抽取专家将会删除，确定修改么？",onOk:function(){o.updateReviewType(i.params.signid,l.work.id,l.work.reviewType,function(e){e.flag||"ok"==e.reCode?(l.work=e.reObj,l.work.signId=i.params.signid,n.alert("操作成功！")):n.error("操作失败！")})},onCancel:function(){l.work.reviewType=e.reviewType}})}})},l.onWorkClose=function(){window.parent.$(".workPro").data("kendoWindow").close()},l.formReset=function(){l.searchSign={}},l.filterSign=function(e){var t=!0;if(l.searchSign.projectname&&-1==e.projectname.indexOf(l.searchSign.projectname)&&(t=!1),t&&l.searchSign.reviewstage&&-1==e.reviewstage.indexOf(l.searchSign.reviewstage)&&(t=!1),t)return e},l.initMergeWP=function(){l.work.id?o.findById(l.work.id,function(e){"合并评审"==e.isSigle&&"9"==e.isMainProject?(o.initMergeInfo(l,l.work.signId),$("#mergeSign").kendoWindow({width:"75%",height:"700px",title:"合并评审",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()):n.alert("请先保存工作方案！")}):n.alert("请先保存工作方案！")},l.chooseSign=function(){var e=$("input[name='mergeSign']:checked");if(0==e.length)n.alert("请选择要合并评审的项目！");else{var i=[];$.each(e,function(e,t){i.push(t.value)}),o.chooseSign(l.work.signId,i.join(","),function(e){(e.flag||"ok"==e.reCode)&&o.initMergeInfo(l,l.work.signId),n.alert(e.reMsg)})}},l.cancelSign=function(){var e=$("input[name='cancelMergeSignid']:checked");if(0==e.length)n.alert("请选择要取消合并评审的项目！");else{var i=[];$.each(e,function(e,t){i.push(t.value)})}o.cancelMergeSign(l.work.signId,i.join(","),function(e){(e.flag||"ok"==e.reCode)&&o.initMergeInfo(l,l.work.signId),n.alert(e.reMsg)})},l.addTimeStage=function(){l.work.id?o.findById(l.work.id,function(e){"专家评审会"==e.reviewType?i.go("room",{businessId:l.work.id,businessType:"SIGN_WP"}):n.alert("请先保存工作方案！")}):n.alert("请先保存！")},l.findUsersByOrgId=function(e){o.findUsersByOrgId(l,e)},l.create=function(){common.initJqValidation($("#work_program_form")),$("#work_program_form").valid()?l.isTime?n.alert("结束时间必须大于开始时间！"):("全天"==l.work.studyQuantum?(l.work.studyBeginTime="",l.work.studyEndTime=""):($("#studyBeginTime").val()&&(l.work.studyBeginTimeStr=$("#studyBeginTime").val()),$("#studyEndTime").val()&&(l.work.studyEndTimeStr=$("#studyEndTime").val()),$("#studyAllDay").val()&&$("#studyBeginTime").val()&&(l.work.studyBeginTime=$("#studyAllDay").val()+" "+$("#studyBeginTime").val()+":00"),$("#studyAllDay").val()&&$("#studyEndTime").val()&&(l.work.studyEndTime=$("#studyAllDay").val()+" "+$("#studyEndTime").val()+":00")),o.createWP(l.work,!1,l.iscommit,function(e){e.flag||"ok"==e.reCode?(l.work.id=e.reObj.id,n.success("操作成功！")):n.error(e.reMsg)})):n.alert("操作失败，有红色*号的选项为必填项，请按要求填写！")},l.compare=function(){var e=parseInt(l.work.studyBeginTimeStr.split(":")[0]),t=parseInt(l.work.studyEndTimeStr.split(":")[0]);if(e==t){var i=parseInt(l.work.studyBeginTimeStr.split(":")[1]),o=parseInt(l.work.studyEndTimeStr.split(":")[1]);l.isTime=o<i}else l.isTime=t<e},l.selectExpert=function(){l.work.id?o.findById(l.work.id,function(e){"专家评审会"==e.reviewType||"专家函评"==e.reviewType?"专家评审会"!=l.work.reviewType||l.work.roomBookingDtos&&0!=l.work.roomBookingDtos.length?"专家函评"!=l.work.reviewType||e.letterDate?i.go("expertReviewEdit",{businessId:l.work.signId,minBusinessId:l.work.id,businessType:"SIGN",reviewType:l.work.reviewType}):n.alert("请先选择函评日期并保存！"):n.alert("请先预定评审会日期！"):n.alert("请先保存工作方案！")}):n.alert("请先保存当前信息，再继续操作！")},l.printpage=function(e){var t=$(e.target).attr("id");s.workProgramPrint(t)},l.createMaintain=function(){if(null!=l.assistant&&0!=l.assistant.length)for(var e=0;e<l.assistant.length;e++)"全天"==l.work.studyQuantum?(l.work.studyBeginTime="",l.work.studyEndTime=""):($("#studyBeginTime").val()&&(l.assistant[e].studyBeginTimeStr=$("#studyBeginTime").val()),$("#studyEndTime").val()&&(l.assistant[e].studyEndTimeStr=$("#studyEndTime").val()),$("#studyAllDay").val()&&$("#studyBeginTime").val()&&(l.assistant[e].studyBeginTime=$("#studyAllDay").val()+" "+$("#studyBeginTime").val()+":00"),$("#studyAllDay").val()&&$("#studyEndTime").val()&&(l.assistant[e].studyEndTime=$("#studyAllDay").val()+" "+$("#studyEndTime").val()+":00")),l.assistant[e].signId=l.work.signId,o.createWP(l.assistant[e],!1,l.iscommit);l.work&&o.createWP(l.work,!1,l.iscommit,function(){n.alert("操作成功")})}}angular.module("app").controller("workprogramEditCtrl",e),e.$inject=["workprogramSvc","$state","bsWin","sysfileSvc","$scope","meetingSvc","roomSvc","signSvc"]}(),function(){"use strict";function e(a,l,c,n){var i=rootPath+"/company";return{initPage:function(s){var e={method:"post",url:rootPath+"/workprogram/html/initWorkProgram",params:{signId:s.work.signId}};common.http({vm:s,$http:a,httpOptions:e,success:function(e){if(null!=e.data&&""!=e.data){if(s.work=e.data.eidtWP,s.work.reviewType||(s.work.reviewType="自评"),s.work.isSigle||(s.work.isSigle="单个评审"),s.work.expertDtoList&&0<s.work.expertDtoList.length&&((!s.work.expertCost||s.work.expertCost<1e3*s.work.expertDtoList.length)&&(s.work.expertCost=1e3*s.work.expertDtoList.length),s.work.expertDtoList))for(var t=s.work.expertDtoList,i=0;i<t.length;i++)if(t[i].expertTypeDtoList){for(var o=t[i].expertTypeDtoList,n="",a="",r=0;r<o.length;r++)a.indexOf(o[r].expertType)<0&&(0<r&&(a+="、"),a+=o[r].expertType),0<r&&(n+="、"),n+=o[r].maJorBig+"、"+o[r].maJorSmall;t[i].expertCategory=a,t[i].major=n}s.model.workProgramDtoList={},("9"==e.data.showTotalInvestment||9==e.data.showTotalInvestment||e.data.WPList&&0<e.data.WPList.length)&&(s.model.workProgramDtoList=e.data.WPList,s.showTotalInvestment=!0),"1"==s.work.branchId&&d(s),s.work.signId=l.params.signid,s.work.projectType&&(s.work.projectTypeDicts=c.topSelectChange(s.work.projectType,c.DICT.PROJECTTYPE.dicts)),"合并评审"!=s.work.isSigle||"0"!=s.work.isMainProject&&0!=s.work.isMainProject||(s.businessFlag.isReveiwAWP=!0),s.initFileUpload()}}})},createWP:function(e,t,i,o){!0;var n={method:"post",url:rootPath+"/workprogram/addWork",data:e,params:{isNeedWorkProgram:t}};common.http({$http:a,httpOptions:n,success:function(e){null!=o&&"function"==typeof o&&o(e.data)},onError:function(e){!1}})},findCompanys:d,findUsersByOrgId:function(t,i){var e={};"main"==i&&(e.orgId=t.work.reviewDept);var o={method:"get",url:rootPath+"/user/findUsersByOrgId",params:e};common.http({vm:t,$http:a,httpOptions:o,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){"main"==i&&(t.mainUserList={},t.mainUserList=e.data)}})}})},deleteBookRoom:function(e,t){var i={method:"delete",url:rootPath+"/room",params:{id:e}};common.http({$http:a,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t()}})},findAllMeeting:function(t){var e={method:"get",url:rootPath+"/room/meeting"};common.http({$http:a,httpOptions:e,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},workMaintainList:function(e,t){var i={method:"post",url:rootPath+"/workprogram/html/workMaintainList",params:{signId:e.work.signId}};common.http({vm:e,$http:a,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},initMergeInfo:function(t,e){r(e,function(e){t.unMergeSign=[],t.unMergeSign=e}),o(e,function(e){t.mergeSign=[],t.mergeSign=e})},getMergeSignBySignId:o,unMergeWPSign:r,chooseSign:function(e,t,i){var o={method:"post",url:rootPath+"/signView/mergeSign",params:{signId:e,mergeIds:t,mergeType:"1"}};common.http({$http:a,httpOptions:o,success:function(e){null!=i&&"function"==typeof i&&i(e.data)}})},cancelMergeSign:function(e,t,i){var o={method:"post",url:rootPath+"/signView/cancelMergeSign",params:{signId:e,cancelIds:t,mergeType:"1"}};common.http({$http:a,httpOptions:o,success:function(e){null!=i&&"function"==typeof i&&i(e.data)}})},deleteAllMerge:function(e,t,i){var o={method:"post",url:rootPath+"/signView/deleteAllMerge",params:{signId:e,mergeType:"1",businessId:t}};common.http({$http:a,httpOptions:o,success:function(e){null!=i&&"function"==typeof i&&i(e.data)}})},findById:function(e,t){var i={method:"post",url:rootPath+"/workprogram/initWorkProgramById",params:{workId:e}};common.http({$http:a,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},updateReviewType:function(e,t,i,o){var n={method:"post",url:rootPath+"/workprogram/updateReviewType",data:{signId:e,id:t,reviewType:i}};common.http({$http:a,httpOptions:n,success:function(e){null!=o&&"function"==typeof o&&o(e.data)}})},updateWPExpertCost:function(e){var t={method:"post",url:rootPath+"/workprogram/updateWPExpertCost",params:{wpId:e}};common.http({$http:a,httpOptions:t,success:function(e){}})},initFlowWP:function(e,t,i,o){var n={method:"post",url:rootPath+"/workprogram/initFlowWP",params:{signId:e,taskId:t,branchId:i}};common.http({$http:a,httpOptions:n,success:function(e){null!=o&&"function"==typeof o&&o(e.data)}})},initBaseInfo:function(e,t){var i={method:"post",url:rootPath+"/workprogram/initBaseInfo",params:{signId:e}};common.http({$http:a,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},saveBaseInfo:function(e,t,i){!0;var o={method:"post",url:rootPath+"/workprogram/saveBaseInfo",data:e};common.http({$http:a,httpOptions:o,success:function(e){null!=i&&"function"==typeof i&&i(e.data)},onError:function(e){!1}})},getProjBranchInfo:function(e,t){var i={method:"post",url:rootPath+"/flow/getBranchInfo",params:{signId:e}};common.http({$http:a,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},reStartWorkFlow:function(e,t,i){var o={method:"post",url:rootPath+"/workprogram/startReWorkFlow",params:{signId:e,brandIds:t}};common.http({$http:a,httpOptions:o,success:function(e){null!=i&&"function"==typeof i&&i(e.data)}})},initFlowDeal:function(t,i,o){var e={method:"post",url:rootPath+"/workprogram/initDealFlow",params:{wpId:t.businessKey}};common.http({$http:a,httpOptions:e,success:function(e){t.model={},e.data.SignDto&&(t.model=e.data.SignDto,o&&n.findByMianId(t.model.signid,function(e){e&&0<e.length&&(t.showFlag.tabSysFile=!0,t.sysFileList=e,n.initZtreeClient(t,i))}));t.model.workProgramDtoList=[],e.data.WorkProgramDto&&(t.model.workProgramDtoList.push(e.data.WorkProgramDto),t.branchId=e.data.WorkProgramDto.branchId);e.data.WorkProgramHisDtoList&&(t.WorkProgramHisDtoList=e.data.WorkProgramHisDtoList)}})}};function o(e,t){var i={method:"post",url:rootPath+"/signView/getMergeSignBySignId",params:{signId:e}};common.http({$http:a,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}function r(e,t){var i={method:"post",url:rootPath+"/signView/unMergeWPSign",params:{signId:e}};common.http({$http:a,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}function d(t){var e={method:"get",url:common.format(i+"/findCcompanys")};common.http({vm:t,$http:a,httpOptions:e,success:function(e){t.companys={},t.companys=e.data}})}}angular.module("app").factory("workprogramSvc",e),e.$inject=["$http","$state","$rootScope","sysfileSvc"]}(),function(){"use strict";function e(e,t){var n=this;n.title="固定资产申购流程",n.del=function(e){common.confirm({vm:n,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteAssertStorageBusiness(n,e)}})},n.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:n,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");n.del(o)}},t.grid(n),n.searchForm=function(){n.gridOptions.dataSource._skip=0,n.gridOptions.dataSource.read()},n.formReset=function(){n.searchModel={}}}angular.module("app").controller("assertStorageBusinessCtrl",e),e.$inject=["$location","assertStorageBusinessSvc"]}(),function(){"use strict";function e(e,t,i,a){var r=this;function o(e){if(0<r.conditions.length){return r.conditions.forEach(function(e,t){e.goodsName=$("#goodsName"+e.sort).val(),e.specifications=$("#specifications"+e.sort).val(),e.models=$("#models"+e.sort).val(),e.orgCompany=$("#orgCompany"+e.sort).val(),e.evaluate=$("#evaluate"+e.sort).val(),e.goodsNumber=$("#goodsNumber"+e.sort).val(),e.applyDept=r.model.applyDept,e.operator=r.model.operator,e.businessId=$("#businessId").val()}),!0}return!1}r.model={},r.conMaxIndex=0,r.conditions=new Array,r.title="添加固定资产申购流程",r.isuserExist=!1,r.businessId=i.params.businessId,r.showFlag={addBooksDeatail:!0,modBooksDetail:!0,bookBuyApplyTr:!1,bookBuyBzTr:!0,bookBuyFgzrTr:!0,bookBuyZrTr:!0,bookBuyYsrk:!0},r.businessId&&(r.isUpdate=!0,r.showFlag.modBooksDetail=!0,r.showFlag.addBooksDeatail=!1,r.title="更新图书采购申请业务信息",$("#businessId").val(r.businessId)),r.create=function(){t.createAssertStorageBusiness(r)},r.update=function(){t.updateAssertStorageBusiness(r)},r.addCondition=function(){r.condition={},r.showFlag.addBooksDeatail?r.condition.sort=r.conMaxIndex+1:(r.conMaxIndex=r.conditions.length,r.condition.sort=r.conditions.length+1),r.conditions.push(r.condition),r.conMaxIndex++},r.removeCondition=function(){var n=$("#conditionTable input[name='epConditionSort']:checked");0<n.length?a.confirm({title:"询问提示",message:"删除数据不可恢复，确定删除么？",onOk:function(){$(".confirmDialog").modal("hide");for(var i=[],o=0;o<n.length;o++)$.each(r.conditions,function(e,t){n[o].value==t.sort&&(t.id?i.push(t.id):r.conditions.splice(e,1))});0<i.length?t.deleteSelConditions(i.join(","),r.isCommit,function(e){e.flag||"ok"==e.reCode?(a.success("操作成功！"),$.each(i,function(e,i){$.each(r.conditions,function(e,t){i==t.sort&&r.conditions.splice(e,1)})})):a.error(e.reMsg)}):a.success("操作成功！")}}):a.alert("请选择要删除的抽取条件！")},r.saveCondition=function(){o(!1)?t.saveGoodsDetailBusinessDetail(r.conditions,function(e){e.flag||"ok"==e.reCode?($("#businessId").val(e.reObj.businessId),a.success("保存成功！")):a.error(e.reMsg)}):a.error("请添加后再保存")},r.startFlow=function(){a.confirm({title:"询问提示",message:"发起流程后，当前页面数据将不能再修改！确认发起流程么？",onOk:function(){o()?t.startFlow(r.conditions,r.isCommit,function(e){e.flag||"ok"==e.reCode?a.alert("保存成功！",function(){i.go("myAssertStorageBusiness")}):a.alert(e.reMsg)}):a.error("请添加图书信息后再发起流程！")}})},r.checkBookNum=function(e){var t,i="bookNumber"+e;(t=$("#"+i).val(),/^(\+|-)?\d+$/.test(t)&&0<t)?$("span[data-valmsg-for='"+i+"']").html(""):$("span[data-valmsg-for='"+i+"']").html("图书数量只能输入正整数！")},r.checkPrice=function(e){var t="booksPrice"+e,i="bookNumber"+e;if(!/^(-)?(([1-9]{1}\d*)|([0]{1}))(\.(\d){1,4})?$/.test($("#"+t).val()))return $("#"+t).val(""),void $("span[data-valmsg-for='"+t+"']").html("价格只能输入数字！");$("span[data-valmsg-for='"+t+"']").html("");var o=$("#"+t).val(),n=$("#"+i).val();$("#total"+e).val(parseFloat(o)*n)},r.isUpdate&&t.getAssertStorageBusinessById(r)}angular.module("app").controller("assertStorageBusinessEditCtrl",e),e.$inject=["$location","assertStorageBusinessSvc","$state","bsWin"]}(),function(){"use strict";function e(n){var o=rootPath+"/assertStorageBusiness",i="#/assertStorageBusinessList";return{grid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/assertStorageBusiness/findByOData",$("#myTopicForm"),{filter:"createdBy eq ${CURRENT_USER.id}"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"businessName",title:"业务流程名称",width:"20%",filterable:!1},{field:"createdDate",title:"创建日期",width:"15%",filterable:!1,format:"{0:yyyy/MM/dd HH:mm:ss}"},{field:"",title:"已发起流程",width:"15%",filterable:!1,template:function(e){return e.processInstanceId?"是":"否"}},{field:"",title:"操作",width:140,template:function(e){var t=!!e.processInstanceId;return common.format($("#columnBtns").html(),e.businessId,t)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:function(){var e=this.items(),i=this.pager.page()-1,o=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+i*o,t=$(this).find(".row-number");$(t).html(e)})},resizable:!0}},getAssertStorageBusinessById:function(t){var e={method:"get",url:rootPath+"/assertStorageBusiness/html/findById",params:{id:t.businessId}};common.http({vm:t,$http:n,httpOptions:e,success:function(e){t.model=e.data}})},createAssertStorageBusiness:function(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0;var e={method:"post",url:o,data:t.model};common.http({vm:t,$http:n,httpOptions:e,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,location.href=i}})}})}})}},deleteAssertStorageBusiness:function(t,e){t.isSubmit=!0;var i={method:"delete",url:o,data:e};common.http({vm:t,$http:n,httpOptions:i,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})}})}})},updateAssertStorageBusiness:function(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0,t.model.id=t.id;var e={method:"put",url:o,data:t.model};common.http({vm:t,$http:n,httpOptions:e,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})}})}},saveGoodsDetailBusinessDetail:function(e,t){var i={method:"post",url:rootPath+"/assertStorageBusiness/saveGoodsDetailList",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(e)};common.http({$http:n,httpOptions:i,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})},startFlow:function(e,t,i){!0;var o={method:"post",url:rootPath+"/assertStorageBusiness/startFlow",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(e)};common.http({$http:n,httpOptions:o,success:function(e){!1,null!=i&&"function"==typeof i&&i(e.data)},onError:function(){!1}})},initFlowDeal:function(t){var e={method:"get",url:rootPath+"/assertStorageBusiness/html/findById",params:{id:t.businessKey}};common.http({$http:n,httpOptions:e,success:function(e){t.model=e.data},onError:function(){}})}}}angular.module("app").factory("assertStorageBusinessSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,i){var o=this;o.model={},o.conMaxIndex=0,o.conditions=new Array,o.title="添加用户资产明细",o.isuserExist=!1,o.id=i.params.id,o.id&&(o.isUpdate=!0,o.title="更新用户资产明细"),o.create=function(){t.createUserAssertDetail(o)},o.update=function(){t.updateUserAssertDetail(o)},o.addCondition=function(){o.condition={},o.condition.sort=o.conMaxIndex+1,o.conditions.push(o.condition),o.conMaxIndex++},o.isUpdate?t.getUserAssertDetailById(o):t.initFillData(function(e){o.goodsDetailDtoList=e.reObj.goodsDetailDtoList})}angular.module("app").controller("userAssertDetailAddCtrl",e),e.$inject=["$location","userAssertDetailSvc","$state"]}(),function(){"use strict";function e(e,t){var n=this;n.title="用户资产明细",n.del=function(e){common.confirm({vm:n,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteUserAssertDetail(n,e)}})},n.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:n,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");n.del(o)}},t.grid(n)}angular.module("app").controller("userAssertDetailCtrl",e),e.$inject=["$location","userAssertDetailSvc"]}(),function(){"use strict";function e(o){var n=rootPath+"/userAssertDetail",i="#/userAssertDetailList";return{grid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(n),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"id",title:"id",width:100,filterable:!0},{field:"userId",title:"userId",width:100,filterable:!0},{field:"userName",title:"userName",width:100,filterable:!0},{field:"goodId",title:"goodId",width:100,filterable:!0},{field:"goodsName",title:"goodsName",width:100,filterable:!0},{field:"goodsNumber",title:"goodsNumber",width:100,filterable:!0},{field:"",title:"操作",width:140,template:function(e){return common.format($("#columnBtns").html(),"vm.del('"+e.id+"')",e.id)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0}},getUserAssertDetailById:function(t){var e={method:"get",url:rootPath+"/userAssertDetail/html/findById",params:{id:t.id}};common.http({vm:t,$http:o,httpOptions:e,success:function(e){t.model=e.data}})},createUserAssertDetail:function(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0;var e={method:"post",url:n,data:t.model};common.http({vm:t,$http:o,httpOptions:e,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,location.href=i}})}})}})}},deleteUserAssertDetail:function(t,e){t.isSubmit=!0;var i={method:"delete",url:n,data:e};common.http({vm:t,$http:o,httpOptions:i,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})}})}})},updateUserAssertDetail:function(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0,t.model.id=t.id;var e={method:"put",url:n,data:t.model};common.http({vm:t,$http:o,httpOptions:e,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})}})}},initFillData:function(t){var e={method:"post",url:rootPath+"/userAssertDetail/html/initFillPageData"};common.http({$http:o,httpOptions:e,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}}}angular.module("app").factory("userAssertDetailSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t){var n=this;n.title="物品明细",n.del=function(e){common.confirm({vm:n,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteGoodsDetail(n,e)}})},n.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:n,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");n.del(o)}},t.grid(n)}angular.module("app").controller("goodsDetailCtrl",e),e.$inject=["$location","goodsDetailSvc"]}(),function(){"use strict";function e(e,t,i){var o=this;o.title="添加物品明细",o.isuserExist=!1,o.id=i.params.id,o.id&&(o.isUpdate=!0,o.title="更新物品明细"),o.create=function(){t.createGoodsDetail(o)},o.update=function(){t.updateGoodsDetail(o)},o.isUpdate&&t.getGoodsDetailById(o)}angular.module("app").controller("goodsDetailEditCtrl",e),e.$inject=["$location","goodsDetailSvc","$state"]}(),function(){"use strict";function e(o){var n=rootPath+"/goodsDetail",i="#/goodsDetailList";return{grid:function(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(n),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"id",title:"id",width:100,filterable:!0},{field:"goodsCode",title:"goodsCode",width:100,filterable:!0},{field:"goodsName",title:"goodsName",width:100,filterable:!0},{field:"specifications",title:"specifications",width:100,filterable:!0},{field:"models",title:"models",width:100,filterable:!0},{field:"goodsPrice",title:"goodsPrice",width:100,filterable:!0},{field:"evaluate",title:"evaluate",width:100,filterable:!0},{field:"goodsNumber",title:"goodsNumber",width:100,filterable:!0},{field:"assertStorageBusiness",title:"assertStorageBusiness",width:100,filterable:!0},{field:"",title:"操作",width:140,template:function(e){return common.format($("#columnBtns").html(),"vm.del('"+e.id+"')",e.id)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0}},getGoodsDetailById:function(t){var e={method:"get",url:rootPath+"/goodsDetail/html/findById",params:{id:t.id}};common.http({vm:t,$http:o,httpOptions:e,success:function(e){t.model=e.data}})},createGoodsDetail:function(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0;var e={method:"post",url:n,data:t.model};common.http({vm:t,$http:o,httpOptions:e,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,location.href=i}})}})}})}},deleteGoodsDetail:function(t,e){t.isSubmit=!0;var i={method:"delete",url:n,data:e};common.http({vm:t,$http:o,httpOptions:i,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})}})}})},updateGoodsDetail:function(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0,t.model.id=t.id;var e={method:"put",url:n,data:t.model};common.http({vm:t,$http:o,httpOptions:e,success:function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})}})}},getAllStoreAssert:function(t){var e={method:"get",url:rootPath+"/bookBuyBusiness/html/findById"};common.http({vm:vm,$http:o,httpOptions:e,success:function(e){null!=t&&"function"==typeof t&&t(e.data)}})}}}angular.module("app").factory("goodsDetailSvc",e),e.$inject=["$http"]}();