!function(){"use strict";angular.module("app",["ui.router","kendo.directives","angular-loading-bar","ngAnimate","ngFileSaver"]).filter("trust2Html",["$sce",function(t){return function(e){return t.trustAsHtml(e)}}]).filter("myFilter",function(){return function(t,e,i){var o=[],n=[];return i instanceof Array?n=i:n.push(i),angular.forEach(t,function(t){angular.forEach(n,function(i){t[e]==i&&o.push(t)})}),o}}).config(["$stateProvider","$locationProvider","$urlRouterProvider","cfpLoadingBarProvider",function(t,e,i,o){e.hashPrefix(""),o.parentSelector="#loading-bar-container",o.spinnerTemplate='<div style="position:fixed;width:100%;height:100%;left:0;top:0; z-index:10001;background:rgba(0, 0, 0, 0.3);overflow: hidden;"><div style="position: absolute;top:30%; width: 400px;height:40px;left:50%;"><i class="fa fa-spinner fa-pulse fa-1x fa-fw"></i>数据加载中...</div></div>',i.otherwise("/welcome"),t.state("welcome",{url:"/welcome",templateUrl:rootPath+"/admin/welcome.html",controller:"adminWelComeCtrl",controllerAs:"vm"}).state("gtasks",{url:"/gtasks",templateUrl:rootPath+"/admin/gtasks.html",controller:"adminCtrl",controllerAs:"vm"}).state("agendaTasks",{url:"/agendaTasks",templateUrl:rootPath+"/admin/agendaTasks.html",controller:"adminAgendaCtrl",controllerAs:"vm"}).state("doingTasks",{url:"/doingTasks",templateUrl:rootPath+"/admin/doingTasks.html",controller:"adminDoTaskCtrl",controllerAs:"vm"}).state("flowDeal",{url:"/flowDeal/:businessKey/:processKey/:taskId/:instanceId",templateUrl:function(t){return rootPath+"/flow/flowDeal/"+t.processKey+".html"},controller:"flowDealCtrl",controllerAs:"vm"}).state("flowDetail",{url:"/flowDetail/:businessKey/:processKey/:taskId/:instanceId",templateUrl:function(t){return rootPath+"/flow/flowDetail/"+t.processKey+".html"},controller:"flowDetailCtrl",controllerAs:"vm"}).state("flowEnd",{url:"/flowEnd/:businessKey/:processKey/:instanceId",templateUrl:function(t){return rootPath+"/flow/flowEnd/"+t.processKey+".html"},controller:"flowEndCtrl",controllerAs:"vm"}).state("addSupp",{url:"/addSupp/:businessId/:businessType/:isControl",templateUrl:rootPath+"/addSuppLetter/edit.html",controller:"addSuppLetterCtrl",controllerAs:"vm"}).state("addSuppletterList",{url:"/addSuppletterList/:businessId",templateUrl:rootPath+"/addSuppLetter/list.html",controller:"addSuppLetterListCtrl",controllerAs:"vm"}).state("addSuppLetterEdit",{url:"/addSuppLetterEdit/:id",templateUrl:rootPath+"/addSuppLetter/editUpload.html",controller:"addSuppLetterEditCtrl",controllerAs:"vm"}).state("suppLetterView",{url:"/suppLetterView/:id",templateUrl:rootPath+"/addSuppLetter/view.html",controller:"suppLetterViewCtrl",controllerAs:"vm"}).state("suppletterList",{url:"/suppletterList",templateUrl:rootPath+"/addSuppLetter/html/suppLetterList.html",controller:"addSuppLetterQueryCtrl",controllerAs:"vm"}).state("querySuppLetterDetail",{url:"/querySuppLetterDetail/:id",templateUrl:rootPath+"/addSuppLetter/detail.html",controller:"addSuppLetterQueryEditCtrl",controllerAs:"vm"}).state("suppLetterApproveEdit",{url:"/suppLetterApproveEdit/:id",templateUrl:rootPath+"/addSuppLetter/suppLetterApproveEdit.html",controller:"addSuppLetterQueryEditCtrl",controllerAs:"vm"}).state("registerFile",{url:"/registerFile/:businessId",templateUrl:rootPath+"/addRegisterFile/list.html",controller:"addRegisterFileCtrl",controllerAs:"vm"}).state("dtasks",{url:"/dtasks",templateUrl:rootPath+"/admin/dtasks.html",controller:"adminDoingCtrl",controllerAs:"vm"}).state("personDtasks",{url:"/personDtasks",templateUrl:rootPath+"/sign/personDtasks.html",controller:"adminPersonDoingCtrl",controllerAs:"vm"}).state("etasks",{url:"/etasks",templateUrl:rootPath+"/sign/etasks.html",controller:"adminEndCtrl",controllerAs:"vm"}).state("role",{url:"/role",templateUrl:rootPath+"/role/html/list.html",controller:"roleCtrl",controllerAs:"vm"}).state("roleEdit",{url:"/roleEdit/:id",templateUrl:rootPath+"/role/html/edit.html",controller:"roleEditCtrl",controllerAs:"vm"}).state("user",{url:"/user",templateUrl:rootPath+"/user/html/list.html",controller:"userCtrl",controllerAs:"vm"}).state("userEdit",{url:"/userEdit/:id",templateUrl:rootPath+"/user/html/edit.html",controller:"userEditCtrl",controllerAs:"vm"}).state("org",{url:"/org",templateUrl:rootPath+"/org/html/list.html",controller:"orgCtrl",controllerAs:"vm"}).state("orgEdit",{url:"/orgEdit/:id",templateUrl:rootPath+"/org/html/edit.html",controller:"orgEditCtrl",controllerAs:"vm"}).state("orgUser",{url:"/orgUser/:id",templateUrl:rootPath+"/org/html/orgUser.html",controller:"orgUserCtrl",controllerAs:"vm"}).state("sysdept",{url:"/sysdept",templateUrl:rootPath+"/sysdept/html/list.html",controller:"sysdeptCtrl",controllerAs:"vm"}).state("sysdeptEdit",{url:"/sysdeptEdit/:id",templateUrl:rootPath+"/sysdept/html/edit.html",controller:"sysdeptEditCtrl",controllerAs:"vm"}).state("sysdeptUser",{url:"/sysdeptUser/:id",templateUrl:rootPath+"/sysdept/html/sysdeptUser.html",controller:"sysdeptUserCtrl",controllerAs:"vm"}).state("log",{url:"/log",templateUrl:rootPath+"/log/html/list.html",controller:"logCtrl",controllerAs:"vm"}).state("config",{url:"/config",templateUrl:rootPath+"/sysConfig/html/list.html",controller:"sysConfigCtrl",controllerAs:"vm"}).state("upload",{url:"/upload/:uploadid",templateUrl:rootPath+"/upload/html/edit.html",controller:"uploadEditCtrl",controllerAs:"vm"}).state("meeting",{url:"/meeting",templateUrl:rootPath+"/meeting/html/list.html",controller:"meetingCtrl",controllerAs:"vm"}).state("meetingEdit",{url:"/meetingEdit/:id",templateUrl:rootPath+"/meeting/html/edit.html",controller:"meetingEditCtrl",controllerAs:"vm"}).state("room",{url:"/room",params:{businessId:"",businessType:""},templateUrl:rootPath+"/room/html/roomlist.html",controller:"roomCtrl",controllerAs:"vm"}).state("roomCount",{url:"/roomCount",params:{id:""},templateUrl:rootPath+"/room/html/countlist.html",controller:"roomCountCtrl",controllerAs:"vm"}).state("company",{url:"/company",templateUrl:rootPath+"/company/html/list.html",controller:"companyCtrl",controllerAs:"vm"}).state("companyEdit",{url:"/companyEdit/:id",templateUrl:rootPath+"/company/html/edit.html",controller:"companyEditCtrl",controllerAs:"vm"}).state("accountPwd",{url:"/accountPwd",templateUrl:rootPath+"/account/html/changePwd.html",controller:"homeCtrl",controllerAs:"vm"}).state("demo",{url:"/demo",templateUrl:rootPath+"/demo/html/list.html",controller:"demoCtrl",controllerAs:"vm"}).state("dict",{url:"/dict",templateUrl:rootPath+"/dict/html/list.html",controller:"dictCtrl",controllerAs:"vm"}).state("dict.edit",{url:"/edit/:id",templateUrl:rootPath+"/dict/html/edit.html",controller:"dictEditCtrl",controllerAs:"vm"}).state("expert",{url:"/expert",templateUrl:rootPath+"/expert/html/queryAllList.html",controller:"expertCtrl",controllerAs:"vm"}).state("expertAudit",{url:"/expertAudit",templateUrl:rootPath+"/expert/html/audit.html",controller:"expertAuditCtrl",controllerAs:"vm"}).state("expertRepeat",{url:"/expertRepeat",templateUrl:rootPath+"/expert/html/repeat.html",controller:"expertRepeatCtrl",controllerAs:"vm"}).state("expertEdit",{url:"/expertEdit/:id",templateUrl:rootPath+"/expert/html/edit.html",controller:"expertEditCtrl",controllerAs:"vm"}).state("expertReviewEdit",{url:"/expertReview/:businessId/:minBusinessId/:businessType",templateUrl:rootPath+"/expertReview/html/selectExpert.html",controller:"expertSelectCtrl",controllerAs:"vm"}).state("expertScore",{url:"/expertScore",templateUrl:rootPath+"/expert/html/scoreList.html",controller:"expertScoreCtrl",controllerAs:"vm"}).state("expertSelectHis",{url:"/expertSelectHis",templateUrl:rootPath+"/expert/html/selectHisList.html",controller:"expertSelectHisCtrl",controllerAs:"vm"}).state("addSign",{url:"/addSign",templateUrl:rootPath+"/sign/html/add.html",controller:"signCreateCtrl",controllerAs:"vm"}).state("fillSign",{url:"/fillSign/:signid/:isControl",cache:"false",templateUrl:rootPath+"/sign/html/fillin.html",controller:"signFillinCtrl",controllerAs:"vm"}).state("listSign",{url:"/listSign",templateUrl:rootPath+"/sign/html/list.html",controller:"signCtrl",controllerAs:"vm"}).state("signFlowDeal",{url:"/signFlowDeal/:signid/:taskId/:processInstanceId",templateUrl:rootPath+"/sign/html/flowDeal.html",controller:"signFlowDealCtrl",controllerAs:"vm"}).state("signFlowDetail",{url:"/signFlowDetail/:signid/:taskId/:processInstanceId",templateUrl:rootPath+"/sign/html/signFlowDetail.html",controller:"signFlowDetailCtrl",controllerAs:"vm"}).state("signDetails",{url:"/signDetails/:signid/:processInstanceId",templateUrl:rootPath+"/sign/html/signDetails.html",controller:"signDetailsCtrl",controllerAs:"vm"}).state("endSignDetail",{url:"/endSignDetail/:signid/:processInstanceId",templateUrl:rootPath+"/sign/html/signEndDetails.html",controller:"signEndCtrl",controllerAs:"vm"}).state("signList",{url:"/signList",templateUrl:rootPath+"/signView/html/signList.html",controller:"adminSignListCtrl",controllerAs:"vm"}).state("projectStopInfo",{url:"/projectStopInfo/:signId",templateUrl:rootPath+"/projectStop/html/projectStopInfo.html",controller:"projectStopInfoCtrl",controllerAs:"vm"}).state("selectHeader",{url:"/selectHeader",templateUrl:rootPath+"/sign/html/selectHeader.html",controller:"selectHeaderCtrl",controllerAs:"vm"}).state("signGetBack",{url:"/signGetBack",templateUrl:rootPath+"/sign/html/signGetBack.html",controller:"signGetBackCtrl",controllerAs:"vm"}).state("pauseProject",{url:"/pauseProject",templateUrl:rootPath+"/projectStop/html/pauseProjectList.html",controller:"pauseProjectCtrl",controllerAs:"vm"}).state("projectStopForm",{url:"/projectStopForm/:signId/:stopId",templateUrl:rootPath+"/projectStop/html/projectStopForm.html",controller:"projectStopFormCtrl",controllerAs:"vm"}).state("projectStopFormEdit",{url:"/projectStopFormEdit/:stopId",templateUrl:rootPath+"/projectStop/html/projectStopForm.html",controller:"projectStopFormEditCtrl",controllerAs:"vm"}).state("reserveAdd",{url:"/reserveAdd",templateUrl:rootPath+"/sign/html/reserveAdd.html",controller:"signReserveAddCtrl",controllerAs:"vm"}).state("reserveList",{url:"/reserveList",templateUrl:rootPath+"/sign/html/reserveList.html",controller:"signReserveCtrl",controllerAs:"vm"}).state("reserveEdit",{url:"/reserveEdit",templateUrl:rootPath+"/sign/html/reserveList.html",controller:"signReserveCtrl",controllerAs:"vm"}).state("deletList",{url:"/deletList",templateUrl:rootPath+"/sign/html/deletList.html",controller:"signDeletCtrl",controllerAs:"vm"}).state("workprogramEdit",{url:"/workprogramEdit/:signid/:isControl",templateUrl:rootPath+"/workprogram/html/edit.html",controller:"workprogramEditCtrl",controllerAs:"vm"}).state("dispatchEdit",{url:"/dispatchEdit/:signid/:isControl",templateUrl:rootPath+"/dispatch/html/edit.html",controller:"dispatchEditCtrl",controllerAs:"vm"}).state("fileRecordEdit",{url:"/fileRecordEdit/:signid/:isControl",templateUrl:rootPath+"/fileRecord/html/edit.html",controller:"fileRecordEditCtrl",controllerAs:"vm"}).state("assistPlan",{url:"/assistPlan",templateUrl:rootPath+"/assistPlan/html/manager.html",controller:"assistPlanCtrl",controllerAs:"vm"}).state("officeUserList",{url:"/officeUserList",templateUrl:rootPath+"/officeUser/html/list.html",controller:"officeUserCtrl",controllerAs:"vm"}).state("officeUserEdit",{url:"/officeUserEdit/:officeID",templateUrl:rootPath+"/officeUser/html/edit.html",controller:"officeUserEditCtrl",controllerAs:"vm"}).state("listDept",{url:"/listDept",templateUrl:rootPath+"/dept/html/list.html",controller:"deptCtrl",controllerAs:"vm"}).state("deptEdit",{url:"/deptEdit/:deptId",templateUrl:rootPath+"/dept/html/edit.html",controller:"deptEditCtrl",controllerAs:"vm"}).state("deptOfficeUser",{url:"/deptOfficeUser/:deptId",templateUrl:rootPath+"/dept/html/listOfficeUser.html",controller:"deptOfficeUserCtrl",controllerAs:"vm"}).state("assistUnit",{url:"/assistUnit",templateUrl:rootPath+"/assistUnit/html/assistUnitList.html",controller:"assistUnitCtrl",controllerAs:"vm"}).state("assistUnitEdit",{url:"/assistUnitEdit/:id",templateUrl:rootPath+"/assistUnit/html/assistUnitEdit.html",controller:"assistUnitEditCtrl",controllerAs:"vm"}).state("quartz",{url:"/quartz",templateUrl:rootPath+"/quartz/html/list.html",controller:"quartzCtrl",controllerAs:"vm"}).state("workday",{url:"/workday",templateUrl:rootPath+"/workday/html/list.html",controller:"workdayCtrl",controllerAs:"vm"}).state("workdayEdit",{url:"/workdayEdit/:id",templateUrl:rootPath+"/workday/html/edit.html",controller:"workdayEditCtrl",controllerAs:"vm"}).state("annountment",{url:"/annountment",templateUrl:rootPath+"/annountment/html/list.html",controller:"annountmentCtrl",controllerAs:"vm"}).state("annountmentEdit",{url:"/annountmentEdit/:id",templateUrl:rootPath+"/annountment/html/edit.html",controller:"annountmentEditCtrl",controllerAs:"vm"}).state("annountmentDetail",{url:"/annountmentDetail/:id",templateUrl:rootPath+"/annountment/html/detail.html",controller:"annountmentDetailCtrl",controllerAs:"vm"}).state("annountmentYet",{url:"/annountmentYet",templateUrl:rootPath+"/annountment/html/yetList.html",controller:"annountmentYetCtrl",controllerAs:"vm"}).state("sharingPlatlform",{url:"/sharingPlatlform",templateUrl:rootPath+"/sharingPlatlform/html/list.html",controller:"sharingPlatlformCtrl",controllerAs:"vm"}).state("sharingPlatlformEdit",{url:"/sharingPlatlformEdit/:sharId",templateUrl:rootPath+"/sharingPlatlform/html/edit.html",controller:"sharingPlatlformEditCtrl",controllerAs:"vm"}).state("sharingDetil",{url:"/sharingDetil/:sharId",templateUrl:rootPath+"/sharingPlatlform/html/detail.html",controller:"sharingDetailCtrl",controllerAs:"vm"}).state("sharingPlatlformYet",{url:"/sharingPlatlformYet",templateUrl:rootPath+"/sharingPlatlform/html/yetList.html",controller:"sharingPlatlformYetCtrl",controllerAs:"vm"}).state("financialManager",{url:"/financialManager/:businessId",templateUrl:rootPath+"/financialManager/html/add.html",controller:"financialManagerCtrl",controllerAs:"vm"}).state("financialAssistManager",{url:"/financialAssistManager/:businessId",templateUrl:rootPath+"/financialManager/html/assistCostAdd.html",controller:"assistCostEditCtrl",controllerAs:"vm"}).state("assistCostlist",{url:"/assistCostlist/:costType",templateUrl:rootPath+"/financialManager/html/assistCostList.html",controller:"assistCostCountEditCtrl",controllerAs:"vm"}).state("assistCostCountList",{url:"/assistCostCountList",templateUrl:rootPath+"/financialManager/html/assistCostCount.html",controller:"assistCostCountListCtrl",controllerAs:"vm"}).state("financialManagerList",{url:"/financialManagerList/:costType",templateUrl:rootPath+"/financialManager/html/list.html",controller:"financialManagerEditCtrl",controllerAs:"vm"}).state("expertPaymentCountList",{url:"/expertPaymentCountList",templateUrl:rootPath+"/financialManager/html/expertPaymentCount.html",params:{year:(new Date).getFullYear()+"",month:(new Date).getMonth()+1+""},controller:"expertPaymentCountCtrl",controllerAs:"vm"}).state("expertPaymentDetailCountList",{url:"/expertPaymentDetailCountList/:year/:month",templateUrl:rootPath+"/financialManager/html/expertPaymentDetailCount.html",controller:"expertPaymentDetailCountCtrl",controllerAs:"vm"}).state("exportCountList",{url:"/exportCountList",templateUrl:rootPath+"/financialManager/html/expertCount.html",controller:"exportCountCtrl",controllerAs:"vm"}).state("expertRevCondCountList",{url:"/expertRevCondCountList",templateUrl:rootPath+"/signView/html/expertReviewCondCount.html",controller:"expertRevConCountCtrl",controllerAs:"vm"}).state("projectCostCountList",{url:"/projectCostCountList",templateUrl:rootPath+"/financialManager/html/projectCostCount.html",controller:"projectCostCountCtrl",controllerAs:"vm"}).state("proCostClassifyCountList",{url:"/proCostClassifyCountList",templateUrl:rootPath+"/financialManager/html/proCostClassifyCount.html",controller:"proCostClassifyCountCtrl",controllerAs:"vm"}).state("proReviewConCountList",{url:"/proReviewConCountList",templateUrl:rootPath+"/signView/html/proReviewConCount.html",controller:"proReviewConditionCtrl",controllerAs:"vm"}).state("monthlyNewsletterList",{url:"/monthlyNewsletterList",templateUrl:rootPath+"/monthlyNewsletter/html/monthlyNewsletterList.html",controller:"monthlyNewsletterCtrl",controllerAs:"vm"}).state("monthlyEdit",{url:"/monthlyEdit/:id",templateUrl:rootPath+"/monthlyNewsletter/html/monthlyNewsletterEdit.html",controller:"monthlyNewsletterEditCtrl",controllerAs:"vm"}).state("theMonthsList",{url:"/theMonthsList",templateUrl:rootPath+"/monthlyNewsletter/html/theMonthsList.html",controller:"yearMonthlyNewsletterCtrl",controllerAs:"vm"}).state("monthlyFindByMultiyear",{url:"/monthlyFindByMultiyear/:year",templateUrl:rootPath+"/monthlyNewsletter/html/monthlyMultiyearList.html",controller:"monthlyMultiyearCtrl",controllerAs:"vm"}).state("monthlyMultiyearEdit",{url:"/monthlyMultiyearEdit/:year/:id",templateUrl:rootPath+"/monthlyNewsletter/html/monthlyMultiyearAdd.html",controller:"monthlyMultiyearEditCtrl",controllerAs:"vm"}).state("monthlyMultiyFileList",{url:"/monthlyMultiyFileList",templateUrl:rootPath+"/monthlyNewsletter/html/monthlyMultiyFileList.html",controller:"monthlyMultiFileCtrl",controllerAs:"vm"}).state("monthlyMultiyView",{url:"/monthlyMultiyView/:id",templateUrl:rootPath+"/monthlyNewsletter/html/monthlyMultiyView.html",controller:"monthlyMultiyViewCtrl",controllerAs:"vm"}).state("monthlyHistoryList",{url:"/monthlyHistoryList",templateUrl:rootPath+"/monthlyNewsletter/html/monthlyHistoryList.html",controller:"monthlyHistoryCtrl",controllerAs:"vm"}).state("monthlyHistoryEdit",{url:"/monthlyHistoryEdit/:id",templateUrl:rootPath+"/monthlyNewsletter/html/monthlyHistoryAdd.html",controller:"monthlyHistoryEditCtrl",controllerAs:"vm"}).state("approveWindow",{url:"/approveWindow/:signId",templateUrl:rootPath+"/reviewProjectAppraise/html/approveWindow.html",controller:"approveWindowCtrl",controllerAs:"vm"}).state("approveWindowEdit",{url:"/approveWindowEdit/:id",templateUrl:rootPath+"/reviewProjectAppraise/html/approveWindow.html",controller:"approveWindowEditCtrl",controllerAs:"vm"}).state("reviewProjectAppraiseList",{url:"/reviewProjectAppraiseList",params:{id:""},templateUrl:rootPath+"/signView/html/list.html",controller:"reviewProjectAppraiseCtrl",controllerAs:"vm"}).state("reviewProjectAppraiseEdit",{url:"/reviewProjectAppraiseEdit",templateUrl:rootPath+"/reviewProjectAppraise/html/edit.html",controller:"reviewProjectAppraiseEditCtrl",controllerAs:"vm"}).state("approveList",{url:"/approveList",templateUrl:rootPath+"/reviewProjectAppraise/html/approveList.html",controller:"approveListCtrl",controllerAs:"vm"}).state("libraryAdd",{url:"/libraryAdd",params:{id:""},templateUrl:rootPath+"/archivesLibrary/html/archivesLibraryAdd.html",controller:"archivesLibraryCtrl",controllerAs:"vm"}).state("archivesLibraryList",{url:"/archivesLibraryList",params:{id:""},templateUrl:rootPath+"/archivesLibrary/html/archivesLibraryList.html",controller:"archivesLibraryListCtrl",controllerAs:"vm"}).state("archivesLibraryView",{url:"/archivesLibraryView/:id",templateUrl:rootPath+"/archivesLibrary/html/archivesLibraryView.html",controller:"archivesLibraryViewCtrl",controllerAs:"vm"}).state("pluginfile",{url:"/pluginfile",templateUrl:rootPath+"/file/html/pluginfile.html",controller:"pluginfileCtrl",controllerAs:"vm"}).state("takeUser",{url:"/takeUser",templateUrl:rootPath+"/personalCenter/html/takeUser.html",controller:"takeUserCtrl",controllerAs:"vm"}).state("fileLibrary",{url:"/fileLibrary",templateUrl:rootPath+"/fileLibrary/html/fileLibrary.html",controller:"qualityCtrl",controllerAs:"vm"}).state("fileLibrary.fileList",{url:"/fileList/:parentId",templateUrl:rootPath+"/fileLibrary/html/fileList.html",controller:"qualityListCtrl",controllerAs:"vm"}).state("fileLibrary.fileEdit",{url:"/fileEdit/:parentId/:fileId",templateUrl:rootPath+"/fileLibrary/html/fileEdit.html",controller:"qualityEditCtrl",controllerAs:"vm"}).state("policyLibrary",{url:"/policyLibrary",templateUrl:rootPath+"/fileLibrary/html/policyLibrary.html",controller:"policyCtrl",controllerAs:"vm"}).state("policyLibrary.policyList",{url:"/policyList/:parentId",templateUrl:rootPath+"/fileLibrary/html/policyList.html",controller:"policyListCtrl",controllerAs:"vm"}).state("policyLibrary.policyEdit",{url:"/policyEdit/:parentId/:fileId",templateUrl:rootPath+"/fileLibrary/html/policyEdit.html",controller:"policyEditCtrl",controllerAs:"vm"}).state("bookBuyBusinessEdit",{url:"/bookBuyBusinessEdit",params:{businessId:"",viewDetail:""},templateUrl:rootPath+"/bookBuyBusiness/html/bookBuyBusinessEdit.html",controller:"bookBuyBusinessEditCtrl",controllerAs:"vm"}).state("myBookBuyBusiness",{url:"/myBookBuyBusiness",templateUrl:rootPath+"/bookBuyBusiness/html/bookBuyBusinessList.html",controller:"bookBuyBusinessCtrl",controllerAs:"vm"}).state("bookDetailList",{url:"/bookDetailList",templateUrl:rootPath+"/bookBuyBusiness/html/bookBuyList.html",controller:"bookBuyCtrl",controllerAs:"vm"}).state("bookBuyBusinessDetail",{url:"/bookBuyBusinessDetail/:businessId/:viewDetail",templateUrl:rootPath+"/bookBuyBusiness/html/bookBuyBusinessDetail.html",controller:"bookBuyBusinessDetailCtrl",controllerAs:"vm"}).state("bookBorrowList",{url:"/bookBorrowList",templateUrl:rootPath+"/bookBuyBusiness/html/bookBorrowList.html",controller:"bookBorrowCtrl",controllerAs:"vm"}).state("assertStorageBusinessEdit",{url:"/assertStorageBusinessEdit/:businessId",templateUrl:rootPath+"/assertStorageBusiness/html/assertStorageBusinessEdit.html",controller:"assertStorageBusinessEditCtrl",controllerAs:"vm"}).state("myAssertStorageBusiness",{url:"/myAssertStorageBusiness",templateUrl:rootPath+"/assertStorageBusiness/html/assertStorageBusinessList.html",controller:"assertStorageBusinessCtrl",controllerAs:"vm"}).state("assertApplyUse",{url:"/assertApplyUse",templateUrl:rootPath+"/userAssertDetail/html/userAssertDetailAdd.html",controller:"userAssertDetailAddCtrl",controllerAs:"vm"}).state("addTopic",{url:"/topicInfo/:id",templateUrl:rootPath+"/topicInfo/html/add.html",controller:"topicAddCtrl",controllerAs:"vm"}).state("myTopic",{url:"/myTopic",templateUrl:rootPath+"/topicInfo/html/myList.html",controller:"myTopicCtrl",controllerAs:"vm"}).state("header",{url:"/header",templateUrl:rootPath+"/header/html/list.html",controller:"headerCtrl",controllerAs:"vm"}).state("headerEdit",{url:"/headerEdit/:headerType",templateUrl:rootPath+"/header/html/selectHeader.html",controller:"headerEditCtrl",controllerAs:"vm"}).state("statisticalList",{url:"/statisticalList/:headerType",templateUrl:rootPath+"/header/html/statisticalList.html",controller:"statisticalListCtrl",controllerAs:"vm"}).state("statistical",{url:"/statistical",templateUrl:rootPath+"/statistical/html/list.html",controller:"statisticalCtrl",controllerAs:"vm"}).state("editWorkPlan",{url:"/editWorkPlan/:topicId",templateUrl:rootPath+"/workPlan/html/edit.html",controller:"workPlanEditCtrl",controllerAs:"vm"}).state("editFiling",{url:"/editFiling/:topicId",templateUrl:rootPath+"/filing/html/edit.html",controller:"filingEditCtrl",controllerAs:"vm"}).state("reviewFee",{url:"/reviewFee",templateUrl:rootPath+"/reviewFee/html/list.html",controller:"reviewFeeCtrl",controllerAs:"vm"}).state("signwork",{url:"/signwork/:signid",templateUrl:rootPath+"/signwork/html/list.html",controller:"signworkCtrl",controllerAs:"vm"}).state("signFlowDeal.fileList",{url:"/fileList/:id/:type",templateUrl:rootPath+"/file/html/rightList.html",controller:"fileListCtrl",controllerAs:"vm"}).state("signFlowDetail.fileList",{url:"/fileList/:id/:type",templateUrl:rootPath+"/file/html/rightList.html",controller:"fileListCtrl",controllerAs:"vm"}).state("endSignDetail.fileList",{url:"/fileList/:id/:type",templateUrl:rootPath+"/file/html/rightList.html",controller:"fileListCtrl",controllerAs:"vm"}).state("signDetails.fileList",{url:"/fileList/:id/:type",templateUrl:rootPath+"/file/html/rightList.html",controller:"fileListCtrl",controllerAs:"vm"}).state("flowDeal.fileList",{url:"/flowDeal/:id/:type",templateUrl:rootPath+"/file/html/rightList.html",controller:"fileListCtrl",controllerAs:"vm"}).state("MaintainProjectEdit.fileList",{url:"/MaintainProjectEdit/:id/:type",templateUrl:rootPath+"/file/html/rightList.html",controller:"fileListCtrl",controllerAs:"vm"}).state("signChart",{url:"/signChart",templateUrl:rootPath+"/signView/html/signChart.html",controller:"signChartCtrl",controllerAs:"vm"}).state("MaintainProjectList",{url:"/MaintainProjectList",templateUrl:rootPath+"/sign/html/MaintainProjectList.html",controller:"MaintainProjectCtrl",controllerAs:"vm"}).state("MaintainProjectEdit",{url:"/MaintainProjectEdit/:signid/:processInstanceId",templateUrl:rootPath+"/sign/html/MaintainProjectEdit.html",controller:"MaintainProjectEditCtrl",controllerAs:"vm"}).state("reviewWorkday",{url:"/reviewWorkday/:signid",templateUrl:rootPath+"/maintainProject/html/reviewWorkday.html",controller:"reviewWorkdayCtrl",controllerAs:"vm"}).state("reviewOpinion",{url:"/reviewOpinion/:signid/:processInstanceId",templateUrl:rootPath+"/maintainProject/html/reviewOpinion.html",controller:"reviewOpinionCtrl",controllerAs:"vm"}).state("maintainExpertScore",{url:"/maintainExpertScore/:signid",templateUrl:rootPath+"/maintainProject/html/maintainExpertScore.html",controller:"maintainExpertScoreCtrl",controllerAs:"vm"}).state("maintainExpertPayment",{url:"/maintainExpertPayment/:signid",templateUrl:rootPath+"/maintainProject/html/maintainExpertPayment.html",controller:"maintainExpertPaymentCtrl",controllerAs:"vm"}).state("maintainExpertConfirm",{url:"/maintainExpertConfirm/:signid",templateUrl:rootPath+"/maintainProject/html/maintainExpertConfirm.html",controller:"maintainExpertConfirmCtrl",controllerAs:"vm"}).state("partyEdit",{url:"/partyEdit",templateUrl:rootPath+"/partyManager/html/partyEdit.html",controller:"partyEditCtrl",controllerAs:"vm"}).state("partyList",{url:"/partyList",templateUrl:rootPath+"/partyManager/html/partyList.html",controller:"partyListCtrl",controllerAs:"vm"})}]).run(function(t,e,i,o,n){t.rootPath=rootPath,t.DICT=DICTOBJ,kendo.culture("zh-CN"),common.getTaskCount({$http:e}),t.getTBHeadName=function(t,e,i){return!e||"9"!=e||"项目建议书"!=t&&"可行性研究报告"!=t?t?"项目概算"==t?"概算审核"+i:t+i:i:"评估论证"+i},t.$on("$stateChangeSuccess",function(e,i,o,n,a){t.previousState_name=n.name,t.previousState_params=a,"signFlowDeal"!=n.name&&"flowDeal"!=n.name||(t.$flowUrl=n.name,t.$flowParams=a)}),t.back=function(){t.previousState_name?i.go(t.previousState_name,t.previousState_params):i.go("welcome")},t.backtoflow=function(){t.$flowUrl?i.go(t.$flowUrl,t.$flowParams):i.go("gtasks")},t.topSelectChange=function(t,e,i){if(void 0!=e)for(var o=0;o<e.length;o++)if(i&&"code"==i){if(e[o].dictCode==t)return e[o].dicts}else if(e[o].dictName==t)return e[o].dicts},t.initInputValue=function(t,e){return t.target.checked&&!e?1:e},t.range=function(t){if(t)return new Array(t)},t.countCharacter=function(t,e,i){var o=t?t.length:0,n="<span style='font-size:12px;'>（最多允许输入"+e+"个字";if(o>0){var a=e-o>0?e-o:0;n+=",还能输入<font color='red'>"+a+"</font>个字",0==a&&(t=t.substr(0,e))}return n+="</span>)",$("#"+i).html(n),t},t.previewFile=function(t,i){if(t){var o;if("pdf"==i?o=rootPath+"/contents/libs/pdfjs-dist/web/viewer.html?file="+rootPath+"/file/preview/"+t+"&version="+(new Date).getTime():"image"==i&&(o=rootPath+"/file/preview/"+t+"?version="+(new Date).getTime()),o){var a={method:"post",url:rootPath+"/file/fileSysCheck",params:{sysFileId:t}},r=function(t){$("#iframePreview").attr("src",""),t.data.flag||"ok"==t.data.reCode?($("#iframePreview").attr("src",o),$("#previewModal").kendoWindow({width:"1050px",height:"730px",title:"",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()):n.error(t.data.reMsg)};common.http({$http:e,httpOptions:a,success:r})}else n.alert("该文件不支持在线预览和在线编辑")}else n.alert("参数不正确，无法在线预览")},t.editFile=function(t,e){var i=rootPath+"/file/editFile?sysFileId="+t+"&fileType="+e+"&version="+(new Date).getTime();window.open(i,"_blank")},t.printFile=function(t,e,i){if(t&&e&&i){var o=rootPath+"/contents/libs/pdfjs-dist/web/viewer.html?version="+(new Date).getTime()+"&file="+rootPath+"/file/printPreview/"+t+"/"+e+"/"+i;$("#iframePreview").attr("src",o),$("#previewModal").kendoWindow({width:"80%",height:"730px",title:"",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()}else n.alert("打印预览失败，参数不正确！")},t.view={},t.storeView=function(e,i){t.view[e]=i}})}(),function(){"use strict";var t=angular.module("app");t.directive("goBack",function(){return{restrict:"AE",template:'<a class="btn btn-sm btn-primary" href="javascript:void(0);" ng-click="back();"><span class="glyphicon glyphicon-chevron-left"></span>返回</a>'}}),t.directive("goBackFlow",function(){return{restrict:"AE",template:'<button class="btn btn-sm btn-danger" ng-click="backtoflow();"><span class="glyphicon glyphicon-chevron-left"></span>返回流程</button>'}}),t.directive("flowFileButton",function(){return{restrict:"AE",template:'<button class="btn btn-sm btn-primary" ng-click="vm.clickUploadBt();" id="upload_file_bt">上传附件</button> <button class="btn btn-sm btn-primary" ng-click="vm.clickDetailBt();" id="detail_file_bt">查看附件</button>'}})}(),function(){"use strict";function t(t,e,i){var o=this;o.title="登记补充资料",o.sign={},o.addRegisters=[],o.businessId=i.params.businessId,o.addRegisterFile=function(){o.addRegister={},o.addRegister.businessId=o.businessId,o.addRegister.id=common.uuid(),o.addRegisters.push(o.addRegister)},o.saveRegisterFile=function(){e.saveRegisterFile(o.addRegisters,function(e){e.flag||"ok"==e.reCode?(t.alert("操作成功"),o.addRegisters=e.reObj):t.alert(e.reMsg)})},o.deleteRegisterFile=function(){var i=$("#addRegistersTable input[name='addRegistersCheck']:checked");if(i.length<1)t.alert("请选择要删除的记录！");else{for(var n=[],a=0;a<i.length;a++)o.addRegisters.forEach(function(t,e){t.id&&i[a].value==t.id&&(n.push(i[a].value),o.addRegisters.splice(e,1))});n.length>0&&e.deleteByIds(n.join(","),function(e){t.alert("删除成功！")})}},o.inputIntegerValue=function(t,i){e.isUnsignedInteger(t)?$("#errorsUnmber"+i).html(""):$("#errorsUnmber"+i).html("只能输入数字")},function(){i.params.businessId&&e.initAddRegisterFile(i.params.businessId,function(t){t&&t.length>0&&(o.addRegisters=t)})}()}angular.module("app").controller("addRegisterFileCtrl",t),t.$inject=["bsWin","addRegisterFileSvc","$state"]}(),function(){"use strict";function t(t,e,i){var o=this;o.title="添加登记补充资料",o.isuserExist=!1,o.id=i.params.id,o.id&&(o.isUpdate=!0,o.title="更新登记补充资料"),o.create=function(){e.createAddRegisterFile(o)},o.update=function(){e.updateAddRegisterFile(o)},function(){o.isUpdate&&e.getAddRegisterFileById(o)}()}angular.module("app").controller("addRegisterFileEditCtrl",t),t.$inject=["$location","addRegisterFileSvc","$state"]}(),function(){"use strict";function t(t){function e(t,e){$("#addRegister").kendoWindow({width:"70%",height:"660px",title:"意见选择",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()}function i(t){return!!(/^(\+|-)?\d+$/.test(t)&&t>0)}function o(e,i){var o={method:"post",url:rootPath+"/addRegisterFile/save",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(e)},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function n(e,i){var o={method:"post",url:rootPath+"/addRegisterFile/findByBusinessId",params:{businessId:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function a(e,i){var o={method:"delete",url:r+"/deleteFile",params:{ids:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}var r=rootPath+"/addRegisterFile";return{initAddRegisterFile:n,saveRegisterFile:o,isUnsignedInteger:i,initRegisterWinDow:e,deleteByIds:a}}angular.module("app").factory("addRegisterFileSvc",t),
t.$inject=["$http"]}(),function(){"use strict";function t(t,e,i,o,n,a){var r=this;r.suppletter={},r.suppletter.businessId=o.params.businessId,r.suppletter.businessType=o.params.businessType,r.suppletter.id=o.params.id,r.isControl=o.params.isControl,r.title="拟补充资料函",r.businessFlag={isInitFileOption:!1},function(){e.initSuppLetter(r.suppletter.businessId,r.suppletter.businessType,function(t){r.suppletter=t,r.initFileUpload()})}(),r.initFileUpload=function(){r.suppletter.id||a.$watch("vm.suppletter.id",function(t,e){t&&t!=e&&!r.initUploadOptionSuccess&&r.initFileUpload()}),r.sysFile={businessId:r.suppletter.id,mainId:r.suppletter.businessId,mainType:i.mainTypeValue().SIGN,sysfileType:i.mainTypeValue().AADSUPP_FILE,sysBusiType:i.mainTypeValue().AADSUPP_FILE},i.initUploadOptions({inputId:"sysfileinput",vm:r})},r.saveAddSuppletter=function(){common.initJqValidation($("#suppletter_form")),$("#suppletter_form").valid()?(r.suppletter.fileType="1",e.saveSuppLetter(r.suppletter,r.isCommit,function(t){t.flag||"ok"==t.reCode?(r.suppletter=t.reObj,n.success("操作成功！")):n.error(t.reMsg)})):n.alert("表格填写不正确，请检查相应的必填项信息！")},r.startSignSupperFlow=function(){common.initJqValidation($("#suppletter_form")),$("#suppletter_form").valid()?n.confirm({title:"询问提示",message:"确认已经完成填写，并且发起流程么？",onOk:function(){e.saveSuppLetter(r.suppletter,r.isCommit,function(t){r.isCommit=!1,t.flag||"ok"==t.reCode?(r.suppletter=t.reObj,e.startSignSupperFlow(r.suppletter.id,function(t){t.flag||"ok"==t.reCode?n.success("操作成功！"):n.error(t.reMsg)})):n.error(t.reMsg)})}}):n.alert("表格填写不正确，请检查相应的必填项信息！")},r.del=function(t){common.confirm({vm:r,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),e.deleteAddSuppLetter(r,t)}})},r.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)common.alert({vm:r,msg:"请选择数据"});else{for(var e=[],i=0;i<t.length;i++)e.push(t[i].value);var o=e.join(",");r.del(o)}}}angular.module("app").controller("addSuppLetterCtrl",t),t.$inject=["$location","addSuppLetterSvc","sysfileSvc","$state","bsWin","$scope"]}(),function(){"use strict";function t(t,e,i,o,n,a){var r=this;r.title="添加登记补充资料",r.isuserExist=!1,r.id=o.params.id,r.suppletter={},r.suppletter.businessId=o.params.businessId,r.suppletter.businessType=o.params.businessType,r.suppletter.id=o.params.id,r.id&&(r.isUpdate=!0,r.title="更新登记补充资料"),r.businessFlag={isInitFileOption:!1},r.initFileUpload=function(){r.suppletter.id||a.$watch("vm.suppletter.id",function(t,e){t&&t!=e&&!r.initUploadOptionSuccess&&r.initFileUpload()}),r.sysFile={businessId:r.suppletter.id,mainId:r.suppletter.businessId,mainType:i.mainTypeValue().SIGN,sysfileType:i.mainTypeValue().AADSUPP_FILE,sysBusiType:i.mainTypeValue().AADSUPP_FILE,detailBt:"detail_file_bt"},i.initUploadOptions({inputId:"sysfileinput",vm:r})},r.saveAddSuppletter=function(){common.initJqValidation($("#suppletter_form")),$("#suppletter_form").valid()?e.saveSuppLetter(r.suppletter,r.isCommit,function(t){t.flag||"ok"==t.reCode?(r.suppletter=t.reObj,n.success("操作成功！")):n.error(t.reMsg)}):n.alert("表格填写不正确，请检查相应的必填项信息！")},r.comeBack=function(){o.go("addSuppletterList",{businessId:r.suppletter.businessId})},r.update=function(){e.updateAddSuppLetter(r)},r.startSignSupperFlow=function(){common.initJqValidation($("#suppletter_form")),$("#suppletter_form").valid()?n.confirm({title:"询问提示",message:"确认已经完成填写，并且发起流程么？",onOk:function(){e.saveSuppLetter(r.suppletter,r.isCommit,function(t){r.isCommit=!1,t.flag||"ok"==t.reCode?(r.suppletter=t.reObj,o.go("addSuppletterList",{businessId:r.suppletter.businessId}),e.startSignSupperFlow(r.suppletter.id,function(t){t.flag||"ok"==t.reCode?n.success("操作成功！"):n.error(t.reMsg)})):n.error(t.reMsg)})}}):n.alert("提交失败，有红色*号的内容都要按要求填写！")},function(){e.getAddSuppLetterById(r.suppletter.id,function(t){r.suppletter=t,r.initFileUpload()})}()}angular.module("app").controller("addSuppLetterEditCtrl",t),t.$inject=["$location","addSuppLetterSvc","sysfileSvc","$state","bsWin","$scope"]}(),function(){"use strict";function t(t,e){function i(e,i){var o={method:"post",url:rootPath+"/addSuppLetter/startSignSupperFlow",params:{id:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function o(t){c(t.businessKey,function(e){t.suppletter=e})}function n(e,i){var o={method:"post",url:rootPath+"/addSuppLetter/initSuppListDate",params:{businessId:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function a(e,i){var o={method:"post",url:u+"/createFileNum",params:{id:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function r(e,i,o){var n={method:"post",url:rootPath+"/addSuppLetter/initSuppLetter",params:{businessId:e,businessType:i}},a=function(t){void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:t,httpOptions:n,success:a})}function s(e,i){e.isSubmit=!0;var o={method:"delete",url:u,data:i},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",closeDialog:!0,fn:function(){e.isSubmit=!1,e.gridOptions.dataSource.read()}})}})};common.http({vm:e,$http:t,httpOptions:o,success:n})}function l(e,i,o){i=!0;var n={method:"post",url:rootPath+"/addSuppLetter/saveSupp",data:e},a=function(t){void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:t,httpOptions:n,success:a,onError:function(t){i=!1}})}function c(e,i){var o={method:"post",url:rootPath+"/addSuppLetter/findById",params:{id:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function d(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(u),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"id",title:"id",width:100,filterable:!0},{field:"orgName",title:"orgName",width:100,filterable:!0},{field:"userName",title:"userName",width:100,filterable:!0},{field:"suppLetterTime",title:"suppLetterTime",width:100,filterable:!0,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"disapDate",title:"disapDate",width:100,filterable:!0,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"secretLevel",title:"secretLevel",width:100,filterable:!0},{field:"mergencyLevel",title:"mergencyLevel",width:100,filterable:!0},{field:"filenum",title:"filenum",width:100,filterable:!0},{field:"title",title:"title",width:100,filterable:!0},{field:"dispaRange",title:"dispaRange",width:100,filterable:!0},{field:"suppleterSuggest",title:"suppleterSuggest",width:100,filterable:!0},{field:"meetingSuggest",title:"meetingSuggest",width:100,filterable:!0},{field:"leaderSuggest",title:"leaderSuggest",width:100,filterable:!0},{field:"printnum",title:"printnum",width:100,filterable:!0},{field:"signid",title:"signid",width:100,filterable:!0},{field:"fileSeq",title:"fileSeq",width:100,filterable:!0},{field:"",title:"操作",width:140,template:function(t){return common.format($("#columnBtns").html(),"vm.del('"+t.id+"')",t.id)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0}}var u=rootPath+"/addSuppLetter";return{initSuppLetter:r,saveSuppLetter:l,grid:d,deleteAddSuppLetter:s,getAddSuppLetterById:c,createFilenum:a,initSuppListDate:n,initFlowDeal:o,startSignSupperFlow:i}}angular.module("app").factory("addSuppLetterSvc",t),t.$inject=["$http","bsWin"]}(),function(){"use strict";function t(t,e,i,o){var n=this;n.suppletter={},n.suppletter.businessId=i.params.businessId,n.title="登记补充资料",function(){e.initSuppListDate(n.suppletter.businessId,function(t){n.suppletterlist=t})}(),n.getFilenum=function(t){e.createFilenum(t,function(t){t.flag||"ok"==t.reCode?(o.alert("操作成功！"),$.each(n.suppletterlist,function(e,i){i.id==t.reObj.id&&(i.filenum=t.reObj.filenum)})):o.alert(t.reMsg)})},n.findByIdAddSuppLetter=function(t){i.go("addSuppLetterEdit",{id:t})}}angular.module("app").controller("addSuppLetterListCtrl",t),t.$inject=["$location","addSuppLetterSvc","$state","bsWin"]}(),function(){"use strict";function t(t,e,i,o,n){var a=this;a.suppletter={},a.id=i.params.id,a.isQuery=!0,a.model={},function(){e.addQueryGrid(a),n.queryOrgList(a,function(t){a.model.org=t})}(),a.quarySuppContent=function(){a.queryGridOptions.dataSource._skip="",a.queryGridOptions.dataSource.read()},a.resetSuppContent=function(){var t=$("#supQueryForm").find("input,select").not(":submit, :reset, :image, :disabled,:hidden");$.each(t,function(t,e){e.value=""})},a.showSuppLetterDetail=function(t){a.isDisplay=!0,a.id=t,e.getaddSuppLetterQueryById(a,function(t){a.suppletter=t,$("#suppLetterDetailDiv").kendoWindow({width:"70%",height:"620px",title:"拟补充资料函详情",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()})}}angular.module("app").controller("addSuppLetterQueryCtrl",t),t.$inject=["$location","addSuppLetterQuerySvc","$state","bsWin","orgSvc"]}(),function(){"use strict";function t(t,e,i,o){var n=this;n.title="添加登记补充资料",n.isuserExist=!1,n.id=i.params.id,n.id&&(n.isUpdate=!0,n.title="更新登记补充资料"),n.saveSuppletterApprove=function(){e.createaddSuppLetterQuery(n)},n.update=function(){e.updateaddSuppLetterQuery(n)},function(){e.getaddSuppLetterQueryById(n,function(t){n.suppletter=t})}()}angular.module("app").controller("addSuppLetterQueryEditCtrl",t),t.$inject=["$location","addSuppLetterQuerySvc","$state","bsWin"]}(),function(){"use strict";function t(t,e){function i(e,i){var o={method:"post",url:rootPath+"/addSuppLetterQuery/initSuppListDate",params:{businessId:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function o(e,i){var o={method:"post",url:u+"/createFileNum",params:{id:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function n(e,i,o){var n={method:"post",url:rootPath+"/addSuppLetterQuery/initSuppLetter",params:{businessId:e,businessType:i}},a=function(t){void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:t,httpOptions:n,success:a})}function a(e){if(common.initJqValidation(),$("form").valid()){e.isSubmit=!0,e.model.id=e.id;var i={method:"put",url:u,data:e.model},o=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:e,$http:t,httpOptions:i,success:o})}}function r(e,i){e.isSubmit=!0;var o={method:"delete",url:u,data:i},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",closeDialog:!0,fn:function(){e.isSubmit=!1,e.gridOptions.dataSource.read()}})}})};common.http({vm:e,$http:t,httpOptions:o,success:n})}function s(i){var o={method:"post",url:rootPath+"/addSuppLetter/updateApprove",data:i.suppletter},n=function(t){e.success("操作成功！")};common.http({$http:t,httpOptions:o,success:n})}function l(e,i){var o={method:"post",url:rootPath+"/addSuppLetter/findById",params:{id:e.id}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({vm:e,$http:t,httpOptions:o,success:n})}function c(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/addSuppLetter/addsuppListData",$("#supQueryForm")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})},o=[{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"",title:"文件标题",filterable:!1,template:function(t){return"<a ng-click='vm.showSuppLetterDetail( \""+t.id+"\")'>"+t.title+"</a>"}},{field:"orgName",title:"拟稿部门",width:120,filterable:!1},{field:"userName",title:"拟稿人",width:90,filterable:!1},{field:"suppLetterTime",title:"拟稿时间",width:120,filterable:!1,format:"{0: yyyy-MM-dd}"},{field:"filenum",title:"文件字号",width:120,filterable:!1},{field:"",title:"操作",width:80,filterable:!1,template:function(t){var e=!1;return t.createdBy!=curUserId||!angular.isUndefined(t.appoveStatus)&&null!=t.appoveStatus||(e=!0),e?"<a class='btn btn-xs btn-primary' href='#addSuppLetterEdit/"+t.id+"'><span class='glyphicon glyphicon-pencil'></span>编辑</a>":""}}];t.queryGridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}function d(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(u+"/addSuppApproveList"),schema:{data:"value",total:function(t){return t.count?$("#ADDSUPPLETTER_COUNT").html(t.count):$("#ADDSUPPLETTER_COUNT").html(0),t.count},model:{id:"id",fields:{createdDate:{type:"date"},modifiedDate:{type:"date"}}}},serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"title",title:"文件标题",width:100,filterable:!1},{field:"orgName",title:"拟稿部门",width:100,filterable:!1},{field:"userName",title:"拟稿人",width:100,filterable:!1},{field:"suppLetterTime",title:"拟稿时间",width:100,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"filenum",title:"文件字号",width:100,filterable:!1},{field:"",title:"操作",width:140,template:function(t){return common.format($("#columnBtns").html(),t.id)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0}}var u=rootPath+"/addSuppLetter";return{approveGrid:d,addQueryGrid:c,createaddSuppLetterQuery:s,deleteaddSuppLetterQuery:r,updateaddSuppLetterQuery:a,getaddSuppLetterQueryById:l,initSuppLetter:n,createFilenum:o,initSuppListDate:i}}angular.module("app").factory("addSuppLetterQuerySvc",t),t.$inject=["$http","bsWin"]}(),function(){"use strict";function t(t,e,i,o,n,a){var r=this;r.isuserExist=!1,r.id=o.params.id,r.suppletter={},r.suppletter.id=o.params.id,r.id&&(r.isUpdate=!0,r.title="查看登记补充资料"),r.businessFlag={isInitFileOption:!1},r.initFileUpload=function(){r.suppletter.id||a.$watch("vm.suppletter.id",function(t,e){t&&t!=e&&!r.initUploadOptionSuccess&&r.initFileUpload()}),r.sysFile={businessId:r.suppletter.id,mainId:r.suppletter.id,mainType:i.mainTypeValue().SIGN,sysfileType:i.mainTypeValue().AADSUPP_FILE,sysBusiType:i.mainTypeValue().AADSUPP_FILE},i.initUploadOptions({inputId:"sysfileinput",vm:r})},r.addSuppContent=function(){if(r.suppletter.id){r.showsupp=!0;$("#addsuppletter").kendoWindow({width:"60%",height:"90%",title:"拟补资料函正文",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open(),e.findByBusinessId(r)}else n.alert("请先保存业务数据")},r.saveAddSuppletter=function(){common.initJqValidation($("#suppletter_form")),$("#suppletter_form").valid()?e.saveSuppLetter(r.suppletter,r.isCommit,function(t){t.flag||"ok"==t.reCode?(r.suppletter=t.reObj,n.success("操作成功！")):n.error(t.reMsg)}):n.alert("表格填写不正确，请检查相应的必填项信息！")},r.comeBack=function(){o.go("addSuppletterList",{businessId:r.suppletter.businessId})},function(){e.getAddSuppLetterById(r.suppletter.id,function(t){r.suppletter=t,r.initFileUpload()})}()}angular.module("app").controller("suppLetterViewCtrl",t),t.$inject=["$location","addSuppLetterSvc","sysfileSvc","$state","bsWin","$scope"]}(),function(){"use strict";function t(t,e){var i=this;i.title="待办任务",function(){e.agendaTaskGrid(i),e.workName(i)}(),i.query=function(){i.gridOptions.dataSource._skip=0,i.gridOptions.dataSource.read()}}angular.module("app").controller("adminAgendaCtrl",t),t.$inject=["$location","adminSvc"]}(),function(){"use strict";function t(t,e,i,o){var n=this;n.title="待办项目",n.stateName=i.current.name,n.queryParams={},n.saveView=function(){o.storeView(n.stateName,{gridParams:n.gridOptions.dataSource.transport.options.read.data(),queryParams:n.queryParams,data:n})},function(){if(o.view[n.stateName]){var t=o.view[n.stateName];t.gridParams&&(n.gridParams=t.gridParams),t.data&&(n.model=t.data.model),t.queryParams&&(n.queryParams=t.queryParams),e.gtasksGrid(n),o.view[n.stateName]=void 0}else e.gtasksGrid(n)}(),n.querySign=function(){n.gridOptions.dataSource._skip=0,n.gridOptions.dataSource.read()},n.resetForm=function(){var t=$("#searchform").find("input,select");$.each(t,function(t,e){e.value=""})},n.countWorkday=function(){e.countWorakday(n)}}angular.module("app").filter("date",function(){return function(t){return t?new Date(t.CompatibleDate()).Format("yyyy-MM-dd"):""}}).controller("adminCtrl",t),t.$inject=["$location","adminSvc","$state","$rootScope"]}(),function(){"use strict";function t(t,e,i,o,n,a,r,s){var l=this;l.title="在办项目",l.model={},l.page=0,l.stateName=r.current.name,l.queryParams={},l.saveView=function(){s.storeView(l.stateName,{gridParams:l.gridOptions.dataSource.transport.options.read.data(),queryParams:l.queryParams,data:l})},function(){if(l.showwin=!1,s.view[l.stateName]){var t=s.view[l.stateName];t.gridParams&&(l.gridParams=t.gridParams),t.data&&(l.model=t.data.model),t.queryParams&&(l.queryParams=t.queryParams),e.dtasksGrid(l),s.view[l.stateName]=void 0}else e.dtasksGrid(l)}(),l.pauseProject=function(t){o.findPausingProject(l,t,"")},l.Checked=function(){$("#fileNo").is(":checked")&&($("#file1").prop("checked",!1),$("#file2").prop("checked",!1))},l.Checked2=function(){$("#fileNo").prop("checked",!1)},l.commitProjectStop=function(){o.pauseProject(l)},l.closewin=function(){window.parent.$("#spwindow").data("kendoWindow").close()},l.querySign=function(){l.gridOptions.dataSource._skip="",l.gridOptions.dataSource.read()},l.formReset=function(){l.model={}},l.startProject=function(t){common.confirm({vm:l,title:"",msg:"确认激活吗？",fn:function(){$(".confirmDialog").modal("hide"),i.activeFlow(l,t)}})},l.deletProject=function(t){n.confirm({title:"询问提示",message:"确认删除该条项目吗？",onOk:function(){$(".confirmDialog").modal("hide"),a.deleteSign(t,function(t){t.flag||"ok"==t.reCode?n.alert("删除成功！",function(){l.gridOptions.dataSource.read()}):n.alert(t.reMsg)})}})}}angular.module("app").controller("adminDoingCtrl",t),t.$inject=["$location","adminSvc","flowSvc","pauseProjectSvc","bsWin","signSvc","$state","$rootScope"]}(),function(){"use strict";function t(t,e,i){var o=this;o.title="在办任务",o.stateName=e.current.name,o.queryParams={},o.saveView=function(){i.storeView(o.stateName,{gridParams:o.gridOptions.dataSource.transport.options.read.data(),queryParams:o.queryParams,data:o})},o.query=function(){o.gridOptions.dataSource._skip="",o.gridOptions.dataSource.read()},function(){if(i.view[o.stateName]){var e=i.view[o.stateName];e.gridParams&&(o.gridParams=e.gridParams),e.data&&(o.model=e.data.model),e.queryParams&&(o.queryParams=e.queryParams),t.doingTaskGrid(o),i.view[o.stateName]=void 0}else t.doingTaskGrid(o);t.workName(o)}()}angular.module("app").controller("adminDoTaskCtrl",t),t.$inject=["adminSvc","$state","$rootScope"]}(),function(){"use strict";function t(t,e){var i=this;i.title="办结事项",function(){e.etasksGrid(i)}()}angular.module("app").controller("adminEndCtrl",t),t.$inject=["$location","adminSvc"]}(),function(){"use strict";function t(t,e,i,o,n,a){var r=this;r.title="个人经办项目",r.model={},r.stateName=n.current.name,r.queryParams={},r.saveView=function(){a.storeView(r.stateName,{gridParams:r.gridOptions.dataSource.transport.options.read.data(),queryParams:r.queryParams,data:r})},function(){if(r.showwin=!1,a.view[r.stateName]){var t=a.view[r.stateName];t.gridParams&&(r.gridParams=t.gridParams),t.data&&(r.model=t.data.model),t.queryParams&&(r.queryParams=t.queryParams),e.personMainTasksGrid(r),a.view[r.stateName]=void 0}else e.personMainTasksGrid(r)}()}angular.module("app").controller("adminPersonAssistCtrl",t),t.$inject=["$location","adminSvc","flowSvc","pauseProjectSvc","$state","$rootScope"]}(),function(){"use strict";function t(t,e,i,o,n,a){var r=this;r.title="个人经办项目",r.stateName=n.current.name,r.queryParams={},r.saveView=function(){a.storeView(r.stateName,{gridParams:r.gridOptions.dataSource.transport.options.read.data(),queryParams:r.queryParams,data:r})},function(){if(a.view[r.stateName]){var t=a.view[r.stateName];t.gridParams&&(r.gridParams=t.gridParams),t.data&&(r.model=t.data.model),t.queryParams&&(r.queryParams=t.queryParams),e.personMainTasksGrid(r),a.view[r.stateName]=void 0}else e.personMainTasksGrid(r)}(),r.querySign=function(){r.gridOptions.dataSource._skip=0,r.gridOptions.dataSource.read()},r.resetForm=function(){r.model={}},r.pauseProject=function(t){o.findPausingProject(r,t)},r.startProject=function(t){common.confirm({vm:r,title:"",msg:"确认激活吗？",fn:function(){$(".confirmDialog").modal("hide"),i.activeFlow(r,t)}})}}angular.module("app").controller("adminPersonDoingCtrl",t),t.$inject=["$location","adminSvc","flowSvc","pauseProjectSvc","$state","$rootScope"]}(),function(){"use strict";function t(t,e,i,o,n,a,r,s){var l=this;l.title="项目查询统计",l.currentAssociateSign={},l.signList={},l.headerList={},l.header="",l.project={},l.headerType="项目类型",l.fileName="项目统计报表",l.signList=[],l.page=0,l.stateName=o.current.name,l.queryParams={},l.saveView=function(){r.storeView(l.stateName,{gridParams:l.signListOptions.dataSource.transport.options.read.data(),queryParams:l.queryParams,data:l})},function(){if(r.view[l.stateName]){var t=r.view[l.stateName];t.gridParams&&(l.gridParams=t.gridParams),t.data&&(l.project=t.data.project),t.queryParams&&(l.queryParams=t.queryParams),e.getSignList(l),r.view[l.stateName]=void 0}else e.getSignList(l);e.initSignList(function(t){(t.flag||"ok"==t.reCode)&&(l.orgDeptList=t.reObj)})}(),l.formReset=function(){l.project={}},l.searchSignList=function(){if(l.signListOptions.dataSource._skip=0,l.signListOptions.dataSource.read(),l.filters=l.project,l.filters&&void 0!=l.filters){var t=JSON.stringify(l.filters);l.filters=t.substring(1,t.length-1)}l.signList=[],l.page=0},l.statistical=function(){},l.excelExport=function(){for(var e=[],i=0;i<l.signList.length;i++)e.push(l.signList[i].signid);var o=e.join(",");t.excelExport(o)},l.ProjectStopInfo=function(t){o.go("projectStopInfo",{signId:t})},l.statistics=function(){e.QueryStatistics(l,function(t){void 0!=t&&t.forEach(function(t,e){l.signList.push(t)}),l.isContinue&&void 0!=t&&0!=t.length&&(l.page++,l.statistics())})},l.QueryStatistics=function(){l.isContinue=!0,l.filters&&void 0!=l.filters||(l.filters=""),l.statistics(),$("#queryStatisticsWindow").kendoWindow({width:"80%",height:"700px",title:"项目查询统计",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"],open:function(){l.countDay=function(){var e=$("#countSignDayTable input[name='sumSignDay']:checked");if(l.averageDay=0,0==e.length)i.alert("请选择要统计的数据");else{for(var o=[],n=e.length,a=0;a<n;a++)o.push(e[a].id);t.sumExistDays(o.join(","),function(t){t.flag||"ok"==t.reCode?(l.averageDay=(Number(t.reObj)/n).toFixed(2),l.isopens=!0,l.isDay=!0):i.alert(t.reMsg)})}},l.countWork=function(){var t=$("#countSignDayTable input[name='sumSignDay']:checked");if(l.averageDay=0,0==t.length)i.alert("请选择要统计的数据");else{for(var e=0,o=t.length,n=0;n<o;n++)e+=Number(t[n].value);l.averageDay=(e/o).toFixed(2),l.isopens=!0,l.isDay=!1}}},close:function(){l.isContinue=!1,l.signList=[],l.page=0}}).data("kendoWindow").center().open()},l.selectHeader=function(){n.selectHeaderWindow(l,l.headerType)},l.signDetails=function(t,n){l.saveView(),e.signDetails(t,function(e){e.flag?o.go("signDetails",{signid:t},{processInstanceId:n}):i.alert(e.reMsg)})}}angular.module("app").controller("adminSignListCtrl",t),t.$inject=["signSvc","adminSvc","bsWin","$state","headerSvc","pauseProjectSvc","$rootScope","$scope"]}(),function(){"use strict";function t(t,e,i){function o(t,i){var o={method:"post",url:rootPath+"/signView/findSecretProPermission",params:{signId:t}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:e,httpOptions:o,success:n})}function n(t,e,i){var e=escape(encodeURIComponent(e));window.open(rootPath+"/signView/excelExport?filterData="+i+"&fileName="+e)}function a(t){var i={method:"post",url:rootPath+"/admin/initWelComePage"},o=function(e){void 0!=t&&"function"==typeof t&&t(e.data)};common.http({$http:e,httpOptions:i,success:o})}function r(t){var i={method:"get",url:rootPath+"/workday/countWorkday"},o=function(t){};common.http({vm:t,$http:e,httpOptions:i,success:o})}function s(t){var i={method:"get",url:rootPath+"/file/findByBusinessId",params:{businessId:t.anId}},o=function(e){t.file=e.data};common.http({vm:t,$http:e,httpOptions:i,success:o})}function l(t,e){window.open(rootPath+"/file/fileDownload?sysfileId="+e)}function c(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/flow/html/tasks",$("#searchform"),t.gridParams),schema:{data:"value",total:function(t){return t.count?$("#DO_SIGN_COUNT").html(t.count):$("#DO_SIGN_COUNT").html(0),t.count},model:{id:"id",fields:{createdDate:{type:"date"}}}},serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:t.queryParams.pageSize||10,page:t.queryParams.page||1,sort:{field:"createdDate",dir:"desc"}}),i=[{field:"",title:"",width:30,template:function(t){switch(t.lightState){case"4":return $("#span1").html();case"8":return $("#span5").html();case"7":return $("#span4").html();case"6":return $("#span3").html();case"5":return $("#span2").html();case"1":case"2":case"3":default:return""}}},{field:"",title:"序号",width:50,template:function(t){return t.signprocessState&&t.signprocessState>=6&&t.signprocessState<=7?"<span class='row-number label label-primary'></span>":t.signprocessState&&9==t.signprocessState?"<span class='row-number label label-success'></span>":"<span class='row-number'></span>"}},{field:"",title:"项目名称",filterable:!1,width:200,template:function(t){return d(t)?'<a ng-click="vm.saveView()" href="#/signFlowDetail/'+t.businessKey+"/"+t.taskId+"/"+t.processInstanceId+'" >'+t.projectName+"</a>":'<a ng-click="vm.saveView()" href="#/signFlowDeal/'+t.businessKey+"/"+t.taskId+"/"+t.processInstanceId+'" >'+t.projectName+"</a>"}},{field:"reviewStage",title:"项目阶段",filterable:!1,width:100},{field:"nodeNameValue",title:"当前环节",width:100,filterable:!1},{field:"",title:"合并评审",width:140,filterable:!1,template:function(t){return t.reviewType?9==t.reviewType||"9"==t.reviewType?"合并评审[主项目]":"合并评审[次项目]":"否"}},{field:"",title:"合并项目",width:180,filterable:!1,template:function(t){if(t.reviewSignDtoList){var e="";return angular.forEach(t.reviewSignDtoList,function(t,i,o){i>0&&(e+=","),e+='<a href="#/signDetails/'+t.signid+"/"+t.processInstanceId+'" >'+t.projectname+"</a>"}),e}return""}},{field:"preSignDate",title:"预签收时间",width:100,filterable:!1,format:"{0: yyyy-MM-dd}"},{field:"signDate",title:"签收时间",width:100,filterable:!1,format:"{0: yyyy-MM-dd}"},{field:"",title:"剩余工作日",width:100,filterable:!1,template:function(t){return void 0!=t.surplusDays?t.surplusDays:""}},{field:"displayName",title:"处理人",width:120,filterable:!1},{field:"",title:"状态",width:80,filterable:!1,template:function(t){return t.processState&&2==t.processState?'<span style="color:orange;">已暂停</span>':'<span style="color:green;">进行中</span>'}},{field:"",title:"操作",width:80,template:function(t){return d(t)?common.format($("#detailBtns").html(),"signFlowDetail",t.businessKey,t.taskId,t.processInstanceId):common.format($("#columnBtns").html(),"signFlowDeal",t.businessKey,t.taskId,t.processInstanceId)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,pageable:common.kendoGridConfig(t.queryParams).pageable,dataBound:common.kendoGridConfig(t.queryParams).dataBound}}function d(t){var e=2==t.processState;return e||!t.reviewType||0!=t.reviewType&&"0"!=t.reviewType||"SIGN_BMLD_SPW1"!=t.nodeDefineKey&&"SIGN_FGLD_SPW1"!=t.nodeDefineKey||(e=!0),e}function u(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/flow/html/endTasks"),schema:{data:"value",total:function(t){return t.count},model:{id:"id",fields:{createdDate:{type:"date"}}}},serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{field:"",title:"序号",template:"<span class='row-number'></span>",width:50},{field:"projectname",title:"项目名称",filterable:!1,width:180},{field:"builtcompanyname",title:"建设单位",width:150,filterable:!1},{field:"reviewstage",title:"评审阶段",width:80,filterable:!1},{field:"signdate",title:"签收日期",width:100,filterable:!1,format:"{0: yyyy-MM-dd}"},{field:"reviewdays",title:"评审天数",width:150,filterable:!1},{field:"",title:"操作",width:100,template:function(t){return common.format($("#columnBtns").html(),t.isAppraising,t.signid,"endSignDetail",t.signid,t.processInstanceId,t.mUserName)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,dataBound:function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})}}}function m(t){var e=common.kendoGridDataSource(rootPath+"/flow/html/doingtasks",$("#searchform"),t.queryParams.page,t.queryParams.pageSize,t.gridParams),i=[{field:"",title:"",width:30,template:function(t){switch(t.lightState){case"4":return $("#span1").html();case"8":return $("#span5").html();case"7":return $("#span4").html();case"6":return $("#span3").html();case"5":return $("#span2").html();case"1":case"2":case"3":default:return""}}},{field:"",title:"序号",template:"<span class='row-number'></span>",width:50},{field:"",title:"项目名称",filterable:!1,width:"18%",template:function(t){return'<a ng-click="vm.saveView()" href="#/signFlowDetail/'+t.businessKey+"/"+t.taskId+"/"+t.processInstanceId+'" >'+t.projectName+"</a>"}},{field:"reviewStage",title:"项目阶段",filterable:!1,width:"10%"},{field:"nodeNameValue",title:"当前环节",width:"10%",filterable:!1},{field:"preSignDate",title:"预签收时间",width:"10%",filterable:!1,format:"{0: yyyy-MM-dd}"},{field:"signDate",title:"签收时间",width:"10%",filterable:!1,format:"{0: yyyy-MM-dd}"},{field:"",title:"剩余工作日",width:"10%",filterable:!1,template:function(t){return void 0!=t.surplusDays?t.surplusDays:""}},{field:"displayName",title:"处理人",width:"10%",filterable:!1},{field:"",title:"流程状态",width:"10%",filterable:!1,template:function(t){return t.processState&&2==t.processState?'<span style="color:orange;">已暂停</span>':'<span style="color:green;">进行中</span>'}},{field:"",title:"操作",width:"10%",template:function(t){return common.format($("#columnBtns").html(),"signFlowDetail",t.businessKey,t.taskId,t.processInstanceId)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig(t.queryParams).pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,dataBound:common.kendoGridConfig(t.queryParams).dataBound}}function p(t){var e=common.kendoGridDataSource(rootPath+"/signView/getSignList?$orderby=receivedate",$("#searchform"),t.queryParams.page,t.queryParams.pageSize,t.gridParams),i=[{field:"",
title:"序号",template:"<span class='row-number text-center'></span>",width:50},{field:"",title:"项目名称",width:280,filterable:!1,template:function(t){return"秘密"==t.secrectlevel?t.processInstanceId?"<a ng-click=\"vm.signDetails('"+t.signid+"','"+t.processInstanceId+"')\" >"+t.projectname+"</a>":"<a ng-click=\"vm.signDetails('"+t.signid+"' , '')\" >"+t.projectname+"</a>":t.processInstanceId?'<a ng-click="vm.saveView()" href="#/signDetails/'+t.signid+"/"+t.processInstanceId+'" >'+t.projectname+"</a>":'<a ng-click="vm.saveView()" href="#/signDetails/'+t.signid+'/" >'+t.projectname+"</a>"}},{field:"reviewstage",title:"评审阶段",width:110,filterable:!1},{field:"signdate",title:"签收日期",width:100,filterable:!1,format:"{0:yyyy-MM-dd}"},{field:"dispatchDate",title:"发文日期",width:100,filterable:!1,format:"{0:yyyy-MM-dd}"},{field:"reviewdays",title:"评审天数",width:90,filterable:!1},{field:"",title:"剩余工作日",width:100,filterable:!1,template:function(t){return void 0!=t.surplusdays?t.surplusdays:""}},{field:"reviewOrgName",title:"评审部门",width:140,filterable:!1},{field:"allPriUser",title:"项目负责人",width:110,filterable:!1},{field:"ffilenum",title:"归档编号",width:125,filterable:!1},{field:"dfilenum",title:"文件字号",width:130,filterable:!1},{field:"appalyInvestment",title:"申报投资",width:100,filterable:!1},{field:"authorizeValue",title:"审定投资",width:100,filterable:!1},{field:"extraValue",title:"核减（增）",width:100,filterable:!1},{field:"extraRate",title:"核减率",width:100,filterable:!1},{field:"approveValue",title:"批复金额",width:140,filterable:!1},{field:"dispatchType",title:"发文类型",width:100,filterable:!1},{field:"fileDate",title:"归档日期",width:100,filterable:!1,format:"{0:yyyy-MM-dd}"},{field:"builtcompanyname",title:"建设单位",width:260,filterable:!1},{field:"isassistproc",title:"是否协审",width:80,filterable:!1,template:function(t){return 9==t.isassistproc?"是":"否"}},{field:"daysafterdispatch",title:"发文后工作日",width:120,filterable:!1},{field:"",title:"操作",width:90,filterable:!1,template:function(t){return"2"==t.signState?common.format($("#columnBtns").html(),"vm.ProjectStopInfo('"+t.signid+"')"):""}}];t.signListOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig(t.queryParams).pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,dataBound:common.kendoGridConfig(t.queryParams).dataBound}}function f(t){var i={method:"post",url:rootPath+"/sign/initSignList"},o=function(e){void 0!=t&&"function"==typeof t&&t(e.data)};common.http({$http:e,httpOptions:i,success:o})}function h(t){var e=common.kendoGridDataSource(rootPath+"/signView/html/personMainTasks?$orderby=signdate desc",$("#searchform"),t.queryParams.page,t.queryParams.pageSize,t.gridParams),i=[{field:"",title:"",width:30,template:function(t){switch(t.lightState){case"4":return $("#span1").html();case"8":return $("#span5").html();case"7":return $("#span4").html();case"6":return $("#span3").html();case"5":return $("#span2").html();case"1":case"2":case"3":default:return""}}},{field:"",title:"序号",width:50,template:function(t){return t.processState&&t.processState>=6&&t.processState<=7?"<span class='row-number label label-primary'></span>":t.processState&&9==t.processState?"<span class='row-number label label-success'></span>":"<span class='row-number'></span>"}},{field:"",title:"项目名称",width:160,filterable:!1,template:function(t){return t.processInstanceId?'<a ng-click="vm.saveView()" href="#/signDetails/'+t.signid+"/"+t.processInstanceId+'" >'+t.projectname+"</a>":'<a ng-click="vm.saveView()" href="#/signDetails/'+t.signid+'/" >'+t.projectname+"</a>"}},{field:"reviewstage",title:"评审阶段",width:100,filterable:!1},{field:"",title:"项目状态",width:80,filterable:!1,template:function(t){var e="";switch(t.signState){case"1":e="进行中";break;case"2":e="暂停";break;case"8":e="强制结束";break;case"9":e="已完成"}return e}},{field:"",title:"签收时间",width:100,filterable:!1,template:function(t){return t.signdate?new Date(t.signdate.CompatibleDate()).Format("yyyy-MM-dd"):""}},{field:"",title:"发文日期",width:100,filterable:!1,template:function(t){return t.dispatchDate?new Date(t.dispatchDate.CompatibleDate()).Format("yyyy-MM-dd"):""}},{field:"",title:"剩余工作日",width:100,filterable:!1,template:function(t){return void 0!=t.surplusdays?t.surplusdays:""}},{field:"builtcompanyname",title:"建设单位",width:150,filterable:!1},{field:"",title:"操作",width:140,template:function(t){var e=!1,i=!0,o=!1;return"2"==t.signState?e=!0:"1"==t.signState&&(o=!0),9==t.signState&&angular.isUndefined(t.isAppraising)&&(i=!1),common.format($("#columnBtns").html(),"signDetails",t.signid,t.processInstanceId,"vm.pauseProject('"+t.signid+"')",o,"vm.startProject('"+t.signid+"')",e,t.signid,i)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,pageable:common.kendoGridConfig(t.queryParams).pageable,dataBound:common.kendoGridConfig(t.queryParams).dataBound}}function g(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/flow/queryMyAgendaTask",$("#agendaTaskForm")),schema:{data:"value",total:function(t){return t.count?$("#DO_TASK_COUNT").html(t.count):$("#DO_TASK_COUNT").html(0),t.count},model:{id:"taskId"}},serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createTime",dir:"desc"}}),i=[{field:"",title:"序号",template:"<span class='row-number'></span>",width:50},{field:"",title:"任务名称",filterable:!1,width:"25%",template:function(t){return'<a href="#/flowDeal/'+t.businessKey+"/"+t.processKey+"/"+t.taskId+"/"+t.instanceId+'" >'+t.instanceName+"</a>"}},{field:"nodeNameValue",title:"当前环节",width:"15%",filterable:!1},{field:"displayName",title:"处理人",width:"15%",filterable:!1},{field:"processName",title:"流程类别",width:"15%",filterable:!1},{field:"",title:"流程状态",width:"10%",filterable:!1,template:function(t){return t.processState&&2==t.processState?'<span style="color:orange;">已暂停</span>':'<span style="color:green;">进行中</span>'}},{field:"",title:"操作",width:"15%",template:function(t){return common.format($("#columnBtns").html(),t.businessKey,t.processKey,t.taskId,t.instanceId)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,dataBound:function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})}}}function v(t){var e=common.kendoGridDataSource(rootPath+"/flow/queryAgendaTask?$orderby=createTime desc",$("#doingTaskForm"),t.queryParams.page,t.queryParams.pageSize,t.gridParams),i=[{field:"",title:"序号",template:"<span class='row-number'></span>",width:50},{field:"",title:"任务名称",filterable:!1,width:"30%",template:function(t){return'<a ng-click="vm.saveView()" href="#/flowDetail/'+t.businessKey+"/"+t.processKey+"/"+t.taskId+"/"+t.instanceId+'" >'+t.instanceName+"</a>"}},{field:"nodeNameValue",title:"当前环节",width:"20%",filterable:!1},{field:"displayName",title:"处理人",width:"15%",filterable:!1},{field:"processName",title:"流程类别",width:"25%",filterable:!1},{field:"",title:"流程状态",width:"10%",filterable:!1,template:function(t){return t.processState&&2==t.processState?'<span style="color:orange;">已暂停</span>':'<span style="color:green;">进行中</span>'}},{field:"",title:"操作",width:"10%",template:function(t){return common.format($("#columnBtns").html(),t.businessKey,t.processKey,t.taskId,t.instanceId)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,pageable:common.kendoGridConfig(t.queryParams).pageable,dataBound:common.kendoGridConfig(t.queryParams).dataBound}}function y(t){t.dataSource=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/signView/getSignList",$("#searchform")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!1,serverSorting:!0,serverFiltering:!0,sort:{field:"createdDate",dir:"desc"}})}function w(t){var i={method:"get",url:rootPath+"/flow/proc"},o=function(e){t.workName=e.data};common.http({vm:t,$http:e,httpOptions:i,success:o})}function b(t,i){var o={method:"post",url:rootPath+"/signView/QueryStatistics",params:{queryData:t.filters,page:t.page}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({vm:t,$http:e,httpOptions:o,success:n})}function S(t){var i={method:"post",url:rootPath+"/signView/dtasksSign"},o=function(e){void 0!=t&&"function"==typeof t&&t(e.data)};common.http({$http:e,httpOptions:i,success:o})}return{gtasksGrid:c,etasksGrid:u,dtasksGrid:m,doingTaskGrid:v,personMainTasksGrid:h,countWorakday:r,agendaTaskGrid:g,initFile:s,upload:l,getSignList:p,initSignList:f,initWelComePage:a,excelExport:n,statisticalGrid:y,workName:w,QueryStatistics:b,signDetails:o,countDtasks:S}}angular.module("app").factory("adminSvc",t),t.$inject=["$rootScope","$http","bsWin"]}(),function(){"use strict";function t(t,e){var i=this;i.title="主页",i.initHistogram=function(){var t=echarts.init(document.getElementById("histogram")),e={title:{text:"在办项目数量统计情况",subtext:"按评审阶段划分",x:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#283b56"}}},legend:{orient:"vertical",left:"left",data:i.capital},grid:{left:"13%",right:"10%",bottom:"10%",containLabel:!0},xAxis:{type:"category",name:"评审阶段",data:i.review,axisTick:{alignWithLabel:!0},axisLabel:{interval:0,rotate:35,margin:2,textStyle:{fontWeight:"bolder",color:"#295645"}}},yAxis:{type:"value",name:"数量",min:0},series:[{name:"数量",type:"bar",data:i.signNumber}],itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0,0,0,0.5)"}}};t.setOption(e)},function(){e.initWelComePage(function(t){t&&(t.proTaskList&&(i.tasksList=t.proTaskList),t.comTaskList&&(i.agendaTaskList=t.comTaskList),t.endTaskList&&(i.endTasksList=t.endTaskList),t.annountmentList&&(i.annountmentList=t.annountmentList))}),e.countDtasks(function(t){i.review=[],i.signNumber=[];for(var e=0;e<t.reObj.length;e++)t.reObj[e].REVIEWSTAGE&&(i.review.push(t.reObj[e].REVIEWSTAGE),i.signNumber.push(t.reObj[e].SIGNNUMBER));i.initHistogram()})}(),i.testAlert=function(){t.confirm({title:"询问提示",message:"该项目已经关联其他合并评审会关联，您确定要改为单个评审吗？",onOk:function(){alert("点击确认！")},onCancel:function(){alert("点击取消！")}})}}angular.module("app").controller("adminWelComeCtrl",t).filter("FormatStrDate",function(){return function(t){var e=new Date(t),i=e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1,o=e.getDate()<10?"0"+e.getDate():e.getDate();return e.getFullYear()+"/"+i+"/"+o}}),t.$inject=["bsWin","adminSvc"]}(),function(){"use strict";function t(t,e,i,o,n,a){var r=this;r.title="通知公告管理",r.stateName=e.current.name,r.queryParams={},r.saveView=function(){a.storeView(r.stateName,{gridParams:r.gridOptions.dataSource.transport.options.read.data(),queryParams:r.queryParams,data:r})},function(){if(a.view[r.stateName]){var t=a.view[r.stateName];t.gridParams&&(r.gridParams=t.gridParams),t.data&&(r.model=t.data.model),t.queryParams&&(r.queryParams=t.queryParams),o.grid(r),a.view[r.stateName]=void 0}else o.grid(r)}(),r.bathIssue=function(){o.updateIssueState(r,"9")},r.bathUnissue=function(){o.updateIssueState(r,"0")},r.del=function(t){i.confirm({title:"询问提示",message:"确认删除数据吗?",onOk:function(){o.deleteAnnountment(t,function(t){t.flag||"ok"==t.reCode?(r.gridOptions.dataSource.read(),i.alert("操作成功！")):i.alert(t.reMsg)})}})},r.dels=function(){var t=common.getKendoCheckId(".grid");0==t.length?i.alert("请选择要删除的记录"):i.confirm({title:"询问提示",message:"确认删除数据吗?",onOk:function(){for(var e=[],n=0;n<t.length;n++)e.push(t[n].value);var a=e.join(",");o.deleteAnnountment(a,function(t){t.flag||"ok"==t.reCode?i.alert("操作成功！",function(){r.gridOptions.dataSource.read()}):i.alert(t.reMsg)})}})},r.detail=function(t){t&&(r.saveView(),e.go("annountmentDetail",{id:t}))},r.queryAnnountment=function(){r.gridOptions.dataSource._skip="",r.gridOptions.dataSource.read()},r.resetAnnountment=function(){var t=$("#annountmentform").find("input,select");$.each(t,function(t,e){e.value=""})}}angular.module("app").controller("annountmentCtrl",t),t.$inject=["$location","$state","bsWin","annountmentSvc","sysfileSvc","$rootScope"]}(),function(){"use strict";function t(t,e,i){var o=this;o.title="通知公告详情页",o.annountment={},o.annountment.anId=e.params.id,function(){i.findDetailById(o,o.annountment.anId)}(),o.post=function(t){i.findDetailById(o,t)},o.next=function(t){i.findDetailById(o,t)},o.downloadSysFile=function(e){t.downloadFile(e)},o.alertwd=function(){$("section").addClass("cont-alert")},o.closed=function(){$("section").removeClass("cont-alert")},o.printNotice=function(){var t=getLodop(),e=rootPath+"/contents/shared/annountmentPrint.css",i="<link href="+e+" type='text/css' rel='stylesheet'>",o="<head>"+i+"</head><body>"+$("#annountment-body").html()+"</body>";t.PRINT_INIT(""),t.ADD_PRINT_HTML(10,20,"100%","100%",o),t.PREVIEW()}}angular.module("app").controller("annountmentDetailCtrl",t),t.$inject=["sysfileSvc","$state","annountmentSvc"]}(),function(){"use strict";function t(t,e,i,o,n){var a=this;a.title="通知公告编辑",a.annountment={},a.annountment.anId=t.params.id,a.editor=void 0,a.businessFlag={isInitFileOption:!1},a.initFileUpload=function(){a.annountment.anId||o.$watch("vm.annountment.anId",function(t,e){t&&t!=e&&!a.initUploadOptionSuccess&&a.initFileUpload()}),a.sysFile={businessId:a.annountment.anId,mainId:a.annountment.anId,mainType:"通知公告",sysBusiType:"",showBusiType:!1},i.initUploadOptions({inputId:"sysfileinput",vm:a,uploadSuccess:function(){i.findByBusinessId(a.annountment.anId,function(t){a.sysFilelists=t})}})},function(){a.isNeed="1",a.editor=new UE.ui.Editor,a.editor.render("editor"),a.annountment.anId?(a.isUpdate=!0,e.findAnnountmentById(a,function(t){a.annountment=t,a.initFileUpload(),a.editor.ready(function(){void 0!=a.annountment.anContent&&a.editor.setContent(a.annountment.anContent)})}),i.findByBusinessId(a.annountment.anId,function(t){a.sysFilelists=t})):a.initFileUpload()}(),a.create=function(){e.createAnnountment(a,function(e){e.flag||"ok"==e.reCode?n.alert("保存成功！",function(){t.go("annountmentEdit",{id:e.reObj.anId},{reload:!0})}):n.alert(e.reMsg)})},a.update=function(){e.updateAnnountment(a,function(t){a.isSubmit=!1,n.alert("操作成功！")})},a.startNewFlow=function(){n.confirm({title:"询问提示",message:"确认已经完成填写，并且发起流程么？",onOk:function(){a.annountment.anId?e.updateAnnountment(a,function(i){e.startFlow(a.annountment.anId,function(e){e.flag||"ok"==e.reCode?n.success("操作成功！",function(){t.go("annountment")}):n.error(e.reMsg)})}):e.createAnnountment(a,function(i){a.id=i.reObj.anId,e.startFlow(a.id,function(e){e.flag||"ok"==e.reCode?n.success("操作成功！",function(){t.go("annountment")}):n.error(e.reMsg)})})}})}}angular.module("app").controller("annountmentEditCtrl",t),t.$inject=["$state","annountmentSvc","sysfileSvc","$scope","bsWin"]}(),function(){"use strict";function t(t,e,i){function o(e){var i={method:"get",url:h+"/initAnOrg"},o=function(t){e.annountment.anOrg="",e.annountment.anOrg=t.data.substring(1,t.data.length-1)};common.http({vm:e,$http:t,httpOptions:i,success:o})}function n(e,i){var o={method:"post",url:h+"/findAnnountmentById",params:{anId:e.annountment.anId}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function a(e,i){if(e.annountment.anContent=e.editor.getContent(),common.initJqValidation(),$("#form").valid()){e.isSubmit=!0;var o={method:"post",url:rootPath+"/annountment",data:e.annountment},n=function(t){e.isSubmit=!1,void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n,onError:function(){e.isSubmit=!1}})}}function r(e,i){e.isSubmit=!0,e.annountment.anContent=e.editor.getContent();var o={method:"put",url:h,data:e.annountment},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n,onError:function(){e.isSubmit=!1}})}function s(e,i){var o={method:"delete",url:h,params:{anId:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function l(t){var e=common.kendoGridDataSource(rootPath+"/annountment/fingByCurUser",$("#annountmentform"),t.queryParams.page,t.queryParams.pageSize,t.gridParams),i=[{template:function(t){return t.processInstanceId?"":kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.anId)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"unitSort",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"anTitle",title:"标题",width:300,filterable:!1},{field:"",title:"是否审批",width:100,filterable:!1,template:function(t){return t.processInstanceId?"是":"否"}},{field:"",title:"审批结果",width:100,filterable:!1,template:function(t){return t.appoveStatus?"9"!=t.appoveStatus?"审批中":"9"==t.appoveStatus&&"9"==t.issue?"<span style='color: green'>审批通过</span>":"9"==t.appoveStatus&&"9"!=t.issue?"<span style='color: red'>审批不通过</span>":void 0:""}},{field:"issueDate",title:"发布时间",format:"{0:yyyy-MM-dd hh24:mm:ss}",width:160,filterable:!1},{field:"",title:"发布状态",width:100,template:function(t){return t.issue&&"9"==t.issue?"已发布":"未发布"}},{field:"",title:"操作",width:150,template:function(t){var e=!0,i=!0;return("9"==t.issue||t.processInstanceId)&&(e="0"==t.issue&&"9"==t.appoveStatus),t.processInstanceId&&(i="0"==t.issue&&"9"==t.appoveStatus),common.format($("#columnBtns").html(),"vm.detail('"+t.anId+"')",t.anId,i,"vm.del('"+t.anId+"')",e)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,pageable:common.kendoGridConfig(t.queryParams).pageable,dataBound:common.kendoGridConfig(t.queryParams).dataBound,columns:i,resizable:!0}}function c(i,o){var n=common.getKendoCheckId(".grid");if(0==n.length)e.alert("请选择要修改的数据");else{for(var a=[],r=0;r<n.length;r++)a.push(n[r].value);var s={method:"post",url:rootPath+"/annountment/updateIssueState",params:{ids:a.join(","),issueState:o}},l=function(t){i.isSubmit=!1,t.data.flag||"ok"==t.data.reCode?e.alert("操作成功！",function(){i.gridOptions.dataSource.read()}):e.alert(t.data.reMsg)};common.http({$http:t,httpOptions:s,success:l})}}function d(e,o){var n={method:"post",url:h+"/findAnnountmentById",params:{anId:o}},a=function(t){e.annountment=t.data,i.findByBusinessId(o,function(t){e.sysFilelists=t}),u(e,o),m(e,o)};common.http({vm:e,$http:t,httpOptions:n,success:a})}function u(e,i){var o={method:"get",url:rootPath+"/annountment/postArticle",params:{anId:i}},n=function(t){e.annountmentPost=t.data};common.http({vm:e,$http:t,httpOptions:o,success:n})}function m(e,i){var o={method:"get",url:rootPath+"/annountment/nextArticle",params:{anId:i}},n=function(t){e.annountmentNext=t.data};common.http({vm:e,$http:t,httpOptions:o,success:n})}function p(e,i){var o={method:"post",url:rootPath+"/annountment/startFlow",params:{id:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function f(t){t.annountment={},t.annountment.anId=t.businessKey,n(t,function(e){t.suppletter=e})}var h=rootPath+"/annountment";return{grid:l,createAnnountment:a,initAnOrg:o,findAnnountmentById:n,updateIssueState:c,updateAnnountment:r,deleteAnnountment:s,findDetailById:d,postArticle:u,nextArticle:m,startFlow:p,initFlowDeal:f}}angular.module("app").factory("annountmentSvc",t),t.$inject=["$http","bsWin","sysfileSvc"]}(),function(){"use strict";function t(t,e,i,o,n){var a=this;a.title="通知公告列表",a.stateName=e.current.name,a.queryParams={},a.saveView=function(){n.storeView(a.stateName,{gridParams:a.gridOptions.dataSource.transport.options.read.data(),queryParams:a.queryParams,data:a})},function(){if(n.view[a.stateName]){var t=n.view[a.stateName];t.gridParams&&(a.gridParams=t.gridParams),t.data&&(a.model=t.data.model),t.queryParams&&(a.queryParams=t.queryParams),o.grid(a),n.view[a.stateName]=void 0}else o.grid(a)}(),a.detail=function(t){t&&(a.saveView(),e.go("annountmentDetail",{id:t}))},a.findAnnountment=function(){a.gridOptions.dataSource._skip=0,a.gridOptions.dataSource.read()},a.resetAnnountment=function(){var t=$("#annountmentYetform").find("input,select");$.each(t,function(t,e){e.value=""})}}angular.module("app").controller("annountmentYetCtrl",t),t.$inject=["$location","$state","$http","annountmentYetSvc","$rootScope"]}(),function(){"use strict";function t(t){function e(t){var e=common.kendoGridDataSource(rootPath+"/annountment/findByIssue",$("#annountmentYetform"),t.queryParams.page,t.queryParams.pageSize,t.gridParams),i=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.anId)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"unitSort",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"anTitle",title:"标题",width:300,filterable:!1},{field:"issueDate",title:"发布时间",format:"{0:yyyy-MM-dd hh24:mm:ss}",width:160,filterable:!1},{field:"issueUser",title:"发布人",width:100,filterable:!1},{field:"",title:"操作",width:150,template:function(t){return common.format($("#columnBtns").html(),"vm.detail('"+t.anId+"')")}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,pageable:common.kendoGridConfig(t.queryParams).pageable,dataBound:common.kendoGridConfig(t.queryParams).dataBound,columns:i,resizable:!0}}return{grid:e}}angular.module("app").factory("annountmentYetSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e,i){var o=this;o.model={},o.title="项目档案借阅管理",o.id=i.params.id,function(){i.params.id&&t.initArchivesLibrary(i.params.id,function(t){o.model=t})}(),o.createLibrary=function(){common.initJqValidation(),$("form").valid()&&t.createArchivesLibrary(o.model,function(t){t.flag||"ok"==t.reCode?(o.model=t.reObj,e.alert("操作成功！")):e.error(t.reMsg)})},o.startFlow=function(){common.initJqValidation(),$("form").valid()&&t.createArchivesLibrary(o.model,function(n){n.flag||"ok"==n.reCode?(o.model=n.reObj,t.startFlow(o.model.id,function(t){t.flag||"ok"==t.reCode?e.alert("操作成功！",function(){i.go("archivesLibraryList")}):e.error(t.reMsg)})):e.error(n.reMsg)})},o.del=function(e){common.confirm({vm:o,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteArchivesLibrary(o,e)}})},o.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)common.alert({vm:o,msg:"请选择数据"});else{for(var e=[],i=0;i<t.length;i++)e.push(t[i].value);var n=e.join(",");o.del(n)}}}angular.module("app").controller("archivesLibraryCtrl",t),t.$inject=["archivesLibrarySvc","bsWin","$state"]}(),function(){"use strict";function t(t,e,i,o){var n=this;n.title="档案借阅管理",function(){e.grid(n)}(),n.search=function(){n.gridOptions.dataSource._skip=0,n.gridOptions.dataSource.read()},n.formReset=function(){$("#searchform")[0].reset()}}angular.module("app").controller("archivesLibraryListCtrl",t),t.$inject=["$location","archivesLibrarySvc","$state","bsWin"]}(),function(){"use strict";function t(t,e){function i(e,i){var o={method:"post",url:rootPath+"/archivesLibrary/findById",params:{id:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function o(e,i){var o={method:"post",url:rootPath+"/archivesLibrary/startFlow",params:{id:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function n(t){i(t.businessKey,function(e){t.model=e})}function a(e){var i={method:"get",url:rootPath+"/archivesLibrary/findByArchivesUser"},o=function(t){e.userlist=t.data};common.http({vm:e,$http:t,httpOptions:i,success:o})}function r(e,i){var o={method:"post",url:d+"/saveCity",data:e},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function s(e,i){e.isSubmit=!0;var o={method:"delete",url:d,data:i},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",closeDialog:!0,fn:function(){e.isSubmit=!1,e.gridOptions.dataSource.read()}})}})};common.http({vm:e,$http:t,httpOptions:o,success:n})}function l(e,i){var o={method:"post",url:d+"/savaLibrary",data:e},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function c(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/archivesLibrary/findByOData",$("#searchform")),schema:{data:"value",total:function(t){return t.count},model:{id:"id",fields:{createdDate:{type:"date"},modifiedDate:{type:"date"}}}},serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"readCompany",title:"项目单位",width:140,filterable:!1},{field:"readProjectName",title:"查阅项目",width:140,filterable:!1},{field:"readUsername",title:"借阅人",width:100,filterable:!1},{field:"readArchivesCode",title:"归档编号",width:100,filterable:!1},{field:"readDate",title:"借阅时间",width:100,filterable:!1},{field:"",title:"操作",width:100,template:function(t){return common.format($("#columnBtns").html(),"archivesLibraryView/"+t.id)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})},resizable:!0}}var d=rootPath+"/archivesLibrary";return{initArchivesLibrary:i,startFlow:o,initFlowDeal:n,grid:c,createArchivesLibrary:l,createCityLibrary:r,getArchivesUserName:a,deleteArchivesLibrary:s}}angular.module("app").factory("archivesLibrarySvc",t),t.$inject=["$http","bsWin"]}(),function(){"use strict";function t(t,e,i){var o=this;o.model={},o.title="项目档案借阅查看详情",o.id=i.params.id,function(){o.id&&t.initArchivesLibrary(o.id,function(t){o.model=t})}()}angular.module("app").controller("archivesLibraryViewCtrl",t),t.$inject=["archivesLibrarySvc","bsWin","$state"]}(),function(){"use strict";function t(t,e,i,o,n,a){var r=this;r.model={},r.filterModel={},r.filterLow={},r.title="协审计划管理",r.splitNumArr=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],r.plan={},r.plan.assistType="独立项目",r.planList=[],r.assistSign=[],r.pickSign=[],r.pickMainSign=[],r.lowerSign=[],r.showPlanId="",r.assistPlan={};var s=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"];r.refleshPageInfo=function(t){r.assistSign=[],i.initPlanPage(t,function(t){r.assistSign=t.signList,r.refleshPlanInfo(r.plan.id)})},r.refleshPlanInfo=function(t){i.findPlanSign(t,!1,r.isCommit,function(t){r.pickMainSign=[],r.lowerSign=[],r.plan=t.planDto,"合并项目"==r.plan.assistType?angular.forEach(r.plan.assistPlanSignDtoList,function(e,i){"9"!=e.isMain&&9!=e.isMain||angular.forEach(t.signList,function(t,i){e.signId==t.signid?r.pickMainSign.push(t):r.lowerSign.push(t)})}):r.pickMainSign=t.signList})},function(){i.initPlanPage(!1,function(t){t.signList&&t.signList.length>0&&(r.assistSign=t.signList),t.planList&&t.planList.length>0&&(r.planList=t.planList)}),i.initPlanGrid(r),$("#planInfo li").click(function(t){var e=$("a",this);t.preventDefault(),e.tab("show");var i=e.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500)})}(),r.filterSign=function(t){var e=!0;if(!angular.isUndefined(t)&&(angular.isUndefined(r.filterModel.filterFilecode)||(t.projectcode?-1==t.filecode.indexOf(r.filterModel.filterFilecode)&&(e=!1):e=!1),e&&(angular.isUndefined(r.filterModel.filterProjectCode)||(t.projectcode?-1==t.projectcode.indexOf(r.filterModel.filterProjectCode)&&(e=!1):e=!1)),e&&(angular.isUndefined(r.filterModel.filterProjectName)||(t.projectname?-1==t.projectname.indexOf(r.filterModel.filterProjectName)&&(e=!1):e=!1)),e&&(angular.isUndefined(r.filterModel.filterBuiltName)||(angular.isUndefined(t.builtcompanyName)&&(e=!1),e&&-1==t.builtcompanyName.indexOf(r.filterModel.filterBuiltName)&&(e=!1))),e))return t},r.filterLowSign=function(t){var e=!0;if(!angular.isUndefined(t)&&(angular.isUndefined(r.filterLow.filterFilecode)||(t.filecode?-1==t.filecode.indexOf(r.filterLow.filterFilecode)&&(e=!1):e=!1),e&&(angular.isUndefined(r.filterLow.filterProjectCode)||(t.projectcode?-1==t.projectcode.indexOf(r.filterLow.filterProjectCode)&&(e=!1):e=!1)),e&&(angular.isUndefined(r.filterLow.filterProjectName)||(t.projectname?-1==t.projectname.indexOf(r.filterLow.filterProjectName)&&(e=!1):e=!1)),e&&(angular.isUndefined(r.filterLow.filterBuiltName)||(angular.isUndefined(t.builtcompanyName)&&(e=!1),e&&-1==t.builtcompanyName.indexOf(r.filterLow.filterBuiltName)&&(e=!1))),e))return t},r.initSplit=function(t){r.plan.assistType==t&&(angular.isUndefined(r.plan.spliNum)||(r.plan.spliNum=0))},r.affirmSign=function(){var t=$("input[name='selASTSign']:checked");if(t.length<1)n.alert("请选择要挑选的项目");else if(t.length>1)"合并项目"==r.plan.assistType?n.alert("合并项目要先挑选一个主项目，再挑选次项目！"):n.alert("独立项目，每次只能选择一个！");else{var e=t[0].value;r.plan.signId=e,i.saveAssistPlan(r.plan,r.isCommit,function(t){r.isCommit=!1,t.flag||"ok"==date.reCode?(r.plan.id||r.gridOptions.dataSource.read(),r.plan=t.reObj,i.initPlanPage(!0,function(t){t.signList&&t.signList.length>0&&(r.assistSign=t.signList)}),r.planList.push(r.plan),r.showPickLowSign(r.plan.id)):n.alert(t.reMsg)})}},r.cancelSign=function(){var t=$("input[name='checkASTSign']:checked");t.length<1?n.alert("请选择取消的项目"):n.confirm({title:"询问提示",message:"确认取消挑选项目吗?",onOk:function(){for(var e=[],o=0;o<t.length;o++)e.push(t[o].value);i.cancelPlanSign(r,e.join(","),function(t){r.isCommit=!1,r.refleshPageInfo(!0),n.alert("操作成功！")})}})},r.initSelPlan=function(){r.pickMainSign=[],r.lowerSign=[],r.showPlanId?i.findPlanSign(r.showPlanId,!1,r.isCommit,function(t){r.plan=t.planDto,r.refleshPlanInfo(r.showPlanId)}):r.plan={}},r.doDelete=function(){r.plan.id?n.confirm({title:"询问提示",message:"确认删除吗？删除数据不可恢复，请慎重！",onOk:function(){i.deletePlan(r.plan.id,r.isCommit,function(t){r.planList=[],i.initPlanPage(!1,function(t){t.signList&&t.signList.length>0&&(r.assistSign=t.signList),t.planList&&t.planList.length>0&&(r.planList=t.planList)}),r.isCommit=!1,r.pickMainSign=[],r.lowerSign=[],r.plan={},r.gridOptions.dataSource.read(),n.alert("操作成功！")})}}):n.alert("请选择要删除的协审计划包")},r.showPickLowSign=function(t){i.findPlanSign(t,!1,r.isCommit,function(t){r.pickMainSign=[],r.lowerSign=[],r.plan=t.planDto,"合并项目"==r.plan.assistType?(angular.forEach(r.plan.assistPlanSignDtoList,function(e,i){"9"!=e.isMain&&9!=e.isMain||angular.forEach(t.signList,function(t,i){e.signId==t.signid?r.pickMainSign.push(t):r.lowerSign.push(t)})}),$("#lowerSignWin").kendoWindow({width:"1024px",height:"600px",title:"次项目信息",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()):r.pickMainSign=t.signList})},r.affirmLowerSign=function(){var t=$("input[name='selLowSign']:checked");if(t.length<1)n.alert("请选择要挑选的次项目!");else{for(var e=[],o=0;o<t.length;o++)e.push(t[o].value);i.saveLowPlanSign(r,e,function(t){r.isCommit=!1,n.alert("操作成功！"),r.refleshPageInfo(!0)})}},r.cancelLowerSign=function(){var t=$("input[name='checkLowSign']:checked");if(t.length<1)n.alert("请选择要挑选的次项目");else{for(var e=[],o=0;o<t.length;o++)e.push(t[o].value);i.cancelLowPlanSign(r,e.join(","),function(){r.isCommit=!1,
n.alert("操作成功！"),r.refleshPageInfo(!0)})}},r.queryPlan=function(){i.queryPlan(r)},r.showPlanDetail=function(t){r.assistPlan={},r.unitList=[],r.assistPlanSign=[],i.initPlanByPlanId(t,function(e){r.assistPlan=e,i.findPlanSign(t,!0,r.isCommit,function(t){t.signList&&t.signList.length>0&&angular.forEach(r.assistPlan.assistPlanSignDtoList,function(e,i){angular.forEach(t.signList,function(t,i){t.signid==e.signId&&(e.projectName=t.projectname,e.estimateCost=t.declaration)})}),$("#planInfo").kendoWindow({width:"80%",height:"600px",title:"协审项目清单",visible:!1,modal:!0,open:function(){r.drawTimeDay="",r.drawTimeStart="",r.drawTimeEnd=""},closable:!0,actions:["Minimize","Maximize","Close"]}).data("kendoWindow").center().open()})})},r.ministerOpinionEdit=function(t){angular.isObject(t)||(t={}),a.initIdeaData(r,t)},r.viceDirectorOpinionEdit=function(t){angular.isObject(t)||(t={}),a.initIdeaData(r,t)},r.directorOpinionEdit=function(t){angular.isObject(t)||(t={}),a.initIdeaData(r,t)},r.savePlanSign=function(){r.assistPlan.ministerOpinion=$("#ministerOpinion").val(),r.assistPlan.viceDirectorOpinion=$("#viceDirectorOpinion").val(),r.assistPlan.directorOpinion=$("#directorOpinion").val();var t=angular.copy(r.assistPlan);i.savePlan(t,function(t){t.flag||"ok"==t.reCode?n.alert("操作成功！"):n.alert(t.reMsg)})},r.chooseAssistUnit=function(){r.number=void 0==r.assistPlan.assistPlanSignDtoList?0:r.assistPlan.assistPlanSignDtoList.length,"1"==r.assistPlan.drawType&&(r.number=r.number+1),i.chooseAssistUnit(r.assistPlan.id,r.number,r.assistPlan.drawType,function(t){console.log(t),t.flag||"ok"==t.reCode?r.assistPlan.assistUnitDtoList=t.reObj:n.alert(t.reMsg)})},r.againChooleAssistUnit=function(){r.allUnitList&&0!=r.allUnitList.length?$("#againChooleAssistUnit").kendoWindow({title:"选择参加协审单位",width:"820px",height:"560px",visible:!1,modal:!0,closable:!0,actions:["Minimize","Maximize","Close"]}).data("kendoWindow").center().open():i.getAllUnit(function(t){r.allUnitList=t,$("#againChooleAssistUnit").kendoWindow({title:"选择参加协审单位",width:"820px",height:"560px",visible:!1,modal:!0,closable:!0,actions:["Minimize","Maximize","Close"]}).data("kendoWindow").center().open()})},r.saveAddChooleUnit=function(t){var e=r.assistPlan.assistPlanSignDtoList.length;"1"==r.assistPlan.drawType&&(e+=1),r.assistPlan.assistUnitDtoList.length<e?i.saveAddChooleUnit(r,t,function(t){t.flag||"ok"==t.reCode?(r.assistPlan.assistUnitDtoList.push(t.reObj),n.alert("操作成功！")):n.alert(t.reMsg)}):n.alert("当前只能"+e+"家单位参与抽签")},r.drawAssistUnit=function(){var t=0;if(r.assistPlan.assistPlanSignDtoList&&r.assistPlan.assistPlanSignDtoList.length>0)if(t=r.assistPlan.assistPlanSignDtoList.length,angular.forEach(r.assistPlan.assistPlanSignDtoList,function(t,e){t.assistUnit=null}),r.assistPlan.assistUnitDtoList&&0!=r.assistPlan.assistUnitDtoList.length){var e=r.assistPlan.assistUnitDtoList.length;if(r.drawAssistUnits=angular.copy(r.assistPlan.assistUnitDtoList),"1"==r.assistPlan.drawType?e>t:e>=t){for(var i=0,a=-1,s=0;s<e;s++)if("9"==r.assistPlan.assistUnitDtoList[s].isLastUnSelected){var l=Math.floor(Math.random()*e);a=l,r.assistPlan.assistPlanSignDtoList[l].assistUnit=r.drawAssistUnits[s],r.drawPlanSign=r.assistPlan.assistPlanSignDtoList[l],r.drawAssistUnits.splice(s,1)}var c=0;r.isStartDraw=!0,r.isDrawDone=!1,r.t=o(function(){r.drawPlanSign=r.assistPlan.assistPlanSignDtoList[i];var n=Math.floor(Math.random()*e),s=r.drawAssistUnits[n];r.showAssitUnitName=s.unitName,++c%5==0&&(i!=a?r.assistPlan.assistPlanSignDtoList[i].assistUnit=s:i!=t-1&&(r.assistPlan.assistPlanSignDtoList[++i].assistUnit=s),i++,i==a&&a==t-1&&(o.cancel(r.t),r.isDrawDone=!0),i==t&&(o.cancel(r.t),r.isDrawDone=!0),r.drawAssistUnits.forEach(function(t,e){t.id==s.id&&r.drawAssistUnits.splice(e,1)}))},200)}else n.alert("当前协审单位少于协审项目数，不能抽签！请先到项目计划表中选择参加的协审单位后再进行抽签！")}else n.alert("还没有设置协审单位，无法进行抽签！");else n.alert("没有协审项目，不能进行抽签！")},r.saveDrawAssistUnit=function(){i.saveDrawAssistUnit(r,function(t){t.flag||"ok"==t.reCode?n.alert("操作成功"):n.alert(t.reMsg)})},r.buildDrawTime=function(){var t=!1,e=!1,i=new Date(r.drawTimeDay),o=i.getDay(),n=i.Format("yyyy年MM月dd日")+"("+s[o]+")";if(r.drawTimeStart){t=!0;var a=r.drawTimeStart.split(":")[0];a>12?n+="下午":(e=!0,n+="上午"),n+=r.drawTimeStart}if(r.drawTimeEnd){var a=r.drawTimeEnd.split(":")[0];t&&(n+="至"),a>12?!e&&t||(n+="下午"):e&&t||(n+="上午"),n+=r.drawTimeEnd}r.assistPlan.drawTime=n},r.buildApprovalTime=function(){var t=!1,e=!1,i=new Date(r.approvalTimeDay),o=i.getDay(),n=i.Format("yyyy年MM月dd日")+"("+s[o]+")";if(r.approvalStart){t=!0;var a=r.approvalStart.split(":")[0];a>12?n+="下午":(e=!0,n+="上午"),n+=r.approvalStart}if(r.approvalTimeEnd){var a=r.approvalTimeEnd.split(":")[0];t&&(n+="至"),a>12?!e&&t||(n+="下午"):e&&t||(n+="上午"),n+=r.approvalTimeEnd}r.assistPlan.approvalTime=n}}angular.module("app").controller("assistPlanCtrl",t),t.$inject=["$location","$state","assistSvc","$interval","bsWin","ideaSvc"]}(),function(){"use strict";function t(t,e,i,o){var n=this;n.title="协审单位",n.model={},n.resource={},n.stateName=i.current.name,n.queryParams={},n.saveView=function(){o.storeView(n.stateName,{gridParams:n.gridOptions.dataSource.transport.options.read.data(),queryParams:n.queryParams,data:n})},function(){if(o.view[n.stateName]){var t=o.view[n.stateName];t.gridParams&&(n.gridParams=t.gridParams),t.data&&(n.model=t.data.model),t.queryParams&&(n.queryParams=t.queryParams),e.grid(n),o.view[n.stateName]=void 0}else e.grid(n)}(),n.del=function(t){n.id=t,common.confirm({vm:n,title:"",msg:"确认要删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),n.resource={},e.deleteAssistUnit(n,t)}})},n.dels=function(){var t=common.getKendoCheckId(".grid");0==t.length?common.alert({vm:n,msg:"请选择数据"}):common.confirm({vm:n,title:"",msg:"确认要删除数据吗？",fn:function(){$(".confirmDialog").modal("hide");for(var i=[],o=0;o<t.length;o++)i.push(t[o].value);var a=i.join(",");e.deleteAssistUnit(n,a)}})},n.queryAssistUnit=function(){e.queryAssistUnit(n)}}angular.module("app").controller("assistUnitCtrl",t),t.$inject=["$location","assistUnitSvc","$state","$rootScope"]}(),function(){"use strict";function t(t,e,i){function o(e){if(common.initJqValidation(),$("form").valid()&&0==e.isUnitExist){var i={method:"post",url:c,data:e.assistUnit},o=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=d}})}})};common.http({vm:e,$http:t,httpOptions:i,success:o})}}function n(o,n){o.isSubmint=!0;var a={method:"delete",url:c,data:n},r=function(t){common.requestSuccess({vm:o,response:t,fn:function(){i.alert("操作成功",function(){e.go("assistUnit")})}})};common.http({vm:o,$http:t,httpOptions:a,success:r})}function a(o){if(common.initJqValidation(),$("form").valid()&&0==o.isUnitExist){var n={method:"put",url:c,headers:{contentType:"application/json;charset=utf-8"},dataType:"json",data:angular.toJson(o.assistUnit)},a=function(t){common.requestSuccess({vm:o,response:t,fn:function(){i.alert("操作成功",function(){e.go("assistUnit")})}})};common.http({vm:o,$http:t,httpOptions:n,success:a})}}function r(e){var i={method:"get",url:c+"/getAssistUnitById",params:{id:e.id}},o=function(t){e.assistUnit=t.data};common.http({vm:e,$http:t,httpOptions:i,success:o})}function s(t){t.gridOptions.dataSource._skip="",t.gridOptions.dataSource.read()}function l(t){var e=common.kendoGridDataSource(c+"/fingByOData?$orderby=unitSort",$("#assistUnitform"),t.queryParams.page,t.queryParams.pageSize,t.gridParams),i=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"unitSort",title:"序号",width:50,filterable:!1},{field:"unitName",title:"单位名称",width:"20%",filterable:!1},{field:"unitShortName",title:"简称",width:"8%",filterable:!1},{field:"principalName",title:"负责人",width:"8%",filterable:!1},{field:"principalPhone",title:"负责人电话",width:"10%",filterable:!1},{field:"contactName",title:"联系人",width:"8%",filterable:!1},{field:"contactTell",title:"联系人电话",width:"10%",filterable:!1},{field:"address",title:"企业地址",width:"20%",filterable:!0},{field:"isUse",title:"状态",width:"5%",filterable:!1,template:function(t){return t.isUse?"0"==t.isUse?"已停用":"1"==t.isUse?"在用":void 0:""}},{field:"",title:"操作",width:"8%",template:function(t){return common.format($("#columnBtns").html(),"vm.del('"+t.id+"')",t.id,t.isUse)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,pageable:common.kendoGridConfig(t.queryParams).pageable,resizable:!0}}var c=rootPath+"/assistUnit",d="#/assistUnit";return{grid:l,deleteAssistUnit:n,createAssistUnit:o,updateAssistUnit:a,getAssistUnitById:r,queryAssistUnit:s}}angular.module("app").factory("assistUnitSvc",t),t.$inject=["$http","$state","bsWin"]}(),function(){"use strict";function t(t,e,i){var o=this;o.title="新增协审单位",o.id=i.params.id,o.isUnitExist=!1,o.id&&(o.isUpdate=!0,o.title="更新协审单位"),o.create=function(){e.createAssistUnit(o)},o.update=function(){e.updateAssistUnit(o)},function(){o.isUpdate&&e.getAssistUnitById(o)}()}angular.module("app").controller("assistUnitEditCtrl",t),t.$inject=["$location","assistUnitSvc","$state"]}(),function(){"use strict";function t(t,e){function i(e,i){var o={method:"post",url:rootPath+"/assistPlanSign/findAssistPlanSignById",params:{signId:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function o(){return[{field:"rowNumber",title:"序号",width:50,template:"<span class='row-number'></span>",filterable:!1},{field:"planName",title:"协审计划名称",width:"15%",filterable:!1},{field:"reportTime",title:"报审时间",width:"15%",filterable:!1,format:"{0: yyyy-MM-dd}"},{field:"drawTime",title:"抽签时间",width:"25%",filterable:!1},{field:"createdBy",title:"创建人员",width:"15%",filterable:!1},{field:"createdDate",title:"记录生成时间",width:"15%",filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"",title:"操作",width:"10%",filterable:!1,template:function(t){return'<button class="btn btn-xs btn-primary"  ng-click="vm.showPlanDetail(\''+t.id+'\')"><span class="glyphicon glyphicon-edit"></span>详情</button>'}}]}function n(t){var e=common.kendoGridDataSource(rootPath+"/assistPlan/findByOData",$("#searchform")),i=function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})};t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o(),dataBound:i,resizable:!0}}function a(e,i){var o={method:"post",url:rootPath+"/assistPlan/initPlanManager",params:{isOnlySign:1==e?"9":"0"}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function r(e,i,o){i=!0;var n={method:"post",url:rootPath+"/assistPlan",data:e},a=function(t){i=!1,void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:t,httpOptions:n,success:a,onError:function(){i=!1}})}function s(e,i,o){i=!0;var n={method:"delete",url:rootPath+"/assistPlan",params:{id:e}},a=function(t){i=!1,void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:t,httpOptions:n,success:a,onError:function(){i=!1}})}function l(e,i,o,n){o=!0;var a={method:"post",url:rootPath+"/sign/findByPlanId",params:{planId:e,isOnlySign:1==i?"9":"0"}},r=function(t){void 0!=n&&"function"==typeof n&&n(t.data)};common.http({$http:t,httpOptions:a,success:r,onError:function(){o=!1}})}function c(e,i,o){var n={method:"delete",url:rootPath+"/assistPlan/cancelPlanSign",params:{planId:e.plan.id,signIds:i}},a=function(t){e.isCommit=!1,void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:t,httpOptions:n,success:a,onError:function(){e.isCommit=!1}})}function d(e,i,o){var n=new Array;e.assistSign.forEach(function(t,e){for(var o=0,a=i.length;o<a;o++)if(t.signid==i[o]){var r={};r.signId=t.signid,r.projectName=t.projectname,r.assistType="合并项目",r.isMain="0",n.push(r)}}),e.plan.assistPlanSignDtoList=n,e.isCommit=!0;var a={method:"post",url:rootPath+"/assistPlan/saveLowPlanSign",data:e.plan},r=function(t){e.isCommit=!1,void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:t,httpOptions:a,success:r,onError:function(){e.isCommit=!1}})}function u(e,i,o){e.isCommit=!0;var n={method:"delete",url:rootPath+"/assistPlan/cancelLowPlanSign",params:{planId:e.plan.id,signIds:i}},a=function(t){e.isCommit=!1,void 0!=o&&"function"==typeof o&&o(t.data)};common.http({vm:e,$http:t,httpOptions:n,success:a,onError:function(){e.isCommit=!1}})}function m(t){t.gridOptions.dataSource._skip="",t.gridOptions.dataSource.read()}function p(e,i){var o={method:"post",url:rootPath+"/assistPlanSign/getPlanSignByPlanId",params:{planId:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function f(e,i){var o={method:"put",url:rootPath+"/assistPlanSign/savePlanSign",headers:{contentType:"application/json;charset=utf-8"},dataType:"json",data:angular.toJson(e)},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({vm:vm,$http:t,httpOptions:o,success:n})}function h(e,i){var o={method:"post",url:rootPath+"/assistPlan/savePlanAndSign",data:e},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function g(e,i){var o={method:"post",url:rootPath+"/assistPlan/findById",params:{id:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function v(e,i,o,n){var a={method:"post",url:rootPath+"/assistUnit/chooseAssistUnit",params:{planId:e,number:i,drawType:o}},r=function(t){void 0!=n&&"function"==typeof n&&n(t.data)};common.http({$http:t,httpOptions:a,success:r})}function y(e){var i={method:"post",url:rootPath+"/assistUnitUser/findByOData"},o=function(t){e.unitUserList=t.data.value};common.http({vm:e,$http:t,httpOptions:i,success:o})}function w(e){var i={method:"post",url:rootPath+"/assistUnit/fingByOData"},o=function(t){void 0!=e&&"function"==typeof e&&e(t.data)};common.http({$http:t,httpOptions:i,success:o})}function b(e,i){var o="";e.assistPlan.assistPlanSignDtoList.forEach(function(t,e){e>0&&(o+=","),o+=t.id+"|"+t.assistUnit.id});var n="";e.drawAssistUnits.length>0&&e.drawAssistUnits.forEach(function(t,e){e>0&&(n+=","),n+=t.id}),e.isCommit=!0;var a={method:"post",url:rootPath+"/assistPlan/saveDrawAssistUnit",params:{planId:e.assistPlan.id,drawAssitUnitIds:o,unSelectedIds:n}},r=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:a,success:r,onError:function(t){e.isCommit=!1}})}function S(i,o,n){var a=!0;if(angular.forEach(i.assistPlan.assistUnitDtoList,function(t,i){if(o.id==t.id)return a=!1,void e.alert("该协审单位已被选中！")}),a){var r={method:"post",url:rootPath+"/assistPlan/saveChooleUnit",params:{planId:i.assistPlan.id,unitId:o.id}},s=function(t){void 0!=n&&"function"==typeof n&&n(t.data)};common.http({$http:t,httpOptions:r,success:s})}}function k(e,i){var o={method:"post",url:rootPath+"/assistPlan/initAssistUnit",params:{planId:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}return{initPlanPage:a,initPlanGrid:n,saveAssistPlan:r,deletePlan:s,findPlanSign:l,cancelPlanSign:c,saveLowPlanSign:d,cancelLowPlanSign:u,queryPlan:m,getPlanSignByPlanId:p,savePlanSign:f,savePlan:h,initPlanByPlanId:g,chooseAssistUnit:v,saveDrawAssistUnit:b,getUnitUser:y,getAllUnit:w,saveAddChooleUnit:S,initAssistUnitByPlanId:k,findAssistPlanSignById:i}}angular.module("app").factory("assistSvc",t),t.$inject=["$http","bsWin"]}(),function(){"use strict";function t(t,e,i){var o=this;o.title="借书列表",o.model={},o.searchModel={},function(){e.bookBorrowGrid(o,function(t){o.bookBorrowDetailList=t.reObj.bookBorrowDetailList,o.bookBorrowSumDtoList=t.reObj.bookBorrowSumDtoList})}(),o.searchForm=function(){e.bookBorrowGrid(o,function(t){o.bookBorrowDetailList=t.reObj.bookBorrowDetailList,o.bookBorrowSumDtoList=t.reObj.bookBorrowSumDtoList})},o.formReset=function(){o.searchModel={}},o.returnBook=function(t,e,i,n,a,r){o.model.id=t,o.model.bookNo=e,o.model.booksName=i,o.model.borrowNum=a,o.model.bookBorrower=n,o.model.returnDate=void 0!=r?new Date(r).Format("yyyy-MM-dd"):"",o.model.returnBorrower=$("#curName").val(),$("#returnBookWindow").kendoWindow({width:"38%",height:"300px",title:"图书借还",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},o.saveReturnBookDetail=function(){e.saveReturnBookDetail(o,function(t){t.flag||"ok"==t.reCode?i.alert("保存成功！",function(){window.parent.$("#returnBookWindow").data("kendoWindow").close(),$state.go("bookBorrowList")}):i.alert(t.reMsg)})},o.returnBookList=function(){window.parent.$("#returnBookWindow").data("kendoWindow").close(),$state.go("bookBorrowList")},o.comparisonStill=function(){o.model.returnNum>o.model.borrowNum&&(o.model.returnNum=o.model.borrowNum),o.model.returnNum<0&&(o.model.returnNum=0)}}angular.module("app").controller("bookBorrowCtrl",t),t.$inject=["$location","bookBuySvc","bsWin"]}(),function(){"use strict";function t(t,e,i,o){var n=this;n.title="图书查询",n.model={},n.del=function(t){common.confirm({vm:n,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),e.deleteBookBuy(n,t)}})},n.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)common.alert({vm:n,msg:"请选择数据"});else{for(var e=[],i=0;i<t.length;i++)e.push(t[i].value);var o=e.join(",");n.del(o)}},function(){e.grid(n)}(),n.searchForm=function(){n.gridOptions.dataSource._skip=0,n.gridOptions.dataSource.read()},n.formReset=function(){n.searchModel={}},n.borrowBook=function(t){e.queryBookBuyById(t,function(t){n.model=t,n.model.bookBorrower=$("#curName").val()}),console.log(n.model.bookBorrower),$("#borrowBookWindow").kendoWindow({width:"860px",height:"300px",title:"图书借阅",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},n.saveBooksDetail=function(){console.log(n.model),n.model.borrowNum&&0!=n.model.borrowNum?n.model.borrowDate?n.model.returnDate?e.saveBorrowBookDetail(n,function(t){t.flag||"ok"==t.reCode?o.alert("保存成功！",function(){window.parent.$("#borrowBookWindow").data("kendoWindow").close(),n.searchForm()}):o.alert(t.reMsg)}):o.alert("请填写还书日期！"):o.alert("请填写借书日期！"):o.alert("请填写借书数量！")},n.returnBookList=function(){window.parent.$("#borrowBookWindow").data("kendoWindow").close(),n.searchForm()},n.comparisonSize=function(){n.model.borrowNum>n.model.storeConfirm&&(n.model.borrowNum=n.model.storeConfirm),n.model.borrowNum<0&&(n.model.borrowNum=0)}}angular.module("app").controller("bookBuyCtrl",t),t.$inject=["$location","bookBuySvc","$state","bsWin"]}(),function(){"use strict";function t(t,e,i){var o=this;o.title="添加图书管理信息",o.isuserExist=!1,o.id=i.params.id,o.id&&(o.isUpdate=!0,o.title="更新图书管理信息"),o.create=function(){e.createBookBuy(o)},o.update=function(){e.updateBookBuy(o)},function(){o.isUpdate&&e.getBookBuyById(o)}()}angular.module("app").controller("bookBuyEditCtrl",t),t.$inject=["$location","bookBuySvc","$state"]}(),function(){"use strict";function t(t){function e(e,i){var o={method:"post",url:rootPath+"/bookBuy/saveBorrowDetail",data:e.model},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function i(e,i){var o={method:"post",url:rootPath+"/bookBuy/saveReturnDetail",data:e.model},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function o(e){if(common.initJqValidation(),$("form").valid()){e.isSubmit=!0,e.model.id=e.id;var i={method:"put",url:d,data:e.model},o=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:e,$http:t,httpOptions:i,success:o})}}function n(e,i){e.isSubmit=!0;var o={method:"delete",url:d,data:i},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",closeDialog:!0,fn:function(){e.isSubmit=!1,e.gridOptions.dataSource.read()}})}})};common.http({vm:e,$http:t,httpOptions:o,success:n})}function a(e){if(common.initJqValidation(),$("form").valid()){e.isSubmit=!0;var i={method:"post",url:d,data:e.model},o=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",closeDialog:!0,fn:function(){e.isSubmit=!1,location.href=u}})}})};common.http({vm:e,$http:t,httpOptions:i,success:o})}}function r(e){var i={method:"get",url:rootPath+"/bookBuy/html/findById",params:{id:e.id}},o=function(t){e.model=t.data};common.http({vm:e,$http:t,httpOptions:i,success:o})}function s(e,i){var o={method:"get",url:rootPath+"/bookBuy/html/findById",params:{id:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function l(e,i){var o={method:"post",url:rootPath+"/bookBorrow/expertCostDetailTotal",data:e.searchModel},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function c(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/bookBuy/findByOData",$("#bookForm")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})},o=[{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"bookNo",title:"图书号",width:100,filterable:!1},{field:"booksName",title:"图书名称",width:100,filterable:!1},{field:"booksType",title:"图书分类",width:100,filterable:!1},{field:"booksPrice",title:"价格",width:100,filterable:!1},{field:"bookNumber",title:"数量",width:100,filterable:!1},{field:"",title:"库存",width:100,attributes:{style:"color:red"},filterable:!1,template:function(t){return t.storeConfirm?t.storeConfirm:0}},{field:"storeTime",title:"入库时间",width:100,filterable:!1},{field:"",title:"操作",width:140,template:function(t){return t.storeConfirm&&t.storeConfirm>0?common.format($("#columnBtns").html(),t.id):""}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,resizable:!0,dataBound:i}}var d=rootPath+"/bookBuy",u="#/bookBuyList";return{grid:c,bookBorrowGrid:l,getBookBuyById:r,queryBookBuyById:s,createBookBuy:a,deleteBookBuy:n,updateBookBuy:o,saveBorrowBookDetail:e,saveReturnBookDetail:i}}angular.module("app").factory("bookBuySvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e){var i=this;i.title="图书采购流程查询",i.del=function(t){common.confirm({vm:i,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),e.deleteBookBuyBusiness(i,t)}})},i.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)common.alert({vm:i,msg:"请选择数据"});else{for(var e=[],o=0;o<t.length;o++)e.push(t[o].value);var n=e.join(",");i.del(n)}},function(){e.grid(i)}(),i.searchForm=function(){i.gridOptions.dataSource._skip=0,i.gridOptions.dataSource.read()},i.formReset=function(){i.searchModel={}}}angular.module("app").controller("bookBuyBusinessCtrl",t),t.$inject=["$location","bookBuyBusinessSvc"]}(),function(){"use strict";function t(t,e,i){var o=this;o.model={},o.businessId=i.params.businessId,o.viewDetail=i.params.viewDetail,o.showGoBack=!0,function(){t.getBookBuyBusinessById(o,function(t){if(o.model=t,o.model.bookBuyList)for(var e=0;e<o.model.bookBuyList.length;e++)o.model.bookBuyList[e].totalPrice=parseFloat(o.model.bookBuyList[e].booksPrice)*o.model.bookBuyList[e].bookNumber})}()}angular.module("app").controller("bookBuyBusinessDetailCtrl",t),t.$inject=["bookBuyBusinessSvc","bsWin","$state"]}(),function(){"use strict";function t(t,e,i,o){function n(){var t=$("#buyChannel").val();if(""==t||"undefined"===t)return o.error("购买渠道没有填写，请选择后再进行保存！"),!1;if(common.initJqValidation($("#bookForm")),$("#bookForm").valid()){if(r.conditions.length>0){var e=!0;return r.conditions.forEach(function(t,i){t.booksName=$("#booksName"+t.sort).val(),t.booksType=$("#booksType"+t.sort).val(),t.publishingCompany=$("#publishingCompany"+t.sort).val(),t.bookNo=$("#bookNo"+t.sort).val(),""!=t.bookNo&&"undefined"!==t.bookNo||(o.error("图书号不能为空请核查！"),e=!1),t.author=$("#author"+t.sort).val(),t.bookNumber=$("#bookNumber"+t.sort).val(),""!=t.bookNumber&&"undefined"!==t.bookNumber||(o.error("图书数量不能为空请核查！"),e=!1),a(t.bookNumber)||(o.error("图书数量只能输入正整数请核查！"),e=!1),t.storeConfirm=$("#storeConfirm"+t.sort).val(),t.booksPrice=$("#booksPrice"+t.sort).val(),/^(-)?(([1-9]{1}\d*)|([0]{1}))(\.(\d){1,4})?$/.test(t.booksPrice)||(o.error("价格只能输入数字请核查！"),e=!1),t.applyDept=r.model.applyDept,t.operator=r.model.operator,t.buyChannel=r.model.buyChannel,t.businessId=$("#businessId").val(),t.businessName=r.model.businessName,t.applyReason=r.model.applyReason}),e}return o.error("没有分录数据，无法保存！"),!1}o.alert("操作失败，有红色*号的选项为必填项，请按要求填写！")}function a(t){return!!(/^(\+|-)?\d+$/.test(t)&&t>0)}var r=this;r.model={},r.conMaxIndex=0,r.conditions=new Array,r.title="图书信息录入",r.isuserExist=!1,r.businessId=i.params.businessId,r.viewDetail=i.params.viewDetail,r.showFlag={addBooksDeatail:!0,modBooksDetail:!0,bookBuyApplyTr:!1,bookBuyBzTr:!0,bookBuyFgzrTr:!0,bookBuyZrTr:!0,bookBuyYsrk:!0,buyChannel:!1,isCommit:!1},r.businessId?(r.isUpdate=!0,r.showFlag.modBooksDetail=!0,r.showFlag.addBooksDeatail=!1,$("#businessId").val(r.businessId)):(r.showFlag.modBooksDetail=!1,r.showFlag.addBooksDeatail=!0),"1"==r.viewDetail&&(r.showFlag.bookBuyYsrk=!0,r.showFlag.addBooksDeatail=!0,r.showFlag.modBooksDetail=!0,r.showFlag.bookBuyZrTr=!0,r.showFlag.bookBuyFgzrTr=!0,r.showFlag.bookBuyBzTr=!0,r.showFlag.bookBuyApplyTr=!0,r.showFlag.buyChannel=!0,r.showFlag.isCommit=!0),r.create=function(){e.createBookBuyBusiness(r)},r.update=function(){e.updateBookBuyBusiness(r)},r.addCondition=function(){r.condition={},r.showFlag.addBooksDeatail?r.condition.sort=r.conMaxIndex+1:(r.conMaxIndex=r.conditions.length,r.condition.sort=r.conditions.length+1),r.conditions.push(r.condition),r.conMaxIndex++},r.removeCondition=function(){var t=$("#conditionTable input[name='bookInfos']:checked");t.length>0?o.confirm({title:"询问提示",message:"删除数据不可恢复，确定删除么？",onOk:function(){$(".confirmDialog").modal("hide");for(var i=[],n=0;n<t.length;n++)for(var a=0;a<r.conditions.length;a++){var s=r.conditions[a];if(t[n].value==s.sort){if(!s.id){r.conditions.splice(a,1),$("#conTr"+s.sort).remove();break}i.push(s.id)}}i.length>0&&e.deleteBooksConditions(i.join(","),function(t){if(t.flag||"ok"==t.reCode){o.success("操作成功！");for(var e=0;e<i.length;e++)for(var n=0;n<r.conditions.length;n++){var a=r.conditions[n];if(i[e]==a.sort){r.conditions.splice(n,1),$("#conTr"+a.sort).remove();break}}}else o.error(t.reMsg)})}}):o.alert("请选择要删除的图书信息！")},r.saveCondition=function(){n()&&e.saveBookBuyBusinessDetail(r.conditions,function(t){t.flag||"ok"==t.reCode?($("#businessId").val(t.reObj.businessId),o.success("保存成功！")):o.error(t.reMsg)})},r.startFlow=function(){o.confirm({title:"询问提示",message:"发起流程后，当前页面数据将不能再修改！确认发起流程么？",onOk:function(){n()?e.startFlow(r.conditions,r.showFlag.isCommit,function(t){t.flag||"ok"==t.reCode?o.alert("保存成功！",function(){i.go("myBookBuyBusiness")}):o.alert(t.reMsg)}):o.error("没有分录数据，无法发起流程！")}})},r.checkBookNum=function(t){var e="bookNumber"+t;if(!a($("#"+e).val()))return void $("span[data-valmsg-for='"+e+"']").html("图书数量只能输入正整数！");$("span[data-valmsg-for='"+e+"']").html("")},r.checkPrice=function(t){var e=/^(-)?(([1-9]{1}\d*)|([0]{1}))(\.(\d){1,4})?$/,i="booksPrice"+t,o="bookNumber"+t;if(!e.test($("#"+i).val()))return $("#"+i).val(""),void $("span[data-valmsg-for='"+i+"']").html("价格只能输入数字！");$("span[data-valmsg-for='"+i+"']").html("");var n=$("#"+i).val(),a=$("#"+o).val();$("#total"+t).val(parseFloat(n)*a)},function(){r.isUpdate&&e.getBookBuyBusinessById(r,function(t){r.model=t,r.conditions=r.model.bookBuyList;for(var e=0;e<r.conditions.length;e++)r.conditions[e].sort=e+1,r.conditions[e].total=parseFloat(r.conditions[e].booksPrice)*r.conditions[e].bookNumber})}()}angular.module("app").controller("bookBuyBusinessEditCtrl",t),t.$inject=["$location","bookBuyBusinessSvc","$state","bsWin"]}(),function(){"use strict";function t(t){function e(e,i){var o={method:"delete",url:d+"/bookDel",params:{ids:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function i(e){if(common.initJqValidation(),$("form").valid()){e.isSubmit=!0,e.model.id=e.id;var i={method:"put",url:d,data:e.model},o=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:e,$http:t,httpOptions:i,success:o})}}function o(e,i){e.isSubmit=!0;var o={method:"delete",url:d,data:i},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",closeDialog:!0,fn:function(){e.isSubmit=!1,e.gridOptions.dataSource.read()}})}})};common.http({vm:e,$http:t,httpOptions:o,success:n})}function n(e){common.initJqValidation();$("form").valid();{e.isSubmit=!0;var i={method:"post",url:d,data:e.model},o=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",closeDialog:!0,fn:function(){e.isSubmit=!1,location.href=u}})}})};common.http({vm:e,$http:t,httpOptions:i,success:o})}}function a(e,i){var o={method:"post",url:rootPath+"/bookBuyBusiness/saveBooksDetailList",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(e)},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function r(e,i,o){i=!0;var n={method:"post",url:rootPath+"/bookBuyBusiness/startFlow",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(e)},a=function(t){i=!1,void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:t,httpOptions:n,success:a,onError:function(){i=!1}})}function s(e){var i={method:"get",url:rootPath+"/bookBuyBusiness/html/findById",params:{id:e.businessKey}},o=function(t){e.model=t.data;for(var i=0;i<e.model.bookBuyList.length;i++)e.model.bookBuyList[i].totalPrice=parseFloat(e.model.bookBuyList[i].booksPrice)*e.model.bookBuyList[i].bookNumber};common.http({$http:t,httpOptions:i,success:o,onError:function(){}})}function l(e,i){var o={method:"get",url:rootPath+"/bookBuyBusiness/html/findById",params:{id:e.businessId}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({vm:e,$http:t,httpOptions:o,success:n})}function c(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/bookBuyBusiness/findByOData",$("#bookBuyForm"),{filter:"createdBy eq ${CURRENT_USER.id}"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})},o=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"applyDept",
title:"申请部门",width:"20%",filterable:!1},{field:"operator",title:"申请人",width:"10%",filterable:!1},{field:"buyChannel",title:"购买渠道",width:"15%",filterable:!1},{field:"applyDate",title:"申请日期",width:"15%",filterable:!1},{field:"",title:"状态",width:"15%",filterable:!1,template:function(t){return t.processInstanceId&&t.filer?"已办理":t.processInstanceId?"正在办理":"未确定申购"}},{field:"",title:"操作",width:140,template:function(t){var e=!!t.processInstanceId;return common.format($("#columnBtns").html(),t.businessId,e)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}var d=rootPath+"/bookBuyBusiness",u="#/bookBuyBusinessList";return{grid:c,getBookBuyBusinessById:l,createBookBuyBusiness:n,deleteBookBuyBusiness:o,updateBookBuyBusiness:i,saveBookBuyBusinessDetail:a,startFlow:r,initFlowDeal:s,deleteBooksConditions:e}}angular.module("app").factory("bookBuyBusinessSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(){return{success:function(t,e){return this.alert({message:t,type:"success",onClose:e,icon:1})},warning:function(t,e){return this.alert({message:t,type:"warning",onClose:e,icon:5})},error:function(t,e){return this.alert({message:t,type:"error",onClose:e,icon:2})},alert:function(t,e,i){if(!angular.isObject(t)){var o;!e||angular.isFunction(e)?(i=e,e=t):o=t,t={message:e,onClose:i||function(){}},o&&(t.title=o)}t.onClose=t.onClose||function(){},layer.alert(t.message,{title:t.title?t.title:"系统消息",icon:t.icon?t.icon:6,skin:"layui-layer-lan"},function(e){layer.close(e),t.onClose()})},confirm:function(t,e,i,o,n){if(!angular.isObject(t)){var a;!e||angular.isFunction(e)?(n=o||function(){},o=i||function(){},i=e||function(){},e=t):a=t,t={message:e,onOk:i,onClose:o,onCancel:n},a&&(t.title=a)}t.onClose=t.onClose||function(){},layer.confirm(t.message,{title:t.title?t.title:"询问提示",icon:3,skin:"layui-layer-lan",btn:["确认","取消"],end:t.onClose},function(e){layer.close(e),void 0!=t.onOk&&"function"==typeof t.onOk&&t.onOk()},function(e){layer.close(e),void 0!=t.onCancel&&"function"==typeof t.onCancel&&t.onCancel()})}}}angular.module("app");angular.module("app").factory("bsWin",t)}(),function(){"use strict";function t(t,e,i){var o=new Blob([t],{type:"application/"+i}),n=URL.createObjectURL(o),a=$("<a><span class='forExcel'>下载</span></a>").attr("href",n).attr("download",e);$("body").append(a),$(".forExcel").click(),a.remove()}function e(t){t?(t.removeData("validator"),t.removeData("unobtrusiveValidation"),$.validator.unobtrusive.parse(t)):($("form").removeData("validator"),$("form").removeData("unobtrusiveValidation"),$.validator.unobtrusive.parse("form"))}function i(t){var e=function(e){b.alert({vm:t.vm,msg:e,fn:function(){t.vm.isSubmit=!1,$(".alertDialog").modal("hide")}})};if(t.response.status>400)e("发生错误！");else{var i=t.response.data;i&&555==i.reCode?e(i.message):t.fn&&t.fn(i)}}function o(){for(var t=arguments[0],e=1;e<arguments.length;e++){var i=new RegExp("\\{"+(e-1)+"\\}","gm");t=t.replace(i,arguments[e])}return t}function n(t){var e=t.toString().replace(/[^0-9]/g,"");return parseInt(e,10)}function a(t){return isNaN(parseFloat(t,10))?0:parseFloat(t,10)}function r(){return $(window).height()-180}function s(t){t.vm.alertDialogMessage=t.msg,t.vm.alertDialogFn=function(){t.closeDialog&&1==t.closeDialog&&($(".alertDialog").modal("hide"),$(".modal-backdrop").remove()),t.fn?t.fn():$(".alertDialog").modal("hide")},$(".alertDialog").modal({backdrop:"static",keyboard:!1})}function l(t){t.vm.dialogConfirmTitle=t.title,t.vm.dialogConfirmMessage=t.msg,$(".confirmDialog").modal({backdrop:"static"}),t.vm.dialogConfirmSubmit=t.fn,t.cancel?t.vm.dialogConfirmCancel=t.cancel:t.vm.dialogConfirmCancel=function(){$(".confirmDialog").modal("hide")}}function c(t,e){null==e&&(e=""),t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+t+"=([^&#]*)"),o=i.exec(window.location.href);return null==o?e:o[1]}function d(t,e,i,o,n){return new kendo.data.DataSource({type:"odata",transport:u().transport(t,e,n),schema:u().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:o||10,page:i||1,sort:{field:"createdDate",dir:"desc"}})}function u(t){return{filterable:{extra:!1,operators:{string:{contains:"包含",eq:"等于"},number:{eq:"等于",neq:"不等于",gt:"大于",lt:"小于"},date:{gt:"大于",lt:"小于"}}},pageable:{pageSize:10,previousNext:!0,buttonCount:5,refresh:!0,pageSizes:!0,change:function(){t&&t.page&&(t.page=this.dataSource.page())}},dataBound:function(e){var i=this.items(),o=this.pager.page()-1,n=this.pager.pageSize();$(i).each(function(){var t=$(this).index()+1+o*n,e=$(this).find(".row-number");$(e).html(t)}),t.pageSize=e.sender.dataSource.pageSize(),t.page=e.sender.dataSource.page()},schema:function(t){return{data:"value",total:function(t){return t.count},model:t}},transport:function(t,e,i){return{read:{url:t,dataType:"json",type:"post",cache:!1,beforeSend:function(t){t.setRequestHeader("Token",b.getToken())},data:function(){if(e){var t=common.buildOdataFilter(e);if(t){if(i&&i.$filter){var o=i.$filter;return i=void 0,{$filter:t+" and "+o}}return{$filter:t}}return i&&i.$filter?{$filter:i.$filter}:{}}return i||{}}}}},noRecordMessage:{template:"暂时没有数据."}}}function m(t){var e=$(t).find("tr td:nth-child(1)").find("input:checked"),i=[];return e.each(function(){var t=$(this).attr("relId");i.push({name:"id",value:t})}),i}function p(t){t.headers={Token:b.getToken()},t.$http(t.httpOptions).then(t.success,function(e){t.onError&&t.onError(e)})}function f(){return{get:function(t,e){var i=this.getAll(t);return i?i[e]:null},getAll:function(t){var e=encodeURIComponent(t)+"=",i=document.cookie.indexOf(e),o=null,n={};if(i>-1){var a=document.cookie.indexOf(";",i);if(-1==a&&(a=document.cookie.length),o=document.cookie.substring(i+e.length,a),o.length>0){for(var r=o.split("&"),s=0,l=r.length;s<l;s++){var c=r[s].split("=");n[decodeURIComponent(c[0])]=decodeURIComponent(c[1])}return n}}return null},set:function(t,e,i,o,n,a,r){var s=this.getAll(t)||{};s[e]=i,this.setAll(t,s,o,n,a,r)},setAll:function(t,e,i,o,n,a){var r=encodeURIComponent(t)+"=",s=new Array;for(var l in e)l.length>0&&e.hasOwnProperty(l)&&s.push(encodeURIComponent(l)+"="+encodeURIComponent(e[l]));s.length>0?(r+=s.join("&"),i instanceof Date&&(r+=";expires="+i.toGMTString()),o&&(r+=";path="+o),n&&(r+=";domain="+n),a&&(r+=";secure")):r+=";expires="+new Date(0).toGMTString(),document.cookie=r},unset:function(t,e,i,o,n){var a=this.getAll(t);a&&(delete a[e],this.setAll(t,a,null,i,o,n))},unsetAll:function(t,e,i,o){this.setAll(t,null,new Date(0),e,i,o)}}}function h(){var t=f().getAll("data");return null!=t?t.token:""}function g(t){return t.error=function(t){401==t.status&&(location.href=window.rootPath+"/home/login")},t}function v(t){var e=/^(?:checkbox|radio)$/i,i=/^(?:submit|button|image|reset|file)$/i,o=/^(?:input|select|textarea|keygen)/i;return $(t).map(function(){var t=jQuery.prop(this,"elements");return t?jQuery.makeArray(t):this}).filter(function(){var t=this.type;return this.value&&this.name&&!$(this).is(":disabled")&&o.test(this.nodeName)&&!i.test(t)&&(this.checked||!e.test(t))}).map(function(t,e){var i=$(this),o=i.val();if(!o)return!1;var n=i.attr("data-type")||"String";o="'"+o+"'","String"!=n&&(o=n+o);var a=i.attr("operator")||"eq",r=i.attr("data-role")||"";return"datepicker"==r?o="date"+o:"datetimepicker"==r&&(o="datetime"+o),"like"==a?"substringof("+o+", "+e.name+")":e.name+" "+a+" "+o}).get().join(" and ")}function y(t){t.$http({method:"get",url:rootPath+"/admin/myCountInfo"}).then(function(t){t.data.DO_SIGN_COUNT&&$("#DO_SIGN_COUNT").html(t.data.DO_SIGN_COUNT),t.data.DO_TASK_COUNT&&$("#DO_TASK_COUNT").html(t.data.DO_TASK_COUNT),t.data.GET_SIGN_COUNT&&$("#GET_SIGN_COUNT").html(t.data.GET_SIGN_COUNT),t.data.GET_RESERVESIGN_COUNT&&$("#GET_RESERVESIGN_COUNT").html(t.data.GET_RESERVESIGN_COUNT)})}function w(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}).toUpperCase()}var b={initJqValidation:e,requestSuccess:i,format:o,blockNonNumber:n,floatNumberInput:a,adminContentHeight:r,alert:s,confirm:l,getQuerystring:c,kendoGridConfig:u,getKendoCheckId:m,cookie:f,getToken:h,http:p,gridDataSource:g,buildOdataFilter:v,kendoGridDataSource:d,getTaskCount:y,uuid:w,downloadReport:t};window.common=b,function(){$(document).on("click","#checkboxAll",function(){var t=$(this).is(":checked");$(".grid").find("tr td:nth-child(1)").find('input:checkbox[ng-disabled!="true"]').prop("checked",t)})}()}(),function(){"use strict";function t(t,i){return{request:function(t){return t.headers.Token=common.getToken(),t.headers["X-Requested-With"]="XMLHttpRequest",t},responseError:function(o){return o.config.headers.commonHttp||e(i,o.status,o.data),t.reject(o)}}}function e(t,e,i){switch(e){case 500:t.error("系统内部错误!");break;case 401:t.warning("登录信息失效或您没有权限,请重新登录!",function(){window.location.href=rootPath+"/"});break;case 403:t.warning("您无权限执行此操作！");break;case 404:t.error("未找到相应的操作！");break;case 408:t.warning("请求超时");break;case 412:t.warning(i.message||"操作失败");break;case 499:t.warning(i.message||"您的账号已在别的地方登录，请确认密码是否被修改！");break;default:t.error("发生错误,系统已记录,我们会尽快处理！")}}var i=angular.module("app");i.factory("commonHttpInterceptor",["$injector","bsWin",t]),i.config(["$httpProvider",function(e){e.interceptors.push(t),e.defaults.headers.get||(e.defaults.headers.get={}),e.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",e.defaults.headers.get["Cache-Control"]="no-cache",e.defaults.headers.get.Pragma="no-cache"}]),jQuery&&jQuery(document).ajaxSend(function(t,e,i){e.setRequestHeader("Token",common.getToken())}).ajaxError(function(t,i,o,n){var a=angular.element("body"),r=a.scope(),s=a.injector().get("bsWin"),l=angular.isString(i.responseText)?JSON.parse(i.responseText||"{}"):i.responseText;r.$apply(function(){e(s,i.status,l||{})})})}(),function(){"use strict";function t(t,e){function i(i,o){i.ideaContent="",$("#ideaWindow").kendoWindow({width:"70%",height:"660px",title:"意见选择",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open(),i.ideas||t({method:"post",url:rootPath+"/idea/findMyIdea"}).then(function(t){i.ideas=t.data}),i.deleteCommonIdea=function(){var o=$("#commonIdeaTable input[type='checkbox']:checked");if(o.length<1)e.alert("请选择要删除的意见！");else{for(var n=[],a=0;a<o.length;a++)o[a].value&&n.push(o[a].value),$.each(i.ideas,function(t,e){t==o[a].name&&i.ideas.splice(t,1)});if(n.length>0){var r=n.join(",");t({method:"delete",url:rootPath+"/idea",params:{ideas:r}}).then(function(o){e.alert("删除成功！",function(){t({method:"post",url:rootPath+"/idea/findMyIdea"}).then(function(t){i.ideas=t.data})})})}}},i.addCorrentIdea=function(t){i.ideaContent+=t},i.addCommonIdea=function(){i.ideas||(i.ideas=[]),i.newIdea={},i.newIdea.ideaType="1",i.ideas.push(i.newIdea)},i.saveCommonIdea=function(){if(0==i.ideas.length)return void e.alert("请编辑你要保存的意见信息！");t({method:"post",url:rootPath+"/idea",headers:{contentType:"application/json;charset=utf-8"},dataType:"json",data:angular.toJson(i.ideas)}).then(function(t){t.data.flag||"ok"==t.data.reCode?(i.ideas=t.data.reObj,e.alert("添加成功！")):e.alert(t.data.reMsg)})},i.saveCurrentIdea=function(){var t=$("#"+o.targetId);t.val(t.val()+i.ideaContent),window.parent.$("#ideaWindow").data("kendoWindow").close(),t.focus()}}function o(e){var i={method:"post",url:rootPath+"/idea/findMyIdea"},o=function(t){e.ideas=t.data};common.http({$http:t,httpOptions:i,success:o})}return{initIdeaData:i,initIdea:o}}angular.module("app").factory("ideaSvc",t),t.$inject=["$http","bsWin"]}(),function(){"use strict";function t(t,e){var i=this;i.title="单位列表",i.del=function(t){common.confirm({vm:i,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),e.deletecompany(i,t)}})},i.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)common.alert({vm:i,msg:"请选择数据"});else{for(var e=[],o=0;o<t.length;o++)e.push(t[o].value);var n=e.join(",");i.del(n)}},i.queryConpany=function(){e.queryConpany(i)},function(){e.grid(i)}()}angular.module("app").controller("companyCtrl",t),t.$inject=["$location","companySvc"]}(),function(){"use strict";function t(t,e,i){var o=this;o.title="新增单位",o.iscompanyExist=!1,o.id=i.params.id,o.id&&(o.isUpdate=!0,o.title="更新单位"),o.create=function(){e.createcompany(o)},o.update=function(){e.updatecompany(o)},function(){o.isUpdate&&e.getcompanyById(o)}()}angular.module("app").controller("companyEditCtrl",t),t.$inject=["$location","companySvc","$state"]}(),function(){"use strict";function t(t,e){function i(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(c+"/fingByOData",$("#form")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})},o=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"coName",title:"单位名称",width:220,filterable:!1},{field:"coPhone",title:"单位电话",width:100,filterable:!1},{field:"coPC",title:"邮编",width:100,filterable:!1},{field:"coAddress",title:"地址",width:160,filterable:!1},{field:"coType",title:"单位类型",width:160,filterable:!1},{field:"",title:"操作",width:200,template:function(t){return common.format($("#columnBtns").html(),"vm.del('"+t.id+"')",t.id)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}function o(t){t.gridOptions.dataSource._skip=0,t.gridOptions.dataSource.read()}function n(e){if(common.initJqValidation(),$("form").valid()&&0==e.iscompanyExist){e.isSubmit=!0;var i={method:"post",url:c,data:e.model},o=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=d}})}})};common.http({vm:e,$http:t,httpOptions:i,success:o})}}function a(e){var i={method:"get",url:c+"/html/findByIdCompany",params:{id:e.id}},o=function(t){e.model=t.data,console.log(e.model)};common.http({vm:e,$http:t,httpOptions:i,success:o})}function r(e){if(common.initJqValidation(),$("form").valid()&&0==e.iscompanyExist){e.isSubmit=!0,e.model.id=e.id;var i={method:"put",url:c,data:e.model},o=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:e,$http:t,httpOptions:i,success:o})}}function s(e,i){e.isSubmit=!0;var o={method:"delete",url:c,data:i},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.isSubmit=!1,e.gridOptions.dataSource.read()}})};common.http({vm:e,$http:t,httpOptions:o,success:n})}function l(e,i){var o={method:"put",url:c+"/saveUnitScore",data:e},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}var c=rootPath+"/company",d="#/company";rootPath;return{grid:i,createcompany:n,getcompanyById:a,updatecompany:r,deletecompany:s,queryConpany:o,saveUnit:l}}angular.module("app").factory("companySvc",t),t.$inject=["$http","$compile"]}(),function(){"use strict";function t(t,e){var i=this;i.title="处室管理",i.del=function(t){common.confirm({vm:i,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),e.deleteDept(i,t)}})},i.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)common.alert({vm:i,msg:"请选择数据"});else{for(var e=[],o=0;o<t.length;o++)e.push(t[o].value);var n=e.join(",");i.del(n)}},i.queryDept=function(){e.queryDept(i)},function(){e.grid(i)}()}angular.module("app").controller("deptCtrl",t),t.$inject=["$location","deptSvc"]}(),function(){"use strict";function t(t,e,i){var o=this;o.title="编辑处室",o.isuserExist=!1,o.deptId=i.params.deptId,o.deptId&&(o.isUpdate=!0,o.title="更新处室"),o.create=function(){e.createDept(o)},o.update=function(){e.updateDept(o)},function(){o.isUpdate&&e.getDeptById(o)}()}angular.module("app").controller("deptEditCtrl",t),t.$inject=["$location","deptSvc","$state"]}(),function(){"use strict";function t(t){function e(t){t.gridOptions.dataSource._skip="",t.gridOptions.dataSource.read()}function i(e){if(common.initJqValidation(),$("form").valid()){e.isSubmit=!0;var i={method:"put",url:s,data:e.model},o=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",closeDialog:!0,fn:function(){e.isSubmit=!1}})}})};common.http({vm:e,$http:t,httpOptions:i,success:o})}}function o(e,i){e.isSubmit=!0;var o={method:"delete",url:s,data:i},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",closeDialog:!0,fn:function(){e.isSubmit=!1,e.gridOptions.dataSource.read()}})}})};common.http({vm:e,$http:t,httpOptions:o,success:n})}function n(e){if(common.initJqValidation(),$("form").valid()){e.isSubmit=!0;var i={method:"post",url:s,data:e.model},o=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",closeDialog:!0,fn:function(){e.isSubmit=!1,location.href=l}})}})};common.http({vm:e,$http:t,httpOptions:i,success:o})}}function a(e){var i={method:"get",url:rootPath+"/dept/html/findById",params:{deptId:e.deptId}},o=function(t){t.data.offices&&(e.offices={},e.offiecs=t.data.offices),e.model=t.data};common.http({vm:e,$http:t,httpOptions:i,success:o})}function r(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(s+"/fingByOData",$("#formDept")),schema:common.kendoGridConfig().schema({id:"deptId",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})},o=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.deptId)},filterable:!1,width:20,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:30,filterable:!1,template:"<span class='row-number'></span>"},{field:"deptName",title:"处室名称",width:100,filterable:!1},{field:"deptUserName",title:"联系人",width:100,filterable:!1},{field:"address",title:"地址",width:100,filterable:!1},{field:"deptType",title:"类型",width:100,filterable:!1},{field:"",title:"状态",width:100,filterable:!1,template:function(t){return t.status?5==t.status?"正常":7==t.status?"已删除":void 0:" "}},{field:"",title:"操作",width:140,template:function(t){return common.format($("#columnBtns").html(),"vm.del('"+t.deptId+"')",t.deptId,t.deptId)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}var s=rootPath+"/dept",l="#/listDept";return{grid:r,getDeptById:a,createDept:n,deleteDept:o,updateDept:i,queryDept:e}}angular.module("app").factory("deptSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e,i,o){var n=this;n.title="办事处人员列表",n.id=e.params.deptId,n.showAddUserDialog=function(){$(".addUser").modal({backdrop:"static",keyboard:!1}),n.deptOfficeGrid.dataSource.read()},n.closeAddUserDialog=function(){$(".addUser").modal("hide")},n.addOfficeUser=function(t){o.addOfficeUser(n,t)},n.remove=function(t){common.confirm({vm:n,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),o.deletedeptOfficeUser(n,t)}})},n.removes=function(){var t=common.getKendoCheckId(".deptOfficeGrid");if(0==t.length)common.alert({vm:n,msg:"请选择数据"});else{for(var e=[],i=0;i<t.length;i++)e.push(t[i].value);var o=e.join(",");n.remove(o)}},function(){o.grid(n),o.deptOfficeGrid(n)}()}angular.module("app").controller("deptOfficeUserCtrl",t),t.$inject=["$location","$state","deptSvc","deptOfficeUserSvc"]}(),function(){"use strict";function t(t){function e(e,i){var o={method:"post",url:rootPath+"/dept/addOfficeUser",params:{deptId:e.id,officeId:i}},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.deptOfficeGrid.dataSource.read(),e.gridOptions.dataSource.read()}})};common.http({vm:e,$http:t,httpOptions:o,success:n})}function i(e){var i={method:"get",url:common.format(c+"/getDepts")},o=function(t){e.depts={},e.depts=t.data};common.http({vm:e,$http:t,httpOptions:i,success:o})}function o(e){if(common.initJqValidation(),$("form").valid()){e.isSubmit=!0,e.model.id=e.id;var i={method:"put",url:c,data:e.model},o=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:e,$http:t,httpOptions:i,success:o})}}function n(e,i){e.isSubmit=!0;var o={method:"delete",url:rootPath+"/dept/deleteOfficeUsers",params:{deptId:e.id,officeId:i}},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",closeDialog:!0,fn:function(){e.isSubmit=!1,e.gridOptions.dataSource.read()}})}})};common.http({vm:e,$http:t,httpOptions:o,success:n})}function a(e){if(common.initJqValidation(),$("form").valid()){e.isSubmit=!0;var i={method:"post",url:c,data:e.model},o=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",closeDialog:!0,fn:function(){e.isSubmit=!1,location.href=d}})}})};common.http({vm:e,$http:t,httpOptions:i,success:o})}}function r(e){var i={method:"get",url:rootPath+"/dept/html/findById",params:{officeID:e.officeID}},o=function(t){t.data.dept&&(e.depts={}),e.model=t.data};common.http({vm:e,$http:t,httpOptions:i,success:o})}function s(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(m+"?deptId="+t.id),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.officeID)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"officeUserName",title:"办事处联系人",width:100,filterable:!1},{field:"officePhone",title:"电话",width:100,filterable:!1},{field:"officeDesc",title:"描述",width:100,filterable:!1},{field:"",title:"操作",width:140,template:function(t){return common.format($("#allUserGridBtns").html(),"vm.addOfficeUser('"+t.officeID+"')",t.officeID)}}];t.deptOfficeGrid={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0}}function l(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(u+"?deptId="+t.id),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.officeID)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"officeUserName",title:"办事处联系人",width:100,filterable:!1},{field:"officePhone",title:"电话",width:100,filterable:!1},{field:"officeDesc",title:"描述",width:100,filterable:!1},{field:"",title:"操作",width:140,template:function(t){return common.format($("#columnBtns").html(),"vm.remove('"+t.officeID+"')",t.officeID)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0}}var c=rootPath+"/dept",d="#/deptList",u=rootPath+"/dept/getDeptOfficeUsers",m=rootPath+"/dept/NotInoDeptfficeUsers";return{grid:l,getdeptById:r,createdept:a,deletedeptOfficeUser:n,updatedept:o,getDepts:i,deptOfficeGrid:s,addOfficeUser:e}}angular.module("app").factory("deptOfficeUserSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e,i){var o=this;o.title="字典",o.model={},function(){t.initDictTree(function(t){function e(t,e,o){i.go("dict.edit",{id:o.id})}var n,a={callback:{onClick:e},data:{simpleData:{enable:!0,idKey:"id",pIdKey:"pId"}}},r=$linq(t.value).select(function(t){var e=null;return t.parentId&&(e=t.parentId),{id:t.dictId,name:t.dictName,pId:e}}).toArray();n=$.fn.zTree.init($("#zTree"),a,r),o.dictsTree=n})}(),o.del=function(n){e.confirm({title:"询问提示",message:"删除字典将会连下级字典一起删除，确认删除数据吗？",onOk:function(){t.deleteDict(n,o.isSubmit,function(t){o.isSubmit=!1,t.flag||"ok"==t.reCode?e.alert("消息提示","操作成功！",function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),i.go("dict",{},{reload:!0})}):e.alert(t.reMsg)})}})},o.dels=function(){var t=o.dictsTree.getSelectedNodes();t&&t.length>0?o.del(t[0].id):e.alert("请选择要删除的数据！")}}angular.module("app").controller("dictCtrl",t),t.$inject=["dictSvc","bsWin","$state"]}(),function(){"use strict";function t(t,e,i,o){var n=this;n.title="增加字典",n.model={},n.id=o.params.id,n.id&&(n.isUpdate=!0,n.title="编辑字典"),n.model.dictSort=0,function(){n.isUpdate?i.getDictById(n.id,function(t){t.flag||"ok"==t.reCode?(n.model=t.reObj,i.getTreeData(function(t){if(n.treeData={},n.treeData=t.value,n.isUpdate&&n.treeData&&n.model.parentId)for(var e=0;e<n.treeData.length;e++)if(n.treeData[e].dictId==n.model.parentId){n.model.parentDictName=n.treeData[e].dictName;break}})):e.alert(t.reMsg)}):(n.model.dictCode="",i.initpZtreeClient(function(t){var e={check:{enable:!0,chkStyle:"radio",radioType:"all"},callback:{},data:{simpleData:{enable:!0,idKey:"id",pIdKey:"pId"}}},i=$linq(t.value).select(function(t){var e;return t.parentId&&(e=t.parentId),{id:t.dictId,name:t.dictName,pId:e}}).toArray();n.zpTree=$.fn.zTree.init($("#pzTree"),e,i)}))}(),n.createDict=function(){if(common.initJqValidation(),$("form").valid()){var t=n.zpTree.getCheckedNodes(!0);t&&t.length>0&&(n.model.parentId=t[0].id),i.createDict(n.model,n.isSubmit,function(t){n.isSubmit=!1,t.flag||"ok"==t.reCode?($(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),e.alert("系统提示","操作成功！",function(){o.go("dict",{},{reload:!0})})):e.alert(t.reMsg)})}else e.alert("数据填写正确，请检查修改后再提交")},n.updateDict=function(){common.initJqValidation(),$("form").valid()?i.updateDict(n.model,n.isSubmit,function(t){n.isSubmit=!1,t.flag||"ok"==t.reCode?($(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),e.alert("系统提示","操作成功！",function(){o.go("dict.edit",{id:n.model.dictId},{reload:!0})})):e.alert(t.reMsg)}):e.alert("数据填写正确，请检查修改后再提交")},n.dictTypeChange=function(){n.model.dictType&&(n.model.dictKey="")},n.apply=function(){t.$apply()}}angular.module("app").controller("dictEditCtrl",t),t.$inject=["$scope","bsWin","dictSvc","$state"]}(),function(){"use strict";function t(t,e,i){function o(e){var i={method:"get",url:common.format(u+"?dictCode={0}","DICT_SEX")},o=function(t){};common.http({vm:e,$http:t,httpOptions:i,success:o})}function n(e){var i={method:"post",url:rootPath+"/dict/fingByOdata?$orderby=dictSort"},o=function(t){void 0!=e&&"function"==typeof e&&e(t.data)};common.http({$http:t,httpOptions:i,success:o})}function a(e,i,o){i=!0;var n={method:"delete",url:rootPath+"/dict",data:e},a=function(t){i=!1,void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:t,httpOptions:n,success:a,onError:function(){i=!1}})}function r(e,i,o){i=!0;var n={method:"post",url:rootPath+"/dict",data:e},a=function(t){i=!1,void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:t,httpOptions:n,success:a,onError:function(){i=!1}})}function s(e,i,o){i=!0;var n={method:"put",url:rootPath+"/dict",data:e},a=function(t){i=!1,void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:t,httpOptions:n,success:a,onError:function(){i=!1}})}function l(e){var i={method:"post",url:rootPath+"/dict/fingByOdata?$orderby=dictSort"},o=function(t){void 0!=e&&"function"==typeof e&&e(t.data)};common.http({$http:t,httpOptions:i,success:o})}function c(e){var i={method:"post",url:rootPath+"/dict/fingByOdata?$orderby=dictSort"},o=function(t){void 0!=e&&"function"==typeof e&&e(t.data)};common.http({$http:t,httpOptions:i,success:o})}function d(e,i){var o={method:"post",url:rootPath+"/dict/fingById",params:{id:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}var u=(rootPath,rootPath+"/dict/dictNameData");return{initDictTree:l,createDict:r,getDictById:d,updateDict:s,deleteDict:a,initpZtreeClient:c,getTreeData:n,getdictItems:o}}angular.module("app").factory("dictSvc",t),t.$inject=["$http","$state","$location"]}(),function(){"dispatch strict";function t(t,e,i,o,n,a,r){var s=this;s.title="项目发文编辑",s.sign={},s.searchSign={},s.dispatchDoc={},s.dispatchDoc.signId=i.params.signid,s.isControl=i.params.isControl,s.dispatchDoc.id="",s.showFlag={buttSysFile:!1,isReveiwDS:!1},s.busiFlag={isMerge:!1,isMain:!1},function(){t.initDispatchData(s)}(),s.watchIsRelated=function(){n.$watch("vm.dispatchDoc.isRelated",function(t,e){0!=t&&"0"!=t||9!=e&&"9"!=e||1!=s.sign.isAssociate?0!=e&&"0"!=e||9!=t&&"9"!=t||s.sign.isAssociate&&0!=s.sign.isAssociate||o.confirm({title:"询问提示",message:"您要进行项目关联么？",onOk:function(){s.searchAssociateSign||(s.searchAssociateSign={signid:s.sign.signid,projectname:s.sign.projectname}),a.getAssociateSign(s.searchAssociateSign,function(t){s.currentAssociateSign=s.sign,s.associateSignList=[],t&&(s.associateSignList=t),$("#associateWindow").kendoWindow({width:"80%",height:"620px",title:"项目关联",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()})},onCancel:function(){s.dispatchDoc.isRelated=0}}):o.confirm({title:"询问提示",message:"该项目已经进行了关联，您要解除关联么？",onOk:function(){$(".confirmDialog").modal("hide"),a.saveAssociateSign(i.params.signid,null,function(){o.alert("项目解除关联成功"),window.location.reload()})},onCancel:function(){s.dispatchDoc.isRelated=9},onClose:function(){s.dispatchDoc.isRelated=9}})})},s.associateQuerySign=function(){a.getAssociateSign(s.searchAssociateSign,function(t){s.associateSignList=[],t&&(s.associateSignList=t)})},s.saveAssociateSign=function(t){if(s.sign.signid==t)return void o.alert("不能关联自身项目");a.saveAssociateSign(s.sign.signid,t,function(){t&&(s.sign.isAssociate=1),o.alert(void 0!=t?"项目关联成功":"项目解除关联成功",function(){window.parent.$("#associateWindow").data("kendoWindow").close()})})},s.initFileUpload=function(){s.dispatchDoc.id||n.$watch("vm.dispatchDoc.id",function(t,e){t&&t!=e&&!s.initUploadOptionSuccess&&s.initFileUpload()}),s.sysFile={businessId:s.dispatchDoc.id,mainId:s.dispatchDoc.signId,mainType:e.mainTypeValue().SIGN,sysfileType:e.mainTypeValue().DISPATCH,sysBusiType:e.mainTypeValue().DISPATCH},e.initUploadOptions({inputId:"sysfileinput",vm:s})},s.sigleProject=function(){"1"==s.dispatchDoc.dispatchWay?s.busiFlag.isMerge&&s.busiFlag.isMain&&o.confirm({title:"询问提示",message:"该项目已经设为合并发文，并且已经有关联项目，如果现在要取消合并发文，以前的关联信息将被删除，您确定要取消合并发文么?",onOk:function(){t.deleteAllMerge(s.dispatchDoc.signId,function(t){(t.flag||"ok"==t.reCode)&&(s.dispatchDoc.isMainProject="0",s.busiFlag.isMerge=!1,s.busiFlag.isMain=!1),o.alert(t.reMsg)})},onClose:function(){},onCancel:function(){
s.dispatchDoc.dispatchWay="2",$(".confirmDialog").modal("hide")}}):"2"==s.dispatchDoc.dispatchWay&&(s.busiFlag.isMerge||(s.busiFlag.isMerge=!0,s.busiFlag.isMain="9"==s.dispatchDoc.isMainProject))},s.create=function(){common.initJqValidation($("#dispatch_form")),$("#dispatch_form").valid()?t.saveDispatch(s):o.alert("提交失败，有红色标识的是必填项，请确认是否填写！")},s.count=function(){var t=/^(-)?(([1-9]{1}\d*)|([0]{1}))(\.(\d){1,4})?$/;if(!t.test(s.dispatchDoc.declareValue))return s.dispatchDoc.declareValue=0,void $("span[data-valmsg-for='declareValue']").html("金额只能输入数字！");if(!t.test(s.dispatchDoc.authorizeValue))return s.dispatchDoc.authorizeValue=0,void $("span[data-valmsg-for='authorizeValue']").html("金额只能输入数字！");$("span[data-valmsg-for='declareValue']").html(""),$("span[data-valmsg-for='authorizeValue']").html("");var e=(parseFloat(s.dispatchDoc.declareValue)-parseFloat(s.dispatchDoc.authorizeValue)).toFixed(2),i=parseFloat(e/s.dispatchDoc.declareValue*1e4/100).toFixed(2);s.dispatchDoc.extraRate=i,s.dispatchDoc.extraValue=e},s.gotoMergePage=function(){s.busiFlag.isMain="9"==s.dispatchDoc.isMainProject,9!=s.dispatchDoc.isMainProject||s.dispatchDoc.id?(t.initMergeInfo(s,s.dispatchDoc.signId),$("#mergeSign").kendoWindow({width:"75%",height:"700px",title:"合并发文",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()):o.alert("请先保存！")},s.chooseSign=function(){var e=$("input[name='mergeSign']:checked");if(0==e.length)o.alert("请选择要合并发文的项目！");else{var i=[];$.each(e,function(t,e){i.push(e.value)}),t.chooseProject(s.dispatchDoc.signId,i.join(","),function(e){(e.flag||"ok"==e.reCode)&&t.initMergeInfo(s,s.dispatchDoc.signId),o.alert(e.reMsg)})}},s.cancelSign=function(){var e=$("input[name='cancelMergeSignid']:checked");if(e.length<1)o.alert("请选择要取消合并发文的项目！");else{var i=[];$.each(e,function(t,e){i.push(e.value)}),t.cancelProject(s.dispatchDoc.signId,i.join(","),function(e){(e.flag||"ok"==e.reCode)&&t.initMergeInfo(s,s.dispatchDoc.signId),o.alert(e.reMsg)})}},s.onClose=function(){window.parent.$("#mwindow").data("kendoWindow").close()},s.filterSign=function(t){var e=!0;if(s.searchSign.projectname&&-1==t.projectname.indexOf(s.searchSign.projectname)&&(e=!1),s.searchSign.reviewstage&&t.reviewstage!=s.searchSign.reviewstage&&(e=!1),e)return t},s.formReset=function(){s.searchSign={}},s.templatePage=function(t){r.templatePage(t)}}angular.module("app").controller("dispatchEditCtrl",t),t.$inject=["dispatchSvc","sysfileSvc","$state","bsWin","$scope","signSvc","templatePrintSvc"]}(),function(){"dispatch strict";function t(t,e,i,o){function n(t,e){u(e,function(e){t.unMergeSign=[],t.unMergeSign=e}),d(e,function(e){t.mergeSign=[],t.mergeSign=e})}function a(t){t.busiFlag.signleToMerge=!1;var o={method:"get",url:rootPath+"/dispatch/initData",params:{signid:t.dispatchDoc.signId}},n=function(e){var o=e.data;t.sign=o.sign,t.dispatchDoc=o.dispatch,t.dispatchDoc.signId=i.params.signid,t.dispatchDoc.dispatchWay&&2==t.dispatchDoc.dispatchWay&&(t.busiFlag.isMerge=!0),t.dispatchDoc.isMainProject&&9==t.dispatchDoc.isMainProject&&(t.busiFlag.isMain=!0),t.associateDispatchs=o.associateDispatchs,t.proofread=o.mainUserList,2==t.dispatchDoc.dispatchWay&&0==t.dispatchDoc.isMainProject&&(t.showFlag.isReveiwDS=!0),t.initFileUpload(),t.watchIsRelated()};common.http({vm:t,$http:e,httpOptions:o,success:n})}function r(t){t.isCommit=!0;var i={method:"post",url:rootPath+"/dispatch",data:t.dispatchDoc},n=function(e){t.isCommit=!1,(e.data.flag||"ok"==e.data.reCode)&&(t.dispatchDoc.dispatchWay&&2==t.dispatchDoc.dispatchWay&&(t.busiFlag.isMerge=!0),t.dispatchDoc.isMainProject&&9==t.dispatchDoc.isMainProject&&(t.busiFlag.isMain=!0),t.dispatchDoc.id||(t.dispatchDoc.id=e.data.reObj.id)),o.alert(e.data.reMsg)};common.http({$http:e,httpOptions:i,success:n,onError:function(){t.isCommit=!1}})}function s(t,i,o){var n={method:"post",url:rootPath+"/signView/mergeSign",params:{signId:t,mergeIds:i,mergeType:"2"}},a=function(t){void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:e,httpOptions:n,success:a})}function l(t,i,o){var n={signId:t,mergeType:"2"};i&&(n.cancelIds=i);var a={method:"post",url:rootPath+"/signView/cancelMergeSign",params:n},r=function(t){void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:e,httpOptions:a,success:r})}function c(t,i){var o={method:"post",url:rootPath+"/signView/deleteAllMerge",params:{signId:t,mergeType:"2"}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:e,httpOptions:o,success:n})}function d(t,i){var o={method:"post",url:rootPath+"/signView/getMergeDISSign",params:{signId:t}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:e,httpOptions:o,success:n})}function u(t,i){var o={method:"post",url:rootPath+"/signView/unMergeDISSign",params:{signId:t}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:e,httpOptions:o,success:n})}return{initDispatchData:a,saveDispatch:r,initMergeInfo:n,unMergeDISSign:u,getMergeDISSign:d,chooseProject:s,cancelProject:l,deleteAllMerge:c}}angular.module("app").factory("dispatchSvc",t),t.$inject=["sysfileSvc","$http","$state","bsWin"]}(),function(){"use strict";function t(t,e,i){var o=this;o.title="专家审核",function(){e.auditGrid(o)}(),o.searchAudit=function(){e.searchAudit(o)},o.auditToOfficial=function(){e.auditTo(o,2)},o.auditToAlternative=function(){e.auditTo(o,3)},o.auditToStop=function(){e.auditTo(o,4)},o.auditToRemove=function(){e.auditTo(o,0)},o.officialToAudit=function(){e.toAudit(o,2)},o.alternativeToAudit=function(){e.toAudit(o,3)},o.stopToAudit=function(){e.toAudit(o,4)},o.temoveToAudit=function(){e.toAudit(o,5)},o.findExportDetail=function(t){o.model={},o.reviewProjectList=[],e.getExpertById(t,function(t){o.model=t,$("#auditExportDetail").kendoWindow({width:"80%",height:"620px",title:"专家详细信息",visible:!1,modal:!0,open:function(){$("#expertPhotoSrc").attr("src",rootPath+"/expert/transportImg?expertId="+o.model.expertID+"&t="+Math.random()),$("#myTab li").click(function(t){var e=$("a",this);t.preventDefault(),e.tab("show");var i=e.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500)}),o.reviewProjectList=[],e.reviewProjectGrid(o.model.expertID,function(t){o.isLoading=!1,t&&t.length>0?(o.reviewProjectList=t,o.noData=!1):o.noData=!0})},closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()})}}angular.module("app").controller("expertAuditCtrl",t),t.$inject=["$scope","expertSvc","templatePrintSvc"]}(),function(){"expert strict";function t(t,e,i,o,n){var a=this;a.data={},a.title="专家列表",a.expertId="",a.headerType="专家类型",a.fileName="专家信息",a.expert={},a.expertList=new Array(10),function(){e.grid(a)}(),a.search=function(){e.searchMuti(a)},a.searchAudit=function(){e.searchMAudit(a)},a.formReset=function(){e.formReset(a)},a.del=function(t){common.confirm({vm:a,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),e.deleteExpert(a,t,function(t){a.isSubmit=!1,a.gridOptions.dataSource.read()})}})},a.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)common.alert({vm:a,msg:"请选择数据"});else{for(var e=[],i=0;i<t.length;i++)e.push(t[i].value);var o=e.join(",");a.del(o)}},a.findExportDetail=function(t){e.getExpertById(t,function(t){a.model=t,$("#queryExportDetail").kendoWindow({width:"80%",height:"620px",title:"专家详细信息",visible:!1,modal:!0,open:function(){$("#expertPhotoSrc").attr("src",rootPath+"/expert/transportImg?expertId="+a.model.expertID+"&t="+Math.random()),$("#myTab li").click(function(t){var e=$("a",this);t.preventDefault(),e.tab("show");var i=e.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500)}),a.editPrint=function(){o.templatePrint("expertApply_templ")},a.reviewProjectList=[],e.reviewProjectGrid(a.model.expertID,function(t){a.isLoading=!1,t&&t.length>0?(a.reviewProjectList=t,a.noData=!1):a.noData=!0})},closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()})},a.exportToExcel=function(){e.exportToExcel(a)},a.selectHeader=function(){n.selectHeaderWindow(a,a.headerType)}}angular.module("app").controller("expertCtrl",t),t.$inject=["$scope","expertSvc","$state","templatePrintSvc","headerSvc"]}(),function(){"expert strict";function t(t,e,i,o,n,a,r,s){function l(t){var e={language:"zh",allowedPreviewTypes:["image"],allowedFileExtensions:["jpg","png","gif"],maxFileSize:2e3,showRemove:!1,uploadUrl:rootPath+"/expert/uploadPhoto",uploadExtraData:{expertId:t.model.expertID}};$("#expertphotofile").fileinput(e).on("filebatchselected",function(t,e){}).on("fileuploaded",function(e,i){$("#expertPhotoSrc").removeAttr("src"),$("#expertPhotoSrc").attr("src",rootPath+"/expert/transportImg?expertId="+t.model.expertID+"&t="+Math.random())})}var c=this;c.model={},c.data={},c.title="专家信息编辑",c.isuserExist=!1,c.expertID=r.params.id,c.showSS=!0,c.showSC=!1,c.showWS=!0,c.showWC=!1,c.MW=!1,c.MS=!1,c.expertList=new Array(10),function(){c.expertID&&o.getExpertById(c.expertID,function(t){c.model=t,c.showSS=!1,c.showSC=!0,c.showWS=!1,c.showWC=!0,l(c),$("#expertPhotoSrc").attr("src",rootPath+"/expert/transportImg?expertId="+c.model.expertID+"&t="+Math.random())})}(),c.selReviewProject=function(){c.model.expertID&&$("#reviewProject").kendoWindow({width:"75%",height:"600px",title:"评审项目列表",visible:!1,open:function(){c.isLoading=!0,c.reviewProjectList=[],o.reviewProjectGrid(c.model.expertID,function(t){c.isLoading=!1,t&&t.length>0?(c.reviewProjectList=t,c.noData=!1):c.noData=!0})},modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()},c.queryDetail=function(t,e){$("#reviewProject").data("kendoWindow").close(),r.go("signDetails",{signid:t,processInstanceId:e})},c.showUploadWin=function(){c.model.expertID?$("#uploadWin").kendoWindow({width:"660px",height:"360px",title:"上传头像",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open():common.alert({vm:c,msg:"先保存数据在执行操作！"})},c.saveEP=function(){common.initJqValidation(),$("form").valid()?(c.isSubmit=!0,c.model.birthDay=$("#birthDay").val(),c.model.graduateDate=$("#graduateDate").val(),o.saveExpert(c.model,c.isSubmit,function(e){c.isSubmit=!1,e.flag||"ok"==e.reCode?(c.model.expertID=e.reObj.expertID,c.model.expertNo=e.reObj.expertNo,t.success("保存成功！")):t.error(e.reMsg)})):t.alert("专家信息没有填写完整")},c.gotoWPage=function(){c.model.expertID?$("#wrwindow").kendoWindow({width:"680px",height:"420px",title:"工作简历",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open():t.alert("请先保存专家信息！")},c.saveWorks=function(){common.initJqValidation($("#workForm")),$("#workForm").valid()&&(c.work.expertID||(c.work.expertID=c.model.expertID),i.saveWork(c.work,function(e){e.flag||"ok"==e.reCode?(c.work.weID?$.each(c.model.workDtoList,function(t,i){i.weID==c.work.weID&&(i=e.reObj)}):(c.model.workDtoList||(c.model.workDtoList=[]),c.model.workDtoList.push(e.reObj)),t.success(e.reMsg,function(){c.work={},c.onWClose()})):t.error(e.reMsg)}))},c.updateWork=function(){var e=$("input[name='checkwr']:checked");if(e.length<1)t.alert("请选择要更改的项目经历信息！");else if(e.length>1)t.alert("每次只能更改一条记录！");else{var i=e.val();$.each(c.model.workDtoList,function(t,e){e.weID==i&&(c.work=e)}),c.gotoWPage()}},c.deleteWork=function(){var e=$("input[name='checkwr']:checked");if(e.length<1)t.alert("请选择要删除的工作简历");else{var o=[];$.each(e,function(t,e){o.push(e.value)}),i.deleteWork(o.join(","),function(){$.each(o,function(t,e){$.each(c.model.workDtoList,function(t,i){i&&i.weID==e&&c.model.workDtoList.splice(t,1)})}),t.alert("操作成功！")})}},c.onWClose=function(){window.parent.$("#wrwindow").data("kendoWindow").close()},c.gotoJPage=function(){c.model.expertID?$("#pjwindow").kendoWindow({width:"690px",height:"330px",title:"添加项目经验",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open():t.alert("请先保存专家信息！")},c.saveProject=function(){common.initJqValidation($("#ProjectForm")),$("#ProjectForm").valid()&&(c.project.expertID||(c.project.expertID=c.model.expertID),c.project.projectbeginTime=$("#projectbeginTime").val(),c.project.projectendTime=$("#projectendTime").val(),e.saveProject(c.project,function(e){e.flag||"ok"==e.reCode?(c.project.peID?$.each(c.model.projectDtoList,function(t,i){i.peID==c.project.peID&&(i=e.reObj)}):(c.model.projectDtoList||(c.model.projectDtoList=[]),c.model.projectDtoList.push(e.reObj)),t.success(e.reMsg,function(){c.project={},c.onPClose()})):t.error(e.reMsg)}))},c.updateProjectPage=function(){var e=$("input[name='checkpj']:checked");if(e.length<1)t.alert("请选择要更改的项目经历信息！");else if(e.length>1)t.alert("每次只能更改一条记录！");else{var i=e.val();$.each(c.model.projectDtoList,function(t,e){e.peID==i&&(c.project=e)}),c.gotoJPage()}},c.delertProject=function(){common.initJqValidation();var i=$("input[name='checkpj']:checked");if(i.length<1)t.alert("请选择要删除的操作对象!");else{var o=[];$.each(i,function(t,e){o.push(e.value)}),e.delertProject(o.join(","),function(){$.each(o,function(t,e){$.each(c.model.projectDtoList,function(t,i){i&&i.peID==e&&c.model.projectDtoList.splice(t,1)})}),t.alert("操作成功！")})}},c.onPClose=function(){window.parent.$("#pjwindow").data("kendoWindow").close()},c.gotoExpertType=function(){c.model.expertID?$("#addExpertType").kendoWindow({width:"680px",height:"400px",title:"专家类型",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open():t.alert("请先保存专家信息！")},c.onETlose=function(){a.cleanValue(),window.parent.$("#addExpertType").data("kendoWindow").close()},c.saveExpertType=function(){common.initJqValidation($("#expertTypeForm")),$("#expertTypeForm").valid()&&(c.expertType.expertID||(c.expertType.expertID=c.model.expertID),a.saveExpertType(c.expertType,function(e){e.flag||"ok"==e.reCode?(c.expertType.id?$.each(c.model.expertTypeDtoList,function(t,i){i.id==c.expertType.id&&(i=e.reObj)}):(c.model.expertTypeDtoList||(c.model.expertTypeDtoList=[]),c.model.expertTypeDtoList.push(e.reObj)),t.success(e.reMsg,function(){c.expertType={},c.onETlose()})):t.error(e.reMsg)}))},c.updateProjectType=function(){var e=$("input[name='checkEType']:checked");if(e.length<1)t.alert("请选择要更改的专业信息！");else if(e.length>1)t.alert("每次只能更改一条记录！");else{var i=e.val();$.each(c.model.expertTypeDtoList,function(t,e){e.id==i&&(c.expertType=e)}),c.expertType.majobSmallDicts=s.topSelectChange(c.expertType.maJorBig,s.DICT.MAJOR.dicts),c.gotoExpertType()}},c.delertProjectType=function(){var e=$("input[name='checkEType']:checked");if(e.length<1)t.alert("请选择删除的专家类别信息！");else{var i=[];$.each(e,function(t,e){i.push(e.value)}),a.deleteExpertType(i.join(","),function(){$.each(i,function(t,e){$.each(c.model.expertTypeDtoList,function(t,i){i&&i.id==e&&c.model.expertTypeDtoList.splice(t,1)})}),t.alert("操作成功！")})}},c.gotoOfferPage=function(){c.model.expertID?$("#ep_offer_div").kendoWindow({width:"820px",height:"600px",title:"专家聘书",visible:!1,modal:!0,closable:!0,close:function(){c.showProjectOffer=!1},actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open():t.alert("先保存专家信息！")},c.saveOffer=function(){common.initJqValidation($("#expert_offer_form")),$("#expert_offer_form").valid()&&(c.expertOffer.expertId=c.model.expertID,n.saveOffer(c.expertOffer,function(e){e.flag||"ok"==e.reCode?(c.expertOffer.id?$.each(c.model.expertOfferDtoList,function(t,i){i.id==c.expertOffer.id&&(i=e.reObj)}):(c.model.expertOfferDtoList||(c.model.expertOfferDtoList=[]),c.model.expertOfferDtoList.push(e.reObj)),t.success(e.reMsg,function(){c.expertOffer={},c.onETlose()})):t.error(e.reMsg)}))},c.closeOffer=function(){c.showProjectOffer=!1,window.parent.$("#ep_offer_div").data("kendoWindow").close()},c.showOffer=function(){var e=$("input[name='checkps']:checked");if(e.length<1)t.alert("请选择要查看的聘书信息！");else if(e.length>1)t.alert("每次只能查看一条记录！");else{var i=e.val();$.each(c.model.expertOfferDtoList,function(t,e){if(e.id==i)return void(c.expertOffer=e)}),c.showProjectOffer=!0,c.gotoOfferPage()}},c.chooseMW=function(){c.MW=!0,c.showWS=!0,c.showWC=!1},c.cancelMW=function(){c.showWS=!1,c.showWC=!0},c.sureMW=function(){c.majorWork?(c.model.majorWork=c.majorWork,c.showWS=!1,c.showWC=!0):common.alert({vm:c,msg:"您未选择专业，请选择！",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}})},c.chooseMS=function(){c.MS=!0,c.showSS=!0,c.showSC=!1},c.cancelMS=function(){c.showSS=!1,c.showSC=!0},c.sureMS=function(){c.majorStudy?(c.model.majorStudy=c.majorStudy,c.showSS=!1,c.showSC=!0):common.alert({vm:c,msg:"您未选择专业，请选择！",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}})},c.queryDetail=function(t,e){$("#reviewProject").data("kendoWindow").close(),r.go("signDetails",{signid:t,processInstanceId:e})},c.editPrint=function(){o.expertPrint(c)}}angular.module("app").controller("expertEditCtrl",t),t.$inject=["bsWin","projectExpeSvc","workExpeSvc","expertSvc","expertOfferSvc","expertTypeSvc","$state","$rootScope"]}(),function(){"use strict";function t(t,e,i){var o=this;!function(){e.repeatGrid(o)}(),o.findExportDetail=function(t){e.getExpertById(t,function(t){o.model=t,$("#reExportDetail").kendoWindow({width:"80%",height:"auto",title:"专家详细信息",visible:!1,modal:!0,open:function(){$("#expertPhotoSrc").attr("src",rootPath+"/expert/transportImg?expertId="+o.model.expertID+"&t="+Math.random())},closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()})},o.del=function(t){i.confirm("删除数据不可恢复，确认删除数据吗？",function(){e.deleteExpertData(o,t,function(t){i.alert("操作成功",function(){o.repeatGridOptions.dataSource.read()})})})},o.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)i.alert("请选择数据");else{for(var e=[],n=0;n<t.length;n++)e.push(t[n].value);var a=e.join(",");o.del(a)}}}angular.module("app").controller("expertRepeatCtrl",t),t.$inject=["$location","expertSvc","bsWin"]}(),function(){"expert strict";function t(t,e){function i(){o.isSubmit=!0,o.noData=!1,e.expertScoreHis(o.selectHis,function(t){o.isSubmit=!1,o.expScoreList=t,o.expScoreList&&0!=o.expScoreList.length||(o.noData=!0)})}var o=this;o.data={},o.title="专家评分统计",o.selectHis={},o.selectHis.beginTime=(new Date).yearAgo(1),o.selectHis.endTime=(new Date).Format("yyyy-MM-dd"),o.expScoreList=[],i(),o.search=function(){o.selectHis.scoreBegin?o.selectHis.scoreEnd?o.selectHis.score=o.selectHis.scoreBegin+o.selectHis.scoreEnd:o.selectHis.score=o.selectHis.scoreBegin+5:o.selectHis.score=1+o.selectHis.scoreEnd,i()},o.formReset=function(){o.selectHis={}}}angular.module("app").controller("expertScoreCtrl",t),t.$inject=["$location","expertSvc"]}(),function(){"expert strict";function t(t,e){function i(){o.isSubmit=!0,o.noData=!1,e.expertSelectHis(o.selectHis,function(t){o.isSubmit=!1,o.expSelectList=t,t&&0!=t.length||(o.noData=!0)})}var o=this;o.title="专家抽取统计",o.selectHis={},o.selectHis.beginTime=(new Date).yearAgo(1),o.selectHis.endTime=(new Date).Format("yyyy-MM-dd"),o.expSelectList=[],i(),o.search=function(){i()},o.formReset=function(){o.selectHis={}}}angular.module("app").controller("expertSelectHisCtrl",t),t.$inject=["$location","expertSvc"]}(),function(){"expert strict";function t(t,e,i,o){function n(){o.templatePrint("expertApply_templ")}function a(t){$("#searchform")[0].reset(),t.gridOptions.dataSource.read()}function r(e,i,o){e.isSubmit=!0;var n={method:"delete",url:P,params:{id:i}},a=function(t){e.isSubmit=!1,void 0!=o&&"function"==typeof o&&o(t.data)};common.http({vm:e,$http:t,httpOptions:n,success:a})}function s(e,i,o){e.isSubmit=!0;var n={method:"delete",url:rootPath+"/expert/deleteExpertData",params:{id:i}},a=function(t){e.isSubmit=!1,void 0!=o&&"function"==typeof o&&o(t.data)};common.http({vm:e,$http:t,httpOptions:n,success:a})}function l(t){t.gridOptions.dataSource._skip=0,t.gridOptions.dataSource.read()}function c(e,i,o){i=!0;var n={method:"post",url:rootPath+"/expert",data:e},a=function(t){i=!1,void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:t,httpOptions:n,success:a,onError:function(){i=!1}})}function d(e,i){var o={method:"post",url:P+"/findById",params:{id:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function u(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findByOData",$("#searchform"),{$filter:"state ne 0"}),schema:common.kendoGridConfig().schema({id:"expertID",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"applyDate",dir:"desc"}}),i=function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})};t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:m(t),dataBound:i,resizable:!0}}function m(t){return[{template:function(t){return"5"!=t.state?kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.expertID):kendo.format("<input type='checkbox' disabled='disabled'  relId='{0}' name='checkbox' class='checkbox' />",t.expertID)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,template:"<span class='row-number'></span>",filterable:!1},{field:"name",title:"姓名",width:"7%",filterable:!1,template:function(t){return"<a  ng-click=\"vm.findExportDetail('"+t.expertID+"')\">"+t.name+"</a>"}},{field:"comPany",title:"工作单位",width:"18%",filterable:!1},{field:"phone",title:"办公电话",width:"15%",filterable:!1},{field:"userPhone",title:"手机号码",width:"13%",filterable:!1},{field:"job",title:"职位",width:"15%",filterable:!1},{field:"post",title:"职称",width:"10%",filterable:!1},{field:"expertSort",title:"专家类型",width:"10%",filterable:!1},{field:"",title:"操作",width:"8%",template:function(t){var e=!0;return e="5"!=t.state,common.format($("#columnBtns").html(),"vm.del('"+t.expertID+"')",t.expertID,e)}}]}function p(){return[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.expertID)},filterable:!1,width:25,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"name",title:"姓名",width:60,filterable:!1,template:function(t){return"<a  ng-click=\"vm.findExportDetail('"+t.expertID+"')\">"+t.name+"</a>"}},{field:"degRee",title:"学位",width:50,filterable:!1},{field:"post",title:"职称",width:70,filterable:!1},{field:"applyDate",title:"录入时间",width:70,filterable:!1,format:"{0: yyyy-MM-dd}"},{field:"compositeScore",title:"专家星级",width:70,filterable:!1},{field:"comPany",title:"工作单位",width:120,filterable:!1}]}function f(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findByOData",$("#auditform"),{$filter:"state eq '1'"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:25,sort:{field:"createdDate",dir:"desc"}}),i=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findByOData",$("#auditform"),{$filter:"state eq '2'"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:5,sort:{field:"createdDate",dir:"desc"}}),o=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findByOData",$("#auditform"),{$filter:"state eq '3'"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:5,sort:{field:"createdDate",dir:"desc"}}),n=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findByOData",$("#auditform"),{$filter:"state eq '4'"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:5,sort:{field:"createdDate",dir:"desc"}}),a=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findByOData",$("#auditform"),{$filter:"state eq '0'"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:5,sort:{field:"createdDate",dir:"desc"}}),r=function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})};t.gridOptions1={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:p(),dataBound:r,resizable:!0},t.gridOptions2={dataSource:common.gridDataSource(i),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:p(),dataBound:r,resizable:!0},t.gridOptions3={dataSource:common.gridDataSource(o),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:p(),dataBound:r,resizable:!0},t.gridOptions4={dataSource:common.gridDataSource(n),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:p(),dataBound:r,resizable:!0},t.gridOptions5={dataSource:common.gridDataSource(a),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:p(),dataBound:r,resizable:!0}}function h(t){t.gridOptions1.dataSource._skip=0,t.gridOptions2.dataSource._skip=0,t.gridOptions3.dataSource._skip=0,t.gridOptions4.dataSource._skip=0,t.gridOptions5.dataSource._skip=0,$("#state").val("1"),t.gridOptions1.dataSource.read(),$("#state").val("2"),t.gridOptions2.dataSource.read(),$("#state").val("3"),t.gridOptions3.dataSource.read(),$("#state").val("4"),t.gridOptions4.dataSource.read(),$("#state").val("0"),t.gridOptions5.dataSource.read()}function g(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findRepeatByOData"),schema:common.kendoGridConfig().schema({id:"id"}),rowNumber:!0,headerCenter:!0}),i=function(){var t=this.items();$(t).each(function(t){$(this).find(".row-number").html(t+1)})};t.repeatGridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:m(t),dataBound:i,resizable:!0}}function v(t,e){var i=common.getKendoCheckId("#grid"+e);if(0==i.length)common.alert({vm:t,msg:"请选择数据"});else{for(var o=[],n=0;n<i.length;n++)o.push(i[n].value);w(t,o.join(","),1)}}function y(t,e){var i=common.getKendoCheckId("#grid1");if(0==i.length)common.alert({vm:t,msg:"请选择数据"});else{for(var o=[],n=0;n<i.length;n++)o.push(i[n].value);w(t,o.join(","),e)}}function w(e,i,o){e.isSubmit=!0;var n={method:"post",url:P+"/updateAudit",params:{ids:i,flag:o}},a=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.isSubmit=!1,e.gridOptions1.dataSource.read(),e.gridOptions2.dataSource.read(),e.gridOptions3.dataSource.read(),e.gridOptions4.dataSource.read(),e.gridOptions5.dataSource.read(),common.alert({vm:e,msg:"操作成功"})}})};common.http({vm:e,$http:t,httpOptions:n,success:a})}function b(o){var n={method:"post",url:rootPath+"/expert/exportToExcel",responseType:"arraybuffer",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},data:{$filter:common.buildOdataFilter($("#searchform"))},transformRequest:function(t){var e=[];for(var i in t)e.push(encodeURIComponent(i)+"="+encodeURIComponent(t[i]));return e.join("&")}},a=function(t){var o=new i([t.data],{type:"application/vnd.ms-excel"});e.saveAs(o,"专家信息.xls")};common.http({$http:t,httpOptions:n,success:a})}function S(e,i){var o={method:"post",url:rootPath+"/expert/expertSelectHis",data:e},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function k(e,i){var o={method:"post",url:rootPath+"/expert/expertScoreHis",data:e},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function C(e,i){var o={method:"post",url:rootPath+"/expert/reviewProject",params:{expertId:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}var P=rootPath+"/expert";return{grid:u,auditGrid:f,getExpertById:d,saveExpert:c,deleteExpert:r,deleteExpertData:s,searchMuti:l,searchAudit:h,repeatGrid:g,updateAudit:w,toAudit:v,auditTo:y,formReset:a,exportToExcel:b,expertSelectHis:S,expertScoreHis:k,reviewProjectGrid:C,expertPrint:n}}angular.module("app").factory("expertSvc",t),t.$inject=["$http","FileSaver","Blob","templatePrintSvc"]}(),function(){"expertType strict";function t(t,e,i,o){function n(){var t=$("#addExpertType").find("input");$.each(t,function(t,e){e.value=""})}function a(e){var i={method:"GET",url:rootPath+"/expertType/getExpertType?$filter=expert.expertID eq '"+e.model.expertID+"'"},o=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.expertTypeList=t.data}})};common.http({vm:e,$http:t,httpOptions:i,success:o})}function r(e){var o={method:"get",url:rootPath+"/expertType/getExpertTypeById",params:{expertTypeId:e.expertTypeId}},n=function(t){e.expertType=t.data,e.expertType.majobSmallDicts=i.topSelectChange(e.expertType.maJorBig,i.DICT.MAJOR.dicts)};common.http({vm:e,$http:t,httpOptions:o,success:n})}function s(e,i){var o={method:"post",url:rootPath+"/expertType",data:e},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function l(i){if(common.initJqValidation($("#expertTypeForm")),$("#expertTypeForm").valid()){i.expertType.expertID=i.expertID;var o={method:"put",url:rootPath+"/expertType",data:i.expertType},a=function(t){common.requestSuccess({vm:i,response:t,fn:function(){window.parent.$("#addExpertType").data("kendoWindow").close(),e.getExpertById(i),n(),common.alert({vm:i,msg:"操作成功",fn:function(){i.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:i,$http:t,httpOptions:o,success:a})}}function c(e,i){var o={method:"delete",url:rootPath+"/expertType",params:{ids:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}return{cleanValue:n,getExpertType:a,getExpertTypeById:r,saveUpdate:l,deleteExpertType:c,saveExpertType:s}}angular.module("app").factory("expertTypeSvc",t),t.$inject=["$http","expertSvc","$rootScope","bsWin"]}(),function(){"projectExpe strict";function t(t){function e(e){var i={method:"get",url:rootPath+"/dict/getAllDictByCode",params:{dictCode:"PROJECTTYPE"}},o=function(t){e.projectTypes=t.data};common.http({vm:e,$http:t,httpOptions:i,success:o})}function i(e,i){var o={method:"delete",url:rootPath+"/projectExpe/deleteProject",params:{ids:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function o(e){var i={method:"get",url:common.format(rootPath+"/projectExpe/getProject?$filter=peID eq '{0}'",e.peID)},o=function(t){e.project={},e.project.projectName=t.data[0].projectName,e.project.projectType=t.data[0].projectType,e.project.projectbeginTime=t.data[0].projectbeginTime,e.project.projectendTime=t.data[0].projectendTime,e.isUpdate};common.http({vm:e,$http:t,httpOptions:i,success:o})}function n(e){if(common.initJqValidation($("#ProjectForm")),$("#ProjectForm").valid()){e.isSubmit=!0,
e.project.peID=e.peID,e.project.expertID=e.expertID,e.project.projectbeginTime=$("#projectbeginTime").val(),e.project.projectendTime=$("#projectendTime").val();var i={method:"put",url:rootPath+"/projectExpe/updateProject",data:e.project},o=function(t){common.requestSuccess({vm:e,response:t,fn:function(){window.parent.$("#pjwindow").data("kendoWindow").close(),a(e),common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide")}})}})}}common.http({vm:e,$http:t,httpOptions:i,success:o})}function a(e){var i={method:"GET",url:rootPath+"/projectExpe/getProject?$filter=expert.expertID eq '"+e.model.expertID+"'"},o=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.projectList=t.data}})};common.http({vm:e,$http:t,httpOptions:i,success:o})}function r(t){var e=$("input[name='checkpj']:checked");e.length<1?common.alert({vm:t,msg:"请选择操作对象",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}}):e.length>1?common.alert({vm:t,msg:"无法同时操作多条数据",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}}):(t.peID=e.val(),o(t),t.expertID=t.model.expertID,gotoJPage(t))}function s(e,i){var o={method:"post",url:rootPath+"/projectExpe/saveExpe",data:e},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}return{getProject:a,saveProject:s,updateProject:n,updateProjectPage:r,getProjectById:o,delertProject:i,initProjectType:e}}angular.module("app").factory("projectExpeSvc",t),t.$inject=["$http"]}(),function(){"workExpe strict";function t(t,e){function i(e){var i={method:"GET",url:rootPath+"/workExpe/getWork?$filter=expert.expertID eq '"+e.model.expertID+"'"},o=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.workList=t.data}})};common.http({vm:e,$http:t,httpOptions:i,success:o})}function o(e,i){var o={method:"delete",url:rootPath+"/workExpe/deleteWork",params:{ids:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function n(t){var e=$("input[name='checkwr']:checked");e.length<1?common.alert({vm:t,msg:"请选择操作对象",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}}):e.length>1?common.alert({vm:t,msg:"无法同时操作多条数据",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}}):(t.weID=e.val(),a(t),gotoWPage(t),t.expertID=t.model.expertID)}function a(e){var i={method:"get",url:common.format(rootPath+"/workExpe/getWork?$filter=weID eq '{0}'",e.weID)},o=function(t){e.work={},e.work.companyName=t.data[0].companyName,e.work.workJob=t.data[0].workJob,e.work.beginTime=t.data[0].beginTime,e.work.endTime=t.data[0].endTime};common.http({vm:e,$http:t,httpOptions:i,success:o})}function r(e,i){var o={method:"post",url:rootPath+"/workExpe/saveWorkExpe",data:e},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function s(e){if(common.initJqValidation(),$("form").valid()){e.work.weID=e.weID,e.work.expertID=e.expertID,e.work.beginTime=$("#beginTime").val(),e.work.endTime=$("#endTime").val();var o={method:"put",url:rootPath+"/workExpe/updateWork",data:e.work},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){window.parent.$("#wrwindow").data("kendoWindow").close(),i(e),cleanValue(),common.alert({vm:e,msg:"操作成功",fn:function(){e.showWorkHistory=!0,$(".alertDialog").modal("hide")}})}})};common.http({vm:e,$http:t,httpOptions:o,success:n})}}return{saveWork:r,updateWork:s,deleteWork:o,updateWorkPage:n,getWorkById:a,getWork:i}}angular.module("app").factory("workExpeSvc",t),t.$inject=["$http","expertSvc"]}(),function(){"use strict";function t(t,e){function i(e,i){var o={method:"post",url:rootPath+"/expertOffer",data:e},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function o(i){if(common.initJqValidation($("#expert_offer_form")),$("#expert_offer_form").valid()){i.expertOffer.expertId=i.model.expertID;var o={method:"put",url:rootPath+"/expertOffer",data:i.expertOffer},n=function(t){common.requestSuccess({vm:i,response:t,fn:function(){e.getExpertById(i),common.alert({vm:i,msg:"操作成功"})}})};common.http({vm:i,$http:t,httpOptions:o,success:n})}}return{saveOffer:i,updateOffer:o}}angular.module("app").factory("expertOfferSvc",t),t.$inject=["$http","expertSvc"]}(),function(){"use strict";function t(t,e){var i=this;i.title="专家列表",i.del=function(t){common.confirm({vm:i,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),e.deleteExpertReview(i,t)}})},i.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)common.alert({vm:i,msg:"请选择数据"});else{for(var e=[],o=0;o<t.length;o++)e.push(t[o].value);var n=e.join(",");i.del(n)}},function(){e.initExpertGrid(i),e.getReviewList(i)}()}angular.module("app").controller("expertReviewCtrl",t),t.$inject=["$location","expertReviewSvc"]}(),function(){"use strict";function t(t,e,i){var o=this;o.title="添加附件",o.isuserExist=!1,o.id=i.params.id,o.id&&(o.isUpdate=!0,o.title="更新附件"),o.create=function(){e.createExpertReview(o)},o.update=function(){e.updateExpertReview(o)},function(){o.isUpdate&&e.getExpertReviewById(o)}()}angular.module("app").controller("expertReviewEditCtrl",t),t.$inject=["$location","expertReviewSvc","$state"]}(),function(){"use strict";function t(t,e,i,o,n,a){function r(t){return!!(/^(\+|-)?\d+$/.test(t)&&t>0)}function s(){if(l.expertReview.expertSelConditionDtoList.length>0){var t=!0;return l.expertReview.expertSelConditionDtoList.forEach(function(e,i){l.expertReview.id&&(e.expertReviewDto={},e.expertReviewDto.id=l.expertReview.id),e.officialNum&&r(e.officialNum)||($("#errorsOfficialNum"+e.id).html("必填，且为数字"),t=!1),e.alternativeNum&&r(e.alternativeNum)||($("#errorsAlternativeNum"+e.id).html("必填，且为数字"),t=!1),t&&($("#errorsOfficialNum"+e.id).html(""),$("#errorsAlternativeNum"+e.id).html(""))}),t}return!1}var l=this;l.title="选择专家",l.conMaxIndex=0,l.customCondition=new Array,l.expertReview={},l.confirmEPList=[],l.matchEPMap={},l.selectIds=[],l.autoSelectedEPList=[],l.businessId=o.params.businessId,l.minBusinessId=o.params.minBusinessId,l.businessType=o.params.businessType;o.params.expertID;l.isSuperUser=isSuperUser,l.findExportDetail=function(t){i.getExpertById(t,function(t){l.model=t,$("#selectExportDetail").kendoWindow({width:"80%",height:"auto",title:"专家详细信息",visible:!1,modal:!0,open:function(){$("#expertPhotoSrc").attr("src",rootPath+"/expert/transportImg?expertId="+l.model.expertID+"&t="+Math.random())},closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()})},l.reFleshSelEPInfo=function(t){$.each(t,function(t,e){l.confirmEPList.push(e),l.selectIds.push(e.expertDto.expertID)}),l.excludeIds=l.selectIds.join(",")},l.reFleshAfterRemove=function(t){$.each(t,function(t,e){$.each(l.confirmEPList,function(t,i){i&&e==i.id&&l.confirmEPList.splice(t,1)})})},l.reFleshJoinState=function(t,e){$.each(t,function(t,i){$.each(l.confirmEPList,function(t,o){i==o.id&&(o.isJoin=e)})})},l.reFleshConfirmState=function(t,e){$.each(t,function(t,i){$.each(l.confirmEPList,function(t,o){i==o.id&&(o.isConfrim=e)})})},l.updateSelectedIndex=function(t){t?$.each(l.expertReview.expertSelConditionDtoList,function(e,i){i.id==t&&(i.selectIndex=i.selectIndex?i.selectIndex+1:1)}):$.each(l.expertReview.expertSelConditionDtoList,function(t,e){e.selectIndex=e.selectIndex?e.selectIndex+1:1})},l.init=function(e,i){l.expertReview={},l.confirmEPList=[],l.selectIds=[],t.initReview(e,i,function(t){l.expertReview=t,!angular.isUndefined(l.expertReview.expertSelectedDtoList)&&angular.isArray(l.expertReview.expertSelectedDtoList)&&($.each(l.expertReview.expertSelectedDtoList,function(t,e){l.selectIds.push(e.expertDto.expertID),l.confirmEPList.push(e)}),l.selectIds.length>0?l.excludeIds=l.selectIds.join(","):l.excludeIds="")})},function(){t.initExpertGrid(l),l.init(l.businessId,l.minBusinessId)}(),l.showSelfExpertGrid=function(){l.selfExpertOptions.dataSource._skip=0,l.selfExpertOptions.dataSource.read(),$("#selfExpertDiv").kendoWindow({width:"80%",height:"680px",title:"自选评审专家",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},l.saveSelfExpert=function(){var e=common.getKendoCheckId("#selfExpertGrid");0==e.length?n.alert("请先选择专家！"):e.length>1?n.alert("自选专家最多只能选择一个！"):t.saveSelfExpert(l.businessId,l.minBusinessId,l.businessType,e[0].value,l.expertReview.id,l.isCommit,function(t){if(t.flag||"ok"==t.reCode){var e=[];$.each(l.confirmEPList,function(t,i){"2"==i.selectType&&e.push(i.id)}),l.expertReview.id||(l.expertReview.id=t.idCode),l.reFleshSelEPInfo(t.reObj),l.reFleshAfterRemove(e),n.success("操作成功！",function(){window.parent.$("#selfExpertDiv").data("kendoWindow").close()})}else n.error(t.reMsg)})},l.delertSelfExpert=function(){var e=$("input[name='seletedEp']:checked");e.length<1?n.alert("请选择要删除的专家"):n.confirm({title:"询问提示",message:"删除数据不可恢复，确定删除么？",onOk:function(){$(".confirmDialog").modal("hide");for(var i=[],o=0;o<e.length;o++)i.push(e[o].value);t.delSelectedExpert(l.expertReview.id,i.join(","),l.isCommit,function(t){t.flag||"ok"==t.reCode?(l.reFleshAfterRemove(i),n.success("操作成功！")):n.error(t.reMsg)})}})},l.querySelfExpert=function(){l.selfExpertOptions.dataSource._skip=0,l.selfExpertOptions.dataSource.read()},l.showOutExpertGrid=function(){l.outExpertOptions.dataSource._skip=0,l.outExpertOptions.dataSource.read(),$("#outExpertDiv").kendoWindow({width:"70%",height:"680px",title:"自选新专家、市外、境外专家",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},l.delertOutSelfExpert=function(){var e=$("input[name='seletedOutEp']:checked");e.length<1?n.alert("请选择要删除的专家"):n.confirm({title:"询问提示",message:"删除数据不可恢复，确定删除么？",onOk:function(){$(".confirmDialog").modal("hide");for(var i=[],o=0;o<e.length;o++)i.push(e[o].value);t.delSelectedExpert(l.expertReview.id,i.join(","),l.isCommit,function(t){t.flag||"ok"==t.reCode?(l.reFleshAfterRemove(i),n.success("操作成功！")):n.error(t.reMsg)})}})},l.saveOutExpert=function(){var e=common.getKendoCheckId("#outExpertGrid");if(0==e.length)n.alert("请先选择专家！");else{var i=[];$.each(e,function(t,e){i.push(e.value)}),t.saveOutExpert(l.businessId,l.minBusinessId,l.businessType,i.join(","),l.expertReview.id,l.isCommit,function(t){t.flag||"ok"==t.reCode?(l.expertReview.id||(l.expertReview.id=t.idCode),l.reFleshSelEPInfo(t.reObj),n.success("操作成功！",function(){window.parent.$("#outExpertDiv").data("kendoWindow").close()})):n.error(t.reMsg)})}},l.queryOutExpert=function(){l.outExpertOptions.dataSource._skip=0,l.outExpertOptions.dataSource.read()},l.countMatchExperts=function(e){if(l.expertReview.id){var i={};l.expertReview.expertSelConditionDtoList.forEach(function(t,o){t.id==e&&(i=t)}),t.countMatchExperts(i,l.minBusinessId,l.expertReview.id,function(t){l.matchEPMap[e]=t,$("#expertCount"+e).html(t.length)})}else n.alert("请保存整体抽取方案再计算")},l.showMatchExperts=function(t){l.matchExpertList=[],l.matchExpertList=l.matchEPMap[t],$("#matchExpertDiv").kendoWindow({width:"80%",height:"600px",title:"统计专家信息列表",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},l.checkIntegerValue=function(t,i,o){return e.isUnsignedInteger(t)?($("#errorsOfficialNum"+o).html(""),$("#errorsAlternativeNum"+o).html(""),t):($("#errorsOfficialNum"+o).html("只能填写数字"),void $("#errorsAlternativeNum"+o).html("只能填写数字"))},l.addCondition=function(){l.isSuperUser||9!=l.expertReview.state&&"9"!=l.expertReview.state?(l.expertReview.expertSelConditionDtoList||(l.expertReview.expertSelConditionDtoList=[]),l.condition={},l.condition.id=common.uuid(),l.condition.businessId=l.minBusinessId,l.condition.selectType="1",l.expertReview.expertSelConditionDtoList.push(l.condition)):n.alert("当前项目已经进行整体专家方案的抽取，不能再修改方案！")},l.removeCondition=function(){if(l.isSuperUser||9!=l.expertReview.state&&"9"!=l.expertReview.state){var t=$("#conditionTable input[name='epConditionSort']:checked");t.length>0?n.confirm({title:"询问提示",message:"删除数据的同时会删除该条件所抽取的专家，删除数据不可恢复，确定删除么？",onOk:function(){for(var i=[],o=0;o<t.length;o++)$.each(l.expertReview.expertSelConditionDtoList,function(e,n){t[o].value==n.id&&i.push(n.id)});i.length>0?e.deleteSelConditions(i.join(","),l.isCommit,function(t){t.flag||"ok"==t.reCode?n.success("操作成功！",function(){l.init(l.businessId,l.minBusinessId)}):n.error(t.reMsg)}):n.success("操作成功！")}}):n.alert("请选择要删除的抽取条件！")}else n.alert("当前项目已经进行整体专家方案的抽取，不能再修改方案！")},l.saveCondition=function(){l.isSuperUser||9!=l.expertReview.state&&"9"!=l.expertReview.state?s()?e.saveCondition(l.businessId,l.minBusinessId,l.businessType,l.expertReview.id,l.expertReview.expertSelConditionDtoList,function(t){t.flag||"ok"==t.reCode?(l.expertReview.expertSelConditionDtoList=t.reObj,l.expertReview.id||(l.expertReview.id=l.expertReview.expertSelConditionDtoList[0].expertReviewId),n.success("保存成功！")):n.error(t.reMsg)}):n.alert("专家抽取条件设置不完整！"):n.alert("当前项目已经进行整体专家方案的抽取，不能再修改方案！")},l.startAutoExpertWin=function(){return l.expertReview.id?isSuperUser||9!=l.expertReview.state&&"9"!=l.expertReview.state?void(s()?e.saveCondition(l.businessId,l.minBusinessId,l.businessType,l.expertReview.id,l.expertReview.expertSelConditionDtoList,function(e){e.flag||"ok"==e.reCode?(l.expertReview.expertSelConditionDtoList=e.reObj,l.expertReview.id||(l.expertReview.id=l.expertReview.expertSelConditionDtoList[0].expertReviewId),t.queryAutoExpert(l.expertReview.expertSelConditionDtoList,l.minBusinessId,l.expertReview.id,function(e){e.flag||"ok"==e.reCode?(l.reFleshSelEPInfo(e.reObj.autoEPList),l.autoSelectedEPList=[],l.autoSelectedEPList=e.reObj.autoEPList,l.expertReview.state="9",l.showAutoExpertWin(),t.validateAutoExpert(e.reObj.allEPList,l)):n.error(e.reMsg)})):n.error(e.reMsg)}):n.alert("专家抽取条件设置不完整！")):void n.alert("当前项目已经进行整体专家方案的抽取，不能再修改方案！"):void n.alert("请先进行整体专家抽取条件设置并保存！")},l.showAutoExpertWin=function(){$("#aotuExpertDiv").kendoWindow({width:"90%",height:"700px",title:"专家抽取",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},l.showAutoMatchResultWin=function(){$("#aotuMatchResultDiv").kendoWindow({width:"90%",height:"700px",title:"专家抽取结果",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},l.repeatAutoExpert=function(e){var i=[];if($.each(l.expertReview.expertSelConditionDtoList,function(t,o){o.id==e&&i.push(o)}),i[0].selectIndex>3)return void n.alert("该条件已经进行了3次抽取，不能再继续抽取！");t.queryAutoExpert(i,l.minBusinessId,l.expertReview.id,function(i){i.flag||"ok"==i.reCode?(l.reFleshSelEPInfo(i.reObj.autoEPList),l.expertReview.state="9",l.autoSelectedEPList=[],l.autoSelectedEPList=i.reObj.autoEPList,l.updateSelectedIndex(e),l.showAutoExpertWin(),t.validateAutoExpert(i.reObj.allEPList,l)):n.error(i.reMsg)})},l.affirmAutoExpert=function(){var e=$("#allAutoEPTable input[name='autoEPCheck']:checked");if(e.length<1)n.confirm({title:"询问提示",message:"您还没选择专家，确定没有合适的专家么？",onOk:function(){a.$apply(function(){$.each(l.expertReview.expertSelConditionDtoList,function(t,e){!e.selectIndex||e.selectIndex<1?e.selectIndex=1:e.selectIndex=e.selectIndex+1,e.showDraftBt=!0})}),window.parent.$("#aotuExpertDiv").data("kendoWindow").close()}});else{for(var i=[],o=0;o<e.length;o++)i.push(e[o].value);t.affirmAutoExpert(l.minBusinessId,l.businessType,i.join(","),"9",function(t){t.flag||"ok"==t.reCode?(l.reFleshConfirmState(i,"9"),l.checkAutoOfficeExpert=!1,l.checkAutoAntiExpert=!1,n.success(t.reMsg)):n.error(t.reMsg)})}},l.affirmJoinExpert=function(){$("#confirmJoinExpert").kendoWindow({width:"960px",height:"600px",title:"参加评审会专家确认",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},l.updateToJoin=function(){var e=$("#notJoinExpertTable input[name='notJoinExpert']:checked");if(e.length<1)n.alert("请选择要改为参加会议的专家");else{for(var i=[],o=0;o<e.length;o++)i.push(e[o].value);t.updateJoinState(l.minBusinessId,l.businessType,i.join(","),"9",l.isCommit,function(t){n.success("操作成功！"),l.reFleshJoinState(i,"9")})}},l.updateToNotJoin=function(){var e=$("#joinExpertTable input[name='joinExpert']:checked");if(e.length<1)n.alert("请选择未参加会议的专家");else{for(var i=[],o=0;o<e.length;o++)i.push(e[o].value);t.updateJoinState(l.minBusinessId,l.businessType,i.join(","),"0",l.isCommit,function(t){n.success("操作成功！"),l.reFleshJoinState(i,"0")})}},l.checkScore=function(t){t.compositeScoreEnd&&t.compositeScore&&t.compositeScore>t.compositeScoreEnd?($("#compositeScoreEnd_"+t.id).html("分值设置错误"),t.compositeScoreEnd=""):$("#compositeScoreEnd_"+t.id).html("")},l.deleteAutoSelectEP=function(){var e=$("#autoDraftExpertTable input[name='checkSelectExpert']:checked");e.length>0?n.confirm({title:"询问提示",message:"删除数据不可恢复，确定删除么？",onOk:function(){for(var i=[],o=0;o<e.length;o++)i.push(e[o].value);t.delSelectedExpert(l.expertReview.id,i.join(","),l.isCommit,function(t){t.flag||"ok"==t.reCode?n.alert("删除成功！",function(){l.reFleshAfterRemove(i)}):n.alert(t.reMsg)})}}):n.alert("请选择要删除的抽取专家！")}}angular.module("app").controller("expertSelectCtrl",t),t.$inject=["expertReviewSvc","expertConditionSvc","expertSvc","$state","bsWin","$scope"]}(),function(){"use strict";function t(t,e){function i(e,i,o){var n={method:"post",url:rootPath+"/expertReview/initBybusinessId",params:{businessId:e,minBusinessId:i}},a=function(t){void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:t,httpOptions:n,success:a})}function o(){return[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.expertID)},filterable:!1,width:25,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"name",title:"姓名",width:100,filterable:!1,template:function(t){return"<a  ng-click=\"vm.findExportDetail('"+t.expertID+"')\">"+t.name+"</a>"}},{field:"degRee",title:"学位",width:100,filterable:!1},{field:"sex",title:"性别",width:50,filterable:!0},{field:"comPany",title:"工作单位",width:100,filterable:!1},{field:"degRee",title:"职务",width:100,filterable:!1},{field:"expertSort",title:"专家类别",width:100,filterable:!1}]}function n(t){var e=function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})},i=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findByOData",$("#selfSelExpertForm")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}});t.selfExpertOptions={dataSource:common.gridDataSource(i),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o(),dataBound:e,resizable:!0};var n=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findExpertFieldByOData",$("#outSelExpertForm")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}});t.outExpertOptions={dataSource:common.gridDataSource(n),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o(),dataBound:e,resizable:!0}}function a(e,i,o,n,a,r,s){r=!0;var l={method:"post",url:rootPath+"/expertReview/saveExpertReview",params:{businessId:e,minBusinessId:i,businessType:o,reviewId:angular.isUndefined(a)?"":a,expertIds:n,selectType:"2"}},c=function(t){r=!1,void 0!=s&&"function"==typeof s&&s(t.data)};common.http({$http:t,httpOptions:l,success:c,onError:function(t){r=!1}})}function r(e,i,o,n,a,r,s){r=!0;var l={method:"post",url:rootPath+"/expertReview/saveExpertReview",params:{businessId:e,minBusinessId:i,businessType:o,reviewId:angular.isUndefined(a)?"":a,expertIds:n,selectType:"3"}},c=function(t){r=!1,void 0!=s&&"function"==typeof s&&s(t.data)};common.http({$http:t,httpOptions:l,success:c,onError:function(t){r=!1}})}function s(e,i,o,n){var a={method:"post",url:rootPath+"/expert/countReviewExpert",data:e,params:{minBusinessId:i,reviewId:o}},r=function(t){void 0!=n&&"function"==typeof n&&n(t.data)};common.http({$http:t,httpOptions:a,success:r})}function l(e){var i={method:"get",url:rootPath+"/expertReview/html/getReviewList"},o=function(t){e.reviewList=t.data};common.http({vm:e,$http:t,httpOptions:i,success:o,onError:function(t){e.isCommit=!1}})}function c(e,i,o,n){var a={method:"post",url:rootPath+"/expert/autoExpertReview",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(e),params:{minBusinessId:i,reviewId:o}},r=function(t){void 0!=n&&"function"==typeof n&&n(t.data)};common.http({$http:t,httpOptions:a,success:r})}function d(t,i){var o=0,n=i.autoSelectedEPList.length,a=0,r=e(function(){if(0==n)e.cancel(r);else{var s=Math.floor(Math.random()*t.length);i.showAutoExpertName=t[s].name,o++,o%10==0&&(i.autoSelectedEPList[a].show=!0,i.autoSelectedEPList[a].official=!0,i.autoSelectedEPList[a+1].show=!0,i.autoSelectedEPList[a+1].official=!1,a+=2,n-=2)}},200)}function u(e,i,o,n,a,r){a=!0;var s={method:"post",url:rootPath+"/expertReview/updateJoinState",params:{minBusinessId:e,businessType:i,expertSelId:o,state:n}},l=function(t){void 0!=r&&"function"==typeof r&&r(t.data)};common.http({$http:t,httpOptions:s,success:l,onError:function(t){a=!1}})}function m(e,i,o,n,a){var r={method:"post",url:rootPath+"/expertReview/affirmAutoExpert",params:{minBusinessId:e,businessType:i,expertSelId:o,state:n}},s=function(t){void 0!=a&&"function"==typeof a&&a(t.data)};common.http({$http:t,httpOptions:r,success:s,onError:function(t){}})}function p(e,i,o,n){o=!0;var a={method:"delete",url:rootPath+"/expertSelected",params:{reviewId:e,id:i,deleteAll:!1}},r=function(t){o=!1,void 0!=n&&"function"==typeof n&&n(t.data)};common.http({$http:t,httpOptions:a,success:r,onError:function(t){o=!1}})}function f(e,i){var o={method:"post",url:rootPath+"/expertReview/initBybusinessId",params:{businessId:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n,onError:function(t){}})}function h(e,i){var o={method:"put",url:rootPath+"/expertSelected",data:e},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function g(e,i,o){if(!y(e))return void bsWin.alert("应纳税额计算错误,保存失败！");i=!0;var n={method:"post",url:rootPath+"/expertReview/saveExpertReviewCostSingle",data:e},a=function(t){i=!1,void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:t,httpOptions:n,success:a,onError:function(){i=!1}})}function v(e,i,o){var n=rootPath+"/expertReview/getExpertReviewCost?expertIds={0}&month={1}",a={method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded"},url:common.format(n,e,i)},r=function(t){void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:t,httpOptions:a,success:r})}function y(t){var e=!0;return void 0!=t&&t.length>0&&t.forEach(function(t,i){if(void 0==t.payDate)return t.errorMsg="请选择发放日期",void(e=!1);t.errorMsg="";var o=void 0==t.reviewCost?0:t.reviewCost,n=void 0==t.reviewTaxes?0:t.reviewTaxes,a=void 0==t.totalCost?0:t.totalCost;if(void 0!=t.expertSelectedDtoList&&t.expertSelectedDtoList.length>0){var r=0,s=0,l=0;if(t.expertSelectedDtoList.forEach(function(t,i){var o=void 0==t.reviewCost?0:t.reviewCost,n=void 0==t.reviewTaxes?0:t.reviewTaxes,a=void 0==t.totalCost?0:t.totalCost;if((parseFloat(o)+parseFloat(n)).toFixed(2)!=parseFloat(a).toFixed(2))return void(e=!1);r=parseFloat(r)+parseFloat(o),s=parseFloat(s)+parseFloat(n),l=parseFloat(l)+parseFloat(a)}),parseFloat(r).toFixed(2)!=parseFloat(o).toFixed(2))return void(e=!1);if(parseFloat(s).toFixed(2)!=parseFloat(n).toFixed(2))return void(e=!1);if(parseFloat(l).toFixed(2)!=parseFloat(a).toFixed(2))return void(e=!1)}}),e}function w(e,i){var o={method:"post",url:rootPath+"/expertReview/refleshBusinessEP",params:{businessId:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n,onError:function(){}})}return{initExpertGrid:n,saveSelfExpert:a,saveOutExpert:r,countMatchExperts:s,getReviewList:l,initReview:i,delSelectedExpert:p,queryAutoExpert:c,validateAutoExpert:d,affirmAutoExpert:m,updateJoinState:u,findByBusinessId:f,saveMark:h,savePayment:g,countTaxes:v,refleshBusinessEP:w}}angular.module("app").factory("expertReviewSvc",t),t.$inject=["$http","$interval"]}(),function(){"use strict";function t(t){function e(e,i,o,n,a,r){var s={method:"post",url:rootPath+"/expertSelCondition/saveConditionList",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(a),params:{businessId:e,minBusinessId:i,reviewId:n,businessType:o}},l=function(t){void 0!=r&&"function"==typeof r&&r(t.data)};common.http({$http:t,httpOptions:s,success:l})}function i(t){return!!(/^(\+|-)?\d+$/.test(t)&&t>0)}function o(e,i,o){i=!0;var n={method:"delete",url:rootPath+"/expertSelCondition",params:{ids:e}},a=function(t){void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:t,httpOptions:n,success:a,onError:function(t){i=!1}})}return{saveCondition:e,deleteSelConditions:o,isUnsignedInteger:i}}angular.module("app").factory("expertConditionSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e,i,o){function n(e,i){var o={method:"get",url:rootPath+"/fileLibrary/getFileUrlById",params:{fileId:i}},n=function(t){e.fileUrl=t.data.fileUrl,e.title=t.data.fileUrl,e.initFileUpload()};common.http({vm:e,$http:t,httpOptions:o,success:n})}function a(t){t.gridOptions.dataSource._skip=0,t.gridOptions.dataSource.read()}function r(e,i){var o={method:"delete",url:rootPath+"/fileLibrary/deleteRootDirectory",params:{parentFileId:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function s(e,i){var o={method:"delete",url:rootPath+"/fileLibrary/deleteFile",params:{fileId:e}},n=function(t){void 0!=i&&"function"==typeof i&&i()};common.http({$http:t,httpOptions:o,success:n})}function l(e,i){var o={method:"put",url:rootPath+"/fileLibrary/updateFile",data:e.fileLibrary},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({vm:e,$http:t,httpOptions:o,success:n})}function c(e,i){var o={method:"get",url:rootPath+"/fileLibrary/findFileById",params:{fileId:i}},n=function(t){e.fileLibrary=t.data,e.addFolderWindow()};common.http({vm:e,$http:t,httpOptions:o,success:n})}function d(e,i){var o={method:"get",url:rootPath+"/fileLibrary/findFileById",params:{fileId:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function u(e,i){if(common.initJqValidation(),$("form").valid()){var o={method:"post",url:rootPath+"/fileLibrary/saveFile",data:e.fileLibrary},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({vm:e,$http:t,httpOptions:o,success:n})}}function m(e,i,o){var n={method:"get",url:rootPath+"/fileLibrary/initFileFolder",params:{fileType:e.fileLibrary.fileType}},a=function(t){void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:t,httpOptions:n,success:a})}function p(e,i){var o={method:"post",url:rootPath+"/fileLibrary/addFileFolder",data:e},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function f(e,i){if(void 0!=e.fileName){var o={method:"post",url:rootPath+"/fileLibrary/addFileFolder",data:e},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}else common.alert({vm:vm,msg:"文件名不能为空",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}})}function h(e,i,o){var n={method:"post",url:rootPath+"/fileLibrary/initFileList",params:{fileId:e,fileType:i}},a=function(t){void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:t,httpOptions:n,success:a})}return{saveRootFolder:p,saveChildFolder:f,initFileFolder:m,initFileList:h,saveFile:u,findFileById:d,updateFile:l,deleteFile:s,deleteRootDirectory:r,folderById:c,queryUser:a,getFileUrlById:n}}angular.module("app").factory("fileLibrarySvc",t),t.$inject=["$http","$state","$location","sysfileSvc"]}(),function(){"use strict";function t(t,e,i,o,n,a,r){function s(){o.initFileFolder(l,t,function(e){function i(e,i,o){l.parentFileId=o.fileId,"FOLDER"==o.fileNature&&(l.policyList=[],o.children&&(l.policyList=o.children),t.$apply()),"FILE"==o.fileNature&&l.fileEdit(l.parentFileId)}function o(t,e,i){var o=$.fn.zTree.getZTreeObj("zTree"),i=o.getSelectedNodes();l.onRemove(i.id)}function n(t,e){if("FOLDER"==e.fileNature){var i=$("#"+e.tId+"_span");if(e.editNameFlag||$("#addBtn_"+e.tId).length>0)return;var o="<span class='button add' id='addBtn_"+e.tId+"' title='添加子节点' onfocus='this.blur();'></span>";i.after(o);var n=$("#addBtn_"+e.tId);n&&n.bind("click",function(){$.fn.zTree.getZTreeObj("zTree");l.addFolderWindow(e.id)})}}function r(t,e){$("#addBtn_"+e.tId).unbind().remove()}var s,c={check:{enable:!0,chkStyle:"radio",chkboxType:{Y:"",N:""}},edit:{enable:!0,showRenameBtn:!1,showRemoveBtn:!1,showAddBtn:!0,removeTitle:"删除节点"},view:{addHoverDom:n,removeHoverDom:r,dblClickExpand:!0},callback:{onClick:i,beforeRemove:o},data:{simpleData:{enable:!0,idKey:"id",pIdKey:"pId"},showTitle:!0,key:{title:"fileName"}}};l.zNodes=$linq(e).select(function(t){var e=t;return e=t,e.id=t.fileId,e.name=t.fileName,e.pId=t.parentFileId,"FOLDER"==t.fileNature&&(e.icon=rootPath+"/contents/libs/zTree/css/zTreeStyle/img/diy/7.png"),e}).toArray(),l.initFileTreeSucess=!0,t.$watch("vm.initFileTreeSucess",function(t,e){if(1==t)var i=a(function(){for(var t=document.getElementById("zTree"),e=0;e<l.zNodes.length;e++)if(l.zNodes[e].name.length>7){var o=l.zNodes[e].name.substring(0,7);l.zNodes[e].name=o+"..."}null!=t&&(s=$.fn.zTree.init($("#zTree"),c,l.zNodes),a.cancel(i))},500)})}),l.initFileUpload()}var l=this;l.parentId=e.params.parentId,l.fileId=e.params.fileId,l.fileLibrary={},l.fileLibrary.fileType="POLICY",l.fileType="POLICY",l.initFileUpload=function(){l.fileId||t.$watch("vm.fileId",function(t,e){t&&t!=e&&!l.initUploadOptionSuccess&&l.initFileUpload()}),l.sysFile={businessId:l.fileId,mainId:l.fileId,mainType:r.mainTypeValue().POLICYLIBRARY,sysBusiType:void 0==l.fileUrl?"":l.fileUrl.substring(l.fileUrl.lastIndexOf(r.mainTypeValue().POLICYLIBRARY),l.fileUrl.lastIndexOf(l.fileName)),showBusiType:!1},r.initUploadOptions({inputId:"sysfileinput",vm:l,uploadSuccess:function(){r.findByBusinessId(l.fileId,function(t){l.sysFilelists=t,o.initFileList(l.parentFileId,l.fileType,function(t){l.policyList=t.reObj})})}})},s(),l.addFolderWindow=function(t){l.fileLibrary={},l.fileLibrary.fileType="POLICY",void 0!=t&&(l.fileLibrary.parentFileId=t),$("#addRootFolder").kendoWindow({width:"500px",height:"300px",title:"新建文件夹",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()},l.saveRootFolder=function(){void 0!=l.fileLibrary.fileName?o.saveRootFolder(l.fileLibrary,function(t){t.flag||"ok"==t.reCode?n.alert("保存成功！",function(){window.parent.$("#addRootFolder").data("kendoWindow").close(),e.go("policyLibrary",{},{reload:!0})}):n.error(t.reMsg)}):n.alert("文件名不能为空!")},l.deleteFolder=function(){var t=$.fn.zTree.getZTreeObj("zTree"),i=t.getCheckedNodes();if(void 0!=i&&i.length>0){var a=i[0].id;n.confirm("删除的文件将无法恢复，确认删除？",function(){o.deleteRootDirectory(a,function(t){t.flag||"ok"==t.reCode?(n.success("操作成功！"),e.go("policyLibrary",{},{reload:!0})):n.error(t.reMsg)})})}},l.fileEdit=function(t){l.isUpdate=!1,l.fileId=t,l.fileLibrary={},l.sysFilelists={},l.fileLibrary.fileType="POLICY",l.fileId&&(l.isUpdate=!0,o.findFileById(l.fileId,function(t){l.fileLibrary=t,l.fileUrl=l.fileLibrary.fileUrl,
l.fileName=l.fileLibrary.fileName,l.initFileUpload()}),r.findByBusinessId(l.fileId,function(t){l.sysFilelists=t})),$("#qualityEdit").kendoWindow({width:"800px",height:"500px",title:"文件编辑",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()},l.createFile=function(){l.fileLibrary.parentFileId=l.parentFileId,common.initJqValidation(),l.fileLibrary.fileName&&o.saveFile(l,function(t){t.flag||"ok"==t.reCode?n.alert("保存成功！",function(){window.parent.$("#qualityEdit").data("kendoWindow").close(),s(),l.policyList.push(t.reObj),l.fileId=t.reObj.fileId,o.getFileUrlById(l,l.fileId),l.initFileUpload()}):n.error(t.reMsg)})},l.updateFile=function(){o.updateFile(l,function(t){t.flag||"ok"==t.reCode?n.alert("更新成功！",function(){l.initFileUpload(),window.parent.$("#qualityEdit").data("kendoWindow").close(),s()}):n.error(t.reMsg)})},l.del=function(t){n.confirm("删除的数据将无法恢复，确认删除？",function(){var e=$.fn.zTree.getZTreeObj("zTree"),i=e.getNodeByParam("id",t,null);e.removeNode(i),o.deleteFile(t,function(){l.policyList.forEach(function(e,i){e.fileId==t&&l.policyList.splice(i,1)})})})},l.commonDownloadSysFile=function(t){r.downloadFile(t)},l.delFile=function(t){r.delSysFile(t,function(){$.each(l.sysFilelists,function(e,i){i.sysFileId==t&&l.sysFilelists.splice(e,1)}),o.initFileList(l.parentFileId,l.fileType,function(t){l.policyList=t.reObj})})}}angular.module("app").controller("policyCtrl",t),t.$inject=["$scope","$state","$location","fileLibrarySvc","bsWin","$interval","sysfileSvc"]}(),function(){"use strict";function t(t,e,i,o,n){var a=this;a.parentId=t.params.parentId,a.fileLibrary={},a.fileLibrary.parentFileId=a.parentId,a.fileLibrary.fileType="POLICY",a.fileId=t.params.fileId,a.fileUrl="",a.fileName="",a.businessFlag={isInitFileOption:!1},a.initFileUpload=function(){a.fileId||o.$watch("vm.fileId",function(t,e){t&&t!=e&&!a.initUploadOptionSuccess&&a.initFileUpload()}),a.sysFile={businessId:a.fileId,mainId:"",mainType:i.mainTypeValue().POLICYLIBRARY,sysBusiType:a.fileUrl.substring(a.fileUrl.lastIndexOf(i.mainTypeValue().POLICYLIBRARY),a.fileUrl.lastIndexOf(a.fileName))},i.initUploadOptions({inputId:"sysfileinput",vm:a,uploadSuccess:function(){i.findByBusinessId(a.fileId,function(t){a.sysFilelists=t})}})},function(){a.fileId&&(a.isUpdate=!0,e.findFileById(a,a.fileId),i.findByBusinessId(a.fileId,function(t){a.sysFilelists=t})),a.parentId&&(e.getFileUrlById(a,a.parentId),e.initFileList(a))}(),a.createFile=function(){e.saveFile(a,function(t){t.flag||"ok"==t.reCode?n.alert("保存成功！",function(){a.fileId=t.reObj.fileId,a.initFileUpload()}):n.error(t.reMsg)})},a.updateFile=function(){e.updateFile(a,function(t){t.flag||"ok"==t.reCode?(n.alert("更新成功！"),a.initFileUpload()):n.error(t.reMsg)})}}angular.module("app").controller("policyEditCtrl",t),t.$inject=["$state","fileLibrarySvc","sysfileSvc","$scope","bsWin"]}(),function(){"use strict";function t(t,e,i){var o=this;o.parentId=t.params.parentId,o.fileLibrary={},o.fileLibrary.parentFileId=o.parentId,o.fileLibrary.fileType="POLICY",o.formId="policyForm",function(){e.initFileList(o)}(),o.addFile=function(){t.go("policyLibrary.policyEdit",{parentId:o.parentId,fileId:""})},o.update=function(e){t.go("policyLibrary.policyEdit",{parentId:o.parentId,fileId:e})},o.del=function(t){i.confirm("删除的数据将无法恢复，确认删除？",function(){e.deleteFile(o,t)})},o.queryPolicy=function(){e.queryUser(o)},o.resetPolicy=function(){var t=$("#policyForm").find("input");$.each(t,function(t,e){e.value=""})}}angular.module("app").controller("policyListCtrl",t),t.$inject=["$state","fileLibrarySvc","bsWin"]}(),function(){"use strict";function t(t,e,i,o,n,a,r){function s(){o.initFileFolder(l,n,function(t){function e(t,e,i){s.checkNode(i,!i.checked,!0),l.parentFileId=i.fileId,"FOLDER"==i.fileNature&&(l.qualityList=[],i.children&&(l.qualityList=i.children),n.$apply()),"FILE"==i.fileNature&&l.fileEdit(l.parentFileId)}function i(t,e,i){l.onRemove(i.id)}function o(t,e){if("FOLDER"==e.fileNature){var i=$("#"+e.tId+"_span");if(e.editNameFlag||$("#addBtn_"+e.tId).length>0)return;var o="<span class='button add' id='addBtn_"+e.tId+"' title='添加子节点' onfocus='this.blur();'></span>";i.after(o);var n=$("#addBtn_"+e.tId);n&&n.bind("click",function(){$.fn.zTree.getZTreeObj("zTree");l.addFolderWindow(e.id)})}}function r(t,e){$("#addBtn_"+e.tId).unbind().remove()}var s,c={check:{enable:!0,chkStyle:"radio",chkboxType:{Y:"",N:""}},edit:{enable:!0,showRenameBtn:!1,showRemoveBtn:!1,showAddBtn:!0,removeTitle:"删除节点"},view:{addHoverDom:o,removeHoverDom:r,dblClickExpand:!0},callback:{onClick:e,beforeRemove:i},data:{simpleData:{enable:!0,idKey:"id",pIdKey:"pId"},showTitle:!0,key:{title:"fileName"}}};l.zNodes=$linq(t).select(function(t){var e=t;return e=t,e.id=t.fileId,e.name=t.fileName,e.pId=t.parentFileId,"FOLDER"==t.fileNature&&(e.icon=rootPath+"/contents/libs/zTree/css/zTreeStyle/img/diy/7.png"),e}).toArray(),l.initFileTreeSucess=!0,n.$watch("vm.initFileTreeSucess",function(t,e){if(1==t)var i=a(function(){for(var t=document.getElementById("zTree"),e=0;e<l.zNodes.length;e++)if(l.zNodes[e].name.length>7){var o=l.zNodes[e].name.substring(0,7);l.zNodes[e].name=o+"..."}null!=t&&(s=$.fn.zTree.init($("#zTree"),c,l.zNodes),a.cancel(i))},500)})}),l.initFileUpload()}var l=this;l.parentId=e.params.parentId,l.fileId=e.params.fileId,l.fileLibrary={},l.fileLibrary.fileType="QUALITY",l.fileType="QUALITY",l.qualityList=[],l.initFileUpload=function(){l.fileId||n.$watch("vm.fileId",function(t,e){t&&t!=e&&!l.initUploadOptionSuccess&&l.initFileUpload()}),l.sysFile={businessId:l.fileId,mainId:l.fileId,mainType:r.mainTypeValue().FILELIBRARY,sysBusiType:void 0==l.fileUrl?"":l.fileUrl.substring(l.fileUrl.lastIndexOf(r.mainTypeValue().FILELIBRARY),l.fileUrl.lastIndexOf(l.fileName)),showBusiType:!1},r.initUploadOptions({inputId:"sysfileinput",vm:l,uploadSuccess:function(){r.findByBusinessId(l.fileId,function(t){l.sysFilelists=t,o.initFileList(l.parentFileId,l.fileType,function(t){l.qualityList=t.reObj})})}})},s(),l.addFolderWindow=function(t){console.log(l.fileLibrary),l.fileLibrary={},l.fileLibrary.fileType="QUALITY",void 0!=t&&(l.fileLibrary.parentFileId=t),$("#addRootFolder").kendoWindow({width:"600px",height:"300px",title:"创建文件夹",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()},l.saveRootFolder=function(){void 0!=l.fileLibrary.fileName?o.saveRootFolder(l.fileLibrary,function(i){i.flag||"ok"==i.reCode?t.alert("保存成功！",function(){window.parent.$("#addRootFolder").data("kendoWindow").close(),e.go("fileLibrary",{},{reload:!0})}):t.error(i.reMsg)}):t.alert("文件名不能为空!")},n.onRemove=function(e){t.confirm("删除的文件将无法恢复，确认删除？",function(){o.deleteRootDirectory(e,function(e){return e.flag||"ok"==e.reCode?(t.success("操作成功！"),!0):(t.error(e.reMsg),!1)})})},l.deleteFolder=function(){var i=$.fn.zTree.getZTreeObj("zTree"),n=i.getCheckedNodes();if(void 0!=n&&n.length>0){var a=n[0].id;t.confirm("删除的文件将无法恢复，确认删除？",function(){o.deleteRootDirectory(a,function(i){i.flag||"ok"==i.reCode?(t.success("操作成功！"),e.go("fileLibrary",{},{reload:!0})):t.error(i.reMsg)})})}},l.fileEdit=function(t){l.isUpdate=!1,l.fileId=t,l.fileLibrary={},l.sysFilelists={},l.fileLibrary.fileType="QUALITY",l.fileId&&(l.isUpdate=!0,o.findFileById(l.fileId,function(t){l.fileLibrary=t,l.fileUrl=l.fileLibrary.fileUrl,l.fileName=l.fileLibrary.fileName,l.initFileUpload()}),r.findByBusinessId(l.fileId,function(t){l.sysFilelists=t})),$("#qualityEdit").kendoWindow({width:"800px",height:"500px",title:"文件编辑",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()},l.createFile=function(){l.fileLibrary.parentFileId=l.parentFileId,common.initJqValidation(),l.fileLibrary.fileName&&o.saveFile(l,function(e){e.flag||"ok"==e.reCode?t.alert("保存成功！",function(){window.parent.$("#qualityEdit").data("kendoWindow").close(),l.qualityList.push(e.reObj),l.fileId=e.reObj.fileId,o.getFileUrlById(l,l.fileId),l.initFileUpload(),s()}):t.error(e.reMsg)})},l.updateFile=function(){o.updateFile(l,function(e){e.flag||"ok"==e.reCode?t.alert("更新成功！",function(){l.initFileUpload(),window.parent.$("#qualityEdit").data("kendoWindow").close(),s()}):t.error(e.reMsg)})},l.del=function(e){t.confirm("删除的数据将无法恢复，确认删除？",function(){var t=$.fn.zTree.getZTreeObj("zTree"),i=t.getNodeByParam("id",e,null);t.removeNode(i),o.deleteFile(e,function(){l.qualityList.forEach(function(t,i){t.fileId==e&&l.qualityList.splice(i,1)})})})},l.commonDownloadSysFile=function(t){r.downloadFile(t)},l.delFile=function(t){r.delSysFile(t,function(){$.each(l.sysFilelists,function(e,i){i.sysFileId==t&&l.sysFilelists.splice(e,1)}),o.initFileList(l.parentFileId,l.fileType,function(t){l.qualityList=t.reObj})})}}angular.module("app").controller("qualityCtrl",t),t.$inject=["bsWin","$state","$location","fileLibrarySvc","$scope","$interval","sysfileSvc"]}(),function(){"use strict";function t(t,e,i,o,n){var a=this;a.parentId=t.params.parentId,a.fileLibrary={},a.fileLibrary.parentFileId=a.parentId,a.fileLibrary.fileType="QUALITY",a.fileId=t.params.fileId,a.fileUrl="",a.fileName="",a.businessFlag={isInitFileOption:!1},a.initFileUpload=function(){a.fileId||o.$watch("vm.fileId",function(t,e){t&&t!=e&&!a.initUploadOptionSuccess&&a.initFileUpload()}),a.sysFile={businessId:a.fileId,mainId:"",mainType:i.mainTypeValue().FILELIBRARY,sysBusiType:a.fileUrl.substring(a.fileUrl.lastIndexOf(i.mainTypeValue().FILELIBRARY),a.fileUrl.lastIndexOf(a.fileName))},i.initUploadOptions({inputId:"sysfileinput",vm:a,uploadSuccess:function(){i.findByBusinessId(a.fileId,function(t){a.sysFilelists=t})}})},function(){a.fileId&&(a.isUpdate=!0,e.findFileById(a,a.fileId),i.findByBusinessId(a.fileId,function(t){a.sysFilelists=t})),a.parentId&&(e.getFileUrlById(a,a.parentId),e.initFileList(a))}(),a.createFile=function(){e.saveFile(a,function(t){t.flag||"ok"==t.reCode?n.alert("保存成功！",function(){a.fileId=t.reObj.fileId,a.initFileUpload()}):n.error(t.reMsg)})},a.updateFile=function(){e.updateFile(a,function(t){t.flag||"ok"==t.reCode?n.alert("更新成功！",function(){a.initFileUpload()}):n.error(t.reMsg)})}}angular.module("app").controller("qualityEditCtrl",t),t.$inject=["$state","fileLibrarySvc","sysfileSvc","$scope","bsWin"]}(),function(){"use strict";function t(t,e,i,o,n){var a=this;a.parentId=t.params.parentId,a.fileLibrary={},a.fileLibrary.parentFileId=a.parentId,a.fileLibrary.fileType="QUALITY",a.formId="fileForm",function(){e.initFileList(a)}(),a.addFile=function(){t.go("fileLibrary.fileEdit",{parentId:a.parentId,fileId:""})},a.update=function(e){t.go("fileLibrary.fileEdit",{parentId:a.parentId,fileId:e})},a.del=function(t){n.confirm("删除的数据将无法恢复，确认删除？",function(){e.deleteFile(a,t)})},a.queryUser=function(){e.queryUser(a)},a.resetUser=function(){var t=$("#fileForm").find("input");$.each(t,function(t,e){e.value=""})}}angular.module("app").controller("qualityListCtrl",t),t.$inject=["$state","fileLibrarySvc","sysfileSvc","$scope","bsWin"]}(),function(){"use strict";function t(t,e,i,o,n,a,r){var s=this;s.title="项目归档编辑",s.fileRecord={},s.fileRecord.signId=e.params.signid,s.fileRecord.fileRecordId="",s.signId=e.params.signid,s.isControl=e.params.isControl,s.isassistproc=!1,s.drawingFile=[],s.otherFile=[],s.declareFile=[],s.initFileUpload=function(){s.fileRecord.fileRecordId||n.$watch("vm.fileRecord.fileRecordId",function(t,e){t&&t!=e&&!s.initUploadOptionSuccess&&s.initFileUpload()}),s.sysFile={businessId:s.fileRecord.fileRecordId,mainId:s.signId,mainType:i.mainTypeValue().SIGN,sysfileType:i.mainTypeValue().DOFILE,sysBusiType:i.mainTypeValue().DOFILE},i.initUploadOptions({inputId:"sysfileinput",vm:s})},function(){t.initFileRecordData(s)}(),s.create=function(){t.saveFileRecord(s,function(t){s.isCommit=!1,t.flag||"ok"==t.reCode?(s.fileRecord=t.reObj,s.fileRecord.signId=s.signId,o.success("操作成功！")):o.error(response.data.reMsg)})},s.templatePage=function(t){a.templatePage(t)},s.addOtherFile=function(t,e){s.addRegisters||(s.addRegisters=[]),t?("2"==e?(s.addRegisters=s.drawingFile,s.showFilePage=!0,s.showFileOther=!1,s.showSignOther=!1):(s.addRegisters=s.otherFile,s.showFileOther=!0,s.showFilePage=!1,s.showSignOther=!1),s.businessId=t,s.businessType=e,$("#addOtherFile").kendoWindow({width:"840px",height:"480px",title:"补充资料编辑",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()):o.alert("请先保存数据！")},s.addRegisterFile=function(){s.addRegister={},s.addRegister.businessId=s.businessId,s.addRegister.id=common.uuid(),s.addRegisters.push(s.addRegister)},s.saveRegisterFile=function(){r.saveRegisterFile(s.addRegisters,function(t){t.flag||"ok"==t.reCode?(o.alert("操作成功"),s.addRegisters=t.reObj):o.alert(t.reMsg)})},s.deleteRegisterFile=function(){var t=$("#addOtherFile input[name='addRegistersCheck']:checked");if(t.length<1)o.alert("请选择要删除的记录！");else{for(var e=[],i=0;i<t.length;i++)s.addRegisters.forEach(function(o,n){o.id&&t[i].value==o.id&&(e.push(t[i].value),s.addRegisters.splice(n,1))});e.length>0&&r.deleteByIds(e.join(","),function(t){o.alert("删除成功！")})}}}angular.module("app").controller("fileRecordEditCtrl",t),t.$inject=["fileRecordSvc","$state","sysfileSvc","bsWin","$scope","templatePrintSvc","addRegisterFileSvc"]}(),function(){"use strict";function t(t,e){function i(t){t.otherFile=[];var i={method:"get",url:rootPath+"/fileRecord/initFillPage",params:{signId:t.fileRecord.signId}},o=function(e){null!=e.data&&""!=e.data&&(t.fileRecord=e.data.file_record,t.fileRecord.signId=t.signId,t.signUserList=e.data.sign_user_List,t.isassistproc="9"==t.fileRecord.isassistproc,t.fileRecord.registerFileDto.forEach(function(e,i){5==e.businessType||6==e.businessType||7==e.businessType?t.otherFile.push(e):2==e.businessType&&t.drawingFile.push(e)}),t.initFileUpload())};common.http({vm:t,$http:e,httpOptions:i,success:o})}function o(t,i){if(common.initJqValidation($("#fileRecord_form")),$("#fileRecord_form").valid()){t.signUserList.forEach(function(e,i){t.fileRecord.signUserid==e.id&&(t.fileRecord.signUserName=e.displayName)}),t.isCommit=!0;var o={method:"post",url:rootPath+"/fileRecord",data:t.fileRecord},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:e,httpOptions:o,success:n,onError:function(e){t.isCommit=!1}})}}return{initFileRecordData:i,saveFileRecord:o}}angular.module("app").factory("fileRecordSvc",t),t.$inject=["bsWin","$http"]}(),function(){"use strict";function t(t,e,i,o,n,a){function r(){"REVIEW"==s.costType&&(n.initSignList(function(t){(t.flag||"ok"==t.reCode)&&(s.orgDeptList=t.reObj)}),t.initfinancial(s,function(t){s.stageCountList=t})),"ASSIST"==s.costType&&a.findSingAssistCostList(s.signAssistCost,function(t){s.signAssistCostList=t})}var s=this;s.sign={},s.financial={},s.model={},s.signAssistCost={},s.isuserExist=!1,s.id=e.params.id,s.financial.businessId=e.params.businessId,s.costType=e.params.costType,"REVIEW"==s.costType&&(s.title="评审费统计管理",s.titleName="专家评审费",s.windowName="专家评审费录入"),"ASSIST"==s.costType&&(s.title="协审费统计管理",s.titleName="专家协审费",s.windowName="专家协审费录入"),s.addCostWindow=function(e){s.signAssistCostCounList={},s.expertSelectedDtoList={},s.signAssistCost={},"REVIEW"==s.costType&&(t.sumFinancial(s,e.businessId),s.businessId=e.businessId,s.projectName=e.projectname),"ASSIST"==s.costType&&(s.businessId=e.signId,s.projectName=e.projectName),t.initFinancialProject(s.businessId,function(t){s.financial={},s.financial.businessId=s.businessId,s.financial.projectName=s.projectName,s.financial.paymentData=t.financialDto.paymentData,o.initReview(s.financial.businessId,"",function(t){s.expertReview=t,s.reviewTitle=t.reviewTitle,s.payDate=t.payDate,s.expertSelectedDtoList=t.expertSelectedDtoList,s.expertSelectedDtoList&&s.expertSelectedDtoList.length>0&&(s.showReviewCost=!0)}),s.signAssistCost.signId=s.businessId,a.findSingAssistCostCount(s.signAssistCost,function(t){s.signAssistCostCounList=t,s.signAssistCostCounList&&s.signAssistCostCounList.length>0&&(s.showAssistCost=!0)}),s.financials=t.financiallist,s.countCost(),$("#addCostWindow").kendoWindow({width:"70%",height:"600px;",title:s.windowName,visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()})},s.costExportExcel=function(){var e=s.reviewTitle+"("+s.payDate+")";t.exportExcel(s,s.financial.businessId,e)},s.countCost=function(){var t=0;s.financials&&s.financials.length>0&&angular.forEach(s.financials,function(e,i){e.charge&&(t+=e.charge)}),$("#financialCount").html(t)},s.changeName=function(t,e){if(s.financials.length>0)for(var o=0;o<s.financials.length-1;o++)o!=t&&void 0!=s.financials[o].chargeName&&s.financials[o].chargeName==e&&(i.alert("该费用已经录入，不能重复录入！"),s.financials[t]={})},s.addFinancial=function(){var t={};t.chargeType="8",t.businessId=s.financial.businessId,t.projectName=s.financial.projectName,t.paymentData=s.financial.paymentData,s.financials||(s.financials=[]),s.financials.push(t)},s.saveFinancial=function(){common.initJqValidation($("#fnFrom")),$("#fnFrom").valid()?t.savefinancial(s.financials,function(t){t.flag||"ok"==t.reCode?(s.financials=t.reObj,i.success(t.reMsg),$("#addCostWindow").data("kendoWindow").close()):i.error(t.reMsg)}):i.error("费用信息填写不正确！")},s.deleteFinancial=function(){var e=$("#financialsTable input[name='financialsCheck']:checked");if(e.length<1)common.alert({vm:s,msg:"请选择要删除的记录！"});else for(var i=[],o=0;o<e.length;o++){s.financials.forEach(function(t,n){e[o].value!=t.id&&void 0!=t.id||s.financials.splice(n,1),i.push(e[o].value)});var n=i.join(",");t.deleteFinancialManager(n,function(t){})}},s.queryUser=function(){r()},s.resetQuery=function(){s.financial={}},r()}angular.module("app").controller("addCostCtrl",t),t.$inject=["financialManagerSvc","$state","bsWin","expertReviewSvc","adminSvc","assistCostCountSvc"]}(),function(){"use strict";function t(t,e,i,o){function n(n,a,r,s){n.financial={},void 0==r.businessId&&(void 0==r.signid?r.businessId=r.signId:r.businessId=r.signid),r.projectname||(r.projectname=r.projectName),"REVIEW"==a?(n.windowName="项目评审费录入",n.financial.businessType="SIGN",n.financial.chargeType="1"):"ASSIST"==a&&(n.windowName="项目协审费录入",n.financial.businessType="SIGN",n.financial.chargeType="2"),n.financial.businessId=r.businessId,n.financial.projectName=r.projectname,n.costExportExcel=function(){var t=n.expertReview.reviewTitle+"("+n.expertReview.payDate+")";e.exportExcel(n,n.financial.businessId,t)},n.countCost=function(){var t=0;n.financials&&n.financials.length>0&&angular.forEach(n.financials,function(e,i){e.charge&&(t+=e.charge)}),$("#financialCount").html(t)},n.addFinancial=function(){var t={};t.businessId=n.financial.businessId,t.projectName=n.financial.projectName,t.paymentData=n.financial.paymentData,t.chargeType=n.financial.chargeType,n.financials||(n.financials=[]),n.financials.push(t)},n.saveFinancial=function(){common.initJqValidation($("#fnFrom")),$("#fnFrom").valid()?(angular.forEach(n.financials,function(t,e){t.paymentData=n.financial.paymentData}),e.savefinancial(n.financials,function(e){e.flag||"ok"==e.reCode?(n.financials=e.reObj,t.success(e.reMsg,function(){$("#"+s).data("kendoWindow").close()})):t.error(e.reMsg)})):t.error("费用信息填写不正确！")},n.deleteFinancial=function(){var i=$("#financialsTable input[name='financialsCheck']:checked");i.length<1?t.alert("请选择要删除的记录！"):t.confirm({title:"询问提示",message:"确认删除？",onOk:function(){for(var t=[],o=0;o<i.length;o++){n.financials.forEach(function(e,a){i[o].value!=e.id&&void 0!=e.id||n.financials.splice(a,1),t.push(i[o].value)});var a=t.join(",")}e.deleteFinancialManager(a,function(t){n.countCost()})}})},n.count=function(){n.countCost()},e.initFinancialProject(n.financial,function(t){n.financials=t.financiallist,n.financials&&n.financials.length>0&&(n.countCost(),n.financials[0].paymentData&&(n.financial.paymentData=new Date(n.financials[0].paymentData.CompatibleDate()).Format("yyyy-MM-dd"))),i.initReview(n.financial.businessId,"",function(t){n.expertReview=t}),"ASSIST"==a&&o.findSignCostBySignId(n.financial.businessId,function(t){n.signAssistCostCounList=t}),$("#"+s).kendoWindow({width:"70%",height:"560",title:n.windowName,visible:!1,modal:!0,closable:!0,close:function(){n.financial={},n.expertReview={},n.financials={},n.signAssistCostCounList={}},actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()})}return{initAddCost:n}}angular.module("app").factory("addCostSvc",t),t.$inject=["bsWin","financialManagerSvc","expertReviewSvc","assistCostCountSvc"]}(),function(){"use strict";function t(t,e,i,o){var n=this;n.title="协审费录入",n.financials=new Array,n.financial={},n.financial.businessId=i.params.signid,function(){e.initAssistProject(n.financial.businessId,function(t){n.model=t.financialDto,n.financials=t.financiallist,n.countCost()})}(),n.countCost=function(){if(n.financials&&n.financials.length>0){var t=0;angular.forEach(n.financials,function(e,i){e.charge&&(t+=e.charge)}),$("#financialCount").html(t)}},n.addFinancial=function(){var t={};t.chargeType="8",t.businessId=n.model.businessId,t.projectName=n.model.projectName,t.paymentData=n.model.paymentData,n.financials||(n.financials=[]),n.financials.push(t)},n.saveFinancial=function(){e.savefinancial(n.financials,function(e){e.flag||"ok"==e.reCode?(n.financials=e.reObj,n.model.paymentData||(n.model.paymentData=n.financials[0].paymentData),n.countCost(),t.success(e.reMsg)):t.error(e.reMsg)})},n.deleteFinancial=function(){var i=$("#financialsTable input[name='financialsCheck']:checked");if(i.length<1)common.alert({vm:n,msg:"请选择要删除的记录！"});else{for(var o=[],a=0;a<i.length;a++)n.financials.forEach(function(t,e){void 0!=t.id&&i[a].value!=t.id||n.financials.splice(e,1),i[a].value&&o.push(i[a].value)});if(o.length>0){var r=o.join(",");e.deleteFinancialManager(r,function(e){n.countCost(),t.alert("操作成功！！")})}}}}angular.module("app").controller("assistCostEditCtrl",t),t.$inject=["bsWin","financialManagerSvc","$state","expertReviewSvc"]}(),function(){"use strict";function t(t,e,i,o){function n(){a.isSubmit=!0,a.nodata=!1,e.findSingAssistCostList(a.signAssistCost,function(t){a.isSubmit=!1,a.signAssistCostList=t,a.signAssistCostList&&0!=a.signAssistCostList.length||(a.nodata=!0)})}var a=this;a.title="协审费录入",a.signAssistCost={},a.signAssistCost.beginTime=(new Date).halfYearAgo(),a.signAssistCost.endTime=(new Date).Format("yyyy-MM-dd"),a.costType=o.params.costType,a.financials=[],n(),a.queryAssistCost=function(){n()},a.assistCostReset=function(){a.signAssistCost={}},a.addCostWindow=function(t,e){i.initAddCost(a,a.costType,t,e)}}angular.module("app").controller("assistCostCountEditCtrl",t),t.$inject=["bsWin","assistCostCountSvc","addCostSvc","$state"]}(),function(){"use strict";function t(t,e,i){function o(){n.isSubmit=!0,n.nodata=!1,t.findSingAssistCostCount(n.signAssistCost,function(t){n.isSubmit=!1,n.signAssistCostCounList=t,n.signAssistCostCounList&&0!=n.signAssistCostCounList.length||(n.nodata=!0)})}var n=this;n.signAssistCost={},n.signAssistCost.beginTime=(new Date).halfYearAgo(),n.signAssistCost.endTime=(new Date).Format("yyyy-MM-dd"),o(),n.queryAssistCost=function(){o()},n.assistCostReset=function(){n.signAssistCost={}}}angular.module("app").controller("assistCostCountListCtrl",t),t.$inject=["assistCostCountSvc","$state","addCostSvc"]}(),function(){"use strict";function t(t){function e(e,i){var o={method:"post",url:rootPath+"/financialManager/findSignCostBySignId",params:{signId:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function i(e,i){var o={method:"post",url:rootPath+"/financialManager/findSingAssistCostCount",data:e},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function o(e,i){var o={method:"post",url:rootPath+"/financialManager/findSingAssistCostList",data:e},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function n(t,e,i){var i=escape(encodeURIComponent(i));window.open(rootPath+"/financialManager/exportExcel?fileName="+i+"&businessId="+e)}function a(t){return!!(/^(\+|-)?\d+$/.test(t)&&t>0)}function r(e,i){var o={method:"post",url:rootPath+"/financialManager/initfinancial",params:{businessId:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function s(e){var i={method:"get",url:rootPath+"/financialManager/html/sumfinancial",params:{businessId:e.financial.businessId}},o=function(t){e.financial.stageCount=t.data,$("#financialCount").html(e.financial.stageCount)};common.http({vm:e,$http:t,httpOptions:i,success:o})}function l(e,i){var o={method:"post",url:rootPath+"/financialManager",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(e)},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function c(e,i){var o={method:"delete",url:u,data:e},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function d(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expertSelected/assistCostList",$("#searchform")),schema:{data:"value",model:{id:"id",fields:{createdDate:{type:"date"}}}},serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{field:"",title:"",width:30,template:function(t){switch(t.lightState){case"4":return $("#span1").html();case"8":return $("#span5").html();case"7":return $("#span4").html();case"6":return $("#span3").html();case"5":return $("#span2").html();case"1":case"2":case"3":default:return""}}},{field:"projectname",title:"项目名称",width:100,filterable:!1},{field:"builtcompanyname",title:"协审单位",width:100,filterable:!1},{field:"principal",title:"项目负责人",width:100,filterable:!1},{field:"signNum",title:"协审登记号",width:100,filterable:!1},{field:"totalCost",title:"计划协审费用",width:120,filterable:!1},{field:"totalCost",title:"实付协审费用",width:120,filterable:!1},{field:"payDate",title:"付款日期",width:100,filterable:!1},{field:"declareValue",title:"申报金额",width:100,filterable:!1},{field:"",title:"操作",width:100,template:function(t){return common.format($("#columnBtns").html(),"vm.addCost('"+t.businessId+"')")}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})},resizable:!0}}var u=rootPath+"/financialManager";return{grid:d,deleteassistCostCount:c,saveAssistCost:l,sumAssistCount:s,initAssistlProject:r,isUnsignedInteger:a,assistExportExcel:n,findSingAssistCostCount:i,findSingAssistCostList:o,findSignCostBySignId:e}}angular.module("app").factory("assistCostCountSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e,i,o){var n=this;n.title="专家费统计管理",n.financials=new Array,n.searchModel={},n.searchModel.beginTime=(new Date).halfYearAgo(),n.searchModel.endTime=(new Date).Format("yyyy-MM-dd"),n.model={},n.sign={},n.financial={},n.financial.signid=i.params.signid,n.inputIntegerValue=function(t,i){e.isUnsignedInteger(t)?$("#errorsUnmber"+i).html(""):$("#errorsUnmber"+i).html("只能输入数字")},n.addFinancial=function(){var t=$("#projectName").val(),e=$("#paymentData").val(),i=n.financial.signid;n.financial={},n.financial.chargeType="评审项目",n.financial.signid=i,n.financial.projectName=t,n.financial.paymentData=e,n.financials.push(n.financial),n.i++},n.saveFinancial=function(){e.savefinancial(n)},n.deleteFinancial=function(){var t=$("#financialsTable input[name='financialsCheck']:checked");if(t.length<1)common.alert({vm:n,msg:"请选择要删除的记录！"});else for(var i=[],o=0;o<t.length;o++){n.financials.forEach(function(e,a){t[o].value!=e.id&&void 0!=e.id||n.financials.splice(a,1),i.push(t[o].value)});var a=i.join(",");e.deleteexportCount(n,a)}},n.searchForm=function(){n.gridOptions.dataSource._skip=0,n.gridOptions.dataSource.read()},n.excelExport=function(){n.fileName="专家评审费明细",n.exportData=$("#statisticalGrid").data("kendoGrid")._data,e.excelExport(n,n.exportData,n.fileName)},n.formReset=function(){n.searchModel={}},function(){e.grid(n)}()}angular.module("app").controller("exportCountCtrl",t),t.$inject=["$location","exportCountSvc","$state","$http"]}(),function(){"use strict";function t(t){function e(t){return!!(/^(\+|-)?\d+$/.test(t)&&t>0)}function i(e){var i={method:"get",url:rootPath+"/exportCount/initfinancial",params:{signid:e.financial.signid}},o=function(t){e.model=t.data.financialDto,e.financials=t.data.financiallist};common.http({vm:e,$http:t,httpOptions:i,success:o})}function o(e){var i={method:"get",url:rootPath+"/exportCount/html/sumfinancial",params:{signId:e.financial.signid}},o=function(t){e.financial.stageCount=t.data,$("#financialCount").html(e.financial.stageCount)};common.http({vm:e,$http:t,httpOptions:i,success:o})}function n(e){var i={method:"post",url:rootPath+"/exportCount",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(e.financials)},o=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){a()}})}})};common.http({vm:e,$http:t,httpOptions:i,success:o})}function a(){window.location.reload()}function r(e,i){e.isSubmit=!0;var o={method:"delete",url:c,data:i},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",closeDialog:!0,fn:function(){e.isSubmit=!1,a()}})}})};common.http({vm:e,$http:t,httpOptions:o,success:n})}function s(e,i,o){var n=window.encodeURIComponent(window.encodeURIComponent(o)),a={fileName:n},r=rootPath+"/expertSelected/expertDetailExport";if($("#searchform")){var s=common.buildOdataFilter($("#searchform"));s&&(a.$filter=s)}var l={method:"post",url:r,traditional:!0,dataType:"json",responseType:"arraybuffer",params:a},c=function(t){o+=".xls";common.downloadReport(t.data,o,"vnd.ms-excel")};common.http({vm:e,$http:t,httpOptions:l,success:c})}function l(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expertSelected/findByOData",$("#searchform")),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10}),i=function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})},o=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"expertDto.name",title:"姓名",width:50,filterable:!1},{field:"expertDto.idCard",title:"身份证号",width:70,filterable:!1},{field:"expertDto.openingBank",title:"开户行",width:70,filterable:!1},{field:"expertDto.bankAccount",title:"银行账号",width:90,filterable:!1},{field:"reviewCost",title:"评审费",width:50,filterable:!1},{field:"reviewTaxes",title:"应缴税",width:50,filterable:!1},{field:"expertReviewDto.reviewTitle",title:"项目名称",width:100,filterable:!1},{field:"expertReviewDto.reviewDate",title:"评审/函评日期",width:70,filterable:!1},{field:"principal",title:"负责人",width:50,filterable:!1}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}var c=rootPath+"/exportCount";return{grid:l,deleteexportCount:r,savefinancial:n,sumFinancial:o,initFinancialProject:i,isUnsignedInteger:e,excelExport:s}}angular.module("app").factory("exportCountSvc",t),t.$inject=["$http"]}(),function(){
"use strict";function t(t,e,i,o){var n=this;n.title="专家缴税统计管理",n.financials=new Array,n.sign={},n.financial={},n.model={},n.model.year=i.params.year,n.model.month=i.params.month,n.countExpertCost=function(){e.expertCostTotal(n,function(t){n.expertCostTotalInfo=t.reObj.expertCostTotalInfo})},n.getExpertCoustDetail=function(){i.go("expertPaymentDetailCountList",{year:n.model.year,month:n.model.month})},n.printFile=function(){var t=n.model.year+n.model.month,e=rootPath+"/contents/libs/pdfjs-dist/web/viewer.html?version="+(new Date).getTime()+"&file="+rootPath+"/expertSelected/printPreview/"+t;$("#iframePreview").attr("src",e),$("#previewModal").kendoWindow({width:"80%",height:"730px",title:"",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},n.excelExport=function(){n.fileName="专家缴税统计汇总表"+n.model.year+"-"+n.model.month,e.excelExport(n.expertCostTotalInfo,n.fileName)},function(){if(!n.model.year||!n.model.month){var t=new Date,i=t.getFullYear(),o=t.getMonth()+1;n.model.year=i+"",n.model.month=o+""}e.expertCostTotal(n,function(t){n.expertCostTotalInfo=t.reObj.expertCostTotalInfo})}()}angular.module("app").controller("expertPaymentCountCtrl",t),t.$inject=["$location","expertPaymentCountSvc","$state","$http"]}(),function(){"use strict";function t(t,e){function i(e,i){var o={method:"post",url:rootPath+"/expertSelected/expertCostTotal",data:e.model},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function o(e,i){var o={method:"post",url:rootPath+"/expertSelected/expertCostDetailTotal",data:e.model},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function n(i,o){var n={method:"post",url:rootPath+"/expertSelected/excelExport",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",responseType:"arraybuffer",data:angular.toJson(i)},a=function(t){var i=new Blob([t.data],{type:"application/vnd.ms-excel"});e.saveAs(i,o+".xls")};common.http({$http:t,httpOptions:n,success:a})}function a(t){return!!(/^(\+|-)?\d+$/.test(t)&&t>0)}function r(e){var i={method:"get",url:rootPath+"/expertPaymentCount/initfinancial",params:{signid:e.financial.signid}},o=function(t){e.model=t.data.financialDto,e.financials=t.data.financiallist};common.http({vm:e,$http:t,httpOptions:i,success:o})}function s(e){var i={method:"get",url:rootPath+"/expertPaymentCount/html/sumfinancial",params:{signId:e.financial.signid}},o=function(t){e.financial.stageCount=t.data,$("#financialCount").html(e.financial.stageCount)};common.http({vm:e,$http:t,httpOptions:i,success:o})}function l(e){var i={method:"post",url:rootPath+"/expertPaymentCount",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(e.financials)},o=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){c()}})}})};common.http({vm:e,$http:t,httpOptions:i,success:o})}function c(){window.location.reload()}function d(e,i){e.isSubmit=!0;var o={method:"delete",url:m,data:i},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",closeDialog:!0,fn:function(){e.isSubmit=!1,c()}})}})};common.http({vm:e,$http:t,httpOptions:o,success:n})}function u(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expertReview/findByOData",$("#searchform")),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10}),i=function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})},o=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.signid)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"expretCount",title:"姓名",width:100,filterable:!1},{field:"expretCount",title:"身份证号",width:100,filterable:!1},{field:"expretCount",title:"开户行",width:80,filterable:!1},{field:"expretCount",title:"银行账号",width:120,filterable:!1},{field:"reviewCost",title:"评审费（元）",width:160,filterable:!1},{field:"reviewTaxes",title:"应缴税",width:120,filterable:!1},{field:"reviewTitle",title:"项目名称",width:160,filterable:!1},{field:"reviewDate",title:"评审时间",width:160,filterable:!1},{field:"reviewDate",title:"函评时间",width:120,filterable:!1},{field:"reviewDate",title:"负责人",width:120,filterable:!1},{field:"",title:"操作",width:100,template:function(t){return common.format($("#columnBtns").html(),t.signid)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}var m=rootPath+"/expertPaymentCount";return{grid:u,deleteexpertPaymentCount:d,savefinancial:l,sumFinancial:s,initFinancialProject:r,isUnsignedInteger:a,expertCostTotal:i,expertCostDetailTotal:o,excelExport:n}}angular.module("app").factory("expertPaymentCountSvc",t),t.$inject=["$http","FileSaver"]}(),function(){"use strict";function t(t,e,i,o){function n(t){var e="",i=0;if(t.length>0){for(var o=0;o<t.length;o++)if(i++,e+="<tr id='option"+i+"'>",t[o].name.length,e+="<td  class='text-center'><strong>"+t[o].name+"</strong></td>",e+="<td  class='text-center'><strong>"+t[o].expertNo+"</strong></td>",e+="<td class='text-center'>",e+=t[o].reviewcost,e+="</td>",e+="<td class='text-center'>",e+=t[o].reviewtaxes,e+="</td>",e+="<td  class='text-center'><strong>"+t[o].monthTotal+"</strong></td>",e+="</tr>",void 0!=t[o].expertCostDetailCountDtoList&&t[o].expertCostDetailCountDtoList.length>0)for(var n=0;n<t[o].expertCostDetailCountDtoList.length;n++){i++;var a="";a+="<tr id='option"+i+"'>",a+="<td class='text-center' colspan='2'>",a+=void 0==t[o].expertCostDetailCountDtoList[n].reviewTitle?"":t[o].expertCostDetailCountDtoList[n].reviewTitle,a+="</td>",a+="<td class='text-center'>",a+=void 0==t[o].expertCostDetailCountDtoList[n].reviewType?"":t[o].expertCostDetailCountDtoList[n].reviewType,a+="</td>",a+="<td class='text-center'>",void 0!=t[o].expertCostDetailCountDtoList[n].reviewDate&&(a+=t[o].expertCostDetailCountDtoList[n].reviewDate),a+="</td>",a+="<td class='text-center'>",void 0!=t[o].expertCostDetailCountDtoList[n].reviewDate&&(a+=t[o].expertCostDetailCountDtoList[n].reviewDate),a+="</td>",a+="<td class='text-center'>",a+=t[o].expertCostDetailCountDtoList[n].reviewcost,a+="</td>",a+="<td class='text-center'>",a+=t[o].expertCostDetailCountDtoList[n].reviewtaxes,a+="</td>",a+="</tr>",e+=a}$("#expertCostHead").after(e)}}var a=this;a.title="专家缴税统计管理",a.model={},a.financials=new Array,a.sign={},a.financial={},a.model.year=i.params.year,a.model.month=i.params.month,a.getExpertCoust=function(){i.go("expertPaymentCountList",{year:a.model.year,month:a.model.month})},a.countExpertCostDetail=function(){e.expertCostDetailTotal(a,function(t){a.expertCostTotalInfo=t.reObj.expertCostTotalInfo;for(var e=$("#expertCostTable tr").length,i=1;i<e;i++)$("#option"+i).remove();n(a.expertCostTotalInfo)})},function(){if(i.params.year)a.model.year=i.params.year,a.model.month=i.params.month;else{var t=new Date,o=t.getFullYear(),r=t.getMonth()+1;a.model.year=o,a.model.month=r}e.expertCostDetailTotal(a,function(t){a.expertCostTotalInfo=t.reObj.expertCostTotalInfo,n(a.expertCostTotalInfo)})}(),a.printFile=function(){var t=a.model.year+a.model.month,e=rootPath+"/contents/libs/pdfjs-dist/web/viewer.html?version="+(new Date).getTime()+"&file="+rootPath+"/expertSelected/printPreviewDetail/"+t;$("#iframePreview").attr("src",e),$("#previewModal").kendoWindow({width:"80%",height:"730px",title:"",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()}}angular.module("app").controller("expertPaymentDetailCountCtrl",t),t.$inject=["$location","expertPaymentCountSvc","$state","$http"]}(),function(){"use strict";function t(t,e,i,o,n){function a(){var t=new Date,e=t.getFullYear();return c(new Date(e,l(),1))}function r(){var t=new Date,e=t.getFullYear(),i=l()+2;return c(new Date(e,i,s(i)))}function s(t){var e=new Date,i=e.getYear(),o=new Date(i,t,1);return(new Date(i,t+1,1)-o)/864e5}function l(){var t=new Date,e=t.getMonth(),i=0;return e<3&&(i=0),2<e&&e<6&&(i=3),5<e&&e<9&&(i=6),e>8&&(i=9),i}function c(t){var e=t.getFullYear(),i=t.getMonth()+1,o=t.getDate();return i<10&&(i="0"+i),o<10&&(o="0"+o),e.toString()+"-"+i.toString()+"-"+o.toString()}var d=this;d.title="专家评审基本情况统计",d.model={},d.expertRevConCount=function(){if(3==d.model.reportType&&(void 0==d.model.beginTime||""==d.model.beginTime||void 0==d.model.endTime||""==d.model.endTime))return void n.alert("会议起止时间不能为空");e.expertRevConCount(d,function(t){1==d.model.reportType?d.expertReviewConDtoList=t.reObj.expertReviewConDtoList:2==d.model.reportType?d.expertRevConSimDtoList=t.reObj.expertRevConSimDtoList:3==d.model.reportType&&(d.expertRevConCompDtoList=t.reObj.expertRevConCompDtoList)})},d.dropSlelectedCount=function(){if(1==d.model.reportType||2==d.model.reportType){var t=new Date,i=t.getFullYear(),o=t.getMonth()+1,n=t.getDate();o=o<10?"0"+o:o,d.model.beginTime=i.toString()+"-01-01",d.model.endTime=i.toString()+"-"+o.toString()+"-"+n}else 3==d.model.reportType&&(d.model.beginTime=a(),d.model.endTime=r());e.expertRevConCount(d,function(t){1==d.model.reportType?d.expertReviewConDtoList=t.reObj.expertReviewConDtoList:2==d.model.reportType?d.expertRevConSimDtoList=t.reObj.expertRevConSimDtoList:3==d.model.reportType&&(d.expertRevConCompDtoList=t.reObj.expertRevConCompDtoList)})},d.formReset=function(){var t=d.model.reportType;d.model={},d.model.reportType=t},function(){var t=new Date,i=t.getFullYear(),o=t.getMonth()+1,n=t.getDate();o=o<10?"0"+o:o,d.model.beginTime=i.toString()+"-01-01",d.model.endTime=i.toString()+"-"+o.toString()+"-"+n,d.model.reportType=1,e.expertRevConCount(d,function(t){d.expertReviewConDtoList=t.reObj.expertReviewConDtoList})}()}angular.module("app").controller("expertRevConCountCtrl",t),t.$inject=["$location","expertRevConCountSvc","$state","$http","bsWin"]}(),function(){"use strict";function t(t){function e(e,i){if(1==e.model.reportType)var o={method:"post",url:rootPath+"/expertSelected/expertReviewCondDetailCount",data:e.model};else if(2==e.model.reportType)var o={method:"post",url:rootPath+"/expertSelected/expertReviewCondCount",data:e.model};else if(3==e.model.reportType)var o={method:"post",url:rootPath+"/expertSelected/expertReviewCompliCount",data:e.model};var n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}return{expertRevConCount:e}}angular.module("app").factory("expertRevConCountSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e,i,o,n){var a=this;a.title="评审费录入",a.financials=new Array,a.financial={},a.financial.businessId=i.params.businessId,function(){e.initFinancialProject(a.financial.businessId,function(t){a.model=t.financialDto,a.financials=t.financiallist,a.countCost()})}(),a.countCost=function(){if(a.financials&&a.financials.length>0){var t=0;angular.forEach(a.financials,function(e,i){e.charge&&(t+=e.charge)}),$("#financialCount").html(t)}},a.findStageCostTable=function(){n.initReview(a.financial.businessId,"",function(t){a.expertReview=t,a.reviewTitle=t.reviewTitle,a.payDate=t.payDate,a.expertSelectedDtoList=t.expertSelectedDtoList,$("#stageCostWindow").kendoWindow({width:"70%",height:"600px",title:"评审费用统计表",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()})},a.exportExcel=function(){var t=a.reviewTitle+"("+a.payDate+")";e.exportExcel(a,a.financial.businessId,t)},a.inputIntegerValue=function(t,i){e.isUnsignedInteger(t)?$("#errorsUnmber"+i).html(""):$("#errorsUnmber"+i).html("只能输入数字")},a.addFinancial=function(){var t={};t.chargeType="1",t.businessId=a.model.businessId,t.projectName=a.model.projectName,t.paymentData=a.model.paymentData,a.financials||(a.financials=[]),a.financials.push(t)},a.saveFinancial=function(){e.savefinancial(a.financials,function(e){e.flag||"ok"==e.reCode?(a.financials=e.reObj,a.model.paymentData||(a.model.paymentData=a.financials[0].paymentData),a.countCost(),t.success(e.reMsg)):t.error(e.reMsg)})},a.deleteFinancial=function(){var i=$("#financialsTable input[name='financialsCheck']:checked");if(i.length<1)common.alert({vm:a,msg:"请选择要删除的记录！"});else{for(var o=[],n=0;n<i.length;n++)a.financials.forEach(function(t,e){void 0!=t.id&&i[n].value!=t.id||a.financials.splice(e,1),i[n].value&&o.push(i[n].value)});if(o.length>0){var r=o.join(",");e.deleteFinancialManager(r,function(e){a.countCost(),t.alert("操作成功！！")})}}}}angular.module("app").controller("financialManagerCtrl",t),t.$inject=["bsWin","financialManagerSvc","$state","$http","expertReviewSvc"]}(),function(){"use strict";function t(t,e,i,o,n,a,r,s){var l=this;l.title="评审费录入",l.sign={},l.financial={},l.model={},l.model.beginTime=(new Date).halfYearAgo(),l.model.endTime=(new Date).Format("yyyy-MM-dd"),l.isuserExist=!1,l.id=i.params.id,l.financial.businessId=i.params.businessId,l.costType=i.params.costType,l.id&&(l.isUpdate=!0,l.title="评审费统计管理"),l.businessFlag={expertReviews:[]},function(){e.initfinancial(l.model,function(t){l.stageCountList=t}),r.initSignList(function(t){(t.flag||"ok"==t.reCode)&&(l.orgDeptList=t.reObj)})}(),l.showCostWindow=function(t,e){s.initAddCost(l,l.costType,t,e)},l.queryFinancl=function(){e.initfinancial(l.model,function(t){l.stageCountList=t})},l.resetQuery=function(){l.model={}}}angular.module("app").controller("financialManagerEditCtrl",t),t.$inject=["$location","financialManagerSvc","$state","signSvc","bsWin","expertReviewSvc","adminSvc","addCostSvc"]}(),function(){"use strict";function t(t){function e(e,i){var o={method:"post",url:rootPath+"/expertSelected/findProjectReviewCost",data:e},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function i(t,e,i){var i=escape(encodeURIComponent(i));window.open(rootPath+"/financialManager/exportExcel?fileName="+i+"&businessId="+e)}function o(e){var i={method:"post",url:rootPath+"/financialManager/findByOData"},o=function(t){e.stageCountList=t.data.value};common.http({vm:e,$http:t,httpOptions:i,success:o})}function n(t){return!!(/^(\+|-)?\d+$/.test(t)&&t>0)}function a(e,i){var o={method:"post",url:rootPath+"/financialManager/initfinancial",params:{businessId:e.businessId,businessType:e.businessType,chargeType:e.chargeType}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function r(e,i){var o={method:"post",url:rootPath+"/financialManager/initfinancial",params:{businessId:e,businessType:"SIGN"}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function s(e,i){var o={method:"get",url:rootPath+"/financialManager/html/sumfinancial",params:{businessId:i}},n=function(t){$("#financialCount").html(t.data)};common.http({vm:e,$http:t,httpOptions:o,success:n})}function l(e,i){var o={method:"post",url:rootPath+"/financialManager",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(e)},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function c(e,i){var o={method:"delete",url:rootPath+"/financialManager",data:e},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function d(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expertSelected/findProjectReviewCost",$("#searchform")),schema:common.kendoGridConfig().schema({id:"signid",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})},o=[{field:"",title:"",width:30,template:function(t){if("4"==t.isLightUp)return $("#span4").html();switch(t.processState){case 9:return $("#span5").html();case 4:case 5:return $("#span2").html();case 7:case 8:return $("#span3").html();default:return $("#span1").html()}}},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"projectname",title:"项目名称",width:140,filterable:!1},{field:"builtcompanyname",title:"建设单位",width:180,filterable:!1},{field:"reviewstage",title:"项目阶段",width:80,filterable:!1},{field:"principal",title:"项目负责人",width:120,filterable:!1},{field:"totalCost",title:"计划专家费用",width:160,filterable:!1,template:function(t){return"<button ng-click='vm.reviewCostWindow('"+t.businessId+"') '>"+t.totalCost+"</button>"}},{field:"signdate",title:"签收日期",width:120,filterable:!1,format:"{0: yyyy-MM-dd}"}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}rootPath;return{grid:d,deleteFinancialManager:c,savefinancial:l,sumFinancial:s,initFinancialProject:a,initAssistProject:r,isUnsignedInteger:n,stageCostCountList:o,exportExcel:i,initfinancial:e}}angular.module("app").factory("financialManagerSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e,i,o,n){var a=this;a.title="项目评审费分类统计",a.model={},a.page=0,a.proReviewClassifyDetailDtoList=[],a.proReviewClassifyCountDtoList=[],a.model.beginTime=(new Date).halfYearAgo(),a.model.endTime=(new Date).Format("yyyy-MM-dd"),a.projectCostCountList=function(){o.go("projectCostCountList")},a.initFinancial=function(t){var e=o.href("financialManager",{businessId:t});window.open(e,"_blank")},a.proCostCount=function(){e.projectCostClassifyCout(a,function(t){a.proReviewClassifyCountDtoList=t.reObj.proReviewClassifyCountDtoList,void 0!=t.reObj&&t.reObj.proReviewClassifyDetailDtoList.forEach(function(t,e){a.proReviewClassifyDetailDtoList.push(t)}),void 0!=t.reObj.proReviewClassifyDetailDtoList&&0!=t.reObj.proReviewClassifyDetailDtoList.length&&(a.page++,a.proCostCount())})},a.proCostClassifyCount=function(){a.proReviewClassifyDetailDtoList=[],a.proReviewClassifyCountDtoList=[],a.page=0,a.proCostCount()},a.formReset=function(){a.model={}},function(){i.initSignList(function(t){(t.flag||"ok"==t.reCode)&&(a.orgDeptList=t.reObj)})}()}angular.module("app").controller("proCostClassifyCountCtrl",t),t.$inject=["$location","projectCostCountSvc","adminSvc","$state","$http"]}(),function(){"use strict";function t(t,e,i,o,n,a,r){var s=this;s.title="项目评审费统计",s.model={},s.model.beginTime=(new Date).halfYearAgo(),s.model.endTime=(new Date).Format("yyyy-MM-dd"),s.proCostClassifyCountList=function(){o.go("proCostClassifyCountList")},s.proCostCount=function(){e.projectCostTotal(s,function(t){s.projectReviewCostDtoList=t.reObj.projectReviewCostDtoList})},s.queyCostWindow=function(t){a.initReview(t.businessId,"",function(t){s.titleName="专家评审费",s.expertReview=t,s.reviewTitle=t.reviewTitle,s.payDate=t.payDate,s.businessId=s.expertReview.businessId,s.expertSelectedDtoList=t.expertSelectedDtoList,s.expertSelectedDtoList&&s.expertSelectedDtoList.length>0?(s.showReviewCost=!0,$("#expertCostWindow").kendoWindow({width:"70%",height:"600px;",title:s.titleName,visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()):r.alert("没有专家")})},s.costExportExcel=function(){var t=s.reviewTitle+"("+s.payDate+")";e.exportExcel(s,s.businessId,t)},s.formReset=function(){s.model={}},function(){i.initSignList(function(t){(t.flag||"ok"==t.reCode)&&(s.orgDeptList=t.reObj)}),e.projectCostTotal(s,function(t){s.projectReviewCostDtoList=t.reObj.projectReviewCostDtoList})}()}angular.module("app").controller("projectCostCountCtrl",t),t.$inject=["$location","projectCostCountSvc","adminSvc","$state","$http","expertReviewSvc","bsWin"]}(),function(){"use strict";function t(t){function e(e,i){var o={method:"post",url:rootPath+"/expertSelected/projectCostTotal",data:e.model},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function i(e,i){var o={method:"post",url:rootPath+"/expertSelected/proCostClassifyTotal?page="+e.page,data:e.model},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function o(e,i,o){var n={method:"post",url:rootPath+"/expertSelected/excelExport",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",responseType:"arraybuffer",data:angular.toJson(i),params:{fileName:o}},a=function(t){o+=".xls";common.downloadReport(t.data,o,"vnd.ms-excel")};common.http({vm:e,$http:t,httpOptions:n,success:a})}function n(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expertReview/findByOData",$("#searchform")),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10}),i=function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})},o=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.signid)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"expretCount",title:"姓名",width:100,filterable:!1},{field:"expretCount",title:"身份证号",width:100,filterable:!1},{field:"expretCount",title:"开户行",width:80,filterable:!1},{field:"expretCount",title:"银行账号",width:120,filterable:!1},{field:"reviewCost",title:"评审费（元）",width:160,filterable:!1},{field:"reviewTaxes",title:"应缴税",width:120,filterable:!1},{field:"reviewTitle",title:"项目名称",width:160,filterable:!1},{field:"reviewDate",title:"评审时间",width:160,filterable:!1},{field:"reviewDate",title:"函评时间",width:120,filterable:!1},{field:"reviewDate",title:"负责人",width:120,filterable:!1},{field:"",title:"操作",width:100,template:function(t){return common.format($("#columnBtns").html(),t.signid)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}function a(t,e,i){var i=escape(encodeURIComponent(i));window.open(rootPath+"/financialManager/costExportExcel?fileName="+i+"&businessId="+e)}rootPath;return{grid:n,projectCostTotal:e,projectCostClassifyCout:i,excelExport:o,exportExcel:a}}angular.module("app").factory("projectCostCountSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e,i,o){function n(t,e){var i,o,n;try{i=t.toString().split(".")[1].length}catch(t){i=0}try{o=e.toString().split(".")[1].length}catch(t){o=0}return n=Math.pow(10,Math.max(i,o)),(t*n+e*n)/n}function a(){r.total.projectcount=0,r.total.declarevalue=0,r.total.authorizevalue=0,r.total.ljhj=0,r.total.hjl=0,r.protReviewConditionList.forEach(function(t,e){void 0!=t.proCount&&(r.total.projectcount+=t.proCount),void 0!=t.declareValue&&(r.total.declarevalue=n(r.total.declarevalue,t.declareValue)),void 0!=t.authorizeValue&&(r.total.authorizevalue=n(r.total.authorizevalue,t.authorizeValue)),void 0!=t.ljhj&&(r.total.ljhj=n(r.total.ljhj,t.ljhj))}),r.total.hjl=Math.round(r.total.ljhj/r.total.declarevalue*1e4)/100}var r=this;r.title="项目评审情况统计",r.model={},r.total={},r.proReviewConCount=function(){if(null!=r.model.beginTime&&""!=r.model.beginTime){var t=r.model.beginTime.split("-");r.year=t[0],r.begMonth=t[1],"0"==r.begMonth.charAt(0)&&(r.begMonth=r.begMonth.charAt(1))}if(null!=r.model.endTime&&""!=r.model.endTime){var t=r.model.endTime.split("-");r.year=t[0],r.endMonth=t[1],"0"==r.endMonth.charAt(0)&&(r.endMonth=r.endMonth.charAt(1))}e.proReviewConCount(r,function(t){r.protReviewConditionList=t.reObj.protReviewConditionList,a()})},r.formReset=function(){r.model={}},r.isBeginTime=function(){r.byear=r.model.beginTime.split("-")[0],r.begMonth=r.model.beginTime.split("-")[1],r.endMonth=r.model.endTime.split("-")[1],r.year=r.model.endTime.split("-")[0]},function(){var t=new Date,i=t.getFullYear(),o=t.getMonth()+1,n=t.getDate();o=o<10?"0"+o:o,r.model.beginTime=i.toString()+"-01",r.model.endTime=i.toString()+"-"+o.toString(),r.year=i,r.begMonth="1",r.endMonth=o,r.begDay="31",r.endDay=n,e.proReviewConCount(r,function(t){r.protReviewConditionList=t.reObj.protReviewConditionList,a()})}()}angular.module("app").controller("proReviewConditionCtrl",t),t.$inject=["$location","proReviewConditionSvc","$state","$http"]}(),function(){"use strict";function t(t){function e(e,i){var o={method:"post",url:rootPath+"/expertSelected/proReviewConditionCount",data:e.model},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}return{proReviewConCount:e}}angular.module("app").factory("proReviewConditionSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e,i){function o(t){var e={};if(void 0!=t.flow){var i=t.flow.processInstanceId;(angular.isUndefined(t.flow.hideFlowImg)||0==t.flow.hideFlowImg)&&(t.picture=rootPath+"/flow/processInstance/img/"+i),e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/flow/processInstance/history/"+i),schema:common.kendoGridConfig().schema({id:"id"}),rowNumber:!0,headerCenter:!0})}var o=[{field:"",title:"序号",template:"<span class='row-number'></span>",width:50},{field:"nodeNameValue",title:"环节名称",width:120,filterable:!1},{field:"displayName",title:"处理人",width:80,filterable:!1},{field:"startTime",title:"开始时间",width:120,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"endTime",title:"结束时间",width:120,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"durationStr",title:"处理时长",width:120,filterable:!1},{field:"message",title:"处理信息",width:300,filterable:!1}];t.historygrid={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,resizable:!0,dataBound:function(){var e=this.items();$(e).each(function(i){i==e.length-1&&c(t),$(this).find(".row-number").html(i+1)})}}}function n(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/flow/processInstance/history/"+t.instanceId),schema:common.kendoGridConfig().schema({id:"hctId"}),rowNumber:!0,headerCenter:!0}),i=[{field:"",title:"序号",template:"<span class='row-number'></span>",width:50},{field:"nodeNameValue",title:"环节名称",width:"20%",filterable:!1},{field:"displayName",title:"处理人",width:"15%",filterable:!1},{field:"startTime",title:"开始时间",width:"15%",filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"endTime",title:"结束时间",width:"15%",filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"durationStr",title:"处理时长",width:"15%",filterable:!1},{field:"message",title:"处理信息",width:"20%",filterable:!1}];t.historygrid={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,dataBound:function(){var t=this.items();$(t).each(function(t){$(this).find(".row-number").html(t+1)})}}}function a(e,i,o){var n={method:"post",url:rootPath+"/flow/processInstance/flowNodeInfo",params:{taskId:e,processInstanceId:i}},a=function(t){void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:t,httpOptions:n,success:a})}function r(e,i,o){if(common.initJqValidation($("#flow_form")),$("#flow_form").valid()){e=!0;var n={method:"post",url:rootPath+"/flow/commit",data:i},a=function(t){e=!1,void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:t,httpOptions:n,success:a,onError:function(t){e=!1}})}}function s(e,i,o){i=!0;var n={method:"post",url:rootPath+"/flow/rollbacklast",data:e},a=function(t){i=!1,void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:t,httpOptions:n,success:a,onError:function(t){i=!1}})}function l(e){var i={method:"post",url:rootPath+"/flow/rollbacklast",data:e.flow},o=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:t.data.reMsg})}})};common.http({vm:e,$http:t,httpOptions:i,success:o})}function c(t){t.backNode=[];for(var e=t.historygrid.dataSource.data(),i=e.length,o=0;o<i;o++)e[o].assignee&&e[o].endTime&&t.backNode.push({activitiId:e[o].activityId,activitiName:e[o].activityName,assignee:e[o].assignee})}function d(e,i){var o={method:"post",url:rootPath+"/flow/suspend/"+i,data:e.projectStop},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:t.data.reMsg,closeDialog:!0,fn:function(){"error"==t.data.reCode?e.isCommit=!1:(window.parent.$("#spwindow").data("kendoWindow").close(),e.gridOptions.dataSource.read())}})}})};common.http({vm:e,$http:t,httpOptions:o,success:n,onError:function(){e.isCommit=!1}})}function u(e,i){e.isCommit=!0;var o={method:"post",url:rootPath+"/flow/active/"+i},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:t.data.reMsg,closeDialog:!0,fn:function(){"error"==t.data.reCode?e.isCommit=!1:e.gridOptions.dataSource.read()}})}})};common.http({vm:e,$http:t,httpOptions:o,success:n,onError:function(){e.isCommit=!1}})}function m(e){if(null==e.flow.dealOption||""==e.flow.dealOption)return void common.alert({vm:e,msg:"请填写处理信息！"});var i={method:"post",url:rootPath+"/flow/deleteFLow",data:e.flow},o=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功！"})}})};common.http({vm:e,$http:t,httpOptions:i,success:o})}return{initFlowData:o,getFlowInfo:a,commit:r,rollBackToLast:s,rollBack:l,initBackNode:c,suspendFlow:d,activeFlow:u,deleteFlow:m,historyData:n}}angular.module("app").factory("flowSvc",t),t.$inject=["$http","$state","bsWin"]}(),function(){"use strict";function t(t,e,i,o,n,a,r,s,l,c,d,u,m,p,f,h){function g(t){t=void 0==t?0:t;var e=0;return t>800&&t<=4e3?e=.2*(t-800):t>4e3&&t<=2e4?e=.8*t*.2:t>2e4&&t<=5e4&&(e=.8*t*.3-2e3),e}var v=this;v.title="待办任务处理",v.businessKey=o.params.businessKey,v.processKey=o.params.processKey,v.taskId=o.params.taskId,v.instanceId=o.params.instanceId,v.currentFlow,v.showFlag={businessNext:!1,businessTr:!1,tabSysFile:!1},function(){$("#myTab li").click(function(t){var e=$("a",this);t.preventDefault(),e.tab("show");var i=e.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500)}),v.picture=rootPath+"/flow/processInstance/img/"+v.instanceId,r.historyData(v),r.getFlowInfo(v.taskId,v.instanceId,function(t){if(v.flow=t,v.flow.taskId)if(v.currentFlow=t,v.flow.end)v.showFlag.nodeNext=!1;else switch(v.processKey){case flowcommon.getFlowDefinedKey().TOPIC_FLOW:a.initFlowNode(v.flow,v.showFlag,v)}else n.alert("该任务已处理！",function(){o.go("gtasks")})});var l=0;switch(v.processKey){case flowcommon.getFlowDefinedKey().TOPIC_FLOW:a.initFlowDeal(v),l=1;break;case flowcommon.getFlowDefinedKey().ASSERT_STORAGE_FLOW:c.initFlowDeal(v),l=1;break;case flowcommon.getFlowDefinedKey().BOOKS_BUY_FLOW:s.initFlowDeal(v),l=1;break;case flowcommon.getFlowDefinedKey().PROJECT_STOP_FLOW:d.initFlowDeal(v),l=2;break;case flowcommon.getFlowDefinedKey().FLOW_ARCHIVES:u.initFlowDeal(v),l=1;break;case flowcommon.getFlowDefinedKey().FLOW_APPRAISE_REPORT:m.initFlowDeal(v);break;case flowcommon.getFlowDefinedKey().FLOW_SUPP_LETTER:p.initFlowDeal(v),l=2;break;case flowcommon.getFlowDefinedKey().MONTHLY_BULLETIN_FLOW:f.initFlowDeal(v);break
;case flowcommon.getFlowDefinedKey().ANNOUNT_MENT_FLOW:h.initFlowDeal(v),l=1}1==l?i.findByMianId(v.businessKey,function(e){e&&e.length>0&&(v.showFlag.tabSysFile=!0,v.sysFileList=e,i.initZtreeClient(v,t))}):2==l&&i.findByBusinessId(v.businessKey,function(e){e&&e.length>0&&(v.showFlag.tabSysFile=!0,v.sysFileList=e,i.initZtreeClient(v,t))}),e.initIdea(v)}(),v.initFileUpload=function(t,e,o){v.sysFile={businessId:v.businessKey,mainId:v.businessKey,mainType:t,sysfileType:e,sysBusiType:o},i.initUploadOptions({inputId:"sysfileinput",vm:v})},v.commonDownloadSysFile=function(t){i.downloadFile(t)},v.ideaEdit=function(t){angular.isObject(t)||(t={}),e.initIdeaData(v,t)},v.selectedIdea=function(){v.flow.dealOption=v.chooseIdea},v.commitFlow=function(){if(v.flow.isSuspended)return void n.error("该流程目前为暂停状态，不能进行流转操作！");r.commit(v.isCommit,v.flow,function(t){t.flag||"ok"==t.reCode?n.success("操作成功！",function(){o.go("agendaTasks")}):n.alert(t.reMsg)})},v.backFlow=function(){common.initJqValidation($("#flow_form")),$("#flow_form").valid()&&n.confirm({title:"询问提示",message:"确认回退吗？",onOk:function(){r.rollBackToLast(v.flow,v.isCommit,function(t){v.isCommit=!1,t.flag||"ok"==t.reCode?n.alert("回退成功！",function(){o.go("agendaTasks")}):n.alert(t.reMsg)})}})},v.editSelectExpert=function(t){v.scoreExpert={},$.each(v.model.expertReviewDto.expertSelectedDtoList,function(e,i){if(i.id==t)return void(v.scoreExpert=angular.copy(i))}),$("#star_"+v.scoreExpert.id).raty({number:5,score:function(){return $(this).attr("data-num",angular.isUndefined(v.scoreExpert.score)?0:v.scoreExpert.score),$(this).attr("data-num")},starOn:"../contents/libs/raty/lib/images/star-on.png",starOff:"../contents/libs/raty/lib/images/star-off.png",starHalf:"../contents/libs/raty/lib/images/star-half.png",readOnly:!1,halfShow:!0,hints:["不合格","合格","中等","良好","优秀"],size:34,click:function(t,e){v.scoreExpert.score=t}}),$("#score_win").kendoWindow({width:"820px",height:"365px",title:"编辑-专家星级",visible:!1,modal:!0,closable:!0,actions:["Close"]}).data("kendoWindow").center().open()},v.closeEditMark=function(){window.parent.$("#score_win").data("kendoWindow").close()},v.saveMark=function(){v.scoreExpert.score&&0!=v.scoreExpert.score?v.scoreExpert.describes?l.saveMark(v.scoreExpert,function(t){t.flag||"ok"==t.reCode?(angular.forEach(v.model.expertReviewDto.expertSelectedDtoList,function(t,e){t.id==v.scoreExpert.id&&(t.score=v.scoreExpert.score,t.describes=v.scoreExpert.describes)}),n.success("保存成功！",function(){v.closeEditMark()})):n.alert(t.reMsg)}):n.alert("请对专家进行评分描述！"):n.alert("请对专家进行评分！")},v.affirmJoinExpert=function(){v.model.expertReviewDto&&v.model.expertReviewDto.expertSelectedDtoList?(v.confirmEPList=v.model.expertReviewDto.expertSelectedDtoList,$("#confirmJoinExpert").kendoWindow({width:"75%",height:"600px",title:"参加评审会专家确认",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()):n.alert("该项目没有评审专家！")},v.updateToJoin=function(){var t=$("#notJoinExpertTable input[name='notJoinExpert']:checked");if(t.length<1)n.alert("请选择要改为参加会议的专家");else{for(var e=[],i=0;i<t.length;i++)e.push(t[i].value);l.updateJoinState("","",e.join(","),"9",v.isCommit,function(t){v.reFleshJoinState(e,"9"),n.success("操作成功！")})}},v.updateToNotJoin=function(){var t=$("#joinExpertTable input[name='joinExpert']:checked");if(t.length<1)n.alert("请选择未参加会议的专家");else{for(var e=[],i=0;i<t.length;i++)e.push(t[i].value);l.updateJoinState("","",e.join(","),"0",v.isCommit,function(t){v.reFleshJoinState(e,"0"),n.success("操作成功！")})}},v.reFleshJoinState=function(t,e){$.each(t,function(t,i){$.each(v.confirmEPList,function(t,o){i==o.id&&(o.isJoin=e)})}),l.refleshBusinessEP(v.model.workPlanDto.id,function(t){v.model.workPlanDto.expertDtoList=t})},v.countTaxes=function(t){if(void 0!=t){if(void 0==t.payDate)return void n.alert("请选择评审费发放日期");if(!/^(\d{4}-\d{1,2}-\d{1,2})$/.exec(t.payDate))return void n.alert("请输入正确的日期格式");if(void 0==t.expertSelectedDtoList||0==t.expertSelectedDtoList.length)return void n.alert("该方案还没评审专家");common.initJqValidation($("#payform"));if($("#payform").valid()){var e,i=t.expertSelectedDtoList.length,o="";$.each(t.expertSelectedDtoList,function(t,e){o+="'"+e.id+"'",t!=i-1&&(o+=",")});var a=t.payDate;e=a.substring(0,a.lastIndexOf("-")),l.countTaxes(o,e,function(e){var i=e;t.reviewCost=0,t.reviewTaxes=0,t.totalCost=0,$.each(t.expertSelectedDtoList,function(e,o){var n=o.EXPERTID,a=o.id,r=0;void 0!=i&&i.length>0&&i.forEach(function(t,e){t.EXPERTID==n&&t.ESID!=a&&(t.REVIEWCOST=void 0==t.REVIEWCOST?0:t.REVIEWCOST,t.REVIEWCOST=parseFloat(t.REVIEWCOST),r=parseFloat(r)+t.REVIEWCOST)}),o.reviewCost=void 0==o.reviewCost?0:o.reviewCost;var s=r+parseFloat(o.reviewCost);o.reviewTaxes=g(s).toFixed(2),o.totalCost=(parseFloat(o.reviewCost)+parseFloat(o.reviewTaxes)).toFixed(2),t.reviewCost=(parseFloat(t.reviewCost)+parseFloat(o.reviewCost)).toFixed(2),t.reviewTaxes=(parseFloat(t.reviewTaxes)+parseFloat(o.reviewTaxes)).toFixed(2),t.totalCost=(parseFloat(t.reviewCost)+parseFloat(t.reviewTaxes)).toFixed(2)})})}}},v.closeEditPay=function(){window.parent.$("#payment").data("kendoWindow").close()},v.savePayment=function(t){common.initJqValidation($("#payform")),$("#payform").valid()?l.savePayment(t,v.isCommit,function(t){t.flag||"ok"==t.reCode?n.alert("操作成功！",function(){v.isCommit=!1}):n.alert(t.reMsg)}):n.alert("请正确填写专家评审费信息！")},v.editUnitScore=function(t){$("#star").raty({number:5,score:function(){return $(this).attr("data-num",angular.isUndefined(v.model.unitScoreDto.score)?0:v.model.unitScoreDto.score),$(this).attr("data-num")},starOn:"../contents/libs/raty/lib/images/star-on.png",starOff:"../contents/libs/raty/lib/images/star-off.png",starHalf:"../contents/libs/raty/lib/images/star-half.png",readOnly:!1,halfShow:!0,hints:["不合格","合格","中等","良好","优秀"],size:34,click:function(t,e){v.model.unitScoreDto.score=t}}),$("#unitscore_win").kendoWindow({width:"820px",height:"365px",title:"编辑-单位星级",visible:!1,modal:!0,closable:!0,actions:["Close"]}).data("kendoWindow").center().open()},v.saveUnit=function(){v.model.unitScoreDto.score&&0!=v.model.unitScoreDto.score?v.model.unitScoreDto.describes?companySvc.saveUnit(v.model.unitScoreDto,function(t){t.flag||"ok"==t.reCode?n.success("保存成功！",function(){v.closeEditUnit()}):n.alert(t.reMsg)}):n.alert("请对单位进行评分描述！"):n.alert("请对单位进行评分！")},v.closeEditUnit=function(){window.parent.$("#unitscore_win").data("kendoWindow").close()},v.updateFlow=function(){common.initJqValidation(),$("form").valid()?f.updatemonthlyMultiyear(v.suppletter,function(t){t.flag||"ok"==t.reCode?v.commitFlow():n.error(t.reMsg)}):n.alert("缺少部分没有填写，请仔细检查")},v.isTime=function(){""!=v.model.readDate&&void 0!=v.model.readDate&&v.flow.businessMap.RETURNDATE<v.model.readDate&&n.alert("归还时间不能小于查阅时间",function(){v.flow.businessMap.RETURNDATE=v.model.readDate,t.$apply()})}}angular.module("app").controller("flowDealCtrl",t),t.$inject=["$scope","ideaSvc","sysfileSvc","$state","bsWin","topicSvc","flowSvc","bookBuyBusinessSvc","expertReviewSvc","assertStorageBusinessSvc","pauseProjectSvc","archivesLibrarySvc","reviewProjectAppraiseSvc","addSuppLetterSvc","monthlyMultiyearSvc","annountmentSvc"]}(),function(){"use strict";function t(t,e,i,o,n,a,r,s,l,c,d,u,m){var p=this;p.title="在办任务详情页",p.businessKey=e.params.businessKey,p.processKey=e.params.processKey,p.taskId=e.params.taskId,p.instanceId=e.params.instanceId,p.showFlag={businessNext:!1,businessTr:!1,tabSysFile:!1,buttBack:!1},function(){switch($("#myTab li").click(function(t){var e=$("a",this);t.preventDefault(),e.tab("show");var i=e.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500)}),p.picture=rootPath+"/flow/processInstance/img/"+p.instanceId,o.historyData(p),p.processKey){case flowcommon.getFlowDefinedKey().TOPIC_FLOW:i.initFlowDeal(p);break;case flowcommon.getFlowDefinedKey().BOOKS_BUY_FLOW:a.initFlowDeal(p);break;case flowcommon.getFlowDefinedKey().ASSERT_STORAGE_FLOW:r.initFlowDeal(p);break;case flowcommon.getFlowDefinedKey().PROJECT_STOP_FLOW:s.initFlowDeal(p);break;case flowcommon.getFlowDefinedKey().FLOW_ARCHIVES:l.initFlowDeal(p);break;case flowcommon.getFlowDefinedKey().FLOW_APPRAISE_REPORT:c.initFlowDeal(p);break;case flowcommon.getFlowDefinedKey().FLOW_SUPP_LETTER:d.initFlowDeal(p);break;case flowcommon.getFlowDefinedKey().MONTHLY_BULLETIN_FLOW:u.initFlowDeal(p);break;case flowcommon.getFlowDefinedKey().ANNOUNT_MENT_FLOW:m.initFlowDeal(p)}n.findByMianId(p.businessKey,function(e){e&&e.length>0&&(p.showFlag.tabSysFile=!0,p.sysFileList=e,p.urlType="flowDetail",n.initZtreeClient(p,t))})}()}angular.module("app").controller("flowDetailCtrl",t),t.$inject=["$scope","$state","topicSvc","flowSvc","sysfileSvc","bookBuyBusinessSvc","assertStorageBusinessSvc","pauseProjectSvc","archivesLibrarySvc","reviewProjectAppraiseSvc","addSuppLetterSvc","monthlyMultiyearSvc","annountmentSvc"]}(),function(){"use strict";function t(t,e,i,o,n,a,r,s,l,c,d){var u=this;u.title="待办任务处理",u.businessKey=e.params.businessKey,u.processKey=e.params.processKey,u.instanceId=e.params.instanceId,u.showFlag={businessNext:!1,businessTr:!1,tabSysFile:!1,buttBack:!1},function(){switch($("#myTab li").click(function(t){var e=$("a",this);t.preventDefault(),e.tab("show");var i=e.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500)}),o.historyData(u),u.processKey){case flowcommon.getFlowDefinedKey().TOPIC_FLOW:i.initFlowDeal(u);break;case flowcommon.getFlowDefinedKey().BOOKS_BUY_FLOW:a.initFlowDeal(u);break;case flowcommon.getFlowDefinedKey().ASSERT_STORAGE_FLOW:r.initFlowDeal(u);break;case flowcommon.getFlowDefinedKey().PROJECT_STOP_FLOW:s.initFlowDeal(u);break;case flowcommon.getFlowDefinedKey().FLOW_ARCHIVES:l.initFlowDeal(u);break;case flowcommon.getFlowDefinedKey().FLOW_APPRAISE_REPORT:c.initFlowDeal(u);break;case flowcommon.getFlowDefinedKey().FLOW_SUPP_LETTER:d.initFlowDeal(u)}n.findByMianId(u.businessKey,function(e){e&&e.length>0&&(u.showFlag.tabSysFile=!0,u.sysFileList=e,u.urlType="flowEnd",n.initZtreeClient(u,t))})}()}angular.module("app").controller("flowEndCtrl",t),t.$inject=["$scope","$state","topicSvc","flowSvc","sysfileSvc","bookBuyBusinessSvc","assertStorageBusinessSvc","pauseProjectSvc","archivesLibrarySvc","reviewProjectAppraiseSvc","addSuppLetterSvc"]}(),function(){"use strict";var t={SIGN_ZR:"SIGN_ZR",SIGN_QS:"SIGN_QS",SIGN_ZHB:"SIGN_ZHB",SIGN_FGLD_FB:"SIGN_FGLD_FB",SIGN_BMFB1:"SIGN_BMFB1",SIGN_BMFB2:"SIGN_BMFB2",SIGN_BMFB3:"SIGN_BMFB3",SIGN_BMFB4:"SIGN_BMFB4",SIGN_XMFZR1:"SIGN_XMFZR1",SIGN_XMFZR2:"SIGN_XMFZR2",SIGN_XMFZR3:"SIGN_XMFZR3",SIGN_XMFZR4:"SIGN_XMFZR4",SIGN_BMLD_SPW1:"SIGN_BMLD_SPW1",SIGN_BMLD_SPW2:"SIGN_BMLD_SPW2",SIGN_BMLD_SPW3:"SIGN_BMLD_SPW3",SIGN_BMLD_SPW4:"SIGN_BMLD_SPW4",SIGN_FGLD_SPW1:"SIGN_FGLD_SPW1",SIGN_FGLD_SPW2:"SIGN_FGLD_SPW2",SIGN_FGLD_SPW3:"SIGN_FGLD_SPW3",SIGN_FGLD_SPW4:"SIGN_FGLD_SPW4",SIGN_FW:"SIGN_FW",SIGN_QRFW:"SIGN_QRFW",SIGN_BMLD_QRFW_XB:"SIGN_BMLD_QRFW_XB",SIGN_BMLD_QRFW:"SIGN_BMLD_QRFW",SIGN_FGLD_QRFW_XB:"SIGN_FGLD_QRFW_XB",SIGN_FGLD_QRFW:"SIGN_FGLD_QRFW",SIGN_ZR_QRFW:"SIGN_ZR_QRFW",SIGN_FWBH:"SIGN_FWBH",SIGN_CWBL:"SIGN_CWBL",SIGN_GD:"SIGN_GD",SIGN_DSFZR_QRGD:"SIGN_DSFZR_QRGD",SIGN_QRGD:"SIGN_QRGD"},e={TOPIC_JHTC:"TOPIC_JHTC",TOPIC_BZSH_JH:"TOPIC_BZSH_JH",TOPIC_FGLD_JH:"TOPIC_FGLD_JH",TOPIC_ZRSH_JH:"TOPIC_ZRSH_JH",TOPIC_BFGW:"TOPIC_BFGW",TOPIC_LXDW:"TOPIC_LXDW",TOPIC_QDHT:"TOPIC_QDHT",TOPIC_YJSS:"TOPIC_YJSS",TOPIC_NBCS:"TOPIC_NBCS",TOPIC_GZFA:"TOPIC_GZFA",TOPIC_BZSH_FA:"TOPIC_BZSH_FA",TOPIC_FGLD_FA:"TOPIC_FGLD_FA",TOPIC_ZRSH_FA:"TOPIC_ZRSH_FA",TOPIC_CGJD:"TOPIC_CGJD",TOPIC_KTBG:"TOPIC_KTBG",TOPIC_BZSH_BG:"TOPIC_BZSH_BG",TOPIC_FGLD_BG:"TOPIC_FGLD_BG",TOPIC_ZRSH_BG:"TOPIC_ZRSH_BG",TOPIC_KTJT:"TOPIC_KTJT",TOPIC_BZSH_JT:"TOPIC_BZSH_JT",TOPIC_FGLD_JT:"TOPIC_FGLD_JT",TOPIC_ZRSH_JT:"TOPIC_ZRSH_JT",TOPIC_YFZL:"TOPIC_YFZL",TOPIC_ZLGD:"TOPIC_ZLGD"},i={BOOK_LEADER_CGQQ:"BOOK_LEADER_CGQQ",BOOK_BZSP:"BOOK_BZSP",BOOK_FGFZRSP:"BOOK_FGFZRSP",BOOK_ZXZRSP:"BOOK_ZXZRSP",BOOK_YSRK:"BOOK_YSRK"},o={FINAL_SIGN_FLOW:"FINAL_SIGN_FLOW",TOPIC_FLOW:"TOPIC_FLOW",BOOKS_BUY_FLOW:"BOOKS_BUY_FLOW",ASSERT_STORAGE_FLOW:"ASSERT_STORAGE_FLOW",PROJECT_STOP_FLOW:"PROJECT_STOP_FLOW",FLOW_ARCHIVES:"FLOW_ARCHIVES",FLOW_APPRAISE_REPORT:"FLOW_APPRAISE_REPORT",FLOW_SUPP_LETTER:"FLOW_SUPP_LETTER",MONTHLY_BULLETIN_FLOW:"MONTHLY_BULLETIN_FLOW",ANNOUNT_MENT_FLOW:"ANNOUNT_MENT_FLOW"},n={getFlowDefinedKey:function(){return o},getSignFlowNode:function(){return t},getTopicFlowNode:function(){return e},getBooksBuyFlowNode:function(){return i},getAssertStorageFlowNode:function(){return i}};window.flowcommon=n}(),function(){"use strict";function t(t,e){var i=this;i.header={},i.id="",i.create=function(e){e&&(i.header.id=e,i.isUpdate=!0,t.getHeaderById(i,e)),i.header={},$("#addHeaderWindow").kendoWindow({width:"500px",height:"300px",title:"新建表字段",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()},i.save=function(){t.createHeader(i)},i.queryUser=function(){i.gridOptions.dataSource._skip=0,i.gridOptions.dataSource.read()},i.del=function(e){t.deleteHeader(i,e)},i.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)common.alert({vm:i,msg:"请选择数据"});else{for(var e=[],o=0;o<t.length;o++)e.push(t[o].value);var n=e.join(",");i.del(n)}},i.update=function(){t.updateHeader(i)},function(){t.headerGrid(i)}()}angular.module("app").controller("headerCtrl",t),t.$inject=["headerSvc","bsWin"]}(),function(){"use strict";function t(t,e){function i(i){common.initJqValidation();$("form").valid();if(void 0!=i.header.headerKey&&void 0!=i.header.headerName&&void 0!=i.header.headerType){var o={method:"put",url:rootPath+"/header/updateHeader",data:i.header},n=function(t){t.data.flag||"ok"==t.data.reCode?e.success("修改成功!",function(){window.parent.$("#addHeaderWindow").data("kendoWindow").close(),i.gridOptions.dataSource.read()}):e.error(t.data.reMsg)};common.http({vm:i,$http:t,httpOptions:o,success:n})}}function o(i,o){var n={method:"delete",url:rootPath+"/header",params:{id:o}},a=function(t){e.success("删除成功！"),i.gridOptions.dataSource.read()};common.http({vm:i,$http:t,httpOptions:n,success:a})}function n(e,i){var o={method:"get",url:rootPath+"/header/getHeaderById",params:{id:i}},n=function(t){e.header=t.data};common.http({vm:e,$http:t,httpOptions:o,success:n})}function a(e,i){var o={method:"post",url:rootPath+"/header/findHeaderListSelected",params:{headerType:e.headerType}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({vm:e,$http:t,httpOptions:o,success:n})}function r(e,i){var o={method:"put",url:rootPath+"/header/updateSelectedHeader",params:{idStr:i}},n=function(t){};common.http({vm:e,$http:t,httpOptions:o,success:n})}function s(e,i){var o={method:"put",url:rootPath+"/header/updateCancelHeader",params:{idStr:i}},n=function(t){};common.http({vm:e,$http:t,httpOptions:o,success:n})}function l(i){common.initJqValidation();$("form").valid();if(void 0!=i.header.headerKey&&void 0!=i.header.headerName&&void 0!=i.header.headerType){var o={method:"post",url:rootPath+"/header/createHeader",data:i.header},n=function(t){t.data.flag||"ok"==t.data.reCode?e.success("操作成功！",function(){window.parent.$("#addHeaderWindow").data("kendoWindow").close(),i.gridOptions.dataSource.read()}):e.error(t.data.reMsg)};common.http({vm:i,$http:t,httpOptions:o,success:n})}}function c(e){e.header={};var i={method:"post",url:rootPath+"/header/findHeaderListNoSelected",params:{headerType:e.headerType}},o=function(t){e.allHeaderList=t.data};common.http({vm:e,$http:t,httpOptions:i,success:o})}function d(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/header/findAllHeader",$("#headerForm")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"},modifiedDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})},o=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"headerName",title:"列名",width:100,filterable:!1},{field:"headerKey",title:"key值",width:100,filterable:!1},{field:"headerType",title:"类型",width:100,filterable:!1},{field:"",title:"操作",width:140,template:function(t){return common.format($("#columnBtns").html(),"vm.del('"+t.id+"')","vm.create('"+t.id+"')")}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}function u(t,e){c(t),a(t,function(e){t.selectedHeaderList=e,t.header=!0}),$("#selectHeaderWindow").kendoWindow({width:"860px",height:"500px",title:"自定义报表",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open(),t.headerType=e,t.allChecked=function(){var t=$("#selectHeaderForm").find("input");$.each(t,function(t,e){e.checked=!0})},t.allCancel=function(){var t=$("#selectHeaderForm").find("input");$.each(t,function(t,e){e.checked=!1})},t.addHeader=function(){for(var e=[],i=0;i<t.allHeaderList.length;i++){var o={};t.allHeaderList[0].checkbox&&(i=0),o=t.allHeaderList[i],o.checkbox&&(e.push(o.id),t.selectedHeaderList.push(o),t.allHeaderList.splice(i,1),i=0,o.checkbox=!1)}var n=e.join(",");r(t,n)},t.cancelHeader=function(){for(var e=[],i=0;i<t.selectedHeaderList.length;i++){var o={};t.selectedHeaderList[0].checkbox&&(i=0),o=t.selectedHeaderList[i],o.checkbox&&(e.push(o.id),t.allHeaderList.push(o),t.selectedHeaderList.splice(i,1),i=0,o.checkbox=!1)}var n=e.join(",");s(t,n)},t.changeType=function(){c(t),t.selectedHeaderList=[]}}return{headerGrid:d,createHeader:l,findHeaderListNoSelected:c,updateSelectedHeader:r,updateCancelHeader:s,findHeaderListSelected:a,deleteHeader:o,getHeaderById:n,updateHeader:i,selectHeaderWindow:u}}angular.module("app").factory("headerSvc",t),t.$inject=["$http","bsWin"]}(),function(){"use strict";function t(t,e){var i=this;i.selectedHeaderList=[],i.selectList={},i.headerType=e.params.headerType,i.allChecked=function(){var t=$("#selectHeaderForm").find("input");$.each(t,function(t,e){e.checked=!0})},i.allCancel=function(){var t=$("#selectHeaderForm").find("input");$.each(t,function(t,e){e.checked=!1})},i.addHeader=function(){for(var e=[],o=0;o<i.allHeaderList.length;o++){var n=i.allHeaderList[o];n.checkbox&&(e.push(n.id),i.selectedHeaderList.push(n),i.allHeaderList.splice(o,1),o=0,n.checkbox=!1)}var a=e.join(",");t.updateSelectedHeader(i,a)},i.cancelHeader=function(){for(var e=[],o=0;o<i.selectedHeaderList.length;o++){var n=i.selectedHeaderList[o];n.checkbox&&(e.push(n.id),i.allHeaderList.push(n),i.selectedHeaderList.splice(o,1),o=0,n.checkbox=!1)}var a=e.join(",");t.updateCancelHeader(i,a)},i.changeType=function(){t.findHeaderListNoSelected(i),i.selectedHeaderList=[]},function(){t.findHeaderListNoSelected(i),t.findHeaderListSelected(i,function(t){i.selectedHeaderList=t,i.header=!0})}()}angular.module("app").controller("headerEditCtrl",t),t.$inject=["headerSvc","$state"]}(),function(){"use strict";function t(t,e){var i=this;i.title="",i.changePwd=function(){e.changePwd(i)}}angular.module("app").controller("homeCtrl",t),t.$inject=["$location","homeSvc"]}(),function(){"use strict";function t(t){function e(e){if(common.initJqValidation(),$("form").valid()){e.isSubmit=!0;var o={method:"put",url:i,params:{password:e.model.password}},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:e,$http:t,httpOptions:o,success:n})}}var i=rootPath+"/account/password";return{changePwd:e}}angular.module("app").factory("homeSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e){var i=this;i.title="日志列表",function(){e.grid(i)}(),i.queryLog=function(){i.gridOptions.dataSource._skip=0,i.gridOptions.dataSource.read()},i.formReset=function(){var t=$("#logform").find("input,select");$.each(t,function(t,e){e.value=""})}}angular.module("app").controller("logCtrl",t),t.$inject=["$location","logSvc"]}(),function(){"use strict";function t(t,e){function i(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/log/fingByOData",$("#logform")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})},o=[{field:"",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"",title:"级别",width:60,filterable:!1,template:function(t){return t.logLevel?"1"==t.logLevel?"高":"2"==t.logLevel?"中":"3"==t.logLevel?"低":void 0:"低"}},{field:"message",title:"日志内容",filterable:!1,width:400},{field:"module",title:"所属模块",filterable:!1,width:200},{field:"logger",title:"所在方法",filterable:!1,width:350},{field:"userName",title:"操作者",width:80,filterable:!1},{field:"createdDate",title:"操作时间",width:170,filterable:!1,format:"{0:yyyy/MM/dd HH:mm:ss}"}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}return{grid:i}}angular.module("app").factory("logSvc",t),t.$inject=["$http","$compile"]}(),function(){"use strict";function t(t,e,i,o){var n=this;n.signid=t.params.signid,n.showExpertConfirm=!0,function(){o.initFlowPageData(n.signid,function(t){n.model=t,n.model.expertReviewDto&&n.model.expertReviewDto.expertSelectedDtoList&&(n.confirmEPList=n.model.expertReviewDto.expertSelectedDtoList)})}(),n.updateToJoin=function(){var t=$("#notJoinExpertTable input[name='notJoinExpert']:checked");if(t.length<1)i.alert("请选择要改为参加会议的专家");else{for(var o=[],a=0;a<t.length;a++)o.push(t[a].value);e.updateJoinState("","",o.join(","),"9",n.isCommit,function(t){n.reFleshJoinState(o,"9"),i.success("操作成功！")})}},n.updateToNotJoin=function(){var t=$("#joinExpertTable input[name='joinExpert']:checked");if(t.length<1)i.alert("请选择未参加会议的专家");else{for(var o=[],a=0;a<t.length;a++)o.push(t[a].value);e.updateJoinState("","",o.join(","),"0",n.isCommit,function(t){n.reFleshJoinState(o,"0"),i.success("操作成功！")})}},n.reFleshJoinState=function(t,i){$.each(t,function(t,e){$.each(n.confirmEPList,function(t,o){e==o.id&&(o.isJoin=i)})}),$.each(n.model.workProgramDtoList,function(t,i){e.refleshBusinessEP(i.id,function(t){i.expertDtoList=t})})}}angular.module("app").controller("maintainExpertConfirmCtrl",t),t.$inject=["$state","expertReviewSvc","bsWin","signSvc"]}(),function(){"use strict";function t(t,e,i,o){function n(t){t=void 0==t?0:t;var e=0;return t>800&&t<=4e3?e=.2*(t-800):t>4e3&&t<=2e4?e=.8*t*.2:t>2e4&&t<=5e4?e=.8*t*.3-2e3:t>5e4&&(e=.8*t*.3-2755),e}var a=this;a.signid=e.params.signid,a.showExpertPayment=!0,function(){t.initFlowPageData(a.signid,function(t){a.model=t})}(),a.countTaxes=function(t){if(void 0!=t){if(void 0==t.payDate)return void i.alert("请选择评审费发放日期");if(!/^(\d{4}-\d{1,2}-\d{1,2})$/.exec(t.payDate))return void i.alert("请输入正确的日期格式");if(void 0==t.expertSelectedDtoList||0==t.expertSelectedDtoList.length)return void i.alert("该方案还没评审专家");common.initJqValidation($("#payform"));if($("#payform").valid()){var e,a=t.expertSelectedDtoList.length,r="";$.each(t.expertSelectedDtoList,function(t,e){r+="'"+e.id+"'",t!=a-1&&(r+=",")});var s=t.payDate;e=s.substring(0,s.lastIndexOf("-")),o.countTaxes(r,e,function(e){var i=e;t.reviewCost=0,t.reviewTaxes=0,t.totalCost=0,$.each(t.expertSelectedDtoList,function(e,o){if(!("9"!=o.isConfrim&&9!=o.isConfrim||"9"!=o.isJoin&&9!=o.isJoin)){var a=o.EXPERTID,r=o.id,s=0;void 0!=i&&i.length>0&&i.forEach(function(t,e){t.EXPERTID==a&&t.ESID!=r&&(t.REVIEWCOST=void 0==t.REVIEWCOST?0:t.REVIEWCOST,t.REVIEWCOST=parseFloat(t.REVIEWCOST),s=parseFloat(s)+t.REVIEWCOST)}),o.reviewCost=void 0==o.reviewCost?0:o.reviewCost;var l=s+parseFloat(o.reviewCost);o.reviewTaxes=n(l).toFixed(2),o.totalCost=(parseFloat(o.reviewCost)+parseFloat(o.reviewTaxes)).toFixed(2),t.reviewCost=(parseFloat(t.reviewCost)+parseFloat(o.reviewCost)).toFixed(2),t.reviewTaxes=(parseFloat(t.reviewTaxes)+parseFloat(o.reviewTaxes)).toFixed(2),t.totalCost=(parseFloat(t.reviewCost)+parseFloat(t.reviewTaxes)).toFixed(2)}})})}}},a.closeEditPay=function(){window.parent.$("#payment").data("kendoWindow").close()},a.savePayment=function(t){common.initJqValidation($("#payform")),$("#payform").valid()?t.reviewCost?o.savePayment(t,a.isCommit,function(t){t.flag||"ok"==t.reCode?i.alert("操作成功！",function(){a.isCommit=!1}):i.alert(t.reMsg)}):i.alert("请计算税率，再保存！"):i.alert("请正确填写专家评审费信息！")}}angular.module("app").controller("maintainExpertPaymentCtrl",t),t.$inject=["signSvc","$state","bsWin","expertReviewSvc"]}(),function(){"use strict";function t(t,e,i,o){var n=this;n.signid=o.params.signid,n.showExpertScore=!0,n.showFlag={},n.showFlag.isMainPrinUser=!0,function(){i.initFlowPageData(n.signid,function(t){n.model=t})}(),n.editSelectExpert=function(t){n.scoreExpert={},$.each(n.model.expertReviewDto.expertSelectedDtoList,function(e,i){if(i.id==t)return void(n.scoreExpert=angular.copy(i))}),$("#star_"+n.scoreExpert.id).raty({number:5,score:function(){return $(this).attr("data-num",angular.isUndefined(n.scoreExpert.score)?0:n.scoreExpert.score),$(this).attr("data-num")},starOn:"../contents/libs/raty/lib/images/star-on.png",starOff:"../contents/libs/raty/lib/images/star-off.png",starHalf:"../contents/libs/raty/lib/images/star-half.png",readOnly:!1,halfShow:!0,hints:["不合格","合格","中等","良好","优秀"],size:34,click:function(t,e){n.scoreExpert.score=t}}),$("#score_win").kendoWindow({width:"820px",height:"365px",title:"编辑-专家星级",visible:!1,modal:!0,closable:!0,actions:["Close"]}).data("kendoWindow").center().open()},n.closeEditMark=function(){window.parent.$("#score_win").data("kendoWindow").close()},n.saveMark=function(){n.scoreExpert.score&&0!=n.scoreExpert.score?n.scoreExpert.describes?t.saveMark(n.scoreExpert,function(t){t.flag||"ok"==t.reCode?(angular.forEach(n.model.expertReviewDto.expertSelectedDtoList,function(t,e){t.id==n.scoreExpert.id&&(t.score=n.scoreExpert.score,t.describes=n.scoreExpert.describes)}),e.success("保存成功！",function(){n.closeEditMark()})):e.alert(t.reMsg)}):e.alert("请对专家进行评分描述！"):e.alert("请对专家进行评分！")},n.editUnitScore=function(t){$("#star").raty({number:5,score:function(){return $(this).attr("data-num",angular.isUndefined(n.model.unitScoreDto.score)?0:n.model.unitScoreDto.score),$(this).attr("data-num")},starOn:"../contents/libs/raty/lib/images/star-on.png",starOff:"../contents/libs/raty/lib/images/star-off.png",starHalf:"../contents/libs/raty/lib/images/star-half.png",readOnly:!1,halfShow:!0,hints:["不合格","合格","中等","良好","优秀"],size:34,click:function(t,e){n.model.unitScoreDto.score=t}}),$("#unitscore_win").kendoWindow({width:"820px",height:"365px",title:"编辑-单位星级",visible:!1,modal:!0,closable:!0,actions:["Close"]}).data("kendoWindow").center().open()},n.saveUnit=function(){n.model.unitScoreDto.score&&0!=n.model.unitScoreDto.score?n.model.unitScoreDto.describes?companySvc.saveUnit(n.model.unitScoreDto,function(t){t.flag||"ok"==t.reCode?e.success("保存成功！",function(){n.closeEditUnit()}):e.alert(t.reMsg)}):e.alert("请对单位进行评分描述！"):e.alert("请对单位进行评分！")},n.closeEditUnit=function(){window.parent.$("#unitscore_win").data("kendoWindow").close()}}angular.module("app").controller("maintainExpertScoreCtrl",t),t.$inject=["expertReviewSvc","bsWin","signSvc","$state"]}(),function(){"use strict";function t(t,e,i,o,n){var a=this;a.title="修改意见",a.model={},a.dispatchDoc={},a.model.signid=i.params.signid,a.model.processInstanceId=i.params.processInstanceId,function(){e.initFlowPageData(a.model.signid,function(t){if(a.model=t,a.dispatchDoc=a.model.dispatchDocDto,a.model.workProgramDtoList){a.workList=a.model.workProgramDtoList;for(var e=0;e<a.model.workProgramDtoList.length;e++)"1"==a.model.workProgramDtoList[e].branchId&&(a.work=a.model.workProgramDtoList[e],a.work.reviewOrgName&&(a.reviewOrgName=a.work.reviewOrgName.split(",")));for(var e=0;e<a.workList.length;e++)a.workList[e].orgName=a.reviewOrgName[a.model.workProgramDtoList[e].branchId-1]}})}(),a.create=function(){if(e.updateFillin(a.model),void 0!=a.workList&&0!=a.workList.length)for(var i=0;i<a.workList.length;i++)n.createWP(a.workList[i],!1,a.iscommit);a.dispatchDoc?(a.dispatchDoc.signid=a.model.signid,o.saveDispatch(a)):t.alert("操作成功")}}angular.module("app").controller("reviewOpinionCtrl",t),t.$inject=["bsWin","signSvc","$state","dispatchSvc","workprogramSvc"]}(),function(){"use strict";function t(t,e,i){var o=this;o.signId=t.params.signid,o.sign={},o.totalReviewDays=0,o.lengthenDays=0,function(){e.initReviewWorkDays(o,function(t){o.sign=t,o.totalReviewDays=o.sign.totalReviewdays,o.lengthenDays=o.sign.lengthenDays})}(),o.saveReview=function(){common.initJqValidation(),$("form").valid()&&e.saveReview(o,function(t){(t.flag||"ok"==t.reCode)&&i.success("操作成功！")})},o.changeTotalReviewDays=function(){o.sign.lengthenDays=o.sign.totalReviewdays-o.totalReviewDays+o.lengthenDays,o.sign.surplusdays=o.sign.totalReviewdays-o.sign.reviewdays}}angular.module("app").controller("reviewWorkdayCtrl",t),t.$inject=["$state","reviewWorkdaysSvc","bsWin"]}(),function(){"use strict";function t(t){function e(e,i){var o={method:"post",url:rootPath+"/maintainProject/initReviewDays",params:{signId:e.signId}},n=function(t){if(void 0!=i&&"function"==typeof i)return i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function i(e,i){var o={method:"put",url:rootPath+"/maintainProject/saveReview",data:e.sign},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}return{initReviewWorkDays:e,saveReview:i}}angular.module("app").factory("reviewWorkdaysSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e){var i=this;i.title="会议室列表",i.model={},i.del=function(o){t.confirm({title:"询问提示",message:"确认删除数据吗？",onOk:function(){e.deleteMeeting(o,i.isSubmit,function(e){i.isSubmit=!1,e.flag||"ok"==e.reCode?t.alert("消息提示","操作成功！",function(){i.gridOptions.dataSource.read()}):t.alert(e.reMsg)})}})},i.used=function(o){i.model.id=o,i.model.mrStatus="1",e.roomUseState(i.model,function(e){t.alert("操作成功！",function(){i.gridOptions.dataSource.read()})})},i.stoped=function(o){t.confirm({title:"询问提示",message:"确认停用么？",onOk:function(){i.model.id=o,i.model.mrStatus="2",e.roomUseState(i.model,function(e){t.alert("操作成功！",function(){i.gridOptions.dataSource.read()})})}})},i.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)t.alert("请选择数据");else{for(var o=[],n=0;n<e.length;n++)o.push(e[n].value);var a=o.join(",");i.del(a)}},i.queryMeeting=function(){i.gridOptions.dataSource._skip=0,i.gridOptions.dataSource.read()},i.formReset=function(){var t=$("#meetingForm").find("input,select");$.each(t,function(t,e){e.value=""})},function(){e.grid(i)}()}angular.module("app").controller("meetingCtrl",t),t.$inject=["bsWin","meetingSvc"]}(),function(){"use strict";function t(t,e,i){var o=this;o.title="添加会议室",o.isuserExist=!1,o.id=i.params.id,o.id&&(o.isUpdate=!0,o.title="更新会议室"),o.create=function(){common.initJqValidation(),$("form").valid()?e.createMeeting(o.model,o.isSubmit,function(e){e.flag||"ok"==e.reCode?t.alert("消息提示","操作成功！",function(){location.href="#/meeting"}):t.alert(e.reMsg)}):t.alert("信息没填写正确！")},
o.update=function(){common.initJqValidation(),$("form").valid()?(o.model.id=o.id,e.updateMeeting(o.model,o.isSubmit,function(e){e.flag||"ok"==e.reCode?t.alert("操作成功"):t.alert(e.reMsg)})):t.alert("信息没填写正确！")},function(){o.isUpdate&&e.getMeetingById(o)}()}angular.module("app").controller("meetingEditCtrl",t),t.$inject=["bsWin","meetingSvc","$state"]}(),function(){"use strict";function t(t){function e(e,i,o){i=!0;var n={method:"put",url:l,data:e},a=function(t){i=!1,void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:t,httpOptions:n,success:a})}function i(e,i,o){i=!0;var n={method:"delete",url:l,params:{id:e}},a=function(t){i=!1,void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:t,httpOptions:n,success:a})}function o(e,i){var o={method:"put",url:l+"/roomUseState",data:e},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function n(e,i,o){i=!0;var n={method:"post",url:l,data:e},a=function(t){void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:t,httpOptions:n,success:a,onError:function(t){i=!1}})}function a(e){var i={method:"get",url:l+"/html/findByIdMeeting",params:{id:e.id}},o=function(t){e.model=t.data};common.http({vm:e,$http:t,httpOptions:i,success:o})}function r(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(l+"/fingByOData",$("#meetingForm")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})},o=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"num",title:"编号",width:"8%",filterable:!1},{field:"mrName",title:"会议室名称",width:"25%",filterable:!1},{field:"mrType",title:"类型",width:"10%",filterable:!1},{field:"addr",title:"会议室地点",width:"25%",filterable:!1},{field:"capacity",title:"容量",width:"10%",filterable:!1},{field:"",title:"状态",width:"8%",template:function(t){return"2"==t.mrStatus?"停用":"正常"}},{field:"",title:"操作",width:"14%",template:function(t){var e=!1;return e="2"==t.mrStatus,common.format($("#columnBtns").html(),"vm.stoped('"+t.id+"')",e,"vm.used('"+t.id+"')",e,t.id)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}function s(e){var i={method:"post",url:rootPath+"/meeting/findAll"},o=function(t){void 0!=e&&"function"==typeof e&&e(t.data)};common.http({$http:t,httpOptions:i,success:o,onError:function(){}})}var l=rootPath+"/meeting";return{grid:r,getMeetingById:a,createMeeting:n,deleteMeeting:i,updateMeeting:e,roomUseState:o,findAllMeeting:s}}angular.module("app").factory("meetingSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e,i,o){var n=this;n.title="待办事项",n.addregister={},n.model={},n.model.signid=i.params.signid,function(){n.showPrint=!1,e.grid(n)}(),n.print=function(){signcommon.registerFilePrint(n,{$http:o})},n.findbySuppleDate=function(t){}}angular.module("app").controller("registerFileCtrl",t),t.$inject=["$location","registerFileSvc","$state","$http"]}(),function(){"use strict";function t(t,e){function i(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridinlineConfig().transport(t,{readUrl:o+"/findByOData",updateUrl:o+"/update",destroyUrl:o+"/delete",createUrl:o+"/create/"+t.model.signid},{filter:"signid eq '"+t.model.signid+"'"}),schema:common.kendoGridConfig().schema({id:"id",fields:{fileName:{validation:{required:!0},type:"String"},totalNum:{type:"number",validation:{required:!0,min:1}},isHasOriginfile:{type:"boolean"},isHasCopyfile:{type:"boolean"},suppleDeclare:{type:"string"},suppleDate:{type:"date"},createdDate:{type:"date"},modifiedDate:{type:"date"}}}),batch:!0,pageSize:10,serverPaging:!0,serverSorting:!0,serverFiltering:!0,sort:{field:"createdDate",dir:"desc"}}),i=function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})},n=[{field:"",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"fileName",title:"资料名称",width:"120px",filterable:!1},{field:"totalNum",title:"份数",width:"120px",filterable:!1},{field:"isHasOriginfile",title:"原件",width:"120px",filterable:!1,template:function(t){return t.isHasOriginfile?"是":"否"}},{field:"isHasCopyfile",title:"复印件",width:"120px",filterable:!1,template:function(t){return t.isHasCopyfile?"是":"否"}},{field:"suppleDeclare",title:"补充说明",width:"120px",filterable:!1},{field:"suppleDate",title:"补充日期",width:"120px",format:"{0:yyyy-MM-dd}",filterable:!1},{command:["destroy"],title:"&nbsp;",width:"250px"}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridinlineConfig().filterable,pageable:common.kendoGridinlineConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:n,toolbar:["create","save","cancel"],dataBound:i,editable:!0,navigatable:!0,resizable:!0}}var o=rootPath+"/addRegisterFile";return{grid:i}}angular.module("app").factory("registerFileSvc",t),t.$inject=["$rootScope","$http"]}(),function(){"use strict";function t(t,e,i,o){var n=this;n.showsupp=!1,n.title="拟补资料函",n.suppletter={},n.model={},n.model.signid=i.params.signid,n.suppletter.id=i.params.id,n.addSuppContent=function(){n.showsupp=!0,$("#addsuppContent").kendoWindow({width:"50%",height:"80%",title:"拟补资料函正文",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()}}angular.module("app").controller("suppletterCtrls",t),t.$inject=["$location","suppletterSvc","$state","$http"]}(),function(){"use strict";function t(t,e){return{}}angular.module("app").factory("suppletterSvc",t),t.$inject=["$rootScope","$http"]}(),function(){"use strict";function t(t,e){var i=this;i.title="月报简报历史数据管理",i.del=function(t){common.confirm({vm:i,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),e.deletemonthlyHistory(i,t)}})},i.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)common.alert({vm:i,msg:"请选择数据"});else{for(var e=[],o=0;o<t.length;o++)e.push(t[o].value);var n=e.join(",");i.del(n)}},function(){e.monthlyHistoryGrid(i),e.deleteGridOptions(i)}()}angular.module("app").controller("monthlyHistoryCtrl",t),t.$inject=["$location","monthlyHistorySvc"]}(),function(){"use strict";function t(t,e,i,o){var n=this;n.title="添加月报简报历史数据",n.isuserExist=!1,n.id=i.params.id,n.monthly={},n.id&&(n.isUpdate=!0,n.title="更新月报简报"),n.createHistory=function(){common.initJqValidation(),$("form").valid()?e.createmonthlyHistory(n.monthly,function(t){t.flag||"ok"==t.reCode?(n.monthly=t.reObj,o.alert("操作成功！")):o.error(t.reMsg)}):o.alert("缺少部分没有填写，请仔细检查")},n.updateMonthly=function(){e.updatemonthlyHistory(n)},function(){n.isUpdate&&e.getmonthlyHistoryById(n)}()}angular.module("app").controller("monthlyHistoryEditCtrl",t),t.$inject=["$location","monthlyHistorySvc","$state","bsWin"]}(),function(){"use strict";function t(t){function e(e){if(common.initJqValidation(),$("form").valid()){e.isSubmit=!0,e.monthly.id=e.id;var i={method:"put",url:l+"/monthlyEdit",data:e.monthly},o=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:e,$http:t,httpOptions:i,success:o})}}function i(e,i){e.isSubmit=!0;var n={method:"delete",url:l+"/deleteHistory",data:i},a=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",closeDialog:!0,fn:function(){e.isSubmit=!1,e.gridOptions.dataSource.read(),o()}})}})};common.http({vm:e,$http:t,httpOptions:n,success:a})}function o(){window.location.reload()}function n(e,i){var o={method:"post",url:l+"/savaHistory",data:e},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function a(e){var i={method:"get",url:rootPath+"/monthlyNewsletter/html/findById",params:{id:e.id}},o=function(t){e.monthly=t.data};common.http({vm:e,$http:t,httpOptions:i,success:o})}function r(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(l+"/mothlyHistoryList"),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})},o=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"startDay",title:"开始时间",width:100,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"startDay",title:"结束时间",width:100,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"stageMunber",title:"已评审项目数",width:120,filterable:!1},{field:"declarationSum",title:"报审总投资",width:100,filterable:!1},{field:"assessorSum",title:"审核总投资",width:100,filterable:!1},{field:"authorizedUser",title:"录入人",width:100,filterable:!1},{field:"authorizedTime",title:"录入时间",width:100,filterable:!1},{field:"",title:"操作",width:100,template:function(t){return common.format($("#columnBtns").html(),t.id,"vm.del('"+t.id+"')")}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,dataBound:i,columns:o,resizable:!0}}function s(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(l+"/deleteHistoryList"),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})},o=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"startDay",title:"开始时间",width:100,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"startDay",title:"结束时间",width:100,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"stageMunber",title:"已评审项目数",width:120,filterable:!1},{field:"declarationSum",title:"报审总投资",width:100,filterable:!1},{field:"assessorSum",title:"审核总投资",width:100,filterable:!1},{field:"authorizedUser",title:"录入人",width:100,filterable:!1},{field:"authorizedTime",title:"录入时间",width:100,filterable:!1}];t.deleteGridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,dataBound:i,columns:o,resizable:!0}}var l=rootPath+"/monthlyNewsletter";return{monthlyHistoryGrid:r,deleteGridOptions:s,createmonthlyHistory:n,deletemonthlyHistory:i,getmonthlyHistoryById:a,updatemonthlyHistory:e}}angular.module("app").factory("monthlyHistorySvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e,i,o,n){var a=this;a.title="月报简报查询",a.stateName=i.current.name,a.queryParams={},a.saveView=function(){n.storeView(a.stateName,{gridParams:a.multiyearGrid.dataSource.transport.options.read.data(),queryParams:a.queryParams,data:a})},function(){if(n.view[a.stateName]){var t=n.view[a.stateName];t.gridParams&&(a.gridParams=t.gridParams),t.data&&(a.model=t.data.model),t.queryParams&&(a.queryParams=t.queryParams),e.monthlyMultiyearGrid(a),n.view[a.stateName]=void 0}else e.monthlyMultiyearGrid(a)}(),a.addSuppQuery=function(){a.multiyearGrid.dataSource._skip=0,a.multiyearGrid.dataSource.read()},a.resetAddSupp=function(){var t=$("#form").find("input,select");$.each(t,function(t,e){e.value=""})}}angular.module("app").controller("monthlyMultiFileCtrl",t),t.$inject=["$location","monthlyMultiyearSvc","$state","bsWin","$rootScope"]}(),function(){"use strict";function t(t,e,i,o,n){var a=this;a.title="年度月报简报",a.suppletter={},a.suppletter.fileYear=i.params.year,$("#fileYear").val(a.suppletter.fileYear),a.stateName=i.current.name,a.queryParams={},a.saveView=function(){n.storeView(a.stateName,{gridParams:a.monthlyYearGrid.dataSource.transport.options.read.data(),queryParams:a.queryParams,data:a})},function(){if(n.view[a.stateName]){var t=n.view[a.stateName];t.gridParams&&(a.gridParams=t.gridParams),t.data&&(a.model=t.data.model),t.queryParams&&(a.queryParams=t.queryParams),e.monthlyYearGrid(a),n.view[a.stateName]=void 0}else e.monthlyYearGrid(a);e.findAllOrg(a)}(),a.addSuppQuery=function(){e.addSuppQuery(a)},a.resetAddSupp=function(){var t=$("#form_monthly").find("input,select");$.each(t,function(t,e){e.value=""})},a.del=function(t){common.confirm({vm:a,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),e.deletemonthlyMultiyear(a,t)}})},a.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)common.alert({vm:a,msg:"请选择数据"});else{for(var e=[],i=0;i<t.length;i++)e.push(t[i].value);var o=e.join(",");a.del(o)}}}angular.module("app").controller("monthlyMultiyearCtrl",t),t.$inject=["$location","monthlyMultiyearSvc","$state","bsWin","$rootScope"]}(),function(){"use strict";function t(t,e,i,o,n){var a=this;a.title="添加月报简报稿纸",a.isuserExist=!1,a.isSubmit=!0,a.suppletter={},a.id=i.params.id,a.type=i.params.type,a.suppletter.id=i.params.id,a.suppletter.fileYear=i.params.year,a.id&&(a.isUpdate=!0,a.isflow=!0,a.title="更新月报简报稿纸"),a.businessFlag={isInitFileOption:!1},function(){a.isUpdate?t.getmonthlyMultiyearById(a.id,function(t){a.suppletter=t,a.initFileUpload()}):t.initMonthlyMultiyear(function(t){a.suppletter=t,a.suppletter.fileYear=i.params.year,a.initFileUpload()})}(),a.initFileUpload=function(){a.suppletter.id||n.$watch("vm.suppletter.id",function(t,e){t&&t!=e&&!a.initUploadOptionSuccess&&a.initFileUpload()}),a.sysFile={businessId:a.suppletter.id,mainId:a.suppletter.id,mainType:e.mainTypeValue().SIGN,sysfileType:e.mainTypeValue().MONTH_FILE,sysBusiType:e.mainTypeValue().MONTH_FILE},e.initUploadOptions({inputId:"sysfileinput",vm:a})},a.saveAddSuppletter=function(){common.initJqValidation(),$("form").valid()?(a.suppletter.fileType="2",t.createmonthlyMultiyear(a.suppletter,function(t){t.flag||"ok"==t.reCode?(a.suppletter=t.reObj,a.id=t.reObj.id,o.alert("操作成功！")):o.error(t.reMsg)})):o.alert("缺少部分没有填写，请仔细检查")},a.updateAddSuppletter=function(){common.initJqValidation(),$("form").valid()?t.updatemonthlyMultiyear(a.suppletter,function(t){t.flag||"ok"==t.reCode?o.alert("操作成功！"):o.error(t.reMsg)}):o.alert("缺少部分没有填写，请仔细检查")},a.startNewFlow=function(e){o.confirm({title:"询问提示",message:"确认已经完成填写，并且发起流程么？",onOk:function(){$(".confirmDialog").modal("hide"),e?t.updatemonthlyMultiyear(a.suppletter,function(i){i.flag||"ok"==i.reCode?t.startFlow(e,function(t){t.flag||"ok"==t.reCode?o.success("操作成功！",function(){location.href="#/theMonthsList"}):o.error(t.reMsg)}):o.error(i.reMsg)}):(a.suppletter.fileType="2",t.createmonthlyMultiyear(a.suppletter,function(e){e.flag||"ok"==e.reCode?(a.suppletter=e.reObj,a.id=e.reObj.id,t.startFlow(a.id,function(t){t.flag||"ok"==t.reCode?o.success("操作成功！",function(){location.href="#/theMonthsList"}):o.error(t.reMsg)})):o.error(e.reMsg)}))}})}}angular.module("app").controller("monthlyMultiyearEditCtrl",t),t.$inject=["monthlyMultiyearSvc","sysfileSvc","$state","bsWin","$scope"]}(),function(){"use strict";function t(t,e){function i(e){var i={method:"get",url:common.format(h+"/findAllUsers")},o=function(t){e.userlist={},e.userlist=t.data};common.http({vm:e,$http:t,httpOptions:i,success:o})}function o(e){var i={method:"get",url:common.format(h+"/getOrg")},o=function(t){e.orglist={},e.orglist=t.data};common.http({vm:e,$http:t,httpOptions:i,success:o})}function n(t){t.monthlyYearGrid.dataSource._skip=0,t.monthlyYearGrid.dataSource.read()}function a(e){var i={method:"post",url:rootPath+"/monthlyNewsletter/initMonthlyMultiyear"},o=function(t){void 0!=e&&"function"==typeof e&&e(t.data)};common.http({$http:t,httpOptions:i,success:o})}function r(e,i){var o={method:"post",url:f+"/saveMonthlyMultiyear",data:e},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function s(i,o){i.isSubmit=!0;var n={method:"delete",url:f+"/deleteMutiyear",data:o},a=function(t){e.alert("操作成功",function(){i.isSubmit=!1,i.monthlyYearGrid.dataSource.read()})};common.http({vm:i,$http:t,httpOptions:n,success:a})}function l(e,i){var o={method:"post",url:f+"/saveMonthlyMultiyear",data:e},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function c(e,i){var o={method:"post",url:rootPath+"/addSuppLetter/findById",params:{id:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function d(t){var e=common.kendoGridDataSource(rootPath+"/addSuppLetter/monthlyMultiyearList",$("#form_monthly"),t.queryParams.page,t.queryParams.pageSize,t.gridParams),i=[{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"title",title:"文件标题",width:180,filterable:!1,template:function(e){return e.processInstanceId?'<a ng-click="vm.saveView()" href="#/monthlyMultiyView/'+e.id+'" >'+e.title+"</a>":'<a ng-click="vm.saveView()" href="#/monthlyMultiyearEdit/'+t.suppletter.fileYear+"/"+e.id+'" >'+e.title+"</a>"}},{field:"orgName",title:"拟办部门",width:100,filterable:!1},{field:"userName",title:"拟稿人",width:120,filterable:!1},{field:"suppLetterTime",title:"拟稿时间",width:100,filterable:!1},{field:"secretLevel",title:"秘密等级",width:100,filterable:!1},{field:"",title:"操作",width:140,template:function(e){var i=!0;return(angular.isUndefined(e.processInstanceId)||""==e.processInstanceId)&&(i=!1),common.format($("#columnBtns").html(),t.suppletter.fileYear,e.id,i,e.createdBy,e.id,"vm.del('"+e.id+"')")}}];t.monthlyYearGrid={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,pageable:common.kendoGridConfig(t.queryParams).pageable,dataBound:common.kendoGridConfig(t.queryParams).dataBound,columns:i,resizable:!0}}function u(t){var e=common.kendoGridDataSource(rootPath+"/addSuppLetter/monthlyMultiyearList",$("#form"),t.queryParams.page,t.queryParams.pageSize,t.gridParams),i=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"title",title:"文件标题",width:"30%",filterable:!1,template:function(t){return'<a ng-click="vm.saveView()" href="#/monthlyMultiyView/'+t.id+'" >'+t.title+"</a>"}},{field:"orgName",title:"拟办部门",width:"10%",filterable:!1},{field:"userName",title:"拟稿人",width:"10%",filterable:!1},{field:"suppLetterTime",title:"拟稿时间",width:"10%",filterable:!1},{field:"secretLevel",title:"秘密等级",width:"10%",filterable:!1},{field:"",title:"操作",width:80,template:function(t){return common.format($("#columnBtns").html(),t.id,t.appoveStatus)}}];t.multiyearGrid={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,pageable:common.kendoGridConfig(t.queryParams).pageable,dataBound:common.kendoGridConfig(t.queryParams).dataBound,columns:i,resizable:!0}}function m(e,i){var o={method:"post",url:rootPath+"/monthlyNewsletter/startFlow",params:{id:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function p(t){c(t.businessKey,function(e){t.suppletter=e})}var f=rootPath+"/monthlyNewsletter",h=rootPath+"/user";return{createmonthlyMultiyear:l,initMonthlyMultiyear:a,monthlyMultiyearGrid:u,monthlyYearGrid:d,getmonthlyMultiyearById:c,updatemonthlyMultiyear:r,addSuppQuery:n,findAllOrg:o,findAllUser:i,deletemonthlyMultiyear:s,startFlow:m,initFlowDeal:p}}angular.module("app").factory("monthlyMultiyearSvc",t),t.$inject=["$http","bsWin"]}(),function(){"use strict";function t(t,e,i,o,n){var a=this;a.title="月报详情页面",a.suppletter={},a.id=i.params.id,function(){t.getmonthlyMultiyearById(a.id,function(t){a.suppletter=t})}()}angular.module("app").controller("monthlyMultiyViewCtrl",t),t.$inject=["monthlyMultiyearSvc","sysfileSvc","$state","bsWin","$scope"]}(),function(){"use strict";function t(t,e){var i=this;i.title="月报简报列表",function(){e.monthlyNewsletterGrid(i),e.monthlyDeleteGrid(i)}(),i.del=function(o){t.confirm({title:"询问提示",message:"确认删除数据吗？",onOk:function(){e.deleteMonthlyNewsletter(o,function(e){(e.flag||"ok"==e.reCode)&&t.alert("操作成功！",function(){i.gridOptions.dataSource.read(),i.monthlyDeleteGridOptions.dataSource.read()})})}})},i.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)t.alert("请选择要删除的数据！");else{for(var o=[],n=0;n<e.length;n++)o.push(e[n].value);var a=o.join(",");i.del(a)}}}angular.module("app").controller("monthlyNewsletterCtrl",t),t.$inject=["bsWin","monthlyNewsletterSvc"]}(),function(){"use strict";function t(t,e,i,o){function n(){var t=new Date,e=t.getFullYear(),i=t.getMonth()+1;1==i?(a.monthly.reportMultiyear=e-1+"",a.monthly.startMoultiyear=e-1+"",a.monthly.endMoultiyear=e-1+"",a.monthly.theMonths="12",a.monthly.staerTheMonths="1",a.monthly.endTheMonths="12"):(a.monthly.reportMultiyear=e+"",a.monthly.startMoultiyear=e+"",a.monthly.endMoultiyear=e+"",a.monthly.theMonths=i-1+"",a.monthly.staerTheMonths="1",a.monthly.endTheMonths=i-1+"")}var a=this;a.title="添加月报简报",a.isuserExist=!1,a.id=i.params.id,a.monthly={},a.id&&(a.isUpdate=!0,a.title="更新月报简报"),a.selectMonthly=function(){a.monthly.endTheMonths=a.monthly.theMonths,a.monthly.staerTheMonths="1"},a.reportYear=function(){var t=a.monthly.reportMultiyear;a.monthly.startMoultiyear=t,a.monthly.endMoultiyear=t},a.startMonthly=function(){parseInt(a.monthly.endTheMonths)<parseInt(a.monthly.staerTheMonths)&&(o.alert("开始月份不能大于结束月份"),a.monthly.staerTheMonths=" ")},a.createMothlyNewsletter=function(){common.initJqValidation(),$("#form").valid()?e.createMonthlyNewsletter(a.monthly,function(t){t.flag||"ok"==t.reCode?(a.monthly=t.reObj,o.alert("操作成功！")):o.error(t.reMsg)}):o.alert("缺少部分没有填写，请仔细检查")},a.updateMonthly=function(){e.updateMonthlyNewsletter(a)},a.createMonthReport=function(){e.createMonthReport(a)},function(){a.isUpdate?e.getMonthlyNewsletterById(a):n()}()}angular.module("app").controller("monthlyNewsletterEditCtrl",t),t.$inject=["$location","monthlyNewsletterSvc","$state","bsWin"]}(),function(){"use strict";function t(t){function e(e){if(common.initJqValidation(),$("form").valid()){e.isSubmit=!0,e.monthly.id=e.id;var i={method:"put",url:c+"/monthlyEdit",data:e.monthly},o=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:e,$http:t,httpOptions:i,success:o})}}function i(e,i){var o={method:"delete",url:c+"/deleteMonthlyData",params:{id:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function o(e,i){var o={method:"post",url:c+"/savaMonthlyNewsletter",data:e},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function n(t){void 0==t.monthly.reportMultiyear&&(t.monthly.reportMultiyear=""),void 0==t.monthly.theMonths&&(t.monthly.theMonths=""),void 0==t.monthly.startMoultiyear&&(t.monthly.startMoultiyear=""),void 0==t.monthly.endMoultiyear&&(t.monthly.endMoultiyear=""),void 0==t.monthly.staerTheMonths&&(t.monthly.staerTheMonths=""),void 0==t.monthly.endTheMonths&&(t.monthly.endTheMonths=""),window.open(rootPath+"/monthlyNewsletter/createMonthReport?reportMultiyear="+t.monthly.reportMultiyear+"&theMonths="+t.monthly.theMonths+"&startMoultiyear="+t.monthly.startMoultiyear+"&endMoultiyear="+t.monthly.endMoultiyear+"&staerTheMonths="+t.monthly.staerTheMonths+"&endTheMonths="+t.monthly.endTheMonths)}function a(e){var i={method:"get",url:rootPath+"/monthlyNewsletter/html/findById",params:{id:e.id}},o=function(t){e.monthly=t.data};common.http({vm:e,$http:t,httpOptions:i,success:o})}function r(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(c+"/findByOData",$("#monthlyForm"),{$filter:"monthlyType eq '1'"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})},o=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"reportMultiyear",title:"报告年度",width:100,filterable:!1},{field:"theMonths",title:"报告月份",width:100,filterable:!1},{field:"remark",title:"报告说明",width:100,filterable:!1},{field:"authorizedUser",title:"编制人",width:100,filterable:!1},{field:"authorizedTime",title:"编制时间",width:100,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"",title:"操作",width:140,template:function(t){return common.format($("#columnBtns").html(),t.id,"vm.del('"+t.id+"')")}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,dataBound:i,columns:o,resizable:!0}}function s(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(c+"/findByOData",$("#monthlyForm"),{$filter:"monthlyType eq '2'"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})},o=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"reportMultiyear",title:"报告年度",width:100,filterable:!1},{field:"theMonths",title:"报告月份",width:100,filterable:!1},{field:"remark",title:"报告说明",width:100,filterable:!1},{field:"authorizedUser",title:"编制人",width:100,filterable:!1},{field:"authorizedTime",title:"编制时间",width:100,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"}];t.monthlyDeleteGridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,dataBound:i,columns:o,resizable:!0}}function l(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/monthlyNewsletter/getMonthlyList"),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}})}),i=function(){var t=this.items();$(t).each(function(){var t=$(this).index()+1,e=$(this).find(".row-number");$(e).html(t)})},o=[{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"monthlyNewsletterName",title:"名称",width:"30%",filterable:!1,template:function(t){return'<a href="#/monthlyFindByMultiyear/'+t.reportMultiyear+'" >'+t.monthlyNewsletterName+"</a>"}},{field:"reportMultiyear",title:"年份",width:"15%",filterable:!1},{field:"remark",title:"备注",width:"40%",filterable:!1},{field:"authorizedTime",title:"添加时间",width:"15%",filterable:!1}];t.theMonthGridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,dataBound:i,columns:o,resizable:!0}}var c=rootPath+"/monthlyNewsletter";return{monthlyNewsletterGrid:r,monthlyDeleteGrid:s,theMonthGrid:l,createMonthlyNewsletter:o,updateMonthlyNewsletter:e,deleteMonthlyNewsletter:i,getMonthlyNewsletterById:a,createMonthReport:n}}angular.module("app").factory("monthlyNewsletterSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e){var i=this;i.title="年度月报简报列表",function(){e.theMonthGrid(i)}()}angular.module("app").controller("yearMonthlyNewsletterCtrl",t),t.$inject=["$location","monthlyNewsletterSvc"]}(),function(){"use strict";function t(t,e,i,o){var n=this;n.title="处室人员管理",n.stateName=i.current.name,n.queryParams={},n.saveView=function(){o.storeView(n.stateName,{gridParams:n.gridOptions.dataSource.transport.options.read.data(),queryParams:n.queryParams,data:n})},n.del=function(t){common.confirm({vm:n,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),e.deleteOfficeUser(n,t)}})},n.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)common.alert({vm:n,msg:"请选择数据"});else{for(var e=[],i=0;i<t.length;i++)e.push(t[i].value);var o=e.join(",");n.del(o)}},n.queryOffice=function(){e.queryOffice(n)},function(){if(o.view[n.stateName]){var t=o.view[n.stateName];t.gridParams&&(n.gridParams=t.gridParams),t.data&&(n.model=t.data.model),t.queryParams&&(n.queryParams=t.queryParams),e.grid(n),o.view[n.stateName]=void 0}else e.grid(n)}()}angular.module("app").controller("officeUserCtrl",t),t.$inject=["$location","officeUserSvc","$state","$rootScope"]}(),function(){"use strict";function t(t,e,i){var o=this;o.title="添加人员",o.isuserExist=!1,o.officeID=i.params.officeID,o.officeID&&(o.isUpdate=!0,o.title="更新人员"),o.create=function(){e.createOfficeUser(o)},o.update=function(){e.updateOfficeUser(o)},function(){o.isUpdate&&e.getOfficeUserById(o),e.getDepts(o)}()}angular.module("app").controller("officeUserEditCtrl",t),t.$inject=["$location","officeUserSvc","$state"]}(),function(){"use strict";function t(t){function e(t){t.gridOptions.dataSource._skip=0,t.gridOptions.dataSource.read()}function i(e){var i={method:"get",url:common.format(l+"/getDepts")},o=function(t){e.depts={},e.depts=t.data};common.http({vm:e,$http:t,httpOptions:i,success:o})}function o(e){if(common.initJqValidation(),$("form").valid()){e.isSubmit=!0,e.model.id=e.id;var i={method:"put",url:l,data:e.model},o=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:e,$http:t,httpOptions:i,success:o})}}function n(e,i){e.isSubmit=!0;var o={method:"delete",url:l,data:i},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",closeDialog:!0,fn:function(){e.isSubmit=!1,e.gridOptions.dataSource.read()}})}})}
;common.http({vm:e,$http:t,httpOptions:o,success:n})}function a(e){if(common.initJqValidation(),$("form").valid()){e.isSubmit=!0;var i={method:"post",url:l,data:e.model},o=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",closeDialog:!0,fn:function(){e.isSubmit=!1,location.href=c}})}})};common.http({vm:e,$http:t,httpOptions:i,success:o})}}function r(e){var i={method:"get",url:rootPath+"/officeUser/html/findById",params:{officeID:e.officeID}},o=function(t){t.data.dept,e.model=t.data};common.http({vm:e,$http:t,httpOptions:i,success:o})}function s(t){var e=common.kendoGridDataSource(l+"/fingByOData",$("#formOffice"),t.queryParams.page,t.queryParams.pageSize,t.gridParams),i=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.officeID)},filterable:!1,width:20,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:30,filterable:!1,template:"<span class='row-number'></span>"},{field:"officeUserName",title:"办事处联系人",width:100,filterable:!1},{field:"deptName",title:"所在办事处",width:100,filterable:!1},{field:"officePhone",title:"电话",width:100,filterable:!1},{field:"officeEmail",title:"邮件",width:100,filterable:!1},{field:"officeDesc",title:"描述",width:100,filterable:!1},{field:"",title:"操作",width:140,template:function(t){return common.format($("#columnBtns").html(),"vm.del('"+t.officeID+"')",t.officeID)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,pageable:common.kendoGridConfig(t.queryParams).pageable,dataBound:common.kendoGridConfig(t.queryParams).dataBound,resizable:!0}}var l=rootPath+"/officeUser",c="#/officeUserList";return{grid:s,getOfficeUserById:r,createOfficeUser:a,deleteOfficeUser:n,updateOfficeUser:o,getDepts:i,queryOffice:e}}angular.module("app").factory("officeUserSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e){var i=this;i.title="部门列表",i.del=function(t){common.confirm({vm:i,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),e.deleteOrg(i,t)}})},i.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)common.alert({vm:i,msg:"请选择数据"});else{for(var e=[],o=0;o<t.length;o++)e.push(t[o].value);var n=e.join(",");i.del(n)}},i.queryOrg=function(){e.queryOrg(i)},function(){e.grid(i)}()}angular.module("app").controller("orgCtrl",t),t.$inject=["$location","orgSvc"]}(),function(){"use strict";function t(t,e,i,o){var n=this;n.model={},n.title="新增部门",n.isorgExist=!1,n.model.id=i.params.id,n.model.id&&(n.isUpdate=!0,n.title="更新部门"),function(){e.initRoleUsers(function(t){n.orgMLeaderUsers=t.DIRECTOR,n.orgSLeaderUser=t.VICE_DIRECTOR,n.OrgDirectorUsers=t.DEPT_LEADER}),n.isUpdate&&e.getOrgById(n.model.id,function(t){n.model=t})}(),n.create=function(){common.initJqValidation(),$("form").valid()?($.each(n.OrgDirectorUsers,function(t,e){e.id==n.model.orgDirector&&(n.model.orgDirectorName=e.displayName)}),$.each(n.orgMLeaderUsers,function(t,e){e.id==n.model.orgMLeader&&(n.model.orgMLeaderName=e.displayName)}),$.each(n.orgSLeaderUser,function(t,e){e.id==n.model.orgSLeader&&(n.model.orgSLeaderName=e.displayName)}),e.createOrg(n.model,n.isSubmit,function(t){n.isSubmit=!1,t.flag||"ok"==t.reCode?(n.model.id||(n.model.id=t.idCode),o.success("操作成功！")):o.error(t.reMsg)})):o.alert("保存失败，有红色*号的选项是必填项，请按要求填写！")},n.update=function(){common.initJqValidation(),$("form").valid()?($.each(n.OrgDirectorUsers,function(t,e){e.id==n.model.orgDirector&&(n.model.orgDirectorName=e.displayName)}),$.each(n.orgMLeaderUsers,function(t,e){e.id==n.model.orgMLeader&&(n.model.orgMLeaderName=e.displayName)}),$.each(n.orgSLeaderUser,function(t,e){e.id==n.model.orgSLeader&&(n.model.orgSLeaderName=e.displayName)}),e.updateOrg(n.model,n.isSubmit,function(t){n.isSubmit=!1,t.flag||"ok"==t.reCode?o.success("操作成功！"):o.alert(t.reMsg)})):o.alert("保存失败，有红色*号的选项是必填项，请按要求填写！")}}angular.module("app").controller("orgEditCtrl",t),t.$inject=["$location","orgSvc","$state","bsWin"]}(),function(){"use strict";function t(t,e){function i(t){t.gridOptions.dataSource._skip=0,t.gridOptions.dataSource.read()}function o(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(u+"/fingByOData",$("#orgForm")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"sort",dir:"asc"}}),i=function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})},o=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"name",title:"部门名称",width:130,filterable:!1},{field:"orgFunction",title:"职能",width:130,filterable:!1},{field:"orgDirectorName",title:"部门负责人",width:100,filterable:!1},{field:"orgSLeaderName",title:"分管领导",width:100,filterable:!1},{field:"orgPhone",title:"电话",width:130,filterable:!1},{field:"",title:"操作",width:200,template:function(t){return common.format($("#columnBtns").html(),"vm.del('"+t.id+"')",t.id)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}function n(e,i,o){i=!0;var n={method:"post",url:u,data:e},a=function(t){i=!1,void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:t,httpOptions:n,success:a,onError:function(){i=!1}})}function a(e){var i={method:"get",url:common.format(u+"/getCompany")},o=function(t){e.company={},e.company=t.data};common.http({vm:e,$http:t,httpOptions:i,success:o})}function r(e,i){var o={method:"post",url:rootPath+"/org/getOrgById",params:{id:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function s(e,i,o){i=!0;var n={method:"post",url:rootPath+"/org/updateOrg",data:e},a=function(t){i=!1,void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:t,httpOptions:n,success:a,onError:function(){i=!1}})}function l(e,i){e.isSubmit=!0;var o={method:"delete",url:u,data:i},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.isSubmit=!1,e.gridOptions.dataSource.read()}})};common.http({vm:e,$http:t,httpOptions:o,success:n})}function c(e){var i={method:"post",url:rootPath+"/user/initRoleUsers"},o=function(t){void 0!=e&&"function"==typeof e&&e(t.data)};common.http({$http:t,httpOptions:i,success:o})}function d(e,i){var o={method:"post",url:rootPath+"/org/queryOrgList"},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({vm:e,$http:t,httpOptions:o,success:n})}var u=rootPath+"/org";rootPath;return{grid:o,createOrg:n,getOrgById:r,updateOrg:s,deleteOrg:l,getCompany:a,initRoleUsers:c,queryOrg:i,queryOrgList:d}}angular.module("app").factory("orgSvc",t),t.$inject=["$http","$compile"]}(),function(){"use strict";function t(t,e,i,o){var n=this;n.id=e.params.id,n.showAddUserDialog=function(){$(".addUser").modal({backdrop:"static",keyboard:!1}),n.orgUserGrid.dataSource.read()},n.closeAddUserDialog=function(){$(".addUser").modal("hide")},n.add=function(t){o.add(n,t)},n.remove=function(t){o.remove(n,t)},n.removes=function(){var t=common.getKendoCheckId(".gird");if(0==t.length)common.alert({vm:n,msg:"请选择数据"});else{for(var e=[],i=0;i<t.length;i++)e.push(t[i].value);var o=e.join(",");n.remove(o)}},n.query=function(){n.gridOptions.dataSource._skip=0,n.gridOptions.dataSource.read()},n.formReset=function(){var t=$("#form").find("input,select").not(":submit, :reset, :image, :disabled,:hidden");$.each(t,function(t,e){e.value=""})},function(){o.orgUserGrid(n),o.allUserGrid(n)}()}angular.module("app").controller("orgUserCtrl",t),t.$inject=["$location","$state","orgSvc","orgUserSvc"]}(),function(){"use strict";function t(t,e){function i(e,i){var o={method:"delete",url:rootPath+"/org/deleteUsers",params:{orgId:e.id,userId:i}},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.gridOptions.dataSource.read()}})};common.http({vm:e,$http:t,httpOptions:o,success:n})}function o(e,i){var o={method:"post",url:rootPath+"/org/addUsers",params:{orgId:e.id,userId:i}},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.orgUserGrid.dataSource.read(),e.gridOptions.dataSource.read()}})};common.http({vm:e,$http:t,httpOptions:o,success:n})}function n(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(r+"?orgId="+t.id),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"jobState",dir:"desc"}}),i=[{field:"loginName",title:"登录名",width:200,filterable:!0},{field:"displayName",title:"显示名",width:200,filterable:!0},{field:"remark",title:"描述",filterable:!1},{field:"",title:"操作",width:80,template:function(t){return common.format($("#allUserGridBtns").html(),"vm.add('"+t.id+"')")}}];t.orgUserGrid={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0}}function a(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/org/users?orgId="+t.id,$("#form")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!1,serverSorting:!1,serverFiltering:!1,pageSize:10,sort:{field:"jobState",dir:"desc"}}),i=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"loginName",title:"登录名",width:200,filterable:!1},{field:"displayName",title:"显示名",width:200,filterable:!1},{field:"",title:"在职情况",width:160,filterable:!1,template:function(t){return t.jobState&&"t"==t.jobState?"在职":"已撤销"}},{field:"remark",title:"描述",filterable:!1},{field:"",title:"操作",width:180,template:function(t){return common.format($("#columnBtns").html(),"vm.remove('"+t.id+"')")}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0}}var r=rootPath+"/org/userNotIn";return{orgUserGrid:a,allUserGrid:n,add:o,remove:i}}angular.module("app").factory("orgUserSvc",t),t.$inject=["$http","$compile"]}(),function(){"use strict";function t(t,e,i){function o(e,i){var o={method:"post",url:rootPath+"/partyManager/createParty",data:e.party},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function n(e,i){var o={method:"post",url:rootPath+"/partyManager/findById",params:{pmId:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function a(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/partyManager/findByOData",$("#partyform")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})},o=[{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"",title:"名称",width:100,filterable:!1,template:function(t){return"<a  ng-click=\"vm.partyDetail('"+t.pmId+"')\">"+t.pmName+"</a>"}},{field:"pmSex",title:"性别",width:50,filterable:!1},{field:"pmIDCard",title:"身份证号",width:200,filterable:!1},{field:"pmNation",title:"民族",width:50,filterable:!1},{field:"pmEducation",title:"学历",width:100,filterable:!1},{field:"pmPhone",title:"手机号",width:100,filterable:!1},{field:"pmTel",title:"固定电话",width:80,filterable:!1},{field:"",title:"人员类别",width:80,filterable:!1,template:function(t){return"1"==t.pmCategory?"正式党员":"2"==t.pmCategory?"预备党员":""}},{field:"pmJoinPartyDate",title:"入党日期",width:80,filterable:!1},{field:"pmTurnToPatryDate",title:"转正日期",width:80,filterable:!1},{field:"",title:"操作",width:120,template:function(t){return 9==t.curState&&!0,common.format($("#columnBtns").html(),"vm.partyDetail('"+t.pmId+"')")}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}return{createParty:o,partyGrid:a,findById:n}}angular.module("app").factory("partySvc",t),t.$inject=["$http","$state","bsWin"]}(),function(){"use strict";function t(t,e){var i=this;i.title="党员信息录入",i.party={},function(){$("#myTab li").click(function(t){var e=$("a",this);t.preventDefault(),e.tab("show");var i=e.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500)})}(),i.saveParty=function(){common.initJqValidation(),$("form").valid()&&t.createParty(i,function(t){(t.flag||"ok"==t.reCode)&&(console.log(t),e.alert("保存成功！"))})}}angular.module("app").controller("partyEditCtrl",t),t.$inject=["partySvc","bsWin"]}(),function(){"use strict";function t(t,e){var i=this;i.title="党员信息查询",i.party={},function(){t.partyGrid(i)}(),i.partyDetail=function(e){$("#myTab li").click(function(t){var e=$("a",this);t.preventDefault(),e.tab("show");var i=e.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500)}),$("#partyDetail").kendoWindow({width:"1000px",height:"600px",title:"党员信息表",visible:!1,open:function(){t.findById(e,function(t){i.party=t.reObj})},modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},i.queryParty=function(){i.gridOptions.dataSource.read()}}angular.module("app").controller("partyListCtrl",t),t.$inject=["partySvc","bsWin"]}(),function(){"use strict";function t(t,e,i,o,n){var a=this;a.title="项目暂停审批",function(){e.grid(a),n.initIdea(a)}(),a.pauseProjectWindow=function(t,i){e.pauseProjectWindow(a,t,i)},a.commitProjectStop=function(){e.updateProjectStop(a)},a.closewin=function(){window.parent.$("#spwindow").data("kendoWindow").close()},a.selectMinisterIdea=function(){a.projectStop.directorIdeaContent+=a.directorIdea},a.selectDirectorIdea=function(){a.projectStop.leaderIdeaContent+=a.leaderIdea}}angular.module("app").controller("pauseProjectCtrl",t),t.$inject=["$location","pauseProjectSvc","$state","adminSvc","ideaSvc"]}(),function(){"use strict";function t(t,e,i){function o(e,i){var o={method:"post",url:rootPath+"/projectStop/getListInfo",params:{signId:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function n(o,n){var a={method:"post",url:rootPath+"/projectStop/findPausingProject",params:{signId:n}},r=function(t){console.log(t),t.data?i.alert("该项目暂停申请正在处理"):e.go("projectStopForm",{signId:n,stopId:""})};common.http({vm:o,$http:t,httpOptions:a,success:r})}function a(e,i){var o={method:"post",url:rootPath+"/projectStop/initProjectBySignId",params:{signId:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function r(e,i){var o={method:"post",url:rootPath+"/projectStop/savePauseProject",data:e},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function s(e,i){var o={method:"post",url:rootPath+"/projectStop/saveProjectStop",data:e},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function l(t){c(t.businessKey,function(e){t.model=e,t.sign=t.model.signDispaWork})}function c(e,i){var o={method:"post",url:rootPath+"/projectStop/getProjectStopByStopId",params:{stopId:e}},n=function(t){if(void 0!=i&&"function"==typeof i)return i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function d(e,i){var o={method:"post",url:rootPath+"/projectStop/getProjectStopBySignId",params:{signId:e}},n=function(t){if(void 0!=i&&"function"==typeof i)return i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function u(o){if(common.initJqValidation(),$("#form").valid()){var n={method:"post",url:rootPath+"/projectStop/updateProjectStop",data:o.projectStop},a=function(t){i.success("操作成功"),e.go("pauseProject")};common.http({vm:o,$http:t,httpOptions:n,success:a})}}function m(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/projectStop/findByOData"),schema:{data:"value",total:function(t){return t.count?$("#PAUSE_COUNT").html(t.count):$("#PAUSE_COUNT").html(0),t.count},model:{id:"id",fields:{createdDate:{type:"date"},modifiedDate:{type:"date"}}}},serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{field:"",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"",title:"项目名称",width:200,filterable:!1,template:function(t){return t.sign.projectname}},{field:"",title:"评审阶段",width:100,filterable:!1,template:function(t){return t.sign.reviewstage}},{field:"createdDate",title:"申请日期",width:100,format:"{0:yyyy-MM-dd}",filterable:!1},{field:"",title:"操作",width:100,filterable:!1,template:function(t){return common.format($("#columnBtns").html(),t.sign.signid,t.stopid)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,dataBound:function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})}}}return{initProject:a,pauseProject:r,initFlowDeal:l,grid:m,getProjectStopByStopId:c,updateProjectStop:u,findPausingProject:n,getListInfo:o,getProjectStopBySignId:d,saveProjectStop:s}}angular.module("app").factory("pauseProjectSvc",t),t.$inject=["$http","$state","bsWin"]}(),function(){"use strict";function t(t,e,i,o,n){var a=this;a.sign={};var r=t.params.signId;a.projectStop={},a.projectStop.signid=r,a.projectStop.stopId=t.params.stopId,a.showStartFlow=!0,""!=a.projectStop.stopId&&(a.showStartFlow=!1),a.initFileUpload=function(){a.projectStop.stopid||o.$watch("vm.projectStop.stopid",function(t,e){t&&t!=e&&!a.initUploadOptionSuccess&&a.initFileUpload()}),a.sysFile={businessId:a.projectStop.stopid,mainId:a.projectStop.stopid,mainType:"暂停项目",sysBusiType:a.projectStop.sysBusiType,showBusiType:!1},n.initUploadOptions({inputId:"sysfileinput",vm:a,uploadSuccess:function(){n.findByBusinessId(a.projectStop.stopid,function(t){a.sysFilelists=t})}})},function(){e.initProject(r,function(t){a.sign=t,"可行性研究报告"==a.sign.reviewstage||"项目概算"==a.sign.reviewstage?a.sign.countUsedWorkday=15-a.sign.surplusdays:a.sign.countUsedWorkday=12-a.sign.surplusdays}),e.getProjectStopBySignId(r,function(t){t.length>0&&(a.projectStop=t[0],"9"==a.projectStop.isSupplementMaterial&&(a.projectStop.sysBusiType="中心发补充材料函"),"9"==a.projectStop.isPuaseApprove&&(a.projectStop.sysBusiType="申报单位要求暂停审核函"),n.findByBusinessId(a.projectStop.stopid,function(t){a.sysFilelists=t})),a.initFileUpload()})}(),a.Checked=function(t,e){var i=t.target,o=i.checked;e?a.noFile=9!=o&&"9"!=o:a.noFile&&(a.projectStop.isSupplementMaterial=0,a.projectStop.isPuaseApprove=0)},a.commitProjectStop=function(){common.initJqValidation(),$("#form").valid()?(a.projectStop.processName="《"+a.sign.projectname+"》暂停申请",a.projectStop.userDays||(a.projectStop.userDays=a.sign.countUsedWorkday),a.projectStop.signid=a.sign.signid,e.pauseProject(a.projectStop,function(e){e.flag||"ok"==e.reCode?i.alert("操作成功！",function(){t.go("personDtasks")}):i.alert(e.reMsg)})):i.alert("项目暂停表填写不符合要求！")},a.saveProjectStop=function(){common.initJqValidation(),$("#form").valid()?(a.projectStop.signid=a.sign.signid,e.saveProjectStop(a.projectStop,function(t){t.flag||"ok"==t.reCode?(i.alert("操作成功！"),a.projectStop=t.reObj,"9"==a.projectStop.isSupplementMaterial&&(a.projectStop.sysBusiType="中心发补充材料函"),"9"==a.projectStop.isPuaseApprove&&(a.projectStop.sysBusiType="申报单位要求暂停审核函")):i.alert(t.reMsg)})):i.alert("项目暂停表填写不符合要求！")},a.selectMinisterIdea=function(){a.projectStop.directorIdeaContent+=a.directorIdea},a.selectDirectorIdea=function(){a.projectStop.leaderIdeaContent+=a.leaderIdea}}angular.module("app").controller("projectStopFormCtrl",t),t.$inject=["$state","pauseProjectSvc","bsWin","$scope","sysfileSvc"]}(),function(){"use strict";function t(t,e,i,o,n){var a=this;a.stopId=t.params.stopId,a.initFileUpload=function(){a.projectStop.stopid||o.$watch("vm.projectStop.stopid",function(t,e){t&&t!=e&&!a.initUploadOptionSuccess&&a.initFileUpload()}),a.sysFile={businessId:a.projectStop.stopid,mainId:a.projectStop.stopid,mainType:"暂停项目",sysBusiType:a.projectStop.sysBusiType,showBusiType:!0},n.initUploadOptions({inputId:"sysfileinput",vm:a,uploadSuccess:function(){n.findByBusinessId(a.projectStop.stopid,function(t){a.sysFilelists=t})}})},function(){e.getProjectStopByStopId(a.stopId,function(t){a.projectStop=t,a.sign=a.projectStop.signDispaWork,a.sign.countUsedWorkday=a.sign.reviewdays-a.sign.surplusdays,"9"==a.projectStop.isSupplementMaterial&&(a.projectStop.sysBusiType="中心发补充材料函"),"9"==a.projectStop.isPuaseApprove&&(a.projectStop.sysBusiType="申报单位要求暂停审核函"),n.findByBusinessId(a.projectStop.stopid,function(t){a.sysFilelists=t}),a.initFileUpload()})}(),a.saveProjectStop=function(){common.initJqValidation(),$("#form").valid()?e.saveProjectStop(a.projectStop,function(t){t.flag||"ok"==t.reCode?i.alert("操作成功！"):i.alert(t.reMsg)}):i.alert("项目暂停表填写不符合要求！")}}angular.module("app").controller("projectStopFormEditCtrl",t),t.$inject=["$state","pauseProjectSvc","bsWin","$scope","sysfileSvc"]}(),function(){"use strict";function t(t,e){var i=this,o=t.params.signId;i.sign={},function(){e.initProject(o,function(t){i.sign=t,i.sign.countUsedWorkday=i.sign.reviewdays-i.sign.surplusdays}),e.getListInfo(o,function(t){i.projectStopList=t})}()}angular.module("app").controller("projectStopInfoCtrl",t),t.$inject=["$state","pauseProjectSvc"]}(),function(){"use strict";function t(t,e,i){var o=this;o.title="个人代办",o.model={},function(){e.getUser(function(t){o.model=t,e.initAllUser(function(t){o.takeUserList=t,o.initTaskUser(o.model.takeUserId)})}),i.getOrg(function(t){o.org={},o.org=t})}(),o.cancelTakeUser=function(){o.model.takeUserId?t.confirm({title:"询问提示",message:"确认取消代办人么？",onOk:function(){e.cancelTakeUser(function(){o.model.takeUserId="",o.taskUserName="",t.alert("操作成功!")})}}):t.alert("你还没有设置代办人！")},o.saveTakeUser=function(){o.takeUserId?e.saveTakeUser(o.takeUserId,function(e){o.model.takeUserId=o.takeUserId,o.initTaskUser(o.takeUserId),t.alert("操作成功！")}):t.alert("请选择代办人！")},o.initTaskUser=function(t){angular.forEach(o.takeUserList,function(e,i){e.id==t&&(o.taskUserName=e.displayName)})}}angular.module("app").controller("takeUserCtrl",t),t.$inject=["bsWin","takeUserSvc","userSvc"]}(),function(){"use strict";function t(t){function e(e){var i={method:"post",url:rootPath+"/role/findAllRoles"},o=function(t){common.requestSuccess({vm:e,response:t,fn:function(){var i={check:{chkboxType:{Y:"ps",N:"ps"},enable:!0}},o=$linq(t.data).select(function(t){return{id:t.id,name:t.roleName}}).toArray(),n={id:"",name:"角色集合",children:o};$.fn.zTree.init($("#zTree"),i,n),r(e)}})};common.http({vm:e,$http:t,httpOptions:i,success:o})}function i(e){var i={method:"post",url:rootPath+"/user/getAllUserDisplayName"},o=function(t){void 0!=e&&"function"==typeof e&&e(t.data)};common.http({$http:t,httpOptions:i,success:o})}function o(e,i){var o={method:"post",url:rootPath+"/user/saveTakeUser",params:{takeUserId:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function n(e){var i={method:"post",url:rootPath+"/user/findCurrentUser"},o=function(t){void 0!=e&&"function"==typeof e&&e(t.data)};common.http({$http:t,httpOptions:i,success:o})}function a(e){var i={method:"get",url:rootPath+"/user/cancelTakeUser"},o=function(t){void 0!=e&&"function"==typeof e&&e(t.data)};common.http({$http:t,httpOptions:i,success:o})}function r(t){for(var e=$.fn.zTree.getZTreeObj("zTree"),i=$linq(t.model.roleDtoList).select(function(t){return t.roleName}).toArray(),o=e.getNodesByParam("level",1,null),n=$linq(o).where(function(t){return $linq(i).contains(t.name)}).toArray(),a=0,r=n.length;a<r;a++)e.checkNode(n[a],!0,!0)}return{initAllUser:i,saveTakeUser:o,getUser:n,cancelTakeUser:a,initZtreeClient:e,updateZtree:r}}angular.module("app").factory("takeUserSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e){var i=this;i.title="定时器配置",function(){e.grid(i)}(),i.addQuartz=function(){i.quartz={},$("#quartz_edit_div").kendoWindow({width:"680px",height:"400px",title:"定时器编辑",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},i.edit=function(t){$("#quartz_edit_div").kendoWindow({width:"600px",height:"400px",title:"定时器修改",visible:!1,modal:!0,open:function(){e.getQuartzById(t,function(t){i.quartz=t})},closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},i.colseQuartz=function(){window.parent.$("#quartz_edit_div").data("kendoWindow").close()},i.saveQuartz=function(){common.initJqValidation($("#quartz_form")),$("#quartz_form").valid()&&e.saveQuartz(i.quartz,function(e){e.flag||"ok"==e.reCode?t.alert("操作成功！",function(){i.colseQuartz(),i.gridOptions.dataSource.read()}):t.alert(e.reMsg)})},i.execute=function(o){e.quartzExecute(o,function(e){e.flag||"ok"==e.reCode?t.alert("操作成功！",function(){i.gridOptions.dataSource.read()}):t.alert(e.reMsg)})},i.stop=function(o){e.quartzStop(o,function(e){e.flag||"ok"==e.reCode?t.alert("操作成功！",function(){i.gridOptions.dataSource.read()}):t.alert(e.reMsg)})},i.del=function(o){t.confirm("确认删除？删除数据无法恢复，请谨慎操作！",function(){e.deleteQuartz(o,function(e){e.flag||"ok"==e.reCode?t.alert("操作成功！",function(){i.gridOptions.dataSource.read()}):t.alert(e.reMsg)})})}}angular.module("app").controller("quartzCtrl",t),t.$inject=["bsWin","quartzSvc"]}(),function(){"use strict";function t(t){function e(e,i){var o={method:"put",url:s+"/quartzExecute",params:{quartzId:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function i(e,i){var o={method:"post",url:s+"/quartzStop",params:{quartzId:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function o(e,i){var o={method:"delete",url:s,params:{id:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function n(e,i){var o={method:"post",url:rootPath+"/quartz",data:e},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function a(e,i){var o={method:"post",url:rootPath+"/quartz/html/findById",params:{id:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function r(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/quartz/findByOData"),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})},o=[{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"quartzName",title:"定时器名称",width:200,filterable:!1},{field:"className",title:"类名",width:260,filterable:!1},{field:"cronExpression",title:"表达式",width:150,filterable:!1},{field:"",title:"状态",width:80,filterable:!1,template:function(t){return t.curState?"9"==t.curState?"<span class='label label-success'>正在执行</span>":"0"==t.curState?"<span class='label label-warning'>已暂停</span>":void 0:""}},{field:"descInfo",title:"描述",width:120,filterable:!1},{field:"",title:"操作",width:80,template:function(t){var e=!1;return 9==t.curState&&(e=!0),common.format($("#columnBtns").html(),"vm.edit('"+t.id+"')","vm.execute('"+t.id+"')",!e,"vm.stop('"+t.id+"')",e)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}var s=rootPath+"/quartz";return{grid:r,getQuartzById:a,saveQuartz:n,deleteQuartz:o,quartzExecute:e,quartzStop:i}}angular.module("app").factory("quartzSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e,i,o,n,a){function r(t){t=void 0==t?0:t;var e=0;return t>800&&t<=4e3?e=.2*(t-800):t>4e3&&t<=2e4?e=.8*t*.2:t>2e4&&t<=5e4&&(e=.8*t*.3-2e3),e}var s=this;s.title="评审费发放",s.reviewFee={},s.stateName=o.current.name,s.queryParams={},s.saveView=function(){n.storeView(s.stateName,{gridParams:s.gridOptions.dataSource.transport.options.read.data(),queryParams:s.queryParams,data:s})},function(){if(n.view[s.stateName]){var e=n.view[s.stateName];e.gridParams&&(s.gridParams=e.gridParams),e.data&&(s.reviewFee=e.data.reviewFee),e.queryParams&&(s.queryParams=e.queryParams),t.projectGrid(s),n.view[s.stateName]=void 0}else t.projectGrid(s)}(),s.query=function(){s.gridOptions.dataSource._skip=0,s.gridOptions.dataSource.read()},s.dealWindow=function(e){t.findExpertReview(s,e,function(t){s.expertReview=t,$("#payFromWindow").kendoWindow({width:"70%",height:"600px",title:"专家评审费发放",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()})},s.countTaxes=function(t){if(void 0!=t){if(void 0==t.payDate)return void i.alert("请选择评审费发放日期");if(!/^(\d{4}-\d{1,2}-\d{1,2})$/.exec(t.payDate))return void i.alert("请输入正确的日期格式");if(void 0==t.expertSelectedDtoList||0==t.expertSelectedDtoList.length)return void i.alert("该方案还没评审专家");common.initJqValidation($("#payform"));if($("#payform").valid()){var o,n=t.expertSelectedDtoList.length,a="";$.each(t.expertSelectedDtoList,function(t,e){a+="'"+e.id+"'",t!=n-1&&(a+=",")});var s=t.payDate;o=s.substring(0,s.lastIndexOf("-")),e.countTaxes(a,o,function(e){var i=e;t.reviewCost=0,t.reviewTaxes=0,t.totalCost=0,$.each(t.expertSelectedDtoList,function(e,o){if("9"==o.isConfrim&&"9"==o.isJoin){var n=o.EXPERTID,a=o.id,s=0;void 0!=i&&i.length>0&&i.forEach(function(t,e){t.EXPERTID==n&&t.ESID!=a&&(t.REVIEWCOST=void 0==t.REVIEWCOST?0:t.REVIEWCOST,t.REVIEWCOST=parseFloat(t.REVIEWCOST),s=parseFloat(s)+t.REVIEWCOST)}),o.reviewCost=void 0==o.reviewCost?0:o.reviewCost;var l=s+parseFloat(o.reviewCost);o.reviewTaxes=r(l).toFixed(2),o.totalCost=(parseFloat(o.reviewCost)+parseFloat(o.reviewTaxes)).toFixed(2),t.reviewCost=(parseFloat(t.reviewCost)+parseFloat(o.reviewCost)).toFixed(2),t.reviewTaxes=(parseFloat(t.reviewTaxes)+parseFloat(o.reviewTaxes)).toFixed(2),t.totalCost=(parseFloat(t.reviewCost)+parseFloat(t.reviewTaxes)).toFixed(2)}})})}}},s.savePayment=function(t){common.initJqValidation($("#payform")),$("#payform").valid()?e.savePayment(t,s.isCommit,function(t){t.flag||"ok"==t.reCode?i.alert("操作成功！",function(){s.isCommit=!1,window.parent.$("#payFromWindow").data("kendoWindow").close(),s.gridOptions.dataSource.read()}):i.alert(t.reMsg)}):i.alert("请正确填写专家评审费信息！")},
s.detail=function(t,e){s.saveView(),"SIGN"==e.trim()&&a.initFlowPageData(t,function(e){s.model=e,o.go("signDetails",{signid:t,processInstanceId:s.model.processInstanceId})}),"TOPIC"==e.trim()&&o.go("flowDetail",{businessKey:t})}}angular.module("app").controller("reviewFeeCtrl",t),t.$inject=["reviewFeeSvc","expertReviewSvc","bsWin","$state","$rootScope","signSvc"]}(),function(){"use strict";function t(t){function e(e,i,o){var n={method:"post",url:rootPath+"/expertReview/initBybusinessId",params:{businessId:i,minBusinessId:""}},a=function(t){void 0==o&&"function"!=typeof o||o(t.data)};common.http({vm:e,$http:t,httpOptions:n,success:a})}function i(t){var e=common.kendoGridDataSource(rootPath+"/reviewFee/findReviewFee",$("#reviewFeeForm"),t.queryParams.page,t.queryParams.pageSize,t.gridParams),i=[{field:"",title:"序号",template:"<span class='row-number'></span>",width:50},{field:"reviewTitle",title:"评审费标题",width:"40%",filterable:!1},{field:"",title:"评审费类型",width:"20%",filterable:!1,template:function(t){return t.businessType&&"SIGN"==t.businessType.trim()?"项目评审费":t.businessType&&"TOPIC"==t.businessType.trim()?"课题评审费":""}},{field:"reviewDate",title:"评审(函评)日期",width:"15%",filterable:!1,format:"{0: yyyy-MM-dd}"},{field:"",title:"操作",width:"20%",template:function(t){return common.format($("#columnBtns").html(),"vm.dealWindow('"+t.businessId+"')","vm.detail('"+t.businessId+"','"+t.businessType+"')")}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,pageable:common.kendoGridConfig(t.queryParams).pageable,dataBound:common.kendoGridConfig(t.queryParams).dataBound,resizable:!0}}return{projectGrid:i,findExpertReview:e}}angular.module("app").factory("reviewFeeSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e){var i=this;i.title="角色列表",i.del=function(t){common.confirm({vm:i,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),e.deleteRole(i,t)}})},i.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)common.alert({vm:i,msg:"请选择数据"});else{for(var e=[],o=0;o<t.length;o++)e.push(t[o].value);var n=e.join(",");i.del(n)}},function(){e.grid(i)}()}angular.module("app").controller("roleCtrl",t),t.$inject=["$location","roleSvc"]}(),function(){"use strict";function t(t,e,i){var o=this;o.title="添加角色",o.isRoleExist=!1,o.id=i.params.id,o.id&&(o.isUpdate=!0,o.title="更新角色"),o.create=function(){e.createRole(o)},o.update=function(){e.updateRole(o)},o.checkRole=function(){e.checkRole(o)},function(){o.isUpdate?e.getRoleById(o):e.initZtreeClient(o)}()}angular.module("app").controller("roleEditCtrl",t),t.$inject=["$location","roleSvc","$state"]}(),function(){"use strict";function t(t,e){function i(){return $.fn.zTree.getZTreeObj("zTree").getCheckedNodes(!0)}function o(t){for(var e=$.fn.zTree.getZTreeObj("zTree"),i=$linq(t.model.resources).select(function(t){return t.path}).toArray(),o=e.getNodesByParam("level",1,null),n=$linq(o).where(function(t){return $linq(i).contains(t.path)}).toArray(),a=0,r=n.length;a<r;a++)e.checkNode(n[a],!0,!0)}function n(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(u+"/fingByOData"),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})},o=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:70,filterable:!1,template:"<span class='row-number'></span>"},{field:"roleName",title:"角色名称",width:200,filterable:!1},{field:"remark",title:"描述",filterable:!1},{field:"createdDate",title:"创建时间",width:180,filterable:!1,format:"{0:yyyy-MM-dd HH:mm:ss}"},{field:"",title:"操作",width:180,template:function(t){return common.format($("#columnBtns").html(),"vm.del('"+t.id+"')",t.id)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}function a(e){if(common.initJqValidation(),$("form").valid()&&0==e.isRoleExist){e.isSubmit=!0;var o=i(),n=$linq(o).where(function(t){return 0==t.isParent}).select(function(t){return{id:t.id,name:t.name,path:t.path,method:t.method}}).toArray();e.model.resources=n;var a={method:"post",url:u,data:e.model},r=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=m}})}})};common.http({vm:e,$http:t,httpOptions:a,success:r})}}function r(t){}function s(e){var i={method:"post",url:rootPath+"/role/findById",params:{roleId:e.id}},o=function(t){e.model=t.data,e.isUpdate&&d(e)};common.http({vm:e,$http:t,httpOptions:i,success:o})}function l(e){if(common.initJqValidation(),$("form").valid()&&0==e.isRoleExist){e.isSubmit=!0,e.model.id=e.id;var o=i(),n=$linq(o).where(function(t){return!0}).select(function(t){return{id:t.id,name:t.name,path:t.path,method:t.method}}).toArray();e.model.resources=n;var a={method:"put",url:u,data:e.model},r=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:e,$http:t,httpOptions:a,success:r})}}function c(e,i){e.isSubmit=!0;var o={method:"delete",url:u,data:i},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.isSubmit=!1,e.gridOptions.dataSource.read()}})};common.http({vm:e,$http:t,httpOptions:o,success:n})}function d(e){var i={method:"get",url:p},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){var i={check:{chkboxType:{Y:"ps",N:"ps"},enable:!0}},n=t.data;$.fn.zTree.init($("#zTree"),i,n),e.isUpdate&&o(e)}})};common.http({vm:e,$http:t,httpOptions:i,success:n})}var u=rootPath+"/role",m="#/role",p=rootPath+"/sys/resource";return{grid:n,createRole:a,checkRole:r,getRoleById:s,updateRole:l,deleteRole:c,initZtreeClient:d}}angular.module("app").factory("roleSvc",t),t.$inject=["$http","$compile"]}(),function(){"use strict";function t(t){var e=this;e.approve=!0,e.idea=!1,e.appraise={},function(){t.approveListGrid(e)}()}angular.module("app").controller("approveListCtrl",t),t.$inject=["reviewProjectAppraiseSvc"]}(),function(){"use strict";function t(t,e,i){var o=this,n=t.params.signId;o.model={},function(){e.initBySignId(n,function(t){o.model=t})}(),o.commitApprove=function(){common.initJqValidation(),$("#form").valid()?e.saveApply(o.model,function(n){n.flag||"ok"==n.reCode?(o.model=n.reObj,e.startFlow(o.model.id,function(e){(e.flag||"ok"==e.reCode)&&i.success("操作成功！",function(){t.go("personDtasks")})})):i.alert(n.reMsg)}):i.alert("优秀评审报告填报表单未填写正确！")}}angular.module("app").controller("approveWindowCtrl",t),t.$inject=["$state","reviewProjectAppraiseSvc","bsWin"]}(),function(){"use strict";function t(t,e,i){var o=this,n=t.params.id;o.model={},o.addApprove=function(){e.saveApply(o.model,function(){i.alert("操作成功")})},function(){e.getAppraiseById(n,function(t){o.model=t})}()}angular.module("app").controller("approveWindowEditCtrl",t),t.$inject=["$state","reviewProjectAppraiseSvc","bsWin"]}(),function(){"use strict";function t(t,e){var i=this;i.title="优秀评审报告列表",function(){e.appraisingProjectGrid(i)}()}angular.module("app").controller("reviewProjectAppraiseCtrl",t),t.$inject=["$location","reviewProjectAppraiseSvc"]}(),function(){"use strict";function t(t,e,i){function o(t){r(t.businessKey,function(e){t.model=e})}function n(e,i){var o={method:"post",url:rootPath+"/reviewProjectAppraise/startFlow",params:{id:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function a(e,i){var o={method:"post",url:rootPath+"/reviewProjectAppraise/initBySignId",params:{signId:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function r(e,i){var o={method:"post",url:rootPath+"/reviewProjectAppraise/getAppraiseById",params:{id:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function s(t){$("#appraiseWindow").kendoWindow({width:"800px",height:"400px",title:"评审报告评优申请",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()}function l(e,i){var o={method:"post",url:rootPath+"/reviewProjectAppraise/saveApply",data:e},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function c(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/reviewProjectAppraise/findAppraisingProject"),schema:common.kendoGridConfig().schema({id:"id",fields:{}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10}),i=[{field:"",title:"序号",template:"<span class='row-number'></span>",width:50},{field:"",title:"项目名称",width:160,filterable:!1,template:function(t){return t.processInstanceId?'<a href="#/signDetails/'+t.signid+"/"+t.processInstanceId+'" >'+t.projectname+"</a>":'<a href="#/signDetails/'+t.signid+'/" >'+t.projectname+"</a>"}},{field:"reviewstage",title:"评审阶段",width:140,filterable:!1},{field:"signdate",title:"收文日期",width:200,filterable:!1},{field:"dispatchDate",title:"发文日期",width:160,filterable:!1},{field:"reviewOrgName",title:"评审部门",width:140,filterable:!1},{field:"aUserName",title:"项目负责人",width:140,filterable:!1},{field:"ffilenum",title:"归档编号",width:140,filterable:!1},{field:"dfilenum",title:"文件字号",width:140,filterable:!1},{field:"appalyInvestment",title:"申报投资",width:140,filterable:!1},{field:"authorizeValue",title:"审定投资",width:140,filterable:!1},{field:"extraValue",title:"核减（增）投资",width:140,filterable:!1},{field:"extraRate",title:"核减率",width:140,filterable:!1},{field:"approveValue",title:"批复金额",width:140,filterable:!1},{field:"dispatchType",title:"发文类型",width:140,filterable:!1},{field:"fileDate",title:"归档日期",width:140,filterable:!1},{field:"builtcompanyname",title:"建设单位",width:140,filterable:!1}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,dataBound:function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})}}}function d(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/reviewProjectAppraise/getAppraiseReport"),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{field:"",title:"序号",template:"<span class='row-number'></span>",width:50},{field:"",title:"项目名称",width:160,filterable:!1,template:function(t){return t.processInstanceId?'<a href="#/signDetails/'+t.signid+"/"+t.processInstanceId+'" >'+t.projectName+"</a>":'<a href="#/signDetails/'+t.signid+'/" >'+t.projectName+"</a>"}},{field:"appraiseReportName",title:"评审报告名称",width:160,filterable:!1},{field:"proposerName",title:"申请人",width:160,filterable:!1},{field:"proposerTime",title:"申请时间",width:160,filterable:!1,format:"{0: yyyy-MM-dd}"},{field:"",title:"操作",width:100,template:function(t){return common.format($("#columnBtns").html(),t.signid,t.projectname,t.id)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,dataBound:function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})}}}return{initBySignId:a,appraisingProjectGrid:c,appraiseWindow:s,saveApply:l,approveListGrid:d,getAppraiseById:r,startFlow:n,initFlowDeal:o}}angular.module("app").factory("reviewProjectAppraiseSvc",t),t.$inject=["$http","bsWin","$state"]}(),function(){"use strict";function t(t,e){var i=this;i.title="预定会议统计列表",i.queryRoomCount=function(){e.queryRoomCount(i)},i.ResetRoomCount=function(){e.cleanValue()},function(){e.grid(i),e.roomList(i),e.findAllUsers(i),t.initSignList(function(t){(t.flag||"ok"==t.reCode)&&(i.orgDeptList=t.reObj)})}()}angular.module("app").controller("roomCountCtrl",t),t.$inject=["adminSvc","roomCountSvc"]}(),function(){"use strict";function t(t,e){function i(){var t=$("#roomCountform").find("input,select");$.each(t,function(t,e){e.value=""})}function o(t){t.gridOptions.dataSource._skip="",t.gridOptions.dataSource.read()}function n(e){var i={method:"get",url:common.format(l+"/findAllUsers")},o=function(t){e.userlist={},e.userlist=t.data};common.http({vm:e,$http:t,httpOptions:i,success:o})}function a(e){var i={method:"get",url:common.format(s+"/meeting")},o=function(t){e.roomlists={},e.roomlists=t.data};common.http({vm:e,$http:t,httpOptions:i,success:o})}function r(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(s+"/fingByOData",$("#roomCountform")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})},o=[{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"rbName",title:"会议名称",width:"30%",filterable:!1},{field:"addressName",title:"会议室地点",width:"20%",filterable:!1},{field:"rbDay",title:"会议日期",width:"10%",filterable:!1},{field:"",title:"会议开始时间",width:"10%",filterable:!1,template:function(t){return t.beginTime?new Date(t.beginTime.CompatibleDate()).Format("hh:mm"):""}},{field:"",title:"会议结束时间",type:"date",width:"10%",filterable:!1,template:function(t){return t.endTime?new Date(t.endTime.CompatibleDate()).Format("hh:mm"):""}},{field:"dueToPeople",title:"会议预定人",width:"10%",filterable:!1}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}var s=(rootPath,rootPath+"/room"),l=rootPath+"/user",l=rootPath+"/user";return{grid:r,queryRoomCount:o,roomList:a,cleanValue:i,findAllUsers:n}}angular.module("app").factory("roomCountSvc",t),t.$inject=["$http","$compile"]}(),function(){"use strict";function t(t,e,i,o){var n=this;n.title="会议室预定列表",n.initSuccess=!1,n.model={businessId:i.params.businessId,businessType:i.params.businessType},n.startDateTime=new Date("2005/6/1 08:00"),n.startRbDate=new Date,n.endDateTime=new Date("2030/6/1 21:00"),n.currentDate="",n.reportName="会议室安排表",n.search={},n.loadScheduler=!1,function(){e.showMeeting(n,function(t){e.initScheduler(n),n.meetings={},n.meetings=t,e.initDefaultValue(n.model.businessId,n.model.businessType,function(t){n.model=t,n.meetings&&n.meetings.length>0&&(n.search.mrID=n.meetings[0].id,n.model.mrID=n.meetings[0].id,n.findMeeting())}),$("#menu_offcanvas_id").click(function(){$("body").hasClass("sidebar-collapse")?n.t=o(function(){$("#main-sidebar").width()>50&&(n.findMeeting(),o.cancel(n.t))},300):n.t=o(function(){$("#main-sidebar").width()<=50&&(n.findMeeting(),o.cancel(n.t))},300)})})}(),n.refleshData=function(e){n.findMeeting(),e.flag||"ok"==e.reCode?t.alert("操作成功"):t.error(e.reMsg)},n.reQueryDate=function(t){var e,i,o=t.date,a=o.getDay();0==a?(e=o.Days(-6),i=o.Format("yyyy-MM-dd")):1==a?(e=o.Format("yyyy-MM-dd"),i=o.Days(6)):(e=o.Days(-(a-1)),i=o.Days(7-a)),n.search.beginTimeStr=e,n.search.endTimeStr=i,n.findMeeting()},n.findMeeting=function(){e.queryBookRoom(n.search,function(t){n.model.mrID=n.search.mrID,e.setSCDataSource(n,t)})},n.exportThisWeekStage=function(){n.currentDate=$(".k-sm-date-format").html(),n.rbType="0",n.reportName="本周评审会会议安排表",e.exportThisWeekStage(n)},n.exportThisWeek=function(){n.currentDate=$(".k-sm-date-format").html(),n.rbType="1",n.reportName="本周全部会议安排表",e.exportThisWeekStage(n)},n.exportNextWeek=function(){var t=$(".k-sm-date-format").html(),i=t.split("-")[0].split("/"),o=i[0],a=2==i[1].length?i[1]:"0"+i[1],r=i[2].length>=2?i[2].substr(0,2):"0"+i[2].substr(0,1),s=new Date(a+"/"+r+"/"+o),l=new Date(a+"/"+r+"/"+o);s.setDate(s.getDate()+8-s.getDay()),l.setDate(l.getDate()+15-l.getDay());var c=new Date(s),d=new Date(l);n.currentDate=c.getFullYear()+"/"+(c.getMonth()+1)+"/"+c.getDate()+"-"+d.getFullYear()+"/"+(d.getMonth()+1)+"/"+d.getDate(),n.rbType="1",n.reportName="下周全部会议安排表",e.exportThisWeekStage(n)},n.exportNextWeekStage=function(){var t=$(".k-sm-date-format").html(),i=t.split("-")[0].split("/"),o=i[0],a=2==i[1].length?i[1]:"0"+i[1],r=i[2].length>=2?i[2].substr(0,2):"0"+i[2].substr(0,1),s=new Date(a+"/"+r+"/"+o),l=new Date(a+"/"+r+"/"+o);s.setDate(s.getDate()+8-s.getDay()),l.setDate(l.getDate()+15-l.getDay());var c=new Date(s),d=new Date(l);n.currentDate=c.getFullYear()+"/"+(c.getMonth()+1)+"/"+c.getDate()+"-"+d.getFullYear()+"/"+(d.getMonth()+1)+"/"+d.getDate(),n.rbType="0",n.reportName="下周评审会会议安排表",e.exportThisWeekStage(n)}}angular.module("app").controller("roomCtrl",t),t.$inject=["bsWin","roomSvc","$state","$interval"]}(),function(){"use strict";function t(t,e,i){var o=this;o.title="添加会议室预定",o.isuserExist=!1,o.id=i.params.id,o.id&&(o.isUpdate=!0,o.title="更新会议室"),function(){o.isUpdate&&e.getroomById(o)}()}angular.module("app").controller("roomEditCtrl",t),t.$inject=["$location","roomSvc","$state"]}(),function(){"use strict";function t(t,e){function i(t){$("#scheduler").kendoScheduler({date:new Date,width:"100%",startTime:new Date("2005/6/1 08:00"),endTime:new Date("2030/6/1 21:00"),views:[{type:"week",selected:!0,allDaySlot:!1}],editable:{destroy:!0,template:$("#customEditorTemplate").html()},navigate:function(e){t.reQueryDate(e)},edit:function(t){},save:function(e){r(e.event,function(e){t.refleshData(e)})},remove:function(e){o(e.event,function(e){t.refleshData(e)})},eventTemplate:$("#event-template").html(),timezone:"Etc/UTC",footer:!1});var e=$("#scheduler").data("kendoScheduler"),i=e._model.formattedShortDate,n=i.split("-");t.search.beginTimeStr=new Date(n[0].trim()).Format("yyyy-MM-dd"),t.search.endTimeStr=new Date(n[1].trim()).Format("yyyy-MM-dd")}function o(e,i){var o={method:"delete",url:rootPath+"/room",params:{id:e.id,dueToPeople:e.dueToPeople}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({httpOptions:o,$http:t,success:n})}function n(e,i){var o={method:"post",url:rootPath+"/room/queryBookInfo",data:e},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function a(t,e){var i=$("#scheduler").data("kendoScheduler"),o=new kendo.data.SchedulerDataSource({data:e,schema:{model:{id:"bookId",fields:{bookId:{from:"id"},title:{from:"addressName",defaultValue:"会议室",validation:{required:!0}},start:{type:"date",from:"beginTime"},end:{type:"date",from:"endTime"},rbDay:{type:"date",from:"rbDay",format:"yyyy-MM-dd"},businessId:{from:"businessId",defaultValue:t.model.businessId},businessType:{from:"businessType",defaultValue:t.model.businessType},rbName:{from:"rbName",defaultValue:t.model.rbName},stageOrgName:{from:"stageOrgName",defaultValue:t.model.stageOrgName},host:{from:"host",defaultValue:t.model.host},dueToPeople:{from:"dueToPeople",defaultValue:t.model.dueToPeople},mrID:{from:"mrID",defaultValue:t.model.mrID},content:{from:"content",defaultValue:t.model.content},remark:{from:"remark",defaultValue:t.model.remark}}}}});i.setDataSource(o)}function r(e,i){var o=e;if(o.rbName&&o.dueToPeople&&o.rbDay&&o.start&&o.end&&o.content){o.id=o.bookId;var n=o.start.Format("yyyy-MM-dd hh:mm:ss");o.beginTime=n,o.rbDay=o.start.Format("yyyy-MM-dd");var a=o.end.Format("hh:mm:ss");o.endTime=o.rbDay+" "+a;var r={method:"post",url:rootPath+"/room/addRoom",data:o},s=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:r,success:s})}else{var r={method:"post",url:rootPath+"/room/errorResult"},s=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:r,success:s})}}function s(e,i){var o={method:"get",url:rootPath+"/room/meeting"},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function l(e,i,o){var n={method:"post",url:rootPath+"/room/initDefaultValue",params:{businessId:e,businessType:i}},a=function(t){void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:t,httpOptions:n,success:a})}function c(t){var e=escape(encodeURIComponent(t.reportName));window.open(d+"/exportThisWeekStage?currentDate="+t.currentDate+"&rbType="+t.rbType+"&mrId="+t.mrID+"&fileName="+e)}var d=rootPath+"/room";return{initScheduler:i,queryBookRoom:n,setSCDataSource:a,showMeeting:s,exportThisWeekStage:c,initDefaultValue:l,saveBookRoom:r,deleteRoom:o}}angular.module("app").factory("roomSvc",t),t.$inject=["$http","bsWin"]}(),function(){"use strict";function t(t,e,i,o){var n=this;n.title="资料共享详情页",n.model={},n.model.sharId=e.params.sharId,n.downloadSysFile=function(t){i.downloadFile(t)},function(){o.getSharingDetailById(n,n.model.sharId),i.findByBusinessId(n.model.sharId,function(t){n.sysFilelists=t})}()}angular.module("app").controller("sharingDetailCtrl",t),t.$inject=["$location","$state","sysfileSvc","sharingPlatlformSvc"]}(),function(){"use strict";function t(t,e,i,o,n,a){var r=this;r.title="共享资料管理",r.stateName=e.current.name,r.queryParams={},r.saveView=function(){n.storeView(r.stateName,{gridParams:r.gridOptions.dataSource.transport.options.read.data(),queryParams:r.queryParams,data:r})},function(){if(n.view[r.stateName]){var t=n.view[r.stateName];t.gridParams&&(r.gridParams=t.gridParams),t.data&&(r.model=t.data.model),t.queryParams&&(r.queryParams=t.queryParams),o.grid(r),n.view[r.stateName]=void 0}else o.grid(r)}(),r.del=function(t){common.confirm({vm:r,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),o.deleteSharingPlatlform(r,t)}})},r.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)common.alert({vm:r,msg:"请选择要删除的数据"});else{for(var e=[],i=0;i<t.length;i++)e.push(t[i].value);var o=e.join(",");r.del(o)}},r.bathPublish=function(){o.updatePublish(r,!0)},r.bathDown=function(){o.updatePublish(r,!1)},r.querySharing=function(){r.gridOptions.dataSource._skip=0,r.gridOptions.dataSource.read()},r.resetSharing=function(){var t=$("#formSharing").find("input,select");$.each(t,function(t,e){e.value=""})}}angular.module("app").controller("sharingPlatlformCtrl",t),t.$inject=["$location","$state","$http","sharingPlatlformSvc","$rootScope","monthlyMultiyearSvc"]}(),function(){"use strict";function t(t,e,i,o){var n=this;n.title="新增共享资料",n.model={},n.businessFlag={isUpdate:!1,isLoadModel:!1,isLoadOrgUser:!1},n.model.sharId=e.params.sharId,n.model.sharId&&(n.businessFlag.isUpdate=!0,n.title="更改共享资料"),n.initFileUpload=function(){n.model.sharId||o.$watch("vm.model.sharId",function(t,e){t&&t!=e&&!n.initUploadOptionSuccess&&n.initFileUpload()}),n.sysFile={businessId:n.model.sharId,mainId:n.model.sharId,mainType:i.mainTypeValue().SHARE},i.initUploadOptions({inputId:"sysfileinput",vm:n,uploadSuccess:function(){i.findByBusinessId(n.model.sharId,function(t){n.sysFilelists=t})}})},function(){n.model.sharId?t.getSharingPlatlformById(n,function(e){n.model=e,n.businessFlag.isLoadModel=!0,t.initSeleObj(n),i.findByBusinessId(n.model.sharId,function(t){n.sysFilelists=t,n.initFileUpload()})}):n.initFileUpload(),t.initOrgAndUser(n)}(),n.resetSharing=function(){var t=$("#formSharing").find("input,select");$.each(t,function(t,e){e.value=""})},n.create=function(){t.createSharingPlatlform(n)},n.checkBox=function(t){var e=t.target,i=e.checked,o=e.value;i?$('input[tit="'+o+'"]').each(function(){$(this).attr("disabled","disabled"),$(this).removeAttr("checked")}):$('input[tit="'+o+'"]').each(function(){$(this).removeAttr("disabled")})}}angular.module("app").controller("sharingPlatlformEditCtrl",t),t.$inject=["sharingPlatlformSvc","$state","sysfileSvc","$scope"]}(),function(){"use strict";function t(t,e){function i(t){!t.businessFlag.isLoadOrgUser||!t.businessFlag.isLoadModel||t.model.isNoPermission&&"9"==t.model.isNoPermission||t.shareOrgList&&t.shareOrgList.length>0&&(t.model.privilegeDtoList&&t.model.privilegeDtoList.length>0&&t.shareOrgList.forEach(function(e,i){t.model.privilegeDtoList.forEach(function(t,i){1==t.businessType||"1"==t.businessType?t.businessId==e.id&&(e.isChecked=!0,e.userDtos.forEach(function(t,e){t.isDisabled=!0})):2!=t.businessType&&"2"!=t.businessType||e.userDtos.forEach(function(e,i){t.businessId==e.id&&(e.isChecked=!0)})})}),t.noOrgUsetList&&t.noOrgUsetList.length>0&&void 0!=t.model.privilegeDtoList&&t.noOrgUsetList.forEach(function(e,i){t.model.privilegeDtoList.forEach(function(t,i){2!=t.businessType&&"2"!=t.businessType||t.businessId!=e.id||(e.isChecked=!0)})}),t.businessFlag.isInitSeled=!0)}function o(e){var o={method:"post",url:rootPath+"/sharingPlatlform/initOrgAndUser"},n=function(t){e.shareOrgList=t.data.orgDtoList,e.noOrgUsetList=t.data.noOrgUserList,e.businessFlag.isLoadOrgUser=!0,i(e)};common.http({vm:e,$http:t,httpOptions:o,success:n})}function n(e,i){var o={method:"get",url:d+"/html/sharingDeatilById",params:{id:i}},n=function(t){e.model=t.data};common.http({vm:e,$http:t,httpOptions:o,success:n})}function a(i,o){i.isSubmit=!0;var n={method:"delete",url:d+"/sharingDelete",data:o},a=function(t){i.isSubmit=!1,i.gridOptions.dataSource.read(),e.alert("操作成功")};common.http({vm:i,$http:t,httpOptions:n,success:a})}function r(i){if($("form").valid()){if(i.isSubmit=!0,9!=i.model.isNoPermission){i.model.privilegeDtoList=[];var o=$("input[name='shareOrg']:checked");if(o.length>0)for(var n=0;n<o.length;n++){var a={};a.businessId=o[n].value,a.businessType="1",i.model.privilegeDtoList.push(a)}var r=$("input[name='shareUser']:not(:disabled):checked");if(r.length>0)for(var n=0;n<r.length;n++){var s={};s.businessId=r[n].value,s.businessType="2",i.model.privilegeDtoList.push(s)}}var l={method:"post",url:rootPath+"/sharingPlatlform/saveSharing",data:i.model},c=function(t){i.isSubmit=!1,i.model.sharId=t.data.sharId,e.alert("操作成功")};common.http({$http:t,httpOptions:l,success:c,onError:function(){i.isSubmit=!1}})}}function s(e,i){var o={method:"get",url:d+"/html/findById",params:{id:e.model.sharId}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({vm:e,$http:t,httpOptions:o,success:n})}function l(t){var e=common.kendoGridDataSource(d+"/findByCurUser",$("#formSharing"),t.queryParams.page,t.queryParams.pageSize,t.gridParams),i=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.sharId)},filterable:!1,width:30,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"unitSort",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"theme",title:"主题",width:"35%",filterable:!1},{field:"publishUsername",title:"发布人",width:"10%",filterable:!1},{field:"publishDate",title:"发布时间",format:"{0:yyyy-MM-dd hh24:mm:ss}",width:"18%",filterable:!1},{field:"isPublish",title:"发布状态",width:"12%",template:function(t){return t.isPublish&&9==t.isPublish?"已发布":"未发布"},filterable:!1},{field:"",title:"操作",width:"20%",template:function(t){return common.format($("#columnBtns").html(),t.sharId,t.sharId,"vm.del('"+t.sharId+"')")}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,pageable:common.kendoGridConfig(t.queryParams).pageable,dataBound:common.kendoGridConfig(t.queryParams).dataBound,columns:i,resizable:!0}}function c(e,i){var o=common.getKendoCheckId(".grid");if(0==o.length)common.alert({vm:e,msg:"请选择要批量发布的数据"});else{for(var n=[],a=0;a<o.length;a++)n.push(o[a].value);var r={method:"post",url:rootPath+"/sharingPlatlform/updatePublish",params:{ids:n.join(","),status:1==i?"9":"0"}},s=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.isSubmit=!1,e.gridOptions.dataSource.read(),common.alert({vm:e,msg:"操作成功",closeDialog:!0})}})};common.http({vm:e,$http:t,httpOptions:r,success:s})}}var d=rootPath+"/sharingPlatlform";return{grid:l,getSharingPlatlformById:s,createSharingPlatlform:r,deleteSharingPlatlform:a,getSharingDetailById:n,initOrgAndUser:o,initSeleObj:i,updatePublish:c}}angular.module("app").factory("sharingPlatlformSvc",t),t.$inject=["$http","bsWin"]}(),function(){"use strict";function t(t,e,i,o,n){var a=this;a.title="共享资料列表",a.model={},a.stateName=e.current.name,a.queryParams={},a.saveView=function(){n.storeView(a.stateName,{gridParams:a.gridOptions.dataSource.transport.options.read.data(),queryParams:a.queryParams,data:a})},function(){if(n.view[a.stateName]){var t=n.view[a.stateName];t.gridParams&&(a.gridParams=t.gridParams),t.data&&(a.model=t.data.model),t.queryParams&&(a.queryParams=t.queryParams),o.grid(a),n.view[a.stateName]=void 0}else o.grid(a)}(),a.findSharing=function(){a.gridOptions.dataSource._skip=0,a.gridOptions.dataSource.read()},a.resetShared=function(){var t=$("#formSharingPub").find("select");$.each(t,function(t,e){e.value=""})}}angular.module("app").controller("sharingPlatlformYetCtrl",t),t.$inject=["$location","$state","$http","sharingPlatlformYetSvc","$rootScope"]}(),function(){"use strict";function t(t){function e(t){var e=common.kendoGridDataSource(rootPath+"/sharingPlatlform/findByReception",$("#formSharingPub"),t.queryParams.page,t.queryParams.pageSize,t.gridParams),i=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.sharId)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"unitSort",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"theme",title:"共享主题",width:180,filterable:!0},{field:"publishUsername",title:"发布人",width:100,filterable:!0},{field:"publishDate",title:"发布时间",width:100,filterable:!0},{field:"",title:"操作",width:140,template:function(t){return common.format($("#columnBtns").html(),t.sharId)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,pageable:common.kendoGridConfig(t.queryParams).pageable,dataBound:common.kendoGridConfig(t.queryParams).dataBound,resizable:!0}}return{grid:e}}angular.module("app").factory("sharingPlatlformYetSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e,i){function o(){n.signWorkList=[],t.signWorkList(function(t){n.signWorkList=t,n.signWorkList&&0!=n.signWorkList.length?n.nodata=!1:n.nodata=!0})}var n=this;n.signId=i.params.signid,o(),n.querySignWork=function(){o()},n.resetForm=function(){var t=$("#signworkform").find("input,select");$.each(t,function(t,e){e.value=""})}}angular.module("app").controller("signworkCtrl",t),t.$inject=["signworkSvc","bsWin","$state"]}(),function(){"use strict";function t(t,e,i){function o(e){var i={method:"post",url:rootPath+"/signwork/fingSignWorkList",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{$filter:common.buildOdataFilter($("#signworkform"))},transformRequest:function(t){var e=[];for(var i in t)e.push(encodeURIComponent(i)+"="+encodeURIComponent(t[i]));return e.join("&")}},o=function(t){
void 0!=e&&"function"==typeof e&&e(t.data)};common.http({$http:t,httpOptions:i,success:o})}return{signWorkList:o}}angular.module("app").factory("signworkSvc",t),t.$inject=["$http","$state","bsWin"]}(),function(){"use strict";function t(t,e,i,o){var n=this;n.model={},n.title="新增收文",n.create=function(){common.initJqValidation(),$("form").valid()&&e.createSign(n.model,function(t){t.flag||"ok"==t.reCode?t.reObj.processInstanceId?o.alert("操作成功！"):o.success("操作成功，请继续填写项目审核登记表",function(){i.go("fillSign",{signid:t.reObj.signid},{reload:!0})}):o.error(t.reMsg)})}}angular.module("app").controller("signCreateCtrl",t),t.$inject=["$location","signSvc","$state","bsWin"]}(),function(){"use strict";function t(t,e,i,o,n,a){var r=this;r.stateName=e.current.name,r.queryParams={},r.saveView=function(){a.storeView(r.stateName,{gridParams:r.gridOptions.dataSource.transport.options.read.data(),queryParams:r.queryParams,data:r})},function(){if(a.view[r.stateName]){var e=a.view[r.stateName];e.gridParams&&(r.gridParams=e.gridParams),e.data&&(r.model=e.data.model),e.queryParams&&(r.queryParams=e.queryParams),t.signGrid(r),a.view[r.stateName]=void 0}else t.signGrid(r)}(),r.querySign=function(){r.gridOptions.dataSource._skip=0,r.gridOptions.dataSource.read()},r.check=function(){r.isAssociate=r.ischeck?9:0},r.del=function(e){n.confirm({title:"询问提示",message:"确认删除该条项目数据吗？",onOk:function(){t.deleteSign(e,function(t){t.flag||"ok"==t.reCode?n.alert("删除成功！",function(){r.gridOptions.dataSource.read()}):n.alert(t.reMsg)})}})},r.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)common.alert({vm:r,msg:"请选择数据"});else{for(var e=[],i=0;i<t.length;i++)e.push(t[i].value);var o=e.join(",");r.del(o)}},r.startNewFlow=function(t){n.confirm({title:"询问提示",message:"确认已经完成填写，并且发起流程么？",onOk:function(){$(".confirmDialog").modal("hide"),o.startFlow(t,function(t){t.flag||"ok"==t.reCode?n.success("操作成功！",function(){r.gridOptions.dataSource.read()}):n.error(t.reMsg)})}})},r.realSign=function(e){n.confirm({title:"询问提示",message:"确认正式签收了么？",onOk:function(){$(".confirmDialog").modal("hide"),t.realSign(e,function(t){t.flag||"ok"==t.reCode?n.success("操作成功！",function(){r.gridOptions.dataSource.read()}):n.error(t.reMsg)})}})}}angular.module("app").controller("signCtrl",t),t.$inject=["signSvc","$state","flowSvc","signFlowSvc","bsWin","$rootScope"]}(),function(){"use strict";function t(t,e,i,o,n,a,r){var s=this;s.model={},s.title="填写报审登记表",s.model.signid=i.params.signid,s.flowDeal=!1,s.busiObj={},s.otherFile=[],s.supply={},s.isControl=i.params.isControl,function(){t.initFillData(s.model.signid,function(t){s.model=t.reObj.sign,s.deptlist=t.reObj.deptlist,t.reObj.mainOfficeList&&(s.mainOfficeList=t.reObj.mainOfficeList),t.reObj.assistOfficeList&&(s.assistOfficeList=t.reObj.assistOfficeList),s.companyList=t.reObj.companyList,s.busiObj.leaderList=t.reObj.leaderList,s.sysFile={businessId:s.model.signid,mainId:s.model.signid,mainType:e.mainTypeValue().SIGN,sysfileType:e.mainTypeValue().FILLSIGN},e.initUploadOptions({inputId:"sysfileinput",vm:s}),"项目建议书"==s.model.reviewstage||"可行性研究报告"==s.model.reviewstage?s.stageType="STAGESUG":"资金申请报告"==s.model.reviewstage?s.stageType="STAGEREPORT":"设备清单（国产）"==s.model.reviewstage||"设备清单（进口）"==s.model.reviewstage?s.stageType="STAGEHOMELAND":"进口设备"==s.model.reviewstage?s.stageType="STAGEDEVICE":"项目概算"==s.model.reviewstage&&(s.stageType="STAGEBUDGET"),void 0!=t.reObj.registerFileDtoDtoList&&t.reObj.registerFileDtoDtoList.forEach(function(t,e){3==t.businessType?s.supply.push(t):2==t.businessType?s.drawingFile.push(t):s.otherFile.push(t)})})}(),s.checkOrgType=function(t){var e=t.target,i=e.checked,o=e.value;i&&(s.model.leaderName=signcommon.getDefaultLeader(o),$.each(s.busiObj.leaderList,function(t,e){e.mngOrgType==o&&(s.model.leaderId=e.id,s.model.leaderName=e.displayName,s.model.comprehensivehandlesug="请"+e.displayName.substring(0,1)+"主任阅示。")}),o==signcommon.getBusinessType().GX?s.model.leaderhandlesug="请（概算一部         概算二部）组织评审。":s.model.leaderhandlesug="请（评估一部         评估二部         评估一部信息化组）组织评审。",s.model.leaderId||n.alert("选择的默认办理部门没有合适的分管领导，请先设置分管领导角色用户！"))},s.startNewFlow=function(){common.initJqValidation($("#sign_fill_form")),$("#sign_fill_form").valid()?(s.isSubmit=!0,n.confirm({title:"询问提示",message:"确定发起流程么，请确保填写的信息已经保存正确！",onOk:function(){t.updateFillin(s.model,function(t){var e={method:"post",url:rootPath+"/sign/startNewFlow",params:{signid:s.model.signid}},a=function(t){s.isSubmit=!1,"ok"==t.data.reCode?n.success("操作成功！",function(){i.go("gtasks")}):n.error(t.data.reMsg)};common.http({$http:o,httpOptions:e,success:a})})}})):n.alert("操作失败，有红色*号的选项为必填项，请按要求填写！")},s.signPreview=function(t){var e=$(".well").parents("body"),i=e.find(".main-sidebar"),o=e.find(".main-header"),n=e.find(".content-wrapper");i.hide(),o.hide(),$(".toolbar").hide(),$(".well input").each(function(){var t=$(this).attr("type");"text"==t&&$(this).before('<span class="printmesge" data="text" style="white-space : nowrap;">'+$(this).val()+"</span>"),"checkbox"==t&&($(this).is(":checked")?$(this).before('<span class="printmesge" data="text">有</span>'):$(this).before('<span class="printmesge" data="text">无</span>'))}),$(".printmesge").show(),$(".well input[type=text]").hide(),$(".well input[type=checkbox]").hide(),$(".well button").hide(),n.find("td div select").hide(),n.find("td div span").css("margin","0"),$(".well").addClass("printbody"),$(".well .table-bordered").addClass("tableBOX"),n.find("input").addClass("noborder"),n.addClass("nomargin"),window.print(),i.show(),o.show(),$(".toolbar").show(),$(".printmesge").hide(),$(".well input[type=text]").show(),$(".well input[type=checkbox]").show(),$(".well button").show(),n.find("td div select").show(),n.find("td div span").css("margin-left","100px"),$(".well").removeClass("printbody"),$(".well .table-bordered").removeClass("tableBOX"),$("[data=text]").remove(),n.find("input").removeClass("noborder"),n.removeClass("nomargin")},s.updateFillin=function(){common.initJqValidation($("#sign_fill_form")),$("#sign_fill_form").valid()?(s.isSubmit=!0,s.model.leaderhandlesug=$("#leaderhandlesug").val(),t.updateFillin(s.model,function(t){s.isSubmit=!1,n.alert("操作成功！")})):n.alert("操作失败，有红色*号的选项为必填项，请按要求填写！")},s.findOfficeUsersByDeptName=function(e){var i={};"main"==e?i.maindeptName=s.model.maindeptName:i.assistdeptName=s.model.assistdeptName,t.findOfficeUsersByDeptName(i,function(t){"main"==e?(s.mainOfficeList={},s.mainOfficeList=t):(s.assistOfficeList={},s.assistOfficeList=t)})},s.addOtherFile=function(t,e){s.addRegisters||(s.addRegisters=[]),t?("4"==e&&(s.addRegisters=s.otherFile,s.showFilePage=!1,s.showFileOther=!1,s.showSignOther=!0),"2"==e&&(s.addRegisters=s.drawingFile,s.showFilePage=!0,s.showFileOther=!1,s.showSignOther=!1),s.businessId=t,s.businessType=e,$("#addOtherFile").kendoWindow({width:"840px",height:"480px",title:"补充资料编辑",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()):n.alert("请先保存数据！")},s.addRegisterFile=function(){s.addRegister={},s.addRegister.businessId=s.businessId,s.addRegister.businessType=s.businessType,s.addRegister.id=common.uuid(),s.addRegisters.push(s.addRegister)},s.saveRegisterFile=function(){r.saveRegisterFile(s.addRegisters,function(t){t.flag||"ok"==t.reCode?(n.alert("操作成功"),s.addRegisters=t.reObj):n.alert(t.reMsg)})},s.deleteRegisterFile=function(){var t=$("#addOtherFile input[name='addRegistersCheck']:checked");if(t.length<1)n.alert("请选择要删除的记录！");else{for(var e=[],i=0;i<t.length;i++)s.addRegisters.forEach(function(o,n){o.id&&t[i].value==o.id&&(e.push(t[i].value),s.addRegisters.splice(n,1))});e.length>0&&r.deleteByIds(e.join(","),function(t){n.alert("删除成功！")})}},s.editPrint=function(){var t=getLodop(),e=(rootPath,"<style>"+document.getElementById("xxxx").innerHTML+"</style>"),i=e+"<body>"+$("#sign_fill_xmjys_templ").html()+"</body>";t.PRINT_INIT(""),t.ADD_PRINT_HTM(10,20,"100%","100%",i),t.PREVIEW()}}angular.module("app").controller("signFillinCtrl",t),t.$inject=["signSvc","sysfileSvc","$state","$http","bsWin","$scope","addRegisterFileSvc"]}(),function(){"use strict";function t(t,e,i,o,n,a){var r=this;r.title="已办结项目详情",r.model={},r.flow={},r.model.signid=i.params.signid,r.flow.processInstanceId=i.params.processInstanceId,r.flow.hideFlowImg=!0,r.showFlag={tabWorkProgram:!1,tabBaseWP:!1,tabDispatch:!1,tabFilerecord:!1,tabExpert:!1,tabSysFile:!1,tabAssociateSigns:!1},r.businessFlag={expertReviews:[]},function(){$("#myTab li").click(function(t){var e=$("a",this);t.preventDefault(),e.tab("show");var i=e.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500),r.model.showDiv=i}),o.initFlowData(r),e.initFlowPageData(r.model.signid,function(t){r.model=t;var e=$("#myTab .active"),i=$("a",e);r.model.showDiv=i.attr("for-div"),r.model.dispatchDocDto&&(r.showFlag.tabDispatch=!0,r.dispatchDoc=r.model.dispatchDocDto),r.model.fileRecordDto&&(r.showFlag.tabFilerecord=!0,r.fileRecord=r.model.fileRecordDto),r.model.processState>1&&(r.showFlag.tabWorkProgram=!0),r.model.suppLetterDtoList&&(r.showSupperIndex=0),void 0!=r.model.registerFileDtoDtoList&&(r.supply=[],r.registerFile=[],r.drawingFile=[],r.otherFile=[],r.model.registerFileDtoDtoList.forEach(function(t,e){3==t.businessType?r.supply.push(t):2==t.businessType?r.drawingFile.push(t):1==t.businessType||4==t.businessType?r.registerFile.push(t):5!=t.businessType&&6!=t.businessType&&7!=t.businessType||r.otherFile.push(t)}))}),t.findByMianId(r.model.signid,function(e){e&&e.length>0&&(r.showFlag.tabSysFile=!0,r.sysFileList=e,t.initZtreeClient(r,n))})}(),r.commonDownloadSysFile=function(e){t.downloadFile(e)},r.commonEditSysFile=function(t){$("#editSysFileWindow").kendoWindow({width:"80%",title:"在线编辑",content:rootPath+"/file/editFile?sysFileId="+t})},r.printpage=function(t){a.templatePrint(t.target,r.model)}}angular.module("app").controller("signEndCtrl",t),t.$inject=["sysfileSvc","signSvc","$state","flowSvc","$scope","templatePrintSvc"]}(),function(){"use strict";function t(t,e,i){function o(e,i){var o={method:"post",url:rootPath+"/sign/startNewFlow",params:{signid:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function n(t){switch(t.flow.curNode.activitiId){case flowcommon.getSignFlowNode().SIGN_QS:t.showFlag.businessTr=!0,t.showFlag.nodeSign=!0;break;case flowcommon.getSignFlowNode().SIGN_ZHB:t.showFlag.buttBack=!0,t.showFlag.businessNext=!0,t.showFlag.nodeSelViceMgr=!0,t.flow.businessMap&&(t.viceDirectors=t.flow.businessMap.viceDirectors);break;case flowcommon.getSignFlowNode().SIGN_FGLD_FB:t.showFlag.buttBack=!0,t.showFlag.businessNext=!0,t.showFlag.nodeSelOrgs=!0,t.flow.businessMap&&(t.orgs=t.flow.businessMap.orgs);break;case flowcommon.getSignFlowNode().SIGN_BMFB1:t.businessFlag.isMainBranch=!0;case flowcommon.getSignFlowNode().SIGN_BMFB2:case flowcommon.getSignFlowNode().SIGN_BMFB3:case flowcommon.getSignFlowNode().SIGN_BMFB4:t.showFlag.businessNext=!0,t.showFlag.nodeSelPrincipal=!0,t.flow.businessMap&&t.flow.businessMap.users&&(t.users=t.flow.businessMap.users,t.users.forEach(function(t,e){t.isSelected=!1}));break;case flowcommon.getSignFlowNode().SIGN_XMFZR1:t.businessFlag.isMainBranch=!0,t.businessFlag.curBranchId="1";case flowcommon.getSignFlowNode().SIGN_XMFZR2:t.businessFlag.curBranchId||(t.businessFlag.curBranchId="2");case flowcommon.getSignFlowNode().SIGN_XMFZR3:t.businessFlag.curBranchId||(t.businessFlag.curBranchId="3");case flowcommon.getSignFlowNode().SIGN_XMFZR4:t.businessFlag.curBranchId||(t.businessFlag.curBranchId="4"),t.showFlag.businessTr=!0,t.showFlag.nodeWorkProgram=!0,t.businessFlag.isFinishWP=t.flow.businessMap.isFinishWP,t.model.processState>=2&&t.model.workProgramDtoList&&($.each(t.model.workProgramDtoList,function(e,i){i.branchId==t.businessFlag.curBranchId&&(t.businessFlag.editEPReviewId=i.expertReviewId)}),t.businessFlag.editExpertSC=!0,t.showFlag.tabWorkProgram=!0,$("#show_workprogram_a").click());break;case flowcommon.getSignFlowNode().SIGN_BMLD_SPW1:case flowcommon.getSignFlowNode().SIGN_BMLD_SPW2:case flowcommon.getSignFlowNode().SIGN_BMLD_SPW3:case flowcommon.getSignFlowNode().SIGN_BMLD_SPW4:case flowcommon.getSignFlowNode().SIGN_FGLD_SPW1:case flowcommon.getSignFlowNode().SIGN_FGLD_SPW2:case flowcommon.getSignFlowNode().SIGN_FGLD_SPW3:case flowcommon.getSignFlowNode().SIGN_FGLD_SPW4:t.showFlag.buttBack=!0,t.showFlag.tabWorkProgram=!0,$("#show_workprogram_a").click();break;case flowcommon.getSignFlowNode().SIGN_FW:t.showFlag.businessTr=!0,t.showFlag.nodeDispatch=!0,t.showFlag.isMainPrinUser=!0,t.showFlag.expertEdit=!0,t.flow.businessMap.prilUserList&&(t.businessFlag.principalUsers=t.flow.businessMap.prilUserList,t.showFlag.businessNext=!0),t.model.processState>=4&&(t.showFlag.tabDispatch=!0,$("#show_dispatch_a").click());break;case flowcommon.getSignFlowNode().SIGN_QRFW:case flowcommon.getSignFlowNode().SIGN_BMLD_QRFW_XB:case flowcommon.getSignFlowNode().SIGN_FGLD_QRFW_XB:t.watchPassDis(),t.showFlag.buttBack=!1,t.showFlag.businessTr=!0,t.showFlag.nodeConfirmDis=!0,t.businessFlag.passDis="9",t.showFlag.tabDispatch=!0,$("#show_dispatch_a").click();break;case flowcommon.getSignFlowNode().SIGN_BMLD_QRFW:case flowcommon.getSignFlowNode().SIGN_FGLD_QRFW:case flowcommon.getSignFlowNode().SIGN_ZR_QRFW:t.showFlag.buttBack=!0,t.showFlag.tabWorkProgram=!0,t.showFlag.tabDispatch=!0,$("#show_dispatch_a").click();break;case flowcommon.getSignFlowNode().SIGN_FWBH:t.showFlag.tabWorkProgram=!0,t.showFlag.tabDispatch=!0,$("#show_dispatch_a").click(),t.showFlag.businessTr=!0,t.showFlag.nodeCreateDisNum=!0,t.showFlag.isMainPrinUser=!0;break;case flowcommon.getSignFlowNode().SIGN_CWBL:t.showFlag.tabWorkProgram=!0,t.showFlag.tabDispatch=!0,t.showFlag.businessTr=!0,t.showFlag.financialCode=!0;break;case flowcommon.getSignFlowNode().SIGN_GD:t.showFlag.tabWorkProgram=!0,t.showFlag.tabDispatch=!0,t.showFlag.isMainPrinUser=!0,t.flow.businessMap.checkFileUser&&(t.showFlag.businessNext=!0),t.showFlag.businessTr=!0,t.showFlag.nodeFileRecord=!0,t.model.processState>6&&(t.showFlag.tabFilerecord=!0,$("#show_filerecord_a").click());break;case flowcommon.getSignFlowNode().SIGN_DSFZR_QRGD:t.showFlag.tabWorkProgram=!0,t.showFlag.tabDispatch=!0,t.showFlag.tabFilerecord=!0,$("#show_filerecord_a").click(),t.showFlag.buttBack=!0;break;case flowcommon.getSignFlowNode().SIGN_QRGD:t.showFlag.tabWorkProgram=!0,t.showFlag.tabDispatch=!0,t.showFlag.tabFilerecord=!0,$("#show_filerecord_a").click(),t.showFlag.buttBack=!0,t.showFlag.nodeNext=!1}}function a(t){t.flow.businessMap||(t.flow.businessMap={});var e={};switch(e.resultTag=!0,t.flow.curNode.activitiId){case flowcommon.getSignFlowNode().SIGN_ZHB:$("#viceDirector").val()?t.flow.businessMap.FGLD=$("#viceDirector").val():e.resultTag=!1;break;case flowcommon.getSignFlowNode().SIGN_FGLD_FB:if(e.resultTag=!1,$('.seleteTable input[selectType="main"]:checked').each(function(){t.flow.businessMap.MAIN_ORG=$(this).val(),e.resultTag=!0}),e.resultTag){var i=[];$('.seleteTable input[selectType="assist"]:checked').each(function(){i.push($(this).val())}),i.length>3?(e.resultTag=!1,e.resultMsg="协办部门最多只能选择3个！"):t.flow.businessMap.ASSIST_ORG=i.join(",")}else e.resultMsg="主办部门不为空！";break;case flowcommon.getSignFlowNode().SIGN_BMFB1:if(!t.model.isassistflow||9!=t.model.isassistflow&&"9"!=t.model.isassistflow){var o=$("#selPrincipalMainUser").val();if(!o){e.resultTag=!1,e.resultMsg="必须要选择一个第一负责人！";break}e.resultTag=!0,t.flow.businessMap.M_USER_ID=o;var n=[];$('#principalAssistUser input[selectType="assistUser"]:checked').each(function(){n.push($(this).val())}),n.length>0&&(t.flow.businessMap.A_USER_ID=n.join(","))}else t.businessFlag.principalUsers&&0!=t.businessFlag.principalUsers.length?(e.resultTag=!1,$.each(t.businessFlag.principalUsers,function(t,i){"9"!=i.isMainUser&&9!=i.isMainUser||(e.resultTag=!0)}),e.resultTag||(e.resultMsg="必须要选择一个第一负责人！")):(e.resultTag=!1,e.resultMsg="请先选择项目负责人！"),e.resultTag&&(t.flow.businessMap.PRINCIPAL=t.businessFlag.principalUsers);break;case flowcommon.getSignFlowNode().SIGN_BMFB2:case flowcommon.getSignFlowNode().SIGN_BMFB3:case flowcommon.getSignFlowNode().SIGN_BMFB4:if(!t.model.isassistflow||9!=t.model.isassistflow&&"9"!=t.model.isassistflow){var n=[];$('#principalAssistUser input[selectType="assistUser"]:checked').each(function(){n.push($(this).val())}),n.length>0?t.flow.businessMap.A_USER_ID=n.join(","):(e.resultTag=!1,e.resultMsg="必须要选择负责人！")}else t.businessFlag.principalUsers&&0!=t.businessFlag.principalUsers.length||(e.resultTag=!1,e.resultMsg="请先选择项目负责人！"),e.resultTag&&(t.flow.businessMap.PRINCIPAL=t.businessFlag.principalUsers);break;case flowcommon.getSignFlowNode().SIGN_XMFZR1:case flowcommon.getSignFlowNode().SIGN_XMFZR2:case flowcommon.getSignFlowNode().SIGN_XMFZR3:case flowcommon.getSignFlowNode().SIGN_XMFZR4:9==t.businessFlag.isNeedWP&&0==t.businessFlag.isFinishWP&&(e.resultTag=!1,e.resultMsg="您还没有完成工作方案，不能进行下一步操作！"),t.flow.businessMap.IS_NEED_WP=t.businessFlag.isNeedWP;break;case flowcommon.getSignFlowNode().SIGN_BMLD_SPW1:case flowcommon.getSignFlowNode().SIGN_BMLD_SPW2:case flowcommon.getSignFlowNode().SIGN_BMLD_SPW3:case flowcommon.getSignFlowNode().SIGN_BMLD_SPW4:break;case flowcommon.getSignFlowNode().SIGN_FGLD_SPW1:case flowcommon.getSignFlowNode().SIGN_FGLD_SPW2:case flowcommon.getSignFlowNode().SIGN_FGLD_SPW3:case flowcommon.getSignFlowNode().SIGN_FGLD_SPW4:break;case flowcommon.getSignFlowNode().SIGN_FW:t.model.processState<4&&(e.resultTag=!1,e.resultMsg="您还没完成发文操作，不能进行下一步操作！"),t.flow.businessMap.DIS_ID=t.dispatchDoc.id;break;case flowcommon.getSignFlowNode().SIGN_QRFW:case flowcommon.getSignFlowNode().SIGN_BMLD_QRFW_XB:case flowcommon.getSignFlowNode().SIGN_FGLD_QRFW_XB:"9"==t.businessFlag.passDis||9==t.businessFlag.passDis?t.flow.businessMap.AGREE="9":t.flow.businessMap.AGREE="0",t.flow.businessMap.DIS_ID=t.dispatchDoc.id;break;case flowcommon.getSignFlowNode().SIGN_BMLD_QRFW:case flowcommon.getSignFlowNode().SIGN_FGLD_QRFW:case flowcommon.getSignFlowNode().SIGN_ZR_QRFW:case flowcommon.getSignFlowNode().SIGN_FWBH:t.flow.businessMap.DIS_ID=t.dispatchDoc.id;break;case flowcommon.getSignFlowNode().SIGN_CWBL:break;case flowcommon.getSignFlowNode().SIGN_GD:t.model.processState<7&&(e.resultTag=!1,e.resultMsg="您还没完成归档操作，不能进行下一步操作！");break;case flowcommon.getSignFlowNode().SIGN_DSFZR_QRGD:case flowcommon.getSignFlowNode().SIGN_QRGD:t.flow.businessMap.GD_ID=t.fileRecord.fileRecordId}return e}function r(e){var i={method:"get",url:rootPath+"/dispatch/html/initDispatchBySignId",params:{signId:e.model.signid}},o=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.dispatchDoc=t.data,$("#show_dispatch_a").click()}})};common.http({vm:e,$http:t,httpOptions:i,success:o})}function s(e){var i={method:"get",url:rootPath+"/fileRecord/html/initBySignId",params:{signId:e.model.signid}},o=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.fileRecord=t.data,$("#show_filerecord_a").click()}})};common.http({vm:e,$http:t,httpOptions:i,success:o})}function l(e){var i={method:"get",url:rootPath+"/sign/html/initDetailPageData",params:{signid:e.model.signid,queryAll:!0}},o=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.model=t.data,e.model.workProgramDtoList&&e.model.workProgramDtoList.length>0&&(e.show_workprogram=!0,e.model.workProgramDtoList.forEach(function(t,i){9==t.isMain?(e.showMainwork=!0,e.mainwork={},e.mainwork=t):0==t.isMain&&(e.showAssistwork=!0,e.assistwork={},e.assistwork=t)})),e.model.dispatchDocDto&&(e.show_dispatch=!0,e.dispatchDoc=e.model.dispatchDocDto),e.model.fileRecordDto&&(e.show_filerecord=!0,e.fileRecord=e.model.fileRecordDto)}})};common.http({vm:e,$http:t,httpOptions:i,success:o})}return{startFlow:o,initBusinessParams:n,checkBusinessFill:a,getChargeDispatch:r,getChargeFilerecord:s,endSignDetail:l}}angular.module("app").factory("signFlowSvc",t),t.$inject=["$http","$state","bsWin"]}(),function(){"use strict";function t(t,e,i,o,n,a,r,s,l,c,d,u,m,p,f,h){function g(t){t=void 0==t?0:t;var e=0;return t>800&&t<=4e3?e=.2*(t-800):t>4e3&&t<=2e4?e=.8*t*.2:t>2e4&&t<=5e4?e=.8*t*.3-2e3:t>5e4&&(e=.8*t*.3-2755),e}var v=this;v.title="项目流程处理",v.model={},v.flow={},v.mainwork={},v.assistwork={},v.dispatchDoc={},v.fileRecord={},v.expertReview={},v.work={},v.isDisplay=!0,v.expertList=new Array(15),v.showFlag={businessTr:!1,businessDis:!1,businessNext:!1,nodeNext:!0,nodeSelViceMgr:!1,nodeSelOrgs:!1,nodeSelPrincipal:!1,isMainBranch:!1,nodeSign:!1,nodeWorkProgram:!1,nodeDispatch:!1,nodeConfirmDis:!1,nodeCreateDisNum:!1,nodeFileRecord:!1,nodeXSWorkProgram:!1,tabWorkProgram:!1,tabBaseWP:!1,tabDispatch:!1,tabFilerecord:!1,tabExpert:!1,tabSysFile:!1,buttBack:!1,expertRemark:!1,expertpayment:!1,expertEdit:!1,isMainPrinUser:!1},v.businessFlag={isLoadSign:!1,isLoadFlow:!1,isGotoDis:!1,isMakeDisNum:!1,principalUsers:[],isSelMainPriUser:!1,editExpertSC:!1,expertScore:{},isNeedWP:9,isMainBranch:!1,isFinishWP:!1,passDis:!1,curBranchId:"",editEPReviewId:""},v.model.signid=o.params.signid,v.work.id=o.params.id,v.flow.taskId=o.params.taskId,v.flow.processInstanceId=o.params.processInstanceId,v.signId=v.model.signid,v.expertList=new Array(10),function(){$("#myTab li").click(function(t){var e=$("a",this);t.preventDefault(),e.tab("show");var i=e.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500),v.model.showDiv=i}),v.sysFile={businessId:o.params.signid,mainId:o.params.signid,mainType:t.mainTypeValue().SIGN,sysfileType:t.mainTypeValue().FILLSIGN},t.initUploadOptions({inputId:"sysfileinput",vm:v,uploadSuccess:function(){t.findByMianId(v.model.signid,function(e){e&&e.length>0&&(v.showFlag.tabSysFile=!0,v.sysFileList=e,t.initZtreeClient(v,c))})}}),e.initFlowPageData(v.model.signid,function(t){v.model=t;var e=$("#myTab .active"),i=$("a",e);if(v.model.showDiv=i.attr("for-div"),v.model.dispatchDocDto&&(v.showFlag.tabDispatch=!0,v.dispatchDoc=v.model.dispatchDocDto,2==v.dispatchDoc.dispatchWay&&0==v.dispatchDoc.isMainProject||v.dispatchDoc.fileNum?v.businessFlag.isCreateDisFileNum=!0:v.showFlag.buttDisFileNum=!0),v.model.fileRecordDto&&(v.showFlag.tabFilerecord=!0,v.fileRecord=v.model.fileRecordDto),v.model.workProgramDtoList&&v.model.workProgramDtoList.length>0){var o;""!=(o="1"==v.model.workProgramDtoList[0].branchId||"1"==v.model.workProgramDtoList[0].branchId?v.model.workProgramDtoList[0].reviewOrgName:v.model.workProgramDtoList[0].mainWorkProgramDto.reviewOrgName)&&o.split(",").length>1&&(v.showTotalInvestment=!0)}v.businessFlag.isLoadSign=!0,v.businessFlag.isLoadSign&&v.businessFlag.isLoadFlow&&a.initBusinessParams(v),v.model.suppLetterDtoList&&(v.showSupperIndex=0),void 0!=v.model.registerFileDtoDtoList&&(v.supply=[],v.registerFile=[],v.drawingFile=[],v.otherFile=[],v.model.registerFileDtoDtoList.forEach(function(t,e){3==t.businessType?v.supply.push(t):2==t.businessType?v.drawingFile.push(t):1==t.businessType||4==t.businessType?v.registerFile.push(t):5!=t.businessType&&6!=t.businessType&&7!=t.businessType||v.otherFile.push(t)}))}),n.getFlowInfo(v.flow.taskId,v.flow.processInstanceId,function(t){v.flow=t,v.flow.taskId?(v.flow.end&&(v.showFlag.nodeNext=!1),v.businessFlag.isLoadFlow=!0,v.businessFlag.isLoadSign&&v.businessFlag.isLoadFlow&&a.initBusinessParams(v)):d.alert("该任务已处理！",function(){o.go("gtasks")})}),n.initFlowData(v),t.findByMianId(v.model.signid,function(e){e&&e.length>0&&(v.showFlag.tabSysFile=!0,v.sysFileList=e,t.initZtreeClient(v,c))}),v.delFile=function(e){t.delSysFile(e,function(){d.alert("删除成功",function(){t.findByMianId(v.model.signid,function(e){e&&e.length>0&&(v.showFlag.tabSysFile=!0,v.sysFileList=e,t.initZtreeClient(v,c))})})})},r.initIdea(v)}(),v.ideaEdit=function(t){angular.isObject(t)||(t={}),r.initIdeaData(v,t)},v.selectedIdea=function(){v.flow.dealOption=v.chooseIdea},v.editSelectExpert=function(t){v.scoreExpert={},$.each(v.model.expertReviewDto.expertSelectedDtoList,function(e,i){if(i.id==t)return void(v.scoreExpert=angular.copy(i))}),$("#star_"+v.scoreExpert.id).raty({number:5,score:function(){return $(this).attr("data-num",angular.isUndefined(v.scoreExpert.score)?0:v.scoreExpert.score),$(this).attr("data-num")},starOn:"../contents/libs/raty/lib/images/star-on.png",starOff:"../contents/libs/raty/lib/images/star-off.png",starHalf:"../contents/libs/raty/lib/images/star-half.png",readOnly:!1,halfShow:!0,hints:["不合格","合格","中等","良好","优秀"],size:34,click:function(t,e){v.scoreExpert.score=t}}),$("#score_win").kendoWindow({width:"820px",height:"365px",title:"编辑-专家星级",visible:!1,modal:!0,closable:!0,actions:["Close"]}).data("kendoWindow").center().open()},v.closeEditMark=function(){window.parent.$("#score_win").data("kendoWindow").close()},v.saveMark=function(){v.scoreExpert.score&&0!=v.scoreExpert.score?v.scoreExpert.describes?l.saveMark(v.scoreExpert,function(t){t.flag||"ok"==t.reCode?(angular.forEach(v.model.expertReviewDto.expertSelectedDtoList,function(t,e){t.id==v.scoreExpert.id&&(t.score=v.scoreExpert.score,t.describes=v.scoreExpert.describes)}),d.success("保存成功！",function(){v.closeEditMark()})):d.alert(t.reMsg)}):d.alert("请对专家进行评分描述！"):d.alert("请对专家进行评分！")},v.countTaxes=function(t){if(void 0!=t){if(void 0==t.payDate)return void d.alert("请选择评审费发放日期");if(!/^(\d{4}-\d{1,2}-\d{1,2})$/.exec(t.payDate))return void d.alert("请输入正确的日期格式");if(void 0==t.expertSelectedDtoList||0==t.expertSelectedDtoList.length)return void d.alert("该方案还没评审专家");common.initJqValidation($("#payform"));if($("#payform").valid()){var e,i=t.expertSelectedDtoList.length,o="";$.each(t.expertSelectedDtoList,function(t,e){o+="'"+e.id+"'",t!=i-1&&(o+=",")});var n=t.payDate;e=n.substring(0,n.lastIndexOf("-")),l.countTaxes(o,e,function(e){var i=e;t.reviewCost=0,t.reviewTaxes=0,t.totalCost=0,$.each(t.expertSelectedDtoList,function(e,o){if(!("9"!=o.isConfrim&&9!=o.isConfrim||"9"!=o.isJoin&&9!=o.isJoin)){var n=o.EXPERTID,a=o.id,r=0;void 0!=i&&i.length>0&&i.forEach(function(t,e){t.EXPERTID==n&&t.ESID!=a&&(t.REVIEWCOST=void 0==t.REVIEWCOST?0:t.REVIEWCOST,t.REVIEWCOST=parseFloat(t.REVIEWCOST),r=parseFloat(r)+t.REVIEWCOST)}),o.reviewCost=void 0==o.reviewCost?0:o.reviewCost;var s=r+parseFloat(o.reviewCost);o.reviewTaxes=g(s).toFixed(2),o.totalCost=(parseFloat(o.reviewCost)+parseFloat(o.reviewTaxes)).toFixed(2),t.reviewCost=(parseFloat(t.reviewCost)+parseFloat(o.reviewCost)).toFixed(2),t.reviewTaxes=(parseFloat(t.reviewTaxes)+parseFloat(o.reviewTaxes)).toFixed(2),t.totalCost=(parseFloat(t.reviewCost)+parseFloat(t.reviewTaxes)).toFixed(2)}})})}}},v.closeEditPay=function(){window.parent.$("#payment").data("kendoWindow").close()},v.savePayment=function(t){common.initJqValidation($("#payform")),$("#payform").valid()?t.reviewCost?l.savePayment(t,v.isCommit,function(t){t.flag||"ok"==t.reCode?d.alert("操作成功！",function(){v.isCommit=!1}):d.alert(t.reMsg)}):d.alert("请计算税率，再保存！"):d.alert("请正确填写专家评审费信息！")},v.editUnitScore=function(t){$("#star").raty({number:5,score:function(){return $(this).attr("data-num",angular.isUndefined(v.model.unitScoreDto.score)?0:v.model.unitScoreDto.score),$(this).attr("data-num")},starOn:"../contents/libs/raty/lib/images/star-on.png",starOff:"../contents/libs/raty/lib/images/star-off.png",starHalf:"../contents/libs/raty/lib/images/star-half.png",readOnly:!1,halfShow:!0,hints:["不合格","合格","中等","良好","优秀"],size:34,click:function(t,e){v.model.unitScoreDto.score=t}}),$("#unitscore_win").kendoWindow({width:"820px",height:"365px",title:"编辑-单位星级",visible:!1,modal:!0,closable:!0,actions:["Close"]}).data("kendoWindow").center().open()},v.saveUnit=function(){v.model.unitScoreDto.score&&0!=v.model.unitScoreDto.score?v.model.unitScoreDto.describes?h.saveUnit(v.model.unitScoreDto,function(t){t.flag||"ok"==t.reCode?d.success("保存成功！",function(){v.closeEditUnit()}):d.alert(t.reMsg)}):d.alert("请对单位进行评分描述！"):d.alert("请对单位进行评分！")},v.closeEditUnit=function(){window.parent.$("#unitscore_win").data("kendoWindow").close()},v.commitNextStep=function(){if(v.flow.isSuspended)return void d.error("该流程目前为暂停状态，不能进行流转操作！");var t=a.checkBusinessFill(v);t.resultTag?n.commit(v.isCommit,v.flow,function(t){t.flag||"ok"==t.reCode?d.success("操作成功！",function(){o.go("gtasks")}):d.alert(t.reMsg)}):d.alert(t.resultMsg)},v.commitBack=function(){common.initJqValidation($("#flow_form")),$("#flow_form").valid()&&d.confirm({title:"询问提示",message:"确认回退吗？",onOk:function(){n.rollBackToLast(v.flow,v.isCommit,function(t){t.flag||"ok"==t.reCode?(v.isCommit=!1,d.alert("回退成功！",function(){o.go("gtasks")})):d.alert(t.reMsg)})}})},v.deleteFlow=function(){d.confirm({title:"询问提示",message:"终止流程将无法恢复，确认删除么？？",onOk:function(){$(".confirmDialog").modal("hide"),n.deleteFlow(v)}})},v.editSign=function(){o.go("fillSign",{signid:v.model.signid})},v.addWorkProgram=function(){o.go("workprogramEdit",{signid:v.model.signid})},v.addSuppLetter=function(){o.go("addSupp",{businessId:v.model.signid,businessType:"SIGN"})},v.addSuppLetterList=function(){o.go("addSuppletterList",{businessId:v.model.signid})},v.addRegisterFile=function(){o.go("registerFile",{businessId:v.model.signid})},v.addBaseWP=function(){o.go("workprogramBaseEdit",{signid:v.model.signid})},v.addDisPatch=function(){v.model.isAssociate&&0!=v.model.isAssociate||signcommon.getReviewStage().STAGE_STUDY!=v.model.reviewstage&&signcommon.getReviewStage().STAGE_BUDGET!=v.model.reviewstage?o.go("dispatchEdit",{signid:v.model.signid}):d.confirm({title:"询问提示",message:"该项目还没进行项目关联，是否需要进行关联设置？",onOk:function(){v.searchAssociateSign||(v.searchAssociateSign={signid:v.model.signid,projectname:v.model.projectname}),e.getAssociateSign(v.searchAssociateSign,function(t){v.associateSignList=[],t&&(v.associateSignList=t),$("#associateWindow").kendoWindow({width:"75%",height:"650px",title:"项目关联",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()})},onCancel:function(){o.go("dispatchEdit",{signid:v.model.signid})}})},v.associateQuerySign=function(){e.getAssociateSign(v.searchAssociateSign,function(t){v.associateSignList=[],t&&(v.associateSignList=t)})},v.saveAssociateSign=function(t){if(v.model.signid==t)return void d.alert("不能关联自身项目");e.saveAssociateSign(v.model.signid,t,function(){t&&(v.model.isAssociate=1),d.alert(void 0!=t?"项目关联成功":"项目解除关联成功"),window.parent.$("#associateWindow").data("kendoWindow").close()})},v.addFinancialApply=function(t){"9"==v.model.isassistflow||9==v.model.isassistflow?v.costType="ASSIST":v.costType="REVIEW",p.initAddCost(v,v.costType,v.model,t)},v.addDoFile=function(){o.go("fileRecordEdit",{signid:v.model.signid})},v.addRegisterFileRecord=function(){v.fileRecord.fileRecordId?o.go("registerFile",{signid:v.fileRecord.fileRecordId}):d.alert("请保存归档再操作！")},v.mainOrg=function(t){var e=t.target,i=e.checked,o=e.value;i?$('.seleteTable input[selectType="main"]').each(function(){var t=$(this).attr("value");t!=o?($(this).removeAttr("checked"),$("#assist_"+t).removeAttr("disabled")):($("#assist_"+o).removeAttr("checked"),$("#assist_"+o).attr("disabled","disabled"))}):$("#assist_"+o).removeAttr("disabled"),v.initOption()},v.initOption=function(){var t=[];$('.seleteTable input[selectType="main"]:checked').each(function(){t.push($(this).attr("tit"))}),$('.seleteTable input[selectType="assist"]:checked').each(function(){t.push($(this).attr("tit"))}),t.length>0&&(v.flow.dealOption="请（"+t.join("，")+"）组织评审")},v.checkPrincipal=function(){var t=$("#selPrincipalMainUser").val();t&&$('#principalAssistUser input[selectType="assistUser"]').each(function(){$(this).attr("value")==t?($(this).removeAttr("checked"),$(this).attr("disabled","disabled")):$(this).removeAttr("disabled")}),v.initUserOption()};var y=[];v.initUserOption=function(t){var e=$("#selPrincipalMainUser").val(),i=!1,o="请（";e&&$.each(v.users,function(t,n){n.id==e&&(o+=n.displayName,i=!0)}),$("input[name='"+t+"']").is(":checked")?y.push(t):angular.forEach(y,function(e,i){e==t&&y.splice(i,1)}),y.length>0&&(i&&(o+=", "),o+=y.join(", ")),o+=" )组织办理。",v.flow.dealOption=o},v.checkBoxSingle=function(t,e){
var i=t.target,o=i.checked,n=i.value;o?$('.seleteTable input[selectType="'+e+'"]').each(function(){var t=$(this).attr("id"),i=$(this).attr("value");t!=e+"_"+n?($("#"+disabletype+"_"+i).removeAttr("disabled"),$(this).removeAttr("checked")):$("#"+disabletype+"_"+n).attr("disabled","disabled")}):$("#"+disabletype+"_"+n).removeAttr("disabled")},v.checkBoxSingle=function(t,e){var i=t.target,o=i.checked,n=i.value;o&&$('#xs_table input[selectType="'+e+'"]').each(function(){$(this).attr("id");$(this).attr("value")!=n&&$(this).removeAttr("checked")})},v.addPriUser=function(){var t=$("#xs_bmfb input[name='unSelPriUser']:checked");if(t.length<1)d.alert("请选择负责人");else{if(v.businessFlag.isMainBranch){if(9==v.isMainPriUser&&t.length>1)return void d.alert("总负责人只能选一个");if(0==v.businessFlag.isSelMainPriUser&&(angular.isUndefined(v.isMainPriUser)||0==v.isMainPriUser))return void d.alert("请先选择总负责人");if(1==v.businessFlag.isSelMainPriUser&&9==v.isMainPriUser)return void d.alert("你已经选择了一个总负责人！")}for(var e=0;e<t.length;e++){var i={};i.userId=t[e].value,i.userType=$("#userType").val(),9==v.isMainPriUser?(v.businessFlag.isSelMainPriUser=!0,i.isMainUser=9,v.isMainPriUser=0):i.isMainUser=0,v.users.forEach(function(o,n){o.id==t[e].value&&(o.isSelected=!0,i.userId=o.id,i.userName=o.displayName)}),v.businessFlag.principalUsers.push(i),v.businessFlag.principalUsers.sort(w("isMainUser")),v.initDealUserName(v.businessFlag.principalUsers)}}};var w=function(t){return function(e,i){var o,n;if("object"==typeof e&&"object"==typeof i&&e&&i)return o=e[t],n=i[t],console.log(o,n),o===n?0:typeof o==typeof n?o>n?-1:1:typeof o>typeof n?-1:1;throw"error"}};v.delPriUser=function(){var t=$("#xs_bmfb input[name='selPriUser']:checked");if(t.length<1)d.alert("请选择取消的负责人");else{for(var e=0;e<t.length;e++)v.users.forEach(function(i,o){i.id==t[e].value&&(i.isSelected=!1)}),v.businessFlag.principalUsers.forEach(function(i,o){i.userId==t[e].value&&(9==i.isMainUser&&(v.businessFlag.isSelMainPriUser=!1),v.businessFlag.principalUsers.splice(o,1))});v.initDealUserName(v.businessFlag.principalUsers)}},v.initDealUserName=function(t){if(t&&t.length>0){var e="请（";angular.forEach(t,function(t,i){i>0&&(e+=","),e+=t.userName}),e+=" )组织办理。",v.flow.dealOption=e}else v.flow.dealOption=""},v.checkNeedWP=function(t){var i=t.target,o=i.checked;o?v.businessFlag.isNeedWP=9:v.businessFlag.isFinishWP?d.confirm({title:"询问提示",message:"不做工作方案系统将会删除工作方案数据，确认不做工作方案么？",onOk:function(){$(".confirmDialog").modal("hide"),v.businessFlag.isNeedWP=0,e.removeWP(v)},onClose:function(){i.checked=!o,v.businessFlag.isNeedWP=9}}):v.businessFlag.isNeedWP=0},v.meetingDoc=function(){d.confirm({title:"",message:"如果之前已经生成会前准备材料，则本次生成的文档会覆盖之前产生的文档，确定执行操作么？",onOk:function(){e.meetingDoc(v,function(e){e.flag||"ok"==e.reCode?(d.success("操作成功"),t.findByMianId(v.model.signid,function(e){(e||e.length>0)&&(v.showFlag.tabSysFile=!0,v.sysFileList=e,t.initZtreeClient(v,c))})):d.alert(e.reMsg)})}})},v.commonDownloadSysFile=function(e){t.downloadFile(e)},v.createDispatchFileNum=function(){e.createDispatchFileNum(v.model.signid,v.dispatchDoc.id,function(t){(t.flag||"ok"==t.reCode)&&(v.dispatchDoc.fileNum=t.reObj),d.alert(t.reMsg)})},v.dispatchTemplate=function(){e.createDispatchTemplate(v)},v.watchPassDis=function(){c.$watch("vm.businessFlag.passDis",function(t,e){v.flow.dealOption=9==t?"通过":"不通过"})},v.affirmJoinExpert=function(){v.model.expertReviewDto&&v.model.expertReviewDto.expertSelectedDtoList?(v.confirmEPList=v.model.expertReviewDto.expertSelectedDtoList,$("#confirmJoinExpert").kendoWindow({width:"75%",height:"600px",title:"参加评审会专家确认",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()):d.alert("该项目没有评审专家！")},v.updateToJoin=function(){var t=$("#notJoinExpertTable input[name='notJoinExpert']:checked");if(t.length<1)d.alert("请选择要改为参加会议的专家");else{for(var e=[],i=0;i<t.length;i++)e.push(t[i].value);l.updateJoinState("","",e.join(","),"9",v.isCommit,function(t){v.reFleshJoinState(e,"9"),d.success("操作成功！")})}},v.updateToNotJoin=function(){var t=$("#joinExpertTable input[name='joinExpert']:checked");if(t.length<1)d.alert("请选择未参加会议的专家");else{for(var e=[],i=0;i<t.length;i++)e.push(t[i].value);l.updateJoinState("","",e.join(","),"0",v.isCommit,function(t){v.reFleshJoinState(e,"0"),d.success("操作成功！")})}},v.reFleshJoinState=function(t,e){$.each(t,function(t,i){$.each(v.confirmEPList,function(t,o){i==o.id&&(o.isJoin=e)})}),$.each(v.model.workProgramDtoList,function(t,e){l.refleshBusinessEP(e.id,function(t){e.expertDtoList=t})})},v.printpage=function(t){var i=$(t.target).attr("id");e.workProgramPrint(i)},v.reviewReportDoc=function(){d.confirm({title:"",message:"如果之前已经生成评审报告，则本次操作会覆盖之前生成的文档，确定执行操作么？",onOk:function(){e.createDispatchTemplate(v,function(e){e.flag||"ok"==e.reCode?d.success("操作成功！",function(){t.findByMianId(v.model.signid,function(e){(e||e.length>0)&&(v.showFlag.tabSysFile=!0,v.sysFileList=e,t.initZtreeClient(v,c))})}):d.alert(e.reMsg)})}})},v.templatePage=function(t){f.templatePage(t)}}angular.module("app").controller("signFlowDealCtrl",t),t.$inject=["sysfileSvc","signSvc","workprogramSvc","$state","flowSvc","signFlowSvc","ideaSvc","addRegisterFileSvc","expertReviewSvc","$scope","bsWin","financialManagerSvc","assistCostCountSvc","addCostSvc","templatePrintSvc","companySvc"]}(),function(){"use strict";function t(t,e,i,o,n,a,r){var s=this;s.title="项目流程信息",s.model={},s.flow={},s.work={},s.dispatchDoc={},s.fileRecord={},s.model.signid=i.params.signid,s.flow.taskId=i.params.taskId,s.flow.processInstanceId=i.params.processInstanceId,s.showFlag={tabWorkProgram:!1,tabBaseWP:!1,tabDispatch:!1,tabFilerecord:!1,tabExpert:!1,tabSysFile:!1,tabAssociateSigns:!1},s.businessFlag={expertReviews:[]},s.expertList=new Array(10),function(){$("#myTab li").click(function(t){var e=$("a",this);t.preventDefault(),e.tab("show");var i=e.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500),s.model.showDiv=i}),o.initFlowData(s),e.initFlowPageData(s.model.signid,function(t){s.model=t;var e=$("#myTab .active"),i=$("a",e);if(s.model.showDiv=i.attr("for-div"),s.model.dispatchDocDto&&(s.showFlag.tabDispatch=!0,s.dispatchDoc=s.model.dispatchDocDto,2==s.dispatchDoc.dispatchWay&&0==s.dispatchDoc.isMainProject||s.dispatchDoc.fileNum?s.businessFlag.isCreateDisFileNum=!0:s.showFlag.buttDisFileNum=!0),s.model.fileRecordDto&&(s.showFlag.tabFilerecord=!0,s.fileRecord=s.model.fileRecordDto),s.model.workProgramDtoList&&s.model.workProgramDtoList.length>0){var o;""!=(o="1"==s.model.workProgramDtoList[0].branchId||"1"==s.model.workProgramDtoList[0].branchId?s.model.workProgramDtoList[0].reviewOrgName:s.model.workProgramDtoList[0].mainWorkProgramDto.reviewOrgName)&&o.split(",").length>1&&(s.showTotalInvestment=!0)}s.model.processState>1&&(s.showFlag.tabWorkProgram=!0),s.model.suppLetterDtoList&&(s.showSupperIndex=0),void 0!=s.model.registerFileDtoDtoList&&(s.supply=[],s.registerFile=[],s.drawingFile=[],s.otherFile=[],s.model.registerFileDtoDtoList.forEach(function(t,e){3==t.businessType?s.supply.push(t):2==t.businessType?s.drawingFile.push(t):1==t.businessType||4==t.businessType?s.registerFile.push(t):5!=t.businessType&&6!=t.businessType&&7!=t.businessType||s.otherFile.push(t)}))}),t.findByMianId(s.model.signid,function(e){e&&e.length>0&&(s.showFlag.tabSysFile=!0,s.sysFileList=e,t.initZtreeClient(s,a))})}(),s.commonDownloadSysFile=function(e){t.downloadFile(e)},s.templatePage=function(t){r.templatePage(t)}}angular.module("app").controller("signFlowDetailCtrl",t),t.$inject=["sysfileSvc","signSvc","$state","flowSvc","signFlowSvc","$scope","templatePrintSvc"]}(),function(){"use strict";function t(t,e,i,o){var n=this;n.model={},n.title="新增预签收收文",n.reserveAdd=function(){common.initJqValidation($("#reserveform")),$("#reserveform").valid()?e.reserveAdd(n.model,function(t){t.flag||"ok"==t.reCode?o.success("操作成功，请继续填写项目审核登记表",function(){i.go("fillSign",{signid:t.reObj.signid},{reload:!0})}):o.error(t.reMsg)}):o.alert("操作失败，有红色*号的选项为必填项，请按要求填写！")}}angular.module("app").controller("signReserveAddCtrl",t),t.$inject=["$location","reserveSignSvc","$state","bsWin"]}(),function(){"use strict";function t(t,e,i,o,n,a,r){var s=this;s.model={},s.title="预签收列表",s.stateName=i.current.name,s.queryParams={},s.saveView=function(){o.storeView(s.stateName,{gridParams:s.gridOptions.dataSource.transport.options.read.data(),queryParams:s.queryParams,data:s})},s.querySign=function(){s.gridOptions.dataSource._skip=0,s.gridOptions.dataSource.read()},s.del=function(t){a.confirm({title:"询问提示",message:"确认删除该条项目数据吗？",onOk:function(){n.deleteSign(t,function(t){t.flag||"ok"==t.reCode?a.alert("删除成功！",function(){s.gridOptions.dataSource.read()}):a.alert(t.reMsg)})}})},s.realSign=function(t){a.confirm({title:"询问提示",message:"确认正式签收了么？",onOk:function(){n.realSign(t,function(t){t.flag||"ok"==t.reCode?a.success("操作成功！",function(){s.gridOptions.dataSource.read()}):a.error(t.reMsg)})}})},s.startNewFlow=function(t){a.confirm({title:"询问提示",message:"确认已经完成填写，并且发起流程么？",onOk:function(){$(".confirmDialog").modal("hide"),r.startFlow(t,function(t){t.flag||"ok"==t.reCode?a.success("操作成功！",function(){s.gridOptions.dataSource.read()}):a.error(t.reMsg)})}})},function(){if(o.view[s.stateName]){var t=o.view[s.stateName];t.gridParams&&(s.gridParams=t.gridParams),t.data&&(s.model=t.data.model),t.queryParams&&(s.queryParams=t.queryParams),e.grid(s),o.view[s.stateName]=void 0}else e.grid(s)}()}angular.module("app").controller("signReserveCtrl",t),t.$inject=["$location","reserveSignSvc","$state","$rootScope","signSvc","bsWin","signFlowSvc"]}(),function(){"use strict";function t(t,e){function i(e,i){var o={method:"post",url:rootPath+"/sign/html/reserveAddPost",data:e},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function o(e,i){e.isSubmit=!0;var o={method:"delete",url:r+"/deleteReserve",params:{signid:i}},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.isSubmit=!1,e.gridOptions.dataSource.read()}})};common.http({vm:e,$http:t,httpOptions:o,success:n})}function n(e){var i={method:"get",url:r+"/html/findByIdsign",params:{id:e.id}},o=function(t){e.model=t.data};common.http({vm:e,$http:t,httpOptions:i,success:o})}function a(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(r+"/reserveListSign",$("#reserveFrom"),t.gridParams),schema:{data:"value",total:function(t){return t.count?$("#GET_RESERVESIGN_COUNT").html(t.count):$("#GET_RESERVESIGN_COUNT").html(0),t.count},model:{id:"signid"}},serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:t.queryParams.pageSize||10,page:t.queryParams.page||1,sort:{field:"createdDate",dir:"desc"}}),i=[{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"projectname",title:"项目名称",width:280,filterable:!1},{field:"filecode",title:"收文编号",width:120,filterable:!1},{field:"designcompanyName",title:"项目单位",width:220,filterable:!1},{field:"reviewstage",title:"项目阶段",width:130,filterable:!1},{field:"projectcode",title:"项目代码",width:120,filterable:!1},{field:"receivedate",title:"收文日期",width:160,filterable:!1,format:"{0:yyyy-MM-dd HH:mm:ss}"},{field:"",title:"操作",width:320,template:function(t){var e=!1;t.processInstanceId&&(e=!0);var i=!1;return!t.issign||9!=t.issign&&"9"!=t.issign||(i=!0),common.format($("#columnBtns").html(),t.signid,e,t.signid+"/"+t.processInstanceId,"vm.del('"+t.signid+"')","vm.startNewFlow('"+t.signid+"')","vm.realSign('"+t.signid+"')",i)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig(t.queryParams).pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:common.kendoGridConfig(t.queryParams).dataBound,resizable:!0}}var r=rootPath+"/sign";return{grid:a,getsignById:n,reserveAdd:i,deleteReserveSign:o}}angular.module("app").factory("reserveSignSvc",t),t.$inject=["$http","$state"]}(),function(){"use strict";function t(t,e,i,o,n,a,r){var s=this;s.model={},s.flow={},s.model.signid=i.params.signid,s.flow.processInstanceId=i.params.processInstanceId,s.showFlag={tabWorkProgram:!1,tabBaseWP:!1,tabDispatch:!1,tabFilerecord:!1,tabExpert:!1,tabSysFile:!1,tabAssociateSigns:!1},s.businessFlag={expertReviews:[]},s.expertList=new Array(15),function(){$("#myTab li").click(function(t){var e=$("a",this);t.preventDefault(),e.tab("show");var i=e.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500),s.model.showDiv=i}),i.params.processInstanceId&&o.initFlowData(s),e.initFlowPageData(s.model.signid,function(t){s.model=t;var e=$("#myTab .active"),i=$("a",e);if(s.model.showDiv=i.attr("for-div"),s.model.dispatchDocDto&&(s.showFlag.tabDispatch=!0,s.dispatchDoc=s.model.dispatchDocDto,r.findAssistPlanSignById(s.model.signid,function(t){s.assistPlanSign=t})),s.model.workProgramDtoList&&s.model.workProgramDtoList.length>0){var o;""!=(o="1"==s.model.workProgramDtoList[0].branchId||"1"==s.model.workProgramDtoList[0].branchId?s.model.workProgramDtoList[0].reviewOrgName:s.model.workProgramDtoList[0].mainWorkProgramDto.reviewOrgName)&&o.split(",").length>1&&(s.showTotalInvestment=!0)}s.model.fileRecordDto&&(s.showFlag.tabFilerecord=!0,s.fileRecord=s.model.fileRecordDto),s.model.processState>1&&(s.showFlag.tabWorkProgram=!0),s.model.suppLetterDtoList&&(s.showSupperIndex=0),void 0!=s.model.registerFileDtoDtoList&&(s.supply=[],s.registerFile=[],s.drawingFile=[],s.otherFile=[],s.model.registerFileDtoDtoList.forEach(function(t,e){3==t.businessType?s.supply.push(t):2==t.businessType?s.drawingFile.push(t):1==t.businessType||4==t.businessType?s.registerFile.push(t):5!=t.businessType&&6!=t.businessType&&7!=t.businessType||s.otherFile.push(t)}))}),t.findByMianId(s.model.signid,function(e){e&&e.length>0&&(s.showFlag.tabSysFile=!0,s.sysFileList=e,t.initZtreeClient(s,n))})}(),s.templatePage=function(t){a.templatePage(t)},s.commonDownloadSysFile=function(e){t.downloadFile(e)}}angular.module("app").controller("signDetailsCtrl",t),t.$inject=["sysfileSvc","signSvc","$state","flowSvc","$scope","templatePrintSvc","assistSvc"]}();!function(){"use strict";function t(t,e,i,o,n){function a(e,i){var o={method:"post",url:rootPath+"/signwork/fingSignWorkById",params:{signId:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function r(t){var e=$("#countSignDayForm");e.attr("target",""),e.attr("method","post"),e.attr("action",rootPath+"/signView/excelExport"),e.find("input[name='signIds']").val(t),e.submit()}function s(e,i){var o={method:"post",url:rootPath+"/sign/sumExistDays",params:{signIds:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function l(e,i){var o={method:"post",url:rootPath+"/dispatch/createDispatchTemplate",params:{signId:e.model.signid}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function c(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/sign/findBySignUser",$("#searchform"),t.gridParams),schema:{data:"value",total:function(t){return t.count?$("#GET_SIGN_COUNT").html(t.count):$("#GET_SIGN_COUNT").html(0),t.count},model:{id:"signid"}},serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:t.queryParams.pageSize||10,page:t.queryParams.page||1,sort:{field:"createdDate",dir:"desc"}}),i=[{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"",title:"项目名称",width:280,filterable:!1,template:function(t){return'<a ng-click="vm.saveView()"  href="#/signDetails/'+t.signid+"/"+t.processInstanceId+'" >'+t.projectname+"</a>"}},{field:"filecode",title:"收文编号",width:120,filterable:!1},{field:"designcompanyName",title:"项目单位",width:260,filterable:!1},{field:"reviewstage",title:"评审阶段",width:130,filterable:!1},{field:"projectcode",title:"项目代码",width:160,filterable:!1},{field:"signdate",title:"签收日期",width:100,filterable:!1,format:"{0:yyyy-MM-dd HH:mm:ss}"},{field:"",title:"流程状态",width:80,filterable:!1,template:function(t){return t.signState?1==t.signState?'<span style="color:green;">进行中</span>':2==t.signState?'<span style="color:orange;">已暂停</span>':8==t.signState?'<span style="color:red;">强制结束</span>':9==t.signState?'<span style="color:blue;">已完成</span>':5==t.signState?"未发起":"":"未发起"}},{field:"",title:"操作",width:320,template:function(t){var e=!1;t.processInstanceId&&(e=!0);var i=!1;return!t.issign||9!=t.issign&&"9"!=t.issign||(i=!0),common.format($("#columnBtns").html(),t.signid,e,t.signid+"/"+t.processInstanceId,"vm.del('"+t.signid+"')",e,"vm.startNewFlow('"+t.signid+"')",e,"vm.realSign('"+t.signid+"')",i)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,pageable:common.kendoGridConfig(t.queryParams).pageable,dataBound:common.kendoGridConfig(t.queryParams).dataBound,resizable:!0}}function d(e,i){var o={method:"post",url:rootPath+"/sign",data:e},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function u(e,i){var o={method:"post",url:rootPath+"/officeUser/findOfficeUsersByDeptName",data:e},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function m(e,i){var o={method:"put",url:rootPath+"/sign",data:e},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function p(e,i){var o={method:"delete",url:rootPath+"/sign",params:{signid:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function f(e,i){var o={method:"post",url:rootPath+"/sign/html/initFillPageData",params:{signid:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function h(e,i){var o={method:"get",url:rootPath+"/sign/html/initDetailPageData",params:{signid:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function g(e,i){var o={method:"get",url:rootPath+"/sign/initFlowPageData",params:{signid:e,queryAll:!0}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function v(e){var o={method:"delete",url:rootPath+"/workprogram/deleteBySignId",params:{signId:e.model.signid}},n=function(t){e.isSubmit=!1,t.data.flag||"ok"==t.data.reCode?(e.businessFlag.isFinishWP=!1,i.success("操作成功！")):i.error(t.data.reMsg)};common.http({vm:e,$http:t,httpOptions:o,success:n})}function y(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/sign/fingByOData",$("#searchAssociateform"),{filter:"isAssociate eq 0"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{field:"projectname",title:"项目名称",width:160,filterable:!1},{field:"projectcode",title:"收文编号",width:140,filterable:!1},{field:"designcompanyName",title:"项目单位",width:200,filterable:!1},{field:"reviewstage",title:"项目阶段",width:160,filterable:!1},{field:"projectcode",title:"项目代码",width:140,filterable:!1}];t.associateGridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0}}function w(e,i){var o={method:"post",url:rootPath+"/sign/findAssociateSign",data:e},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function b(e,i,o){i="undefined"==i?null:i;var n={method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},url:rootPath+"/sign/associate",data:$.param({signId:e,associateId:i},!0)},a=function(t){void 0!=o&&"function"==typeof o&&o()};common.http({$http:t,httpOptions:n,success:a})}function S(e,i){var o={method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded"},url:rootPath+"/sign/associate?signId="+i},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){if(void 0!=t.data){e.associateSign=t.data;for(var i=t.data,o="",n=i.length-1;n>=0;n--){var a=i[n],r=a.signdate||"";o+='<div class="intro-list"><div class="intro-list-left">项目阶段：'+a.reviewstage+"<br/>签收时间："+r+'</div><div class="intro-list-right"><span></span><div class="intro-list-content">名称：<span style="color:red;">'+a.projectname+'</span><br/>送件人：<span style="color:red;">'+a.sendusersign+"</span><br/></div></div></div>"}$("#introFlow").html(o);$("#myStep").step({animate:!0,initStep:1,speed:1e3})}}})};common.http({vm:e,$http:t,httpOptions:o,success:n})}function k(e,i){var o={method:"get",url:rootPath+"/workprogram/createMeetingDoc",params:{signId:e.model.signid}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({vm:e,$http:t,httpOptions:o,success:n})}function C(e,i,o){var n={method:"post",url:rootPath+"/dispatch/createFileNum",params:{signId:e,dispatchId:i}},a=function(t){void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:t,httpOptions:n,success:a})}function P(e,i){var o={method:"post",url:rootPath+"/sign/realSign",params:{signid:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function D(t){var e=common.kendoGridDataSource(rootPath+"/sign/fingByGetBack",$("#signBackform"),t.queryParams.page,t.queryParams.pageSize,t.gridParams),i=[{field:"",title:"序号",template:"<span class='row-number'></span>",width:50},{field:"projectName",title:"项目名称",width:"25%",filterable:!1},{field:"nodeNameValue",title:"当前环节",width:"10",filterable:!1},{field:"displayName",title:"处理人",width:"10",filterable:!1},{field:"",title:"合并评审",width:"15%",filterable:!1,template:function(t){return t.reviewType?9==t.reviewType||"9"==t.reviewType?"合并评审[主项目]":"合并评审[次项目]":"否"}},{field:"reviewStage",title:"项目阶段",width:"15%",filterable:!1},{field:"signDate",title:"签收时间",width:"10%",filterable:!1},{field:"",title:"操作",width:"10%",template:function(t){return common.format($("#columnBtns").html(),"signFlowDetail",t.businessKey,t.taskId,t.processInstanceId,"vm.getBack")}}];t.signGetBackGrid={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,pageable:common.kendoGridConfig(t.queryParams).pageable,dataBound:common.kendoGridConfig(t.queryParams).dataBound,resizable:!0}}function I(e,i,o){var n={method:"post",url:rootPath+"/sign/getBack",params:{taskId:e,businessKey:i}},a=function(t){void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:t,httpOptions:n,success:a})}function x(t){"项目建议书"==t.model.reviewstage||"可行性研究报告"==t.model.reviewstage||"其它"==t.model.reviewstage?n.templatePrint("sign_fill_xmjys_templ"):"资金申请报告"==t.model.reviewstage?n.templatePrint("sign_fill_zjsq_templ"):"进口设备"==t.model.reviewstage?n.templatePrint("sign_fill_jksb_templ"):"设备清单（国产）"==t.model.reviewstage||"设备清单（进口）"==t.model.reviewstage?n.templatePrint("sign_fill_sbqd_templ"):"项目概算"==t.model.reviewstage&&n.templatePrint("sign_fill_xmgs_templ")}function F(t){var e=common.kendoGridDataSource(rootPath+"/signView/getSignList?$orderby=receivedate",$("#deletform"),t.queryParams.page,t.queryParams.pageSize,t.gridParams),i=[{field:"",title:"序号",template:"<span class='row-number text-center'></span>",width:40},{field:"",title:"项目名称",width:160,filterable:!1,template:function(t){return t.processInstanceId?'<a ng-click="vm.saveView()" href="#/signDetails/'+t.signid+"/"+t.processInstanceId+'" >'+t.projectname+"</a>":'<a ng-click="vm.saveView()" href="#/signDetails/'+t.signid+'/" >'+t.projectname+"</a>"}},{field:"reviewstage",title:"项目阶段",width:110,filterable:!1},{field:"projectcode",title:"项目代码",width:100,filterable:!1},{field:"signdate",title:"签收日期",width:100,filterable:!1,format:"{0:yyyy/MM/dd HH:mm:ss}"},{field:"",title:"操作",width:90,filterable:!1,template:function(t){return common.format($("#columnBtns").html(),"vm.editSignState('"+t.signid+"')")}}];t.signListOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,pageable:common.kendoGridConfig(t.queryParams).pageable,dataBound:common.kendoGridConfig(t.queryParams).dataBound}}function O(e,i){var o={method:"post",url:rootPath+"/sign/editSignState",params:{signId:e.signid,stateProperty:"signState",stateValue:e.stateValue}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function T(t){var e=common.kendoGridDataSource(rootPath+"/signView/getSignList?$orderby=receivedate",$("#Maintenanform"),t.queryParams.page,t.queryParams.pageSize,t.gridParams),i=[{field:"",title:"序号",template:"<span class='row-number text-center'></span>",width:50},{field:"",title:"项目名称",width:260,filterable:!1,template:function(t){return t.processInstanceId?'<a ng-click="vm.saveView()" href="#/MaintainProjectEdit/'+t.signid+"/"+t.processInstanceId+'" >'+t.projectname+"</a>":'<a ng-click="vm.saveView()" href="#/MaintainProjectEdit/'+t.signid+'/" >'+t.projectname+"</a>"}},{field:"builtcompanyname",title:"建设单位",width:210,filterable:!1},{field:"reviewstage",title:"评审阶段",width:120,filterable:!1},{field:"",title:"项目状态",width:80,filterable:!1,template:function(t){var e="";switch(t.signState){case"1":e="进行中";break;case"2":e="暂停";break;case"8":e="强制结束";break;case"9":e="已完成"}return e}},{field:"signNum",title:"收文编号",width:100,filterable:!1},{field:"signdate",title:"收文日期",width:100,filterable:!1},{field:"dfilenum",title:"发文号",width:100,filterable:!1},{field:"ffilenum",title:"归档编号",width:130,filterable:!1},{field:"reviewOrgName",title:"所属部门",width:100,filterable:!1},{field:"allPriUser",title:"项目负责人",width:100,filterable:!1},{field:"dispatchType",title:"发文类型",width:100,filterable:!1},{field:"appalyInvestment",title:"申报金额",width:100,filterable:!1},{field:"authorizeValue",title:"审定金额",width:100,filterable:!1},{field:"extraValue",title:"核减",width:100,filterable:!1},{field:"approveValue",title:"批复金额",width:100,filterable:!1}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,pageable:common.kendoGridConfig(t.queryParams).pageable,dataBound:common.kendoGridConfig(t.queryParams).dataBound}}return{signGrid:c,createSign:d,initFillData:f,initDetailData:h,updateFillin:m,deleteSign:p,findOfficeUsersByDeptName:u,initFlowPageData:g,removeWP:v,associateGrid:y,getAssociateSign:w,saveAssociateSign:b,initAssociateSigns:S,meetingDoc:k,createDispatchFileNum:C,realSign:P,createDispatchTemplate:l,signGetBackGrid:D,getBack:I,editTemplatePrint:x,signDeletGrid:F,editSignState:O,sumExistDays:s,MaintenanProjectGrid:T,excelExport:r,findExpertReview:a}}angular.module("app").factory("signSvc",t),t.$inject=["$http","$state","bsWin","sysfileSvc","templatePrintSvc"]}(),function(){"use strict";function t(t,e){function i(){t.findByTime(o,function(t){if(t.flag||"ok"==t.reCode){var i=t.reObj;if(void 0!=i&&i.length>0){for(var n=0;n<o.review.length;n++)for(var a=0;a<i.length;a++)$.each(i[a],function(t,e){t==o.review[n]&&(o.reviewStage.push(t),o.appalyinvestment.push(e[0]),o.authorizeValue.push(e[1]),o.projectCount.push(e[2]))});o.resultData.push(o.appalyinvestment,o.authorizeValue),o.gotoHistogram()}}else e.error(t.reMsg)})}var o=this;o.startTime=(new Date).halfYearAgo(),o.endTime=(new Date).Format("yyyy-MM-dd"),o.chartType="histogram",o.reviewStage=[],o.appalyinvestment=[],o.authorizeValue=[],o.sz=[],o.fj=[],o.xx=[],o.sb=[],o.qt=[],o.series=[],o.resultData=[],o.projectCount=[],o.tooltipFormater=[],o.capital=["申报金额","审定金额"],o.projectType=["市政工程","房建工程","信息工程","设备采购","其他"],o.stage=["3000万以下","3000万-1亿","1亿-10亿","10亿以上"],o.review=["项目概算","项目建议书","进口设备","资金申请报告","设备清单（进口）","设备清单（国产）","可行性研究报告","其它"],o.resetChart=function(){o.reviewStage=[],o.appalyinvestment=[],o.authorizeValue=[],o.sz=[],o.fj=[],o.xx=[],o.sb=[],o.qt=[],o.series=[],o.resultData=[],o.projectCount=[],o.tooltipFormater=[];var t=$("input[type='radio']:checked").val();"lineChart"==t?o.gotoLineChart():"histogram"==t?i():"pie"==t&&o.gotoPie()},o.gotoHistogram=function(){o.showHistogram=!0,o.showLineChart=!1,o.showPie=!1;for(var t=0;t<o.capital.length;t++)o.series.push({name:o.capital[t],type:"bar",data:o.resultData[t],barWidth:30,itemStyle:{normal:{label:{show:!0,position:"top",formatter:function(t){return t.value}}}}});o.initHistogram()},o.gotoLineChart=function(){o.showHistogram=!1,o.showPie=!1,o.showLineChart=!0,t.findByTypeAndReview(o,function(t){if(t.flag||"ok"==t.reCode){var i=t.reObj;if(void 0!=i&&i.length>0){for(var n=0;n<i.length;n++)$.each(i[n],function(t,e){o.reviewStage.push(t),o.sz.push(e[0]),o.fj.push(e[1]),o.xx.push(e[2]),o.sb.push(e[3]),o.qt.push(e[4])});o.resultData.push(o.sz,o.fj,o.xx,o.sb,o.qt);for(var n=0;n<o.projectType.length;n++)o.series.push({name:o.projectType[n],type:"line",data:o.resultData[n],itemStyle:{normal:{label:{show:!0,position:"top",textStyle:{fontWeight:"normal",fontSize:15},formatter:function(t){return t.value}}}}})}o.initLineChart()}else e.error(t.reMsg)})},o.gotoPie=function(){o.showHistogram=!1,o.showLineChart=!1,o.showPie=!0,t.pieData(o,function(t){if(t.flag||"ok"==t.reCode){var i=t.reObj;if(void 0!=i&&null!=i){if(void 0!=i[1]&&i[1].length>0)for(var n=0;n<i[1].length;n++)o.series.push({value:i[1][n],name:o.stage[n],label:{normal:{formatter:" {b} : {c}%",textStyle:{fontWeight:"normal",fontSize:15}}}}),o.tooltipFormater.push({seriesName:"项目数",totalName:"项目总数",totalValue:i[2],name:o.stage[n],pidName:"占百分比",data:i[0][n],value:i[1][n]});o.initPie()}else e.error("该时间段没有数据！")}else e.error(t.reMsg)})},o.initHistogram=function(){var t=echarts.init(document.getElementById("histogram")),e={title:{text:"申报金额与审定金额统计情况",subtext:"按评审阶段划分",x:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#283b56"}}},legend:{orient:"vertical",left:"left",data:o.capital},toolbox:{show:!0,x:"80%",feature:{dataView:{show:!0,readOnly:!0},restore:{show:!0},saveAsImage:{show:!0}},optionToContent:function(t){var e=t.xAxis[0].data,i=t.series,o='<table id="test" class="table-bordered table-striped" style="width:100%;text-align:center">';o+="<tbody><tr>",o+='<th style="text-align: center;">评审阶段</th>';for(var n=0;n<i.length;n++)o+='<th style="text-align: center;">'+i[n].name+"(亿元)</th>";o+="</tr>";for(var n=0,a=e.length;n<a;n++){o+="<tr><td>"+e[n]+"</td>";for(var r=0;r<i.length;r++)o+="<td>"+i[r].data[n]+"</td>"}return o+="</tbody>"}},grid:{left:"13%",right:"10%",bottom:"10%",containLabel:!0},xAxis:{type:"category",name:"评审阶段",data:o.review,axisTick:{alignWithLabel:!0},axisLabel:{interval:0,rotate:35,margin:2,textStyle:{fontWeight:"bolder",color:"#295645"}}},yAxis:{type:"value",name:"金额（亿元）",min:0},series:o.series,itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0,0,0,0.5)"}}};t.setOption(e)},o.initLineChart=function(){var t=echarts.init(document.getElementById("lineChart")),e={title:{text:"评审项目类别统计情况",subtext:"按评审阶段划分",x:"center"},tooltip:{trigger:"item",formatter:"{a} <br/> {b} : {c}"},grid:{left:"13%",right:"10%",bottom:"10%",containLabel:!0},toolbox:{show:!0,x:"80%",feature:{dataView:{show:!0,readOnly:!0},restore:{show:!0},saveAsImage:{show:!0}},optionToContent:function(t){var e=t.xAxis[0].data,i=t.series,o='<table id="test" class="table-bordered table-striped" style="width:100%;text-align:center">';o+="<tbody><tr>",o+='<th style="text-align: center;">评审阶段</th>';for(var n=0;n<i.length;n++)o+='<th style="text-align: center;">'+i[n].name+"</th>";o+="</tr>";for(var n=0,a=e.length;n<a;n++){o+="<tr><td>"+e[n]+"</td>"
;for(var r=0;r<i.length;r++)o+="<td>"+i[r].data[n]+"</td>"}return o+="</tbody>"}},legend:{orient:"vertical",left:"left",data:o.projectType},xAxis:{type:"category",name:"评审阶段",splitLine:{show:!1},data:o.review,axisLabel:{interval:0,rotate:35,margin:2,textStyle:{fontWeight:"bolder",color:"#295645"}}},yAxis:{type:"value",name:"项目个数",min:0},series:o.series,lineStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0,0,0,0.5)"}}};t.setOption(e)},o.initPie=function(){var t=echarts.init(document.getElementById("pie")),e={title:{text:"评审项目比例情况",subtext:"按申报金额范围划分",x:"center"},tooltip:{trigger:"item",width:150,formatter:function(t){for(var e=0;e<o.tooltipFormater.length;e++)if(o.tooltipFormater[e].name==t.name)return t.name+"<br/>"+o.tooltipFormater[e].seriesName+" : "+o.tooltipFormater[e].data+"<br/>"+o.tooltipFormater[e].totalName+" : "+o.tooltipFormater[e].totalValue+"<br/>"+o.tooltipFormater[e].pidName+" : "+o.tooltipFormater[e].value+"%"}},grid:{left:"10%",right:"10%",bottom:"10%",containLabel:!0},toolbox:{show:!0,x:"80%",feature:{dataView:{show:!0,readOnly:!0},restore:{show:!0},saveAsImage:{show:!0}},optionToContent:function(t){var e=t.series[0].data,i='<table id="test" class="table-bordered table-striped" style="width:100%;text-align:center">';i+="<tbody><tr>",i+='<th style="text-align: center;">申报金额范围</th>',i+='<th style="text-align: center;">占百分比(%)</th>',i+="</tr>";for(var o=0,n=e.length;o<n;o++)i+="<tr><td>"+e[o].name+"</td>",i+="<td>"+e[o].value+"</td>";return i+="</tbody>"}},legend:{orient:"vertical",left:"left",data:o.stage},series:[{type:"pie",radius:"30%",center:["50%","50%"],selectMode:"single",data:o.series,itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0,0,0,0.5)"}}}]};t.setOption(e)},i()}angular.module("app").controller("signChartCtrl",t),t.$inject=["signChartSvc","bsWin"]}(),function(){"use strict";function t(t){function e(e){var i={method:"post",url:rootPath+"/signView/getDate"},o=function(t){void 0!=e&&"function"==typeof e&&e(t.data)};common.http({httpOptions:i,$http:t,success:o})}function i(e,i){var o={method:"post",url:rootPath+"/signView/findByTime",params:{startTime:e.startTime,endTime:e.endTime}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({vm:e,httpOptions:o,$http:t,success:n})}function o(e,i){var o={method:"post",url:rootPath+"/signView/pieDate",params:{startTime:e.startTime,endTime:e.endTime}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({vm:e,httpOptions:o,$http:t,success:n})}function n(e,i){var o={method:"post",url:rootPath+"/signView/findByTypeAndReview",params:{startTime:e.startTime,endTime:e.endTime}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({vm:e,httpOptions:o,$http:t,success:n})}return{findByTime:i,pieData:o,findByTypeAndReview:n,getDate:e}}angular.module("app").factory("signChartSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e,i,o,n,a,r){var s=this;s.title="作废项目列表",s.stateName=n.current.name,s.queryParams={},s.saveView=function(){a.storeView(s.stateName,{gridParams:s.signListOptions.dataSource.transport.options.read.data(),queryParams:s.queryParams,data:s})},s.query=function(){s.signListOptions.dataSource._skip=0,s.signListOptions.dataSource.read()},s.editSignState=function(e){s.signid=e,r.getProjectStopBySignId(e,function(t){"9"==t[0].isactive&&"9"==t[0].isOverTime?s.stateValue="2":s.stateValue="1"}),o.confirm({title:"询问提示",message:"确认要恢复项目吗？",onOk:function(){t.editSignState(s,function(t){t.flag||"ok"==t.reCode?o.alert("恢复成功！",function(){s.signListOptions.dataSource.read()}):o.alert(t.reMsg)})}})},s.formReset=function(){var t=$("#deletform").find("input,select").not(":submit, :reset, :image, :disabled,:hidden");$.each(t,function(t,e){e.value=""})},function(){if(a.view[s.stateName]){var e=a.view[s.stateName];e.gridParams&&(s.gridParams=e.gridParams),e.data&&(s.project=e.data.project),e.queryParams&&(s.queryParams=e.queryParams),t.signDeletGrid(s),a.view[s.stateName]=void 0}else t.signDeletGrid(s)}()}angular.module("app").controller("signDeletCtrl",t),t.$inject=["signSvc","flowSvc","signFlowSvc","bsWin","$state","$rootScope","pauseProjectSvc"]}(),function(){"use strict";function t(t,e,i,o,n,a){var r=this;r.stateName=n.current.name,r.queryParams={},r.saveView=function(){a.storeView(r.stateName,{gridParams:r.signGetBackGrid.dataSource.transport.options.read.data(),queryParams:r.queryParams,data:r})},r.getBack=function(e,i){o.confirm({title:"询问提示",message:"确认取回吗？",onOk:function(){t.getBack(e,i,function(t){t.flag||"ok"==t.reCode?o.alert("取回项目成功",function(){r.signGetBackGrid.dataSource.read();var t=parseInt($("#DO_SIGN_COUNT").html());$("#DO_SIGN_COUNT").html(t+1)}):o.alert(t.reMsg)})}})},r.query=function(){r.signGetBackGrid.dataSource._skip=0,r.signGetBackGrid.dataSource.read()},function(){if(a.view[r.stateName]){var e=a.view[r.stateName];e.gridParams&&(r.gridParams=e.gridParams),e.data&&(r.model=e.data.model),e.queryParams&&(r.queryParams=e.queryParams),t.signGetBackGrid(r),a.view[r.stateName]=void 0}else t.signGetBackGrid(r)}()}angular.module("app").controller("signGetBackCtrl",t),t.$inject=["signSvc","flowSvc","signFlowSvc","bsWin","$state","$rootScope"]}(),function(){"use strict";function t(t,e,i,o,n,a){var r=this;r.title="维护项目列表",r.model={},r.model.signdatebigen=(new Date).oneMonthAgo(),r.model.signdateend=(new Date).Format("yyyy-MM-dd"),$("#signdatebigen").val(""),$("#signdateend").val(""),r.stateName=n.current.name,r.queryParams={},r.saveView=function(){a.storeView(r.stateName,{gridParams:r.gridOptions.dataSource.transport.options.read.data(),queryParams:r.queryParams,data:r})},r.query=function(){r.gridOptions.dataSource._skip=0,r.gridOptions.dataSource.read()},r.formReset=function(){var t=$("#deletform").find("input,select").not(":submit, :reset, :image, :disabled,:hidden");$.each(t,function(t,e){e.value=""})},function(){if(a.view[r.stateName]){var e=a.view[r.stateName];e.gridParams&&(r.gridParams=e.gridParams),e.data&&(r.model=e.data.model),e.queryParams&&(r.queryParams=e.queryParams),t.MaintenanProjectGrid(r),a.view[r.stateName]=void 0}else $("#signdatebigen").val(r.model.signdatebigen),$("#signdateend").val(r.model.signdateend),t.MaintenanProjectGrid(r)}()}angular.module("app").controller("MaintainProjectCtrl",t),t.$inject=["signSvc","flowSvc","signFlowSvc","bsWin","$state","$rootScope"]}(),function(){"use strict";function t(t,e,i,o,n,a,r,s){var l=this;l.title="维护项目修改",l.model={},l.model.signid=i.params.signid,l.model.processInstanceId=i.params.processInstanceId,l.signWorkList={},l.initFileUpload=function(){l.sysFile={businessId:l.model.signid,mainId:l.model.signid,mainType:a.mainTypeValue().SIGN,sysfileType:a.mainTypeValue().WORKPROGRAM,sysBusiType:a.mainTypeValue().WORKPROGRAM},a.initUploadOptions({inputId:"sysfileinput",vm:l,uploadSuccess:function(){a.findByMianId(l.model.signid,function(t){t&&t.length>0&&(l.isDisplay=!0,l.sysFileList=t,a.initZtreeClient(l,n))})}})},function(){$("#myTab li").click(function(t){var e=$("a",this);t.preventDefault(),e.tab("show");var i=e.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500),l.model.showDiv=i}),e.initFlowPageData(l.model.signid,function(t){if(l.model=t,l.dispatchDoc=l.model.dispatchDocDto,l.fileRecordDto=l.model.fileRecordDto,l.model.workProgramDtoList)for(var e=0;e<l.model.workProgramDtoList.length;e++)"1"==l.model.workProgramDtoList[e].branchId&&(l.work=l.model.workProgramDtoList[e],l.work.secondChargeUserName&&(l.secondChargeUserName=l.work.secondChargeUserName.split(",")));a.findByMianId(l.model.signid,function(t){t&&t.length>0&&(l.isDisplay=!0,l.sysFileList=t,a.initZtreeClient(l,n))})}),l.initFileUpload()}(),l.addRegisterFile=function(){i.go("registerFile",{businessId:l.model.signid})},l.addWorkProgram=function(){l.model.processInstanceId?l.model.workProgramDtoList?i.go("workprogramEdit",{signid:l.model.signid,isControl:!0}):s.alert("该项目还没有填写工作方案"):s.alert("该项目还没有发起流程")},l.addDisPatch=function(){l.model.processInstanceId?l.model.dispatchDocDto?l.model.isAssociate&&0!=l.model.isAssociate||signcommon.getReviewStage().STAGE_STUDY!=l.model.reviewstage&&signcommon.getReviewStage().STAGE_BUDGET!=l.model.reviewstage?i.go("dispatchEdit",{signid:l.model.signid,isControl:!0}):s.confirm({title:"询问提示",message:"该项目还没进行项目关联，是否需要进行关联设置？",onOk:function(){l.searchAssociateSign||(l.searchAssociateSign={signid:l.model.signid,projectname:l.model.projectname}),e.getAssociateSign(l.searchAssociateSign,function(t){l.associateSignList=[],t&&(l.associateSignList=t),$("#associateWindow").kendoWindow({width:"75%",height:"650px",title:"项目关联",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()})},onCancel:function(){i.go("dispatchEdit",{signid:l.model.signid,isControl:!0})}}):s.alert("该项目还没有填写发文"):s.alert("该项目还没有发起流程")},l.addDoFile=function(){l.model.processInstanceId?l.model.fileRecordDto?i.go("fileRecordEdit",{signid:l.model.signid,isControl:!0}):s.alert("该项目还没有填写归档"):s.alert("该项目还没有发起流程")},l.scrap=function(t){s.confirm({title:"询问提示",message:"确认作废该条项目吗？",onOk:function(){e.deleteSign(t,function(t){t.flag||"ok"==t.reCode?s.alert("操作成功！",function(){i.go("MaintainProjectList")}):s.alert(t.reMsg)})}})},l.pauseProject=function(){t.findPausingProject(l,l.model.signid)},l.addSuppLetter=function(){i.go("addSupp",{businessId:l.model.signid,businessType:"SIGN",isControl:!0})},l.relation=function(){l.searchAssociateSign||(l.searchAssociateSign={signid:l.model.signid,projectname:l.model.projectname}),e.getAssociateSign(l.searchAssociateSign,function(t){l.associateSignList=[],t&&(l.associateSignList=t),$("#associateWindow").kendoWindow({width:"75%",height:"650px",title:"项目关联",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()})},l.findExpertReview=function(t,i){9==i?s.alert("该项目已归档，不能再修改！"):(l.signWorkList={},e.findExpertReview(t,function(t){(t||t.length>0)&&(l.signWorkList=t,$("#signWorkDiv").kendoWindow({width:"860px",height:"320px",title:"抽取专家维护",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open())}))},l.colseOpenWin=function(){window.parent.$("#signWorkDiv").data("kendoWindow").close()},l.commonDownloadSysFile=function(t){a.downloadFile(t)},l.delFile=function(t){a.delSysFile(t,function(){s.alert("删除成功",function(){a.findByMianId(l.model.signid,function(t){t&&t.length>0&&(l.sysFileList=t,a.initZtreeClient(l,n))})})})}}angular.module("app").controller("MaintainProjectEditCtrl",t),t.$inject=["pauseProjectSvc","signSvc","$state","flowSvc","$scope","sysfileSvc","addRegisterFileSvc","bsWin"]}(),function(){"use strict";function t(){return n}function e(t){var e="";switch(t){case n.PD:e=a.ZHANG_YF;break;case n.GD:e=a.LI_J}return e}function i(t){var e="";switch(t){case n.PD:e="请张主任阅示。";break;case n.GD:e="请李主任阅示。"}return e}function o(){return r}var n={PX:"PX",GX:"GX"},a={ZHANG_YF:"张一帆",LI_J:"李军"},r={godispatch:"godispatch",principaluser:"principaluser",seconduser:"seconduser"},s={getBusinessType:t,getDefaultLeader:e,getDefaultZHBYJ:i,getFlowParams:o,getReviewStage:function(){return{STAGE_SUG:"项目建议书",STAGE_STUDY:"可行性研究报告",STAGE_BUDGET:"项目概算",APPLY_REPORT:"资金申请报告",OTHERS:"其它",DEVICE_BILL_HOMELAND:"设备清单（国产）",DEVICE_BILL_IMPORT:"设备清单（进口）",IMPORT_DEVICE:"进口设备"}}};window.signcommon=s}(),function(){"use strict";function t(t,e,i){function o(){e.queryList(n)}var n=this;n.model={},n.title="系统配置",o(),n.addConfig=function(){n.model={},n.model.isShow="9",$("#configdiv").kendoWindow({width:"760px",height:"500px",title:"系统参数编辑",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},n.closeWin=function(){window.parent.$("#configdiv").data("kendoWindow").close(),o()},n.doCommit=function(){common.initJqValidation(),$("#configForm").valid()&&e.saveConfig(n,function(t){t.flag||"ok"==t.reCode?(i.success("操作成功！"),window.parent.$("#configdiv").data("kendoWindow").close(),o()):i.error(t.reMsg)})},n.editConfig=function(t){n.configList.forEach(function(e,i){e.id==t&&(n.model=e)}),$("#configdiv").kendoWindow({width:"700px",height:"440px",title:"参数编辑",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()}}angular.module("app").controller("sysConfigCtrl",t),t.$inject=["$location","sysConfigSvc","bsWin"]}(),function(){"use strict";function t(t){function e(e){var i={method:"get",url:rootPath+"/sysConfig/queryList"},o=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.configList=new Array,e.configList=t.data}})};common.http({vm:e,$http:t,httpOptions:i,success:o})}function i(i,o){var n={method:"delete",url:rootPath+"/sysConfig",params:{id:o}},a=function(t){common.requestSuccess({vm:i,response:t,fn:function(){common.alert({vm:i,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),i.isSubmit=!1,e(i)}})}})};common.http({vm:i,$http:t,httpOptions:n,success:a})}function o(e,i){var o={method:"post",url:rootPath+"/sysConfig",data:e.model},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({vm:e,$http:t,httpOptions:o,success:n})}return{queryList:e,deleteConfig:i,saveConfig:o}}angular.module("app").factory("sysConfigSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t){var e=this;e.model={},e.title="部门小组列表",function(){t.listGrid(e.gridOptions)}()}angular.module("app").controller("sysdeptCtrl",t),t.$inject=["sysdeptSvc"]}(),function(){"use strict";function t(t){var e=this;e.model={},e.title="部门小组编辑",e.model.id=$state.params.id,e.model.id&&(e.isUpdate=!0,e.title="更新部门"),function(){e.isUpdate&&t.findById(e.model.id,function(t){e.model=t})}()}angular.module("app").controller("sysdeptEditCtrl",t),t.$inject=["sysdeptSvc"]}(),function(){"use strict";function t(t){function e(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/sysdept/fingByOData",$("#sysDeptForm")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})},o=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"name",title:"小组名称",width:160,filterable:!1},{field:"",title:"操作",width:200,template:function(t){return common.format($("#columnBtns").html(),"vm.del('"+t.id+"')",t.id)}}];common.gridDataSource(e),common.kendoGridConfig().filterable,common.kendoGridConfig().pageable,common.kendoGridConfig().noRecordMessage}function i(e,i){var o={method:"post",url:rootPath+"/sysdept/getSysDeptById",params:{id:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}return{listGrid:e,findById:i}}angular.module("app").factory("sysdeptSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e,i){var o=this;o.model={},o.model.signid=i.params.id,o.model.type=i.params.type,o.commonDownloadSysFile=function(t){e.downloadFile(t)},function(){e.queryFile(o.model.signid,o.model.type,function(t){t&&t.length>0&&(o.sysFileList=t)})}()}angular.module("app").controller("fileListCtrl",t),t.$inject=["$location","sysfileSvc","$state"]}(),function(){"use strict";function t(t,e){var i=this;i.title="系统安装包列表",function(){e.queryPluginfile(i)}()}angular.module("app").controller("pluginfileCtrl",t),t.$inject=["$location","sysfileSvc"]}(),function(){"use strict";function t(t,e,i,o){function n(){}function a(){return{SIGN:"项目附件",FILLSIGN:"审批登记",HUMAN:"人事附件",BOOKS:"图书附件",NOTICE:"通知公告",SHARE:"资料共享",MEETTINGROOM:"会议室预定",WORKPROGRAM:"工作方案",DISPATCH:"发文",DOFILE:"归档",MEETING:"会前准备材料",SUPPLEMENT:"补充函",STAGEMEETING:"评审会会议",FILELIBRARY:"质量管理文件库",POLICYLIBRARY:"政策标准库",TOPIC:"课题附件",TOPIC_PLAN:"课题计划书",TOPIC_WORKPLAN:"课题工作方案",TOPIC_FILING:"课题归档",MONTH_FILE:"月报简报",AADSUPP_FILE:"拟补充资料函"}}function r(i){var o={method:"post",url:rootPath+"/file/fileSysCheck",params:{sysFileId:i}},n=function(t){var o=$("#szecSysFileDownLoadForm");o.attr("target",""),o.attr("method","post"),t.data.flag||"ok"==t.data.reCode?(o.attr("action",rootPath+"/file/fileDownload"),o.find("input[name='sysfileId']").val(i),o.submit()):(o.attr("action",""),o.find("input[name='sysfileId']").val(""),e.error(t.data.reMsg))};common.http({$http:t,httpOptions:o,success:n})}function s(e,i){var o={method:"post",url:rootPath+"/file/findByBusinessId",params:{businessId:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function l(e,i){var o={method:"post",url:rootPath+"/file/findByMainId",params:{mainId:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function c(e,i,o){var n={method:"post",url:rootPath+"/file/queryFile",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},data:$.param({mainId:e,sysBusiType:i})},a=function(t){void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:t,httpOptions:n,success:a})}function d(i,o){var n={method:"delete",url:rootPath+"/file/deleteSysFile",params:{id:i}},a=function(t){t.data.flag||"ok"==t.data.reCode?void 0!=o&&"function"==typeof o&&o(t.data):e.alert(t.data.reMsg)};common.http({$http:t,httpOptions:n,success:a})}function u(t){t.vm.initUploadOptionSuccess=!1;var i={width:"70%",height:"460px",uploadBt:"upload_file_bt",detailBt:"detail_file_bt",inputId:"sysfileinput",mainType:"没有归类附件",sysBusiType:"",showBusiType:!0};if(!t.vm.sysFile)return void e.alert("初始化附件控件失败，请先定义附件对象！");if(t.sysBusiType&&(i.sysBusiType=t.sysBusiType),t.width&&(i.width=t.width),t.height&&(i.height=t.height),angular.isUndefined(t.vm.sysFile.showBusiType)&&(t.vm.sysFile.showBusiType=i.showBusiType),t.vm.downloadSysFile=function(t){r(t)},t.vm.delSysFile=function(i){d(i,function(o){e.alert(o.reMsg||"删除成功！"),$.each(t.vm.sysFilelists,function(e,o){angular.isUndefined(o)||o.sysFileId!=i||t.vm.sysFilelists.splice(e,1)})})},t.vm.clickUploadBt=function(){t.vm.sysFile.businessId?(t.vm.sysFile.sysBusiType="",angular.element("#sysfileinput").fileinput("clear"),$("#commonUploadWindow").kendoWindow({width:i.width,height:i.height,title:"附件上传",visible:!1,modal:!0,closable:!0}).data("kendoWindow").center().open()):e.alert("请先保存业务数据！")},t.vm.clickDetailBt=function(){if(!t.vm.sysFile.businessId)return void e.alert("请先保存业务数据！");s(t.vm.sysFile.businessId,function(e){t.vm.sysFilelists=[],t.vm.sysFilelists=e,$("#commonQueryWindow").kendoWindow({width:"75%",height:"500px",title:"附件上传列表",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()})},t.vm.sysFile.businessId){var o={language:"zh",allowedPreviewTypes:["image"],allowedFileExtensions:["sql","exe","lnk"],maxFileSize:0,showRemove:!1,previewFileIcon:"<i class='glyphicon glyphicon-king'></i>",uploadAsync:!1,enctype:"multipart/form-data",uploadUrl:rootPath+"/file/fileUpload",previewFileIconSettings:{doc:'<i class="fa fa-file-word-o text-primary"></i>',xls:'<i class="fa fa-file-excel-o text-success"></i>',ppt:'<i class="fa fa-file-powerpoint-o text-danger"></i>',docx:'<i class="fa fa-file-word-o text-primary"></i>',xlsx:'<i class="fa fa-file-excel-o text-success"></i>',pptx:'<i class="fa fa-file-powerpoint-o text-danger"></i>',pdf:'<i class="fa fa-file-pdf-o text-danger"></i>',zip:'<i class="fa fa-file-archive-o text-muted"></i>'},uploadExtraData:function(e,o){var n={};return n.businessId=t.vm.sysFile.businessId,n.mainId=t.vm.sysFile.mainId,n.mainType=t.vm.sysFile.mainType||i.mainType,n.sysfileType=t.vm.sysFile.sysfileType||"",n.sysBusiType=t.vm.sysFile.sysBusiType||i.sysBusiType,n}},n=0;$("#"+t.inputId||i.inputId).fileinput(o).on("filebatchselected",function(t,e){n=e.length}).on("filepreupload",function(t,e,i,o){e.form,e.files,e.extra,e.response,e.reader}).on("filebatchuploaderror",function(t,e,i){}).on("filebatchuploadsuccess",function(e,i,o,n){console.log("同步上传成功"),console.log(i),void 0!=t.uploadSuccess&&"function"==typeof t.uploadSuccess&&t.uploadSuccess(e,i,o,n)}),t.vm.initUploadOptionSuccess=!0}}function m(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/file/getPluginFile"),schema:common.kendoGridConfig().schema(),serverPaging:!1,serverSorting:!0,serverFiltering:!0,sort:{field:"createdDate",dir:"desc"}}),i=[{field:"fileName",title:"名称",filterable:!1},{field:"fileLength",title:"大小",width:160,filterable:!1},{field:"",title:"操作",width:150,template:function(t){return common.format($("#columnBtns").html(),rootPath+"/"+t.relativePath)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0}}function p(t,e){var i,n={check:{chkboxType:{Y:"ps",N:"ps"},enable:!1},callback:{onClick:function(i,o,n){0==n.check_Child_State&&(t.sysFileList=[],n.children&&(t.sysFileList=n.children),e.$apply())}}},a=t.sysFileList;t.zNodes=[],t.initFileTreeSucess=!1;for(var r=[],s=0,l=a.length;s<l;s++){a[s].sysBusiType||(a[s].sysBusiType="其他文件");var c=new Object;if(c=a[s],c.name=a[s].showName,c.id=a[s].sysFileId,r[a[s].sysBusiType])r[a[s].sysBusiType].push(c);else{var d=new Object;d.id=(new Date).getTime(),d.name=a[s].sysBusiType,t.zNodes.push(d);var u=[];u.push(c),r[a[s].sysBusiType]=u}}for(var s=0,l=t.zNodes.length;s<l;s++){for(var m in r)t.zNodes[s].name==m&&(t.zNodes[s].children=r[m]);s==l-1&&(t.initFileTreeSucess=!0)}e.$watch("vm.initFileTreeSucess",function(e,a){if(1==e)var r=o(function(){null!=document.getElementById("zTree")&&(i=$.fn.zTree.init($("#zTree"),n,t.zNodes),o.cancel(r))},500)})}return{initUploadOptions:u,delSysFile:d,downloadFile:r,queryPluginfile:m,findByMianId:l,findByBusinessId:s,mainTypeValue:a,previewFile:n,initZtreeClient:p,queryFile:c}}angular.module("app").factory("sysfileSvc",t),t.$inject=["$http","bsWin","$state","$interval"]}(),function(){"use strict";function t(t,e,i){function o(t){var e=getLodop(),i=rootPath+"/contents/shared/templatePrint.css",o="<link href="+i+" type='text/css' rel='stylesheet'>",n="<head>"+o+"</head><body>"+$("#"+t).html()+"</body>";e.PRINT_INIT(""),e.ADD_PRINT_HTML(10,20,"100%","100%",n),e.PREVIEW()}function n(){var t=navigator.userAgent;return console.log(t),t.indexOf("Opera")>-1?"Opera":t.indexOf("Firefox")>-1?"FF":t.indexOf("Chrome")>-1?"Chrome":t.indexOf("Safari")>-1?"Safari":window.ActiveXObject||"ActiveXObject"in window?"IE":void 0}function a(t){var e=getLodop(),i=rootPath+"/contents/shared/templatePrint.css",o="<link href="+i+" type='text/css' rel='stylesheet'>",n="<head>"+o+"</head><body>"+$("#"+t+"_templ1").html()+"</body>";if(e.PRINT_INIT(""),e.ADD_PRINT_HTML(10,20,"100%","100%",n),$("#"+t+"_templ2").html()){e.NewPage();var a="<head>"+o+"</head><body>"+$("#"+t+"_templ2").html()+"</body>";e.ADD_PRINT_HTML(50,20,"100%","100%",a)}if($("#"+t+"_templ3").html()){e.NewPage();var r="<head>"+o+"</head><body>"+$("#"+t+"_templ3").html()+"</body>";e.ADD_PRINT_HTML(50,20,"100%","100%",r)}e.PREVIEW()}return this.model={},{templatePrint:o,getBrowserType:n,templatePage:a}}angular.module("app").factory("templatePrintSvc",t),t.$inject=["$http","bsWin","$state"]}(),function(){"use strict";function t(t,e,i,o,n){var a=this;a.title="新增课题研究",a.model={},a.model.fgwlx=0,a.model.sendFgw=0,n.params.id&&(a.model.id=n.params.id),a.initFileUpload=function(){a.model.id||e.$watch("vm.model.id",function(t,e){t&&t!=e&&!a.initUploadOptionSuccess&&a.initFileUpload()}),a.sysFile={businessId:a.model.id,mainId:a.model.id,mainType:i.mainTypeValue().TOPIC,sysfileType:i.mainTypeValue().TOPIC_PLAN,sysBusiType:i.mainTypeValue().TOPIC_PLAN,showBusiType:!1},i.initUploadOptions({inputId:"sysfileinput",vm:a})},function(){a.model.id&&o.initDetail(a.model.id,function(t){a.model=t}),o.findOrgUser(function(t){a.principalUsers=t}),a.initFileUpload()}(),a.checkPrincipal=function(){var t=$("#mainPrinUserId").val();t&&$('#principalUser_ul input[selectType="assistUser"]').each(function(){$(this).attr("value")==t?($(this).removeAttr("checked"),$(this).attr("disabled","disabled")):$(this).removeAttr("disabled")})},a.create=function(){if(common.initJqValidation($("#topicform")),$("#topicform").valid()){var e=[];$('#principalUser_ul input[selectType="assistUser"]:checked').each(function(){e.push($(this).attr("value"))}),a.model.prinUserIds=e.join(","),o.createTopic(a.model,a.isCommit,function(e){e.flag||"ok"==e.reCode?(a.model=e.reObj,t.alert("操作成功！")):t.alert(e.reMsg)})}else t.alert("页面未填报完整或者为正确，请检查！")},a.startFlow=function(){common.initJqValidation($("#topicform")),$("#topicform").valid()?t.confirm({title:"询问提示",message:"发起流程后，当前页面数据将不能再修改！确认发起流程么？",onOk:function(){var e=[];$('#principalUser_ul input[selectType="assistUser"]:checked').each(function(){e.push($(this).attr("value"))}),a.model.prinUserIds=e.join(","),o.startFlow(a.model,a.isCommit,function(e){e.flag||"ok"==e.reCode?t.alert("保存成功！",function(){n.go("myTopic")}):t.alert(e.reMsg)})}}):t.alert("页面未填报完整或者为正确，请检查！")}}angular.module("app").controller("topicAddCtrl",t),t.$inject=["bsWin","$scope","sysfileSvc","topicSvc","$state"]}(),function(){"use strict";function t(t,e,i,o,n,a){var r=this;r.title="课题研究存档表",r.filing={},r.zlList=[],function(){o.findByTopicId(n.params.topicId,function(t){r.filing=t,r.filing.topicId=n.params.topicId,r.initFileUpload()})}(),r.initFileUpload=function(){r.filing.id||e.$watch("vm.filing.id",function(t,e){t&&t!=e&&!r.initUploadOptionSuccess&&r.initFileUpload()}),r.sysFile={businessId:r.filing.id,mainId:r.filing.topicId,mainType:a.mainTypeValue().TOPIC,sysfileType:a.mainTypeValue().TOPIC_FILING,sysBusiType:a.mainTypeValue().TOPIC_FILING},a.initUploadOptions({inputId:"sysfileinput",vm:r})},r.saveFiling=function(){o.save(r.filing,function(e){e.flag||"ok"==e.reCode?(r.filing=e.reObj,r.filing.topicId=n.params.topicId,t.alert("保存成功！")):t.error(e.reMsg)})},r.addZL=function(){r.filing.registerFileDto||(r.filing.registerFileDto=[]);var t={};t.id=common.uuid(),r.filing.registerFileDto.push(t)},r.delZL=function(){var e=$("#filingform input[tit='dynamicCheckbox']:checked");if(e.length<1)t.alert("请选择要删除的意见！");else{for(var o=[],n=0;n<e.length;n++)e[n].value&&o.push(e[n].value),$.each(r.filing.registerFileDto,function(t,i){i.id==e[n].value&&r.filing.registerFileDto.splice(t,1)});o.length>0&&i.deleteByIds(o.join(","),function(e){t.alert("删除成功！")})}},r.initInputValue=function(t,e){return t.target.checked&&!e?1:e}}angular.module("app").controller("filingEditCtrl",t),t.$inject=["bsWin","$scope","addRegisterFileSvc","filingSvc","$state","sysfileSvc"]}(),function(){"use strict";function t(t,e){function i(e,i){var o={method:"post",url:rootPath+"/filing/initByTopicId",params:{topicId:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function o(e,i){var o={method:"post",url:rootPath+"/filing",data:e},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}return{findByTopicId:i,save:o}}angular.module("app").factory("filingSvc",t),t.$inject=["$http","bsWin"]}(),function(){"use strict";function t(t,e,i,o){var n=this;n.title="我的课题列表",function(){o.initMyGird(n)}(),n.searchForm=function(){n.myTopicOptions.dataSource._skip=0,n.myTopicOptions.dataSource.read()},n.formReset=function(){n.searchModel={}}}angular.module("app").controller("myTopicCtrl",t),t.$inject=["bsWin","$scope","sysfileSvc","topicSvc"]}(),function(){"use strict";function t(t,e,i){function o(e){var i={method:"get",url:rootPath+"/user/findChargeUsers"},o=function(t){void 0!=e&&"function"==typeof e&&e(t.data)};common.http({$http:t,httpOptions:i,success:o})}function n(e,i,o){i=!0;var n={method:"post",url:rootPath+"/topicInfo",data:e},a=function(t){i=!1,void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:t,httpOptions:n,success:a,onError:function(){i=!1}})}function a(e,i,o){i=!0;var n={method:"post",url:rootPath+"/topicInfo/startFlow",data:e},a=function(t){i=!1,void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:t,httpOptions:n,success:a,onError:function(){i=!1}})}function r(e){var i={method:"post",url:rootPath+"/topicInfo/findById",params:{id:e.businessKey}},o=function(t){e.model={},e.model=t.data};common.http({$http:t,httpOptions:i,success:o,onError:function(){}})}function s(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/topicInfo/findByOData",$("#myTopicForm"),{filter:"createdBy eq ${CURRENT_USER.id}"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})},o=[{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"topicName",title:"课题名称",width:"25%",filterable:!1},{field:"cooperator",title:"合作单位",width:"20%",filterable:!1},{field:"createdDate",title:"创建日期",width:"25%",filterable:!1,format:"{0:yyyy/MM/dd HH:mm:ss}"},{field:"",title:"已发起流程",width:"15%",filterable:!1,template:function(t){return t.processInstanceId?"是":"否"}},{field:"",title:"操作",width:"15%",template:function(t){var e=!!t.processInstanceId;return common.format($("#columnBtns").html(),t.id,e,"flowEnd/"+t.id+"/"+flowcommon.getFlowDefinedKey().TOPIC_FLOW+"/"+t.processInstanceId,!e)}}];t.myTopicOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}function l(e,i){var o={method:"post",url:rootPath+"/topicInfo/findDetailById",params:{id:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n,onError:function(){}})}function c(t,e,o){switch(t.curNode.activitiId){case flowcommon.getTopicFlowNode().TOPIC_BZSH_JH:case flowcommon.getTopicFlowNode().TOPIC_FGLD_JH:case flowcommon.getTopicFlowNode().TOPIC_ZRSH_JH:case flowcommon.getTopicFlowNode().TOPIC_BZSH_FA:case flowcommon.getTopicFlowNode().TOPIC_FGLD_FA:case flowcommon.getTopicFlowNode().TOPIC_ZRSH_FA:case flowcommon.getTopicFlowNode().TOPIC_BZSH_BG:case flowcommon.getTopicFlowNode().TOPIC_FGLD_BG:case flowcommon.getTopicFlowNode().TOPIC_ZRSH_BG:case flowcommon.getTopicFlowNode().TOPIC_BZSH_JT:case flowcommon.getTopicFlowNode().TOPIC_FGLD_JT:case flowcommon.getTopicFlowNode().TOPIC_ZRSH_JT:case flowcommon.getTopicFlowNode().TOPIC_BZSH_GD:case flowcommon.getTopicFlowNode().TOPIC_GDY_QR:e.buttBack=!0;break;case flowcommon.getTopicFlowNode().TOPIC_CGJD:case flowcommon.getTopicFlowNode().TOPIC_KTBG:case flowcommon.getTopicFlowNode().TOPIC_KTJT:t.businessMap&&(o.showFlag.isMainPrinUser=t.businessMap.MAIN_USER,o.showFlag.expertEdit=!0);break;case flowcommon.getTopicFlowNode().TOPIC_LXDW:case flowcommon.getTopicFlowNode().TOPIC_QDHT:case flowcommon.getTopicFlowNode().TOPIC_YJSS:case flowcommon.getTopicFlowNode().TOPIC_NBCS:case flowcommon.getTopicFlowNode().TOPIC_YFZL:e.showUploadBT=!0,o.initFileUpload(i.mainTypeValue().TOPIC,i.mainTypeValue().TOPIC,i.mainTypeValue().TOPIC);break;case flowcommon.getTopicFlowNode().TOPIC_JHTC:case flowcommon.getTopicFlowNode().TOPIC_GZFA:e.businessTr=!0;break;case flowcommon.getTopicFlowNode().TOPIC_ZLGD:e.businessTr=!0,o.showFlag.isMainPrinUser=!0,o.showFlag.expertEdit=!0}}
return{findOrgUser:o,createTopic:n,startFlow:a,initFlowDeal:r,initFlowNode:c,initMyGird:s,initDetail:l}}angular.module("app").factory("topicSvc",t),t.$inject=["$http","bsWin","sysfileSvc"]}(),function(){"use strict";function t(t,e,i,o,n,a,r){var s=this;s.title="课题研究成果鉴定会工作方案",s.workplan={},n.params.topicId&&(s.workplan.topicId=n.params.topicId),function(){s.workplan.topicId&&o.findByTopicId(s.workplan.topicId,function(t){s.workplan=t,s.workplan.topicId=n.params.topicId,s.initFileUpload()})}(),s.saveWorkPlan=function(){o.save(s.workplan,function(e){e.flag||"ok"==e.reCode?(s.workplan=e.reObj,t.alert("保存成功！")):t.error(e.reMsg)})},s.initFileUpload=function(){s.workplan.id||a.$watch("vm.workplan.id",function(t,e){t&&t!=e&&!s.initUploadOptionSuccess&&s.initFileUpload()}),s.sysFile={businessId:s.workplan.id,mainId:s.workplan.topicId,mainType:r.mainTypeValue().TOPIC,sysfileType:r.mainTypeValue().TOPIC_WORKPLAN,sysBusiType:r.mainTypeValue().TOPIC_WORKPLAN},r.initUploadOptions({inputId:"sysfileinput",vm:s})},s.bookMeeting=function(){s.workplan.id?n.go("room",{businessId:s.workplan.id,businessType:"TOPIC_WP"}):t.alert("请先保存当前信息！")},s.selectExpert=function(){s.workplan.id?n.go("expertReviewEdit",{businessId:n.params.topicId,minBusinessId:s.workplan.id,businessType:"TOPIC"}):t.alert("请先保存当前信息，再继续操作！")},s.updateBookRoom=function(t){s.meetingList||e.findAllMeeting(function(t){s.meetingList=t}),$.each(s.workplan.roomDtoList,function(e,i){t==i.id&&(s.roombook=i)}),$("#roomBookDetailWindow").kendoWindow({width:"50%",height:"620px",title:"会议预定信息",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},s.saveRoom=function(){i.saveRoom(s.roombook,function(e){e.flag||"ok"==e.reCode?($.each(s.workplan.roomDtoList,function(t,i){s.roombook.id==i.id&&(i=e.reObj)}),t.success("操作成功！",function(){s.onRoomClose()})):t.error(e.reMsg)})},s.onRoomClose=function(){window.parent.$("#roomBookDetailWindow").data("kendoWindow").close()}}angular.module("app").controller("workPlanEditCtrl",t),t.$inject=["bsWin","meetingSvc","roomSvc","workPlanSvc","$state","$scope","sysfileSvc"]}(),function(){"use strict";function t(t,e){function i(e,i){var o={method:"post",url:rootPath+"/workPlan/initByTopicId",params:{topicId:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function o(e,i){var o={method:"post",url:rootPath+"/workPlan",data:e},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}return{findByTopicId:i,save:o}}angular.module("app").factory("workPlanSvc",t),t.$inject=["$http","bsWin"]}(),function(){"use strict";function t(t,e,i){var o=this;o.title="用户列表",o.del=function(t){i.confirm({title:"温馨提示",message:"确认删除数据吗？",onOk:function(){e.deleteUser(o,t,function(t){t.flag||"ok"==t.reCode?i.success("操作成功！",function(){o.gridOptions.dataSource.read()}):i.error(t.reMsg)})}})},o.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)i.alert("请选择要删除数据！");else{for(var e=[],n=0;n<t.length;n++)e.push(t[n].value);var a=e.join(",");o.del(a)}},o.queryUser=function(){e.queryUser(o)},o.resetPwd=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)i.alert("请选择数据");else{for(var n=[],a=0;a<t.length;a++)n.push(t[a].value);var r=n.join(",");i.confirm({title:"温馨提示",message:"确认重置密码？",onOk:function(){e.resetPwd(o,r)}})}},function(){o.model||(o.model={}),o.model.jobState||(o.model.jobState="t"),e.grid(o)}()}angular.module("app").controller("userCtrl",t),t.$inject=["$location","userSvc","bsWin"]}(),function(){"use strict";function t(t,e,i,o){var n=this;n.title="新增用户",n.isuserExist=!1,n.id=i.params.id,n.id&&(n.isUpdate=!0,n.title="编辑用户"),function(){n.isUpdate?e.getUserById(n):e.initZtreeClient(n),e.getOrg(function(t){n.org={},n.org=t})}(),n.create=function(){if(common.initJqValidation(),$("form").valid()){var t=e.getZtreeChecked(),i=$linq(t).where(function(t){return 0==t.isParent}).select(function(t){return{id:t.id,roleName:t.name}}).toArray();n.model.roleDtoList=i,e.createUser(n.model,n.isSubmit,function(t){t.flag||"ok"==t.reCode?(n.model.id||(n.model.id=t.idCode),o.success("操作成功！")):o.error(t.reMsg)})}},n.update=function(){e.updateUser(n)}}angular.module("app").controller("userEditCtrl",t),t.$inject=["$location","userSvc","$state","bsWin"]}(),function(){"use strict";function t(t,e){function i(i,o){var n={method:"put",url:p+"/resetPwd",params:{ids:o}},a=function(t){e.success("重置密码成功！",function(){i.gridOptions.dataSource.read()})};common.http({vm:i,httpOptions:n,success:a,$http:t})}function o(e){if(common.initJqValidation(),$("form").valid()){e.isSubmit=!0,e.model.id=e.id;var i=u(),o=$linq(i).where(function(t){return 0==t.isParent}).select(function(t){return{id:t.id,roleName:t.name}}).toArray();e.model.roleDtoList=o;var n={method:"put",url:p,data:e.model},a=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:e,$http:t,httpOptions:n,success:a})}}function n(e,i,o){e.isSubmit=!0;var n={method:"delete",url:p,data:i},a=function(t){e.isSubmit=!1,void 0!=o&&"function"==typeof o&&o(t.data)};common.http({vm:e,$http:t,httpOptions:n,success:a,onError:function(){e.isSubmit=!1}})}function a(e,i,o){i=!0;var n={method:"post",url:rootPath+"/user",data:e},a=function(t){void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:t,httpOptions:n,success:a,onError:function(){i=!1}})}function r(e){var i={method:"post",url:rootPath+"/org/listAll"},o=function(t){void 0!=e&&"function"==typeof e&&e(t.data)};common.http({$http:t,httpOptions:i,success:o})}function s(e){var i={method:"post",url:rootPath+"/role/findAllRoles"},o=function(t){common.requestSuccess({vm:e,response:t,fn:function(){var i={check:{chkboxType:{Y:"ps",N:"ps"},enable:!0}},o=$linq(t.data).select(function(t){return{id:t.id,name:t.roleName}}).toArray(),n={id:"",name:"角色集合",children:o};$.fn.zTree.init($("#zTree"),i,n),e.isUpdate&&m(e)}})};common.http({vm:e,$http:t,httpOptions:i,success:o})}function l(e){var i={method:"post",url:rootPath+"/user/findUserById",params:{userId:e.id}},o=function(t){e.model=t.data,e.isUpdate&&s(e)};common.http({vm:e,$http:t,httpOptions:i,success:o})}function c(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/user/fingByOData",$("#usersform"),{filter:"loginName ne 'admin'"}),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!1,serverSorting:!1,serverFiltering:!1,pageSize:10}),i=function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})},o=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox' />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"loginName",title:"登录名",width:100,filterable:!1},{field:"displayName",title:"显示名",width:100,filterable:!1},{field:"orgDto.name",title:"所属部门",width:100,filterable:!1},{field:"userIP",title:"登录IP",width:160,filterable:!1},{field:"lastLogin",title:"最后登录时间",width:160,filterable:!1},{field:"",title:"所属角色",width:160,filterable:!1,template:function(t){if(t.roleDtoList){for(var e="",i=0,o=t.roleDtoList.length;i<o;i++)e+=0==i?t.roleDtoList[i].roleName:", "+t.roleDtoList[i].roleName;return e}return" "}},{field:"",title:"在职情况",width:80,filterable:!1,template:function(t){return t.jobState&&"t"==t.jobState?"在职":"已撤销"}},{field:"",title:"操作",width:140,template:function(t){return common.format($("#columnBtns").html(),"vm.del('"+t.id+"')",t.id)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}function d(t){t.gridOptions.dataSource._skip=0,t.gridOptions.dataSource.read()}function u(){return $.fn.zTree.getZTreeObj("zTree").getCheckedNodes(!0)}function m(t){for(var e=$.fn.zTree.getZTreeObj("zTree"),i=$linq(t.model.roleDtoList).select(function(t){return t.roleName}).toArray(),o=e.getNodesByParam("level",1,null),n=$linq(o).where(function(t){return $linq(i).contains(t.name)}).toArray(),a=0,r=n.length;a<r;a++)e.checkNode(n[a],!0,!0)}var p=rootPath+"/user";rootPath,rootPath;return{grid:c,getUserById:l,initZtreeClient:s,createUser:a,deleteUser:n,updateUser:o,getOrg:r,queryUser:d,getZtreeChecked:u,resetPwd:i}}angular.module("app").factory("userSvc",t),t.$inject=["$http","bsWin"]}(),function(){"use strict";function t(t,e){var i=this;i.title="工作日列表",function(){e.grid(i)}(),i.addWorkDay=function(){$("#workDay").kendoWindow({width:"45%",height:"auto",title:"新增工作日",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},i.create=function(){common.initJqValidation($("#form")),$("#form").valid()&&e.createWorkday(i)},i.del=function(t){common.confirm({vm:i,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),e.deleteWorkday(i,t)}})},i.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)common.alert({vm:i,msg:"请选择数据"});else{for(var e=[],o=0;o<t.length;o++)e.push(t[o].value);var n=e.join(",");i.del(n)}},i.queryWorkday=function(){e.queryWorkday(i)},i.ResetWorkday=function(){e.clearValue(i)}}angular.module("app").controller("workdayCtrl",t),t.$inject=["$location","workdaySvc"]}(),function(){"use strict";function t(t,e,i){function o(t){var e=$("#workdayForm").find("input,select");$.each(e,function(t,e){e.value=""}),t.gridOptions.dataSource.read()}function n(e){var i={method:"get",url:d+"/getWorkdayById",params:{id:e.id}},o=function(t){e.workday=t.data};common.http({vm:e,$http:t,httpOptions:i,success:o})}function a(t){t.gridOptions.dataSource.read()}function r(e){var o={method:"post",url:d+"/createWorkday",data:e.workday},n=function(t){console.log(t),t.data.flag?i.alert("保存成功！",function(){e.gridOptions.dataSource.read(),window.parent.$("#workDay").data("kendoWindow").close(),e.workday=""}):i.alert(t.data.reMsg+"已存在，不能重复添加！",function(){e.gridOptions.dataSource.read(),window.parent.$("#workDay").data("kendoWindow").close(),e.workday=""})};common.http({vm:e,$http:t,httpOptions:o,success:n})}function s(e){var i={method:"put",url:d,data:e.workday},o=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=u}})}})};common.http({vm:e,$http:t,httpOptions:i,success:o})}function l(e,i){var o={method:"delete",url:d,data:i},n=function(t){e.gridOptions.dataSource.read()};common.http({vm:e,$http:t,httpOptions:o,success:n})}function c(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(d+"/findByOdataObj",$("#workdayForm")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"},modifiedDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"dates",dir:"desc"}}),i=function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})},o=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"dates",title:"时间",width:200,format:"{0:yyyy-MM-dd}",filterable:!1},{field:"",title:"状态",width:100,filterable:!1,template:function(t){return t.status?"1"==t.status?"调休":"2"==t.status?"加班":void 0:""}},{field:"remark",title:"备注",width:140,filterable:!1},{field:"",title:"操作",width:140,template:function(t){return common.format($("#columnBtns").html(),"vm.del('"+t.id+"')",t.id)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}var d=rootPath+"/workday",u="#/workday";return{grid:c,createWorkday:r,getWorkdayById:n,updateWorkday:s,deleteWorkday:l,queryWorkday:a,clearValue:o}}angular.module("app").factory("workdaySvc",t),t.$inject=["$http","$state","bsWin"]}(),function(){"use strict";function t(t,e,i){var o=this;o.title="添加工作日",o.id=i.params.id,o.workday={},o.workday.status="1",o.id&&(o.isUpdate=!0,o.title="更新工作日"),function(){o.isUpdate&&e.getWorkdayById(o)}(),o.create=function(){e.createWorkday(o)},o.update=function(){e.updateWorkday(o)}}angular.module("app").controller("workdayEditCtrl",t),t.$inject=["$location","workdaySvc","$state"]}(),function(){"use strict";function t(t,e,i,o){var n=this;n.work={},n.title="项目基本信息",n.work.signId=i.params.signid,function(){e.initPage(n)}(),n.create=function(){e.createWP(n,!1)}}angular.module("app").controller("workprogramBaseEditCtrl",t),t.$inject=["$location","workprogramSvc","$state","$http"]}(),function(){"use strict";function t(t,e,i,o,n,a,r,s){var l=this;l.work={},l.model={},l.title="评审方案编辑",l.startDateTime=new Date("2006/6/1 08:00"),l.endDateTime=new Date("2030/6/1 21:00"),l.work.signId=e.params.signid,l.isControl=e.params.isControl,l.work.id="",l.sign={},l.unSeledWork={},l.searchSign={},l.businessFlag={isSelfReview:!1,isSingleReview:!0,isMainWorkProj:!1,isLoadMeetRoom:!1,isReveiwAWP:!1},l.expertList=new Array(15),function(){l.showAll=!0,l.isControl?t.workMaintainList(l):t.initPage(l),$("#wpTab li").click(function(t){var e=$("a",this);t.preventDefault(),e.tab("show");var i=e.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500)})}(),l.initFileUpload=function(){l.work.id||n.$watch("vm.work.id",function(t,e){t&&t!=e&&!l.initUploadOptionSuccess&&l.initFileUpload()}),l.sysFile={businessId:l.work.id,mainId:l.work.signId,mainType:o.mainTypeValue().SIGN,sysfileType:o.mainTypeValue().WORKPROGRAM,sysBusiType:o.mainTypeValue().WORKPROGRAM},o.initUploadOptions({inputId:"sysfileinput",vm:l})},l.reviewTypeChange=function(){"自评"==l.work.reviewType&&(l.work.expertCost=""),"合并评审"==l.work.reviewType&&(l.work.isMainProject="9"),l.work.id&&t.findById(l.work.id,function(o){if(void 0!=o.expertCost&&""==l.work.expertCost&&(l.work.expertCost=o.expertCost),"合并评审"==o.isSigle&&"9"==o.isMainProject&&"单个评审"==l.work.isSigle)i.confirm({title:"询问提示",message:"该项目已经关联其他合并评审会关联，您确定要改为单个评审吗？",onOk:function(){t.deleteAllMerge(e.params.signid,l.work.id,function(t){t.flag||"ok"==t.reCode?i.alert("操作成功！",function(){l.work.isMainProject="0"}):i.error("操作失败！")})},onCancel:function(){l.work.isSigle="合并评审",l.work.isMainProject="9"}});else if("专家评审会"==o.reviewType&&"专家函评"==l.work.reviewType&&l.work.roomBookingDtos&&l.work.roomBookingDtos.length>0)i.confirm({title:"询问提示",message:"改成专家函评，预定会议室将会删除，确定修改么？",onOk:function(){t.updateReviewType(e.params.signid,l.work.id,l.work.reviewType,function(t){t.flag||"ok"==t.reCode?(l.work=t.reObj,l.work.signId=e.params.signid,i.alert("操作成功！")):i.error("操作失败！")})},onCancel:function(){l.work.reviewType=o.reviewType}});else if(("专家评审会"==o.reviewType||"专家函评"==o.reviewType)&&"自评"==l.work.reviewType){var n=!1;l.work.roomBookingDtos&&l.work.roomBookingDtos.length>0?n=!0:l.work.expertDtoList&&l.work.expertDtoList.length>0&&(n=!0),n&&i.confirm({title:"询问提示",message:"评审方式改成自评，预定会议室和抽取专家将会删除，确定修改么？",onOk:function(){t.updateReviewType(e.params.signid,l.work.id,l.work.reviewType,function(t){t.flag||"ok"==t.reCode?(l.work=t.reObj,l.work.signId=e.params.signid,i.alert("操作成功！")):i.error("操作失败！")})},onCancel:function(){l.work.reviewType=o.reviewType}})}})},l.onWorkClose=function(){window.parent.$(".workPro").data("kendoWindow").close()},l.formReset=function(){l.searchSign={}},l.filterSign=function(t){var e=!0;if(l.searchSign.projectname&&-1==t.projectname.indexOf(l.searchSign.projectname)&&(e=!1),e&&l.searchSign.reviewstage&&-1==t.reviewstage.indexOf(l.searchSign.reviewstage)&&(e=!1),e)return t},l.initMergeWP=function(){l.work.id?t.findById(l.work.id,function(e){"合并评审"==e.isSigle&&"9"==e.isMainProject?(t.initMergeInfo(l,l.work.signId),$("#mergeSign").kendoWindow({width:"75%",height:"700px",title:"合并评审",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()):i.alert("请先保存工作方案！")}):i.alert("请先保存工作方案！")},l.chooseSign=function(){var e=$("input[name='mergeSign']:checked");if(0==e.length)i.alert("请选择要合并评审的项目！");else{var o=[];$.each(e,function(t,e){o.push(e.value)}),t.chooseSign(l.work.signId,o.join(","),function(e){(e.flag||"ok"==e.reCode)&&t.initMergeInfo(l,l.work.signId),i.alert(e.reMsg)})}},l.cancelSign=function(){var e=$("input[name='cancelMergeSignid']:checked");if(0==e.length)i.alert("请选择要取消合并评审的项目！");else{var o=[];$.each(e,function(t,e){o.push(e.value)})}t.cancelMergeSign(l.work.signId,o.join(","),function(e){(e.flag||"ok"==e.reCode)&&t.initMergeInfo(l,l.work.signId),i.alert(e.reMsg)})},l.addTimeStage=function(){l.work.id?t.findById(l.work.id,function(t){"专家评审会"==t.reviewType?e.go("room",{businessId:l.work.id,businessType:"SIGN_WP"}):i.alert("请先保存工作方案！")}):i.alert("请先保存！")},l.findUsersByOrgId=function(e){t.findUsersByOrgId(l,e)},l.create=function(){common.initJqValidation($("#work_program_form")),$("#work_program_form").valid()?l.isTime?i.alert("结束时间必须大于开始时间！"):("全天"==l.work.studyQuantum?(l.work.studyBeginTime="",l.work.studyEndTime=""):($("#studyBeginTime").val()&&(l.work.studyBeginTimeStr=$("#studyBeginTime").val()),$("#studyEndTime").val()&&(l.work.studyEndTimeStr=$("#studyEndTime").val()),$("#studyAllDay").val()&&$("#studyBeginTime").val()&&(l.work.studyBeginTime=$("#studyAllDay").val()+" "+$("#studyBeginTime").val()+":00"),$("#studyAllDay").val()&&$("#studyEndTime").val()&&(l.work.studyEndTime=$("#studyAllDay").val()+" "+$("#studyEndTime").val()+":00")),t.createWP(l.work,!1,l.iscommit,function(t){t.flag||"ok"==t.reCode?(l.work.id=t.reObj.id,i.success("操作成功！")):i.error(t.reMsg)})):i.alert("操作失败，有红色*号的选项为必填项，请按要求填写！")},l.compare=function(){var t=parseInt(l.work.studyBeginTimeStr.split(":")[0]),e=parseInt(l.work.studyEndTimeStr.split(":")[0]);if(t==e){var i=parseInt(l.work.studyBeginTimeStr.split(":")[1]),o=parseInt(l.work.studyEndTimeStr.split(":")[1]);l.isTime=i>o}else l.isTime=t>e},l.selectExpert=function(){l.work.id?t.findById(l.work.id,function(t){"专家评审会"==t.reviewType||"专家函评"==t.reviewType?"专家评审会"!=l.work.reviewType||l.work.roomBookingDtos&&0!=l.work.roomBookingDtos.length?"专家函评"!=l.work.reviewType||t.letterDate?e.go("expertReviewEdit",{businessId:l.work.signId,minBusinessId:l.work.id,businessType:"SIGN"}):i.alert("请先选择函评日期并保存！"):i.alert("请先预定评审会日期！"):i.alert("请先保存工作方案！")}):i.alert("请先保存当前信息，再继续操作！")},l.printpage=function(t){var e=$(t.target).attr("id");s.workProgramPrint(e)},l.createMaintain=function(){if(void 0!=l.assistant&&0!=l.assistant.length)for(var e=0;e<l.assistant.length;e++)t.createWP(l.assistant[e],!1,l.iscommit);l.work&&t.createWP(l.work,!1,l.iscommit,function(){i.alert("操作成功")})}}angular.module("app").controller("workprogramEditCtrl",t),t.$inject=["workprogramSvc","$state","bsWin","sysfileSvc","$scope","meetingSvc","roomSvc","signSvc"]}(),function(){"use strict";function t(t,e,i){function o(e,i,o,n){var a={signId:e,id:i,reviewType:o},r={method:"post",url:rootPath+"/workprogram/updateReviewType",data:a},s=function(t){void 0!=n&&"function"==typeof n&&n(t.data)};common.http({$http:t,httpOptions:r,success:s})}function n(e,i){var o={method:"post",url:rootPath+"/workprogram/initWorkProgramById",params:{workId:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function a(e,i){var o={method:"post",url:rootPath+"/signView/getMergeSignBySignId",params:{signId:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function r(e,i){var o={method:"post",url:rootPath+"/signView/unMergeWPSign",params:{signId:e}},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function s(t,e){r(e,function(e){t.unMergeSign=[],t.unMergeSign=e}),a(e,function(e){t.mergeSign=[],t.mergeSign=e})}function l(e,i,o){var n={method:"post",url:rootPath+"/signView/cancelMergeSign",params:{signId:e,cancelIds:i,mergeType:"1"}},a=function(t){void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:t,httpOptions:n,success:a})}function c(e,i,o){var n={method:"post",url:rootPath+"/signView/mergeSign",params:{signId:e,mergeIds:i,mergeType:"1"}},a=function(t){void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:t,httpOptions:n,success:a})}function d(e,i,o){var n={method:"post",url:rootPath+"/signView/deleteAllMerge",params:{signId:e,mergeType:"1",businessId:i}},a=function(t){void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:t,httpOptions:n,success:a})}function u(e){var i={method:"get",url:rootPath+"/room/meeting"},o=function(t){void 0!=e&&"function"==typeof e&&e(t.data)};common.http({$http:t,httpOptions:i,success:o})}function m(e){var i={method:"get",url:common.format(y+"/findCcompanys")},o=function(t){e.companys={},e.companys=t.data};common.http({vm:e,$http:t,httpOptions:i,success:o})}function p(e,i){var o={};"main"==i&&(o.orgId=e.work.reviewDept);var n={method:"get",url:rootPath+"/user/findUsersByOrgId",params:o},a=function(t){common.requestSuccess({vm:e,response:t,fn:function(){"main"==i&&(e.mainUserList={},e.mainUserList=t.data)}})};common.http({vm:e,$http:t,httpOptions:n,success:a})}function f(o){var n={method:"post",url:rootPath+"/workprogram/html/initWorkProgram",params:{signId:o.work.signId}},a=function(t){null!=t.data&&""!=t.data&&(o.work=t.data.eidtWP,o.work.reviewType||(o.work.reviewType="自评"),o.work.isSigle||(o.work.isSigle="单个评审"),o.work.expertDtoList&&o.work.expertDtoList.length>0&&(!o.work.expertCost||o.work.expertCost<1e3*o.work.expertDtoList.length)&&(o.work.expertCost=1e3*o.work.expertDtoList.length),o.model.workProgramDtoList={},("9"==t.data.showTotalInvestment||9==t.data.showTotalInvestment||t.data.WPList&&t.data.WPList.length>0)&&(o.model.workProgramDtoList=t.data.WPList,o.showTotalInvestment=!0),"1"==o.work.branchId&&m(o),o.work.signId=e.params.signid,o.work.projectType&&(o.work.projectTypeDicts=i.topSelectChange(o.work.projectType,i.DICT.PROJECTTYPE.dicts)),"合并评审"!=o.work.isSigle||"0"!=o.work.isMainProject&&0!=o.work.isMainProject||(o.businessFlag.isReveiwAWP=!0),o.initFileUpload())};common.http({vm:o,$http:t,httpOptions:n,success:a})}function h(o){var n={method:"post",url:rootPath+"/workprogram/html/workMaintainList",params:{signId:o.work.signId}},a=function(t){if(null!=t.data&&""!=t.data){if(o.work=t.data.eidtWP,console.log(o.work),o.assistant=t.data.WPList,o.work.reviewOrgName&&(o.reviewOrgName=o.work.reviewOrgName.split(","),o.work.orgName=o.reviewOrgName[0]),o.assistant&&o.assistant.length>0)for(var n=0;n<o.assistant.length;n++)o.assistant[n].orgName=o.reviewOrgName[o.assistant[n].branchId-1];o.work.reviewType||(o.work.reviewType="自评"),o.work.isSigle||(o.work.isSigle="单个评审"),o.work.expertDtoList&&o.work.expertDtoList.length>0&&(!o.work.expertCost||o.work.expertCost<1e3*o.work.expertDtoList.length)&&(o.work.expertCost=1e3*o.work.expertDtoList.length),o.model.workProgramDtoList={},("9"==t.data.showTotalInvestment||9==t.data.showTotalInvestment||t.data.WPList&&t.data.WPList.length>0)&&(o.model.workProgramDtoList=t.data.WPList,o.showTotalInvestment=!0),"1"==o.work.branchId&&m(o),o.work.signId=e.params.signid,o.work.projectType&&(o.work.projectTypeDicts=i.topSelectChange(o.work.projectType,i.DICT.PROJECTTYPE.dicts)),"合并评审"!=o.work.isSigle||"0"!=o.work.isMainProject&&0!=o.work.isMainProject||(o.businessFlag.isReveiwAWP=!0)}};common.http({vm:o,$http:t,httpOptions:n,success:a})}function g(e,i,o,n){o=!0;var a={method:"post",url:rootPath+"/workprogram/addWork",data:e,params:{isNeedWorkProgram:i}},r=function(t){void 0!=n&&"function"==typeof n&&n(t.data)};common.http({$http:t,httpOptions:a,success:r,onError:function(t){o=!1}})}function v(e,i){var o={method:"delete",url:rootPath+"/room",params:{id:e}},n=function(t){void 0!=i&&"function"==typeof i&&i()};common.http({$http:t,httpOptions:o,success:n})}var y=rootPath+"/company";return{initPage:f,createWP:g,findCompanys:m,findUsersByOrgId:p,deleteBookRoom:v,findAllMeeting:u,workMaintainList:h,initMergeInfo:s,getMergeSignBySignId:a,unMergeWPSign:r,chooseSign:c,cancelMergeSign:l,deleteAllMerge:d,findById:n,updateReviewType:o}}angular.module("app").factory("workprogramSvc",t),t.$inject=["$http","$state","$rootScope"]}(),function(){"use strict";function t(t,e){var i=this;i.title="固定资产申购流程",i.del=function(t){common.confirm({vm:i,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),e.deleteAssertStorageBusiness(i,t)}})},i.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)common.alert({vm:i,msg:"请选择数据"});else{for(var e=[],o=0;o<t.length;o++)e.push(t[o].value);var n=e.join(",");i.del(n)}},function(){e.grid(i)}(),i.searchForm=function(){i.gridOptions.dataSource._skip=0,i.gridOptions.dataSource.read()},i.formReset=function(){i.searchModel={}}}angular.module("app").controller("assertStorageBusinessCtrl",t),t.$inject=["$location","assertStorageBusinessSvc"]}(),function(){"use strict";function t(t,e,i,o){function n(t){if(r.conditions.length>0){return r.conditions.forEach(function(t,e){t.goodsName=$("#goodsName"+t.sort).val(),t.specifications=$("#specifications"+t.sort).val(),t.models=$("#models"+t.sort).val(),t.orgCompany=$("#orgCompany"+t.sort).val(),t.evaluate=$("#evaluate"+t.sort).val(),t.goodsNumber=$("#goodsNumber"+t.sort).val(),t.applyDept=r.model.applyDept,t.operator=r.model.operator,t.businessId=$("#businessId").val()}),!0}return!1}function a(t){return!!(/^(\+|-)?\d+$/.test(t)&&t>0)}var r=this;r.model={},r.conMaxIndex=0,r.conditions=new Array,r.title="添加固定资产申购流程",r.isuserExist=!1,r.businessId=i.params.businessId,r.showFlag={addBooksDeatail:!0,modBooksDetail:!0,bookBuyApplyTr:!1,bookBuyBzTr:!0,bookBuyFgzrTr:!0,bookBuyZrTr:!0,bookBuyYsrk:!0},r.businessId&&(r.isUpdate=!0,r.showFlag.modBooksDetail=!0,r.showFlag.addBooksDeatail=!1,r.title="更新图书采购申请业务信息",$("#businessId").val(r.businessId)),r.create=function(){e.createAssertStorageBusiness(r)},r.update=function(){e.updateAssertStorageBusiness(r)},r.addCondition=function(){r.condition={},r.showFlag.addBooksDeatail?r.condition.sort=r.conMaxIndex+1:(r.conMaxIndex=r.conditions.length,r.condition.sort=r.conditions.length+1),r.conditions.push(r.condition),r.conMaxIndex++},r.removeCondition=function(){var t=$("#conditionTable input[name='epConditionSort']:checked");t.length>0?o.confirm({title:"询问提示",message:"删除数据不可恢复，确定删除么？",onOk:function(){$(".confirmDialog").modal("hide");for(var i=[],n=0;n<t.length;n++)$.each(r.conditions,function(e,o){t[n].value==o.sort&&(o.id?i.push(o.id):r.conditions.splice(e,1))});i.length>0?e.deleteSelConditions(i.join(","),r.isCommit,function(t){t.flag||"ok"==t.reCode?(o.success("操作成功！"),$.each(i,function(t,e){$.each(r.conditions,function(t,i){e==i.sort&&r.conditions.splice(t,1)})})):o.error(t.reMsg)}):o.success("操作成功！")}}):o.alert("请选择要删除的抽取条件！")},r.saveCondition=function(){n(!1)?e.saveGoodsDetailBusinessDetail(r.conditions,function(t){t.flag||"ok"==t.reCode?($("#businessId").val(t.reObj.businessId),o.success("保存成功！")):o.error(t.reMsg)}):o.error("请添加后再保存")},r.startFlow=function(){o.confirm({title:"询问提示",message:"发起流程后，当前页面数据将不能再修改！确认发起流程么？",onOk:function(){n(!1)?e.startFlow(r.conditions,r.isCommit,function(t){t.flag||"ok"==t.reCode?o.alert("保存成功！",function(){i.go("myAssertStorageBusiness")}):o.alert(t.reMsg)}):o.error("请添加图书信息后再发起流程！")}})},r.checkBookNum=function(t){var e="bookNumber"+t;if(!a($("#"+e).val()))return void $("span[data-valmsg-for='"+e+"']").html("图书数量只能输入正整数！");$("span[data-valmsg-for='"+e+"']").html("")},r.checkPrice=function(t){var e=/^(-)?(([1-9]{1}\d*)|([0]{1}))(\.(\d){1,4})?$/,i="booksPrice"+t,o="bookNumber"+t;if(!e.test($("#"+i).val()))return $("#"+i).val(""),void $("span[data-valmsg-for='"+i+"']").html("价格只能输入数字！");$("span[data-valmsg-for='"+i+"']").html("");var n=$("#"+i).val(),a=$("#"+o).val();$("#total"+t).val(parseFloat(n)*a)},function(){r.isUpdate&&e.getAssertStorageBusinessById(r)}()}angular.module("app").controller("assertStorageBusinessEditCtrl",t),t.$inject=["$location","assertStorageBusinessSvc","$state","bsWin"]}(),function(){"use strict";function t(t){function e(e){if(common.initJqValidation(),$("form").valid()){e.isSubmit=!0,e.model.id=e.id;var i={method:"put",url:c,data:e.model},o=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:e,$http:t,httpOptions:i,success:o})}}function i(e,i){e.isSubmit=!0;var o={method:"delete",url:c,data:i},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",closeDialog:!0,fn:function(){e.isSubmit=!1,e.gridOptions.dataSource.read()}})}})};common.http({vm:e,$http:t,httpOptions:o,success:n})}function o(e){if(common.initJqValidation(),$("form").valid()){e.isSubmit=!0;var i={method:"post",url:c,data:e.model},o=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",closeDialog:!0,fn:function(){e.isSubmit=!1,location.href=d}})}})};common.http({vm:e,$http:t,httpOptions:i,success:o})}}function n(e,i){var o={method:"post",url:rootPath+"/assertStorageBusiness/saveGoodsDetailList",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(e)},n=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:o,success:n})}function a(e,i,o){i=!0;var n={method:"post",url:rootPath+"/assertStorageBusiness/startFlow",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(e)},a=function(t){i=!1,void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:t,httpOptions:n,success:a,onError:function(){i=!1}})}function r(e){var i={method:"get",url:rootPath+"/assertStorageBusiness/html/findById",params:{id:e.businessKey}},o=function(t){e.model=t.data};common.http({$http:t,httpOptions:i,success:o,onError:function(){}})}function s(e){var i={method:"get",url:rootPath+"/assertStorageBusiness/html/findById",params:{id:e.businessId}},o=function(t){e.model=t.data};common.http({vm:e,$http:t,httpOptions:i,success:o})}function l(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/assertStorageBusiness/findByOData",$("#myTopicForm"),{filter:"createdBy eq ${CURRENT_USER.id}"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var t=this.items(),e=this.pager.page()-1,i=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*i,o=$(this).find(".row-number");$(o).html(t)})},o=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"businessName",title:"业务流程名称",width:"20%",filterable:!1},{field:"createdDate",title:"创建日期",width:"15%",filterable:!1,format:"{0:yyyy/MM/dd HH:mm:ss}"},{field:"",title:"已发起流程",width:"15%",filterable:!1,template:function(t){return t.processInstanceId?"是":"否"}},{field:"",title:"操作",width:140,template:function(t){var e=!!t.processInstanceId
;return common.format($("#columnBtns").html(),t.businessId,e)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}var c=rootPath+"/assertStorageBusiness",d="#/assertStorageBusinessList";return{grid:l,getAssertStorageBusinessById:s,createAssertStorageBusiness:o,deleteAssertStorageBusiness:i,updateAssertStorageBusiness:e,saveGoodsDetailBusinessDetail:n,startFlow:a,initFlowDeal:r}}angular.module("app").factory("assertStorageBusinessSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e){var i=this;i.title="物品明细",i.del=function(t){common.confirm({vm:i,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),e.deleteGoodsDetail(i,t)}})},i.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)common.alert({vm:i,msg:"请选择数据"});else{for(var e=[],o=0;o<t.length;o++)e.push(t[o].value);var n=e.join(",");i.del(n)}},function(){e.grid(i)}()}angular.module("app").controller("goodsDetailCtrl",t),t.$inject=["$location","goodsDetailSvc"]}(),function(){"use strict";function t(t,e,i){var o=this;o.title="添加物品明细",o.isuserExist=!1,o.id=i.params.id,o.id&&(o.isUpdate=!0,o.title="更新物品明细"),o.create=function(){e.createGoodsDetail(o)},o.update=function(){e.updateGoodsDetail(o)},function(){o.isUpdate&&e.getGoodsDetailById(o)}()}angular.module("app").controller("goodsDetailEditCtrl",t),t.$inject=["$location","goodsDetailSvc","$state"]}(),function(){"use strict";function t(t){function e(e){if(common.initJqValidation(),$("form").valid()){e.isSubmit=!0,e.model.id=e.id;var i={method:"put",url:s,data:e.model},o=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:e,$http:t,httpOptions:i,success:o})}}function i(e,i){e.isSubmit=!0;var o={method:"delete",url:s,data:i},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",closeDialog:!0,fn:function(){e.isSubmit=!1,e.gridOptions.dataSource.read()}})}})};common.http({vm:e,$http:t,httpOptions:o,success:n})}function o(e){if(common.initJqValidation(),$("form").valid()){e.isSubmit=!0;var i={method:"post",url:s,data:e.model},o=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",closeDialog:!0,fn:function(){e.isSubmit=!1,location.href=l}})}})};common.http({vm:e,$http:t,httpOptions:i,success:o})}}function n(e){var i={method:"get",url:rootPath+"/goodsDetail/html/findById",params:{id:e.id}},o=function(t){e.model=t.data};common.http({vm:e,$http:t,httpOptions:i,success:o})}function a(e){var i={method:"get",url:rootPath+"/bookBuyBusiness/html/findById"},o=function(t){void 0!=e&&"function"==typeof e&&e(t.data)};common.http({vm:vm,$http:t,httpOptions:i,success:o})}function r(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(s),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"id",title:"id",width:100,filterable:!0},{field:"goodsCode",title:"goodsCode",width:100,filterable:!0},{field:"goodsName",title:"goodsName",width:100,filterable:!0},{field:"specifications",title:"specifications",width:100,filterable:!0},{field:"models",title:"models",width:100,filterable:!0},{field:"goodsPrice",title:"goodsPrice",width:100,filterable:!0},{field:"evaluate",title:"evaluate",width:100,filterable:!0},{field:"goodsNumber",title:"goodsNumber",width:100,filterable:!0},{field:"assertStorageBusiness",title:"assertStorageBusiness",width:100,filterable:!0},{field:"",title:"操作",width:140,template:function(t){return common.format($("#columnBtns").html(),"vm.del('"+t.id+"')",t.id)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0}}var s=rootPath+"/goodsDetail",l="#/goodsDetailList";return{grid:r,getGoodsDetailById:n,createGoodsDetail:o,deleteGoodsDetail:i,updateGoodsDetail:e,getAllStoreAssert:a}}angular.module("app").factory("goodsDetailSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e,i){var o=this;o.model={},o.conMaxIndex=0,o.conditions=new Array,o.title="添加用户资产明细",o.isuserExist=!1,o.id=i.params.id,o.id&&(o.isUpdate=!0,o.title="更新用户资产明细"),o.create=function(){e.createUserAssertDetail(o)},o.update=function(){e.updateUserAssertDetail(o)},o.addCondition=function(){o.condition={},o.condition.sort=o.conMaxIndex+1,o.conditions.push(o.condition),o.conMaxIndex++},function(){o.isUpdate?e.getUserAssertDetailById(o):e.initFillData(function(t){o.goodsDetailDtoList=t.reObj.goodsDetailDtoList})}()}angular.module("app").controller("userAssertDetailAddCtrl",t),t.$inject=["$location","userAssertDetailSvc","$state"]}(),function(){"use strict";function t(t,e){var i=this;i.title="用户资产明细",i.del=function(t){common.confirm({vm:i,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),e.deleteUserAssertDetail(i,t)}})},i.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)common.alert({vm:i,msg:"请选择数据"});else{for(var e=[],o=0;o<t.length;o++)e.push(t[o].value);var n=e.join(",");i.del(n)}},function(){e.grid(i)}()}angular.module("app").controller("userAssertDetailCtrl",t),t.$inject=["$location","userAssertDetailSvc"]}(),function(){"use strict";function t(t){function e(e){if(common.initJqValidation(),$("form").valid()){e.isSubmit=!0,e.model.id=e.id;var i={method:"put",url:s,data:e.model},o=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:e,$http:t,httpOptions:i,success:o})}}function i(e,i){e.isSubmit=!0;var o={method:"delete",url:s,data:i},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",closeDialog:!0,fn:function(){e.isSubmit=!1,e.gridOptions.dataSource.read()}})}})};common.http({vm:e,$http:t,httpOptions:o,success:n})}function o(e){if(common.initJqValidation(),$("form").valid()){e.isSubmit=!0;var i={method:"post",url:s,data:e.model},o=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",closeDialog:!0,fn:function(){e.isSubmit=!1,location.href=l}})}})};common.http({vm:e,$http:t,httpOptions:i,success:o})}}function n(e){var i={method:"get",url:rootPath+"/userAssertDetail/html/findById",params:{id:e.id}},o=function(t){e.model=t.data};common.http({vm:e,$http:t,httpOptions:i,success:o})}function a(e){var i={method:"post",url:rootPath+"/userAssertDetail/html/initFillPageData"},o=function(t){void 0!=e&&"function"==typeof e&&e(t.data)};common.http({$http:t,httpOptions:i,success:o})}function r(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(s),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"id",title:"id",width:100,filterable:!0},{field:"userId",title:"userId",width:100,filterable:!0},{field:"userName",title:"userName",width:100,filterable:!0},{field:"goodId",title:"goodId",width:100,filterable:!0},{field:"goodsName",title:"goodsName",width:100,filterable:!0},{field:"goodsNumber",title:"goodsNumber",width:100,filterable:!0},{field:"",title:"操作",width:140,template:function(t){return common.format($("#columnBtns").html(),"vm.del('"+t.id+"')",t.id)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0}}var s=rootPath+"/userAssertDetail",l="#/userAssertDetailList";return{grid:r,getUserAssertDetailById:n,createUserAssertDetail:o,deleteUserAssertDetail:i,updateUserAssertDetail:e,initFillData:a}}angular.module("app").factory("userAssertDetailSvc",t),t.$inject=["$http"]}();