!function(){"use strict";angular.module("app",["ui.router","kendo.directives","angular-loading-bar","ngAnimate","froala"]).filter("trust2Html",["$sce",function(t){return function(e){return t.trustAsHtml(e)}}]).config(["cfpLoadingBarProvider",function(t){t.parentSelector="#loading-bar-container",t.spinnerTemplate='<div style="position:fixed;width:100%;height:100%;left:0;top:0; z-index:99;background:rgba(0, 0, 0, 0.3);overflow: hidden;"><div style="position: absolute;top:30%; width: 400px;height:40px;left:50%;"><i class="fa fa-spinner fa-pulse fa-1x fa-fw"></i>数据加载中...</div></div>'}]).config(["$stateProvider","$urlRouterProvider",function(t,e){e.otherwise("/welcome"),t.state("welcome",{url:"/welcome",templateUrl:rootPath+"/admin/welcome.html",controller:"adminWelComeCtrl",controllerAs:"vm"}).state("gtasks",{url:"/gtasks",templateUrl:rootPath+"/admin/gtasks.html",controller:"adminCtrl",controllerAs:"vm"}).state("addSupp",{url:"/addSupp/:signid",templateUrl:rootPath+"/addSuppLetter/edit.html",controller:"suppletterCtrl",controllerAs:"vm"}).state("registerFile",{url:"/registerFile/:signid/:id",templateUrl:rootPath+"/addRegisterFile/list.html",controller:"registerFileCtrl",controllerAs:"vm"}).state("dtasks",{url:"/dtasks",templateUrl:rootPath+"/admin/dtasks.html",controller:"adminDoingCtrl",controllerAs:"vm"}).state("etasks",{url:"/etasks",templateUrl:rootPath+"/admin/etasks.html",controller:"adminEndCtrl",controllerAs:"vm"}).state("role",{url:"/role",templateUrl:rootPath+"/role/html/list.html",controller:"roleCtrl",controllerAs:"vm"}).state("roleEdit",{url:"/roleEdit/:id",templateUrl:rootPath+"/role/html/edit.html",controller:"roleEditCtrl",controllerAs:"vm"}).state("user",{url:"/user",templateUrl:rootPath+"/user/html/list.html",controller:"userCtrl",controllerAs:"vm"}).state("userEdit",{url:"/userEdit/:id",templateUrl:rootPath+"/user/html/edit.html",controller:"userEditCtrl",controllerAs:"vm"}).state("org",{url:"/org",templateUrl:rootPath+"/org/html/list.html",controller:"orgCtrl",controllerAs:"vm"}).state("orgEdit",{url:"/orgEdit/:id",templateUrl:rootPath+"/org/html/edit.html",controller:"orgEditCtrl",controllerAs:"vm"}).state("orgUser",{url:"/orgUser/:id",templateUrl:rootPath+"/org/html/orgUser.html",controller:"orgUserCtrl",controllerAs:"vm"}).state("log",{url:"/log",templateUrl:rootPath+"/log/html/list.html",controller:"logCtrl",controllerAs:"vm"}).state("config",{url:"/config",templateUrl:rootPath+"/sysConfig/html/list.html",controller:"sysConfigCtrl",controllerAs:"vm"}).state("upload",{url:"/upload/:uploadid",templateUrl:rootPath+"/upload/html/edit.html",controller:"uploadEditCtrl",controllerAs:"vm"}).state("meeting",{url:"/meeting",templateUrl:rootPath+"/meeting/html/list.html",controller:"meetingCtrl",controllerAs:"vm"}).state("meetingEdit",{url:"/meetingEdit/:id",templateUrl:rootPath+"/meeting/html/edit.html",controller:"meetingEditCtrl",controllerAs:"vm"}).state("room",{url:"/room/:workProgramId",templateUrl:rootPath+"/room/html/roomlist.html",controller:"roomCtrl",controllerAs:"vm"}).state("roomCount",{url:"/roomCount/:id",templateUrl:rootPath+"/room/html/countlist.html",controller:"roomCountCtrl",controllerAs:"vm"}).state("company",{url:"/company",templateUrl:rootPath+"/company/html/list.html",controller:"companyCtrl",controllerAs:"vm"}).state("companyEdit",{url:"/companyEdit/:id",templateUrl:rootPath+"/company/html/edit.html",controller:"companyEditCtrl",controllerAs:"vm"}).state("accountPwd",{url:"/accountPwd",templateUrl:rootPath+"/account/html/changePwd.html",controller:"homeCtrl",controllerAs:"vm"}).state("demo",{url:"/demo",templateUrl:rootPath+"/demo/html/list.html",controller:"demoCtrl",controllerAs:"vm"}).state("dict",{url:"/dict",templateUrl:rootPath+"/dict/html/list.html",controller:"dictCtrl",controllerAs:"vm"}).state("dict.edit",{url:"/edit/:id",templateUrl:rootPath+"/dict/html/edit.html",controller:"dictEditCtrl",controllerAs:"vm"}).state("expert",{url:"/expert",templateUrl:rootPath+"/expert/html/queryAllList.html",controller:"expertCtrl",controllerAs:"vm"}).state("expertAudit",{url:"/expertAudit",templateUrl:rootPath+"/expert/html/audit.html",controller:"expertAuditCtrl",controllerAs:"vm"}).state("expertRepeat",{url:"/expertRepeat",templateUrl:rootPath+"/expert/html/repeat.html",controller:"expertRepeatCtrl",controllerAs:"vm"}).state("expertEdit",{url:"/expertEdit/:expertID",templateUrl:rootPath+"/expert/html/edit.html",controller:"expertEditCtrl",controllerAs:"vm"}).state("expertReviewEdit",{url:"/expertReview/:workProgramId",templateUrl:rootPath+"/expertReview/html/selectExpert.html",controller:"expertSelectCtrl",controllerAs:"vm"}).state("expertReviewList",{url:"/expertReviewList",templateUrl:rootPath+"/expert/html/reviewList.html",controller:"expertReviewListCtrl",controllerAs:"vm"}).state("addSign",{url:"/addSign",templateUrl:rootPath+"/sign/html/add.html",controller:"signCreateCtrl",controllerAs:"vm"}).state("fillSign",{url:"/fillSign/:signid",cache:"false",templateUrl:rootPath+"/sign/html/fillin.html",controller:"signFillinCtrl",controllerAs:"vm"}).state("listSign",{url:"/listSign",templateUrl:rootPath+"/sign/html/list.html",controller:"signCtrl",controllerAs:"vm"}).state("signFlowDeal",{url:"/signFlowDeal/:signid/:taskId/:processInstanceId",templateUrl:rootPath+"/sign/html/flowDeal.html",controller:"signFlowDealCtrl",controllerAs:"vm"}).state("signFlowDetail",{url:"/signFlowDetail/:signid/:taskId/:processInstanceId",templateUrl:rootPath+"/sign/html/signFlowDetail.html",controller:"signFlowDetailCtrl",controllerAs:"vm"}).state("signDetails",{url:"/signDetails/:signid/:processInstanceId",templateUrl:rootPath+"/sign/html/signDetails.html",controller:"signDetailsCtrl",controllerAs:"vm"}).state("endSignDetail",{url:"/endSignDetail/:signid/:processInstanceId",templateUrl:rootPath+"/sign/html/signEndDetails.html",controller:"signEndCtrl",controllerAs:"vm"}).state("signList",{url:"/signList",templateUrl:rootPath+"/sign/html/signList.html",controller:"adminSignListCtrl",controllerAs:"vm"}).state("pauseProject",{url:"/pauseProject",templateUrl:rootPath+"/sign/html/pauseProjectList.html",controller:"pauseProjectCtrl",controllerAs:"vm"}).state("reserveAdd",{url:"/reserveAdd",templateUrl:rootPath+"/sign/html/reserveAdd.html",controller:"signReserveAddCtrl",controllerAs:"vm"}).state("reserveList",{url:"/reserveList",templateUrl:rootPath+"/sign/html/reserveList.html",controller:"signReserveCtrl",controllerAs:"vm"}).state("reserveEdit",{url:"/reserveEdit",templateUrl:rootPath+"/sign/html/reserveList.html",controller:"signReserveCtrl",controllerAs:"vm"}).state("workprogramEdit",{url:"/workprogramEdit/:signid",templateUrl:rootPath+"/workprogram/html/edit.html",controller:"workprogramEditCtrl",controllerAs:"vm"}).state("fileRecordEdit",{url:"/fileRecordEdit/:signid",templateUrl:rootPath+"/fileRecord/html/edit.html",controller:"fileRecordEditCtrl",controllerAs:"vm"}).state("assistPlan",{url:"/assistPlan",templateUrl:rootPath+"/assistPlan/html/manager.html",controller:"assistPlanCtrl",controllerAs:"vm"}).state("officeUserList",{url:"/officeUserList",templateUrl:rootPath+"/officeUser/html/list.html",controller:"officeUserCtrl",controllerAs:"vm"}).state("officeUserEdit",{url:"/officeUserEdit/:officeID",templateUrl:rootPath+"/officeUser/html/edit.html",controller:"officeUserEditCtrl",controllerAs:"vm"}).state("listDept",{url:"/listDept",templateUrl:rootPath+"/dept/html/list.html",controller:"deptCtrl",controllerAs:"vm"}).state("deptEdit",{url:"/deptEdit/:deptId",templateUrl:rootPath+"/depthtml/edit.html",controller:"deptEditCtrl",controllerAs:"vm"}).state("deptOfficeUser",{url:"/deptOfficeUser/:deptId",templateUrl:rootPath+"/dept/html/listOfficeUser.html",controller:"deptOfficeUserCtrl",controllerAs:"vm"}).state("assistUnit",{url:"/assistUnit",templateUrl:rootPath+"/assistUnit/html/assistUnitList.html",controller:"assistUnitCtrl",controllerAs:"vm"}).state("assistUnitEdit",{url:"/assistUnitEdit/:id",templateUrl:rootPath+"/assistUnit/html/assistUnitEdit.html",controller:"assistUnitEditCtrl",controllerAs:"vm"}).state("quartz",{url:"/quartz",templateUrl:rootPath+"/quartz/html/list.html",controller:"quartzCtrl",controllerAs:"vm"}).state("workday",{url:"/workday",templateUrl:rootPath+"/workday/html/list.html",controller:"workdayCtrl",controllerAs:"vm"}).state("workdayEdit",{url:"/workdayEdit/:id",templateUrl:rootPath+"/workday/html/edit.html",controller:"workdayEditCtrl",controllerAs:"vm"}).state("annountment",{url:"/annountment",templateUrl:rootPath+"/annountment/html/list.html",controller:"annountmentCtrl",controllerAs:"vm"}).state("annountmentEdit",{url:"/annountmentEdit/:id",templateUrl:rootPath+"/annountment/html/edit.html",controller:"annountmentEditCtrl",controllerAs:"vm"}).state("annountmentDetail",{url:"/annountmentDetail/:id",templateUrl:rootPath+"/annountment/html/detail.html",controller:"annountmentDetailCtrl",controllerAs:"vm"}).state("annountmentYet",{url:"/annountmentYet",templateUrl:rootPath+"/annountment/html/yetList.html",controller:"annountmentYetCtrl",controllerAs:"vm"}).state("sharingPlatlform",{url:"/sharingPlatlform",templateUrl:rootPath+"/sharingPlatlform/html/list.html",controller:"sharingPlatlformCtrl",controllerAs:"vm"}).state("sharingPlatlformEdit",{url:"/sharingPlatlformEdit/:sharId",templateUrl:rootPath+"/sharingPlatlform/html/edit.html",controller:"sharingPlatlformEditCtrl",controllerAs:"vm"}).state("sharingDetil",{url:"/sharingDetil/:sharId",templateUrl:rootPath+"/sharingPlatlform/html/detail.html",controller:"sharingDetailCtrl",controllerAs:"vm"}).state("sharingPlatlformYet",{url:"/sharingPlatlformYet",templateUrl:rootPath+"/sharingPlatlform/html/yetList.html",controller:"sharingPlatlformYetCtrl",controllerAs:"vm"}).state("pluginfile",{url:"/pluginfile",templateUrl:rootPath+"/file/html/pluginfile.html",controller:"pluginfileCtrl",controllerAs:"vm"})}]).run(function(t,e,o,i){t.getTBHeadName=function(t,e,o){return!e||"9"!=e||"项目建议书"!=t&&"可行性研究报告"!=t?t?"项目概算"==t?"概算审核"+o:t+o:o:"评估论证"+o},t.$state=o,t.$stateParams=i,t.$on("$stateChangeSuccess",function(e,o,i,n,a){t.previousState_name=n.name,t.previousState_params=a}),t.back=function(){t.previousState_name?o.go(t.previousState_name,t.previousState_params):window.history.back()},kendo.culture("zh-CN"),t.topSelectChange=function(t,e,o){if(void 0!=e)for(var i=0;i<e.length;i++)if(o&&"code"==o){if(e[i].dictCode==t)return e[i].dicts}else if(e[i].dictName==t)return e[i].dicts},common.getTaskCount({$http:e}),common.initDictData({$http:e,scope:t})})}(),function(){"use strict";function t(t,e){var o=this;o.title="待办事项",function(){e.gtasksGrid(o)}(),o.countWorkday=function(){e.countWorakday(o)}}angular.module("app").controller("adminCtrl",t),t.$inject=["$location","adminSvc"]}(),function(){"use strict";function t(t,e,o,i){var n=this;n.title="在办任务",n.model={},function(){n.showwin=!1,e.dtasksGrid(n)}(),n.pauseProject=function(t){i.findPausingProject(n,t,"")},n.Checked=function(){$("#fileNo").is(":checked")&&($("#file1").prop("checked",!1),$("#file2").prop("checked",!1))},n.Checked2=function(){$("#fileNo").prop("checked",!1)},n.commitProjectStop=function(){i.pauseProject(n)},n.closewin=function(){window.parent.$("#spwindow").data("kendoWindow").close()},n.startProject=function(t){common.confirm({vm:n,title:"",msg:"确认激活吗？",fn:function(){$(".confirmDialog").modal("hide"),o.activeFlow(n,t)}})}}angular.module("app").controller("adminDoingCtrl",t),t.$inject=["$location","adminSvc","flowSvc","pauseProjectSvc"]}(),function(){"use strict";function t(t,e){var o=this;o.title="办结事项",function(){e.etasksGrid(o)}()}angular.module("app").controller("adminEndCtrl",t),t.$inject=["$location","adminSvc"]}(),function(){"use strict";function t(t,e){var o=this;o.title="项目查询统计",o.sign={},function(){e.initSignList(o),e.getSignList(o)}(),o.formReset=function(){var t=$("#searchform").find("input,select");$.each(t,function(t,e){e.value=""})},o.searchSignList=function(){o.signListOptions.dataSource.read()}}angular.module("app").controller("adminSignListCtrl",t),t.$inject=["$location","adminSvc"]}(),function(){"use strict";function t(t,e){function o(t){var o={method:"get",url:rootPath+"/workday/countWorkday"},i=function(t){};common.http({vm:t,$http:e,httpOptions:o,success:i})}function i(t){t.i=1;var o={method:"get",url:rootPath+"/annountment/getHomePageAnnountment"},i=function(e){t.annountmentList=e.data};common.http({vm:t,$http:e,httpOptions:o,success:i})}function n(t){var o={method:"post",url:rootPath+"/file/listHomeFile"},i=function(e){t.pluginFileList={},t.pluginFileList=e.data};common.http({vm:t,$http:e,httpOptions:o,success:i})}function a(t){var o={method:"post",url:rootPath+"/flow/getMyHomeTasks"},i=function(e){t.tasksList={},t.tasksList=e.data};common.http({vm:t,$http:e,httpOptions:o,success:i})}function r(t){t.endTasksList={};var o={method:"post",url:rootPath+"/flow/getMyHomeEndTask"},i=function(e){t.endTasksList=e.data};common.http({vm:t,$http:e,httpOptions:o,success:i})}function s(t){var o={method:"get",url:rootPath+"/file/findByBusinessId",params:{businessId:t.anId}},i=function(e){t.file=e.data};common.http({vm:t,$http:e,httpOptions:o,success:i})}function l(t,e){window.open(rootPath+"/file/fileDownload?sysfileId="+e)}function c(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/flow/html/tasks"),schema:{data:"value",total:function(t){return t.count?$("#GtasksCount").html(t.count):$("#GtasksCount").html(0),t.count},model:{id:"id",fields:{createdDate:{type:"date"}}}},serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=[{field:"",title:"",width:30,template:function(t){switch(t.lightState){case"4":return $("#span1").html();case"8":return $("#span5").html();case"7":return $("#span4").html();case"6":return $("#span3").html();case"5":return $("#span2").html();case"1":case"2":case"3":default:return""}}},{field:"",title:"序号",template:"<span class='row-number'></span>",width:50},{field:"projectName",title:"项目名称",filterable:!1,width:150},{field:"reviewStage",title:"项目阶段",filterable:!1,width:150},{field:"nodeName",title:"当前环节",width:120,filterable:!1},{field:"preSignDate",title:"预签收时间",width:120,filterable:!1,format:"{0: yyyy-MM-dd}"},{field:"signDate",title:"正式签收时间",width:120,filterable:!1,format:"{0: yyyy-MM-dd}"},{field:"surplusDays",title:"剩余工作日",width:100,filterable:!1},{field:"",title:"处理人",width:100,filterable:!1,template:function(t){return t.assignee?t.assignee:t.userName?t.userName:void 0}},{field:"",title:"流程状态",width:80,filterable:!1,template:function(t){return t.processState&&2==t.processState?'<span style="color:orange;">已暂停</span>':'<span style="color:green;">进行中</span>'}},{field:"",title:"操作",width:80,template:function(t){return"FINAL_SIGN_FLOW"==t.processKey||"SIGN_XS_FLOW"==t.processKey?2==t.processState?common.format($("#detailBtns").html(),"signFlowDetail",t.businessKey,t.taskId,t.processInstanceId):common.format($("#columnBtns").html(),"signFlowDeal",t.businessKey,t.taskId,t.processInstanceId):"<a class='btn btn-xs btn-danger' >流程已停用</a>"}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,resizable:!0,dataBound:function(){var t=this.items(),e=this.pager.page()-1,o=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*o,i=$(this).find(".row-number");$(i).html(t)})}}}function d(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/flow/html/endTasks"),schema:{data:"value",total:function(t){return t.count},model:{id:"id",fields:{createdDate:{type:"date"}}}},serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=[{field:"",title:"序号",template:"<span class='row-number'></span>",width:40},{field:"businessName",title:"任务名称",filterable:!1,width:180},{field:"createDate",title:"开始时间",width:150,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"endDate",title:"结束时间",width:150,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"",title:"用时",width:180,filterable:!1,template:function(t){return t.durationTime?t.durationTime:'<span style="color:orangered;">已办结</span>'}},{field:"",title:"流程状态",width:120,filterable:!1,template:function(t){return'<span style="color:orangered;">已办结</span>'}},{field:"",title:"操作",width:80,template:function(t){return t.processDefinitionId.indexOf("FINAL_SIGN_FLOW")>=0||t.processDefinitionId.indexOf("SIGN_XS_FLOW")>=0?common.format($("#columnBtns").html(),"endSignDetail",t.businessKey,t.processInstanceId):""}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,resizable:!0,dataBound:function(){var t=this.items(),e=this.pager.page()-1,o=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*o,i=$(this).find(".row-number");$(i).html(t)})}}}function m(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/flow/html/doingtasks"),schema:{data:"value",total:function(t){return t.count},model:{id:"id"}},serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=[{field:"",title:"",width:30,template:function(t){switch(t.lightState){case"4":return $("#span1").html();case"8":return $("#span5").html();case"7":return $("#span4").html();case"6":return $("#span3").html();case"5":return $("#span2").html();case"1":case"2":case"3":default:return""}}},{field:"",title:"序号",template:"<span class='row-number'></span>",width:50},{field:"projectName",title:"项目名称",filterable:!1,width:150},{field:"reviewStage",title:"项目阶段",filterable:!1,width:150},{field:"nodeName",title:"当前环节",width:120,filterable:!1},{field:"preSignDate",title:"预签收时间",width:120,filterable:!1,format:"{0: yyyy-MM-dd}"},{field:"signDate",title:"正式签收时间",width:120,filterable:!1,format:"{0: yyyy-MM-dd}"},{field:"surplusDays",title:"剩余工作日",width:100,filterable:!1},{field:"",title:"处理人",width:100,filterable:!1,template:function(t){return t.assignee?t.assignee:t.userName?t.userName:void 0}},{field:"",title:"流程状态",width:80,filterable:!1,template:function(t){return t.processState&&2==t.processState?'<span style="color:orange;">已暂停</span>':'<span style="color:green;">进行中</span>'}},{field:"",title:"操作",width:150,template:function(t){var e=!1;return e="2"==t.processState,"FINAL_SIGN_FLOW"==t.processKey||"SIGN_XS_FLOW"==t.processKey?common.format($("#columnBtns").html(),"signFlowDetail",t.businessKey,t.taskId,t.processInstanceId,"vm.pauseProject('"+t.businessKey+"')",e,"vm.startProject('"+t.businessKey+"')",e):'<a class="btn btn-xs btn-danger" >流程已停用</a>'}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,resizable:!0,dataBound:function(){var t=this.items(),e=this.pager.page()-1,o=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*o,i=$(this).find(".row-number");$(i).html(t)})}}}function u(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/sign/getSignList",$("#searchform")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=[{field:"",title:"序号",template:"<span class='row-number'></span>",width:50},{field:"sprojectname",title:"项目名称",width:160,filterable:!1},{field:"sreviewstage",title:"评审阶段",width:140,filterable:!1},{field:"sreceivedate",title:"收文日期",width:200,filterable:!1},{field:"ddispatchtype",title:"发文日期",width:160,filterable:!1},{field:"sreviewdays",title:"评审天数",width:140,filterable:!1},{field:"ssurplusdays",title:"剩余工作日",width:140,filterable:!1},{field:"mOrgNames",title:"评审部门",width:140,filterable:!1},{field:"pmianchargeusername",title:"项目负责人",width:140,filterable:!1},{field:"sfilenum",title:"归档编号",width:140,filterable:!1},{field:"dfilenum",title:"文件字号",width:140,filterable:!1},{field:"sappalyinvestment",title:"申报投资",width:140,filterable:!1},{field:"dauthorizevalue",title:"审定投资",width:140,filterable:!1},{field:"dextravalue",title:"核减（增）投资",width:140,filterable:!1},{field:"dextrarate",title:"核减率",width:140,filterable:!1},{field:"dapprovevalue",title:"批复金额",width:140,filterable:!1},{field:"sreceivedate",title:"批复来文时间",width:140,filterable:!1},{field:"ddispatchtype",title:"发文类型",width:140,filterable:!1},{field:"ffiledate",title:"归档日期",width:140,filterable:!1},{field:"sbuiltcompanyName",title:"建设单位",width:140,filterable:!1},{field:"sisassistproc",title:"是否协审",width:140,filterable:!1,template:function(t){return 9==t.sisassistproc?"是":"否"}},{field:"sdaysafterdispatch",title:"发文后工作日",width:140,filterable:!1}];t.signListOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,selectable:"multiple cell",resizable:!0,dataBound:function(){var t=this.items(),e=this.pager.page()-1,o=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*o,i=$(this).find(".row-number");$(i).html(t)})}},$("#grid tbody td").dblclick(function(t){console.log($("#grid tbody td"))})}function p(t){var o={method:"get",url:rootPath+"/sign/initSignList"},i=function(e){t.sign.mOrgIds=e.data.mOrgId,t.usersList=e.data.usersList,t.orgsList=e.data.orgsList};common.http({vm:t,$http:e,httpOptions:o,success:i})}return{gtasksGrid:c,etasksGrid:d,dtasksGrid:m,countWorakday:o,initFile:s,upload:l,getSignList:u,initSignList:p,initAnnountment:i,findendTasks:r,findtasks:a,findHomePluginFile:n}}angular.module("app").factory("adminSvc",t),t.$inject=["$rootScope","$http"]}(),function(){"use strict";function t(t,e){var o=this;o.title="主页",function(){e.initAnnountment(o),e.findtasks(o),e.findendTasks(o),e.findHomePluginFile(o)}()}angular.module("app").controller("adminWelComeCtrl",t).filter("FormatStrDate",function(){return function(t){var e=new Date(t),o=e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1,i=e.getDate()<10?"0"+e.getDate():e.getDate();return e.getFullYear()+"/"+o+"/"+i}}),t.$inject=["$location","adminSvc"]}(),function(){"use strict";function t(t,e,o,i,n){var a=this;a.title="通知公告管理",function(){i.grid(a)}(),a.bathIssue=function(){i.updateIssueState(a,"9")},a.bathUnissue=function(){i.updateIssueState(a,"0")},a.del=function(t){common.confirm({vm:a,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),i.deleteAnnountment(a,t)}})},a.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)common.alert({vm:a,msg:"请选择数据"});else{for(var e=[],o=0;o<t.length;o++)e.push(t[o].value);var i=e.join(",");a.del(i)}},a.detail=function(t){t&&e.go("annountmentDetail",{id:t})},a.queryAnnountment=function(){a.gridOptions.dataSource.read()},a.resetAnnountment=function(){var t=$("#annountmentform").find("input,select");$.each(t,function(t,e){e.value=""})}}angular.module("app").controller("annountmentCtrl",t),t.$inject=["$location","$state","$http","annountmentSvc","sysfileSvc"]}(),function(){"use strict";function t(t,e,o){var i=this;i.title="通知公告详情页",i.annountment={},i.annountment.anId=e.params.id,function(){o.findDetailById(i,i.annountment.anId)}(),i.post=function(t){o.findDetailById(i,t)},i.next=function(t){o.findDetailById(i,t)},i.alertwd=function(){$("section").addClass("cont-alert")},i.closed=function(){$("section").removeClass("cont-alert")},i.prints=function(){var t,e="<div  style=\"width: 80%;height:80%; text-align: center; margin: auto; font-family: 'Microsoft YaHei'\">"+$("#context-body").html()+"</div>",o=$(window).height(),i=$(window).width();t=window.open("","","width="+i+",height="+o),t.document.body.innerHTML=e,t.print()}}angular.module("app").controller("annountmentDetailCtrl",t),t.$inject=["$location","$state","annountmentSvc"]}(),function(){"use strict";function t(t,e){var o=this;o.title="通知公告编辑",o.annountment={},o.annountment.anId=t.params.id,o.businessFlag={isInitFileOption:!1},function(){$("#froalaEditor").froalaEditor({language:"zh_cn",inlineMode:!1,placeholderText:"请输入内容",imageUploadURL:rootPath+"/froala/uploadImg",imageUploadParams:{rootPath:rootPath},height:"260px",enter:$.FroalaEditor.ENTER_BR,toolbarButtons:["bold","italic","underline","strikeThrough","fontFamily","paragraphFormat","align","color","fontSize","outdent","indent","insertImage","insertTable","undo","redo","insertLink","fullscreen"]}),o.annountment.anId?(o.isUpdate=!0,e.findAnnountmentById(o),e.findFileList(o)):e.initFileOption({sysfileType:"通知公告",uploadBt:"upload_file_bt",vm:o})}(),o.create=function(){e.createAnnountment(o)},o.update=function(){e.updateAnnountment(o)}}angular.module("app").controller("annountmentEditCtrl",t),t.$inject=["$state","annountmentSvc"]}(),function(){"use strict";function t(t,e){function o(e){var o={method:"get",url:f+"/initAnOrg"},i=function(t){e.annountment.anOrg="",e.annountment.anOrg=t.data.substring(1,t.data.length-1)};common.http({vm:e,$http:t,httpOptions:o,success:i})}function i(e){var o={method:"get",url:f+"/findAnnountmentById",params:{anId:e.annountment.anId}},i=function(t){e.annountment=t.data,$("#froalaEditor").froalaEditor("html.set",e.annountment.anContent),0==e.businessFlag.isInitFileOption&&l({businessId:e.annountment.anId,sysfileType:"通知公告",uploadBt:"upload_file_bt",vm:e})};common.http({vm:e,$http:t,httpOptions:o,success:i})}function n(e){if(e.annountment.anContent=$("#froalaEditor").val(),common.initJqValidation(),$("#form").valid()){var o={method:"post",url:f,data:e.annountment},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.isSubmit=!1,common.alert({vm:e,msg:"操作成功",closeDialog:!0})}}),e.annountment.anId=t.data.anId,0==e.businessFlag.isInitFileOption&&l({businessId:e.annountment.anId,sysfileType:"通知公告",uploadBt:"upload_file_bt",vm:e})};common.http({vm:e,$http:t,httpOptions:o,success:i})}}function a(e){e.annountment.anContent=$("#froalaEditor").val();var o={method:"put",url:f,data:e.annountment},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}})}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}function r(e,o){var i={method:"delete",url:f,data:o},n=function(t){e.gridOptions.dataSource.read()};common.http({vm:e,$http:t,httpOptions:i,success:n})}function s(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/annountment/fingByCurUser",$("#annountmentform")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"},modifiedDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:[{field:"issue",dir:"asc"}]}),o=function(){var t=this.items(),e=this.pager.page()-1,o=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*o,i=$(this).find(".row-number");$(i).html(t)})},i=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.anId)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"unitSort",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"anTitle",title:"标题",width:300,filterable:!1},{field:"issueDate",title:"发布时间",format:"{0:yyyy-MM-dd hh24:mm:ss}",width:160,filterable:!1},{field:"issueUser",title:"发布人",width:100,filterable:!1},{field:"",title:"发布状态",width:100,template:function(t){return t.issue&&"9"==t.issue?"已发布":"未发布"}},{field:"",title:"操作",width:150,template:function(t){return common.format($("#columnBtns").html(),"vm.detail('"+t.anId+"')",t.anId,"vm.del('"+t.anId+"')")}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,dataBound:o,columns:i,resizable:!0}}function l(e){if(e.uploadBt&&$("#"+e.uploadBt).click(function(){e.businessId?$("#commonuploadWindow").kendoWindow({width:600,height:400,title:"附件上传",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open():common.alert({vm:e.vm,msg:"请先保存数据！",closeDialog:!0})}),e.businessId){e.vm.downloadSysFile=function(t){window.open(rootPath+"/file/fileDownload?sysfileId="+t)},e.vm.delSysFile=function(o){var i={method:"delete",url:rootPath+"/file/deleteSysFile",params:{id:o}},n=function(t){common.requestSuccess({vm:e.vm,response:t,fn:function(){c(e.vm),common.alert({vm:e.vm,msg:"删除成功",closeDialog:!0})}})};common.http({vm:e.vm,$http:t,httpOptions:i,success:n})};var o={language:"zh",allowedPreviewTypes:["image"],allowedFileExtensions:["jpg","png","gif","xlsx","docx","doc","xls","pdf","ppt","zip","rar"],maxFileSize:2e3,showRemove:!1,uploadUrl:rootPath+"/file/fileUpload",uploadExtraData:{businessId:e.businessId,sysSignId:"通知公告",sysfileType:angular.isUndefined(e.sysfileType)?"通知公告":e.sysfileType}},i=0;$("#sysfileinput").fileinput(o).on("filebatchselected",function(t,e){i=e.length}).on("fileuploaded",function(t,o,n,a){i==a+1&&c(e.vm)}),e.vm.businessFlag.isInitFileOption=!0}}function c(e){var o={method:"get",url:rootPath+"/file/findByBusinessId",params:{businessId:e.annountment.anId}},i=function(t){e.sysFilelists=t.data};common.http({vm:e,$http:t,httpOptions:o,success:i})}function d(e,o){var i=common.getKendoCheckId(".grid");if(0==i.length)common.alert({vm:e,msg:"请选择数据"});else{for(var n=[],a=0;a<i.length;a++)n.push(i[a].value);var r={method:"post",url:rootPath+"/annountment/updateIssueState",params:{ids:n.join(","),issueState:o}},s=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.isSubmit=!1,e.gridOptions.dataSource.read(),common.alert({vm:e,msg:"操作成功",closeDialog:!0})}})};common.http({vm:e,$http:t,httpOptions:r,success:s})}}function m(e,o){var i={method:"get",url:f+"/findAnnountmentById",params:{anId:o}},n=function(t){e.annountment=t.data,c(e),u(e,o),p(e,o)};common.http({vm:e,$http:t,httpOptions:i,success:n})}function u(e,o){var i={method:"get",url:rootPath+"/annountment/postArticle",params:{anId:o}},n=function(t){e.annountmentPost=t.data};common.http({vm:e,$http:t,httpOptions:i,success:n})}function p(e,o){var i={method:"get",url:rootPath+"/annountment/nextArticle",params:{anId:o}},n=function(t){e.annountmentNext=t.data};common.http({vm:e,$http:t,httpOptions:i,success:n})}var f=rootPath+"/annountment";return{grid:s,createAnnountment:n,initAnOrg:o,findAnnountmentById:i,updateIssueState:d,updateAnnountment:a,deleteAnnountment:r,initFileOption:l,findFileList:c,findDetailById:m,postArticle:u,nextArticle:p}}angular.module("app").factory("annountmentSvc",t),t.$inject=["$http","sysfileSvc"]}(),function(){"use strict";function t(t,e,o,i){var n=this;n.title="通知公告列表",function(){i.grid(n)}(),n.detail=function(t){t&&e.go("annountmentDetail",{id:t})},n.findAnnountment=function(){n.gridOptions.dataSource.read()},n.resetAnnountment=function(){var t=$("#annountmentYetform").find("input,select");$.each(t,function(t,e){e.value=""})}}angular.module("app").controller("annountmentYetCtrl",t),t.$inject=["$location","$state","$http","annountmentYetSvc"]}(),function(){"use strict";function t(t){function e(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/annountment/findByIssue",$("#annountmentYetform")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"},modifiedDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:[{field:"createdDate",dir:"desc"}]}),o=function(){var t=this.items(),e=this.pager.page()-1,o=this.pager.pageSize();$(t).each(function(){
var t=$(this).index()+1+e*o,i=$(this).find(".row-number");$(i).html(t)})},i=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.anId)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"unitSort",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"anTitle",title:"标题",width:300,filterable:!1},{field:"issueDate",title:"发布时间",format:"{0:yyyy-MM-dd hh24:mm:ss}",width:160,filterable:!1},{field:"issueUser",title:"发布人",width:100,filterable:!1},{field:"",title:"操作",width:150,template:function(t){return common.format($("#columnBtns").html(),"vm.detail('"+t.anId+"')")}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,dataBound:o,columns:i,resizable:!0}}return{grid:e}}angular.module("app").factory("annountmentYetSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e,o,i,n){var a=this;a.model={},a.filterModel={},a.filterLow={},a.title="协审计划管理",a.splitNumArr=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],a.plan={},a.planList=new Array,a.showPlan={},a.assistSign=new Array,a.pickSign=new Array,a.pickMainSign=new Array,a.lowerSign=new Array,a.selectPlanId="",a.selectMainSignId="",a.initPickLowSign=!1,a.drawType="",function(){o.initPlanPage(a),o.initPlanGrid(a),$("#planInfo li").click(function(t){var e=$("a",this);t.preventDefault(),e.tab("show");var o=e.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+o).addClass("active").addClass("in").show(500)})}(),a.filterSign=function(t){var e=!0;if(!angular.isUndefined(t)&&(angular.isUndefined(a.filterModel.filterFilecode)||-1==t.filecode.indexOf(a.filterModel.filterFilecode)&&(e=!1),e&&(angular.isUndefined(a.filterModel.filterProjectCode)||-1==t.projectcode.indexOf(a.filterModel.filterProjectCode)&&(e=!1)),e&&(angular.isUndefined(a.filterModel.filterProjectName)||-1==t.projectname.indexOf(a.filterModel.filterProjectName)&&(e=!1)),e&&(angular.isUndefined(a.filterModel.filterBuiltName)||(angular.isUndefined(t.builtcompanyName)&&(e=!1),e&&-1==t.builtcompanyName.indexOf(a.filterModel.filterBuiltName)&&(e=!1))),e))return t},a.filterLowSign=function(t){var e=!0;if(!angular.isUndefined(t)&&(angular.isUndefined(a.filterLow.filterFilecode)||-1==t.filecode.indexOf(a.filterLow.filterFilecode)&&(e=!1),e&&(angular.isUndefined(a.filterLow.filterProjectCode)||-1==t.projectcode.indexOf(a.filterLow.filterProjectCode)&&(e=!1)),e&&(angular.isUndefined(a.filterLow.filterProjectName)||-1==t.projectname.indexOf(a.filterLow.filterProjectName)&&(e=!1)),e&&(angular.isUndefined(a.filterLow.filterBuiltName)||(angular.isUndefined(t.builtcompanyName)&&(e=!1),e&&-1==t.builtcompanyName.indexOf(a.filterLow.filterBuiltName)&&(e=!1))),e))return t},a.initSplit=function(t){a.plan.assistType==t&&(angular.isUndefined(a.plan.spliNum)||(a.plan.spliNum=0))},a.affirmSign=function(){var t=$("input[name='selASTSign']:checked");if(t.length<1)common.alert({vm:a,msg:"请选择要挑选的项目"});else{if(t.length>1)return void("合并项目"==a.plan.assistType?common.alert({vm:a,msg:"合并项目要先挑选一个主项目，再挑选次项目！"}):common.alert({vm:a,msg:"独立项目，每次只能选择一个！"}));a.model.signId=t[0].value,a.model.assistType=a.plan.assistType,a.model.single="合并项目"!=a.plan.assistType,a.model.splitNum=a.plan.spliNum,a.model.id=a.selectPlanId,a.assistSign.forEach(function(t,e){t.signid==a.model.signId&&(a.model.projectName=t.projectname)}),o.saveAssistPlan(a)}},a.cancelSign=function(){var t=$("input[name='checkASTSign']:checked");t.length<1?common.alert({vm:a,msg:"请选择取消的项目"}):common.confirm({vm:a,title:"",msg:"确认取消挑选项目吗?",fn:function(){$(".confirmDialog").modal("hide");for(var e=[],i=0;i<t.length;i++)e.push(t[i].value);o.cancelPlanSign(a,e.join(","))}})},a.initSelPlan=function(){o.initSelPlan(a)},a.doDelete=function(){a.showPlan.id?common.confirm({vm:a,title:"",msg:"确认删除数据吗?",fn:function(){$(".confirmDialog").modal("hide"),o.deletePlan(a)}}):common.alert({vm:a,msg:"请选择要删除的数据"})},a.showPickLowSign=function(t){a.selectMainSignId=t,o.showPickLowSign(a),$("#lowerSignWin").kendoWindow({width:"1024px",height:"600px",title:"次项目信息",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},a.affirmLowerSign=function(){var t=$("input[name='selLowSign']:checked");if(t.length<1)common.alert({vm:a,msg:"请选择要挑选的次项目"});else{for(var e=[],i=0;i<t.length;i++)e.push(t[i].value);o.saveLowPlanSign(a,e)}},a.cancelLowerSign=function(){var t=$("input[name='checkLowSign']:checked");if(t.length<1)common.alert({vm:a,msg:"请选择要挑选的次项目"});else{for(var e=[],i=0;i<t.length;i++)e.push(t[i].value);o.cancelLowPlanSign(a,e.join(","))}},a.queryPlan=function(){o.queryPlan(a)};var r="";a.planId="",a.showPlanDetail=function(t){$("#planInfo").kendoWindow({width:"1024px",height:"600px",title:"协审项目清单",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open(),a.signNum=0,r=t,a.planId=t,o.getPlanSignByPlanId(a,t)},a.ministerOpinionEdit=function(t){common.initIdeaData(a,i,t)},a.viceDirectorOpinionEdit=function(t){common.initIdeaData(a,i,t)},a.directorOpinionEdit=function(t){common.initIdeaData(a,i,t)},a.assistPlan={},a.savePlanSign=function(){o.savePlanSign(a),a.assistPlan.id=r,o.savePlan(a)},a.checked="option1",a.chooseAssistUnit=function(){a.number=0,a.drawType="","option1"==a.checked&&(a.drawType="1",a.number=a.assistPlanSign.length+1),"option2"==a.checked&&(a.drawType="0",a.number=a.assistPlanSign.length),o.chooseAssistUnit(a)},a.againChooleAssistUnit=function(){$("#againChooleAssistUnit").kendoWindow({title:"选择参加协审单位",width:"600px",height:"500px",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open(),o.getAllUnit(a),a.num=0,"0"==a.showPlan.drawType?a.num=a.assistPlanSign.length:(console.log(123),a.num=a.assistPlanSign.length+1)},a.saveAddChooleUnit=function(t){o.saveAddChooleUnit(a,t)},a.drawAssistUnit=function(){if(console.log(a.showPlan.drawType),void 0!=a.assistPlanSign&&a.assistPlanSign.length>0)if(a.assistPlanSign.forEach(function(t,e){t.assistUnit=null}),a.drawAssistUnits=a.unitList.slice(0),"1"==a.drawType?a.drawAssistUnits.length>a.assistPlanSign.length:a.drawAssistUnits.length>=a.assistPlanSign.length){for(var t=0,e=-1,o=0;o<a.drawAssistUnits.length;o++)if("9"==a.drawAssistUnits[o].isLastUnSelected){var i=Math.floor(Math.random()*a.assistPlanSign.length);e=i,a.assistPlanSign[i].assistUnit=a.drawAssistUnits[o],a.drawPlanSign=a.assistPlanSign[i],a.drawAssistUnits.splice(o,1)}a.drawPlanSign=a.assistPlanSign[t];var r=0;a.isStartDraw=!0,a.isDrawDone=!1,a.t=n(function(){a.drawPlanSign=a.assistPlanSign[t];var o=Math.floor(Math.random()*a.drawAssistUnits.length),i=a.drawAssistUnits[o];a.showAssitUnitName=i.unitName,++r%20==0&&(t!=e?a.assistPlanSign[t].assistUnit=i:t!=a.assistPlanSign.length-1&&(a.assistPlanSign[++t].assistUnit=i),t++,t==e&&e==a.assistPlanSign.length-1&&(n.cancel(a.t),a.isDrawDone=!0),t==a.assistPlanSign.length&&(n.cancel(a.t),a.isDrawDone=!0),a.drawAssistUnits.forEach(function(t,e){t.id==i.id&&a.drawAssistUnits.splice(e,1)}))},50)}else common.alert({vm:a,msg:"当前协审单位少于项目计划数目，不能抽签！请先到项目计划表中选择参加的协审单位后再进行抽签！"})},a.saveDrawAssistUnit=function(){o.saveDrawAssistUnit(a)}}angular.module("app").controller("assistPlanCtrl",t),t.$inject=["$location","$state","assistSvc","$http","$interval"]}(),function(){"use strict";function t(t,e){var o=this;o.title="协审单位",o.resource={},o.del=function(t){o.id=t,common.confirm({vm:o,title:"",msg:"确认要删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),o.resource={},e.deleteAssistUnit(o,t)}})},o.dels=function(){var t=common.getKendoCheckId(".grid");0==t.length?common.alert({vm:o,msg:"请选择数据"}):common.confirm({vm:o,title:"",msg:"确认要删除数据吗？",fn:function(){$(".confirmDialog").modal("hide");for(var i=[],n=0;n<t.length;n++)i.push(t[n].value);var a=i.join(",");e.deleteAssistUnit(o,a)}})},o.queryAssistUnit=function(){e.queryAssistUnit(o)},function(){e.grid(o)}()}angular.module("app").controller("assistUnitCtrl",t),t.$inject=["$location","assistUnitSvc"]}(),function(){"use strict";function t(t){function e(e){if(common.initJqValidation(),$("form").valid()&&0==e.isUnitExist){var o={method:"post",url:s,data:e.assistUnit},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=l}})}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}}function o(e,o){e.isSubmint=!0;var i={method:"delete",url:s,data:o},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),e.gridOptions.dataSource.read()}})}})};common.http({vm:e,$http:t,httpOptions:i,success:n})}function i(e){if(common.initJqValidation(),$("form").valid()&&0==e.isUnitExist){var o={method:"put",url:s,headers:{contentType:"application/json;charset=utf-8"},dataType:"json",data:angular.toJson(e.assistUnit)},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=l}})}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}}function n(e){var o={method:"get",url:s+"/getAssistUnitById",params:{id:e.id}},i=function(t){e.assistUnit=t.data};common.http({vm:e,$http:t,httpOptions:o,success:i})}function a(t){t.gridOptions.dataSource.read()}function r(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(s+"/fingByOData",$("#assistUnitform")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"},modifiedDate:{type:"date"},isUse:{},unitSort:{}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:[{field:"unitSort",dir:"asc"}]}),o=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"unitSort",title:"序号",width:50,filterable:!1},{field:"unitName",title:"单位名称",width:100,filterable:!0},{field:"unitShortName",title:"单位简称",width:100,filterable:!0},{field:"principalName",title:"负责人名称",width:100,filterable:!1},{field:"principalPhone",title:"负责人电话",width:100,filterable:!1},{field:"fax",title:"负责人传真",width:100,filterable:!1},{field:"contactName",title:"联系人名称",width:100,filterable:!1},{field:"contactTell",title:"联系人手机号",width:100,filterable:!1},{field:"address",title:"企业地址",width:100,filterable:!0},{field:"isUse",title:"状态",width:100,filterable:!1,template:function(t){return t.isUse?"0"==t.isUse?"已停用":"1"==t.isUse?"在用":void 0:""}},{field:"",title:"操作",width:140,template:function(t){return common.format($("#columnBtns").html(),"vm.del('"+t.id+"')",t.id,t.isUse)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,resizable:!0}}var s=rootPath+"/assistUnit",l="#/assistUnit";return{grid:r,deleteAssistUnit:o,createAssistUnit:e,updateAssistUnit:i,getAssistUnitById:n,queryAssistUnit:a}}angular.module("app").factory("assistUnitSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e,o){var i=this;i.title="新增协审单位",i.id=o.params.id,i.isUnitExist=!1,i.id&&(i.isUpdate=!0,i.title="更新协审单位"),i.create=function(){e.createAssistUnit(i)},i.update=function(){e.updateAssistUnit(i)},function(){i.isUpdate&&e.getAssistUnitById(i)}()}angular.module("app").controller("assistUnitEditCtrl",t),t.$inject=["$location","assistUnitSvc","$state"]}(),function(){"use strict";function t(t,e){function o(){return[{field:"rowNumber",title:"序号",width:50,template:"<span class='row-number'></span>"},{field:"planName",title:"协审计划名称",width:100,filterable:!1},{field:"reportTime",title:"报审时间",width:50,filterable:!1,format:"{0: yyyy-MM-dd}"},{field:"drawTime",title:"抽签时间",width:100,filterable:!1},{field:"createdBy",title:"创建人员",width:100,filterable:!1},{field:"createdDate",title:"记录生成时间",width:100,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"",title:"操作",width:100,filterable:!1,template:function(t){return'<button class="btn btn-xs btn-primary"  ng-click="vm.showPlanDetail(\''+t.id+'\')"><span class="glyphicon glyphicon-edit"></span>详情</button>'}}]}function i(t){var e=common.kendoGridDataSource(rootPath+"/assistPlan/findByOData",$("#searchform")),i=function(){var t=this.items(),e=this.pager.page()-1,o=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*o,i=$(this).find(".row-number");$(i).html(t)})};t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o(),dataBound:i,resizable:!0}}function n(e){var o={method:"get",url:rootPath+"/assistPlan/initPlanManager"},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.planList=new Array,t.data.signList&&(e.assistSign=t.data.signList),t.data.planList&&t.data.planList.length>0&&(e.planList=t.data.planList,e.selectPlanId||(e.showPlan=t.data.planList[0],e.selectPlanId=e.showPlan.id),m(e))}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}function a(e){e.model.isDrawed="0";var o=rootPath+"/assistPlan",i={method:"post",url:o,data:e.model},a=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.iscommit=!1,e.showPlan.id||e.gridOptions.dataSource.read(),e.showPlan=t.data,n(e),"合并项目"==e.plan.assistType?e.showPickLowSign(e.model.signId):common.alert({vm:e,msg:"操作成功！",closeDialog:!0})}})};common.http({vm:e,$http:t,httpOptions:i,success:a})}function r(e){var o={method:"delete",url:rootPath+"/assistPlan",data:e.showPlan.id},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.iscommit=!1,common.alert({vm:e,msg:"操作成功！",fn:function(){$(".alertDialog").modal("hide"),n(e),e.gridOptions.dataSource.read()}})}})};common.http({vm:e,$http:t,httpOptions:o,success:i,onError:function(){e.iscommit=!1}})}function s(e,o){var i={method:"get",url:rootPath+"/sign/findByPlanId",params:{planId:o}},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.pickSign=t.data,e.pickMainSign=new Array,e.lowerSign=new Array,e.showPlan.assistPlanSignDtoList&&e.pickSign.forEach(function(t,o){e.showPlan.assistPlanSignDtoList.forEach(function(o,i){"9"==o.isMain&&o.signId==t.signid&&(t.assistType=o.assistType,e.pickMainSign.push(t))})}),1==e.initPickLowSign&&u(e)}})};common.http({vm:e,$http:t,httpOptions:i,success:n,onError:function(){e.iscommit=!1}})}function l(e,o){var i={method:"delete",url:rootPath+"/assistPlan/cancelPlanSign",params:{planId:e.selectPlanId,signIds:o}},a=function(t){common.requestSuccess({vm:e,response:t,fn:function(){n(e),common.alert({vm:e,msg:"操作成功！",closeDialog:!0})}})};common.http({vm:e,$http:t,httpOptions:i,success:a,onError:function(){e.iscommit=!1}})}function c(e,o){var i=new Array;e.assistSign.forEach(function(t,n){for(var a=0,r=o.length;a<r;a++)if(t.signid==o[a]){var s={};s.signId=t.signid,s.projectName=t.projectname,s.assistType="合并项目",s.isMain="0",s.mainSignId=e.selectMainSignId,i.push(s)}}),e.model=e.showPlan,e.model.assistPlanSignDtoList=i,e.iscommit=!0;var a={method:"post",url:rootPath+"/assistPlan/saveLowPlanSign",data:e.model},r=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.iscommit=!1,e.initPickLowSign=!0,n(e),common.alert({vm:e,msg:"操作成功！",closeDialog:!0})}})};common.http({vm:e,$http:t,httpOptions:a,success:r,onError:function(){e.iscommit=!1}})}function d(e,o){e.iscommit=!0;var i={method:"delete",url:rootPath+"/assistPlan/cancelLowPlanSign",params:{planId:e.showPlan.id,signIds:o}},a=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.iscommit=!1,e.initPickLowSign=!0,n(e),common.alert({vm:e,msg:"操作成功！",closeDialog:!0})}})};common.http({vm:e,$http:t,httpOptions:i,success:a,onError:function(){e.iscommit=!1}})}function m(t){t.selectPlanId?(t.planList.forEach(function(e,o){e.id==t.selectPlanId&&(t.showPlan=e,t.drawType=t.showPlan.drawType,console.log(t.drawType))}),s(t,t.selectPlanId)):(t.showPlan={},t.pickSign=new Array,t.pickMainSign=new Array,t.lowerSign=new Array,t.selectMainSignId="",t.initPickLowSign=!1)}function u(t){t.lowerSign=new Array,t.pickSign.forEach(function(e,o){t.showPlan.assistPlanSignDtoList.forEach(function(o,i){"0"==o.isMain&&o.mainSignId==t.selectMainSignId&&o.signId==e.signid&&t.lowerSign.push(e)})})}function p(t){t.gridOptions.dataSource.read()}function f(e,o){e.reviewNum="";var i={method:"get",url:rootPath+"/assistPlanSign/getPlanSignByPlanId",params:{planId:o}},n=function(t){e.assistPlanSign=t.data,e.reviewNum=e.assistPlanSign.length,e.assistPlanSign.length>0&&(v(e,o),D(e))};common.http({vm:e,$http:t,httpOptions:i,success:n})}function h(e){e.assistPlan.ministerOpinion=$("#ministerOpinion").val(),e.assistPlan.viceDirectorOpinion=$("#viceDirectorOpinion").val(),e.assistPlan.directorOpinion=$("#directorOpinion").val();var o={method:"put",url:rootPath+"/assistPlanSign/savePlanSign",headers:{contentType:"application/json;charset=utf-8"},dataType:"json",data:angular.toJson(e.assistPlanSign)},i=function(t){};common.http({vm:e,$http:t,httpOptions:o,success:i})}function g(e){var o={method:"put",url:rootPath+"/assistPlan",data:e.assistPlan},i=function(t){alert("保存成功！"),window.parent.$("#planInfo").data("kendoWindow").close()};common.http({vm:e,$http:t,httpOptions:o,success:i})}function v(e,o){var i={method:"get",url:rootPath+"/assistPlan/html/findById",params:{id:o}},n=function(t){e.assistPlan=t.data};common.http({vm:e,$http:t,httpOptions:i,success:n})}function w(e){var o={method:"get",url:rootPath+"/assistUnit/chooseAssistUnit",params:{planId:e.planId,number:e.number,drawType:e.drawType}},i=function(t){e.unitList=t.data,e.signNum=e.unitList.length,e.isChoose=!0};common.http({vm:e,$http:t,httpOptions:o,success:i})}function S(e){var o={method:"post",url:rootPath+"/assistUnitUser/findByOData"},i=function(t){e.unitUserList=t.data.value};common.http({vm:e,$http:t,httpOptions:o,success:i})}function b(e){var o={method:"post",url:rootPath+"/assistUnit/fingByOData"},i=function(t){e.allUnitList=t.data.value};common.http({vm:e,$http:t,httpOptions:o,success:i})}function k(e){var o="",i=e.assistPlanSign.length;e.assistPlanSign.forEach(function(t,e){o+=t.id+"|"+t.assistUnit.id,e!=i-1&&(o+=",")});var n="";if(e.drawAssistUnits.length>0){var a=e.drawAssistUnits.length;e.drawAssistUnits.forEach(function(t,e){n+=t.id,e!=a-1&&(n+=",")})}e.iscommit=!0;var r={method:"put",url:rootPath+"/assistPlan/saveDrawAssistUnit",params:{planId:e.planId,drawAssitUnitIds:o,unSelectedIds:n}},s=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.iscommit=!1,e.isCommited=!0,common.alert({closeDialog:!0,vm:e,msg:"操作成功！"})}})};common.http({vm:e,$http:t,httpOptions:r,success:s,onError:function(t){e.iscommit=!1}})}function y(e,o){if(e.unitList.length<e.num){var i=0;if(e.unitList.forEach(function(t){if(o.id==t.id)return i=-1,void common.alert({vm:e,msg:"该协审单位已被选中！"})}),-1!=i){var n={method:"post",url:rootPath+"/assistPlan/saveChooleUnit",params:{planId:e.showPlan.id,unitId:o.id}},a=function(t){common.alert({vm:e,msg:"添加成功！"})};common.http({vm:e,$http:t,httpOptions:n,success:a})}}else common.alert({vm:e,msg:"当前只能"+e.num+"家单位参与抽签"})}function D(e){var o={method:"get",url:rootPath+"/assistPlan/initAssistUnit",params:{planId:e.showPlan.id}},i=function(t){e.unitList=t.data,e.signNum=e.unitList.length,e.signNum>0&&(e.isChoose=!0)};common.http({vm:e,$http:t,httpOptions:o,success:i})}return{initPlanPage:n,initPlanGrid:i,saveAssistPlan:a,deletePlan:r,findPlanSign:s,cancelPlanSign:l,saveLowPlanSign:c,cancelLowPlanSign:d,initSelPlan:m,showPickLowSign:u,queryPlan:p,getPlanSignByPlanId:f,savePlanSign:h,savePlan:g,initPlanByPlanId:v,chooseAssistUnit:w,saveDrawAssistUnit:k,getUnitUser:S,getAllUnit:b,saveAddChooleUnit:y,initAssistUnitByPlanId:D}}angular.module("app").factory("assistSvc",t),t.$inject=["$http","$state"]}(),function(){"use strict";var t=angular.module("app"),e="template/dialog/alert.html";t.factory("bsWin",["$rootScope","$injector","$templateCache","bsWinConfig",function(t,o,i,n){function a(e){e.msg&&(e.message=e.msg);var o=angular.extend({},n,e),i={winId:c++,scope:t.$new()};return r(i,o),o.onOk&&(i.scope.ok=function(){if(o.onOk&&0==o.onOk.apply(this))return!1;i.el.modal("hide")}),o.onClose&&(i.scope.onClose=function(){if(o.onClose&&0==o.onClose.apply(this))return!1;i.el.modal("hide")}),i.el=s(i.scope,o.templateUrl).on("hidden.bs.modal",function(t){l(i)}).modal("show"),i}function r(t,e){t.scope.title=e.title,t.scope.message=e.message,t.scope.winId=t.winId,t.scope.type=e.type,t.scope.extraData=e.extraData,t.scope.options={onClose:e.onClose}}function s(t,e){var n=o.get("$compile"),a=n(i.get(e))(t);return $(a).appendTo("body")}function l(t){t.scope.$destroy(),t.el.unbind(),t.el.remove(),t.el=null,t=null}var c=0;return{success:function(t,e){return this.alert({message:t,type:"success",onClose:e})},warning:function(t,e){return this.alert({message:t,type:"warning",onClose:e})},error:function(t,e){return this.alert({message:t,type:"error",onClose:e})},alert:function(t,o,i){if(!angular.isObject(t)){var n;!o||angular.isFunction(o)?(i=o,o=t):n=t,t={message:o,onClose:i||function(){}},n&&(t.title=n)}return t.templateUrl=e,a(t)},confirm:function(t,e,o,i){if(!angular.isObject(t)){var n;!e||angular.isFunction(e)?(i=o||function(){},o=e||function(){},e=t):n=t,t={message:e,onOk:o,onClose:i},n&&(t.title=n)}return t.templateUrl="template/dialog/confirm.html",a(t)}}}]),t.constant("bsWinConfig",{title:"提示窗口",message:"",type:"info",timeout:0,templateUrl:e,onOk:null,onClose:function(t){}}),t.run(["$templateCache",function(t){t.put(e,'<div class="alertDialog modal fade" tabindex="-1" role="dialog">                <div class="modal-dialog" role="document" style="margin:80px auto;width:80%;max-width:400px;">                    <div class="modal-content">                        <div class="modal-header">                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>                            <h4 class="modal-title text-info">{{title || \'消息提醒\'}}</h4>                        </div>                        <div class="modal-body text-{{type==\'error\'? \'danger\' : type}}">                            <p class="alertDialogMessage">                                <i class="fa fa-{{type == \'success\' ? \'check\' : (type == \'error\' ? \'ban\' : type)}}" aria-hidden="true"></i>                                 {{message}}                            </p>                        </div>                        <div class="modal-footer">                            <button type="button"  class="btn btn-info" data-dismiss="modal">关闭</button>                        </div>                    </div>                </div>            </div>'),t.put("template/dialog/confirm.html",'<div class="confirmDialog modal fade" tabindex="-1" role="dialog" style="z-index: 10000;">                <div class="modal-dialog" role="document" style="margin:80px auto;width:80%;max-width:400px;">                    <div class="modal-content">                        <div class="modal-header">                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>                            <h4 class="modal-title text-info">{{title||\'提示\'}}</h4>                        </div>                        <div class="modal-body text-primary"><p><i class="fa fa-question-circle" aria-hidden="true"></i> {{message}}</p></div>                        <div class="modal-footer">                            <button type="button" ng-click="ok()" class="btn btn-info" >确认</button>                            <button type="button" ng-click="onClose()" class="btn btn-info" data-dismiss="modal">取消</button>                        </div>                    </div>                </div>            </div>')}])}(),function(){"use strict";function t(t){t?(t.removeData("validator"),t.removeData("unobtrusiveValidation"),$.validator.unobtrusive.parse(t)):($("form").removeData("validator"),$("form").removeData("unobtrusiveValidation"),$.validator.unobtrusive.parse("form"))}function e(t){var e=function(e){j.alert({vm:t.vm,msg:e,fn:function(){t.vm.isSubmit=!1,$(".alertDialog").modal("hide")}})};if(t.response.status>400)e("发生错误！");else{var o=t.response.data;o&&555==o.status?e(o.message):t.fn&&t.fn(o)}}function o(){for(var t=arguments[0],e=1;e<arguments.length;e++){var o=new RegExp("\\{"+(e-1)+"\\}","gm");t=t.replace(o,arguments[e])}return t}function i(t){var e=t.toString().replace(/[^0-9]/g,"");return parseInt(e,10)}function n(t){return isNaN(parseFloat(t,10))?0:parseFloat(t,10)}function a(){return $(window).height()-180}function r(t){t.vm.alertDialogMessage=t.msg,t.vm.alertDialogFn=function(){t.closeDialog&&1==t.closeDialog&&($(".alertDialog").modal("hide"),$(".modal-backdrop").remove()),t.fn?t.fn():$(".alertDialog").modal("hide")},$(".alertDialog").modal({backdrop:"static",keyboard:!1})}function s(t){t.vm.dialogConfirmTitle=t.title,t.vm.dialogConfirmMessage=t.msg,$(".confirmDialog").modal({backdrop:"static"}),t.vm.dialogConfirmSubmit=t.fn,t.cancel?t.vm.dialogConfirmCancel=t.cancel:t.vm.dialogConfirmCancel=function(){$(".confirmDialog").modal("hide")}}function l(t,e){null==e&&(e=""),t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var o=new RegExp("[\\?&]"+t+"=([^&#]*)"),i=o.exec(window.location.href);return null==i?e:i[1]}function c(t,e){return new kendo.data.DataSource({type:"odata",transport:d().transport(t,e),schema:d().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}})}function d(){return{filterable:{extra:!1,operators:{string:{contains:"包含",eq:"等于"},number:{eq:"等于",neq:"不等于",gt:"大于",lt:"小于"},date:{gt:"大于",lt:"小于"}}},pageable:{pageSize:10,previousNext:!0,buttonCount:5,refresh:!0,pageSizes:!0},schema:function(t){return{data:"value",total:function(t){return t.count},model:t}},transport:function(t,e,o){return{read:{url:t,dataType:"json",type:"post",beforeSend:function(t){t.setRequestHeader("Token",j.getToken())},data:function(){if(e){var t=common.buildOdataFilter(e);return t?o&&o.filter?{$filter:t+" and "+o.filter}:{$filter:t}:o&&o.filter?{$filter:o.filter}:{}}return{}}}}},noRecordMessage:{template:"暂时没有数据."}}}function m(){return{filterable:{extra:!1,operators:{string:{contains:"包含",eq:"等于"},number:{eq:"等于",neq:"不等于",gt:"大于",lt:"小于"},date:{gt:"大于",lt:"小于"}}},pageable:{pageSize:10,previousNext:!0,buttonCount:5,refresh:!0,pageSizes:!0},schema:function(t){return{data:"value",total:function(t){return t.count},model:t}},transport:function(t,e,o,i){return{read:{url:e.readUrl,dataType:"json",type:"post",beforeSend:function(t){t.setRequestHeader("Token",j.getToken())},data:function(){if(o){var t=common.buildOdataFilter(o);return t?i&&i.filter?{$filter:t+" and "+i.filter}:{$filter:t}:i&&i.filter?{$filter:i.filter}:{}}return{}}},update:{url:e.updateUrl,dataType:"json",type:"post"},destroy:{url:e.destroyUrl,dataType:"json",type:"post",contentType:"application/json"},create:{url:e.createUrl,dataType:"json",type:"post"},parameterMap:function(e,o){return"create"==o?(e.signid=t.model.signid,kendo.stringify(e)):"update"==o||"destroy"==o?kendo.stringify(e.models):void 0}}},noRecordMessage:{template:"暂时没有数据."}}}function u(t){var e=$(t).find("tr td:nth-child(1)").find("input:checked"),o=[];return e.each(function(){var t=$(this).attr("relId");o.push({name:"id",value:t})}),o}function p(t){t.headers={Token:j.getToken()},t.$http(t.httpOptions).then(t.success,function(e){t.onError&&t.onError(e)})}function f(){return{get:function(t,e){var o=this.getAll(t);return o?o[e]:null},getAll:function(t){var e=encodeURIComponent(t)+"=",o=document.cookie.indexOf(e),i=null,n={};if(o>-1){var a=document.cookie.indexOf(";",o);if(-1==a&&(a=document.cookie.length),i=document.cookie.substring(o+e.length,a),i.length>0){for(var r=i.split("&"),s=0,l=r.length;s<l;s++){var c=r[s].split("=");n[decodeURIComponent(c[0])]=decodeURIComponent(c[1])}return n}}return null},set:function(t,e,o,i,n,a,r){var s=this.getAll(t)||{};s[e]=o,this.setAll(t,s,i,n,a,r)},setAll:function(t,e,o,i,n,a){var r=encodeURIComponent(t)+"=",s=new Array;for(var l in e)l.length>0&&e.hasOwnProperty(l)&&s.push(encodeURIComponent(l)+"="+encodeURIComponent(e[l]));s.length>0?(r+=s.join("&"),o instanceof Date&&(r+=";expires="+o.toGMTString()),i&&(r+=";path="+i),n&&(r+=";domain="+n),a&&(r+=";secure")):r+=";expires="+new Date(0).toGMTString(),document.cookie=r},unset:function(t,e,o,i,n){var a=this.getAll(t);a&&(delete a[e],this.setAll(t,a,null,o,i,n))},unsetAll:function(t,e,o,i){this.setAll(t,null,new Date(0),e,o,i)}}}function h(){var t=f().getAll("data");return null!=t?t.token:""}function g(t){return t.error=function(t){401==t.status&&(location.href=j.loginUrl)},t}function v(t){var e=/^(?:checkbox|radio)$/i,o=/^(?:submit|button|image|reset|file)$/i,i=/^(?:input|select|textarea|keygen)/i;return $(t).map(function(){var t=jQuery.prop(this,"elements");return t?jQuery.makeArray(t):this}).filter(function(){var t=this.type;return this.value&&this.name&&!$(this).is(":disabled")&&i.test(this.nodeName)&&!o.test(t)&&(this.checked||!e.test(t))}).map(function(t,e){var o=$(this),i=o.val();if(!i)return!1;"Integer"!=(o.attr("data-type")||"String")&&(i="'"+i+"'");var n=o.attr("operator")||"eq",a=o.attr("data-role")||"";return"datepicker"==a?i="date"+i:"datetimepicker"==a&&(i="datetime"+i),"like"==n?"substringof("+i+", "+e.name+")":e.name+" "+n+" "+i}).get().join(" and ")}function w(t){if(R){t.scope.dictMetaData=R;var e={};S(e,t.scope.dictMetaData),t.scope.DICT=e}else t.$http({method:"get",url:rootPath+"/dict/dictItems"}).then(function(e){t.scope.dictMetaData=e.data;var o={};S(o,e.data),t.scope.DICT=o},function(t){alert("初始化数据字典失败")})}function S(t,e,o){if(e&&0!=e.length)if(o)for(var i=0;i<e.length;i++){var n=e[i];if(n.parentId&&n.parentId==o){t.dicts||(t.dicts=new Array);var a={};a.dictId=n.dictId,a.dictName=n.dictName,a.dictCode=n.dictCode,a.dictKey=n.dictKey,a.dictSort=n.dictSort,t.dicts.push(a),S(a,e,n.dictId)}}else for(var i=0;i<e.length;i++){var n=e[i];n.parentId||(t[n.dictCode]={},t[n.dictCode].dictId=n.dictId,t[n.dictCode].dictCode=n.dictCode,t[n.dictCode].dictName=n.dictName,t[n.dictCode].dictKey=n.dictKey,t[n.dictCode].dictSort=n.dictSort,S(t[n.dictCode],e,n.dictId))}}function b(t){return{async:{saveUrl:rootPath+"/file",removeUrl:rootPath+"/file/delete",autoUpload:!1},select:function(e){t.onSelect?t.onSelect(e):$.each(e.files,function(t,e){console.log("Name: "+e.name+"Size: "+e.size+" bytesExtension: "+e.extension)})},upload:function(e){if(t.onUpload)t.onUpload(e);else{e.files;console.log(e.response)}},success:function(e){if(t.onSuccess)t.onSuccess(e);else{var o=e.files;"upload"==e.operation&&(o[0].sysFileId=e.response.sysFileId)}},remove:function(e){if(t.onRemove)t.onRemove(e);else{var o=e.files;e.data={sysFileId:o[0].sysFileId}}}}}function k(t){t.$http({method:"get",url:rootPath+"/flow/html/tasksCount"}).then(function(t){$("#GtasksCount").html(t.data)})}function y(t){t.$http({method:"get",url:rootPath+"/projectStop/pauseProjectCount"}).then(function(t){$("#pauseCount").html(t.data)})}function D(t,e,o){t.ideaContent="",t.$http=e,t.i=1,$("#ideaWindow").kendoWindow({width:"50%",height:"80%",title:"意见选择",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open(),t.$http({method:"get",url:rootPath+"/idea"}).then(function(e){t.commonIdeas=e.data,
t.deleteCommonIdea=function(){U(t)},t.addCorrentIdea=function(e){M(t,e)},t.addCommonIdea=function(){T(t)},t.saveCommonIdea=function(){E(t)},t.saveCurrentIdea=function(){N(t,o)}})}function x(t,e){console.log(e.$state.params.id),e.$http({method:"get",url:rootPath+"/addSuppLetter",headers:{contentType:"application/json;charset=utf-8"},dataType:"json",params:{signid:e.$state.params.signid,id:e.$state.params.id}}).then(function(e){t.suppletter=e.data}),t.saveSuppletter=function(){t.suppletter.id?I(t,e):P(t,e)},t.suppletter.id&&C(t,e)}function P(t,e){console.log(t.suppletter),e.$http({method:"post",url:rootPath+"/addSuppLetter/add",headers:{contentType:"application/json;charset=utf-8"},dataType:"json",data:t.suppletter}).then(function(t){alert("保存成功！")})}function I(t,e){e.$http({method:"post",url:rootPath+"/addSuppLetter/update",headers:{contentType:"application/json;charset=utf-8"},dataType:"json",data:t.suppletter}).then(function(t){alert("更新成功！")})}function C(t,e){e.$http({method:"post",url:rootPath+"/addSuppLetter/getbyId",headers:{contentType:"application/json;charset=utf-8"},dataType:"json",data:t.suppletter.id}).then(function(e){t.suppletter=e.data})}function O(t,e){t.showPrint=!0,$("#printWindow").kendoWindow({width:"50%",height:"60%",title:"打印登记补充资料",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open(),F(t,e)}function F(t,e){e.$http({method:"post",url:rootPath+"/addRegisterFile/initprintdata",headers:{contentType:"application/json;charset=utf-8"},dataType:"json",params:{signid:t.model.signid}}).then(function(e){t.registerFileList=e.data.AddRegisterFileDtoList,t.signdto=e.data.signdto,t.printDate=e.data.printDate})}function U(t){var e=$("#commonIdeaTable input[name='ideaCheck']:checked");if(e.length<1)alert("请选择要删除的意见！");else{for(var o=[],i=0;i<e.length;i++)t.commonIdeas.forEach(function(n,a){e[i].value!=n.ideaID&&void 0!=n.ideaID||t.commonIdeas.splice(a,1),o.push(e[i].value)});var n=o.join(",");t.$http({method:"delete",url:rootPath+"/idea",params:{ideas:n}})}}function M(t,e){t.ideaContent=t.ideaContent+e}function T(t){t.commonIdea={},t.commonIdea.ideaType="个人常用意见",t.commonIdeas.push(t.commonIdea),t.i++}function E(t){t.$http({method:"post",url:rootPath+"/idea",headers:{contentType:"application/json;charset=utf-8"},dataType:"json",data:angular.toJson(t.commonIdeas)}).then(function(t){alert("保存成功！")})}function N(t,e){var o=$("#"+e.targetId);o.val(o.val()+t.ideaContent),window.parent.$("#ideaWindow").data("kendoWindow").close(),o.focus()}var R,j={initJqValidation:t,requestSuccess:e,format:o,blockNonNumber:i,floatNumberInput:n,adminContentHeight:a,alert:r,confirm:s,getQuerystring:l,kendoGridConfig:d,getKendoCheckId:u,cookie:f,getToken:h,appPath:"",http:p,gridDataSource:g,loginUrl:window.rootPath+"/home/login",buildOdataFilter:v,initDictData:w,kendoGridDataSource:c,initUploadOption:b,getTaskCount:k,getPauseProjectCount:y,initIdeaData:D,deleteCommonIdea:U,addCommonIdea:T,saveCommonIdea:E,addCorrentIdea:M,saveCurrentIdea:N,initSuppData:x,saveSuppletter:P,registerFilePrint:O,initPrintData:F,kendoGridinlineConfig:m,initDictItems:function(t){R=t}};window.common=j,function(){$(document).on("click","#checkboxAll",function(){var t=$(this).is(":checked");$(".grid").find("tr td:nth-child(1)").find("input:checkbox").prop("checked",t)}),$("body").on("click",".grid tr",function(t){$(this).parent().find("tr").removeClass("selected"),$(this).addClass("selected")})}()}(),function(){"use strict";function t(t,o){return{request:function(t){return t.headers.Token=common.getToken(),t.headers["X-Requested-With"]="XMLHttpRequest",t},responseError:function(i){return i.config.headers.commonHttp||e(o,i.status,i.data),t.reject(i)}}}function e(t,e,o){switch(e){case 500:t.error("系统内部错误");break;case 401:t.warning("登录信息失效或您没有权限,请重新登录!");break;case 403:t.warning("无权限执行此操作");break;case 404:t.error("未找到相应的操作");break;case 408:t.warning("请求超时");break;case 412:t.warning(o.message||"操作失败");break;case 499:t.warning(o.message||"您的账号已在别的地方登录，请确认密码是否被修改！");break;default:t.error("发生错误,系统已记录,我们会尽快处理！")}}var o=angular.module("app");o.factory("commonHttpInterceptor",["$injector","bsWin",t]),o.config(["$httpProvider",function(e){e.interceptors.push(t)}]),jQuery&&jQuery(document).ajaxSend(function(t,e,o){e.setRequestHeader("Token",common.getToken())}).ajaxError(function(t,o,i,n){var a=angular.element("body"),r=a.scope(),s=a.injector().get("bsWin"),l=angular.isString(o.responseText)?JSON.parse(o.responseText||"{}"):o.responseText;r.$apply(function(){e(s,o.status,l||{})})})}(),function(){"use strict";function t(t,e){var o=this;o.title="单位列表",o.del=function(t){common.confirm({vm:o,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),e.deletecompany(o,t)}})},o.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)common.alert({vm:o,msg:"请选择数据"});else{for(var e=[],i=0;i<t.length;i++)e.push(t[i].value);var n=e.join(",");o.del(n)}},o.queryConpany=function(){e.queryConpany(o)},function(){e.grid(o)}()}angular.module("app").controller("companyCtrl",t),t.$inject=["$location","companySvc"]}(),function(){"use strict";function t(t,e,o){var i=this;i.title="新增单位",i.iscompanyExist=!1,i.id=o.params.id,i.id&&(i.isUpdate=!0,i.title="更新单位"),i.create=function(){e.createcompany(i)},i.update=function(){e.updatecompany(i)},function(){i.isUpdate&&e.getcompanyById(i)}()}angular.module("app").controller("companyEditCtrl",t),t.$inject=["$location","companySvc","$state"]}(),function(){"use strict";function t(t,e){function o(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(l+"/fingByOData",$("#form")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=function(){var t=this.items(),e=this.pager.page()-1,o=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*o,i=$(this).find(".row-number");$(i).html(t)})},i=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"coName",title:"单位名称",width:220,filterable:!1},{field:"coPhone",title:"单位电话",width:100,filterable:!1},{field:"coPC",title:"邮编",width:100,filterable:!1},{field:"coAddress",title:"地址",width:160,filterable:!1},{field:"coType",title:"单位类型",width:160,filterable:!1},{field:"",title:"操作",width:200,template:function(t){return common.format($("#columnBtns").html(),"vm.del('"+t.id+"')",t.id)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:o,resizable:!0}}function i(t){t.gridOptions.dataSource.read()}function n(e){if(common.initJqValidation(),$("form").valid()&&0==e.iscompanyExist){e.isSubmit=!0;var o={method:"post",url:l,data:e.model},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=c}})}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}}function a(e){var o={method:"get",url:l+"/html/findByIdCompany",params:{id:e.id}},i=function(t){e.model=t.data,console.log(e.model)};common.http({vm:e,$http:t,httpOptions:o,success:i})}function r(e){if(common.initJqValidation(),$("form").valid()&&0==e.iscompanyExist){e.isSubmit=!0,e.model.id=e.id;var o={method:"put",url:l,data:e.model},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}}function s(e,o){e.isSubmit=!0;var i={method:"delete",url:l,data:o},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.isSubmit=!1,e.gridOptions.dataSource.read()}})};common.http({vm:e,$http:t,httpOptions:i,success:n})}var l=rootPath+"/company",c="#/company";rootPath;return{grid:o,createcompany:n,getcompanyById:a,updatecompany:r,deletecompany:s,queryConpany:i}}angular.module("app").factory("companySvc",t),t.$inject=["$http","$compile"]}(),function(){"use strict";function t(t,e){var o=this;o.title="处室管理",o.del=function(t){common.confirm({vm:o,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),e.deleteDept(o,t)}})},o.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)common.alert({vm:o,msg:"请选择数据"});else{for(var e=[],i=0;i<t.length;i++)e.push(t[i].value);var n=e.join(",");o.del(n)}},o.queryDept=function(){e.queryDept(o)},function(){e.grid(o)}()}angular.module("app").controller("deptCtrl",t),t.$inject=["$location","deptSvc"]}(),function(){"use strict";function t(t,e,o){var i=this;i.title="编辑处室",i.isuserExist=!1,i.deptId=o.params.deptId,i.deptId&&(i.isUpdate=!0,i.title="更新处室"),i.create=function(){e.createDept(i)},i.update=function(){e.updateDept(i)},function(){i.isUpdate&&e.getDeptById(i)}()}angular.module("app").controller("deptEditCtrl",t),t.$inject=["$location","deptSvc","$state"]}(),function(){"use strict";function t(t){function e(t){t.gridOptions.dataSource.read()}function o(e){if(common.initJqValidation(),$("form").valid()){e.isSubmit=!0;var o={method:"put",url:s,data:e.model},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",closeDialog:!0,fn:function(){e.isSubmit=!1}})}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}}function i(e,o){e.isSubmit=!0;var i={method:"delete",url:s,data:o},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",closeDialog:!0,fn:function(){e.isSubmit=!1,e.gridOptions.dataSource.read()}})}})};common.http({vm:e,$http:t,httpOptions:i,success:n})}function n(e){if(common.initJqValidation(),$("form").valid()){e.isSubmit=!0;var o={method:"post",url:s,data:e.model},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",closeDialog:!0,fn:function(){e.isSubmit=!1,location.href=l}})}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}}function a(e){var o={method:"get",url:rootPath+"/dept/html/findById",params:{deptId:e.deptId}},i=function(t){t.data.offices&&(e.offices={},e.offiecs=t.data.offices),e.model=t.data};common.http({vm:e,$http:t,httpOptions:o,success:i})}function r(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(s+"/fingByOData",$("#formDept")),schema:common.kendoGridConfig().schema({id:"deptId",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=function(){var t=this.items(),e=this.pager.page()-1,o=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*o,i=$(this).find(".row-number");$(i).html(t)})},i=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.deptId)},filterable:!1,width:20,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:30,filterable:!1,template:"<span class='row-number'></span>"},{field:"deptName",title:"处室名称",width:100,filterable:!1},{field:"deptUserName",title:"联系人",width:100,filterable:!1},{field:"address",title:"地址",width:100,filterable:!1},{field:"deptType",title:"类型",width:100,filterable:!1},{field:"",title:"状态",width:100,filterable:!1,template:function(t){return t.status?5==t.status?"正常":7==t.status?"已删除":void 0:" "}},{field:"",title:"操作",width:140,template:function(t){return common.format($("#columnBtns").html(),"vm.del('"+t.deptId+"')",t.deptId,t.deptId)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:o,resizable:!0}}var s=rootPath+"/dept",l="#/listDept";return{grid:r,getDeptById:a,createDept:n,deleteDept:i,updateDept:o,queryDept:e}}angular.module("app").factory("deptSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e,o,i){var n=this;n.title="办事处人员列表",n.id=e.params.deptId,n.showAddUserDialog=function(){$(".addUser").modal({backdrop:"static",keyboard:!1}),n.deptOfficeGrid.dataSource.read()},n.closeAddUserDialog=function(){$(".addUser").modal("hide")},n.addOfficeUser=function(t){i.addOfficeUser(n,t)},n.remove=function(t){common.confirm({vm:n,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),i.deletedeptOfficeUser(n,t)}})},n.removes=function(){var t=common.getKendoCheckId(".deptOfficeGrid");if(0==t.length)common.alert({vm:n,msg:"请选择数据"});else{for(var e=[],o=0;o<t.length;o++)e.push(t[o].value);var i=e.join(",");n.remove(i)}},function(){i.grid(n),i.deptOfficeGrid(n)}()}angular.module("app").controller("deptOfficeUserCtrl",t),t.$inject=["$location","$state","deptSvc","deptOfficeUserSvc"]}(),function(){"use strict";function t(t){function e(e,o){var i={method:"post",url:rootPath+"/dept/addOfficeUser",params:{deptId:e.id,officeId:o}},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.deptOfficeGrid.dataSource.read(),e.gridOptions.dataSource.read()}})};common.http({vm:e,$http:t,httpOptions:i,success:n})}function o(e){var o={method:"get",url:common.format(c+"/getDepts")},i=function(t){e.depts={},e.depts=t.data};common.http({vm:e,$http:t,httpOptions:o,success:i})}function i(e){if(common.initJqValidation(),$("form").valid()){e.isSubmit=!0,e.model.id=e.id;var o={method:"put",url:c,data:e.model},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}}function n(e,o){e.isSubmit=!0;var i={method:"delete",url:rootPath+"/dept/deleteOfficeUsers",params:{deptId:e.id,officeId:o}},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",closeDialog:!0,fn:function(){e.isSubmit=!1,e.gridOptions.dataSource.read()}})}})};common.http({vm:e,$http:t,httpOptions:i,success:n})}function a(e){if(common.initJqValidation(),$("form").valid()){e.isSubmit=!0;var o={method:"post",url:c,data:e.model},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",closeDialog:!0,fn:function(){e.isSubmit=!1,location.href=d}})}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}}function r(e){var o={method:"get",url:rootPath+"/dept/html/findById",params:{officeID:e.officeID}},i=function(t){t.data.dept&&(e.depts={}),e.model=t.data};common.http({vm:e,$http:t,httpOptions:o,success:i})}function s(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(u+"?deptId="+t.id),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.officeID)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"officeUserName",title:"办事处联系人",width:100,filterable:!1},{field:"officePhone",title:"电话",width:100,filterable:!1},{field:"officeDesc",title:"描述",width:100,filterable:!1},{field:"",title:"操作",width:140,template:function(t){return common.format($("#allUserGridBtns").html(),"vm.addOfficeUser('"+t.officeID+"')",t.officeID)}}];t.deptOfficeGrid={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,resizable:!0}}function l(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(m+"?deptId="+t.id),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.officeID)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"officeUserName",title:"办事处联系人",width:100,filterable:!1},{field:"officePhone",title:"电话",width:100,filterable:!1},{field:"officeDesc",title:"描述",width:100,filterable:!1},{field:"",title:"操作",width:140,template:function(t){return common.format($("#columnBtns").html(),"vm.remove('"+t.officeID+"')",t.officeID)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,resizable:!0}}var c=rootPath+"/dept",d="#/deptList",m=rootPath+"/dept/getDeptOfficeUsers",u=rootPath+"/dept/NotInoDeptfficeUsers";return{grid:l,getdeptById:r,createdept:a,deletedeptOfficeUser:n,updatedept:i,getDepts:o,deptOfficeGrid:s,addOfficeUser:e}}angular.module("app").factory("deptOfficeUserSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e,o){var i=this;i.title="字典",i.model={},i.del=function(t){common.confirm({vm:i,title:"",msg:"删除字典将会连下级字典一起删除，确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),e.deleteDict(i,t)}})},i.dels=function(){var t=i.dictsTree.getSelectedNodes();t&&t.length>0?i.del(t[0].id):common.alert({vm:i,msg:"请选择数据"})},function(){e.initDictTree(i)}()}angular.module("app").controller("dictCtrl",t),t.$inject=["$location","dictSvc","$scope"]}(),function(){"use strict";function t(t,e,o,i){var n=this;n.title="增加字典",n.model={},n.id=i.params.id,n.id&&(n.isUpdate=!0,n.title="编辑字典"),n.model.dictSort=0,n.createDict=function(){o.createDict(n)},n.updateDict=function(){o.updateDict(n)},n.dictTypeChange=function(){n.model.dictType&&(n.model.dictKey="")},n.apply=function(){t.$apply()},function(){n.isUpdate?o.getDictById(n):(n.model.dictCode="",o.initpZtreeClient(n))}()}angular.module("app").controller("dictEditCtrl",t),t.$inject=["$scope","$location","dictSvc","$state"]}(),function(){"use strict";function t(t,e,o){function i(e){var o={method:"get",url:common.format(p+"?dictCode={0}","DICT_SEX")},i=function(t){};common.http({vm:e,$http:t,httpOptions:o,success:i})}function n(e){var o={method:"get",url:u},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){if(e.treeData={},e.treeData=t.data.value,e.isUpdate&&e.treeData&&e.model.parentId)for(var o=0;o<e.treeData.length;o++)if(e.treeData[o].dictId==e.model.parentId){e.model.parentDictName=e.treeData[o].dictName;break}}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}function a(o,i){o.isSubmit=!0;var n={method:"delete",url:u,data:i},a=function(t){common.requestSuccess({vm:o,response:t,fn:function(){o.isSubmit=!1,location.href=m,common.alert({vm:o,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),e.go("dict",{},{reload:!0})}})}})};common.http({vm:o,$http:t,httpOptions:n,success:a})}function r(o){common.initJqValidation();var i=$("form").valid(),n=o.zpTree.getCheckedNodes(!0);if(n&&n.length>0&&(o.model.parentId=n[0].id),i){o.isSubmit=!0;var a={method:"post",url:u,data:o.model},r=function(t){common.requestSuccess({vm:o,response:t,fn:function(){common.alert({vm:o,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),e.go("dict",{},{reload:!0})}})}})};common.http({vm:o,$http:t,httpOptions:a,success:r})}}function s(o){if(common.initJqValidation(),$("form").valid()){o.isSubmit=!0;var i={method:"put",url:u,data:o.model},n=function(t){common.requestSuccess({vm:o,response:t,fn:function(){common.alert({vm:o,msg:"操作成功",fn:function(){o.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),e.go("dict.edit",{id:o.model.dictId},{reload:!0})}})}})};common.http({vm:o,$http:t,httpOptions:i,success:n})}}function l(o){var i={method:"get",url:u+"?$orderby=dictSort"},n=function(t){common.requestSuccess({vm:o,response:t,fn:function(){function i(t,o,i){e.go("dict.edit",{id:i.id})}var n,a={callback:{onClick:i},data:{simpleData:{enable:!0,idKey:"id",pIdKey:"pId"}}},r=$linq(t.data.value).select(function(t){var e=null;return t.parentId&&(e=t.parentId),{id:t.dictId,name:t.dictName,pId:e}}).toArray();n=$.fn.zTree.init($("#zTree"),a,r),o.dictsTree=n}})};common.http({vm:o,$http:t,httpOptions:i,success:n})}function c(e){var o={method:"get",url:u+"?$orderby=dictSort"},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){var o={check:{enable:!0,chkStyle:"radio",radioType:"all"},callback:{},data:{simpleData:{enable:!0,idKey:"id",pIdKey:"pId"}}},i=$linq(t.data.value).select(function(t){var e;return t.parentId&&(e=t.parentId),{id:t.dictId,name:t.dictName,pId:e}}).toArray();e.zpTree=$.fn.zTree.init($("#pzTree"),o,i)}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}function d(e){var o={method:"get",url:common.format(u+"?$filter=dictId eq '{0}'",e.id)},i=function(t){e.model=t.data.value[0],n(e)};common.http({vm:e,$http:t,httpOptions:o,success:i})}var m="#/dict",u=rootPath+"/dict",p=rootPath+"/dict/dictNameData";return{initDictTree:l,createDict:r,getDictById:d,updateDict:s,deleteDict:a,initpZtreeClient:c,getTreeData:n,getdictItems:i}}angular.module("app").factory("dictSvc",t),t.$inject=["$http","$state","$location"]}(),function(){"dispatch strict";function t(t,e,o,i){var n=this;n.title="项目发文编辑",n.sign={},n.searchSign={},n.dispatchDoc={},n.dispatchDoc.signId=o.params.signid,n.showFlag={buttSysFile:!1},n.busiFlag={isMerge:!1,isMain:!1},function(){e.initDispatchData(n)}(),n.sigleProject=function(){"1"==n.dispatchDoc.dispatchWay?n.busiFlag.isMerge&&n.busiFlag.isMain&&i.confirm({title:"询问提示",message:"该项目已经设为合并发文，并且已经有关联项目，如果现在要取消合并发文，以前的关联信息将被删除，您确定要取消合并发文么?",onOk:function(){$(".confirmDialog").modal("hide"),e.cancelProject(n.dispatchDoc.signId,null,function(t){(t.flag||"ok"==t.reCode)&&(n.dispatchDoc.isMainProject="0",n.busiFlag.isMerge=!1,n.busiFlag.isMain=!1),i.alert(t.reMsg)})},onClose:function(){n.dispatchDoc.dispatchWay="2",$(".confirmDialog").modal("hide")}}):"2"==n.dispatchDoc.dispatchWay&&(n.busiFlag.isMerge||(n.busiFlag.isMerge=!0,n.busiFlag.isMain="9"==n.dispatchDoc.isMainProject))},n.create=function(){e.saveDispatch(n)},n.count=function(){var t=/^(-)?(([1-9]{1}\d*)|([0]{1}))(\.(\d){1,4})?$/;if(!t.test(n.dispatchDoc.declareValue))return n.dispatchDoc.declareValue=0,void $("span[data-valmsg-for='declareValue']").html("金额只能输入数字！");if(!t.test(n.dispatchDoc.authorizeValue))return n.dispatchDoc.authorizeValue=0,void $("span[data-valmsg-for='authorizeValue']").html("金额只能输入数字！");$("span[data-valmsg-for='declareValue']").html(""),$("span[data-valmsg-for='authorizeValue']").html("");var e=(parseFloat(n.dispatchDoc.declareValue)-parseFloat(n.dispatchDoc.authorizeValue)).toFixed(2),o=parseFloat(e/n.dispatchDoc.declareValue*1e4/100).toFixed(2);n.dispatchDoc.extraRate=o,n.dispatchDoc.extraValue=e},n.gotoMergePage=function(){n.busiFlag.isMain="9"==n.dispatchDoc.isMainProject,9!=n.dispatchDoc.isMainProject&&n.dispatchDoc.id?(e.initMergeInfo(n,n.dispatchDoc.signId),$("#mwindow").kendoWindow({width:"1200px",height:"630px",title:"合并发文",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()):i.alert("请先保存！")},n.chooseProject=function(){var t=$("input[name='checksign']:checked");if(0==t.length)i.alert("请选择要合并发文的项目！");else{var o=[];$.each(t,function(t,e){o.push(e.value)}),e.chooseProject(n.dispatchDoc.signId,o.join(","),function(t){(t.flag||"ok"==t.reCode)&&e.initMergeInfo(n,n.dispatchDoc.signId),i.alert(t.reMsg)})}},n.cancelProject=function(){var t=$("input[name='checkss']:checked");if(t.length<1)i.alert("请选择要取消合并发文的项目！");else{var o=[];$.each(t,function(t,e){o.push(e.value)}),e.cancelProject(n.dispatchDoc.signId,o.join(","),function(t){(t.flag||"ok"==t.reCode)&&e.initMergeInfo(n,n.dispatchDoc.signId),i.alert(t.reMsg)})}},n.onClose=function(){window.parent.$("#mwindow").data("kendoWindow").close()},n.filterMergeSign=function(t){var e=!0;if(n.searchSign.projectname&&-1==t.projectname.indexOf(n.searchSign.projectname)&&(e=!1),n.searchSign.reviewstage&&t.reviewstage!=n.searchSign.reviewstage&&(e=!1),n.searchSign.builtcompanyName&&-1==t.builtcompanyName.indexOf(n.searchSign.builtcompanyName)&&(e=!1),e)return t},n.formReset=function(){n.searchSign={}}}angular.module("app").controller("dispatchEditCtrl",t),t.$inject=["$location","dispatchSvc","$state","bsWin"]}(),function(){"dispatch strict";function t(t,e,o,i){function n(t,e){d(e,function(e){t.signs=[],t.signs=e}),c(e,function(e){t.selectedSign=[],t.selectedSign=e})}function a(i){i.busiFlag.signleToMerge=!1;var n={method:"get",url:rootPath+"/dispatch/initData",params:{signid:i.dispatchDoc.signId}},a=function(e){var n=e.data;i.sign=n.sign,i.dispatchDoc=n.dispatch,i.dispatchDoc.signId=o.params.signid,i.dispatchDoc.dispatchWay&&2==i.dispatchDoc.dispatchWay&&(i.busiFlag.isMerge=!0),i.dispatchDoc.isMainProject&&9==i.dispatchDoc.isMainProject&&(i.busiFlag.isMain=!0),i.associateDispatchs=n.associateDispatchs,i.proofread=n.mainUserList,i.dispatchDoc.id&&(i.showFlag.buttSysFile=!0,t.initUploadOptions({businessId:i.dispatchDoc.id,sysSignId:i.dispatchDoc.signId,sysfileType:"发文",uploadBt:"upload_file_bt",detailBt:"detail_file_bt",vm:i}))};common.http({vm:i,$http:e,httpOptions:n,success:a})}function r(o){o.isCommit=!0;var n={method:"post",url:rootPath+"/dispatch",data:o.dispatchDoc},a=function(e){o.isCommit=!1,(e.data.flag||"ok"==e.data.reCode)&&(o.dispatchDoc.dispatchWay&&2==o.dispatchDoc.dispatchWay&&(o.busiFlag.isMerge=!0),o.dispatchDoc.isMainProject&&9==o.dispatchDoc.isMainProject&&(o.busiFlag.isMain=!0),o.dispatchDoc.id||(o.dispatchDoc.id=e.data.reObj.id,o.showFlag.buttSysFile=!0,t.initUploadOptions({businessId:o.dispatchDoc.id,sysSignId:o.dispatchDoc.signId,sysfileType:"发文",uploadBt:"upload_file_bt",detailBt:"detail_file_bt",vm:o}))),i.alert(e.data.reMsg)};common.http({$http:e,httpOptions:n,success:a,onError:function(){o.isCommit=!1}})}function s(t,o,i){var n={method:"post",url:rootPath+"/sign/mergeSign",params:{signId:t,mergeIds:o,mergeType:"2"}},a=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:e,httpOptions:n,success:a})}function l(t,o,i){var n={signId:t,mergeType:"2"};o&&(n.cancelIds=o);var a={method:"post",url:rootPath+"/sign/cancelMergeSign",params:n},r=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:e,httpOptions:a,success:r})}function c(t,o){var i={method:"post",url:rootPath+"/sign/getMergeDISSign",params:{signId:t}},n=function(t){void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:e,httpOptions:i,success:n})}function d(t,o){var i={method:"post",url:rootPath+"/sign/unMergeDISSign",params:{signId:t}},n=function(t){void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:e,httpOptions:i,success:n})}return{initDispatchData:a,saveDispatch:r,initMergeInfo:n,unMergeDISSign:d,getMergeDISSign:c,chooseProject:s,cancelProject:l}}angular.module("app").factory("dispatchSvc",t),t.$inject=["sysfileSvc","$http","$state","bsWin"]}(),function(){"use strict";function t(t,e){var o=this;o.searchAudit=function(){e.searchAudit(o)},o.auditToOfficial=function(){e.auditTo(o,2)},o.auditToAlternative=function(){e.auditTo(o,3)},o.auditToStop=function(){e.auditTo(o,4)},o.auditToRemove=function(){e.auditTo(o,5)},o.officialToAudit=function(){e.toAudit(o,2)},o.alternativeToAudit=function(){e.toAudit(o,3)},o.stopToAudit=function(){e.toAudit(o,4)},o.temoveToAudit=function(){e.toAudit(o,5)},function(){e.auditGrid(o)}()}angular.module("app").controller("expertAuditCtrl",t),t.$inject=["$location","expertSvc"]}(),function(){"expert strict";function t(t,e){var o=this;o.data={},o.title="专家列表",function(){e.grid(o)}(),o.search=function(){e.searchMuti(o)},o.searchAudit=function(){e.searchMAudit(o)},o.formReset=function(){e.formReset(o)},o.del=function(t){common.confirm({vm:o,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),e.deleteExpert(o,t)}})},o.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)common.alert({vm:o,msg:"请选择数据"});else{for(var e=[],i=0;i<t.length;i++)e.push(t[i].value);var n=e.join(",");o.del(n)}}}angular.module("app").controller("expertCtrl",t),t.$inject=["$location","expertSvc"]}(),function(){"expert strict";function t(t,e,o,i,n,a,r){var s=this;s.model={},s.title="专家信息录入",s.isuserExist=!1,s.isHide=!0,s.isUpdate=!1,s.expertID=r.params.expertID,s.expertOfferList={},s.expertOffer={},function(){s.showSS=!0,s.showSC=!1,s.showWS=!0,s.showWC=!1,s.MW=!1,s.MS=!1,e.initProjectType(s),s.expertID&&(s.title="更新专家",s.isHide=!1,s.isUpdate=!0,i.getExpertById(s))}(),s.showUploadWin=function(){s.model.expertID?$("#uploadWin").kendoWindow({width:"660px",height:"360px",title:"上传头像",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open():common.alert({vm:s,msg:"先保存数据在执行操作！"})},s.create=function(){i.createExpert(s)},s.update=function(){i.updateExpert(s)},s.gotoWPage=function(){s.createWork=!0,o.gotoWPage(s)},s.updateWorkPage=function(){s.createWork=!1,o.updateWorkPage(s)},s.createWorks=function(){s.createWork=!0,s.work.expertID=s.model.expertID,o.createWork(s)},s.updateWork=function(){o.updateWork(s)},s.deleteWork=function(){o.deleteWork(s)},s.onWClose=function(){o.cleanValue(),window.parent.$("#wrwindow").data("kendoWindow").close()},s.onPClose=function(){e.cleanValue(),window.parent.$("#pjwindow").data("kendoWindow").close()},s.gotoJPage=function(){s.createProject=!0,e.gotoJPage(s)},s.updateProject=function(){e.updateProject(s)},s.createProjects=function(){s.createProject=!0,s.project.expertID=s.model.expertID,e.createProject(s)},s.updateProjectPage=function(){s.createProject=!1,e.updateProjectPage(s)},s.delertProject=function(){e.delertProject(s)},s.gotoExpertType=function(t){s.isUpdate=!1,a.gotoExpertType(s)},s.onETlose=function(){a.cleanValue(),window.parent.$("#addExpertType").data("kendoWindow").close()},s.createExpertType=function(){s.createExpertType=!0,s.expertType.expertID=s.model.expertID,a.createExpertType(s)},s.updateProjectType=function(){s.isUpdate=!0,s.createExpertType=!1,a.updateExpertType(s)},s.saveUpdateExpertType=function(){a.saveUpdate(s)},s.delertProjectType=function(){a.deleteExpertType(s)},s.gotoOfferPage=function(){$("#ep_offer_div").kendoWindow({width:"800px",height:"600px",title:"专家聘书",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},s.saveOffer=function(){s.model.expertID?n.saveOffer(s):common.alert({vm:s,msg:"先保存专家信息！"})},s.closeOffer=function(){window.parent.$("#ep_offer_div").data("kendoWindow").close()},s.showOffer=function(t){s.expertOffer={},s.expertOfferList.forEach(function(e,o){if(e.id==t)return void(s.expertOffer=e)}),s.gotoOfferPage()},s.chooseMW=function(){s.MW=!0,s.showWS=!0,s.showWC=!1},s.cancelMW=function(){s.showWS=!1,s.showWC=!0},s.sureMW=function(){s.majorWork?(s.model.majorWork=s.majorWork,s.showWS=!1,s.showWC=!0):common.alert({vm:s,msg:"您未选择专业，请选择！",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}})},s.chooseMS=function(){s.MS=!0,s.showSS=!0,s.showSC=!1},s.cancelMS=function(){s.showSS=!1,s.showSC=!0},s.sureMS=function(){s.majorStudy?(s.model.majorStudy=s.majorStudy,s.showSS=!1,s.showSC=!0):common.alert({vm:s,msg:"您未选择专业，请选择！",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}})}}angular.module("app").controller("expertEditCtrl",t),t.$inject=["$location","projectExpeSvc","workExpeSvc","expertSvc","expertOfferSvc","expertTypeSvc","$state"]}(),function(){"use strict";function t(t,e){var o=this;!function(){
e.repeatGrid(o)}()}angular.module("app").controller("expertRepeatCtrl",t),t.$inject=["$location","expertSvc"]}(),function(){"expert strict";function t(t){function e(t){$("#searchform")[0].reset(),t.gridOptions.dataSource.read()}function o(e){common.initJqValidation();$("form").valid();e.isSubmit=!0,e.model.expertID=e.expertID,e.model.birthDay=$("#birthDay").val(),e.model.createDate=$("#createDate").val();var o={method:"put",url:v,data:e.model},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.isSubmit=!1,common.alert({vm:e,msg:"操作成功"})}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}function i(e,o){e.isSubmit=!0;var i={method:"delete",url:v,data:o},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.isSubmit=!1,e.gridOptions.dataSource.read()}})};common.http({vm:e,$http:t,httpOptions:i,success:n})}function n(t){t.gridOptions.dataSource.read()}function a(e){if(common.initJqValidation(),$("form").valid()){e.isSubmit=!0,e.model.birthDay=$("#birthDay").val(),e.model.graduateDate=$("#graduateDate").val();var o={method:"post",url:v,data:e.model},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.model.expertID=t.data.expertID,e.isUpdate=!0,e.showBt=!0,e.isSubmit=!1,common.alert({vm:e,msg:"操作成功"})}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}}function r(e,o){var i={method:"get",url:v+"/findById",params:{id:e.expertID}},n=function(t){e.showBt=!0,e.model=t.data,e.model.majorWork&&(e.showWS=!1,e.showWC=!0),e.model.majorStudy&&(e.showSC=!0,e.showSS=!1),t.data.workDto&&t.data.workDto.length>0&&(e.showWorkHistory=!0,e.workList=t.data.workDto),t.data.projectDto&&t.data.projectDto.length>0&&(e.projectkHistory=!0,e.projectList=t.data.projectDto),t.data.expertTypeDtoList&&t.data.expertTypeDtoList.length>0&&(e.expertTypeList=!0,e.expertTypeList=t.data.expertTypeDtoList),t.data.expertOfferDtoList&&t.data.expertOfferDtoList.length>0&&(e.showExpertOffer=!0,e.expertOfferList=t.data.expertOfferDtoList),g(e),$("#expertPhotoSrc").attr("src",rootPath+"/expert/transportImg?expertId="+e.model.expertID+"&t="+Math.random())};common.http({vm:e,$http:t,httpOptions:i,success:n})}function s(t){var e=common.kendoGridDataSource(rootPath+"/expert/findByOData",$("#searchform")),o=function(){var t=this.items(),e=this.pager.page()-1,o=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*o,i=$(this).find(".row-number");$(i).html(t)})};t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:l(),dataBound:o,resizable:!0}}function l(){return[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.expertID)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,template:"<span class='row-number'></span>"},{field:"name",title:"姓名",width:80,filterable:!0},{field:"sex",title:"性别",width:50,filterable:!0},{field:"degRee",title:"学位",width:50,filterable:!0},{field:"userPhone",title:"手机号码",width:100,filterable:!0},{field:"comPany",title:"工作单位",width:100,filterable:!0},{field:"degRee",title:"职称",width:100,filterable:!0},{field:"majorWork",title:"现从事专业",width:100,filterable:!0},{field:"acaDemy",title:"毕业院校",width:100,filterable:!0},{field:"expertSort",title:"专家类别",width:100,filterable:!0},{field:"",title:"操作",width:100,template:function(t){return common.format($("#columnBtns").html(),"vm.del('"+t.expertID+"')",t.expertID)}}]}function c(){return[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.expertID)},filterable:!1,width:25,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"name",title:"姓名",width:100,filterable:!1},{field:"degRee",title:"学位",width:100,filterable:!1},{field:"sex",title:"性别",width:50,filterable:!0},{field:"comPany",title:"工作单位",width:100,filterable:!1},{field:"degRee",title:"职务",width:100,filterable:!1},{field:"",title:"专家类别",width:100,filterable:!1,template:function(t){if(t.expertTypeDtoList){for(var e="",o=0;o<t.expertTypeDtoList.length;o++)e+=0==o?t.expertTypeDtoList[o].expertType:"、"+t.expertTypeDtoList[o].expertType;return e}return""}}]}function d(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findByOData",$("#auditform"),{filter:"state eq '1' and unable ne '1'"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:25,sort:{field:"createdDate",dir:"desc"}}),o=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findByOData",$("#auditform"),{filter:"state eq '2' and unable ne '1'"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:5,sort:{field:"createdDate",dir:"desc"}}),i=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findByOData",$("#auditform"),{filter:"state eq '3' and unable ne '1'"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:5,sort:{field:"createdDate",dir:"desc"}}),n=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findByOData",$("#auditform"),{filter:"state eq '4' and unable ne '1'"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:5,sort:{field:"createdDate",dir:"desc"}}),a=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findByOData",$("#auditform"),{filter:"state eq '5' and unable ne '1'"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:5,sort:{field:"createdDate",dir:"desc"}}),r=function(){var t=this.items(),e=this.pager.page()-1,o=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*o,i=$(this).find(".row-number");$(i).html(t)})};t.gridOptions1={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c(),dataBound:r,resizable:!0},t.gridOptions2={dataSource:common.gridDataSource(o),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c(),dataBound:r,resizable:!0},t.gridOptions3={dataSource:common.gridDataSource(i),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c(),dataBound:r,resizable:!0},t.gridOptions4={dataSource:common.gridDataSource(n),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c(),dataBound:r,resizable:!0},t.gridOptions5={dataSource:common.gridDataSource(a),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:c(),dataBound:r,resizable:!0}}function m(t){t.gridOptions1.dataSource.read(),t.gridOptions2.dataSource.read(),t.gridOptions3.dataSource.read(),t.gridOptions4.dataSource.read(),t.gridOptions5.dataSource.read()}function u(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findRepeatByOData"),schema:common.kendoGridConfig().schema({id:"id"}),rowNumber:!0,headerCenter:!0}),o=function(){var t=this.items();$(t).each(function(t){$(this).find(".row-number").html(t+1)})};t.repeatGridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:l(),dataBound:o,resizable:!0}}function p(t,e){var o=common.getKendoCheckId("#grid"+e);if(0==o.length)common.alert({vm:t,msg:"请选择数据"});else{for(var i=[],n=0;n<o.length;n++)i.push(o[n].value);h(t,i.join(","),1)}}function f(t,e){var o=common.getKendoCheckId("#grid1");if(0==o.length)common.alert({vm:t,msg:"请选择数据"});else{for(var i=[],n=0;n<o.length;n++)i.push(o[n].value);h(t,i.join(","),e)}}function h(e,o,i){e.isSubmit=!0;var n={method:"post",url:v+"/updateAudit",params:{ids:o,flag:i}},a=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.isSubmit=!1,e.gridOptions1.dataSource.read(),e.gridOptions2.dataSource.read(),e.gridOptions3.dataSource.read(),e.gridOptions4.dataSource.read(),e.gridOptions5.dataSource.read(),common.alert({vm:e,msg:"操作成功"})}})};common.http({vm:e,$http:t,httpOptions:n,success:a})}function g(t){var e={language:"zh",allowedPreviewTypes:["image"],allowedFileExtensions:["jpg","png","gif"],maxFileSize:2e3,showRemove:!1,uploadUrl:rootPath+"/expert/uploadPhoto",uploadExtraData:{expertId:t.model.expertID}};$("#expertphotofile").fileinput(e).on("filebatchselected",function(t,e){}).on("fileuploaded",function(e,o){$("#expertPhotoSrc").removeAttr("src"),$("#expertPhotoSrc").attr("src",rootPath+"/expert/transportImg?expertId="+t.model.expertID+"&t="+Math.random())})}var v=rootPath+"/expert";return{grid:s,auditGrid:d,getExpertById:r,createExpert:a,deleteExpert:i,updateExpert:o,searchMuti:n,searchAudit:m,repeatGrid:u,updateAudit:h,toAudit:p,auditTo:f,initUpload:g,formReset:e,initUpload:g,initUpload:g}}angular.module("app").factory("expertSvc",t),t.$inject=["$http"]}(),function(){"expert strict";function t(t,e){var o=this;o.data={},o.title="专家评分一览表"}angular.module("app").controller("expertReviewListCtrl",t),t.$inject=["$location","expertSvc"]}(),function(){"expertType strict";function t(t,e,o){function i(){var t=$("#addExpertType").find("input");$.each(t,function(t,e){e.value=""})}function n(e){var o={method:"GET",url:rootPath+"/expertType/getExpertType?$filter=expert.expertID eq '"+e.model.expertID+"'"},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.expertTypeList=t.data}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}function a(t){$("#addExpertType").kendoWindow({width:"690px",height:"400px",title:"添加专家类型",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()}function r(e){var i={method:"get",url:rootPath+"/expertType/getExpertTypeById",params:{expertTypeId:e.expertTypeId}},n=function(t){e.expertType=t.data,e.expertType.majobSmallDicts=o.topSelectChange(e.expertType.maJorBig,o.DICT.MAJOR.dicts)};common.http({vm:e,$http:t,httpOptions:i,success:n})}function s(o){if(common.initJqValidation($("#expertTypeForm")),$("#expertTypeForm").valid()){var n={method:"post",url:rootPath+"/expertType",data:o.expertType},a=function(t){common.requestSuccess({vm:o,response:t,fn:function(){window.parent.$("#addExpertType").data("kendoWindow").close(),i(),e.getExpertById(o),common.alert({vm:o,msg:"操作成功",fn:function(){o.projectTypeList=!0,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}})}})};common.http({vm:o,$http:t,httpOptions:n,success:a})}}function l(t){var e=$("input[name='checkEType']:checked");e.length<1?common.alert({vm:t,msg:"请选择操作对象",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}}):e.length>1?common.alert({vm:t,msg:"无法同时操作多条数据",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}}):(t.expertTypeId=e.val(),r(t),t.expertID=t.model.expertID,a(t))}function c(o){if(common.initJqValidation($("#expertTypeForm")),$("#expertTypeForm").valid()){o.expertType.expertID=o.expertID;var n={method:"put",url:rootPath+"/expertType",data:o.expertType},a=function(t){common.requestSuccess({vm:o,response:t,fn:function(){window.parent.$("#addExpertType").data("kendoWindow").close(),e.getExpertById(o),i(),common.alert({vm:o,msg:"操作成功",fn:function(){o.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:o,$http:t,httpOptions:n,success:a})}}function d(o){var i=$("input[name='checkEType']:checked");if(i.length<1)common.alert({vm:o,msg:"请选择操作对象",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}});else{var n="";$.each(i,function(t,e){n+=e.value+","}),o.isSubmit=!0;var a={method:"delete",url:rootPath+"/expertType",data:n},r=function(t){common.requestSuccess({vm:o,response:t,fn:function(){o.isSubmit=!1,common.alert({vm:o,msg:"操作成功",fn:function(){o.isSubmit=!1,$(".alertDialog").modal("hide")}}),e.getExpertById(o)}})};common.http({vm:o,$http:t,httpOptions:a,success:r})}}return{gotoExpertType:a,createExpertType:s,cleanValue:i,getExpertType:n,updateExpertType:l,getExpertTypeById:r,saveUpdate:c,deleteExpertType:d}}angular.module("app").factory("expertTypeSvc",t),t.$inject=["$http","expertSvc","$rootScope"]}(),function(){"projectExpe strict";function t(t){function e(e){var o={method:"get",url:rootPath+"/dict/getAllDictByCode",params:{dictCode:"PROJECTTYPE"}},i=function(t){e.projectTypes=t.data};common.http({vm:e,$http:t,httpOptions:o,success:i})}function o(e){common.initJqValidation();var o=$("input[name='checkpj']:checked");if(o.length<1)common.alert({vm:e,msg:"请选择操作对象",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}});else{var i="";$.each(o,function(t,e){i+=e.value+","}),e.isSubmit=!0;var n={method:"delete",url:rootPath+"/projectExpe/deleteProject",data:i},r=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.isSubmit=!1,a(e)}})};common.http({vm:e,$http:t,httpOptions:n,success:r})}}function i(e){var o={method:"get",url:common.format(rootPath+"/projectExpe/getProject?$filter=peID eq '{0}'",e.peID)},i=function(t){e.project={},e.project.projectName=t.data[0].projectName,e.project.projectType=t.data[0].projectType,e.project.projectbeginTime=t.data[0].projectbeginTime,e.project.projectendTime=t.data[0].projectendTime,e.isUpdate};common.http({vm:e,$http:t,httpOptions:o,success:i})}function n(e){if(common.initJqValidation($("#ProjectForm")),$("#ProjectForm").valid()){e.isSubmit=!0,e.project.peID=e.peID,e.project.expertID=e.expertID,e.project.projectbeginTime=$("#projectbeginTime").val(),e.project.projectendTime=$("#projectendTime").val();var o={method:"put",url:rootPath+"/projectExpe/updateProject",data:e.project},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){window.parent.$("#pjwindow").data("kendoWindow").close(),a(e),l(),common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide")}})}})}}common.http({vm:e,$http:t,httpOptions:o,success:i})}function a(e){var o={method:"GET",url:rootPath+"/projectExpe/getProject?$filter=expert.expertID eq '"+e.model.expertID+"'"},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.projectList=t.data}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}function r(t){var e=$("input[name='checkpj']:checked");e.length<1?common.alert({vm:t,msg:"请选择操作对象",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}}):e.length>1?common.alert({vm:t,msg:"无法同时操作多条数据",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}}):(t.peID=e.val(),i(t),t.expertID=t.model.expertID,s(t))}function s(t){$("#pjwindow").kendoWindow({width:"690px",height:"330px",title:"添加项目经验",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()}function l(){var t=$("#pjwindow").find("input");$.each(t,function(t,e){e.value=""})}function c(e){if(common.initJqValidation($("#ProjectForm")),$("#ProjectForm").valid()){e.project.projectbeginTime=$("#projectbeginTime").val(),e.project.projectendTime=$("#projectendTime").val();var o={method:"post",url:rootPath+"/projectExpe/projectExpe",data:e.project},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){window.parent.$("#pjwindow").data("kendoWindow").close(),l(),a(e),common.alert({vm:e,msg:"操作成功",fn:function(){e.projectkHistory=!0,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}})}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}}return{getProject:a,createProject:c,updateProject:n,updateProjectPage:r,getProjectById:i,delertProject:o,gotoJPage:s,cleanValue:l,initProjectType:e}}angular.module("app").factory("projectExpeSvc",t),t.$inject=["$http"]}(),function(){"workExpe strict";function t(t,e){function o(e){var o={method:"GET",url:rootPath+"/workExpe/getWork?$filter=expert.expertID eq '"+e.model.expertID+"'"},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.workList=t.data}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}function i(e){var i=$("input[name='checkwr']:checked");if(i.length<1)common.alert({vm:e,msg:"请选择操作对象",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}});else{var n="";$.each(i,function(t,e){n+=e.value+","}),e.isSubmit=!0;var a={method:"delete",url:rootPath+"/workExpe/deleteWork",data:n},r=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.isSubmit=!1,o(e)}})};common.http({vm:e,$http:t,httpOptions:a,success:r})}}function n(t){var e=$("input[name='checkwr']:checked");e.length<1?common.alert({vm:t,msg:"请选择操作对象",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}}):e.length>1?common.alert({vm:t,msg:"无法同时操作多条数据",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}}):(t.weID=e.val(),a(t),s(t),t.expertID=t.model.expertID)}function a(e){var o={method:"get",url:common.format(rootPath+"/workExpe/getWork?$filter=weID eq '{0}'",e.weID)},i=function(t){e.work={},e.work.companyName=t.data[0].companyName,e.work.workJob=t.data[0].workJob,e.work.beginTime=t.data[0].beginTime,e.work.endTime=t.data[0].endTime};common.http({vm:e,$http:t,httpOptions:o,success:i})}function r(){var t=$("#wrwindow").find("input");$.each(t,function(t,e){e.value=""})}function s(t){$("#wrwindow").kendoWindow({width:"690px",height:"330px",title:"添加工作简历",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()}function l(e){if(common.initJqValidation($("#workForm")),$("#workForm").valid()){var i={method:"post",url:rootPath+"/workExpe/workExpe",data:e.work},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){r(),window.parent.$("#wrwindow").data("kendoWindow").close(),o(e),common.alert({vm:e,msg:"操作成功",fn:function(){e.showWorkHistory=!0,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}})}})};common.http({vm:e,$http:t,httpOptions:i,success:n})}}function c(e){if(common.initJqValidation(),$("form").valid()){e.work.weID=e.weID,e.work.expertID=e.expertID,e.work.beginTime=$("#beginTime").val(),e.work.endTime=$("#endTime").val();var i={method:"put",url:rootPath+"/workExpe/updateWork",data:e.work},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){window.parent.$("#wrwindow").data("kendoWindow").close(),o(e),r(),common.alert({vm:e,msg:"操作成功",fn:function(){e.showWorkHistory=!0,$(".alertDialog").modal("hide")}})}})};common.http({vm:e,$http:t,httpOptions:i,success:n})}}return{createWork:l,updateWork:c,deleteWork:i,updateWorkPage:n,gotoWPage:s,getWorkById:a,getWork:o,cleanValue:r}}angular.module("app").factory("workExpeSvc",t),t.$inject=["$http","expertSvc"]}(),function(){"use strict";function t(t,e){function o(o){if(common.initJqValidation($("#expert_offer_form")),$("#expert_offer_form").valid()){o.expertOffer.expertId=o.model.expertID;var i={method:"post",url:rootPath+"/expertOffer",data:o.expertOffer},n=function(t){common.requestSuccess({vm:o,response:t,fn:function(){e.getExpertById(o),common.alert({vm:o,msg:"操作成功"})}})};common.http({vm:o,$http:t,httpOptions:i,success:n})}}return{saveOffer:o}}angular.module("app").factory("expertOfferSvc",t),t.$inject=["$http","expertSvc"]}(),function(){"use strict";function t(t,e){var o=this;o.title="专家列表",o.del=function(t){common.confirm({vm:o,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),e.deleteExpertReview(o,t)}})},o.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)common.alert({vm:o,msg:"请选择数据"});else{for(var e=[],i=0;i<t.length;i++)e.push(t[i].value);var n=e.join(",");o.del(n)}},function(){e.initExpertGrid(o),e.getReviewList(o)}()}angular.module("app").controller("expertReviewCtrl",t),t.$inject=["$location","expertReviewSvc"]}(),function(){"use strict";function t(t,e,o){var i=this;i.title="添加附件",i.isuserExist=!1,i.id=o.params.id,i.id&&(i.isUpdate=!0,i.title="更新附件"),i.create=function(){e.createExpertReview(i)},i.update=function(){e.updateExpertReview(i)},function(){i.isUpdate&&e.getExpertReviewById(i)}()}angular.module("app").controller("expertReviewEditCtrl",t),t.$inject=["$location","expertReviewSvc","$state"]}(),function(){"use strict";function t(t,e,o,i){function n(t){return!!(/^(\+|-)?\d+$/.test(t)&&t>0)}function a(t){if(r.conditions.length>0){var e=!0;return r.conditions.forEach(function(o,i){t&&(angular.isUndefined(o.id)||""==o.id)&&(e=!1),r.expertReview.id&&(o.expertReviewDto={},o.expertReviewDto.id=r.expertReview.id),o.workProgramId=r.expertReview.workProgramId,o.maJorBig=$("#maJorBig"+o.sort).val(),o.maJorSmall=$("#maJorSmall"+o.sort).val(),o.expeRttype=$("#expeRttype"+o.sort).val(),$("#officialNum"+o.sort).val()&&n($("#officialNum"+o.sort).val())?o.officialNum=$("#officialNum"+o.sort).val():($("#errorsOfficialNum"+o.sort).html("必填，且为数字"),e=!1),$("#alternativeNum"+o.sort).val()&&n($("#alternativeNum"+o.sort).val())?o.alternativeNum=$("#alternativeNum"+o.sort).val():($("#errorsAlternativeNum"+o.sort).html("必填，且为数字"),e=!1),e&&($("#errorsOfficialNum"+o.sort).html(""),$("#errorsAlternativeNum"+o.sort).html(""))}),e}return!1}var r=this;r.title="选择专家",r.conditionIndex=1,r.conditions=new Array,r.expertReview={},r.autoSelExperts=new Array,r.autoExpertList={},r.workProgramId=i.params.workProgramId,function(){e.initReview(r),e.initExpertGrid(r)}(),r.showSelfExpertGrid=function(){e.initSelfExpert(r)},r.saveSelfExpert=function(){e.saveSelfExpert(r)},r.delertSelfExpert=function(){var t=$("input[name='seletedEp']:checked");t.length<1?common.alert({vm:r,msg:"请选择操作对象"}):common.confirm({vm:r,title:"温馨提示",msg:"删除数据不可恢复，确定删除么？",fn:function(){$(".confirmDialog").modal("hide");for(var o=[],i=0;i<t.length;i++)o.push(t[i].value);var n=o.join(",");e.delSelectedExpert(r,n)}})},r.showOutExpertGrid=function(){e.showOutExpertGrid(r)},r.delertOutSelfExpert=function(){var t=$("input[name='seletedOutEp']:checked");t.length<1?common.alert({vm:r,msg:"请选择操作对象"}):common.confirm({vm:r,title:"温馨提示",msg:"删除数据不可恢复，确定删除么？",fn:function(){$(".confirmDialog").modal("hide");for(var o=[],i=0;i<t.length;i++)o.push(t[i].value);e.delSelectedExpert(r,o.join(","))}})},r.saveOutExpert=function(){e.saveOutExpert(r)},r.countMatchExperts=function(t){r.expertReview.id?e.countMatchExperts(r,t):common.alert({vm:r,msg:"请保存整体抽取方案再计算"})},r.checkIntegerValue=function(t,e,i){o.isUnsignedInteger(t)?($("#"+e+i).val(t),$("#errorsOfficialNum"+i).html(""),$("#errorsAlternativeNum"+i).html("")):($("#errorsOfficialNum"+i).html("只能填写数字"),$("#errorsAlternativeNum"+i).html("只能填写数字"))},r.addCondition=function(){r.expertReview.isSelete?common.alert({vm:r,msg:"当前项目已经进行整体专家方案的抽取，不能再修改方案！"}):(r.condition={},r.condition.sort=r.conditionIndex,r.expertReview.id&&(r.condition.expertReviewDto={},r.condition.expertReviewDto.id=r.expertReview.id),r.condition.selectType="1",r.conditions.push(r.condition),r.conditionIndex++)},r.removeCondition=function(){if(r.expertReview.isSelete)common.alert({vm:r,msg:"当前项目已经进行整体专家方案的抽取，不能再修改方案！"});else{var t=$("#conditionTable input[name='epConditionSort']:checked");t.length>=1&&common.confirm({vm:r,title:"温馨提示",msg:"删除数据不可恢复，确定删除么？",fn:function(){$(".confirmDialog").modal("hide");for(var e=[],i=0;i<t.length;i++)r.conditions.forEach(function(o,n){t[i].value==o.sort&&(r.conditions.splice(n,1),o.id&&e.push(o.id))});e.length>0&&o.deleteSelConditions(r,e.join(","))}})}},r.saveCondition=function(){r.expertReview.isSelete?common.alert({vm:r,msg:"当前项目已经进行整体专家方案的抽取，不能再修改方案！"}):a(!1)?o.saveCondition(r):common.alert({vm:r,msg:"请先设置好条件再保存！",closeDialog:!0})},r.startAutoExpertWin=function(){a(!0)?9==r.expertReview.isSelete?common.alert({vm:r,msg:"该方案已经进行整体专家方案的抽取，不能在继续抽取！"}):e.queryAutoExpert(r):common.alert({vm:r,msg:"请先保存编辑的抽取方案！"})},r.showAutoExpertWin=function(){$("#aotuExpertDiv").kendoWindow({width:"800px",height:"600px",title:"专家抽取",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},r.resetAutoExpert=function(){common.alert({vm:r,msg:"功能待开发！"})},r.affirmAutoExpert=function(){e.affirmAutoExpert(r)},r.affirmJoinExpert=function(){$("#confirmJoinExpert").kendoWindow({width:"960px",height:"600px",title:"参加评审会专家确认",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},r.updateToJoin=function(){var t=$("#notJoinExpertTable input[name='notJoinExpert']:checked");if(t.length<1)common.alert({vm:r,msg:"请选择操作对象"});else{for(var o=[],i=0;i<t.length;i++)o.push(t[i].value);e.updateJoinState(r,o.join(","),"9")}},r.updateToNotJoin=function(){var t=$("#joinExpertTable input[name='joinExpert']:checked");if(t.length<1)common.alert({vm:r,msg:"请选择操作对象"});else{for(var o=[],i=0;i<t.length;i++)o.push(t[i].value);e.updateJoinState(r,o.join(","),"0")}},r.affirmExpert=function(){var t=$("input[name='seletedEp']:checked");if(t.length<1)common.alert({vm:r,msg:"请选择操作对象"});else{for(var o=[],i=0;i<t.length;i++)o.push(t[i].value);var n=o.join(",");e.updateExpertState(r,n,"9")}}}angular.module("app").controller("expertSelectCtrl",t),t.$inject=["$location","expertReviewSvc","expertConditionSvc","$state"]}(),function(){"use strict";function t(t,e){function o(t){t.conditions=new Array,t.customCondition=new Array,t.expertReview={},t.selfExperts=[],t.selectExperts=[],t.selectIds=[],t.autoExperts=[],t.autoSelExperts=[],t.outsideExperts=[]}function i(e){e.iscommit=!0,o(e);var i={method:"get",url:rootPath+"/expertReview/html/initByWorkProgramId",params:{workProgramId:e.workProgramId}},n=function(t){e.iscommit=!1,e.expertReview=t.data,e.expertReview.expertSelConditionDtoList&&e.expertReview.expertSelConditionDtoList.length>0&&(e.conditions=e.expertReview.expertSelConditionDtoList,e.conditionIndex=e.expertReview.expertSelConditionDtoList.length),e.expertReview.expertSelectedDtoList&&e.expertReview.expertSelectedDtoList.length>0&&(e.expertReview.expertSelectedDtoList.forEach(function(t,o){e.selectIds.push(t.expertDto.expertID),e.selectExperts.push(t),"1"==t.selectType?(e.autoExperts.push(t),e.autoSelExperts.push(t.expertDto)):"2"==t.selectType?e.selfExperts.push(t):"3"==t.selectType&&e.outsideExperts.push(t)}),e.selectIds.length>0?e.excludeIds=e.selectIds.join(","):e.excludeIds="")};common.http({vm:e,$http:t,httpOptions:i,success:n})}function n(){return[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.expertID)},filterable:!1,width:25,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"name",title:"姓名",width:100,filterable:!1},{field:"degRee",title:"学位",width:100,filterable:!1},{field:"sex",title:"性别",width:50,filterable:!0},{field:"comPany",title:"工作单位",width:100,filterable:!1},{field:"degRee",title:"职务",width:100,filterable:!1},{field:"expeRttype",title:"专家类别",width:100,filterable:!1}]}function a(t){var e=function(){var t=this.items(),e=this.pager.page()-1,o=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*o,i=$(this).find(".row-number");$(i).html(t)})},o=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findByOData",$("#selfSelExpertForm")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}});t.selfExpertOptions={dataSource:common.gridDataSource(o),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:n(),dataBound:e,resizable:!0};var i=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findByOData",$("#outSelExpertForm"),{filter:"state eq '3'"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}});t.outExpertOptions={dataSource:common.gridDataSource(i),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:n(),dataBound:e,resizable:!0}}function r(t){t.selfExpertOptions.dataSource.read(),$("#selfExpertDiv").kendoWindow({width:"860px",height:"500px",title:"自选评审专家",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()}function s(e){var o=common.getKendoCheckId("#selfExpertGrid");if(0==o.length)$("#selfExpertError").html("请选择一条专家数据才能保存！");else if(o.length>1)$("#selfExpertError").html("自选专家最多只能选择一个！");else{$("#selfExpertError").html(""),window.parent.$("#selfExpertDiv").data("kendoWindow").close(),e.iscommit=!0;var n={method:"post",url:rootPath+"/expertReview/saveExpertReview",params:{expertIds:o[0].value,reviewId:e.expertReview.id,selectType:"2"}},a=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.iscommit=!1,i(e),common.alert({vm:e,msg:"操作成功！",closeDialog:!0})}})};common.http({vm:e,$http:t,httpOptions:n,success:a,onError:function(t){e.iscommit=!1}})}}function l(e,o,i){e.iscommit=!0;var n={method:"post",url:rootPath+"/expertReview/updateExpertState",params:{expertIds:o,state:i}},a=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.iscommit=!1,common.alert({vm:e,msg:"操作成功！",closeDialog:!0})}})};common.http({vm:e,$http:t,httpOptions:n,success:a,onError:function(t){e.iscommit=!1}})}function c(t){t.outExpertOptions.dataSource.read(),$("#outExpertDiv").kendoWindow({width:"860px",height:"500px",title:"自选新专家、市外、境外专家",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()}function d(e){var o=common.getKendoCheckId("#outExpertGrid");if(0==o.length)$("#outExpertError").html("请选择一条专家数据才能保存！");else{$("#outExpertError").html(""),window.parent.$("#outExpertDiv").data("kendoWindow").close(),e.iscommit=!0;var n="";$.each(o,function(t,e){n+=0==t?e.value:","+e.value});var a={method:"post",url:rootPath+"/expertReview/saveExpertReview",params:{expertIds:n,reviewId:e.expertReview.id,selectType:"3"}},r=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.iscommit=!1,i(e),common.alert({vm:e,msg:"操作成功！",closeDialog:!0})}})};common.http({vm:e,$http:t,httpOptions:a,success:r,onError:function(t){e.iscommit=!1}})}}function m(e,o){var i={};e.conditions.forEach(function(t,e){t.sort==o&&(i=t,i.maJorBig=$("#maJorBig"+t.sort).val(),i.maJorSmall=$("#maJorSmall"+t.sort).val(),i.expeRttype=$("#expeRttype"+t.sort).val())}),i.expertReviewDto={},i.expertReviewDto.id=e.expertReview.id;var n={method:"post",url:rootPath+"/expert/countReviewExpert",data:i,params:{workprogramId:e.workProgramId,reviewId:e.expertReview.id}},a=function(t){common.requestSuccess({vm:e,response:t,fn:function(){$("#expertCount"+o).html(t.data)}})};common.http({vm:e,$http:t,httpOptions:n,success:a})}function u(e){var o={method:"get",url:rootPath+"/expertReview/html/getReviewList"},i=function(t){e.reviewList=t.data};common.http({vm:e,$http:t,httpOptions:o,success:i,onError:function(t){e.iscommit=!1}})}function p(e){var o={method:"post",url:rootPath+"/expert/findReviewExpert",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,
dataType:"json",data:angular.toJson(e.conditions),params:{workprogramId:e.workProgramId,reviewId:e.expertReview.id}},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){t.data&&(e.autoExpertList=t.data,f(e))}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}function f(o){if(!o.autoExpertList||o.autoExpertList.length<1)return void common.alert({vm:o,msg:"本次被抽取的专家人数不满足抽取条件，抽取无效！请重新设置抽取条件！"});var n=0,a=new Array,r=new Array;if(o.autoExpertList.forEach(function(t,e){"2"==t.state||2==t.state?a.push(t):r.push(t)}),o.conditions.forEach(function(t,e){n+=parseInt(t.officialNum)}),n>a.length)return void common.alert({vm:o,msg:"本次被抽取的正选专家人数不满足抽取条件，抽取无效！请重新设置抽取条件！"});if(n>r.length)return void common.alert({vm:o,msg:"本次被抽取的备选专家人数不满足抽取条件，抽取无效！请重新设置抽取条件！"});o.showAutoExpertWin();var s=0,l="";o.t=e(function(){if(0==n){e.cancel(o.t),o.iscommit=!0;var c={method:"post",url:rootPath+"/expertReview/saveExpertReview",params:{expertIds:l,reviewId:o.expertReview.id,selectType:"1",isDraw:!0}},d=function(t){common.requestSuccess({vm:o,response:t,fn:function(){o.iscommit=!1,i(o),common.alert({vm:o,msg:"操作成功！",closeDialog:!0})}})};common.http({vm:o,$http:t,httpOptions:c,success:d,onError:function(t){o.iscommit=!1}})}else{var m=Math.floor(Math.random()*o.autoExpertList.length);if(o.showAutoExpertName=o.autoExpertList[m].name,++s%10==0){var u=Math.floor(Math.random()*a.length);o.autoSelExperts.push(a[u]),l+=a[u].expertID+",",a.forEach(function(t,e){a[u].expertID==t.expertID&&a.splice(e,1)}),u=Math.floor(Math.random()*r.length),o.autoSelExperts.push(r[u]),l+=r[u].expertID+",",r.forEach(function(t,e){r[u].expertID==t.expertID&&r.splice(e,1)}),n--}}},200)}function h(e,o,i){e.iscommit=!0;var n={method:"post",url:rootPath+"/expertReview/updateJoinState",params:{expertIds:o,state:i}},a=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.iscommit=!1,e.selectExperts.forEach(function(t,e){o.indexOf(t.id)>=0&&(t.isJoin=i)}),common.alert({vm:e,msg:"操作成功！",closeDialog:!0})}})};common.http({vm:e,$http:t,httpOptions:n,success:a,onError:function(t){e.iscommit=!1}})}function g(e){e.iscommit=!0;var o={method:"post",url:rootPath+"/expertReview/affirmAutoExpert",params:{reviewId:e.expertReview.id}},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.iscommit=!1,window.parent.$("#aotuExpertDiv").data("kendoWindow").close(),common.alert({vm:e,msg:"操作成功！",closeDialog:!0})}})};common.http({vm:e,$http:t,httpOptions:o,success:i,onError:function(t){e.iscommit=!1}})}function v(e,o){e.iscommit=!0;var n={method:"delete",url:rootPath+"/expertSelected",params:{id:o,reviewId:e.expertReview.id,deleteAll:!1}},a=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.iscommit=!1,i(e),common.alert({vm:e,msg:"操作成功！",closeDialog:!0})}})};common.http({vm:e,$http:t,httpOptions:n,success:a,onError:function(t){e.iscommit=!1}})}return{initExpertGrid:a,initSelfExpert:r,saveSelfExpert:s,updateExpertState:l,showOutExpertGrid:c,saveOutExpert:d,countMatchExperts:m,getReviewList:u,initReview:i,delSelectedExpert:v,queryAutoExpert:p,validateAutoExpert:f,affirmAutoExpert:g,updateJoinState:h,initParamValue:o}}angular.module("app").factory("expertReviewSvc",t),t.$inject=["$http","$interval"]}(),function(){"use strict";function t(t){function e(e){var o={method:"post",url:rootPath+"/expertSelCondition/saveConditionList",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(e.conditions)},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.conditions=t.data,common.alert({vm:e,msg:"操作成功！",closeDialog:!0})}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}function o(t){return!!(/^(\+|-)?\d+$/.test(t)&&t>0)}function i(e,o){e.iscommit=!0;var i={method:"delete",url:rootPath+"/expertSelCondition",params:{ids:o}},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.iscommit=!1,common.alert({vm:e,msg:"操作成功！",closeDialog:!0})}})};common.http({vm:e,$http:t,httpOptions:i,success:n,onError:function(t){e.iscommit=!1}})}return{saveCondition:e,deleteSelConditions:i,isUnsignedInteger:o}}angular.module("app").factory("expertConditionSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e){var o=this;o.title="项目归档编辑",o.fileRecord={},o.fileRecord.signId=e.params.signid,o.signId=e.params.signid,function(){t.initFileRecordData(o)}(),o.create=function(){t.saveFileRecord(o)}}angular.module("app").controller("fileRecordEditCtrl",t),t.$inject=["fileRecordSvc","$state"]}(),function(){"use strict";function t(t,e){function o(o){var i={method:"get",url:rootPath+"/fileRecord/html/initFillPage",params:{signId:o.fileRecord.signId}},n=function(e){common.requestSuccess({vm:o,response:e,fn:function(){null!=e.data&&""!=e.data&&(o.fileRecord=e.data.file_record,o.fileRecord.signId=o.signId,o.signUserList=e.data.sign_user_List,o.fileRecord.fileRecordId&&t.initUploadOptions({businessId:o.fileRecord.fileRecordId,sysSignId:o.fileRecord.signId,sysfileType:"归档",uploadBt:"upload_file_bt",detailBt:"detail_file_bt",vm:o}))}})};common.http({vm:o,$http:e,httpOptions:i,success:n})}function i(o){if(common.initJqValidation($("#fileRecord_form")),$("#fileRecord_form").valid()){o.signUserList.forEach(function(t,e){if(o.fileRecord.signUserid==t.id)return void(o.fileRecord.signUserName=t.displayName)}),o.isCommit=!0;var i={method:"post",url:rootPath+"/fileRecord",data:o.fileRecord},n=function(e){common.requestSuccess({vm:o,response:e,fn:function(){o.isCommit=!1,common.alert({vm:o,msg:e.data.reMsg,closeDialog:!0,fn:function(){"error"==e.data.reCode?o.isCommit=!1:o.fileRecord.fileRecordId||(o.fileRecord=e.data.reObj,o.fileRecord.signId=o.signId,t.initUploadOptions({businessId:o.fileRecord.fileRecordId,sysSignId:o.fileRecord.signId,sysfileType:"归档",uploadBt:"upload_file_bt",detailBt:"detail_file_bt",vm:o}))}})}})};common.http({vm:o,$http:e,httpOptions:i,success:n,onError:function(t){o.isCommit=!1}})}}return{initFileRecordData:o,saveFileRecord:i}}angular.module("app").factory("fileRecordSvc",t),t.$inject=["sysfileSvc","$http"]}(),function(){"use strict";function t(t,e,o){function i(t){var e=t.flow.processInstanceId;(angular.isUndefined(t.flow.hideFlowImg)||0==t.flow.hideFlowImg)&&(t.picture=rootPath+"/flow/processInstance/img/"+e);var o=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/flow/processInstance/history/"+e),schema:common.kendoGridConfig().schema({id:"id"}),rowNumber:!0,headerCenter:!0}),i=[{field:"",title:"序号",template:"<span class='row-number'></span>",width:40},{field:"nodeName",title:"环节名称",width:120,filterable:!1},{field:"",title:"处理人",width:80,filterable:!1,template:function(t){return t.assignee?t.assignee:t.userName?t.userName:""}},{field:"startTime",title:"开始时间",width:120,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"endTime",title:"结束时间",width:120,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"durationStr",title:"处理时长",width:120,filterable:!1},{field:"message",title:"处理信息",width:300,filterable:!1}];t.historygrid={dataSource:common.gridDataSource(o),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,dataBound:function(){var e=this.items();$(e).each(function(o){o==e.length-1&&l(t),$(this).find(".row-number").html(o+1)})}}}function n(e){var o={method:"get",url:rootPath+"/flow/processInstance/flowNodeInfo",params:{taskId:e.flow.taskId,processInstanceId:e.flow.processInstanceId}},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.flow=t.data,e.flow.end&&(e.showFlag.nodeNext=!1),e.businessFlag.isLoadFlow=!0,e.initBusinessParams()}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}function a(e,o,i){if(common.initJqValidation($("#flow_form")),$("#flow_form").valid()){e=!0;var n={method:"post",url:rootPath+"/flow/commit",data:o},a=function(t){e=!1,void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:t,httpOptions:n,success:a,onError:function(t){e=!1}})}}function r(o){var i={method:"post",url:rootPath+"/flow/rollbacklast",data:o.flow},n=function(t){common.requestSuccess({vm:o,response:t,fn:function(){common.alert({vm:o,msg:t.data.reMsg,closeDialog:!0,fn:function(){"error"==t.data.reCode?o.isCommit=!1:e.go("gtasks")}})}})};common.http({vm:o,$http:t,httpOptions:i,success:n,onError:function(t){o.isCommit=!1}})}function s(e){var o={method:"post",url:rootPath+"/flow/rollbacklast",data:e.flow},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:t.data.reMsg})}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}function l(t){t.backNode=[];for(var e=t.historygrid.dataSource.data(),o=e.length,i=0;i<o;i++)e[i].assignee&&e[i].endTime&&t.backNode.push({activitiId:e[i].activityId,activitiName:e[i].activityName,assignee:e[i].assignee})}function c(t){t.nextDealUserList=t.nextDealUserMap[t.flow.nextNodeAcivitiId],t.nextDealUserList&&(t.flow.nextDealUser=t.nextDealUserList[0].loginName)}function d(e,o){var i={method:"post",url:rootPath+"/flow/suspend/"+o,data:e.projectStop},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:t.data.reMsg,closeDialog:!0,fn:function(){"error"==t.data.reCode?e.isCommit=!1:(window.parent.$("#spwindow").data("kendoWindow").close(),e.gridOptions.dataSource.read())}})}})};common.http({vm:e,$http:t,httpOptions:i,success:n,onError:function(){e.isCommit=!1}})}function m(e,o){e.isCommit=!0;var i={method:"post",url:rootPath+"/flow/active/"+o},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:t.data.reMsg,closeDialog:!0,fn:function(){"error"==t.data.reCode?e.isCommit=!1:e.gridOptions.dataSource.read()}})}})};common.http({vm:e,$http:t,httpOptions:i,success:n,onError:function(){e.isCommit=!1}})}function u(e){if(null==e.flow.dealOption||""==e.flow.dealOption)return void common.alert({vm:e,msg:"请填写处理信息！"});var o={method:"post",url:rootPath+"/flow/deleteFLow",data:e.flow},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功！"})}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}function p(e,o){if(common.initJqValidation($("#markform")),$("#markform").valid()){var i={method:"put",url:rootPath+"/expertSelected",data:e.businessFlag.expertScore},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){window.parent.$("#expertmark").data("kendoWindow").close(),e.isSubmit=!1,common.alert({vm:e,msg:"操作成功",closeDialog:!0,fn:function(){void 0!=o&&"function"==typeof o&&o()}})}})};common.http({vm:e,$http:t,httpOptions:i,success:n})}}function f(e,o){if(common.initJqValidation($("#payform")),$("#payform").valid()){if(!v(e,e.businessFlag.expertReviews))return common.alert({vm:e,msg:"应纳税额计算错误,保存失败！",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}}),void(e.isCommit=!1);e.isCommit=!0;var i={method:"post",url:rootPath+"/expertReview/html/saveExpertReviewCost",data:JSON.stringify(e.businessFlag.expertReviews)},n=function(t){e.isCommit=!1,common.alert({vm:e,msg:"操作成功",closeDialog:!0,fn:function(){void 0!=o&&"function"==typeof o&&o()}})};common.http({vm:e,$http:t,httpOptions:i,success:n})}}function h(t){t=void 0==t?0:t;var e=0;return t>800&&t<=4e3?e=.2*(t-800):t>4e3&&t<=2e4?e=.8*t*.2:t>2e4&&t<=5e4&&(e=.8*t*.3-2e3),e}function g(e,o){if(void 0!=o.expertSelectedDtoList&&0!=o.expertSelectedDtoList.length){var i,n=o.expertSelectedDtoList,a=o.expertSelectedDtoList.length,r="";o.expertSelectedDtoList.forEach(function(t,e){r+="'"+t.id+"'",e!=a-1&&(r+=",")});var s=o.payDate;i=s.substring(0,s.lastIndexOf("-"));var l=rootPath+"/expertReview/html/getExpertReviewCost?expertIds={0}&month={1}",c={method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded"},url:common.format(l,r,i)},d=function(t){var e=t.data;o.reviewCost=0,o.reviewTaxes=0,o.totalCost=0,n.forEach(function(t,i){var n=(t.expertDto,t.EXPERTID),a=t.id,r=0;void 0!=e&&e.length>0&&e.forEach(function(t,e){t.EXPERTID==n&&t.ESID!=a&&(t.REVIEWCOST=void 0==t.REVIEWCOST?0:t.REVIEWCOST,t.REVIEWCOST=parseFloat(t.REVIEWCOST),r=parseFloat(r)+t.REVIEWCOST)}),t.reviewCost=void 0==t.reviewCost?0:t.reviewCost;var s=r+parseFloat(t.reviewCost);t.reviewTaxes=h(s).toFixed(2),t.totalCost=(parseFloat(t.reviewCost)+parseFloat(t.reviewTaxes)).toFixed(2),o.reviewCost=(parseFloat(o.reviewCost)+parseFloat(t.reviewCost)).toFixed(2),o.reviewTaxes=(parseFloat(o.reviewTaxes)+parseFloat(t.reviewTaxes)).toFixed(2),o.totalCost=(parseFloat(o.reviewCost)+parseFloat(o.reviewTaxes)).toFixed(2)})};common.http({vm:e,$http:t,httpOptions:c,success:d})}}function v(t,e){var o=!0;return void 0!=e&&e.length>0&&e.forEach(function(t,e){if(void 0==t.payDate)return t.errorMsg="请选择发放日期",void(o=!1);t.errorMsg="";var i=void 0==t.reviewCost?0:t.reviewCost,n=void 0==t.reviewTaxes?0:t.reviewTaxes,a=void 0==t.totalCost?0:t.totalCost;if(void 0!=t.expertSelectedDtoList&&t.expertSelectedDtoList.length>0){var r=0,s=0,l=0;if(t.expertSelectedDtoList.forEach(function(t,e){var i=void 0==t.reviewCost?0:t.reviewCost,n=void 0==t.reviewTaxes?0:t.reviewTaxes,a=void 0==t.totalCost?0:t.totalCost;if((parseFloat(i)+parseFloat(n)).toFixed(2)!=parseFloat(a).toFixed(2))return void(o=!1);r=parseFloat(r)+parseFloat(i),s=parseFloat(s)+parseFloat(n),l=parseFloat(l)+parseFloat(a)}),parseFloat(r).toFixed(2)!=parseFloat(i).toFixed(2))return void(o=!1);if(parseFloat(s).toFixed(2)!=parseFloat(n).toFixed(2))return void(o=!1);if(parseFloat(l).toFixed(2)!=parseFloat(a).toFixed(2))return void(o=!1)}}),o}function w(t){t.showExpertpayment=!0,$("#payment").kendoWindow({width:"1000px",height:"630px",title:"编辑-专家费用",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()}return{initFlowData:i,getFlowInfo:n,commit:a,rollBackToLast:r,rollBack:s,initBackNode:l,initDealUerByAcitiviId:c,suspendFlow:d,activeFlow:m,deleteFlow:u,saveMark:p,savePayment:f,countTaxes:g,gotopayment:w}}angular.module("app").factory("flowSvc",t),t.$inject=["$http","$state","signFlowSvc"]}(),function(){"use strict";function t(){return e}var e={SIGN_ZR:"SIGN_ZR",SIGN_QS:"SIGN_QS",SIGN_ZHB:"SIGN_ZHB",SIGN_FGLD_FB:"SIGN_FGLD_FB",SIGN_BMFB1:"SIGN_BMFB1",SIGN_BMFB2:"SIGN_BMFB2",SIGN_BMFB3:"SIGN_BMFB3",SIGN_BMFB4:"SIGN_BMFB4",SIGN_XMFZR1:"SIGN_XMFZR1",SIGN_XMFZR2:"SIGN_XMFZR2",SIGN_XMFZR3:"SIGN_XMFZR3",SIGN_XMFZR4:"SIGN_XMFZR4",SIGN_BMLD_SPW1:"SIGN_BMLD_SPW1",SIGN_BMLD_SPW2:"SIGN_BMLD_SPW2",SIGN_BMLD_SPW3:"SIGN_BMLD_SPW3",SIGN_BMLD_SPW4:"SIGN_BMLD_SPW4",SIGN_FGLD_SPW1:"SIGN_FGLD_SPW1",SIGN_FGLD_SPW2:"SIGN_FGLD_SPW2",SIGN_FGLD_SPW3:"SIGN_FGLD_SPW3",SIGN_FGLD_SPW4:"SIGN_FGLD_SPW4",SIGN_FW:"SIGN_FW",SIGN_QRFW:"SIGN_QRFW",SIGN_BMLD_QRFW:"SIGN_BMLD_QRFW",SIGN_FGLD_QRFW:"SIGN_FGLD_QRFW",SIGN_ZR_QRFW:"SIGN_ZR_QRFW",SIGN_FWBH:"SIGN_FWBH",SIGN_CWBL:"SIGN_CWBL",SIGN_GD:"SIGN_GD",SIGN_DSFZR_QRGD:"SIGN_DSFZR_QRGD",SIGN_QRGD:"SIGN_QRGD"},o={getSignFlowNode:t};window.flowcommon=o}(),function(){"use strict";function t(t,e){var o=this;o.title="",o.changePwd=function(){e.changePwd(o)}}angular.module("app").controller("homeCtrl",t),t.$inject=["$location","homeSvc"]}(),function(){"use strict";function t(t){function e(e){if(common.initJqValidation(),$("form").valid()){e.isSubmit=!0;var i={method:"put",url:o,data:e.model.password},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:e,$http:t,httpOptions:i,success:n})}}var o="/account/password";return{changePwd:e}}angular.module("app").factory("homeSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e){var o=this;o.title="日志列表",function(){e.grid(o)}()}angular.module("app").controller("logCtrl",t),t.$inject=["$location","logSvc"]}(),function(){"use strict";function t(t,e){function o(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(i+"/fingByOData"),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=[{field:"id",title:"ID",width:80,filterable:!1},{field:"level",title:"级别",width:100,filterable:!0},{field:"message",title:"日志内容",filterable:!1},{field:"userId",title:"操作者",width:150,filterable:!0},{field:"createdDate",title:"操作时间",width:180,filterable:!1,format:"{0:yyyy/MM/dd HH:mm:ss}"}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,resizable:!0}}var i=rootPath+"/log";rootPath;return{grid:o}}angular.module("app").factory("logSvc",t),t.$inject=["$http","$compile"]}(),function(){"use strict";function t(t,e){var o=this;o.title="会议室列表",o.model={},o.del=function(t){common.confirm({vm:o,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),e.deleteMeeting(o,t)}})},o.used=function(t){o.model.id=t,o.model.mrStatus="1",e.roomUseState(o)},o.stoped=function(t){common.confirm({vm:o,title:"",msg:"确定停用会议室么？",fn:function(){$(".confirmDialog").modal("hide"),o.model.id=t,o.model.mrStatus="2",e.roomUseState(o)}})},o.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)common.alert({vm:o,msg:"请选择数据"});else{for(var e=[],i=0;i<t.length;i++)e.push(t[i].value);var n=e.join(",");o.del(n)}},o.queryMeeting=function(){e.queryMeeting(o)},function(){e.grid(o)}()}angular.module("app").controller("meetingCtrl",t),t.$inject=["$location","meetingSvc"]}(),function(){"use strict";function t(t,e,o){var i=this;i.title="添加会议室",i.isuserExist=!1,i.id=o.params.id,i.id&&(i.isUpdate=!0,i.title="更新会议室"),i.create=function(){e.createMeeting(i)},i.update=function(){e.updateMeeting(i)},function(){i.isUpdate&&e.getMeetingById(i)}()}angular.module("app").controller("meetingEditCtrl",t),t.$inject=["$location","meetingSvc","$state"]}(),function(){"use strict";function t(t){function e(t){t.gridOptions.dataSource.read()}function o(e){if(common.initJqValidation(),$("form").valid()){e.isSubmit=!0,e.model.id=e.id;var o={method:"put",url:l,data:e.model},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}}function i(e,o){e.isSubmit=!0;var i={method:"delete",url:l,data:o},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.isSubmit=!1,e.gridOptions.dataSource.read()}})};common.http({vm:e,$http:t,httpOptions:i,success:n})}function n(e){var o={method:"put",url:l+"/roomUseState",data:e.model},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.gridOptions.dataSource.read()}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}function a(e){if(common.initJqValidation(),$("form").valid()){e.isSubmit=!0;var o={method:"post",url:l,data:e.model},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=c}})}})};common.http({vm:e,$http:t,httpOptions:o,success:i,onError:function(t){e.iscommit=!1}})}}function r(e){var o={method:"get",url:l+"/html/findByIdMeeting",params:{id:e.id}},i=function(t){e.model=t.data};common.http({vm:e,$http:t,httpOptions:o,success:i})}function s(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(l+"/fingByOData",$("#meetingFrom")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=function(){var t=this.items(),e=this.pager.page()-1,o=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*o,i=$(this).find(".row-number");$(i).html(t)})},i=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"num",title:"编号",width:100,filterable:!1},{field:"mrName",title:"会议室名称",width:150,filterable:!1},{field:"mrType",title:"类型",width:100,filterable:!1},{field:"addr",title:"会议室地点",width:200,filterable:!1},{field:"capacity",title:"容量",width:80,filterable:!1},{field:"userName",title:"负责人",width:70,filterable:!1},{field:"userPhone",title:"负责人电话",width:120,filterable:!1},{field:"",title:"状态",width:50,template:function(t){return"2"==t.mrStatus?"停用":"正常"}},{field:"",title:"操作",width:100,template:function(t){var e=!1;return e="2"==t.mrStatus,common.format($("#columnBtns").html(),"vm.stoped('"+t.id+"')",e,"vm.used('"+t.id+"')",e,t.id)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:o,resizable:!0}}var l=rootPath+"/meeting",c="#/meeting";return{grid:s,getMeetingById:r,createMeeting:a,deleteMeeting:i,updateMeeting:o,queryMeeting:e,roomUseState:n}}angular.module("app").factory("meetingSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e,o,i){var n=this;n.title="待办事项",n.addregister={},n.model={},n.model.signid=o.params.signid,function(){n.showPrint=!1,e.grid(n)}(),n.print=function(){common.registerFilePrint(n,{$http:i})}}angular.module("app").controller("registerFileCtrl",t),t.$inject=["$location","registerFileSvc","$state","$http"]}(),function(){"use strict";function t(t,e){function o(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridinlineConfig().transport(t,{readUrl:i+"/findByOData",updateUrl:i+"/update",destroyUrl:i+"/delete",createUrl:i+"/create"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"},modifiedDate:{type:"date"},fileName:{nullable:!0,type:"String"},totalNum:{type:"number",validation:{required:!0}},isHasOriginfile:{type:"boolean"},isHasCopyfile:{type:"boolean"},suppleDeclare:{type:"string"},suppleDate:{type:"date"},createdDate:{type:"date"},modifiedDate:{type:"date"}}}),batch:!0,pageSize:10,serverPaging:!0,serverSorting:!0,serverFiltering:!0,sort:{field:"createdDate",dir:"desc"}}),o=function(){var t=this.items(),e=this.pager.page()-1,o=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*o,i=$(this).find(".row-number");$(i).html(t)})},n=[{field:"",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"fileName",title:"资料名称",width:"120px",filterable:!1},{field:"totalNum",title:"份数",width:"120px",filterable:!1},{field:"isHasOriginfile",title:"原件",width:"120px",filterable:!1,template:function(t){return t.isHasOriginfile?"是":"否"}},{field:"isHasCopyfile",title:"复印件",width:"120px",filterable:!1,template:function(t){return t.isHasCopyfile?"是":"否"}},{field:"suppleDeclare",title:"补充说明",width:"120px",filterable:!1},{field:"suppleDate",title:"补充日期",width:"120px",format:"{0:yyyy-MM-dd}",filterable:!1},{command:["destroy"],title:"&nbsp;",width:"250px"}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridinlineConfig().filterable,pageable:common.kendoGridinlineConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:n,toolbar:["create","save","cancel"],dataBound:o,editable:!0,navigatable:!0,resizable:!0}}var i=rootPath+"/addRegisterFile";return{grid:o}}angular.module("app").factory("registerFileSvc",t),t.$inject=["$rootScope","$http"]}(),function(){"use strict";function t(t,e,o,i){var n=this;n.title="待办事项",n.suppletter={},function(){common.initSuppData(n,{$http:i,$state:o})}()}angular.module("app").controller("suppletterCtrl",t),t.$inject=["$location","suppletterSvc","$state","$http"]}(),function(){"use strict";function t(t,e){return{}}angular.module("app").factory("suppletterSvc",t),t.$inject=["$rootScope","$http"]}(),function(){"use strict";function t(t,e){var o=this;o.title="处室人员管理",o.del=function(t){common.confirm({vm:o,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),e.deleteOfficeUser(o,t)}})},o.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)common.alert({vm:o,msg:"请选择数据"});else{for(var e=[],i=0;i<t.length;i++)e.push(t[i].value);var n=e.join(",");o.del(n)}},o.queryOffice=function(){e.queryOffice(o)},function(){e.grid(o)}()}angular.module("app").controller("officeUserCtrl",t),t.$inject=["$location","officeUserSvc"]}(),function(){"use strict";function t(t,e,o){var i=this;i.title="添加人员",i.isuserExist=!1,i.officeID=o.params.officeID,i.officeID&&(i.isUpdate=!0,i.title="更新人员"),i.create=function(){e.createOfficeUser(i)},i.update=function(){e.updateOfficeUser(i)},function(){i.isUpdate&&e.getOfficeUserById(i),e.getDepts(i)}()}angular.module("app").controller("officeUserEditCtrl",t),t.$inject=["$location","officeUserSvc","$state"]}(),function(){"use strict";function t(t){function e(t){t.gridOptions.dataSource.read()}function o(e){var o={method:"get",url:common.format(l+"/getDepts")},i=function(t){e.depts={},e.depts=t.data};common.http({vm:e,$http:t,httpOptions:o,success:i})}function i(e){if(common.initJqValidation(),$("form").valid()){e.isSubmit=!0,e.model.id=e.id;var o={method:"put",url:l,data:e.model},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}}function n(e,o){e.isSubmit=!0;var i={method:"delete",url:l,data:o},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",closeDialog:!0,fn:function(){e.isSubmit=!1,e.gridOptions.dataSource.read()}})}})};common.http({vm:e,$http:t,httpOptions:i,success:n})}function a(e){if(common.initJqValidation(),$("form").valid()){e.isSubmit=!0;var o={method:"post",url:l,data:e.model},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",closeDialog:!0,fn:function(){e.isSubmit=!1,location.href=c}})}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}}function r(e){var o={method:"get",url:rootPath+"/officeUser/html/findById",params:{officeID:e.officeID}},i=function(t){t.data.dept,e.model=t.data};common.http({vm:e,$http:t,httpOptions:o,success:i})}function s(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(l+"/fingByOData",$("#formOffice")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=function(){var t=this.items(),e=this.pager.page()-1,o=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*o,i=$(this).find(".row-number");$(i).html(t)})},i=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.officeID)},filterable:!1,width:20,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:30,filterable:!1,template:"<span class='row-number'></span>"},{field:"officeUserName",title:"办事处联系人",width:100,filterable:!1},{field:"deptName",title:"所在办事处",width:100,filterable:!1},{field:"officePhone",title:"电话",width:100,filterable:!1},{field:"officeEmail",title:"邮件",width:100,filterable:!1},{field:"officeDesc",title:"描述",width:100,filterable:!1},{field:"",title:"操作",width:140,template:function(t){return common.format($("#columnBtns").html(),"vm.del('"+t.officeID+"')",t.officeID)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:o,resizable:!0}}var l=rootPath+"/officeUser",c="#/officeUserList";return{grid:s,getOfficeUserById:r,createOfficeUser:a,deleteOfficeUser:n,updateOfficeUser:i,getDepts:o,queryOffice:e}}angular.module("app").factory("officeUserSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e){var o=this;o.title="部门列表",o.del=function(t){common.confirm({vm:o,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),e.deleteOrg(o,t)}})},o.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)common.alert({vm:o,msg:"请选择数据"});else{for(var e=[],i=0;i<t.length;i++)e.push(t[i].value);var n=e.join(",");o.del(n)}},o.queryOrg=function(){e.queryOrg(o)},function(){e.grid(o)}()}angular.module("app").controller("orgCtrl",t),t.$inject=["$location","orgSvc"]}(),function(){"use strict";function t(t,e,o){var i=this;i.title="新增部门",i.isorgExist=!1,i.id=o.params.id,i.id&&(i.isUpdate=!0,i.title="更新部门"),i.create=function(){e.createOrg(i)},i.update=function(){e.updateOrg(i)},function(){e.initRoleUsers(i),i.isUpdate&&e.getOrgById(i)}()}angular.module("app").controller("orgEditCtrl",t),t.$inject=["$location","orgSvc","$state"]}(),function(){"use strict";function t(t,e){function o(t){t.gridOptions.dataSource.read()}function i(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(d+"/fingByOData",$("#orgForm")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"sort",dir:"asc"}}),o=function(){var t=this.items(),e=this.pager.page()-1,o=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*o,i=$(this).find(".row-number");$(i).html(t)})},i=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"orgIdentity",title:"部门标识",width:80,filterable:!1},{field:"name",title:"部门名称",width:130,filterable:!1},{field:"orgFunction",title:"职能",width:130,filterable:!1},{field:"orgDirectorName",title:"部门负责人",width:100,filterable:!1},{field:"orgSLeaderName",title:"分管领导",width:100,filterable:!1},{field:"orgPhone",title:"电话",width:130,filterable:!1},{field:"",title:"操作",width:200,template:function(t){return common.format($("#columnBtns").html(),"vm.del('"+t.id+"')",t.id)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:o,resizable:!0}}function n(e){if(common.initJqValidation(),$("form").valid()&&0==e.isorgExist){e.isSubmit=!0;var o={method:"post",url:d,data:e.model};e.OrgDirectorUsers.forEach(function(t,o){t.id==e.model.orgDirector&&(e.model.orgDirectorName=t.displayName)}),e.orgMLeaderUsers.forEach(function(t,o){t.id==e.model.orgMLeader&&(e.model.orgMLeaderName=t.displayName)}),e.orgSLeaderUser.forEach(function(t,o){t.id==e.model.orgSLeader&&(e.model.orgSLeaderName=t.displayName)});var i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=m}})}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}}function a(e){var o={method:"get",url:common.format(d+"/getCompany")},i=function(t){e.company={},e.company=t.data};common.http({vm:e,$http:t,httpOptions:o,success:i})}function r(e){var o={method:"get",url:d+"/html/getOrgById",params:{id:e.id}},i=function(t){e.model=t.data};common.http({vm:e,$http:t,httpOptions:o,success:i})}function s(e){if(common.initJqValidation(),$("form").valid()&&0==e.isorgExist){e.isSubmit=!0,e.model.id=e.id,e.OrgDirectorUsers.forEach(function(t,o){t.id==e.model.orgDirector&&(e.model.orgDirectorName=t.displayName)}),e.orgMLeaderUsers.forEach(function(t,o){
t.id==e.model.orgMLeader&&(e.model.orgMLeaderName=t.displayName)}),e.orgSLeaderUser.forEach(function(t,o){t.id==e.model.orgSLeader&&(e.model.orgSLeaderName=t.displayName)});var o={method:"put",url:d,data:e.model},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}}function l(e,o){e.isSubmit=!0;var i={method:"delete",url:d,data:o},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.isSubmit=!1,e.gridOptions.dataSource.read()}})};common.http({vm:e,$http:t,httpOptions:i,success:n})}function c(e){var o={method:"get",url:rootPath+"/user/initRoleUsers"},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.orgMLeaderUsers=t.data.DIRECTOR,e.orgSLeaderUser=t.data.VICE_DIRECTOR,e.OrgDirectorUsers=t.data.DEPT_LEADER}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}var d=rootPath+"/org",m="#/org";rootPath;return{grid:i,createOrg:n,getOrgById:r,updateOrg:s,deleteOrg:l,getCompany:a,initRoleUsers:c,queryOrg:o}}angular.module("app").factory("orgSvc",t),t.$inject=["$http","$compile"]}(),function(){"use strict";function t(t,e,o,i){var n=this;n.id=e.params.id,n.showAddUserDialog=function(){$(".addUser").modal({backdrop:"static",keyboard:!1}),n.orgUserGrid.dataSource.read()},n.closeAddUserDialog=function(){$(".addUser").modal("hide")},n.add=function(t){i.add(n,t)},n.remove=function(t){i.remove(n,t)},n.removes=function(){var t=common.getKendoCheckId(".orgUserGrid");if(0==t.length)common.alert({vm:n,msg:"请选择数据"});else{for(var e=[],o=0;o<t.length;o++)e.push(t[o].value);var i=e.join(",");n.remove(i)}},function(){o.getOrgById(n),i.orgUserGrid(n),i.allUserGrid(n)}()}angular.module("app").controller("orgUserCtrl",t),t.$inject=["$location","$state","orgSvc","orgUserSvc"]}(),function(){"use strict";function t(t,e){function o(e,o){var i={method:"delete",url:rootPath+"/org/deleteUsers",params:{orgId:e.id,userId:o}},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.gridOptions.dataSource.read()}})};common.http({vm:e,$http:t,httpOptions:i,success:n})}function i(e,o){var i={method:"post",url:rootPath+"/org/addUsers",params:{orgId:e.id,userId:o}},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.orgUserGrid.dataSource.read(),e.gridOptions.dataSource.read()}})};common.http({vm:e,$http:t,httpOptions:i,success:n})}function n(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(r+"?orgId="+t.id),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=[{field:"loginName",title:"登录名",width:200,filterable:!0},{field:"displayName",title:"显示名",width:200,filterable:!0},{field:"comment",title:"描述",filterable:!1},{field:"",title:"操作",width:80,template:function(t){return common.format($("#allUserGridBtns").html(),"vm.add('"+t.id+"')",t.id)}}];t.orgUserGrid={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,resizable:!0}}function a(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(s+"?orgId="+t.id),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!1,serverSorting:!1,serverFiltering:!1,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"loginName",title:"登录名",width:200,filterable:!1},{field:"displayName",title:"显示名",width:200,filterable:!1},{field:"comment",title:"描述",filterable:!1},{field:"",title:"操作",width:180,template:function(t){return common.format($("#columnBtns").html(),"vm.remove('"+t.id+"')",t.id)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,resizable:!0}}var r=rootPath+"/org/userNotIn",s=rootPath+"/org/users";return{orgUserGrid:a,allUserGrid:n,add:i,remove:o}}angular.module("app").factory("orgUserSvc",t),t.$inject=["$http","$compile"]}(),function(){"use strict";function t(t,e,o,i,n){var a=this;a.title="项目暂停审批",function(){e.grid(a),n.initIdea(a)}(),a.pauseProjectWindow=function(t,o){e.pauseProjectWindow(a,t,o)},a.commitProjectStop=function(){e.updateProjectStop(a)},a.closewin=function(){window.parent.$("#spwindow").data("kendoWindow").close()},a.selectMinisterIdea=function(){a.projectStop.directorIdeaContent+=a.directorIdea},a.selectDirectorIdea=function(){a.projectStop.leaderIdeaContent+=a.leaderIdea}}angular.module("app").controller("pauseProjectCtrl",t),t.$inject=["$location","pauseProjectSvc","$state","adminSvc","ideaSvc"]}(),function(){"use strict";function t(t,e){function o(t,e,o){t.sign={},t.projectStop={},t.projectStop.signid=e,$("#spwindow").kendoWindow({width:"1000px",height:"600px",title:"暂停项目审批处理",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open(),n(t,e),a(t,e),""!=o&&(t.showIdea=!0,s(t,o))}function i(e,i,n){var a={method:"get",url:rootPath+"/projectStop/findPausingProject",params:{signId:i}},r=function(t){""!=t.data?common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"该项目暂停申请正在处理",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}})}}):o(e,i,n)};common.http({vm:e,$http:t,httpOptions:a,success:r})}function n(e,o){var i={method:"get",url:rootPath+"/projectStop/initProjectBySignId",params:{signId:o}},n=function(t){e.sign=t.data};common.http({vm:e,$http:t,httpOptions:i,success:n})}function a(e,o){var i={method:"get",url:rootPath+"/projectStop/countUsedWorkday",params:{signId:o}},n=function(t){e.sign.countUsedWorkday=t.data};common.http({vm:e,$http:t,httpOptions:i,success:n})}function r(e){if(common.initJqValidation(),$("#form").valid()){var o=[];o.push($("#file1").val()),o.push($("#file2").val());var i=o.join(",");e.projectStop.material=i;var n={method:"post",url:rootPath+"/projectStop/savePauseProject",data:e.projectStop},a=function(t){common.requestSuccess({vm:e,response:t,fn:function(){window.parent.$("#spwindow").data("kendoWindow").close(),e.gridOptions.dataSource.read(),common.alert({vm:e,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}})}})};common.http({vm:e,$http:t,httpOptions:n,success:a})}}function s(e,o){var i={method:"get",url:rootPath+"/projectStop/getProjectStopByStopId",params:{stopId:o}},n=function(t){e.projectStop=t.data,void 0==e.projectStop.directorIdeaContent&&(e.projectStop.directorIdeaContent=""),void 0==e.projectStop.leaderIdeaContent&&(e.projectStop.leaderIdeaContent="")};common.http({vm:e,$http:t,httpOptions:i,success:n})}function l(e){if(common.initJqValidation(),$("#form").valid()){var o={method:"post",url:rootPath+"/projectStop/updateProjectStop",data:e.projectStop},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){window.parent.$("#spwindow").data("kendoWindow").close(),e.gridOptions.dataSource.read(),common.alert({vm:e,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}})}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}}function c(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/projectStop/findByOData"),schema:{data:"value",total:function(t){return t.count?$("#pauseCount").html(t.count):$("#pauseCount").html(0),t.count},model:{id:"id",fields:{createdDate:{type:"date"},modifiedDate:{type:"date"}}}},serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=[{field:"",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"",title:"项目名称",width:200,filterable:!1,template:function(t){return t.sign.projectname}},{field:"",title:"评审阶段",width:100,filterable:!1,template:function(t){return t.sign.reviewstage}},{field:"createdDate",title:"申请日期",width:100,format:"{0:yyyy-MM-dd}",filterable:!1},{field:"",title:"操作",width:100,filterable:!1,template:function(t){return common.format($("#columnBtns").html(),"vm.pauseProjectWindow('"+t.sign.signid+"','"+t.stopid+"')")}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,resizable:!0,dataBound:function(){var t=this.items(),e=this.pager.page()-1,o=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*o,i=$(this).find(".row-number");$(i).html(t)})}}}return{pauseProjectWindow:o,pauseProject:r,initProject:n,countUsedWorkday:a,grid:c,getProjectStopByStopId:s,updateProjectStop:l,findPausingProject:i}}angular.module("app").factory("pauseProjectSvc",t),t.$inject=["$http","$state"]}(),function(){"use strict";function t(t,e){var o=this;o.title="定时器配置",function(){e.grid(o)}(),o.del=function(t){common.confirm({vm:o,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),e.deleteQuartz(o,t)}})},o.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)common.alert({vm:o,msg:"请选择数据"});else{for(var e=[],i=0;i<t.length;i++)e.push(t[i].value);var n=e.join(",");o.del(n)}},o.addQuartz=function(){o.quartz={},$("#quartz_edit_div").kendoWindow({width:"600px",height:"400px",title:"定时器编辑",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},o.edit=function(t){o.id=t,$("#quartz_edit_div").kendoWindow({width:"600px",height:"400px",title:"定时器修改",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open(),e.getQuartzById(o)},o.colseQuartz=function(){window.parent.$("#quartz_edit_div").data("kendoWindow").close()},o.saveQuartz=function(){e.saveQuartz(o)},o.execute=function(t){e.quartzExecute(o,t)},o.stop=function(t){e.quartzStop(o,t)}}angular.module("app").controller("quartzCtrl",t),t.$inject=["$location","quartzSvc"]}(),function(){"use strict";function t(t,e,o){var i=this;i.title="添加定时器配置",i.isuserExist=!1,i.id=o.params.id,i.create=function(){e.createQuartz(i)},i.update=function(){e.updateQuartz(i)}}angular.module("app").controller("quartzEditCtrl",t),t.$inject=["$location","quartzSvc","$state"]}(),function(){"use strict";function t(t){function e(e,o){var i={method:"put",url:l+"/quartzExecute",params:{quartzId:o}},n=function(t){var o="操作成功";"defeated"==t.data.substring(1,t.data.length-1)&&(o="该定时器未存在！"),common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:o,fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),e.gridOptions.dataSource.read()}})}})};common.http({vm:e,$http:t,httpOptions:i,success:n})}function o(e,o){var i={method:"put",url:l+"/quartzStop",params:{quartzId:o}},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),e.gridOptions.dataSource.read()}})}})};common.http({vm:e,$http:t,httpOptions:i,success:n})}function i(e){if(common.initJqValidation(),$("form").valid()){e.isSubmit=!0,e.quartz.id=e.id;var o={method:"put",url:l+"/updateQuartz",data:e.quartz},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),window.parent.$("#quartz_edit_div").data("kendoWindow").close(),e.gridOptions.dataSource.read()}})}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}}function n(e,o){e.isSubmit=!0;var i={method:"delete",url:l,data:o},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",closeDialog:!0,fn:function(){e.isSubmit=!1,e.gridOptions.dataSource.read()}})}})};common.http({vm:e,$http:t,httpOptions:i,success:n})}function a(e){if(common.initJqValidation($("#quartz_form")),$("#quartz_form").valid()){e.isSubmit=!0;var o={method:"post",url:rootPath+"/quartz",data:e.quartz},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",closeDialog:!0,fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),window.parent.$("#quartz_edit_div").data("kendoWindow").close(),e.gridOptions.dataSource.read()}})}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}}function r(e){var o={method:"get",url:rootPath+"/quartz/html/findById",params:{id:e.id}},i=function(t){e.quartz=t.data};common.http({vm:e,$http:t,httpOptions:o,success:i})}function s(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/quartz/findByOData"),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"quartzName",title:"定时器名称",width:100,filterable:!0},{field:"className",title:"类名",width:100,filterable:!0},{field:"cronExpression",title:"表达式",width:100,filterable:!0},{field:"",title:"执行状态",width:80,filterable:!0,template:function(t){return t.curState?"9"==t.curState?"在执行":"0"==t.curState?"未执行":void 0:""}},{field:"",title:"是否可用",width:80,filterable:!0,template:function(t){return t.isEnable?"0"==t.isEnable?"停用":"9"==t.isEnable?"在用":void 0:""}},{field:"descInfo",title:"描述",width:180},{field:"",title:"操作",width:140,template:function(t){return common.format($("#columnBtns").html(),"vm.del('"+t.id+"')","vm.edit('"+t.id+"')",t.isEnable,"vm.execute('"+t.id+"')",t.curState,"vm.stop('"+t.id+"')")}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,resizable:!0}}var l=rootPath+"/quartz";return{grid:s,getQuartzById:r,saveQuartz:a,deleteQuartz:n,updateQuartz:i,quartzExecute:e,quartzStop:o}}angular.module("app").factory("quartzSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e){var o=this;o.title="角色列表",o.del=function(t){common.confirm({vm:o,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),e.deleteRole(o,t)}})},o.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)common.alert({vm:o,msg:"请选择数据"});else{for(var e=[],i=0;i<t.length;i++)e.push(t[i].value);var n=e.join(",");o.del(n)}},function(){e.grid(o)}()}angular.module("app").controller("roleCtrl",t),t.$inject=["$location","roleSvc"]}(),function(){"use strict";function t(t,e,o){var i=this;i.title="添加角色",i.isRoleExist=!1,i.id=o.params.id,i.id&&(i.isUpdate=!0,i.title="更新角色"),i.create=function(){e.createRole(i)},i.update=function(){e.updateRole(i)},i.checkRole=function(){e.checkRole(i)},function(){i.isUpdate?e.getRoleById(i):e.initZtreeClient(i)}()}angular.module("app").controller("roleEditCtrl",t),t.$inject=["$location","roleSvc","$state"]}(),function(){"use strict";function t(t,e){function o(){return $.fn.zTree.getZTreeObj("zTree").getCheckedNodes(!0)}function i(t){for(var e=$.fn.zTree.getZTreeObj("zTree"),o=$linq(t.model.resources).select(function(t){return t.path}).toArray(),i=e.getNodesByParam("level",1,null),n=$linq(i).where(function(t){return $linq(o).contains(t.path)}).toArray(),a=0,r=n.length;a<r;a++)e.checkNode(n[a],!0,!0)}function n(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(m+"/fingByOData"),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=function(){var t=this.items(),e=this.pager.page()-1,o=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*o,i=$(this).find(".row-number");$(i).html(t)})},i=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:70,filterable:!1,template:"<span class='row-number'></span>"},{field:"roleName",title:"角色名称",width:200,filterable:!1},{field:"remark",title:"描述",filterable:!1},{field:"createdDate",title:"创建时间",width:180,filterable:!1,format:"{0:yyyy-MM-dd HH:mm:ss}"},{field:"",title:"操作",width:180,template:function(t){return common.format($("#columnBtns").html(),"vm.del('"+t.id+"')",t.id)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:o,resizable:!0}}function a(e){if(common.initJqValidation(),$("form").valid()&&0==e.isRoleExist){e.isSubmit=!0;var i=o(),n=$linq(i).where(function(t){return 0==t.isParent}).select(function(t){return{id:t.id,name:t.name,path:t.path,method:t.method}}).toArray();e.model.resources=n;var a={method:"post",url:m,data:e.model},r=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=u}})}})};common.http({vm:e,$http:t,httpOptions:a,success:r})}}function r(t){}function s(e){var o={method:"post",url:rootPath+"/role/findById",params:{roleId:e.id}},i=function(t){e.model=t.data,e.isUpdate&&d(e)};common.http({vm:e,$http:t,httpOptions:o,success:i})}function l(e){if(common.initJqValidation(),$("form").valid()&&0==e.isRoleExist){e.isSubmit=!0,e.model.id=e.id;var i=o(),n=$linq(i).where(function(t){return 0==t.isParent}).select(function(t){return{id:t.id,name:t.name,path:t.path,method:t.method}}).toArray();e.model.resources=n,e.model.createdDate="2017-04-07 12:00:00";var a={method:"put",url:m,data:e.model},r=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:e,$http:t,httpOptions:a,success:r})}}function c(e,o){e.isSubmit=!0;var i={method:"delete",url:m,data:o},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.isSubmit=!1,e.gridOptions.dataSource.read()}})};common.http({vm:e,$http:t,httpOptions:i,success:n})}function d(e){var o={method:"get",url:p},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){var o={check:{chkboxType:{Y:"ps",N:"ps"},enable:!0}},n=t.data;$.fn.zTree.init($("#zTree"),o,n),e.isUpdate&&i(e)}})};common.http({vm:e,$http:t,httpOptions:o,success:n})}var m=rootPath+"/role",u="#/role",p=rootPath+"/sys/resource";return{grid:n,createRole:a,checkRole:r,getRoleById:s,updateRole:l,deleteRole:c,initZtreeClient:d}}angular.module("app").factory("roleSvc",t),t.$inject=["$http","$compile"]}(),function(){"use strict";function t(t,e){var o=this;o.title="预定会议统计列表",o.queryRoomCount=function(){e.queryRoomCount(o)},o.del=function(t){common.confirm({vm:o,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),e.deleteroomCount(o,t)}})},o.ResetRoomCount=function(){e.cleanValue()},o.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)common.alert({vm:o,msg:"请选择数据"});else{for(var e=[],i=0;i<t.length;i++)e.push(t[i].value);var n=e.join(",");o.del(n)}},function(){e.grid(o),e.roomList(o),e.findAllOrg(o),e.findAllRoom(o)}()}angular.module("app").controller("roomCountCtrl",t),t.$inject=["$location","roomCountSvc"]}(),function(){"use strict";function t(t,e){function o(){var t=$("#roomCountform").find("input,select");$.each(t,function(t,e){e.value=""})}function i(t){t.gridOptions.dataSource.read()}function n(e){var o={method:"get",url:common.format(c+"/findAllUsers")},i=function(t){e.userlist={},e.userlist=t.data};common.http({vm:e,$http:t,httpOptions:o,success:i})}function a(e){var o={method:"get",url:common.format(c+"/getOrg")},i=function(t){e.orglist={},e.orglist=t.data};common.http({vm:e,$http:t,httpOptions:o,success:i})}function r(e){var o={method:"get",url:common.format(l+"/meeting")},i=function(t){e.roomlists={},e.roomlists=t.data};common.http({vm:e,$http:t,httpOptions:o,success:i})}function s(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(l+"/fingByOData",$("#roomCountform")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=function(){var t=this.items(),e=this.pager.page()-1,o=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*o,i=$(this).find(".row-number");$(i).html(t)})},i=[{field:"rowNumber",title:"序号",width:40,filterable:!1,template:"<span class='row-number'></span>"},{field:"rbName",title:"会议名称",width:120,filterable:!1},{field:"addressName",title:"会议地点",width:120,filterable:!1},{field:"rbDay",title:"会议日期",width:160,filterable:!1},{field:"beginTimeStr",title:"会议开始时间",width:160,filterable:!1},{field:"endTimeStr",title:"会议结束时间",type:"date",width:160,filterable:!1},{field:"rbType",title:"会议类型",width:100,filterable:!1},{field:"dueToPeople",title:"会议预定人",width:100,filterable:!1}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:o,resizable:!0}}var l=(rootPath,rootPath+"/room"),c=rootPath+"/user",c=rootPath+"/user";return{grid:s,queryRoomCount:i,roomList:r,findAllOrg:a,cleanValue:o,findAllRoom:n}}angular.module("app").factory("roomCountSvc",t),t.$inject=["$http","$compile"]}(),function(){"use strict";function t(t,e,o,i){var n=this;n.title="会议室预定列表",n.id=i.params.id,n.workProgramId=i.params.workProgramId,n.startDateTime=new Date("2006/6/1 08:00"),n.endDateTime=new Date("2030/6/1 21:00"),n.currentDate="",n.editRoom=function(){e.editRoom(n)},n.addRoom=function(){e.addRoom(n)},n.exportThisWeekStage=function(){n.currentDate=$(".k-sm-date-format").html(),n.rbType="0",e.exportThisWeekStage(n)},n.exportThisWeek=function(){n.currentDate=$(".k-sm-date-format").html(),n.rbType="1",e.exportThisWeekStage(n)},n.exportNextWeek=function(){console.log(123);var t=$(".k-sm-date-format").html(),o=t.split("-")[0].split("/"),i=o[0],a=2==o[1].length?o[1]:"0"+o[1],r=o[2].length>=2?o[2].substr(0,2):"0"+o[2].substr(0,1),s=new Date(a+"/"+r+"/"+i),l=new Date(a+"/"+r+"/"+i);s.setDate(s.getDate()+8-s.getDay()),l.setDate(l.getDate()+15-l.getDay());var c=new Date(s),d=new Date(l);n.currentDate=c.getFullYear()+"/"+(c.getMonth()+1)+"/"+c.getDate()+"-"+d.getFullYear()+"/"+(d.getMonth()+1)+"/"+d.getDate(),n.rbType="1",e.exportThisWeekStage(n)},n.exportNextWeekStage=function(){var t=$(".k-sm-date-format").html(),o=t.split("-")[0].split("/"),i=o[0],a=2==o[1].length?o[1]:"0"+o[1],r=o[2].length>=2?o[2].substr(0,2):"0"+o[2].substr(0,1),s=new Date(a+"/"+r+"/"+i),l=new Date(a+"/"+r+"/"+i);s.setDate(s.getDate()+8-s.getDay()),l.setDate(l.getDate()+15-l.getDay());var c=new Date(s),d=new Date(l);n.currentDate=c.getFullYear()+"/"+(c.getMonth()+1)+"/"+c.getDate()+"-"+d.getFullYear()+"/"+(d.getMonth()+1)+"/"+d.getDate(),n.rbType="0",e.exportThisWeekStage(n)},n.findMeeting=function(){e.findMeeting(n)},n.getPDF=function(t){kendo.drawing.drawDOM($(t)).then(function(t){kendo.drawing.pdf.saveAs(t,"会议室安排表.pdf")})},n.del=function(t){common.confirm({vm:n,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),e.deleteRoom(n,t)}})},n.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)common.alert({vm:n,msg:"请选择数据"});else{for(var e=[],o=0;o<t.length;o++)e.push(t[o].value);var i=e.join(",");n.del(i)}},function(){e.showMeeting(n),e.initRoom(n),e.initWorkProgram(n),e.initFindUserName(n)}()}angular.module("app").controller("roomCtrl",t),t.$inject=["$location","roomSvc","$scope","$state"]}(),function(){"use strict";function t(t,e,o){var i=this;i.title="添加会议室预定",i.isuserExist=!1,i.id=o.params.id,i.id&&(i.isUpdate=!0,i.title="更新会议室"),function(){i.isUpdate&&e.getroomById(i)}()}angular.module("app").controller("roomEditCtrl",t),t.$inject=["$location","roomSvc","$state"]}(),function(){"use strict";function t(t){function e(e){if(e.workProgramId){var o={method:"get",url:rootPath+"/workprogram/html/initWorkProgramById",params:{workId:e.workProgramId}},i=function(t){e.model={},e.model=t.data,e.model.rbName=e.model.projectName,e.model.stageOrgName=e.model.reviewOrgName,console.log(e.model.projectName),console.log(e.model.stageOrgName)};common.http({vm:e,$http:t,httpOptions:o,success:i})}}function o(e){var o={method:"get",url:rootPath+"/room/findUser",data:e.model},i=function(t){e.model={},e.model=t.data};common.http({vm:e,$http:t,httpOptions:o,success:i})}function i(e){if(e.model.id=$("#id").val(),e.model.rbName=$("#rbName").val(),e.model.mrID=$("#mrID").val(),e.model.rbType=$("#rbType").val(),e.model.host=$("#host").val(),e.model.dueToPeople=$("#dueToPeople").val(),e.model.rbDay=$("#rbDay").val(),e.model.beginTime=$("#beginTime").val(),e.model.endTime=$("#endTime").val(),e.model.content=$("#content").val(),e.model.content=$("#remark").val(),common.initJqValidation($("#formRoom")),$("#formRoom").valid()){e.iscommit=!0;var o={method:"put",url:rootPath+"/room/updateRoom",data:e.model},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}})}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}}function n(e){if(common.initJqValidation($("#formRoom")),$("#formRoom").valid()){var o={method:"post",url:rootPath+"/room/addRoom",data:e.model},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}})}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}}function a(e){var o=new kendo.data.SchedulerDataSource({batch:!0,sync:function(){this.read()},transport:{read:function(e){var o=e.data.mrID,i=rootPath+"/room";o&&(i+="?"+o),t.get(i).success(function(t){e.success(t.value)}).error(function(t){console.log("查询数据失败！")})},create:function(o){if(common.initJqValidation($("#formRoom")),$("#formRoom").valid()){var i=o.data.models[0];if(i.rbName=$("#rbName").val(),i.stageOrgName=$("#stageOrgName").val(),i.rbDay=$("#rbDay").val(),i.beginTimeStr=$("#beginTime").val(),i.endTimeStr=$("#endTime").val(),i.beginTime=$("#rbDay").val()+" "+$("#beginTime").val()+":00",i.endTime=$("#rbDay").val()+" "+$("#endTime").val()+":00",console.log(i),e.workProgramId&&(i.workProgramId=e.workProgramId),new Date(i.endTime)<new Date(i.beginTime))return void $("#errorTime").html("开始时间不能大于结束时间!");var n={method:"post",url:rootPath+"/room/addRoom",data:i},a=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){s(e),$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}})}})};common.http({vm:e,$http:t,httpOptions:n,success:a})}},update:function(o){if(common.initJqValidation($("#formRoom")),$("#formRoom").valid()){var i=o.data.models[0];if(i.rbDay=$("#rbDay").val(),i.beginTimeStr=$("#beginTime").val(),i.endTimeStr=$("#endTime").val(),i.beginTime=$("#rbDay").val()+" "+$("#beginTime").val()+":00",i.endTime=$("#rbDay").val()+" "+$("#endTime").val()+":00",new Date(i.endTime)<new Date(i.beginTime))return void $("#errorTime").html("开始时间不能大于结束时间!");var n={method:"put",url:rootPath+"/room/updateRoom",data:i},a=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){s(e),$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),e.schedulerOptions.cancelEvent()}})}})};common.http({vm:e,$http:t,httpOptions:n,success:a})}},destroy:function(o){var i=o.data.models[0].id,n={method:"delete",url:m,data:i},a=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"删除成功",closeDialog:!0})}})};common.http({vm:e,$http:t,httpOptions:n,success:a})},parameterMap:function(t,e){if(console.log(e),"read"!==e&&t.models)return{models:kendo.stringify(t.models)}}},serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,schema:{model:{id:"taskId",fields:{taskId:{from:"id"},title:{from:"addressName",defaultValue:"会议室"},start:{type:"date",from:"beginTime"},end:{type:"date",from:"endTime"}}}}});e.schedulerOptions={toolbar:["pdf"],pdf:{fileName:"会议室一览表.pdf",proxyURL:"https://demos.telerik.com/kendo-ui/service/export"},date:new Date,startTime:e.startDateTime,endTime:e.endDateTime,height:600,views:["day","workWeek",{type:"week",selected:!0},"month","agenda"],editable:{template:$("#customEditorTemplate").html()},eventTemplate:$("#event-template").html(),timezone:"Etc/UTC",dataSource:o,footer:!1}}function r(e){t.get(m+"/meeting").success(function(t){e.meetings={},e.meetings=t,e.meetings&&e.meetings.length>0&&(e.mrID=e.meetings[0].id,s(e))}).error(function(t){})}function s(t){t.mrID?t.schedulerOptions.dataSource.read({mrID:common.format("$filter=mrID eq '{0}'",t.mrID)}):t.schedulerOptions.dataSource.read()}function l(e){var o={method:"get",url:m+"/exportThisWeekStage",params:{currentDate:e.currentDate,rbType:e.rbType,mrId:e.mrID}},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}})}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}function c(e){var o={method:"get",url:m+"/exportThisWeekStage",params:{currentDate:e.currentDate}},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}})}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}function d(){window.open(m+"/exportWeek")}var m=rootPath+"/room";return{initRoom:a,showMeeting:r,findMeeting:s,exportThisWeekStage:l,exportNextWeekStage:c,exportThisWeek:d,addRoom:n,editRoom:i,initFindUserName:o,initWorkProgram:e}}angular.module("app").factory("roomSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e,o,i){var n=this;n.title="资料共享详情页",n.model={},n.model.sharId=e.params.sharId,n.downloadSysFile=function(t){i.downloadSysfile(t)},function(){i.getSharingDetailById(n,n.model.sharId),i.findFileList(n)}()}angular.module("app").controller("sharingDetailCtrl",t),t.$inject=["$location","$state","$http","sharingPlatlformSvc"]}(),function(){"use strict";function t(t,e,o,i){var n=this;n.title="共享资料管理",function(){i.grid(n)}(),n.del=function(t){common.confirm({vm:n,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),i.deleteSharingPlatlform(n,t)}})},n.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)common.alert({vm:n,msg:"请选择要删除的数据"});else{for(var e=[],o=0;o<t.length;o++)e.push(t[o].value);var i=e.join(",");n.del(i)}},n.bathPublish=function(){i.updatePublish(n,!0)},n.bathDown=function(){i.updatePublish(n,!1)},n.querySharing=function(){n.gridOptions.dataSource.read()}}angular.module("app").controller("sharingPlatlformCtrl",t),t.$inject=["$location","$state","$http","sharingPlatlformSvc"]}(),function(){"use strict";function t(t,e,o){var i=this;i.title="新增共享资料",i.model={},i.businessFlag={isInitFileOption:!1,isUpdate:!1,isInitSeled:!1},i.model.sharId=o.params.sharId,i.model.sharId&&(i.businessFlag.isUpdate=!0,i.title="更改共享资料"),function(){i.businessFlag.isUpdate?(e.getSharingPlatlformById(i),
e.findFileList(i)):e.initFileOption({sysfileType:"共享平台",uploadBt:"upload_file_bt",vm:i}),e.initOrgAndUser(i)}(),i.resetSharing=function(){var t=$("#formSharing").find("input,select");$.each(t,function(t,e){e.value=""})},i.create=function(){e.createSharingPlatlform(i)},i.checkBox=function(t){var e=t.target,o=e.checked,i=e.value;o?$('input[tit="'+i+'"]').each(function(){$(this).attr("disabled","disabled"),$(this).removeAttr("checked")}):$('input[tit="'+i+'"]').each(function(){$(this).removeAttr("disabled")})}}angular.module("app").controller("sharingPlatlformEditCtrl",t),t.$inject=["$location","sharingPlatlformSvc","$state"]}(),function(){"use strict";function t(t){function e(t){t.shareOrgList&&t.shareOrgList.length>0&&(t.model.privilegeDtoList&&t.model.privilegeDtoList.length>0&&t.shareOrgList.forEach(function(e,o){t.model.privilegeDtoList.forEach(function(t,o){1==t.businessType||"1"==t.businessType?t.businessId==e.id&&(e.isChecked=!0,e.userDtos.forEach(function(t,e){t.isDisabled=!0})):2!=t.businessType&&"2"!=t.businessType||e.userDtos.forEach(function(e,o){t.businessId==e.id&&(e.isChecked=!0)})})}),t.noOrgUsetList&&t.noOrgUsetList.length>0&&t.noOrgUsetList.forEach(function(e,o){t.model.privilegeDtoList.forEach(function(t,o){2!=t.businessType&&"2"!=t.businessType||t.businessId!=e.id||(e.isChecked=!0)})}),t.businessFlag.isInitSeled=!0)}function o(o){var i={method:"post",url:rootPath+"/sharingPlatlform/initOrgAndUser"},n=function(t){o.shareOrgList=t.data.orgDtoList,o.noOrgUsetList=t.data.noOrgUserList,o.businessFlag.isUpdate&&!o.businessFlag.isInitSeled&&e(o)};common.http({vm:o,$http:t,httpOptions:i,success:n})}function i(t){t&&window.open(rootPath+"/file/fileDownload?sysfileId="+t)}function n(e,o){var i={method:"get",url:u+"/html/sharingDeatilById",params:{id:o}},n=function(t){e.model=t.data};common.http({vm:e,$http:t,httpOptions:i,success:n})}function a(e){var o={method:"get",url:rootPath+"/file/findByBusinessId",params:{businessId:e.model.sharId}},i=function(t){e.sysFilelists=t.data};common.http({vm:e,$http:t,httpOptions:o,success:i})}function r(e){if(e.uploadBt){$("#"+e.uploadBt).click(function(){e.businessId?$("#commonuploadWindow").kendoWindow({width:700,height:400,title:"附件上传",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open():common.alert({vm:e.vm,msg:"请先保存数据！",closeDialog:!0})}),e.businessId&&(e.vm.downloadSysFile=function(t){window.open(rootPath+"/file/fileDownload?sysfileId="+t)}),e.vm.delSysFile=function(o){var i={method:"delete",url:rootPath+"/file/deleteSysFile",params:{id:o}},n=function(t){common.requestSuccess({vm:e.vm,response:t,fn:function(){a(e.vm),common.alert({vm:e.vm,msg:"删除成功",closeDialog:!0})}})};common.http({vm:e.vm,$http:t,httpOptions:i,success:n})};var o={language:"zh",allowedPreviewTypes:["image"],allowedFileExtensions:["jpg","png","gif","xlsx","docx","doc","xls","pdf","ppt","zip","rar","txt"],maxFileSize:2e3,showRemove:!1,uploadUrl:rootPath+"/file/fileUpload",uploadExtraData:{businessId:e.businessId,sysSignId:"共享平台",sysfileType:angular.isUndefined(e.sysfileType)?"共享平台":e.sysfileType}},i=0;$("#sysfileinput").fileinput(o).on("filebatchselected",function(t,e){i=e.length}).on("fileuploaded",function(t,o,n,r){i==r+1&&a(e.vm)}),e.vm.businessFlag.isInitFileOption=!0}}function s(e,o){e.isSubmit=!0;var i={method:"delete",url:u+"/sharingDelete",data:o},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",closeDialog:!0,fn:function(){e.isSubmit=!1,e.gridOptions.dataSource.read()}})}})};common.http({vm:e,$http:t,httpOptions:i,success:n})}function l(e){if($("form").valid()){if(e.isSubmit=!0,9!=e.model.isNoPermission){e.model.privilegeDtoList=[];var o=$("input[name='shareOrg']:checked");if(o.length>0)for(var i=0;i<o.length;i++){var n={};n.businessId=o[i].value,n.businessType="1",e.model.privilegeDtoList.push(n)}var a=$("input[name='shareUser']:not(:disabled):checked");if(a.length>0)for(var i=0;i<a.length;i++){var s={};s.businessId=a[i].value,s.businessType="2",e.model.privilegeDtoList.push(s)}}var l={method:"post",url:rootPath+"/sharingPlatlform/saveSharing",data:e.model},c=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.isSubmit=!1,common.alert({vm:e,msg:"操作成功",closeDialog:!0})}}),e.model.sharId=t.data.sharId,r({businessId:e.model.sharId,sysfileType:"共享平台",uploadBt:"upload_file_bt",vm:e})};common.http({vm:e,$http:t,httpOptions:l,success:c,onError:function(){e.isSubmit=!1}})}}function c(o){var i={method:"get",url:u+"/html/findById",params:{id:o.model.sharId}},n=function(t){o.model=t.data,o.businessFlag.isInitSeled||e(o),r({businessId:o.model.sharId,sysfileType:"共享平台",uploadBt:"upload_file_bt",vm:o})};common.http({vm:o,$http:t,httpOptions:i,success:n})}function d(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(u+"/findByCurUser",$("#formSharing")),schema:common.kendoGridConfig().schema({id:"sharId",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=function(){var t=this.items(),e=this.pager.page()-1,o=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*o,i=$(this).find(".row-number");$(i).html(t)})},i=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.sharId)},filterable:!1,width:30,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"unitSort",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"theme",title:"主题",width:180,filterable:!1},{field:"publishUsername",title:"发布人",width:120,filterable:!1},{field:"publishDate",title:"发布时间",format:"{0:yyyy-MM-dd hh24:mm:ss}",width:180,filterable:!1},{field:"isPublish",title:"发布状态",width:100,template:function(t){return t.isPublish&&9==t.isPublish?"已发布":"未发布"}},{field:"",title:"操作",width:180,template:function(t){return common.format($("#columnBtns").html(),t.sharId,t.sharId,"vm.del('"+t.sharId+"')")}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,dataBound:o,columns:i,resizable:!0}}function m(e,o){var i=common.getKendoCheckId(".grid");if(0==i.length)common.alert({vm:e,msg:"请选择要批量发布的数据"});else{for(var n=[],a=0;a<i.length;a++)n.push(i[a].value);var r={method:"post",url:rootPath+"/sharingPlatlform/updatePublish",params:{ids:n.join(","),status:1==o?"9":"0"}},s=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.isSubmit=!1,e.gridOptions.dataSource.read(),common.alert({vm:e,msg:"操作成功",closeDialog:!0})}})};common.http({vm:e,$http:t,httpOptions:r,success:s})}}var u=rootPath+"/sharingPlatlform";return{grid:d,getSharingPlatlformById:c,createSharingPlatlform:l,deleteSharingPlatlform:s,initFileOption:r,findFileList:a,getSharingDetailById:n,downloadSysfile:i,initOrgAndUser:o,initSeleObj:e,updatePublish:m}}angular.module("app").factory("sharingPlatlformSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e,o,i){var n=this;n.title="共享管理",n.model={},function(){i.grid(n)}(),n.findSharing=function(){n.gridOptions.dataSource.read()},n.resetShared=function(){var t=$("#formSharingPub").find("select");$.each(t,function(t,e){e.value=""})}}angular.module("app").controller("sharingPlatlformYetCtrl",t),t.$inject=["$location","$state","$http","sharingPlatlformYetSvc"]}(),function(){"use strict";function t(t){function e(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/sharingPlatlform/findByReception",$("#formSharingPub")),schema:common.kendoGridConfig().schema({id:"sharId",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=function(){var t=this.items(),e=this.pager.page()-1,o=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*o,i=$(this).find(".row-number");$(i).html(t)})},i=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.sharId)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"unitSort",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"theme",title:"共享主题",width:180,filterable:!0},{field:"publishUsername",title:"发布人",width:100,filterable:!0},{field:"publishDate",title:"发布时间",width:100,filterable:!0},{field:"",title:"操作",width:140,template:function(t){return common.format($("#columnBtns").html(),t.sharId)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:o,resizable:!0}}return{grid:e}}angular.module("app").factory("sharingPlatlformYetSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e){function o(e){var o={method:"get",url:rootPath+"/idea"},i=function(t){e.ideas=t.data};common.http({vm:e,$http:t,httpOptions:o,success:i})}return{initIdea:o}}angular.module("app").factory("ideaSvc",t),t.$inject=["$http","$state"]}(),function(){"use strict";function t(t,e,o){var i=this;i.model={},i.title="新增收文",i.create=function(){e.createSign(i)}}angular.module("app").controller("signCreateCtrl",t),t.$inject=["$location","signSvc","$state"]}(),function(){"use strict";function t(t,e,o,i,n){var a=this;a.title="收文列表",function(){e.grid(a)}(),a.querySign=function(){e.querySign(a)},a.check=function(){a.isAssociate=a.ischeck?9:0},a.del=function(t){common.confirm({vm:a,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),e.deleteSign(a,t)}})},a.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)common.alert({vm:a,msg:"请选择数据"});else{for(var e=[],o=0;o<t.length;o++)e.push(t[o].value);var i=e.join(",");a.del(i)}},a.startNewFlow=function(t){common.confirm({vm:a,title:"",msg:"确认签收完成了么？",fn:function(){$(".confirmDialog").modal("hide"),n.startFlow(a,t)}})},a.realSign=function(t){common.confirm({vm:a,title:"",msg:"确认正式签收了么？",fn:function(){$(".confirmDialog").modal("hide"),e.realSign(a,t)}})}}angular.module("app").controller("signCtrl",t),t.$inject=["$location","signSvc","$state","flowSvc","signFlowSvc"]}(),function(){"use strict";function t(t,e,o,i){var n=this;n.model={},n.title="填写报审登记表",n.model.signid=e.params.signid,n.flowDeal=!1,t.initFillData(n),n.mainDeptUser=function(){n.model.maindeptName||common.alert({vm:n,msg:"请选择办事处，再选择选择联系人！"})},n.assistDeptUser=function(){n.model.assistdeptName||common.alert({vm:n,msg:"请选择办事处，再选择选择联系人！"})},n.checkOrgType=function(t){var e=t.target,o=e.checked,i=e.value;if(o){n.model.leaderName=signcommon.getDefaultLeader(i),n.model.comprehensivehandlesug=signcommon.getDefaultZHBYJ(i),n.model.comprehensiveName="综合部";var a=new Date,r=a.getMonth()+1<10?"0"+(a.getMonth()+1):a.getMonth()+1,s=a.getDate()<10?"0"+a.getDate():a.getDate();n.model.comprehensiveDate=a.getFullYear()+"-"+r+"-"+s}},n.startNewFlow=function(){i.confirm({title:"询问提示",message:"确定发起流程么",onOk:function(){$(".confirmDialog").modal("hide");var t={method:"post",url:rootPath+"/sign/startNewFlow",params:{signid:n.model.signid}},e=function(t){"ok"==t.data.reCode?i.success("操作成功！"):i.error(t.data.reMsg)};common.http({vm:n,$http:o,httpOptions:t,success:e})}})},n.signPreview=function(t){var e=$(".well").parents("body"),o=e.find(".main-sidebar"),i=e.find(".main-header"),n=e.find(".content-wrapper");o.hide(),i.hide(),$(".toolbar").hide(),$(".well input").each(function(){var t=$(this).attr("type");"text"==t&&$(this).before('<span class="printmesge" data="text" style="white-space : nowrap;">'+$(this).val()+"</span>"),"checkbox"==t&&($(this).is(":checked")?$(this).before('<span class="printmesge" data="text">有</span>'):$(this).before('<span class="printmesge" data="text">无</span>'))}),$(".printmesge").show(),$(".well input[type=text]").hide(),$(".well input[type=checkbox]").hide(),$(".well button").hide(),n.find("td div select").hide(),n.find("td div span").css("margin","0"),$(".well").addClass("printbody"),$(".well .table-bordered").addClass("tableBOX"),n.find("input").addClass("noborder"),n.addClass("nomargin"),window.print(),o.show(),i.show(),$(".toolbar").show(),$(".printmesge").hide(),$(".well input[type=text]").show(),$(".well input[type=checkbox]").show(),$(".well button").show(),n.find("td div select").show(),n.find("td div span").css("margin-left","100px"),$(".well").removeClass("printbody"),$(".well .table-bordered").removeClass("tableBOX"),$("[data=text]").remove(),n.find("input").removeClass("noborder"),n.removeClass("nomargin")},n.updateFillin=function(){n.isSubmit=!0,t.updateFillin(n.model,function(t){n.isSubmit=!1,i.alert("操作成功！")})},n.findOfficeUsersByDeptName=function(e){t.findOfficeUsersByDeptName(n,e)}}angular.module("app").controller("signFillinCtrl",t),t.$inject=["signSvc","$state","$http","bsWin"]}(),function(){"use strict";function t(t,e,o,i){var n=this;n.title="已办结项目详情",n.model={},n.flow={},n.model.signid=o.params.signid,n.flow.processInstanceId=o.params.processInstanceId,n.flow.hideFlowImg=!0,n.showFlag={tabWorkProgram:!1,tabBaseWP:!1,tabDispatch:!1,tabFilerecord:!1,tabExpert:!1,tabSysFile:!1,tabAssociateSigns:!1},n.businessFlag={},function(){$("#myTab li").click(function(t){var e=$("a",this);t.preventDefault(),e.tab("show");var o=e.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+o).addClass("active").addClass("in").show(500)}),i.initFlowData(n),e.initFlowPageData(n)}(),n.getExpertStar=function(t,e){var o="";if(void 0!=e)for(var i=0;i<e;i++)o+="<span style='color:gold;font-size:20px;'><i class='fa fa-star' aria-hidden='true'></i></span>";$("#"+t+"_starhtml").html(o)}}angular.module("app").controller("signEndCtrl",t),t.$inject=["$location","signSvc","$state","flowSvc"]}(),function(){"use strict";function t(t,e,o){function i(e,i){var n={method:"post",url:rootPath+"/sign/startNewFlow",params:{signid:i}},a=function(t){e.gridOptions.dataSource.read(),o.success("操作成功！")};common.http({vm:e,$http:t,httpOptions:n,success:a})}function n(t){switch(t.flow.curNode.activitiId){case flowcommon.getSignFlowNode().SIGN_QS:t.showFlag.businessTr=!0,t.showFlag.nodeSign=!0;break;case flowcommon.getSignFlowNode().SIGN_ZHB:t.showFlag.buttBack=!0,t.showFlag.businessNext=!0,t.showFlag.nodeSelViceMgr=!0,t.flow.businessMap&&(t.viceDirectors=t.flow.businessMap.viceDirectors);break;case flowcommon.getSignFlowNode().SIGN_FGLD_FB:t.showFlag.buttBack=!0,t.showFlag.businessNext=!0,t.showFlag.nodeSelOrgs=!0,t.flow.businessMap&&(t.orgs=t.flow.businessMap.orgs);break;case flowcommon.getSignFlowNode().SIGN_BMFB1:t.businessFlag.isMainBranch=!0;case flowcommon.getSignFlowNode().SIGN_BMFB2:case flowcommon.getSignFlowNode().SIGN_BMFB3:case flowcommon.getSignFlowNode().SIGN_BMFB4:t.showFlag.businessNext=!0,t.showFlag.nodeSelPrincipal=!0,t.flow.businessMap&&(t.users=t.flow.businessMap.users);break;case flowcommon.getSignFlowNode().SIGN_XMFZR1:t.businessFlag.isMainBranch=!0;case flowcommon.getSignFlowNode().SIGN_XMFZR2:case flowcommon.getSignFlowNode().SIGN_XMFZR3:case flowcommon.getSignFlowNode().SIGN_XMFZR4:t.showFlag.businessTr=!0,t.showFlag.nodeWorkProgram=!0,t.businessFlag.isFinishWP=t.flow.businessMap.isFinishWP;break;case flowcommon.getSignFlowNode().SIGN_FW:t.showFlag.businessTr=!0,t.showFlag.nodeDispatch=!0,t.flow.businessMap.prilUserList&&(t.businessFlag.principalUsers=t.flow.businessMap.prilUserList,t.showFlag.businessNext=!0),t.model.processState>=4&&(t.showFlag.tabDispatch=!0,$("#show_dispatch_a").click());break;case flowcommon.getSignFlowNode().SIGN_QRFW:t.showFlag.businessTr=!0,t.showFlag.nodeConfirmDis=!0,t.businessFlag.passDis="9",t.showFlag.tabDispatch=!0,$("#show_dispatch_a").click();break;case flowcommon.getSignFlowNode().SIGN_BMLD_QRFW:case flowcommon.getSignFlowNode().SIGN_FGLD_QRFW:case flowcommon.getSignFlowNode().SIGN_ZR_QRFW:case flowcommon.getSignFlowNode().SIGN_FWBH:t.showFlag.tabDispatch=!0,$("#show_dispatch_a").click(),t.showFlag.businessTr=!0,t.showFlag.nodeCreateDisNum=!0;break;case flowcommon.getSignFlowNode().SIGN_CWBL:break;case flowcommon.getSignFlowNode().SIGN_GD:t.flow.businessMap.checkFileUser&&(t.showFlag.businessNext=!0),t.showFlag.businessTr=!0,t.showFlag.nodeFileRecord=!0,t.model.processState>6&&(t.showFlag.tabFilerecord=!0,$("#show_filerecord_a").click());break;case flowcommon.getSignFlowNode().SIGN_DSFZR_QRGD:t.showFlag.tabFilerecord=!0,$("#show_filerecord_a").click();break;case flowcommon.getSignFlowNode().SIGN_QRGD:t.showFlag.tabFilerecord=!0,$("#show_filerecord_a").click(),t.showFlag.nodeNext=!1}}function a(t){t.flow.businessMap||(t.flow.businessMap={});var e={};switch(e.resultTag=!0,t.flow.curNode.activitiId){case flowcommon.getSignFlowNode().SIGN_ZHB:$("#viceDirector").val()?t.flow.businessMap.FGLD=$("#viceDirector").val():e.resultTag=!1;break;case flowcommon.getSignFlowNode().SIGN_FGLD_FB:if(e.resultTag=!1,$('.seleteTable input[selectType="main"]:checked').each(function(){t.flow.businessMap.MAIN_ORG=$(this).val(),e.resultTag=!0}),e.resultTag){var o=[];$('.seleteTable input[selectType="assist"]:checked').each(function(){o.push($(this).val())}),o.length>3?(e.resultTag=!1,e.resultMsg="协办部门最多只能选择3个！"):t.flow.businessMap.ASSIST_ORG=o.join(",")}else e.resultMsg="主办部门不为空！";break;case flowcommon.getSignFlowNode().SIGN_BMFB1:var i=$("#selPrincipalMainUser").val();if(!i){e.resultTag=!1,e.resultMsg="必须要选择一个第一负责人！";break}e.resultTag=!0,t.flow.businessMap.M_USER_ID=i;var n=[];$('#principalAssistUser input[selectType="assistUser"]:checked').each(function(){n.push($(this).val())}),n.length>0&&(t.flow.businessMap.A_USER_ID=n.join(","));break;case flowcommon.getSignFlowNode().SIGN_BMFB2:case flowcommon.getSignFlowNode().SIGN_BMFB3:case flowcommon.getSignFlowNode().SIGN_BMFB4:var n=[];$('#principalAssistUser input[selectType="assistUser"]:checked').each(function(){n.push($(this).val())}),n.length>0?t.flow.businessMap.A_USER_ID=n.join(","):(e.resultTag=!1,e.resultMsg="必须要选择负责人！");break;case flowcommon.getSignFlowNode().SIGN_XMFZR1:case flowcommon.getSignFlowNode().SIGN_XMFZR2:case flowcommon.getSignFlowNode().SIGN_XMFZR3:case flowcommon.getSignFlowNode().SIGN_XMFZR4:9==t.businessFlag.isNeedWP&&0==t.businessFlag.isFinishWP&&(e.resultTag=!1,e.resultMsg="您还没有完成工作方案，不能进行下一步操作！"),t.flow.businessMap.IS_NEED_WP=t.businessFlag.isNeedWP;break;case flowcommon.getSignFlowNode().SIGN_BMLD_SPW1:case flowcommon.getSignFlowNode().SIGN_BMLD_SPW2:case flowcommon.getSignFlowNode().SIGN_BMLD_SPW3:case flowcommon.getSignFlowNode().SIGN_BMLD_SPW4:break;case flowcommon.getSignFlowNode().SIGN_FGLD_SPW1:case flowcommon.getSignFlowNode().SIGN_FGLD_SPW2:case flowcommon.getSignFlowNode().SIGN_FGLD_SPW3:case flowcommon.getSignFlowNode().SIGN_FGLD_SPW4:break;case flowcommon.getSignFlowNode().SIGN_FW:t.model.processState<4&&(e.resultTag=!1,e.resultMsg="您还没完成发文操作，不能进行下一步操作！");break;case flowcommon.getSignFlowNode().SIGN_QRFW:"9"==t.businessFlag.passDis||9==t.businessFlag.passDis?t.flow.businessMap.AGREE="9":t.flow.businessMap.AGREE="0";break;case flowcommon.getSignFlowNode().SIGN_BMLD_QRFW:case flowcommon.getSignFlowNode().SIGN_FGLD_QRFW:case flowcommon.getSignFlowNode().SIGN_ZR_QRFW:case flowcommon.getSignFlowNode().SIGN_FWBH:t.flow.businessMap.DIS_ID=t.dispatchDoc.id;break;case flowcommon.getSignFlowNode().SIGN_CWBL:break;case flowcommon.getSignFlowNode().SIGN_GD:t.model.processState<7&&(e.resultTag=!1,e.resultMsg="您还没完成归档操作，不能进行下一步操作！");break;case flowcommon.getSignFlowNode().SIGN_DSFZR_QRGD:break;case flowcommon.getSignFlowNode().SIGN_QRGD:t.flow.businessMap.GD_ID=t.fileRecord.fileRecordId}return e}function r(e){var o={method:"get",url:rootPath+"/dispatch/html/initDispatchBySignId",params:{signId:e.model.signid}},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.dispatchDoc=t.data,$("#show_dispatch_a").click()}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}function s(e){var o={method:"get",url:rootPath+"/fileRecord/html/initBySignId",params:{signId:e.model.signid}},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.fileRecord=t.data,$("#show_filerecord_a").click()}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}function l(e){var o={method:"get",url:rootPath+"/sign/html/initDetailPageData",params:{signid:e.model.signid,queryAll:!0}},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.model=t.data,e.model.workProgramDtoList&&e.model.workProgramDtoList.length>0&&(e.show_workprogram=!0,e.model.workProgramDtoList.forEach(function(t,o){9==t.isMain?(e.showMainwork=!0,e.mainwork={},e.mainwork=t):0==t.isMain&&(e.showAssistwork=!0,e.assistwork={},e.assistwork=t)})),e.model.dispatchDocDto&&(e.show_dispatch=!0,e.dispatchDoc=e.model.dispatchDocDto),e.model.fileRecordDto&&(e.show_filerecord=!0,e.fileRecord=e.model.fileRecordDto)}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}return{startFlow:i,initBusinessParams:n,checkBusinessFill:a,getChargeDispatch:r,getChargeFilerecord:s,endSignDetail:l}}angular.module("app").factory("signFlowSvc",t),t.$inject=["$http","$state","bsWin"]}(),function(){"use strict";function t(t,e,o,i,n,a,r,s){var l=this;l.title="项目流程处理",l.model={},l.flow={},l.mainwork={},l.assistwork={},l.dispatchDoc={},l.fileRecord={},l.expertReview={},l.showFlag={businessTr:!1,businessDis:!1,businessNext:!1,nodeNext:!0,nodeSelViceMgr:!1,nodeSelOrgs:!1,nodeSelPrincipal:!1,isMainBranch:!1,nodeSign:!1,nodeWorkProgram:!1,nodeDispatch:!1,nodeConfirmDis:!1,nodeCreateDisNum:!1,nodeFileRecord:!1,nodeSelXSOrg:!1,nodeSelXSPri:!1,nodeXSWorkProgram:!1,tabWorkProgram:!1,tabBaseWP:!1,tabDispatch:!1,tabFilerecord:!1,tabExpert:!1,tabSysFile:!1,buttBack:!1,expertRemark:!1,expertpayment:!1,expertEdit:!0},l.businessFlag={isLoadSign:!1,isLoadFlow:!1,isGotoDis:!1,isMakeDisNum:!1,principalUsers:[],isSelMainPriUser:!1,expertReviews:[],editExpertSC:!1,expertScore:{},isNeedWP:9,isMainBranch:!1,isFinishWP:!1,passDis:!1},l.model.signid=o.params.signid,l.flow.taskId=o.params.taskId,l.flow.processInstanceId=o.params.processInstanceId,function(){$("#myTab li").click(function(t){var e=$("a",this);t.preventDefault(),e.tab("show");var o=e.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+o).addClass("active").addClass("in").show(500)}),e.initFlowPageData(l),i.getFlowInfo(l),i.initFlowData(l),e.uploadFilelist(l),e.associateGrid(l),a.initIdea(l)}(),l.initBusinessParams=function(){l.businessFlag.isLoadSign&&l.businessFlag.isLoadFlow&&n.initBusinessParams(l)},l.checkPrincipal=function(){var t=$("#selPrincipalMainUser").val();t&&$('#principalAssistUser input[selectType="assistUser"]').each(function(){$(this).attr("value")==t?($(this).removeAttr("checked"),$(this).attr("disabled","disabled")):$(this).removeAttr("disabled")})},l.editSelectExpert=function(t){l.businessFlag.expertScore={},l.businessFlag.expertReviews.forEach(function(e,o){e.expertSelectedDtoList.forEach(function(e,o){if(e.id==t)return void(l.businessFlag.expertScore=e)})}),$("#star").raty({score:function(){return $(this).attr("data-num",angular.isUndefined(l.businessFlag.expertScore.score)?0:l.businessFlag.expertScore.score),$(this).attr("data-num")},starOn:"../contents/libs/raty/lib/images/star-on.png",starOff:"../contents/libs/raty/lib/images/star-off.png",starHalf:"../contents/libs/raty/lib/images/star-half.png",readOnly:!1,halfShow:!0,size:34,click:function(t,e){l.businessFlag.expertScore.score=t}}),$("#expertmark").kendoWindow({width:"820px",height:"365px",title:"编辑-专家星级",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},l.closeEditMark=function(){window.parent.$("#expertmark").data("kendoWindow").close()},l.saveMark=function(){i.saveMark(l,function(){})},l.getExpertStar=function(t,e){var o="";if(void 0!=e)for(var i=0;i<e;i++)o+="<span style='color:gold;font-size:20px;'><i class='fa fa-star' aria-hidden='true'></i></span>";$("#"+t+"_starhtml").html(o)},l.editpayment=function(t){l.expertReview.expertId=t,i.gotopayment(l)},l.countTaxes=function(t){if(void 0!=t){if(void 0==t.payDate)return void(t.errorMsg="请选择发放日期");if(!/^(\d{4}-\d{1,2}-\d{1,2})$/.exec(t.payDate))return void(t.errorMsg="请输入正确的日期格式");t.errorMsg="",common.initJqValidation($("#payform"));$("#payform").valid()&&i.countTaxes(l,t)}},l.closeEditPay=function(){window.parent.$("#payment").data("kendoWindow").close()},l.savePayment=function(){i.savePayment(l,function(){e.paymentGrid(l)})},l.ideaEdit=function(t){common.initIdeaData(l,r,t)},l.selectIdea=function(){l.flow.dealOption=l.idea},l.commitNextStep=function(){if(l.flow.isSuspended)return void s.error("该流程目前为暂停状态，不能进行流转操作！");n.checkBusinessFill(l).resultTag?i.commit(l.isCommit,l.flow,function(t){(t.flag||"ok"==t.reCode)&&s.success("操作成功！",function(){o.go("gtasks")})}):common.alert({vm:l,msg:"请先完成相应的业务操作才能提交"})},l.commitBack=function(){common.initJqValidation($("#flow_form")),$("#flow_form").valid()&&s.confirm({title:"询问提示",message:"确认回退吗？",onOk:function(){switch(l.flow.curNode.activitiId){case"FGLD_SP_GZFA1":l.flow.businessMap.M_WP_ID=l.mainwork.id;break;case"FGLD_SP_GZFA2":l.flow.businessMap.A_WP_ID=l.assistwork.id;break;case"FGLD_SP_FW":case"ZR_SP_FW":l.flow.businessMap.DIS_ID=l.dispatchDoc.id;break;case"BMLD_QR_GD":l.flow.businessMap.ExclusiveGateWay=!0;break;case"XS_FGLDSP_GZFA":l.flow.businessMap.WP_ID=l.mainwork.id;break;case"XS_FGLDSP_FW":case"XS_ZRSP_FW":l.flow.businessMap.DIS_ID=l.dispatchDoc.id;break;case"XS_QRGD":l.flow.businessMap.ExclusiveGateWay=!0}i.rollBackToLast(l)}})},l.deleteFlow=function(){s.confirm({title:"询问提示",message:"终止流程将无法恢复，确认删除么？？",onOk:function(){$(".confirmDialog").modal("hide"),i.deleteFlow(l)}})},l.initDealUerByAcitiviId=function(){i.initDealUerByAcitiviId(l)},l.showBtByAcivitiId=function(t){return l.flow.curNodeAcivitiId==t},l.editSign=function(){o.go("fillSign",{signid:l.model.signid})},l.addWorkProgram=function(){o.go("workprogramEdit",{signid:l.model.signid})},l.addSuppLetter=function(){o.go("addSupp",{signid:l.model.signid,id:l.model.suppletterid})},l.addRegisterFile=function(){o.go("registerFile",{signid:l.model.signid})},l.addBaseWP=function(){o.go("workprogramBaseEdit",{signid:l.model.signid})},l.addDisPatch=function(){o.go("dispatchEdit",{signid:l.model.signid})},l.addDoFile=function(){o.go("fileRecordEdit",{signid:l.model.signid})},l.mainOrg=function(t){var e=t.target,o=e.checked,i=e.value;o?$('.seleteTable input[selectType="main"]').each(function(){var t=$(this).attr("value");t!=i?($(this).removeAttr("checked"),$("#assist_"+t).removeAttr("disabled")):($("#assist_"+i).removeAttr("checked"),$("#assist_"+i).attr("disabled","disabled"))}):$("#assist_"+i).removeAttr("disabled"),l.initOption()},l.initOption=function(){var t=[];$('.seleteTable input[selectType="main"]:checked').each(function(){t.push($(this).attr("tit"))}),$('.seleteTable input[selectType="assist"]:checked').each(function(){t.push($(this).attr("tit"))}),t.length>0&&(l.flow.dealOption="请（"+t.join("，")+"）组织评审")},l.checkBoxSingle=function(t,e){var o=t.target,i=o.checked,n=o.value;i?$('.seleteTable input[selectType="'+e+'"]').each(function(){var t=$(this).attr("id"),o=$(this).attr("value");t!=e+"_"+n?($("#"+disabletype+"_"+o).removeAttr("disabled"),$(this).removeAttr("checked")):$("#"+disabletype+"_"+n).attr("disabled","disabled")}):$("#"+disabletype+"_"+n).removeAttr("disabled")},l.checkBoxSingle=function(t,e){var o=t.target,i=o.checked,n=o.value;i&&$('#xs_table input[selectType="'+e+'"]').each(function(){$(this).attr("id");$(this).attr("value")!=n&&$(this).removeAttr("checked")})},l.showAssociate=function(){l.currentAssociateSign=l.model,$("#associateWindow").kendoWindow({width:"60%",height:"625px",title:"项目关联",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()},l.saveAssociateSign=function(t){if(l.model.signid==t)return void s.alert("不能关联自身项目");e.saveAssociateSign(l,l.model.signid,t,function(){s.alert(void 0!=t?"项目关联成功":"项目解除关联成功"),o.reload()})},l.associateQuerySign=function(){l.associateGridOptions.dataSource.read()},l.disAssociateSign=function(){e.saveAssociateSign(l,l.model.signid,null,function(){o.reload()})},l.addPriUser=function(){var t=$("#xs_bmfb input[name='unSelPriUser']:checked");if(t.length<1)common.alert({vm:l,msg:"请选择负责人"});else{if(9==l.isMainPriUser&&t.length>1)return void common.alert({vm:l,msg:"总负责人只能选一个"});if(0==l.businessFlag.isSelMainPriUser&&(angular.isUndefined(l.isMainPriUser)||0==l.isMainPriUser))return void common.alert({vm:l,msg:"请先选择总负责人！"});if(1==l.businessFlag.isSelMainPriUser&&9==l.isMainPriUser)return void common.alert({vm:l,msg:"你已经选择了一个总负责人，不能再次选择负责人"});if(l.businessFlag.principalUsers&&l.businessFlag.principalUsers.length+t.length>3)return void common.alert({vm:l,msg:"最多只能选择3个负责人，请重新选择！"});for(var e=0;e<t.length;e++){var o={};o.userId=t[e].value,o.userType=$("#userType").val(),9==l.isMainPriUser?(l.businessFlag.isSelMainPriUser=!0,o.isMainUser=9,l.isMainPriUser):o.isMainUser=0,l.xsusers.forEach(function(i,n){i.id==t[e].value&&(i.isSelected=!0,o.userName=i.loginName)}),l.businessFlag.principalUsers.push(o)}}},l.delPriUser=function(){var t=$("#xs_bmfb input[name='selPriUser']:checked");if(t.length<1)common.alert({vm:l,msg:"请选择取消的负责人"});else for(var e=0;e<t.length;e++)l.xsusers.forEach(function(o,i){o.id==t[e].value&&(o.isSelected=!1)}),l.businessFlag.principalUsers.forEach(function(o,i){o.userId==t[e].value&&(9==o.isMainUser&&(l.businessFlag.isSelMainPriUser=!1),l.businessFlag.principalUsers.splice(i,1))})},l.checkNeedWP=function(t){var o=t.target,i=o.checked;i?l.businessFlag.isNeedWP=9:l.businessFlag.isFinishWP?s.confirm({title:"询问提示",message:"取消工作方案操作将会对您之前的做的工作方案进行清除，数据清除不可恢复，确定不做工作么？",onOk:function(){$(".confirmDialog").modal("hide"),l.businessFlag.isNeedWP=0,e.removeWP(l)},onClose:function(){o.checked=!i,l.businessFlag.isNeedWP=9}}):l.businessFlag.isNeedWP=0},l.meetingDoc=function(){common.confirm({vm:l,title:"",msg:"如果之前已经生成会前准备材料，则本次生成的文档会覆盖之前产生的文档，确定执行操作么？",fn:function(){$(".confirmDialog").modal("hide"),e.meetingDoc(l)}})},l.commonDownloadSysFile=function(e){t.commonDownloadFile(l,e)},l.createDispatchFileNum=function(){e.createDispatchFileNum(l.model.signid,l.dispatchDoc.id,function(t){(t.flag||"ok"==t.reCode)&&(l.dispatchDoc.fileNum=t.reObj),s.alert(t.reMsg)})}}angular.module("app").controller("signFlowDealCtrl",t),t.$inject=["sysfileSvc","signSvc","$state","flowSvc","signFlowSvc","ideaSvc","$http","bsWin"]}(),function(){"use strict";function t(t,e,o,i,n){var a=this;a.title="项目流程信息",a.model={},a.flow={},a.work={},a.dispatchDoc={},a.fileRecord={},a.model.signid=o.params.signid,a.flow.taskId=o.params.taskId,a.flow.processInstanceId=o.params.processInstanceId,a.showFlag={tabWorkProgram:!1,tabBaseWP:!1,tabDispatch:!1,tabFilerecord:!1,tabExpert:!1,tabSysFile:!1,tabAssociateSigns:!1},a.businessFlag={},function(){$("#myTab li").click(function(t){var e=$("a",this);t.preventDefault(),e.tab("show");var o=e.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+o).addClass("active").addClass("in").show(500)}),i.initFlowData(a),e.initFlowPageData(a)}(),a.getExpertStar=function(t,e){var o="";if(void 0!=e)for(var i=0;i<e;i++)o+="<span style='color:gold;font-size:20px;'><i class='fa fa-star' aria-hidden='true'></i></span>";$("#"+t+"_starhtml").html(o)}}angular.module("app").controller("signFlowDetailCtrl",t),t.$inject=["$location","signSvc","$state","flowSvc","signFlowSvc"]}(),function(){"use strict";function t(t,e,o){var i=this;i.model={},i.title="新增预签收收文",i.reserveAdd=function(){e.reserveAdd(i)}}angular.module("app").controller("signReserveAddCtrl",t),t.$inject=["$location","reserveSignSvc","$state"]}(),function(){"use strict";function t(t,e,o){var i=this;i.model={},i.title="预签收列表",i.del=function(t){common.confirm({vm:i,title:"",msg:"确认删除数据吗？",fn:function(){
$(".confirmDialog").modal("hide"),e.deleteReserveSign(i,t)}})},i.querySign=function(){e.querySign(i)},function(){e.grid(i)}()}angular.module("app").controller("signReserveCtrl",t),t.$inject=["$location","reserveSignSvc","$state"]}(),function(){"use strict";function t(t,e){function o(t){t.gridOptions.dataSource.read()}function i(e){if(common.initJqValidation(),$("form").valid()){e.isSubmit=!0,e.model.id=e.id;var o={method:"put",url:c,data:e.model},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}}function n(e,o){e.isSubmit=!0;var i={method:"delete",url:c+"/deleteReserve",params:{signid:o}},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.isSubmit=!1,e.gridOptions.dataSource.read()}})};common.http({vm:e,$http:t,httpOptions:i,success:n})}function a(e){var o={method:"put",url:c+"/roomUseState",data:e.model},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.gridOptions.dataSource.read()}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}function r(o){if(common.initJqValidation(),$("form").valid()){o.isSubmit=!0;var i={method:"post",url:c+"/html/reserveAddPost",data:o.model},n=function(t){common.requestSuccess({vm:o,response:t,fn:function(){common.alert({vm:o,msg:"操作成功,请继续填写报审登记表！",closeDialog:!0,fn:function(){e.go("fillSign",{signid:t.data.signid},{reload:!0})}})}})};common.http({vm:o,$http:t,httpOptions:i,success:n,onError:function(t){o.iscommit=!1}})}}function s(e){var o={method:"get",url:c+"/html/findByIdsign",params:{id:e.id}},i=function(t){e.model=t.data};common.http({vm:e,$http:t,httpOptions:o,success:i})}function l(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(c+"/reserveListSign",$("#reserveFrom")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=function(){var t=this.items(),e=this.pager.page()-1,o=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*o,i=$(this).find(".row-number");$(i).html(t)})},i=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.signid)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"projectname",title:"项目名称",width:160,filterable:!1},{field:"projectcode",title:"收文编号",width:120,filterable:!1},{field:"designcompanyName",title:"项目单位",width:150,filterable:!1},{field:"reviewstage",title:"项目阶段",width:80,filterable:!1},{field:"projectcode",title:"项目代码",width:120,filterable:!1},{field:"receivedate",title:"收文时间",width:160,filterable:!1,format:"{0:yyyy/MM/dd HH:mm:ss}"},{field:"",title:"流程状态",width:80,filterable:!1,template:function(t){return t.ispresign?0==t.ispresign?'<span style="color:green;">预签收</span>':void 0:" "}},{field:"",title:"操作",width:180,template:function(t){return common.format($("#columnBtns").html(),t.signid,"vm.del('"+t.signid+"')")}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:o,resizable:!0}}var c=rootPath+"/sign";return{grid:l,getsignById:s,reserveAdd:r,deleteReserveSign:n,updatesign:i,querySign:o,roomUseState:a}}angular.module("app").factory("reserveSignSvc",t),t.$inject=["$http","$state"]}(),function(){"use strict";function t(t,e,o,i){var n=this;n.model={},n.title="查看详情信息",n.model.signid=o.params.signid,n.show_flow_info=!1,function(){$("#myTab li").click(function(t){var e=$("a",this);t.preventDefault(),e.tab("show");var o=e.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+o).addClass("active").addClass("in").show(500)}),e.initFlowPageData(n),e.initAssociateSigns(n,n.model.signid),angular.isUndefined(o.params.processInstanceId)||"undefined"==o.params.processInstanceId||(n.flow={},n.flow.processInstanceId=o.params.processInstanceId,i.initFlowData(n),n.show_flow_info=!0)}()}angular.module("app").controller("signDetailsCtrl",t),t.$inject=["$location","signSvc","$state","flowSvc"]}(),function(){"use strict";function t(t,e,o,i){function n(t){var o={method:"get",url:rootPath+"/file/findBySysFileSignId",params:{signid:t.model.signid}},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){e.data&&e.data.length>0&&(t.sysFileDtoList=e.data,t.showFlag.tabSysFile=!0)}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}function a(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/sign/fingByOData",$("#searchform"),{filter:"issign eq (isNull,0)"}),schema:common.kendoGridConfig().schema({id:"signid",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=function(){var t=this.items(),e=this.pager.page()-1,o=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*o,i=$(this).find(".row-number");$(i).html(t)})},i=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.signid)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"projectname",title:"项目名称",width:160,filterable:!1},{field:"projectcode",title:"收文编号",width:120,filterable:!1},{field:"designcompanyName",title:"项目单位",width:150,filterable:!1},{field:"reviewstage",title:"项目阶段",width:80,filterable:!1},{field:"projectcode",title:"项目代码",width:120,filterable:!1},{field:"receivedate",title:"收文时间",width:160,filterable:!1,format:"{0:yyyy/MM/dd HH:mm:ss}"},{field:"",title:"流程状态",width:80,filterable:!1,template:function(t){return t.signState?1==t.signState?'<span style="color:green;">进行中</span>':2==t.signState?'<span style="color:orange;">已暂停</span>':8==t.signState?'<span style="color:red;">强制结束</span>':9==t.signState?'<span style="color:blue;">已完成</span>':5==t.signState?"未发起":"":"未发起"}},{field:"",title:"操作",width:180,template:function(t){var e=angular.isString(t.processInstanceId),o=!(!t.issign||9!=t.issign);return common.format($("#columnBtns").html(),t.signid,!1,t.signid+"/"+t.processInstanceId,"vm.del('"+t.signid+"')",e,"vm.startNewFlow('"+t.signid+"')",e,"vm.realSign('"+t.signid+"')",o)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:o,resizable:!0}}function r(t){t.gridOptions.dataSource.read()}function s(t){if(common.initJqValidation(),$("form").valid()){var n={method:"post",url:rootPath+"/sign",data:t.model},a=function(t){i.alert(t.data.reMsg),(t.data.flag||"ok"==t.data.reCode)&&o.go("fillSign",{signid:t.data.reObj.signid},{reload:!0})};common.http({vm:t,$http:e,httpOptions:n,success:a})}}function l(t,o){var i={};"main"==o?i.maindeptName=t.model.maindeptName:i.assistdeptName=t.model.assistdeptName;var n={method:"post",url:rootPath+"/officeUser/findOfficeUsersByDeptName",data:i},a=function(e){common.requestSuccess({vm:t,response:e,fn:function(){"main"==o?(t.mainOfficeList={},t.mainOfficeList=e.data):(t.assistOfficeList={},t.assistOfficeList=e.data)}})};common.http({vm:t,$http:e,httpOptions:n,success:a})}function c(t){if(common.initJqValidation($("#sign_fill_form")),$("#sign_fill_form").valid()){var o={method:"put",url:rootPath+"/sign",data:signObj},i=function(t){void 0!=callBack&&"function"==typeof callBack&&callBack(t.data)};common.http({$http:e,httpOptions:o,success:i})}}function d(t,o){t.isSubmit=!0;var i={method:"delete",url:rootPath+"/sign",params:{signid:o}},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read(),common.alert({vm:t,msg:"操作成功"})}})};common.http({vm:t,$http:e,httpOptions:i,success:n})}function m(o){var i={method:"get",url:rootPath+"/sign/html/initFillPageData",params:{signid:o.model.signid}},n=function(e){common.requestSuccess({vm:o,response:e,fn:function(){o.model=e.data.sign,o.deptlist=e.data.deptlist,e.data.mainOfficeList&&(o.mainOfficeList=e.data.mainOfficeList),e.data.assistOfficeList&&(o.assistOfficeList=e.data.assistOfficeList),o.builtcomlist=e.data.builtcomlist,o.designcomlist=e.data.designcomlist,o.model.signid&&t.initUploadOptions({businessId:o.model.signid,sysSignId:o.model.signid,sysfileType:"收文",uploadBt:"upload_file_bt",detailBt:"detail_file_bt",vm:o})}})};common.http({vm:o,$http:e,httpOptions:i,success:n})}function u(t){var o={method:"get",url:rootPath+"/sign/html/initDetailPageData",params:{signid:t.model.signid}},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.model=e.data}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}function p(t){var o={method:"get",url:rootPath+"/sign/initFlowPageData",params:{signid:t.model.signid,queryAll:!0}},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.model=e.data,t.model.isAssociate&&1==t.model.isAssociate&&(t.showFlag.tabAssociateSigns=!0,v(t,t.model.signid)),t.model.dispatchDocDto&&(t.showFlag.tabDispatch=!0,t.dispatchDoc=t.model.dispatchDocDto,2==t.dispatchDoc.dispatchWay&&0==t.dispatchDoc.isMainProject||t.dispatchDoc.fileNum?t.businessFlag.isCreateDisFileNum=!0:t.showFlag.buttDisFileNum=!0),t.model.fileRecordDto&&(t.showFlag.tabFilerecord=!0,t.fileRecord=t.model.fileRecordDto),(t.model.isreviewCompleted&&"9"==t.model.isreviewCompleted||t.model.isreviewACompleted&&"9"==t.model.isreviewACompleted)&&w(t),t.businessFlag.isLoadSign=!0,t.initBusinessParams&&"function"==typeof t.initBusinessParams&&t.initBusinessParams()}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}function f(t){var o={method:"delete",url:rootPath+"/workprogram/deleteBySignId",params:{signId:t.model.signid}},n=function(e){t.isSubmit=!1,e.data.flag||"ok"==e.data.reCode?(t.businessFlag.isFinishWP=!1,i.success("操作成功！")):i.error(e.data.reMsg)};common.http({vm:t,$http:e,httpOptions:o,success:n})}function h(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/sign/fingByOData",$("#searchform"),{filter:"signid ne '"+t.model.signid+"' and isAssociate eq 0 "}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=[{field:"projectname",title:"项目名称",width:160,filterable:!1},{field:"projectcode",title:"收文编号",width:140,filterable:!1},{field:"designcompanyName",title:"项目单位",width:200,filterable:!1},{field:"reviewstage",title:"项目阶段",width:160,filterable:!1},{field:"projectcode",title:"项目代码",width:140,filterable:!1},{field:"",title:"操作",width:60,template:function(t){return common.format($("#associateColumnBtns").html(),"vm.saveAssociateSign('"+t.signid+"')")}}];t.associateGridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,resizable:!0},t.associateGridOptions.dataSource.read()}function g(t,o,i,n){i="undefined"==i?null:i;var a={method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},url:rootPath+"/sign/associate",data:$.param({signId:o,associateId:i},!0)},r=function(t){void 0!=n&&"function"==typeof n&&n()};common.http({vm:t,$http:e,httpOptions:a,success:r})}function v(t,o){var i={method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded"},url:rootPath+"/sign/associate?signId="+o},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){if(void 0!=e.data){t.associateSign=e.data;for(var o=e.data,i="",n=o.length-1;n>=0;n--){var a=o[n],r=a.signdate||"";i+='<div class="intro-list"><div class="intro-list-left">项目阶段：'+a.reviewstage+"<br/>签收时间："+r+'</div><div class="intro-list-right"><span></span><div class="intro-list-content">名称：<span style="color:red;">'+a.projectname+'</span><br/>送件人：<span style="color:red;">'+a.sendusersign+"</span><br/></div></div></div>"}$("#introFlow").html(i);$("#myStep").step({animate:!0,initStep:1,speed:1e3})}}})};common.http({vm:t,$http:e,httpOptions:i,success:n})}function w(t){var o=t.model.signid,i=rootPath+"/expertReview/html/getBySignId/"+o,n={method:"post",url:i},a=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.businessFlag.expertReviews=e.data.value,void 0!=t.businessFlag.expertReviews&&t.businessFlag.expertReviews.length>0&&(t.showFlag.tabExpert=!0)}})};common.http({vm:t,$http:e,httpOptions:n,success:a})}function S(t){var o="";switch(t.flow.curNode.activitiId){case"XMFZR_SP_GZFA1":angular.isUndefined(t.mainwork)||angular.isUndefined(t.mainwork.id)||!t.mainwork.id||(o=t.mainwork.id);break;case"XMFZR_SP_GZFA2":angular.isUndefined(t.assistwork)||angular.isUndefined(t.assistwork.id)||!t.assistwork.id||(o=t.assistwork.id);break;case"XS_XMFZR_GZFA":angular.isUndefined(t.mainwork)||angular.isUndefined(t.mainwork.id)||!t.mainwork.id||(o=t.mainwork.id)}if(o){var i={method:"get",url:rootPath+"/workprogram/createMeetingDoc",params:{signId:t.model.signid,workprogramId:o}},a=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:e.data.reMsg,closeDialog:!0,fn:function(){"error"==e.data.reCode?t.isCommit=!1:n(t)}})}})};common.http({vm:t,$http:e,httpOptions:i,success:a})}else common.alert({vm:t,msg:"请先填写工作方案信息！"})}function b(t,o,i){var n={method:"post",url:rootPath+"/dispatch/createFileNum",params:{signId:t,dispatchId:o}},a=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:e,httpOptions:n,success:a})}function k(t,o){t.isCommit=!0;var i={method:"post",url:rootPath+"/sign/realSign",params:{signid:o}},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.isCommit=!1,common.alert({vm:t,msg:e.data.reMsg,closeDialog:!0,fn:function(){"error"==e.data.reCode||t.gridOptions.dataSource.read()}})}})};common.http({vm:t,$http:e,httpOptions:i,success:n,onError:function(){t.isCommit=!1}})}return{grid:a,querySign:r,createSign:s,initFillData:m,initDetailData:u,updateFillin:c,deleteSign:d,findOfficeUsersByDeptName:l,initFlowPageData:p,removeWP:f,associateGrid:h,saveAssociateSign:g,initAssociateSigns:v,paymentGrid:w,uploadFilelist:n,meetingDoc:S,createDispatchFileNum:b,realSign:k}}angular.module("app").factory("signSvc",t),t.$inject=["sysfileSvc","$http","$state","bsWin"]}(),function(){"use strict";function t(){return n}function e(t){var e="";switch(t){case n.PD:e=a.ZHANG_YF;break;case n.GD:e=a.LI_J}return e}function o(t){var e="";switch(t){case n.PD:e="请张主任阅示。";break;case n.GD:e="请李主任阅示。"}return e}function i(){return r}var n={PD:"PD",GD:"GD"},a={ZHANG_YF:"张一帆",LI_J:"李军"},r={godispatch:"godispatch",principaluser:"principaluser",seconduser:"seconduser"},s={getBusinessType:t,getDefaultLeader:e,getDefaultZHBYJ:o,getFlowParams:i};window.signcommon=s}(),function(){"use strict";function t(t,e){var o=this;o.model={},o.title="系统配置",function(){e.queryList(o)}(),o.addConfig=function(){o.model={},$("#configdiv").kendoWindow({width:"700px",height:"440px",title:"参数编辑",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},o.closeWin=function(){window.parent.$("#configdiv").data("kendoWindow").close()},o.doCommit=function(){common.initJqValidation(),$("#configForm").valid()&&e.saveConfig(o)},o.editConfig=function(t){o.configList.forEach(function(e,i){e.id==t&&(o.model=e)}),$("#configdiv").kendoWindow({width:"700px",height:"440px",title:"参数编辑",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},o.del=function(t){var i=$("input[name='configid']:checked");i.length<1?common.alert({vm:o,msg:"请选择删除的参数"}):common.confirm({vm:o,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide");for(var t=[],n=0;n<i.length;n++)t.push(i[n].value);e.deleteConfig(o,t.join(","))}})}}angular.module("app").controller("sysConfigCtrl",t),t.$inject=["$location","sysConfigSvc"]}(),function(){"use strict";function t(t){function e(e){var o={method:"get",url:rootPath+"/sysConfig/queryList"},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.configList=new Array,e.configList=t.data}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}function o(o,i){var n={method:"delete",url:rootPath+"/sysConfig",params:{id:i}},a=function(t){common.requestSuccess({vm:o,response:t,fn:function(){common.alert({vm:o,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),o.isSubmit=!1,e(o)}})}})};common.http({vm:o,$http:t,httpOptions:n,success:a})}function i(o){var i={method:"post",url:rootPath+"/sysConfig",data:o.model},n=function(t){common.requestSuccess({vm:o,response:t,fn:function(){common.alert({vm:o,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),o.isSubmit=!1,e(o)}})}})};common.http({vm:o,$http:t,httpOptions:i,success:n})}return{queryList:e,deleteConfig:o,saveConfig:i}}angular.module("app").factory("sysConfigSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e){var o=this;o.title="系统安装包列表",function(){e.queryPluginfile(o)}()}angular.module("app").controller("pluginfileCtrl",t),t.$inject=["$location","sysfileSvc"]}(),function(){"use strict";function t(t){function e(t,e){window.open(rootPath+"/file/fileDownload?sysfileId="+e)}function o(e,o){var i={method:"delete",url:rootPath+"/file/deleteSysFile",params:{id:o}},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){window.parent.$("#commonQueryWindow").data("kendoWindow").close(),common.alert({vm:e,msg:"删除成功",closeDialog:!0})}})};common.http({vm:e,$http:t,httpOptions:i,success:n})}function i(e){var o={width:"800px",height:"600px",sysMinType:"",sysfileType:"",sysSignId:"",uploadBt:"upload_file_bt",detailBt:"detail_file_bt",vm:e.vm};if(e.businessId&&(o.businessId=e.businessId),e.width&&(o.width=e.width),e.height&&(o.height=e.height),e.sysSignId&&(o.sysSignId=e.sysSignId),e.sysfileType&&(o.sysfileType=e.sysfileType),e.sysMinType&&(o.sysMinType=e.sysMinType),o.vm.downloadSysFile=function(t){window.open(rootPath+"/file/fileDownload?sysfileId="+t)},o.vm.delSysFile=function(e){var i={method:"delete",url:rootPath+"/file/deleteSysFile",params:{id:e}},n=function(t){common.requestSuccess({vm:o.vm,response:t,fn:function(){window.parent.$("#commonQueryWindow").data("kendoWindow").close(),common.alert({vm:o.vm,msg:"删除成功",closeDialog:!0})}})};common.http({vm:o.vm,$http:t,httpOptions:i,success:n})},e.uploadBt&&(o.uploadBt=e.uploadBt,$("#"+o.uploadBt).click(function(){angular.isUndefined(e.businessId)?common.alert({vm:o.vm,msg:"请先保存业务数据！",closeDialog:!0}):$("#commonuploadWindow").kendoWindow({width:o.width,height:o.height,title:"附件上传",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()})),e.detailBt&&(o.detailBt=e.detailBt,$("#"+o.detailBt).click(function(){if(angular.isUndefined(e.businessId))common.alert({vm:o.vm,msg:"请先保存业务数据！",closeDialog:!0});else{var i={method:"get",url:rootPath+"/file/findByBusinessId",params:{businessId:o.businessId}},n=function(t){o.vm.sysFilelists=t.data,$("#commonQueryWindow").kendoWindow({width:"800px",height:"400px",title:"附件上传列表",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()};common.http({vm:o.vm,$http:t,httpOptions:i,success:n})}})),o.businessId){var i={language:"zh",allowedPreviewTypes:["image"],allowedFileExtensions:["jpg","png","gif","xlsx","docx","doc","xls","pdf","ppt","zip","rar"],maxFileSize:2e3,showRemove:!1,uploadUrl:rootPath+"/file/fileUpload",uploadExtraData:{businessId:o.businessId,sysSignId:o.sysSignId,sysfileType:o.sysfileType,sysMinType:o.sysMinType}};$("#sysfileinput").fileinput(i).on("filebatchselected",function(t,e){}).on("fileuploaded",function(t,e){})}}function n(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/file/getPluginFile"),schema:common.kendoGridConfig().schema(),serverPaging:!1,serverSorting:!0,serverFiltering:!0,sort:{field:"createdDate",dir:"desc"}}),o=[{field:"fileName",title:"名称",filterable:!1},{field:"fileLength",title:"大小",width:160,filterable:!1},{field:"",title:"操作",width:150,template:function(t){return common.format($("#columnBtns").html(),rootPath+"/"+t.relativePath)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,resizable:!0}}return{initUploadOptions:i,commonDelSysFile:o,commonDownloadFile:e,queryPluginfile:n}}angular.module("app").factory("sysfileSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e){var o=this;o.title="用户列表",o.del=function(t){common.confirm({vm:o,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),e.deleteUser(o,t)}})},o.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)common.alert({vm:o,msg:"请选择数据"});else{for(var e=[],i=0;i<t.length;i++)e.push(t[i].value);var n=e.join(",");o.del(n)}},o.queryUser=function(){e.queryUser(o)},function(){e.grid(o)}()}angular.module("app").controller("userCtrl",t),t.$inject=["$location","userSvc"]}(),function(){"use strict";function t(t,e,o){var i=this;i.title="新增用户",i.isuserExist=!1,i.id=o.params.id,i.id&&(i.isUpdate=!0,i.title="编辑用户"),i.create=function(){e.createUser(i)},i.update=function(){e.updateUser(i)},function(){i.isUpdate?e.getUserById(i):(e.initZtreeClient(i),e.initUserNo(i)),e.getOrg(i)}()}angular.module("app").controller("userEditCtrl",t),t.$inject=["$location","userSvc","$state"]}(),function(){"use strict";function t(t){function e(e){var o={method:"get",url:u+"/createUserNo"},i=function(t){e.model={};var o=t.data;e.model.userNo=o.substring(1,o.length-1)};common.http({vm:e,$http:t,httpOptions:o,success:i})}function o(e){if(common.initJqValidation(),$("form").valid()){e.isSubmit=!0,e.model.id=e.id;var o=d(),i=$linq(o).where(function(t){return 0==t.isParent}).select(function(t){return{id:t.id,roleName:t.name}}).toArray();e.model.roleDtoList=i;var n={method:"put",url:u,data:e.model},a=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:e,$http:t,httpOptions:n,success:a})}}function i(e,o){e.isSubmit=!0;var i={method:"delete",url:u,data:o},n=function(t){common.requestSuccess({vm:e,response:t,fn:function(){e.isSubmit=!1,e.gridOptions.dataSource.read()}})};common.http({vm:e,$http:t,httpOptions:i,success:n})}function n(e){if(common.initJqValidation(),$("form").valid()){e.isSubmit=!0;var o=d(),i=$linq(o).where(function(t){return 0==t.isParent}).select(function(t){return{id:t.id,roleName:t.name}}).toArray();e.model.roleDtoList=i;var n={method:"post",url:u,data:e.model},a=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=p}})}})};common.http({vm:e,$http:t,httpOptions:n,success:a})}}function a(e){var o={method:"get",url:rootPath+"/org/listAll"},i=function(t){e.org={},e.org=t.data};common.http({vm:e,$http:t,httpOptions:o,success:i})}function r(e){var o={method:"post",url:f=rootPath+"/role/findAllRoles"},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){var o={check:{chkboxType:{Y:"ps",N:"ps"},enable:!0}},i=$linq(t.data).select(function(t){return{id:t.id,name:t.roleName}}).toArray(),n={id:"",name:"角色集合",children:i};$.fn.zTree.init($("#zTree"),o,n),e.isUpdate&&m(e)}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}function s(e){var o={method:"post",url:rootPath+"/user/findUserById",params:{userId:e.id}},i=function(t){e.model=t.data,e.isUpdate&&r(e)};common.http({vm:e,$http:t,httpOptions:o,success:i})}function l(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(u+"/fingByOData?$orderby=userSort",$("#usersform")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"},modifiedDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),o=function(){var t=this.items(),e=this.pager.page()-1,o=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*o,i=$(this).find(".row-number");$(i).html(t)})},i=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"loginName",title:"登录名",width:100,filterable:!1},{field:"displayName",title:"显示名",width:100,filterable:!1},{field:"orgDto.name",title:"所属部门",width:100,filterable:!1},{field:"userIP",title:"登录IP",width:160,filterable:!1},{field:"lastLogin",title:"最后登录时间",width:160,filterable:!1},{field:"",title:"所属角色",width:160,filterable:!1,template:function(t){if(t.roleDtoList){for(var e="",o=0,i=t.roleDtoList.length;o<i;o++)e+=0==o?t.roleDtoList[o].roleName:", "+t.roleDtoList[o].roleName;return e}return" "}},{field:"",title:"操作",width:140,template:function(t){return common.format($("#columnBtns").html(),"vm.del('"+t.id+"')",t.id)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:o,resizable:!0}}function c(t){t.gridOptions.dataSource.read()}function d(){return $.fn.zTree.getZTreeObj("zTree").getCheckedNodes(!0)}function m(t){for(var e=$.fn.zTree.getZTreeObj("zTree"),o=$linq(t.model.roleDtoList).select(function(t){return t.roleName}).toArray(),i=e.getNodesByParam("level",1,null),n=$linq(i).where(function(t){return $linq(o).contains(t.name)}).toArray(),a=0,r=n.length;a<r;a++)e.checkNode(n[a],!0,!0)}var u=rootPath+"/user",p="#/user",f=rootPath+"/role/fingByOData";rootPath;return{grid:l,getUserById:s,initZtreeClient:r,createUser:n,deleteUser:i,updateUser:o,getOrg:a,queryUser:c,initUserNo:e}}angular.module("app").factory("userSvc",t),t.$inject=["$http"]}(),function(){"use strict";function t(t,e){var o=this;o.title="工作日列表",function(){e.grid(o)}(),o.del=function(t){common.confirm({vm:o,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),e.deleteWorkday(o,t)}})},o.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)common.alert({vm:o,msg:"请选择数据"});else{for(var e=[],i=0;i<t.length;i++)e.push(t[i].value);var n=e.join(",");o.del(n)}},o.queryWorkday=function(){e.queryWorkday(o)},o.ResetWorkday=function(){e.clearValue(o)}}angular.module("app").controller("workdayCtrl",t),t.$inject=["$location","workdaySvc"]}(),function(){"use strict";function t(t,e){function o(t){var e=$("#workdayForm").find("input,select");$.each(e,function(t,e){e.value=""}),t.gridOptions.dataSource.read()}function i(e){var o={method:"get",url:c+"/getWorkdayById",params:{id:e.id}},i=function(t){e.workday=t.data};common.http({vm:e,$http:t,httpOptions:o,success:i})}function n(t){t.gridOptions.dataSource.read()}function a(e){var o={method:"post",url:c+"/createWorkday",data:e.workday},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=d}})}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}function r(e){var o={method:"put",url:c,data:e.workday},i=function(t){common.requestSuccess({vm:e,response:t,fn:function(){common.alert({vm:e,msg:"操作成功",fn:function(){e.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=d}})}})};common.http({vm:e,$http:t,httpOptions:o,success:i})}function s(e,o){var i={method:"delete",url:c,data:o},n=function(t){e.gridOptions.dataSource.read()};common.http({vm:e,$http:t,httpOptions:i,success:n})}function l(t){var e=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(c+"/findByOdataObj",$("#workdayForm")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"},modifiedDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"dates",dir:"desc"}}),o=function(){var t=this.items(),e=this.pager.page()-1,o=this.pager.pageSize();$(t).each(function(){var t=$(this).index()+1+e*o,i=$(this).find(".row-number");$(i).html(t)})},i=[{template:function(t){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",t.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"dates",title:"时间",width:200,format:"{0:yyyy-MM-dd}",filterable:!1},{field:"",title:"状态",width:100,filterable:!1,template:function(t){return t.status?"1"==t.status?"调休":"2"==t.status?"加班":void 0:""}},{field:"remark",title:"备注",width:140,filterable:!1},{field:"",title:"操作",width:140,template:function(t){return common.format($("#columnBtns").html(),"vm.del('"+t.id+"')",t.id)}}];t.gridOptions={dataSource:common.gridDataSource(e),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,columns:i,dataBound:o,resizable:!0}}var c=rootPath+"/workday",d="#/workday";return{grid:l,createWorkday:a,getWorkdayById:i,updateWorkday:r,deleteWorkday:s,queryWorkday:n,clearValue:o}}angular.module("app").factory("workdaySvc",t),t.$inject=["$http","$state"]}(),function(){"use strict";function t(t,e,o){var i=this;i.title="添加工作日",i.id=o.params.id,i.workday={},i.workday.status="1",i.id&&(i.isUpdate=!0,i.title="更新工作日"),function(){i.isUpdate&&e.getWorkdayById(i)}(),i.create=function(){e.createWorkday(i)},i.update=function(){e.updateWorkday(i)}}angular.module("app").controller("workdayEditCtrl",t),t.$inject=["$location","workdaySvc","$state"]}(),function(){"use strict";function t(t,e,o,i){var n=this;n.work={},n.title="项目基本信息",n.work.signId=o.params.signid,function(){e.initPage(n)}(),n.create=function(){e.createWP(n,!1)}}angular.module("app").controller("workprogramBaseEditCtrl",t),t.$inject=["$location","workprogramSvc","$state","$http"]}(),function(){"use strict";function t(t,e,o){var i=this;i.work={},i.model={},i.title="评审方案编辑",i.startDateTime=new Date("2006/6/1 08:00"),i.endDateTime=new Date("2030/6/1 21:00"),i.work.signId=e.params.signid,i.sign={},i.unSeledWork={},i.serchSign={},i.businessFlag={isSelfReview:!1,isSingleReview:!0,isMainWorkProj:!1,isLoadMeetRoom:!1},function(){t.initPage(i),$("#wpTab li").click(function(t){var e=$("a",this);t.preventDefault(),e.tab("show");var o=e.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+o).addClass("active").addClass("in").show(500)})}(),i.reviewTypeChange=function(){"自评"==i.work.reviewType?"合并评审"==i.work.isSigle&&(i.work.isSigle="单个评审",common.alert({vm:i,msg:"自评方案不能进行合并评审！",colseDialog:!0})):i.businessFlag.isMainWorkProj&&!i.businessFlag.isSingleReview&&"单个评审"==i.work.isSigle&&common.confirm({vm:i,title:"",msg:"该项目已经关联其他合并评审会关联，您确定要改为单个评审吗？",fn:function(){$(".confirmDialog").modal("hide"),i.work.isMainProject="0",t.deleteAllMerge(i)},cancel:function(){i.work.isSigle="合并评审",$(".confirmDialog").modal("hide")}})},i.onWorkClose=function(){window.parent.$(".workPro").data("kendoWindow").close()},i.filterSign=function(t){var e=!0
;if(i.serchSign.projectname&&-1==t.projectname.indexOf(i.serchSign.projectname)&&(e=!1),i.serchSign.reviewstage&&-1==t.reviewstage.indexOf(i.serchSign.reviewstage)&&(e=!1),e)return t},i.initMergeWP=function(){i.work.id&&0!=i.businessFlag.isMainWorkProj?(t.initMergeInfo(i,i.work.signId),$("#mergeSignWP").kendoWindow({width:"1200px",height:"600px",title:"合并评审",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()):o.alert("请先保存工作方案！")},i.chooseSign=function(){var e=$("input[name='mergeSign']:checked");if(0==e.length)o.alert("请选择要合并评审的项目！");else{var n=[];$.each(e,function(t,e){n.push(e.value)}),t.chooseSign(i.work.signId,n.join(","),function(e){(e.flag||"ok"==e.reCode)&&t.initMergeInfo(i,i.work.signId),o.alert(e.reMsg)})}},i.cancelSign=function(){var e=$("input[name='cancelMergeSignid']:checked");if(0==e.length)o.alert("请选择要取消合并评审的项目！");else{var n=[];$.each(e,function(t,e){n.push(e.value)})}t.cancelMergeSign(i.work.signId,n.join(","),function(e){(e.flag||"ok"==e.reCode)&&t.initMergeInfo(i,i.work.signId),o.alert(e.reMsg)})},i.addTimeStage=function(){i.work.id?e.go("room",{workProgramId:i.work.id}):o.alert("请先保存！")},i.saveRoom=function(){t.saveRoom(i.roombook,i.work,function(t){t.flag||"ok"==t.reCode?(window.parent.$("#stageWindow").data("kendoWindow").close(),o.success("操作成功！"),$.each(i.work.roomBookingDtos,function(e,o){i.roombook.id==o.id&&(o=t.reObj)})):o.error(t.reMsg)})},i.onRoomClose=function(){window.parent.$("#stageWindow").data("kendoWindow").close()},i.deleteBookRoom=function(e){o.confirm({title:"询问提示",message:"是否进行该操作！",onOk:function(){t.deleteBookRoom(e,function(){o.success("操作成功！"),$.each(i.work.roomBookingDtos,function(t,o){e==o.id&&i.work.roomBookingDtos.splice(t,1)})})}})},i.updateBookRoom=function(e){0==i.businessFlag.isLoadMeetRoom?(i.roombookingList={},t.findAllMeeting(function(t){i.roombookingList=t,i.businessFlag.isLoadMeetRoom=!0,$.each(i.work.roomBookingDtos,function(t,o){e==o.id&&(i.roombook=o)}),$("#stageWindow").kendoWindow({width:"660px",height:"550px",title:"会议预定信息",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()})):($.each(i.work.roomBookingDtos,function(t,o){e==o.id&&(i.roombook=o)}),$("#stageWindow").kendoWindow({width:"660px",height:"550px",title:"会议预定信息",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open())},i.findUsersByOrgId=function(e){t.findUsersByOrgId(i,e)},i.create=function(){t.createWP(i)},i.selectExpert=function(){t.selectExpert(i)},i.findReviewDept=function(){}}angular.module("app").controller("workprogramEditCtrl",t),t.$inject=["workprogramSvc","$state","bsWin"]}(),function(){"use strict";function t(t,e,o,i){function n(t){t.conditions=new Array,t.customCondition=new Array,t.expertReview={},t.selfExperts=[],t.selectExperts=[],t.selectIds=[],t.autoExperts=[],t.autoSelExperts=[],t.outsideExperts=[]}function a(t){t.iscommit=!0,n(t);var o={method:"get",url:rootPath+"/expertReview/html/initByWorkProgramId",params:{workProgramId:t.work.id}},i=function(e){t.iscommit=!1,t.expertReview=e.data,t.expertReview.expertSelConditionDtoList&&t.expertReview.expertSelConditionDtoList.length>0&&(t.conditions=t.expertReview.expertSelConditionDtoList,t.conditionIndex=t.expertReview.expertSelConditionDtoList.length),t.expertReview.expertSelectedDtoList&&t.expertReview.expertSelectedDtoList.length>0&&(t.expertReview.expertSelectedDtoList.forEach(function(e,o){t.selectIds.push(e.expertDto.expertID),t.selectExperts.push(e),"1"==e.selectType?(t.autoExperts.push(e),t.autoSelExperts.push(e.expertDto)):"2"==e.selectType?t.selfExperts.push(e):"3"==e.selectType&&t.outsideExperts.push(e)}),t.selectIds.length>0?t.excludeIds=t.selectIds.join(","):t.excludeIds="")};common.http({vm:t,$http:e,httpOptions:o,success:i})}function r(t,o){var i={method:"post",url:rootPath+"/sign/getMergeSignBySignId",params:{signId:t}},n=function(t){void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:e,httpOptions:i,success:n})}function s(t,o){var i={method:"post",url:rootPath+"/sign/unMergeWPSign",params:{signId:t}},n=function(t){void 0!=o&&"function"==typeof o&&o(t.data)};common.http({$http:e,httpOptions:i,success:n})}function l(t,e){s(e,function(e){t.unMergeSign=[],t.unMergeSign=e}),r(e,function(e){t.mergeSign=[],t.mergeSign=e})}function c(t,o,i){var n={method:"post",url:rootPath+"/sign/cancelMergeSign",params:{signId:t,cancelIds:o,mergeType:"1"}},a=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:e,httpOptions:n,success:a})}function d(t,o,i){var n={method:"post",url:rootPath+"/sign/mergeSign",params:{signId:t,mergeIds:o,mergeType:"1"}},a=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:e,httpOptions:n,success:a})}function m(t,o,i){if(common.initJqValidation($("#stageForm")),$("#stageForm").valid()){if(new Date(t.endTime)<new Date(t.beginTime))return void bsWin.error("开始时间不能大于结束时间!");t.workProgramId=o.id,t.stageOrgName=o.reviewOrgName,t.stageProject="项目名称:"+o.projectName+":"+o.buildCompany+":"+o.reviewOrgName,t.beginTimeStr=$("#beginTime").val(),t.endTimeStr=$("#endTime").val(),t.beginTime=$("#rbDay").val()+" "+$("#beginTime").val()+":00",t.endTime=$("#rbDay").val()+" "+$("#endTime").val()+":00";var n={method:"post",url:rootPath+"/room/saveRoom",data:t},a=function(t){void 0!=i&&"function"==typeof i&&i(t.data)};common.http({$http:e,httpOptions:n,success:a})}}function u(t){var o={method:"get",url:rootPath+"/room/meeting"},i=function(e){void 0!=t&&"function"==typeof t&&t(e.data)};common.http({$http:e,httpOptions:o,success:i})}function p(t){var o={method:"get",url:common.format(b+"/findCcompanys")},i=function(e){t.companys={},t.companys=e.data};common.http({vm:t,$http:e,httpOptions:o,success:i})}function f(t,o){var i={};"main"==o&&(i.orgId=t.work.reviewDept);var n={method:"get",url:rootPath+"/user/findUsersByOrgId",params:i},a=function(e){common.requestSuccess({vm:t,response:e,fn:function(){"main"==o&&(t.mainUserList={},t.mainUserList=e.data)}})};common.http({vm:t,$http:e,httpOptions:n,success:a})}function h(n){var a={method:"post",url:rootPath+"/workprogram/html/initWorkProgram",params:{signId:n.work.signId}},r=function(e){if(null!=e.data&&""!=e.data&&(n.work=e.data.eidtWP,n.model.workProgramDtoList={},e.data.WPList&&e.data.WPList.length>0&&(n.model.workProgramDtoList=e.data.WPList),"1"==n.work.branchId&&p(n),n.work.signId=o.params.signid,n.work.projectType&&(n.work.projectTypeDicts=i.topSelectChange(n.work.projectType,i.DICT.PROJECTTYPE.dicts)),"自评"==n.work.reviewType&&(n.businessFlag.isSelfReview=!0),"合并评审"==n.work.isSigle&&(n.businessFlag.isSingleReview=!1),"9"==n.work.isMainProject&&(n.businessFlag.isMainWorkProj=!0),n.work.id)){t.initUploadOptions({businessId:n.work.id,sysSignId:n.work.signId,sysfileType:"工作方案",uploadBt:"upload_file_bt",detailBt:"detail_file_bt",vm:n})}};common.http({vm:n,$http:e,httpOptions:a,success:r})}function g(t,o){if(common.initJqValidation($("#work_program_form")),$("#work_program_form").valid()){t.iscommit=!0;var i={method:"post",url:rootPath+"/workprogram/addWork",data:t.work,params:{isNeedWorkProgram:o}},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.iscommit=!1,common.alert({vm:t,msg:e.data.reMsg,closeDialog:!0,fn:function(){"ok"==e.data.reCode&&(t.work.id=e.data.reObj.id,"自评"==e.data.reObj.reviewType&&(t.businessFlag.isSelfReview=!0),"合并评审"==e.data.reObj.isSigle&&(t.businessFlag.isSingleReview=!1),"9"==e.data.reObj.isMainProject&&(t.businessFlag.isMainWorkProj=!0))}})}})};common.http({vm:t,$http:e,httpOptions:i,success:n,onError:function(e){t.iscommit=!1}})}}function v(t){t.work.id&&""!=t.work.id?o.go("expertReviewEdit",{workProgramId:t.work.id}):common.alert({vm:t,msg:"请先保存，再继续执行操作！"})}function w(t){var o={method:"post",url:rootPath+"/workprogram/deleteMergeWork",params:{mainBusinessId:t.work.id}},i=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功！",closeDialog:!0})}})};common.http({vm:t,$http:e,httpOptions:o,success:i})}function S(t,o){var i={method:"delete",url:rootPath+"/room",params:{id:t}},n=function(t){void 0!=o&&"function"==typeof o&&o()};common.http({$http:e,httpOptions:i,success:n})}var b=rootPath+"/company";return{initPage:h,createWP:g,findCompanys:p,findUsersByOrgId:f,selectExpert:v,saveRoom:m,deleteBookRoom:S,findAllMeeting:u,initMergeInfo:l,getMergeSignBySignId:r,unMergeWPSign:s,chooseSign:d,cancelMergeSign:c,deleteAllMerge:w,initReview:a,initParamValue:n}}angular.module("app").factory("workprogramSvc",t),t.$inject=["sysfileSvc","$http","$state","$rootScope"]}();