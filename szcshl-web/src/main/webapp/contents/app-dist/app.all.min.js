!function(){"use strict";angular.module("app",["ui.router","kendo.directives","angular-loading-bar","ngAnimate","ngFileSaver"]).filter("trust2Html",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]).filter("myFilter",function(){return function(e,t,i){var o=[],n=[];return i instanceof Array?n=i:n.push(i),angular.forEach(e,function(e){angular.forEach(n,function(i){e[t]==i&&o.push(e)})}),o}}).filter("unique",function(){return function(e,t){var i=[],o=[];return angular.forEach(e,function(e){var n=e[t];-1===o.indexOf(n)&&(o.push(n),i.push(e))}),i}}).config(["$stateProvider","$locationProvider","$urlRouterProvider","cfpLoadingBarProvider",function(e,t,i,o){t.hashPrefix(""),o.parentSelector="#loading-bar-container",o.spinnerTemplate='<div style="position:fixed;width:100%;height:100%;left:0;top:0; z-index:10001;background:rgba(0, 0, 0, 0.3);overflow: hidden;"><div style="position: absolute;top:30%; width: 400px;height:40px;left:50%;"><i class="fa fa-spinner fa-pulse fa-1x fa-fw"></i>数据加载中...</div></div>',i.otherwise("/welcome"),e.state("welcome",{url:"/welcome",templateUrl:rootPath+"/admin/welcome.html",controller:"adminWelComeCtrl",controllerAs:"vm"}).state("gtasks",{url:"/gtasks",templateUrl:rootPath+"/admin/gtasks.html",controller:"adminCtrl",controllerAs:"vm"}).state("agendaTasks",{url:"/agendaTasks",templateUrl:rootPath+"/admin/agendaTasks.html",controller:"adminAgendaCtrl",controllerAs:"vm"}).state("doingTasks",{url:"/doingTasks",templateUrl:rootPath+"/admin/doingTasks.html",controller:"adminDoTaskCtrl",controllerAs:"vm"}).state("flowDeal",{url:"/flowDeal/:businessKey/:processKey/:taskId/:instanceId",templateUrl:function(e){return rootPath+"/flow/flowDeal/"+e.processKey+".html"},controller:"flowDealCtrl",controllerAs:"vm"}).state("flowDetail",{url:"/flowDetail/:businessKey/:processKey/:taskId/:instanceId",templateUrl:function(e){return rootPath+"/flow/flowDetail/"+e.processKey+".html"},controller:"flowDetailCtrl",controllerAs:"vm"}).state("flowEnd",{url:"/flowEnd/:businessKey/:processKey/:instanceId",templateUrl:function(e){return rootPath+"/flow/flowEnd/"+e.processKey+".html"},controller:"flowEndCtrl",controllerAs:"vm"}).state("addSupp",{url:"/addSupp/:businessId/:businessType/:isControl",templateUrl:rootPath+"/addSuppLetter/edit.html",controller:"addSuppLetterCtrl",controllerAs:"vm"}).state("addSuppletterList",{url:"/addSuppletterList/:businessId",templateUrl:rootPath+"/addSuppLetter/list.html",controller:"addSuppLetterListCtrl",controllerAs:"vm"}).state("addSuppLetterEdit",{url:"/addSuppLetterEdit/:id",templateUrl:rootPath+"/addSuppLetter/editUpload.html",controller:"addSuppLetterEditCtrl",controllerAs:"vm"}).state("suppLetterView",{url:"/suppLetterView/:id",templateUrl:rootPath+"/addSuppLetter/view.html",controller:"suppLetterViewCtrl",controllerAs:"vm"}).state("suppletterList",{url:"/suppletterList",templateUrl:rootPath+"/addSuppLetter/html/suppLetterList.html",controller:"addSuppLetterQueryCtrl",controllerAs:"vm"}).state("querySuppLetterDetail",{url:"/querySuppLetterDetail/:id",templateUrl:rootPath+"/addSuppLetter/detail.html",controller:"addSuppLetterQueryEditCtrl",controllerAs:"vm"}).state("suppLetterApproveEdit",{url:"/suppLetterApproveEdit/:id",templateUrl:rootPath+"/addSuppLetter/suppLetterApproveEdit.html",controller:"addSuppLetterQueryEditCtrl",controllerAs:"vm"}).state("registerFile",{url:"/registerFile/:businessId",templateUrl:rootPath+"/addRegisterFile/list.html",controller:"addRegisterFileCtrl",controllerAs:"vm"}).state("dtasks",{url:"/dtasks",templateUrl:rootPath+"/admin/dtasks.html",controller:"adminDoingCtrl",controllerAs:"vm"}).state("personDtasks",{url:"/personDtasks",templateUrl:rootPath+"/sign/personDtasks.html",controller:"adminPersonDoingCtrl",controllerAs:"vm"}).state("etasks",{url:"/etasks",templateUrl:rootPath+"/sign/etasks.html",controller:"adminEndCtrl",controllerAs:"vm"}).state("role",{url:"/role",templateUrl:rootPath+"/role/html/list.html",controller:"roleCtrl",controllerAs:"vm"}).state("roleEdit",{url:"/roleEdit/:id",templateUrl:rootPath+"/role/html/edit.html",controller:"roleEditCtrl",controllerAs:"vm"}).state("user",{url:"/user",templateUrl:rootPath+"/user/html/list.html",controller:"userCtrl",controllerAs:"vm"}).state("userEdit",{url:"/userEdit/:id",templateUrl:rootPath+"/user/html/edit.html",controller:"userEditCtrl",controllerAs:"vm"}).state("org",{url:"/org",templateUrl:rootPath+"/org/html/list.html",controller:"orgCtrl",controllerAs:"vm"}).state("orgEdit",{url:"/orgEdit/:id",templateUrl:rootPath+"/org/html/edit.html",controller:"orgEditCtrl",controllerAs:"vm"}).state("orgUser",{url:"/orgUser/:id",templateUrl:rootPath+"/org/html/orgUser.html",controller:"orgUserCtrl",controllerAs:"vm"}).state("sysdept",{url:"/sysdept",templateUrl:rootPath+"/sysdept/html/list.html",controller:"sysdeptCtrl",controllerAs:"vm"}).state("sysdeptEdit",{url:"/sysdeptEdit/:id",templateUrl:rootPath+"/sysdept/html/edit.html",controller:"sysdeptEditCtrl",controllerAs:"vm"}).state("sysdeptUser",{url:"/sysdeptUser/:id",templateUrl:rootPath+"/sysdept/html/sysdeptUser.html",controller:"sysdeptUserCtrl",controllerAs:"vm"}).state("log",{url:"/log",templateUrl:rootPath+"/log/html/list.html",controller:"logCtrl",controllerAs:"vm"}).state("config",{url:"/config",templateUrl:rootPath+"/sysConfig/html/list.html",controller:"sysConfigCtrl",controllerAs:"vm"}).state("upload",{url:"/upload/:uploadid",templateUrl:rootPath+"/upload/html/edit.html",controller:"uploadEditCtrl",controllerAs:"vm"}).state("meeting",{url:"/meeting",templateUrl:rootPath+"/meeting/html/list.html",controller:"meetingCtrl",controllerAs:"vm"}).state("meetingEdit",{url:"/meetingEdit/:id",templateUrl:rootPath+"/meeting/html/edit.html",controller:"meetingEditCtrl",controllerAs:"vm"}).state("room",{url:"/room",params:{businessId:"",businessType:""},templateUrl:rootPath+"/room/html/roomlist.html",controller:"roomCtrl",controllerAs:"vm"}).state("roomCount",{url:"/roomCount",params:{id:""},templateUrl:rootPath+"/room/html/countlist.html",controller:"roomCountCtrl",controllerAs:"vm"}).state("company",{url:"/company",templateUrl:rootPath+"/company/html/list.html",controller:"companyCtrl",controllerAs:"vm"}).state("companyEdit",{url:"/companyEdit/:id",templateUrl:rootPath+"/company/html/edit.html",controller:"companyEditCtrl",controllerAs:"vm"}).state("accountPwd",{url:"/accountPwd",templateUrl:rootPath+"/account/html/changePwd.html",controller:"homeCtrl",controllerAs:"vm"}).state("demo",{url:"/demo",templateUrl:rootPath+"/demo/html/list.html",controller:"demoCtrl",controllerAs:"vm"}).state("dict",{url:"/dict",templateUrl:rootPath+"/dict/html/list.html",controller:"dictCtrl",controllerAs:"vm"}).state("dict.edit",{url:"/edit/:id",templateUrl:rootPath+"/dict/html/edit.html",controller:"dictEditCtrl",controllerAs:"vm"}).state("expert",{url:"/expert",templateUrl:rootPath+"/expert/html/queryAllList.html",controller:"expertCtrl",controllerAs:"vm"}).state("expertAudit",{url:"/expertAudit",templateUrl:rootPath+"/expert/html/audit.html",controller:"expertAuditCtrl",controllerAs:"vm"}).state("expertRepeat",{url:"/expertRepeat",templateUrl:rootPath+"/expert/html/repeat.html",controller:"expertRepeatCtrl",controllerAs:"vm"}).state("expertEdit",{url:"/expertEdit/:id",templateUrl:rootPath+"/expert/html/edit.html",controller:"expertEditCtrl",controllerAs:"vm"}).state("expertReviewEdit",{url:"/expertReview/:businessId/:minBusinessId/:businessType/:reviewType",templateUrl:rootPath+"/expertReview/html/selectExpert.html",controller:"expertSelectCtrl",controllerAs:"vm"}).state("expertScore",{url:"/expertScore",templateUrl:rootPath+"/expert/html/scoreList.html",controller:"expertScoreCtrl",controllerAs:"vm"}).state("expertSelectHis",{url:"/expertSelectHis",templateUrl:rootPath+"/expert/html/selectHisList.html",controller:"expertSelectHisCtrl",controllerAs:"vm"}).state("addSign",{url:"/addSign",templateUrl:rootPath+"/sign/html/add.html",controller:"signCreateCtrl",controllerAs:"vm"}).state("fillSign",{url:"/fillSign/:signid/:isControl",cache:"false",templateUrl:rootPath+"/sign/html/fillin.html",controller:"signFillinCtrl",controllerAs:"vm"}).state("listSign",{url:"/listSign",templateUrl:rootPath+"/sign/html/list.html",controller:"signCtrl",controllerAs:"vm"}).state("signFlowDeal",{url:"/signFlowDeal/:signid/:taskId/:processInstanceId",templateUrl:rootPath+"/sign/html/flowDeal.html",controller:"signFlowDealCtrl",controllerAs:"vm"}).state("signFlowDetail",{url:"/signFlowDetail/:signid/:taskId/:processInstanceId",templateUrl:rootPath+"/sign/html/signFlowDetail.html",controller:"signFlowDetailCtrl",controllerAs:"vm"}).state("signDetails",{url:"/signDetails/:signid/:processInstanceId",templateUrl:rootPath+"/sign/html/signDetails.html",controller:"signDetailsCtrl",controllerAs:"vm"}).state("endSignDetail",{url:"/endSignDetail/:signid/:processInstanceId",templateUrl:rootPath+"/sign/html/signEndDetails.html",controller:"signEndCtrl",controllerAs:"vm"}).state("signList",{url:"/signList",templateUrl:rootPath+"/signView/html/signList.html",controller:"adminSignListCtrl",controllerAs:"vm"}).state("projectStopInfo",{url:"/projectStopInfo/:signId",templateUrl:rootPath+"/projectStop/html/projectStopInfo.html",controller:"projectStopInfoCtrl",controllerAs:"vm"}).state("selectHeader",{url:"/selectHeader",templateUrl:rootPath+"/sign/html/selectHeader.html",controller:"selectHeaderCtrl",controllerAs:"vm"}).state("signGetBack",{url:"/signGetBack",templateUrl:rootPath+"/sign/html/signGetBack.html",controller:"signGetBackCtrl",controllerAs:"vm"}).state("pauseProject",{url:"/pauseProject",templateUrl:rootPath+"/projectStop/html/pauseProjectList.html",controller:"pauseProjectCtrl",controllerAs:"vm"}).state("projectStopForm",{url:"/projectStopForm/:signId/:stopId",templateUrl:rootPath+"/projectStop/html/projectStopForm.html",controller:"projectStopFormCtrl",controllerAs:"vm"}).state("projectStopFormEdit",{url:"/projectStopFormEdit/:stopId",templateUrl:rootPath+"/projectStop/html/projectStopForm.html",controller:"projectStopFormEditCtrl",controllerAs:"vm"}).state("reserveAdd",{url:"/reserveAdd",templateUrl:rootPath+"/sign/html/reserveAdd.html",controller:"signReserveAddCtrl",controllerAs:"vm"}).state("reserveList",{url:"/reserveList",templateUrl:rootPath+"/sign/html/reserveList.html",controller:"signReserveCtrl",controllerAs:"vm"}).state("reserveEdit",{url:"/reserveEdit",templateUrl:rootPath+"/sign/html/reserveList.html",controller:"signReserveCtrl",controllerAs:"vm"}).state("deletList",{url:"/deletList",templateUrl:rootPath+"/sign/html/deletList.html",controller:"signDeletCtrl",controllerAs:"vm"}).state("workprogramEdit",{url:"/workprogramEdit/:signid/:isControl/:minBusinessId/:businessType",templateUrl:rootPath+"/workprogram/html/edit.html",controller:"workprogramEditCtrl",controllerAs:"vm"}).state("dispatchEdit",{url:"/dispatchEdit/:signid/:isControl",templateUrl:rootPath+"/dispatch/html/edit.html",controller:"dispatchEditCtrl",controllerAs:"vm"}).state("fileRecordEdit",{url:"/fileRecordEdit/:signid/:isControl",templateUrl:rootPath+"/fileRecord/html/edit.html",controller:"fileRecordEditCtrl",controllerAs:"vm"}).state("assistPlan",{url:"/assistPlan",templateUrl:rootPath+"/assistPlan/html/manager.html",controller:"assistPlanCtrl",controllerAs:"vm"}).state("officeUserList",{url:"/officeUserList",templateUrl:rootPath+"/officeUser/html/list.html",controller:"officeUserCtrl",controllerAs:"vm"}).state("officeUserEdit",{url:"/officeUserEdit/:officeID",templateUrl:rootPath+"/officeUser/html/edit.html",controller:"officeUserEditCtrl",controllerAs:"vm"}).state("listDept",{url:"/listDept",templateUrl:rootPath+"/dept/html/list.html",controller:"deptCtrl",controllerAs:"vm"}).state("deptEdit",{url:"/deptEdit/:deptId",templateUrl:rootPath+"/dept/html/edit.html",controller:"deptEditCtrl",controllerAs:"vm"}).state("deptOfficeUser",{url:"/deptOfficeUser/:deptId",templateUrl:rootPath+"/dept/html/listOfficeUser.html",controller:"deptOfficeUserCtrl",controllerAs:"vm"}).state("assistUnit",{url:"/assistUnit",templateUrl:rootPath+"/assistUnit/html/assistUnitList.html",controller:"assistUnitCtrl",controllerAs:"vm"}).state("assistUnitEdit",{url:"/assistUnitEdit/:id",templateUrl:rootPath+"/assistUnit/html/assistUnitEdit.html",controller:"assistUnitEditCtrl",controllerAs:"vm"}).state("quartz",{url:"/quartz",templateUrl:rootPath+"/quartz/html/list.html",controller:"quartzCtrl",controllerAs:"vm"}).state("workday",{url:"/workday",templateUrl:rootPath+"/workday/html/list.html",controller:"workdayCtrl",controllerAs:"vm"}).state("workdayEdit",{url:"/workdayEdit/:id",templateUrl:rootPath+"/workday/html/edit.html",controller:"workdayEditCtrl",controllerAs:"vm"}).state("annountment",{url:"/annountment",templateUrl:rootPath+"/annountment/html/list.html",controller:"annountmentCtrl",controllerAs:"vm"}).state("annountmentEdit",{url:"/annountmentEdit/:id",templateUrl:rootPath+"/annountment/html/edit.html",controller:"annountmentEditCtrl",controllerAs:"vm"}).state("annountmentDetail",{url:"/annountmentDetail/:id",templateUrl:rootPath+"/annountment/html/detail.html",controller:"annountmentDetailCtrl",controllerAs:"vm"}).state("annountmentYet",{url:"/annountmentYet",templateUrl:rootPath+"/annountment/html/yetList.html",controller:"annountmentYetCtrl",controllerAs:"vm"}).state("sharingPlatlform",{url:"/sharingPlatlform",templateUrl:rootPath+"/sharingPlatlform/html/list.html",controller:"sharingPlatlformCtrl",controllerAs:"vm"}).state("sharingPlatlformEdit",{url:"/sharingPlatlformEdit/:sharId",templateUrl:rootPath+"/sharingPlatlform/html/edit.html",controller:"sharingPlatlformEditCtrl",controllerAs:"vm"}).state("sharingDetil",{url:"/sharingDetil/:sharId",templateUrl:rootPath+"/sharingPlatlform/html/detail.html",controller:"sharingDetailCtrl",controllerAs:"vm"}).state("sharingPlatlformYet",{url:"/sharingPlatlformYet",templateUrl:rootPath+"/sharingPlatlform/html/yetList.html",controller:"sharingPlatlformYetCtrl",controllerAs:"vm"}).state("financialManager",{url:"/financialManager/:businessId",templateUrl:rootPath+"/financialManager/html/add.html",controller:"financialManagerCtrl",controllerAs:"vm"}).state("financialAssistManager",{url:"/financialAssistManager/:businessId",templateUrl:rootPath+"/financialManager/html/assistCostAdd.html",controller:"assistCostEditCtrl",controllerAs:"vm"}).state("assistCostlist",{url:"/assistCostlist/:costType",templateUrl:rootPath+"/financialManager/html/assistCostList.html",controller:"assistCostCountEditCtrl",controllerAs:"vm"}).state("assistCostCountList",{url:"/assistCostCountList",templateUrl:rootPath+"/financialManager/html/assistCostCount.html",controller:"assistCostCountListCtrl",controllerAs:"vm"}).state("financialManagerList",{url:"/financialManagerList/:costType",templateUrl:rootPath+"/financialManager/html/list.html",controller:"financialManagerEditCtrl",controllerAs:"vm"}).state("expertPaymentCountList",{url:"/expertPaymentCountList",templateUrl:rootPath+"/financialManager/html/expertPaymentCount.html",params:{year:(new Date).getFullYear()+"",month:(new Date).getMonth()+1+""},controller:"expertPaymentCountCtrl",controllerAs:"vm"}).state("expertPaymentDetailCountList",{url:"/expertPaymentDetailCountList/:year/:month",templateUrl:rootPath+"/financialManager/html/expertPaymentDetailCount.html",controller:"expertPaymentDetailCountCtrl",controllerAs:"vm"}).state("exportCountList",{url:"/exportCountList",templateUrl:rootPath+"/financialManager/html/expertCount.html",controller:"exportCountCtrl",controllerAs:"vm"}).state("expertRevCondCountList",{url:"/expertRevCondCountList",templateUrl:rootPath+"/signView/html/expertReviewCondCount.html",controller:"expertRevConCountCtrl",controllerAs:"vm"}).state("projectCostCountList",{url:"/projectCostCountList",templateUrl:rootPath+"/financialManager/html/projectCostCount.html",controller:"projectCostCountCtrl",controllerAs:"vm"}).state("proCostClassifyCountList",{url:"/proCostClassifyCountList",templateUrl:rootPath+"/financialManager/html/proCostClassifyCount.html",controller:"proCostClassifyCountCtrl",controllerAs:"vm"}).state("proReviewConCountList",{url:"/proReviewConCountList",templateUrl:rootPath+"/signView/html/proReviewConCount.html",controller:"proReviewConditionCtrl",controllerAs:"vm"}).state("monthlyNewsletterList",{url:"/monthlyNewsletterList",templateUrl:rootPath+"/monthlyNewsletter/html/monthlyNewsletterList.html",controller:"monthlyNewsletterCtrl",controllerAs:"vm"}).state("monthlyEdit",{url:"/monthlyEdit/:id",templateUrl:rootPath+"/monthlyNewsletter/html/monthlyNewsletterEdit.html",controller:"monthlyNewsletterEditCtrl",controllerAs:"vm"}).state("theMonthsList",{url:"/theMonthsList",templateUrl:rootPath+"/monthlyNewsletter/html/theMonthsList.html",controller:"yearMonthlyNewsletterCtrl",controllerAs:"vm"}).state("monthlyFindByMultiyear",{url:"/monthlyFindByMultiyear/:year",templateUrl:rootPath+"/monthlyNewsletter/html/monthlyMultiyearList.html",controller:"monthlyMultiyearCtrl",controllerAs:"vm"}).state("monthlyMultiyearEdit",{url:"/monthlyMultiyearEdit/:year/:id",templateUrl:rootPath+"/monthlyNewsletter/html/monthlyMultiyearAdd.html",controller:"monthlyMultiyearEditCtrl",controllerAs:"vm"}).state("monthlyMultiyFileList",{url:"/monthlyMultiyFileList",templateUrl:rootPath+"/monthlyNewsletter/html/monthlyMultiyFileList.html",controller:"monthlyMultiFileCtrl",controllerAs:"vm"}).state("monthlyMultiyView",{url:"/monthlyMultiyView/:id",templateUrl:rootPath+"/monthlyNewsletter/html/monthlyMultiyView.html",controller:"monthlyMultiyViewCtrl",controllerAs:"vm"}).state("monthlyHistoryList",{url:"/monthlyHistoryList",templateUrl:rootPath+"/monthlyNewsletter/html/monthlyHistoryList.html",controller:"monthlyHistoryCtrl",controllerAs:"vm"}).state("monthlyHistoryEdit",{url:"/monthlyHistoryEdit/:id",templateUrl:rootPath+"/monthlyNewsletter/html/monthlyHistoryAdd.html",controller:"monthlyHistoryEditCtrl",controllerAs:"vm"}).state("approveWindow",{url:"/approveWindow/:signId",templateUrl:rootPath+"/reviewProjectAppraise/html/approveWindow.html",controller:"approveWindowCtrl",controllerAs:"vm"}).state("approveWindowEdit",{url:"/approveWindowEdit/:id",templateUrl:rootPath+"/reviewProjectAppraise/html/approveWindow.html",controller:"approveWindowEditCtrl",controllerAs:"vm"}).state("reviewProjectAppraiseList",{url:"/reviewProjectAppraiseList",params:{id:""},templateUrl:rootPath+"/signView/html/list.html",controller:"reviewProjectAppraiseCtrl",controllerAs:"vm"}).state("reviewProjectAppraiseEdit",{url:"/reviewProjectAppraiseEdit",templateUrl:rootPath+"/reviewProjectAppraise/html/edit.html",controller:"reviewProjectAppraiseEditCtrl",controllerAs:"vm"}).state("approveList",{url:"/approveList",templateUrl:rootPath+"/reviewProjectAppraise/html/approveList.html",controller:"approveListCtrl",controllerAs:"vm"}).state("libraryAdd",{url:"/libraryAdd",params:{id:""},templateUrl:rootPath+"/archivesLibrary/html/archivesLibraryAdd.html",controller:"archivesLibraryCtrl",controllerAs:"vm"}).state("archivesLibraryList",{url:"/archivesLibraryList",params:{id:""},templateUrl:rootPath+"/archivesLibrary/html/archivesLibraryList.html",controller:"archivesLibraryListCtrl",controllerAs:"vm"}).state("archivesLibraryView",{url:"/archivesLibraryView/:id",templateUrl:rootPath+"/archivesLibrary/html/archivesLibraryView.html",controller:"archivesLibraryViewCtrl",controllerAs:"vm"}).state("pluginfile",{url:"/pluginfile",templateUrl:rootPath+"/file/html/pluginfile.html",controller:"pluginfileCtrl",controllerAs:"vm"}).state("takeUser",{url:"/takeUser",templateUrl:rootPath+"/personalCenter/html/takeUser.html",controller:"takeUserCtrl",controllerAs:"vm"}).state("fileLibrary",{url:"/fileLibrary",templateUrl:rootPath+"/fileLibrary/html/fileLibrary.html",controller:"qualityCtrl",controllerAs:"vm"}).state("fileLibrary.fileList",{url:"/fileList/:parentId",templateUrl:rootPath+"/fileLibrary/html/fileList.html",controller:"qualityListCtrl",controllerAs:"vm"}).state("fileLibrary.fileEdit",{url:"/fileEdit/:parentId/:fileId",templateUrl:rootPath+"/fileLibrary/html/fileEdit.html",controller:"qualityEditCtrl",controllerAs:"vm"}).state("policyLibrary",{url:"/policyLibrary",templateUrl:rootPath+"/fileLibrary/html/policyLibrary.html",controller:"policyCtrl",controllerAs:"vm"}).state("policyLibrary.policyList",{url:"/policyList/:parentId",templateUrl:rootPath+"/fileLibrary/html/policyList.html",controller:"policyListCtrl",controllerAs:"vm"}).state("policyLibrary.policyEdit",{url:"/policyEdit/:parentId/:fileId",templateUrl:rootPath+"/fileLibrary/html/policyEdit.html",controller:"policyEditCtrl",controllerAs:"vm"}).state("bookBuyBusinessEdit",{url:"/bookBuyBusinessEdit",params:{businessId:"",viewDetail:""},templateUrl:rootPath+"/bookBuyBusiness/html/bookBuyBusinessEdit.html",controller:"bookBuyBusinessEditCtrl",controllerAs:"vm"}).state("myBookBuyBusiness",{url:"/myBookBuyBusiness",templateUrl:rootPath+"/bookBuyBusiness/html/bookBuyBusinessList.html",controller:"bookBuyBusinessCtrl",controllerAs:"vm"}).state("bookDetailList",{url:"/bookDetailList",templateUrl:rootPath+"/bookBuyBusiness/html/bookBuyList.html",controller:"bookBuyCtrl",controllerAs:"vm"}).state("bookBuyBusinessDetail",{url:"/bookBuyBusinessDetail/:businessId/:viewDetail",templateUrl:rootPath+"/bookBuyBusiness/html/bookBuyBusinessDetail.html",controller:"bookBuyBusinessDetailCtrl",controllerAs:"vm"}).state("bookBorrowList",{url:"/bookBorrowList",templateUrl:rootPath+"/bookBuyBusiness/html/bookBorrowList.html",controller:"bookBorrowCtrl",controllerAs:"vm"}).state("assertStorageBusinessEdit",{url:"/assertStorageBusinessEdit/:businessId",templateUrl:rootPath+"/assertStorageBusiness/html/assertStorageBusinessEdit.html",controller:"assertStorageBusinessEditCtrl",controllerAs:"vm"}).state("myAssertStorageBusiness",{url:"/myAssertStorageBusiness",templateUrl:rootPath+"/assertStorageBusiness/html/assertStorageBusinessList.html",controller:"assertStorageBusinessCtrl",controllerAs:"vm"}).state("assertApplyUse",{url:"/assertApplyUse",templateUrl:rootPath+"/userAssertDetail/html/userAssertDetailAdd.html",controller:"userAssertDetailAddCtrl",controllerAs:"vm"}).state("addTopic",{url:"/topicInfo/:id",templateUrl:rootPath+"/topicInfo/html/add.html",controller:"topicAddCtrl",controllerAs:"vm"}).state("myTopic",{url:"/myTopic",templateUrl:rootPath+"/topicInfo/html/myList.html",controller:"myTopicCtrl",controllerAs:"vm"}).state("header",{url:"/header",templateUrl:rootPath+"/header/html/list.html",controller:"headerCtrl",controllerAs:"vm"}).state("headerEdit",{url:"/headerEdit/:headerType",templateUrl:rootPath+"/header/html/selectHeader.html",controller:"headerEditCtrl",controllerAs:"vm"}).state("statisticalList",{url:"/statisticalList/:headerType",templateUrl:rootPath+"/header/html/statisticalList.html",controller:"statisticalListCtrl",controllerAs:"vm"}).state("statistical",{url:"/statistical",templateUrl:rootPath+"/statistical/html/list.html",controller:"statisticalCtrl",controllerAs:"vm"}).state("editWorkPlan",{url:"/editWorkPlan/:topicId",templateUrl:rootPath+"/workPlan/html/edit.html",controller:"workPlanEditCtrl",controllerAs:"vm"}).state("editFiling",{url:"/editFiling/:topicId",templateUrl:rootPath+"/filing/html/edit.html",controller:"filingEditCtrl",controllerAs:"vm"}).state("reviewFee",{url:"/reviewFee",templateUrl:rootPath+"/reviewFee/html/list.html",controller:"reviewFeeCtrl",controllerAs:"vm"}).state("signwork",{url:"/signwork/:signid",templateUrl:rootPath+"/signwork/html/list.html",controller:"signworkCtrl",controllerAs:"vm"}).state("signFlowDeal.fileList",{url:"/fileList/:id/:type",templateUrl:rootPath+"/file/html/rightList.html",controller:"fileListCtrl",controllerAs:"vm"}).state("signFlowDetail.fileList",{url:"/fileList/:id/:type",templateUrl:rootPath+"/file/html/rightList.html",controller:"fileListCtrl",controllerAs:"vm"}).state("endSignDetail.fileList",{url:"/fileList/:id/:type",templateUrl:rootPath+"/file/html/rightList.html",controller:"fileListCtrl",controllerAs:"vm"}).state("signDetails.fileList",{url:"/fileList/:id/:type",templateUrl:rootPath+"/file/html/rightList.html",controller:"fileListCtrl",controllerAs:"vm"}).state("flowDeal.fileList",{url:"/flowDeal/:id/:type",templateUrl:rootPath+"/file/html/rightList.html",controller:"fileListCtrl",controllerAs:"vm"}).state("MaintainProjectEdit.fileList",{url:"/MaintainProjectEdit/:id/:type",templateUrl:rootPath+"/file/html/rightList.html",controller:"fileListCtrl",controllerAs:"vm"}).state("signChart",{url:"/signChart",templateUrl:rootPath+"/signView/html/signChart.html",controller:"signChartCtrl",controllerAs:"vm"}).state("MaintainProjectList",{url:"/MaintainProjectList",templateUrl:rootPath+"/sign/html/MaintainProjectList.html",controller:"MaintainProjectCtrl",controllerAs:"vm"}).state("MaintainProjectEdit",{url:"/MaintainProjectEdit/:signid/:processInstanceId",templateUrl:rootPath+"/sign/html/MaintainProjectEdit.html",controller:"MaintainProjectEditCtrl",controllerAs:"vm"}).state("reviewWorkday",{url:"/reviewWorkday/:signid",templateUrl:rootPath+"/maintainProject/html/reviewWorkday.html",controller:"reviewWorkdayCtrl",controllerAs:"vm"}).state("reviewOpinion",{url:"/reviewOpinion/:signid/:processInstanceId",templateUrl:rootPath+"/maintainProject/html/reviewOpinion.html",controller:"reviewOpinionCtrl",controllerAs:"vm"}).state("maintainExpertScore",{url:"/maintainExpertScore/:signid",templateUrl:rootPath+"/maintainProject/html/maintainExpertScore.html",controller:"maintainExpertScoreCtrl",controllerAs:"vm"}).state("maintainExpertPayment",{url:"/maintainExpertPayment/:signid",templateUrl:rootPath+"/maintainProject/html/maintainExpertPayment.html",controller:"maintainExpertPaymentCtrl",controllerAs:"vm"}).state("maintainExpertConfirm",{url:"/maintainExpertConfirm/:signid",templateUrl:rootPath+"/maintainProject/html/maintainExpertConfirm.html",controller:"maintainExpertConfirmCtrl",controllerAs:"vm"}).state("partyEdit",{url:"/partyEdit",templateUrl:rootPath+"/partyManager/html/partyEdit.html",controller:"partyEditCtrl",controllerAs:"vm"}).state("partyList",{url:"/partyList",templateUrl:rootPath+"/partyManager/html/partyList.html",controller:"partyListCtrl",controllerAs:"vm"}).state("partyMeeting",{url:"/partyMeeting",templateUrl:rootPath+"/partyManager/html/addPartyMeeting.html",controller:"partyMeetingCtrl",controllerAs:"vm"})}]).run(function(e,t,i,o,n){e.rootPath=rootPath,e.DICT=DICTOBJ,kendo.culture("zh-CN"),common.getTaskCount({$http:t}),e.getTBHeadName=function(e,t,i){return!t||"9"!=t||"项目建议书"!=e&&"可行性研究报告"!=e?e?"项目概算"==e?"概算审核"+i:e+i:i:"评估论证"+i},e.$on("$stateChangeSuccess",function(t,i,o,n,a){e.previousState_name=n.name,e.previousState_params=a,"signFlowDeal"!=n.name&&"flowDeal"!=n.name||(e.$flowUrl=n.name,e.$flowParams=a)}),e.back=function(){e.previousState_name?i.go(e.previousState_name,e.previousState_params):i.go("welcome")},e.backtoflow=function(){e.$flowUrl?i.go(e.$flowUrl,e.$flowParams):i.go("gtasks")},e.topSelectChange=function(e,t,i){if(void 0!=t)for(var o=0;o<t.length;o++)if(i&&"code"==i){if(t[o].dictCode==e)return t[o].dicts}else if(t[o].dictName==e)return t[o].dicts},e.initInputValue=function(e,t){return e.target.checked&&!t?1:t},e.range=function(e){if(e)return new Array(e)},e.countCharacter=function(e,t,i){var o=e?e.length:0,n="<span style='font-size:12px;'>（最多允许输入"+t+"个字";if(o>0){var a=t-o>0?t-o:0;n+=",还能输入<font color='red'>"+a+"</font>个字",0==a&&(e=e.substr(0,t))}return n+="</span>)",$("#"+i).html(n),e},e.previewFile=function(e,i){if(e){var o;if("pdf"==i?o=rootPath+"/contents/libs/pdfjs-dist/web/viewer.html?file="+rootPath+"/file/preview/"+e+"&version="+(new Date).getTime():"image"==i&&(o=rootPath+"/file/preview/"+e+"?version="+(new Date).getTime()),o){var a={method:"post",url:rootPath+"/file/fileSysCheck",params:{sysFileId:e}},r=function(e){$("#iframePreview").attr("src",""),e.data.flag||"ok"==e.data.reCode?($("#iframePreview").attr("src",o),$("#previewModal").kendoWindow({width:"1050px",height:"730px",title:"",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()):n.error(e.data.reMsg)};common.http({$http:t,httpOptions:a,success:r})}else n.alert("该文件不支持在线预览和在线编辑")}else n.alert("参数不正确，无法在线预览")},e.editFile=function(e,t){var i=rootPath+"/file/editFile?sysFileId="+e+"&fileType="+t+"&version="+(new Date).getTime();window.open(i,"_blank")},e.printFile=function(e,t,i){if(e&&t&&i){var o=rootPath+"/contents/libs/pdfjs-dist/web/viewer.html?version="+(new Date).getTime()+"&file="+rootPath+"/file/printPreview/"+e+"/"+t+"/"+i;$("#iframePreview").attr("src",o),$("#previewModal").kendoWindow({width:"80%",height:"730px",title:"",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()}else n.alert("打印预览失败，参数不正确！")},e.isBankCard=function(t,i){for(var o=!1,a=0;a<t.length;a++)if(void 0==t[a].expertDto.bankAccount||void 0==t[a].expertDto.openingBank){o=!0,n.alert("专家的开户行和银行账户信息不全，请填写完整！");break}o||e.printFile(i,"SIGN_EXPERT","SIGN_EXPERT_PAY")},e.view={},e.storeView=function(t,i){e.view[t]=i}})}(),function(){"use strict";var e=angular.module("app");e.directive("goBack",function(){return{restrict:"AE",template:'<a class="btn btn-sm btn-primary" href="javascript:void(0);" ng-click="back();"><span class="glyphicon glyphicon-chevron-left"></span>返回</a>'}}),e.directive("goBackFlow",function(){return{restrict:"AE",template:'<button class="btn btn-sm btn-danger" ng-click="backtoflow();"><span class="glyphicon glyphicon-chevron-left"></span>返回流程</button>'}}),e.directive("flowFileButton",function(){return{restrict:"AE",template:'<button class="btn btn-sm btn-primary" ng-click="vm.clickUploadBt();" id="upload_file_bt">上传附件</button> <button class="btn btn-sm btn-primary" ng-click="vm.clickDetailBt();" id="detail_file_bt">查看附件</button>'}})}(),function(){"use strict";function e(e,t,i){var o=this;o.title="登记补充资料",o.sign={},o.addRegisters=[],o.businessId=i.params.businessId,o.addRegisterFile=function(){o.addRegister={},o.addRegister.businessId=o.businessId,o.addRegister.id=common.uuid(),o.addRegisters.push(o.addRegister)},o.saveRegisterFile=function(){t.saveRegisterFile(o.addRegisters,function(t){t.flag||"ok"==t.reCode?(e.alert("操作成功"),o.addRegisters=t.reObj):e.alert(t.reMsg)})},o.deleteRegisterFile=function(){var i=$("#addRegistersTable input[name='addRegistersCheck']:checked");if(i.length<1)e.alert("请选择要删除的记录！");else{for(var n=[],a=0;a<i.length;a++)o.addRegisters.forEach(function(e,t){e.id&&i[a].value==e.id&&(n.push(i[a].value),o.addRegisters.splice(t,1))});n.length>0&&t.deleteByIds(n.join(","),function(t){e.alert("删除成功！")})}},o.inputIntegerValue=function(e,i){t.isUnsignedInteger(e)?$("#errorsUnmber"+i).html(""):$("#errorsUnmber"+i).html("只能输入数字")},function(){i.params.businessId&&t.initAddRegisterFile(i.params.businessId,function(e){e&&e.length>0&&(o.addRegisters=e)})}()}angular.module("app").controller("addRegisterFileCtrl",e),e.$inject=["bsWin","addRegisterFileSvc","$state"]}(),function(){"use strict";function e(e,t,i){var o=this;o.title="添加登记补充资料",o.isuserExist=!1,o.id=i.params.id,o.id&&(o.isUpdate=!0,o.title="更新登记补充资料"),o.create=function(){t.createAddRegisterFile(o)},o.update=function(){t.updateAddRegisterFile(o)},function(){o.isUpdate&&t.getAddRegisterFileById(o)}()}angular.module("app").controller("addRegisterFileEditCtrl",e),e.$inject=["$location","addRegisterFileSvc","$state"]}(),function(){"use strict";function e(e){function t(e,t){$("#addRegister").kendoWindow({width:"70%",height:"660px",title:"意见选择",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()}function i(e){return!!(/^(\+|-)?\d+$/.test(e)&&e>0)}function o(t,i){var o={method:"post",url:rootPath+"/addRegisterFile/save",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(t)},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}
function n(t,i){var o={method:"post",url:rootPath+"/addRegisterFile/findByBusinessId",params:{businessId:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function a(t,i){var o={method:"delete",url:r+"/deleteFile",params:{ids:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}var r=rootPath+"/addRegisterFile";return{initAddRegisterFile:n,saveRegisterFile:o,isUnsignedInteger:i,initRegisterWinDow:t,deleteByIds:a}}angular.module("app").factory("addRegisterFileSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,i,o,n,a){var r=this;r.suppletter={},r.suppletter.businessId=o.params.businessId,r.suppletter.businessType=o.params.businessType,r.suppletter.id=o.params.id,r.isControl=o.params.isControl,r.title="拟补充资料函",r.businessFlag={isInitFileOption:!1},function(){t.initSuppLetter(r.suppletter.businessId,r.suppletter.businessType,function(e){r.suppletter=e,r.initFileUpload()})}(),r.initFileUpload=function(){r.suppletter.id||a.$watch("vm.suppletter.id",function(e,t){e&&e!=t&&!r.initUploadOptionSuccess&&r.initFileUpload()}),r.sysFile={businessId:r.suppletter.id,mainId:r.suppletter.businessId,mainType:i.mainTypeValue().SIGN,sysfileType:i.mainTypeValue().AADSUPP_FILE,sysBusiType:i.mainTypeValue().AADSUPP_FILE},i.initUploadOptions({inputId:"sysfileinput",vm:r})},r.saveAddSuppletter=function(){common.initJqValidation($("#suppletter_form")),$("#suppletter_form").valid()?(r.suppletter.fileType="1",t.saveSuppLetter(r.suppletter,r.isCommit,function(e){e.flag||"ok"==e.reCode?(r.suppletter=e.reObj,n.success("操作成功！")):n.error(e.reMsg)})):n.alert("表格填写不正确，请检查相应的必填项信息！")},r.startSignSupperFlow=function(){common.initJqValidation($("#suppletter_form")),$("#suppletter_form").valid()?n.confirm({title:"询问提示",message:"确认已经完成填写，并且发起流程么？",onOk:function(){t.saveSuppLetter(r.suppletter,r.isCommit,function(e){r.isCommit=!1,e.flag||"ok"==e.reCode?(r.suppletter=e.reObj,t.startSignSupperFlow(r.suppletter.id,function(e){e.flag||"ok"==e.reCode?n.success("操作成功！"):n.error(e.reMsg)})):n.error(e.reMsg)})}}):n.alert("表格填写不正确，请检查相应的必填项信息！")},r.del=function(e){common.confirm({vm:r,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteAddSuppLetter(r,e)}})},r.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:r,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");r.del(o)}}}angular.module("app").controller("addSuppLetterCtrl",e),e.$inject=["$location","addSuppLetterSvc","sysfileSvc","$state","bsWin","$scope"]}(),function(){"use strict";function e(e,t,i,o,n,a){var r=this;r.title="添加登记补充资料",r.isuserExist=!1,r.id=o.params.id,r.suppletter={},r.suppletter.businessId=o.params.businessId,r.suppletter.businessType=o.params.businessType,r.suppletter.id=o.params.id,r.id&&(r.isUpdate=!0,r.title="更新登记补充资料"),r.businessFlag={isInitFileOption:!1},r.initFileUpload=function(){r.suppletter.id||a.$watch("vm.suppletter.id",function(e,t){e&&e!=t&&!r.initUploadOptionSuccess&&r.initFileUpload()}),r.sysFile={businessId:r.suppletter.id,mainId:r.suppletter.businessId,mainType:i.mainTypeValue().SIGN,sysfileType:i.mainTypeValue().AADSUPP_FILE,sysBusiType:i.mainTypeValue().AADSUPP_FILE,detailBt:"detail_file_bt"},i.initUploadOptions({inputId:"sysfileinput",vm:r})},r.saveAddSuppletter=function(){common.initJqValidation($("#suppletter_form")),$("#suppletter_form").valid()?t.saveSuppLetter(r.suppletter,r.isCommit,function(e){e.flag||"ok"==e.reCode?(r.suppletter=e.reObj,n.success("操作成功！")):n.error(e.reMsg)}):n.alert("表格填写不正确，请检查相应的必填项信息！")},r.comeBack=function(){o.go("addSuppletterList",{businessId:r.suppletter.businessId})},r.update=function(){t.updateAddSuppLetter(r)},r.startSignSupperFlow=function(){common.initJqValidation($("#suppletter_form")),$("#suppletter_form").valid()?n.confirm({title:"询问提示",message:"确认已经完成填写，并且发起流程么？",onOk:function(){t.saveSuppLetter(r.suppletter,r.isCommit,function(e){r.isCommit=!1,e.flag||"ok"==e.reCode?(r.suppletter=e.reObj,o.go("addSuppletterList",{businessId:r.suppletter.businessId}),t.startSignSupperFlow(r.suppletter.id,function(e){e.flag||"ok"==e.reCode?n.success("操作成功！"):n.error(e.reMsg)})):n.error(e.reMsg)})}}):n.alert("提交失败，有红色*号的内容都要按要求填写！")},function(){t.getAddSuppLetterById(r.suppletter.id,function(e){r.suppletter=e,r.initFileUpload()})}()}angular.module("app").controller("addSuppLetterEditCtrl",e),e.$inject=["$location","addSuppLetterSvc","sysfileSvc","$state","bsWin","$scope"]}(),function(){"use strict";function e(e,t){function i(t,i){var o={method:"post",url:rootPath+"/addSuppLetter/startSignSupperFlow",params:{id:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function o(e){c(e.businessKey,function(t){e.suppletter=t})}function n(t,i){var o={method:"post",url:rootPath+"/addSuppLetter/initSuppListDate",params:{businessId:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function a(t,i){var o={method:"post",url:u+"/createFileNum",params:{id:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function r(t,i,o){var n={method:"post",url:rootPath+"/addSuppLetter/initSuppLetter",params:{businessId:t,businessType:i}},a=function(e){void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a})}function s(t,i){t.isSubmit=!0;var o={method:"delete",url:u,data:i},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})}})};common.http({vm:t,$http:e,httpOptions:o,success:n})}function l(t,i,o){i=!0;var n={method:"post",url:rootPath+"/addSuppLetter/saveSupp",data:t},a=function(e){void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a,onError:function(e){i=!1}})}function c(t,i){var o={method:"post",url:rootPath+"/addSuppLetter/findById",params:{id:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function d(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(u),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"id",title:"id",width:100,filterable:!0},{field:"orgName",title:"orgName",width:100,filterable:!0},{field:"userName",title:"userName",width:100,filterable:!0},{field:"suppLetterTime",title:"suppLetterTime",width:100,filterable:!0,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"disapDate",title:"disapDate",width:100,filterable:!0,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"secretLevel",title:"secretLevel",width:100,filterable:!0},{field:"mergencyLevel",title:"mergencyLevel",width:100,filterable:!0},{field:"filenum",title:"filenum",width:100,filterable:!0},{field:"title",title:"title",width:100,filterable:!0},{field:"dispaRange",title:"dispaRange",width:100,filterable:!0},{field:"suppleterSuggest",title:"suppleterSuggest",width:100,filterable:!0},{field:"meetingSuggest",title:"meetingSuggest",width:100,filterable:!0},{field:"leaderSuggest",title:"leaderSuggest",width:100,filterable:!0},{field:"printnum",title:"printnum",width:100,filterable:!0},{field:"signid",title:"signid",width:100,filterable:!0},{field:"fileSeq",title:"fileSeq",width:100,filterable:!0},{field:"",title:"操作",width:140,template:function(e){return common.format($("#columnBtns").html(),"vm.del('"+e.id+"')",e.id)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0}}var u=rootPath+"/addSuppLetter";return{initSuppLetter:r,saveSuppLetter:l,grid:d,deleteAddSuppLetter:s,getAddSuppLetterById:c,createFilenum:a,initSuppListDate:n,initFlowDeal:o,startSignSupperFlow:i}}angular.module("app").factory("addSuppLetterSvc",e),e.$inject=["$http","bsWin"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.suppletter={},n.suppletter.businessId=i.params.businessId,n.title="登记补充资料",function(){t.initSuppListDate(n.suppletter.businessId,function(e){n.suppletterlist=e})}(),n.getFilenum=function(e){t.createFilenum(e,function(e){e.flag||"ok"==e.reCode?(o.alert("操作成功！"),$.each(n.suppletterlist,function(t,i){i.id==e.reObj.id&&(i.filenum=e.reObj.filenum)})):o.alert(e.reMsg)})},n.findByIdAddSuppLetter=function(e){i.go("addSuppLetterEdit",{id:e})}}angular.module("app").controller("addSuppLetterListCtrl",e),e.$inject=["$location","addSuppLetterSvc","$state","bsWin"]}(),function(){"use strict";function e(e,t,i,o,n){var a=this;a.suppletter={},a.id=i.params.id,a.isQuery=!0,a.model={},function(){t.addQueryGrid(a),n.queryOrgList(a,function(e){a.model.org=e})}(),a.quarySuppContent=function(){a.queryGridOptions.dataSource._skip="",a.queryGridOptions.dataSource.read()},a.resetSuppContent=function(){var e=$("#supQueryForm").find("input,select").not(":submit, :reset, :image, :disabled,:hidden");$.each(e,function(e,t){t.value=""})},a.showSuppLetterDetail=function(e){a.isDisplay=!0,a.id=e,t.getaddSuppLetterQueryById(a,function(e){a.suppletter=e,$("#suppLetterDetailDiv").kendoWindow({width:"70%",height:"620px",title:"拟补充资料函详情",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()})}}angular.module("app").controller("addSuppLetterQueryCtrl",e),e.$inject=["$location","addSuppLetterQuerySvc","$state","bsWin","orgSvc"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.title="添加登记补充资料",n.isuserExist=!1,n.id=i.params.id,n.id&&(n.isUpdate=!0,n.title="更新登记补充资料"),n.saveSuppletterApprove=function(){t.createaddSuppLetterQuery(n)},n.update=function(){t.updateaddSuppLetterQuery(n)},function(){t.getaddSuppLetterQueryById(n,function(e){n.suppletter=e})}()}angular.module("app").controller("addSuppLetterQueryEditCtrl",e),e.$inject=["$location","addSuppLetterQuerySvc","$state","bsWin"]}(),function(){"use strict";function e(e,t){function i(t,i){var o={method:"post",url:rootPath+"/addSuppLetterQuery/initSuppListDate",params:{businessId:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function o(t,i){var o={method:"post",url:u+"/createFileNum",params:{id:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function n(t,i,o){var n={method:"post",url:rootPath+"/addSuppLetterQuery/initSuppLetter",params:{businessId:t,businessType:i}},a=function(e){void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a})}function a(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0,t.model.id=t.id;var i={method:"put",url:u,data:t.model},o=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:t,$http:e,httpOptions:i,success:o})}}function r(t,i){t.isSubmit=!0;var o={method:"delete",url:u,data:i},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})}})};common.http({vm:t,$http:e,httpOptions:o,success:n})}function s(i){var o={method:"post",url:rootPath+"/addSuppLetter/updateApprove",data:i.suppletter},n=function(e){t.success("操作成功！")};common.http({$http:e,httpOptions:o,success:n})}function l(t,i){var o={method:"post",url:rootPath+"/addSuppLetter/findById",params:{id:t.id}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({vm:t,$http:e,httpOptions:o,success:n})}function c(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/addSuppLetter/addsuppListData",$("#supQueryForm")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})},o=[{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"",title:"文件标题",filterable:!1,template:function(e){return"<a ng-click='vm.showSuppLetterDetail( \""+e.id+"\")'>"+e.title+"</a>"}},{field:"orgName",title:"拟稿部门",width:120,filterable:!1},{field:"userName",title:"拟稿人",width:90,filterable:!1},{field:"suppLetterTime",title:"拟稿时间",width:120,filterable:!1,format:"{0: yyyy-MM-dd}"},{field:"filenum",title:"文件字号",width:120,filterable:!1},{field:"",title:"操作",width:80,filterable:!1,template:function(e){var t=!1;return e.createdBy!=curUserId||!angular.isUndefined(e.appoveStatus)&&null!=e.appoveStatus||(t=!0),t?"<a class='btn btn-xs btn-primary' href='#addSuppLetterEdit/"+e.id+"'><span class='glyphicon glyphicon-pencil'></span>编辑</a>":""}}];e.queryGridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}function d(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(u+"/addSuppApproveList"),schema:{data:"value",total:function(e){return e.count?$("#ADDSUPPLETTER_COUNT").html(e.count):$("#ADDSUPPLETTER_COUNT").html(0),e.count},model:{id:"id",fields:{createdDate:{type:"date"},modifiedDate:{type:"date"}}}},serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"title",title:"文件标题",width:100,filterable:!1},{field:"orgName",title:"拟稿部门",width:100,filterable:!1},{field:"userName",title:"拟稿人",width:100,filterable:!1},{field:"suppLetterTime",title:"拟稿时间",width:100,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"filenum",title:"文件字号",width:100,filterable:!1},{field:"",title:"操作",width:140,template:function(e){return common.format($("#columnBtns").html(),e.id)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0}}var u=rootPath+"/addSuppLetter";return{approveGrid:d,addQueryGrid:c,createaddSuppLetterQuery:s,deleteaddSuppLetterQuery:r,updateaddSuppLetterQuery:a,getaddSuppLetterQueryById:l,initSuppLetter:n,createFilenum:o,initSuppListDate:i}}angular.module("app").factory("addSuppLetterQuerySvc",e),e.$inject=["$http","bsWin"]}(),function(){"use strict";function e(e,t,i,o,n,a){var r=this;r.isuserExist=!1,r.id=o.params.id,r.suppletter={},r.suppletter.id=o.params.id,r.id&&(r.isUpdate=!0,r.title="查看登记补充资料"),r.businessFlag={isInitFileOption:!1},r.initFileUpload=function(){r.suppletter.id||a.$watch("vm.suppletter.id",function(e,t){e&&e!=t&&!r.initUploadOptionSuccess&&r.initFileUpload()}),r.sysFile={businessId:r.suppletter.id,mainId:r.suppletter.id,mainType:i.mainTypeValue().SIGN,sysfileType:i.mainTypeValue().AADSUPP_FILE,sysBusiType:i.mainTypeValue().AADSUPP_FILE},i.initUploadOptions({inputId:"sysfileinput",vm:r})},r.addSuppContent=function(){if(r.suppletter.id){r.showsupp=!0;$("#addsuppletter").kendoWindow({width:"60%",height:"90%",title:"拟补资料函正文",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open(),t.findByBusinessId(r)}else n.alert("请先保存业务数据")},r.saveAddSuppletter=function(){common.initJqValidation($("#suppletter_form")),$("#suppletter_form").valid()?t.saveSuppLetter(r.suppletter,r.isCommit,function(e){e.flag||"ok"==e.reCode?(r.suppletter=e.reObj,n.success("操作成功！")):n.error(e.reMsg)}):n.alert("表格填写不正确，请检查相应的必填项信息！")},r.comeBack=function(){o.go("addSuppletterList",{businessId:r.suppletter.businessId})},function(){t.getAddSuppLetterById(r.suppletter.id,function(e){r.suppletter=e,r.initFileUpload()})}()}angular.module("app").controller("suppLetterViewCtrl",e),e.$inject=["$location","addSuppLetterSvc","sysfileSvc","$state","bsWin","$scope"]}(),function(){"use strict";function e(e,t){var i=this;i.title="待办任务",function(){t.agendaTaskGrid(i),t.workName(i)}(),i.query=function(){i.gridOptions.dataSource._skip=0,i.gridOptions.dataSource.read()}}angular.module("app").controller("adminAgendaCtrl",e),e.$inject=["$location","adminSvc"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.title="待办项目",n.stateName=i.current.name,n.queryParams={},n.saveView=function(){o.storeView(n.stateName,{gridParams:n.gridOptions.dataSource.transport.options.read.data(),queryParams:n.queryParams,data:n})},function(){if(o.view[n.stateName]){var e=o.view[n.stateName];e.gridParams&&(n.gridParams=e.gridParams),e.data&&(n.model=e.data.model),e.queryParams&&(n.queryParams=e.queryParams),t.gtasksGrid(n),o.view[n.stateName]=void 0}else t.gtasksGrid(n)}(),n.querySign=function(){n.gridOptions.dataSource._skip=0,n.gridOptions.dataSource.read()},n.resetForm=function(){var e=$("#searchform").find("input,select");$.each(e,function(e,t){t.value=""})},n.countWorkday=function(){t.countWorakday(n)}}angular.module("app").filter("date",function(){return function(e){return e?new Date(e.CompatibleDate()).Format("yyyy-MM-dd"):""}}).controller("adminCtrl",e),e.$inject=["$location","adminSvc","$state","$rootScope"]}(),function(){"use strict";function e(e,t,i,o,n,a,r,s){var l=this;l.title="在办项目",l.model={},l.page=0,l.stateName=r.current.name,l.queryParams={},l.saveView=function(){s.storeView(l.stateName,{gridParams:l.gridOptions.dataSource.transport.options.read.data(),queryParams:l.queryParams,data:l})},function(){if(l.showwin=!1,s.view[l.stateName]){var e=s.view[l.stateName];e.gridParams&&(l.gridParams=e.gridParams),e.data&&(l.model=e.data.model),e.queryParams&&(l.queryParams=e.queryParams),t.dtasksGrid(l),s.view[l.stateName]=void 0}else t.dtasksGrid(l)}(),l.pauseProject=function(e){o.findPausingProject(l,e,"")},l.Checked=function(){$("#fileNo").is(":checked")&&($("#file1").prop("checked",!1),$("#file2").prop("checked",!1))},l.Checked2=function(){$("#fileNo").prop("checked",!1)},l.commitProjectStop=function(){o.pauseProject(l)},l.closewin=function(){window.parent.$("#spwindow").data("kendoWindow").close()},l.querySign=function(){l.gridOptions.dataSource._skip="",l.gridOptions.dataSource.read()},l.formReset=function(){l.model={}},l.startProject=function(e){common.confirm({vm:l,title:"",msg:"确认激活吗？",fn:function(){$(".confirmDialog").modal("hide"),i.activeFlow(l,e)}})},l.deletProject=function(e){n.confirm({title:"询问提示",message:"确认删除该条项目吗？",onOk:function(){$(".confirmDialog").modal("hide"),a.deleteSign(e,function(e){e.flag||"ok"==e.reCode?n.alert("删除成功！",function(){l.gridOptions.dataSource.read()}):n.alert(e.reMsg)})}})}}angular.module("app").controller("adminDoingCtrl",e),e.$inject=["$location","adminSvc","flowSvc","pauseProjectSvc","bsWin","signSvc","$state","$rootScope"]}(),function(){"use strict";function e(e,t,i){var o=this;o.title="在办任务",o.stateName=t.current.name,o.queryParams={},o.saveView=function(){i.storeView(o.stateName,{gridParams:o.gridOptions.dataSource.transport.options.read.data(),queryParams:o.queryParams,data:o})},o.query=function(){o.gridOptions.dataSource._skip="",o.gridOptions.dataSource.read()},function(){if(i.view[o.stateName]){var t=i.view[o.stateName];t.gridParams&&(o.gridParams=t.gridParams),t.data&&(o.model=t.data.model),t.queryParams&&(o.queryParams=t.queryParams),e.doingTaskGrid(o),i.view[o.stateName]=void 0}else e.doingTaskGrid(o);e.workName(o)}()}angular.module("app").controller("adminDoTaskCtrl",e),e.$inject=["adminSvc","$state","$rootScope"]}(),function(){"use strict";function e(e,t){var i=this;i.title="办结事项",function(){t.etasksGrid(i)}()}angular.module("app").controller("adminEndCtrl",e),e.$inject=["$location","adminSvc"]}(),function(){"use strict";function e(e,t,i,o,n,a){var r=this;r.title="个人经办项目",r.model={},r.stateName=n.current.name,r.queryParams={},r.saveView=function(){a.storeView(r.stateName,{gridParams:r.gridOptions.dataSource.transport.options.read.data(),queryParams:r.queryParams,data:r})},function(){if(r.showwin=!1,a.view[r.stateName]){var e=a.view[r.stateName];e.gridParams&&(r.gridParams=e.gridParams),e.data&&(r.model=e.data.model),e.queryParams&&(r.queryParams=e.queryParams),t.personMainTasksGrid(r),a.view[r.stateName]=void 0}else t.personMainTasksGrid(r)}()}angular.module("app").controller("adminPersonAssistCtrl",e),e.$inject=["$location","adminSvc","flowSvc","pauseProjectSvc","$state","$rootScope"]}(),function(){"use strict";function e(e,t,i,o,n,a){var r=this;r.title="个人经办项目",r.stateName=n.current.name,r.queryParams={},r.saveView=function(){a.storeView(r.stateName,{gridParams:r.gridOptions.dataSource.transport.options.read.data(),queryParams:r.queryParams,data:r})},function(){if(a.view[r.stateName]){var e=a.view[r.stateName];e.gridParams&&(r.gridParams=e.gridParams),e.data&&(r.model=e.data.model),e.queryParams&&(r.queryParams=e.queryParams),t.personMainTasksGrid(r),a.view[r.stateName]=void 0}else t.personMainTasksGrid(r)}(),r.querySign=function(){r.gridOptions.dataSource._skip=0,r.gridOptions.dataSource.read()},r.resetForm=function(){r.model={}},r.pauseProject=function(e){o.findPausingProject(r,e)},r.startProject=function(e){common.confirm({vm:r,title:"",msg:"确认激活吗？",fn:function(){$(".confirmDialog").modal("hide"),i.activeFlow(r,e)}})}}angular.module("app").controller("adminPersonDoingCtrl",e),e.$inject=["$location","adminSvc","flowSvc","pauseProjectSvc","$state","$rootScope"]}(),function(){"use strict";function e(e,t,i,o,n,a,r,s,l){var c=this;c.title="项目查询统计",c.currentAssociateSign={},c.signList={},c.headerList={},c.header="",c.project={},c.headerType="项目类型",c.fileName="项目统计报表",c.signList=[],c.page=0,c.stateName=o.current.name,c.queryParams={},c.saveView=function(){r.storeView(c.stateName,{gridParams:c.signListOptions.dataSource.transport.options.read.data(),queryParams:c.queryParams,data:c})},function(){if(r.view[c.stateName]){var e=r.view[c.stateName];e.gridParams&&(c.gridParams=e.gridParams),e.data&&(c.project=e.data.project),e.queryParams&&(c.queryParams=e.queryParams),t.getSignList(c),r.view[c.stateName]=void 0}else t.getSignList(c);t.initSignList(function(e){(e.flag||"ok"==e.reCode)&&(c.orgDeptList=e.reObj)}),l.findAllUsers(c,function(e){c.userlist={},c.userlist=e})}(),c.formReset=function(){c.project={}},c.searchSignList=function(){if(c.signListOptions.dataSource._skip=0,c.signListOptions.dataSource.read(),c.filters=c.project,c.filters&&void 0!=c.filters){var e=JSON.stringify(c.filters);c.filters=e.substring(1,e.length-1)}c.signList=[],c.page=0},c.statistical=function(){},c.excelExport=function(){for(var t=[],i=0;i<c.signList.length;i++)t.push(c.signList[i].signid);var o=t.join(",");e.excelExport(o)},c.ProjectStopInfo=function(e){o.go("projectStopInfo",{signId:e})},c.statistics=function(){t.QueryStatistics(c,function(e){void 0!=e&&e.forEach(function(e,t){c.signList.push(e)}),c.isContinue&&void 0!=e&&0!=e.length&&(c.page++,c.statistics())})},c.QueryStatistics=function(){c.isContinue=!0,c.filters&&void 0!=c.filters||(c.filters=""),c.statistics(),$("#queryStatisticsWindow").kendoWindow({width:"80%",height:"700px",title:"项目查询统计",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"],open:function(){c.countDay=function(){var t=$("#countSignDayTable input[name='sumSignDay']:checked");if(c.averageDay=0,0==t.length)i.alert("请选择要统计的数据");else{for(var o=[],n=t.length,a=0;a<n;a++)o.push(t[a].id);e.sumExistDays(o.join(","),function(e){e.flag||"ok"==e.reCode?(c.averageDay=(Number(e.reObj)/n).toFixed(2),c.isopens=!0,c.isDay=!0):i.alert(e.reMsg)})}},c.countWork=function(){var e=$("#countSignDayTable input[name='sumSignDay']:checked");if(c.averageDay=0,0==e.length)i.alert("请选择要统计的数据");else{for(var t=0,o=e.length,n=0;n<o;n++)t+=Number(e[n].value);c.averageDay=(t/o).toFixed(2),c.isopens=!0,c.isDay=!1}}},close:function(){c.isContinue=!1,c.signList=[],c.page=0}}).data("kendoWindow").center().open()},c.selectHeader=function(){n.selectHeaderWindow(c,c.headerType)},c.signDetails=function(e,n){c.saveView(),t.signDetails(e,function(t){t.flag?o.go("signDetails",{signid:e},{processInstanceId:n}):i.alert(t.reMsg)})}}angular.module("app").controller("adminSignListCtrl",e),e.$inject=["signSvc","adminSvc","bsWin","$state","headerSvc","pauseProjectSvc","$rootScope","$scope","roomCountSvc"]}(),function(){"use strict";function e(e,t,i){function o(e,i){var o={method:"post",url:rootPath+"/signView/findSecretProPermission",params:{signId:e}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:t,httpOptions:o,success:n})}function n(e,t,i){var t=escape(encodeURIComponent(t));window.open(rootPath+"/signView/excelExport?filterData="+i+"&fileName="+t)}function a(e){var i={method:"post",url:rootPath+"/admin/initWelComePage"},o=function(t){void 0!=e&&"function"==typeof e&&e(t.data)};common.http({$http:t,httpOptions:i,success:o})}function r(e){var i={method:"get",url:rootPath+"/workday/countWorkday"},o=function(e){};common.http({vm:e,$http:t,httpOptions:i,success:o})}function s(e){var i={method:"get",url:rootPath+"/file/findByBusinessId",params:{businessId:e.anId}},o=function(t){e.file=t.data};common.http({vm:e,$http:t,httpOptions:i,success:o})}function l(e,t){window.open(rootPath+"/file/fileDownload?sysfileId="+t)}function c(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/flow/html/tasks",$("#searchform"),e.gridParams),schema:{data:"value",total:function(e){return e.count?$("#DO_SIGN_COUNT").html(e.count):$("#DO_SIGN_COUNT").html(0),e.count},model:{id:"id",fields:{createdDate:{type:"date"}}}},serverPaging:!1,serverSorting:!1,serverFiltering:!1,pageSize:e.queryParams.pageSize||10,page:e.queryParams.page||1,sort:{field:"createdDate",dir:"desc"}}),i=[{field:"",title:"",width:30,template:function(e){switch(e.lightState){case"4":return $("#span1").html();case"8":return $("#span5").html();case"7":return $("#span4").html();case"6":return $("#span3").html();case"5":return $("#span2").html();case"1":case"2":case"3":default:return""}}},{field:"",title:"序号",width:50,attributes:{class:"table-cell",style:"text-align: center"},template:"<span class='row-number'></span>"},{field:"",title:"项目名称",filterable:!1,width:200,template:function(e){return d(e)?'<a ng-click="vm.saveView()" href="#/signFlowDetail/'+e.businessKey+"/"+e.taskId+"/"+e.processInstanceId+'" >'+e.projectName+"</a>":'<a ng-click="vm.saveView()" href="#/signFlowDeal/'+e.businessKey+"/"+e.taskId+"/"+e.processInstanceId+'" >'+e.projectName+"</a>"}},{field:"reviewStage",title:"项目阶段",filterable:!1,width:100},{field:"nodeNameValue",title:"当前环节",width:120,filterable:!1},{field:"signDate",title:"签收时间",width:100,filterable:!1,format:"{0: yyyy-MM-dd}"},{field:"allPriUser",title:"项目负责人",width:140,filterable:!1},{field:"",title:"剩余工作日",width:100,filterable:!1,template:function(e){return void 0!=e.surplusDays?e.surplusDays:""}},{field:"displayName",title:"处理人",width:120,filterable:!1},{field:"",title:"状态",width:80,filterable:!1,template:function(e){return e.processState&&2==e.processState?'<span style="color:orange;">已暂停</span>':'<span style="color:green;">进行中</span>'}},{field:"preSignDate",title:"预签收时间",width:100,filterable:!1,format:"{0: yyyy-MM-dd}"},{field:"",title:"合并评审",width:120,filterable:!1,template:function(e){return e.reviewType?9==e.reviewType||"9"==e.reviewType?"合并评审[主项目]":"合并评审[次项目]":"否"}},{field:"",title:"合并项目",width:180,filterable:!1,template:function(e){if(e.reviewSignDtoList){var t="";return angular.forEach(e.reviewSignDtoList,function(e,i,o){i>0&&(t+=","),t+='<a href="#/signDetails/'+e.signid+"/"+e.processInstanceId+'" >'+e.projectname+"</a>"}),t}return""}},{field:"",title:"操作",width:80,template:function(e){return d(e)?common.format($("#detailBtns").html(),"signFlowDetail",e.businessKey,e.taskId,e.processInstanceId):common.format($("#columnBtns").html(),"signFlowDeal",e.businessKey,e.taskId,e.processInstanceId)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,pageable:common.kendoGridConfig(e.queryParams).pageable,dataBound:common.kendoGridConfig(e.queryParams).dataBound}}function d(e){var t=2==e.processState;return t||!e.reviewType||0!=e.reviewType&&"0"!=e.reviewType||"SIGN_BMLD_SPW1"!=e.nodeDefineKey&&"SIGN_FGLD_SPW1"!=e.nodeDefineKey||(t=!0),t}function u(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/flow/html/endTasks"),schema:{data:"value",total:function(e){return e.count},model:{id:"id",fields:{createdDate:{type:"date"}}}},serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{field:"",title:"序号",template:"<span class='row-number'></span>",width:50},{field:"projectname",title:"项目名称",filterable:!1,width:180},{field:"builtcompanyname",title:"建设单位",width:150,filterable:!1},{field:"reviewstage",title:"评审阶段",width:80,filterable:!1},{field:"signdate",title:"签收日期",width:100,filterable:!1,format:"{0: yyyy-MM-dd}"},{field:"reviewdays",title:"评审天数",width:150,filterable:!1},{field:"",title:"操作",width:100,template:function(e){return common.format($("#columnBtns").html(),e.isAppraising,e.signid,"endSignDetail",e.signid,e.processInstanceId,e.mUserName)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,dataBound:function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})}}}function m(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/flow/html/doingtasks",$("#searchform"),e.gridParams),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!1,serverSorting:!1,serverFiltering:!1,pageSize:e.queryParams.pageSize||10,page:e.queryParams.page||1,sort:{field:"createdDate",dir:"desc"}}),i=[{field:"",title:"",width:30,template:function(e){switch(e.lightState){case"4":return $("#span1").html();case"8":return $("#span5").html();case"7":return $("#span4").html();case"6":return $("#span3").html();case"5":return $("#span2").html();case"1":case"2":case"3":default:return""}}},{field:"",title:"序号",width:50,attributes:{style:"text-align: center;"},template:function(e){return e.signprocessState?6==e.signprocessState?"<span class='row-number label-primary' style='width: 100%;display: inline-block;'></span>":7==e.signprocessState?"<span class='row-number label-info' style='width: 100%;display: inline-block;'></span>":8==e.signprocessState?"<span class='row-number label-success' style='width: 100%;display: inline-block;'></span>":"<span class='row-number'></span>":"<span class='row-number'></span>"}},{field:"",title:"项目名称",filterable:!1,width:"18%",template:function(e){return'<a ng-click="vm.saveView()" href="#/signFlowDetail/'+e.businessKey+"/"+e.taskId+"/"+e.processInstanceId+'" >'+e.projectName+"</a>"}},{field:"reviewStage",title:"项目阶段",filterable:!1,width:"10%"},{field:"nodeNameValue",
title:"当前环节",width:"10%",filterable:!1},{field:"preSignDate",title:"预签收时间",width:"10%",filterable:!1,format:"{0: yyyy-MM-dd}"},{field:"signDate",title:"签收时间",width:"10%",filterable:!1,format:"{0: yyyy-MM-dd}"},{field:"",title:"剩余工作日",width:"10%",filterable:!1,template:function(e){return void 0!=e.surplusDays?e.surplusDays:""}},{field:"displayName",title:"处理人",width:"10%",filterable:!1},{field:"",title:"流程状态",width:"10%",filterable:!1,template:function(e){return e.processState&&2==e.processState?'<span style="color:orange;">已暂停</span>':'<span style="color:green;">进行中</span>'}},{field:"",title:"操作",width:"10%",template:function(e){return common.format($("#columnBtns").html(),"signFlowDetail",e.businessKey,e.taskId,e.processInstanceId)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig(e.queryParams).pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,dataBound:common.kendoGridConfig(e.queryParams).dataBound}}function p(e){var t=common.kendoGridDataSource(rootPath+"/signView/getSignList?$orderby=receivedate",$("#searchform"),e.queryParams.page,e.queryParams.pageSize,e.gridParams),i=[{field:"",title:"",width:30,template:function(e){switch(e.lightState){case"4":return $("#span1").html();case"8":return $("#span5").html();case"7":return $("#span4").html();case"6":return $("#span3").html();case"5":return $("#span2").html();case"1":case"2":case"3":default:return""}}},{field:"",title:"序号",width:50,attributes:{style:"text-align: center;"},template:function(e){return e.processState?6==e.processState?"<span class='row-number label-primary' style='width: 100%;display: inline-block;'></span>":7==e.processState?"<span class='row-number label-info' style='width: 100%;display: inline-block;'></span>":8==e.processState?"<span class='row-number label-success' style='width: 100%;display: inline-block;'></span>":"<span class='row-number'></span>":"<span class='row-number'></span>"}},{field:"",title:"项目名称",width:280,filterable:!1,template:function(e){return"秘密"==e.secrectlevel?e.processInstanceId?"<a ng-click=\"vm.signDetails('"+e.signid+"','"+e.processInstanceId+"')\" >"+e.projectname+"</a>":"<a ng-click=\"vm.signDetails('"+e.signid+"' , '')\" >"+e.projectname+"</a>":e.processInstanceId?'<a ng-click="vm.saveView()" href="#/signDetails/'+e.signid+"/"+e.processInstanceId+'" >'+e.projectname+"</a>":'<a ng-click="vm.saveView()" href="#/signDetails/'+e.signid+'/" >'+e.projectname+"</a>"}},{field:"reviewstage",title:"评审阶段",width:110,filterable:!1},{field:"signdate",title:"签收日期",width:100,filterable:!1,format:"{0:yyyy-MM-dd}"},{field:"dispatchDate",title:"发文日期",width:100,filterable:!1,format:"{0:yyyy-MM-dd}"},{field:"reviewdays",title:"评审天数",width:90,filterable:!1},{field:"",title:"剩余工作日",width:100,filterable:!1,template:function(e){return void 0!=e.surplusdays?e.surplusdays:""}},{field:"reviewOrgName",title:"评审部门",width:140,filterable:!1},{field:"allPriUser",title:"项目负责人",width:110,filterable:!1},{field:"ffilenum",title:"归档编号",width:125,filterable:!1},{field:"dfilenum",title:"文件字号",width:130,filterable:!1},{field:"appalyInvestment",title:"申报投资",width:100,filterable:!1},{field:"authorizeValue",title:"审定投资",width:100,filterable:!1},{field:"extraValue",title:"核减（增）",width:100,filterable:!1},{field:"extraRate",title:"核减率",width:100,filterable:!1},{field:"approveValue",title:"批复金额",width:140,filterable:!1},{field:"dispatchType",title:"发文类型",width:100,filterable:!1},{field:"fileDate",title:"归档日期",width:100,filterable:!1,format:"{0:yyyy-MM-dd}"},{field:"builtcompanyname",title:"建设单位",width:260,filterable:!1},{field:"isassistproc",title:"是否协审",width:80,filterable:!1,template:function(e){return 9==e.isassistproc?"是":"否"}},{field:"daysafterdispatch",title:"发文后工作日",width:120,filterable:!1},{field:"",title:"操作",width:90,filterable:!1,template:function(e){return"2"==e.signState?common.format($("#columnBtns").html(),"vm.ProjectStopInfo('"+e.signid+"')"):""}}];e.signListOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig(e.queryParams).pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,dataBound:common.kendoGridConfig(e.queryParams).dataBound}}function f(e){var i={method:"post",url:rootPath+"/sign/initSignList"},o=function(t){void 0!=e&&"function"==typeof e&&e(t.data)};common.http({$http:t,httpOptions:i,success:o})}function h(e){var t=common.kendoGridDataSource(rootPath+"/signView/html/personMainTasks?$orderby=signdate desc",$("#searchform"),e.queryParams.page,e.queryParams.pageSize,e.gridParams),i=[{field:"",title:"",width:30,template:function(e){switch(e.lightState){case"4":return $("#span1").html();case"8":return $("#span5").html();case"7":return $("#span4").html();case"6":return $("#span3").html();case"5":return $("#span2").html();case"1":case"2":case"3":default:return""}}},{field:"",title:"序号",width:50,attributes:{style:"text-align: center;"},template:function(e){return e.processState?6==e.processState?"<span class='row-number label-primary' style='width: 100%;display: inline-block;'></span>":7==e.processState?"<span class='row-number label-info' style='width: 100%;display: inline-block;'></span>":8==e.processState?"<span class='row-number label-success' style='width: 100%;display: inline-block;'></span>":"<span class='row-number'></span>":"<span class='row-number'></span>"}},{field:"",title:"项目名称",width:160,filterable:!1,template:function(e){return e.processInstanceId?'<a ng-click="vm.saveView()" href="#/signDetails/'+e.signid+"/"+e.processInstanceId+'" >'+e.projectname+"</a>":'<a ng-click="vm.saveView()" href="#/signDetails/'+e.signid+'/" >'+e.projectname+"</a>"}},{field:"reviewstage",title:"评审阶段",width:100,filterable:!1},{field:"",title:"项目状态",width:80,filterable:!1,template:function(e){var t="";switch(e.signState){case"1":t="进行中";break;case"2":t="暂停";break;case"8":t="强制结束";break;case"9":t="已完成"}return t}},{field:"",title:"签收时间",width:100,filterable:!1,template:function(e){return e.signdate?new Date(e.signdate.CompatibleDate()).Format("yyyy-MM-dd"):""}},{field:"",title:"发文日期",width:100,filterable:!1,template:function(e){return e.dispatchDate?new Date(e.dispatchDate.CompatibleDate()).Format("yyyy-MM-dd"):""}},{field:"",title:"剩余工作日",width:100,filterable:!1,template:function(e){return void 0!=e.surplusdays?e.surplusdays:""}},{field:"builtcompanyname",title:"建设单位",width:150,filterable:!1},{field:"",title:"操作",width:140,template:function(e){var t=!1,i=!0,o=!1;return"2"==e.signState?t=!0:"1"==e.signState&&(o=!0),9==e.signState&&angular.isUndefined(e.isAppraising)&&(i=!1),common.format($("#columnBtns").html(),"signDetails",e.signid,e.processInstanceId,"vm.pauseProject('"+e.signid+"')",o,"vm.startProject('"+e.signid+"')",t,e.signid,i)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,pageable:common.kendoGridConfig(e.queryParams).pageable,dataBound:common.kendoGridConfig(e.queryParams).dataBound}}function g(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/flow/queryMyAgendaTask",$("#agendaTaskForm")),schema:{data:"value",total:function(e){return e.count?$("#DO_TASK_COUNT").html(e.count):$("#DO_TASK_COUNT").html(0),e.count},model:{id:"taskId"}},serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createTime",dir:"desc"}}),i=[{field:"",title:"序号",template:"<span class='row-number'></span>",width:50},{field:"",title:"任务名称",filterable:!1,width:"25%",template:function(e){return'<a href="#/flowDeal/'+e.businessKey+"/"+e.processKey+"/"+e.taskId+"/"+e.instanceId+'" >'+e.instanceName+"</a>"}},{field:"nodeNameValue",title:"当前环节",width:"15%",filterable:!1},{field:"displayName",title:"处理人",width:"15%",filterable:!1},{field:"processName",title:"流程类别",width:"15%",filterable:!1},{field:"",title:"流程状态",width:"10%",filterable:!1,template:function(e){return e.processState&&2==e.processState?'<span style="color:orange;">已暂停</span>':'<span style="color:green;">进行中</span>'}},{field:"",title:"操作",width:"15%",template:function(e){return common.format($("#columnBtns").html(),e.businessKey,e.processKey,e.taskId,e.instanceId)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,dataBound:function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})}}}function v(e){var t=common.kendoGridDataSource(rootPath+"/flow/queryAgendaTask?$orderby=createTime desc",$("#doingTaskForm"),e.queryParams.page,e.queryParams.pageSize,e.gridParams),i=[{field:"",title:"序号",template:"<span class='row-number'></span>",width:50},{field:"",title:"任务名称",filterable:!1,width:"30%",template:function(e){return'<a ng-click="vm.saveView()" href="#/flowDetail/'+e.businessKey+"/"+e.processKey+"/"+e.taskId+"/"+e.instanceId+'" >'+e.instanceName+"</a>"}},{field:"nodeNameValue",title:"当前环节",width:"20%",filterable:!1},{field:"displayName",title:"处理人",width:"15%",filterable:!1},{field:"processName",title:"流程类别",width:"25%",filterable:!1},{field:"",title:"流程状态",width:"10%",filterable:!1,template:function(e){return e.processState&&2==e.processState?'<span style="color:orange;">已暂停</span>':'<span style="color:green;">进行中</span>'}},{field:"",title:"操作",width:"10%",template:function(e){return common.format($("#columnBtns").html(),e.businessKey,e.processKey,e.taskId,e.instanceId)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,pageable:common.kendoGridConfig(e.queryParams).pageable,dataBound:common.kendoGridConfig(e.queryParams).dataBound}}function y(e){e.dataSource=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/signView/getSignList",$("#searchform")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!1,serverSorting:!0,serverFiltering:!0,sort:{field:"createdDate",dir:"desc"}})}function w(e){var i={method:"get",url:rootPath+"/flow/proc"},o=function(t){e.workName=t.data};common.http({vm:e,$http:t,httpOptions:i,success:o})}function b(e,i){var o={method:"post",url:rootPath+"/signView/QueryStatistics",params:{queryData:e.filters,page:e.page}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({vm:e,$http:t,httpOptions:o,success:n})}return{gtasksGrid:c,etasksGrid:u,dtasksGrid:m,doingTaskGrid:v,personMainTasksGrid:h,countWorakday:r,agendaTaskGrid:g,initFile:s,upload:l,getSignList:p,initSignList:f,initWelComePage:a,excelExport:n,statisticalGrid:y,workName:w,QueryStatistics:b,signDetails:o}}angular.module("app").factory("adminSvc",e),e.$inject=["$rootScope","$http","bsWin"]}(),function(){"use strict";function e(e,t,i){var o=this;o.title="主页",o.isdisplays=!1,o.initHistogram=function(){var e=echarts.init(document.getElementById("histogram")),t={title:{text:"在办项目数量统计情况",subtext:"",x:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#283b56"}}},legend:{orient:"vertical",left:"left",data:o.capital},grid:{left:"13%",right:"10%",bottom:"10%",containLabel:!0},xAxis:{type:"category",name:"人员/部门",data:o.review,axisTick:{alignWithLabel:!0},axisLabel:{interval:0,rotate:35,margin:2,textStyle:{fontWeight:"bolder",color:"#295645"}}},yAxis:{type:"value",name:"数量",min:0},series:[{name:"数量",type:"bar",data:o.signNumber}],itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0,0,0,0.5)"}}};e.setOption(t)},o.initLineChart=function(){var e=echarts.init(document.getElementById("lineChart")),t={title:{text:"项目办理情况",subtext:"",x:"center"},tooltip:{trigger:"axis",formatter:function(e){var i=t.series[e[0].seriesIndex].rawdate[e[0].dataIndex].split(",");return"项目名称："+e[0].name+"<br/>剩余工作日:"+i[0]}},grid:{left:"13%",right:"10%",bottom:"10%",containLabel:!0},xAxis:{show:!1,type:"category",boundaryGap:!1,name:"项目名称",axisLine:{onZero:!1},data:o.reviewdate},yAxis:{type:"value",name:"剩余工作日",min:-3,max:15},series:[{name:"剩余工作日",type:"line",markPoint:{data:[{type:"max",name:"最大值"},{type:"min",name:"最小值"}]},markLine:{data:[{type:"average",name:"平均值"}]},data:o.linedatas,rawdate:o.name}],lineStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0,0,0,0.5)"}}};e.setOption(t),e.on("click",function(e){var o=t.series[e.seriesIndex].rawdate[e.dataIndex].split(",");i.go("signDetails",{signid:o[1],processInstanceId:o[2]})})},function(){t.initWelComePage(function(e){if(e&&(e.proTaskList&&(o.tasksList=e.proTaskList),e.comTaskList&&(o.agendaTaskList=e.comTaskList),e.endTaskList&&(o.endTasksList=e.endTaskList),e.annountmentList&&(o.annountmentList=e.annountmentList),o.isdisplays=e.isdisplay,!e.isdisplay)){if(o.linedatas=[],o.reviewdate=[],o.name=[],e.lineSign)for(var t=e.lineSign,i=0,n=t.length;i<n;i++){var a=t[i].surplusDays;a<-3&&(a=-3),a>15&&(a=15),o.linedatas.push(a),o.reviewdate.push(t[i].projectName),o.name.push(t[i].surplusDays+","+t[i].businessKey+","+t[i].processInstanceId)}o.initLineChart(),o.review=e.histogram_x,o.signNumber=e.histogram_y,o.initHistogram()}})}()}angular.module("app").controller("adminWelComeCtrl",e).filter("FormatStrDate",function(){return function(e){var t=new Date(e),i=t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1,o=t.getDate()<10?"0"+t.getDate():t.getDate();return t.getFullYear()+"/"+i+"/"+o}}),e.$inject=["bsWin","adminSvc","$state"]}(),function(){"use strict";function e(e,t,i,o,n,a){var r=this;r.title="通知公告管理",r.stateName=t.current.name,r.queryParams={},r.saveView=function(){a.storeView(r.stateName,{gridParams:r.gridOptions.dataSource.transport.options.read.data(),queryParams:r.queryParams,data:r})},function(){if(a.view[r.stateName]){var e=a.view[r.stateName];e.gridParams&&(r.gridParams=e.gridParams),e.data&&(r.model=e.data.model),e.queryParams&&(r.queryParams=e.queryParams),o.grid(r),a.view[r.stateName]=void 0}else o.grid(r)}(),r.bathIssue=function(){o.updateIssueState(r,"9")},r.bathUnissue=function(){o.updateIssueState(r,"0")},r.del=function(e){i.confirm({title:"询问提示",message:"确认删除数据吗?",onOk:function(){o.deleteAnnountment(e,function(e){e.flag||"ok"==e.reCode?(r.gridOptions.dataSource.read(),i.alert("操作成功！")):i.alert(e.reMsg)})}})},r.dels=function(){var e=common.getKendoCheckId(".grid");0==e.length?i.alert("请选择要删除的记录"):i.confirm({title:"询问提示",message:"确认删除数据吗?",onOk:function(){for(var t=[],n=0;n<e.length;n++)t.push(e[n].value);var a=t.join(",");o.deleteAnnountment(a,function(e){e.flag||"ok"==e.reCode?i.alert("操作成功！",function(){r.gridOptions.dataSource.read()}):i.alert(e.reMsg)})}})},r.detail=function(e){e&&(r.saveView(),t.go("annountmentDetail",{id:e}))},r.queryAnnountment=function(){r.gridOptions.dataSource._skip="",r.gridOptions.dataSource.read()},r.resetAnnountment=function(){var e=$("#annountmentform").find("input,select");$.each(e,function(e,t){t.value=""})}}angular.module("app").controller("annountmentCtrl",e),e.$inject=["$location","$state","bsWin","annountmentSvc","sysfileSvc","$rootScope"]}(),function(){"use strict";function e(e,t,i){var o=this;o.title="通知公告详情页",o.annountment={},o.annountment.anId=t.params.id,function(){i.findDetailById(o,o.annountment.anId)}(),o.post=function(e){i.findDetailById(o,e)},o.next=function(e){i.findDetailById(o,e)},o.downloadSysFile=function(t){e.downloadFile(t)},o.alertwd=function(){$("section").addClass("cont-alert")},o.closed=function(){$("section").removeClass("cont-alert")},o.printNotice=function(){var e=getLodop(),t=rootPath+"/contents/shared/annountmentPrint.css",i="<link href="+t+" type='text/css' rel='stylesheet'>",o="<head>"+i+"</head><body>"+$("#annountment-body").html()+"</body>";e.PRINT_INIT(""),e.ADD_PRINT_HTML(10,20,"100%","100%",o),e.PREVIEW()}}angular.module("app").controller("annountmentDetailCtrl",e),e.$inject=["sysfileSvc","$state","annountmentSvc"]}(),function(){"use strict";function e(e,t,i,o,n){var a=this;a.title="通知公告编辑",a.annountment={},a.annountment.anId=e.params.id,a.editor=void 0,a.businessFlag={isInitFileOption:!1},a.initFileUpload=function(){a.annountment.anId||o.$watch("vm.annountment.anId",function(e,t){e&&e!=t&&!a.initUploadOptionSuccess&&a.initFileUpload()}),a.sysFile={businessId:a.annountment.anId,mainId:a.annountment.anId,mainType:"通知公告",sysBusiType:"",showBusiType:!1},i.initUploadOptions({inputId:"sysfileinput",vm:a,uploadSuccess:function(){i.findByBusinessId(a.annountment.anId,function(e){a.sysFilelists=e})}})},function(){a.isNeed="1",a.editor=new UE.ui.Editor,a.editor.render("editor"),a.annountment.anId?(a.isUpdate=!0,t.findAnnountmentById(a,function(e){a.annountment=e,a.initFileUpload(),a.editor.ready(function(){void 0!=a.annountment.anContent&&a.editor.setContent(a.annountment.anContent)})}),i.findByBusinessId(a.annountment.anId,function(e){a.sysFilelists=e})):a.initFileUpload()}(),a.create=function(){t.createAnnountment(a,function(t){t.flag||"ok"==t.reCode?n.alert("保存成功！",function(){e.go("annountmentEdit",{id:t.reObj.anId},{reload:!0})}):n.alert(t.reMsg)})},a.update=function(){t.updateAnnountment(a,function(e){a.isSubmit=!1,n.alert("操作成功！")})},a.startNewFlow=function(){n.confirm({title:"询问提示",message:"确认已经完成填写，并且发起流程么？",onOk:function(){a.annountment.anId?t.updateAnnountment(a,function(i){t.startFlow(a.annountment.anId,function(t){t.flag||"ok"==t.reCode?n.success("操作成功！",function(){e.go("annountment")}):n.error(t.reMsg)})}):t.createAnnountment(a,function(i){a.id=i.reObj.anId,t.startFlow(a.id,function(t){t.flag||"ok"==t.reCode?n.success("操作成功！",function(){e.go("annountment")}):n.error(t.reMsg)})})}})}}angular.module("app").controller("annountmentEditCtrl",e),e.$inject=["$state","annountmentSvc","sysfileSvc","$scope","bsWin"]}(),function(){"use strict";function e(e,t,i){function o(t){var i={method:"get",url:h+"/initAnOrg"},o=function(e){t.annountment.anOrg="",t.annountment.anOrg=e.data.substring(1,e.data.length-1)};common.http({vm:t,$http:e,httpOptions:i,success:o})}function n(t,i){var o={method:"post",url:h+"/findAnnountmentById",params:{anId:t.annountment.anId}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function a(t,i){if(t.annountment.anContent=t.editor.getContent(),common.initJqValidation(),$("#form").valid()){t.isSubmit=!0;var o={method:"post",url:rootPath+"/annountment",data:t.annountment},n=function(e){t.isSubmit=!1,void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n,onError:function(){t.isSubmit=!1}})}}function r(t,i){t.isSubmit=!0,t.annountment.anContent=t.editor.getContent();var o={method:"put",url:h,data:t.annountment},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n,onError:function(){t.isSubmit=!1}})}function s(t,i){var o={method:"delete",url:h,params:{anId:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function l(e){var t=common.kendoGridDataSource(rootPath+"/annountment/fingByCurUser",$("#annountmentform"),e.queryParams.page,e.queryParams.pageSize,e.gridParams),i=[{template:function(e){return e.processInstanceId?"":kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.anId)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"unitSort",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"anTitle",title:"标题",width:300,filterable:!1},{field:"",title:"是否审批",width:100,filterable:!1,template:function(e){return e.processInstanceId?"是":"否"}},{field:"",title:"审批结果",width:100,filterable:!1,template:function(e){return e.appoveStatus?"9"!=e.appoveStatus?"审批中":"9"==e.appoveStatus&&"9"==e.issue?"<span style='color: green'>审批通过</span>":"9"==e.appoveStatus&&"9"!=e.issue?"<span style='color: red'>审批不通过</span>":void 0:""}},{field:"issueDate",title:"发布时间",format:"{0:yyyy-MM-dd hh24:mm:ss}",width:160,filterable:!1},{field:"",title:"发布状态",width:100,template:function(e){return e.issue&&"9"==e.issue?"已发布":"未发布"}},{field:"",title:"操作",width:150,template:function(e){var t=!0,i=!0;return("9"==e.issue||e.processInstanceId)&&(t="0"==e.issue&&"9"==e.appoveStatus),e.processInstanceId&&(i="0"==e.issue&&"9"==e.appoveStatus),common.format($("#columnBtns").html(),"vm.detail('"+e.anId+"')",e.anId,i,"vm.del('"+e.anId+"')",t)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,pageable:common.kendoGridConfig(e.queryParams).pageable,dataBound:common.kendoGridConfig(e.queryParams).dataBound,columns:i,resizable:!0}}function c(i,o){var n=common.getKendoCheckId(".grid");if(0==n.length)t.alert("请选择要修改的数据");else{for(var a=[],r=0;r<n.length;r++)a.push(n[r].value);var s={method:"post",url:rootPath+"/annountment/updateIssueState",params:{ids:a.join(","),issueState:o}},l=function(e){i.isSubmit=!1,e.data.flag||"ok"==e.data.reCode?t.alert("操作成功！",function(){i.gridOptions.dataSource.read()}):t.alert(e.data.reMsg)};common.http({$http:e,httpOptions:s,success:l})}}function d(t,o){var n={method:"post",url:h+"/findAnnountmentById",params:{anId:o}},a=function(e){t.annountment=e.data,i.findByBusinessId(o,function(e){t.sysFilelists=e}),u(t,o),m(t,o)};common.http({vm:t,$http:e,httpOptions:n,success:a})}function u(t,i){var o={method:"get",url:rootPath+"/annountment/postArticle",params:{anId:i}},n=function(e){t.annountmentPost=e.data};common.http({vm:t,$http:e,httpOptions:o,success:n})}function m(t,i){var o={method:"get",url:rootPath+"/annountment/nextArticle",params:{anId:i}},n=function(e){t.annountmentNext=e.data};common.http({vm:t,$http:e,httpOptions:o,success:n})}function p(t,i){var o={method:"post",url:rootPath+"/annountment/startFlow",params:{id:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function f(e){e.annountment={},e.annountment.anId=e.businessKey,n(e,function(t){e.suppletter=t})}var h=rootPath+"/annountment";return{grid:l,createAnnountment:a,initAnOrg:o,findAnnountmentById:n,updateIssueState:c,updateAnnountment:r,deleteAnnountment:s,findDetailById:d,postArticle:u,nextArticle:m,startFlow:p,initFlowDeal:f}}angular.module("app").factory("annountmentSvc",e),e.$inject=["$http","bsWin","sysfileSvc"]}(),function(){"use strict";function e(e,t,i,o,n){var a=this;a.title="通知公告列表",a.stateName=t.current.name,a.queryParams={},a.saveView=function(){n.storeView(a.stateName,{gridParams:a.gridOptions.dataSource.transport.options.read.data(),queryParams:a.queryParams,data:a})},function(){if(n.view[a.stateName]){var e=n.view[a.stateName];e.gridParams&&(a.gridParams=e.gridParams),e.data&&(a.model=e.data.model),e.queryParams&&(a.queryParams=e.queryParams),o.grid(a),n.view[a.stateName]=void 0}else o.grid(a)}(),a.detail=function(e){e&&(a.saveView(),t.go("annountmentDetail",{id:e}))},a.findAnnountment=function(){a.gridOptions.dataSource._skip=0,a.gridOptions.dataSource.read()},a.resetAnnountment=function(){var e=$("#annountmentYetform").find("input,select");$.each(e,function(e,t){t.value=""})}}angular.module("app").controller("annountmentYetCtrl",e),e.$inject=["$location","$state","$http","annountmentYetSvc","$rootScope"]}(),function(){"use strict";function e(e){function t(e){var t=common.kendoGridDataSource(rootPath+"/annountment/findByIssue",$("#annountmentYetform"),e.queryParams.page,e.queryParams.pageSize,e.gridParams),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.anId)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"unitSort",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"anTitle",title:"标题",width:300,filterable:!1},{field:"issueDate",title:"发布时间",format:"{0:yyyy-MM-dd hh24:mm:ss}",width:160,filterable:!1},{field:"issueUser",title:"发布人",width:100,filterable:!1},{field:"",title:"操作",width:150,template:function(e){return common.format($("#columnBtns").html(),"vm.detail('"+e.anId+"')")}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,pageable:common.kendoGridConfig(e.queryParams).pageable,dataBound:common.kendoGridConfig(e.queryParams).dataBound,columns:i,resizable:!0}}return{grid:t}}angular.module("app").factory("annountmentYetSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,i){var o=this;o.model={},o.title="项目档案借阅管理",o.id=i.params.id,function(){i.params.id&&e.initArchivesLibrary(i.params.id,function(e){o.model=e})}(),o.createLibrary=function(){common.initJqValidation(),$("form").valid()&&e.createArchivesLibrary(o.model,function(e){e.flag||"ok"==e.reCode?(o.model=e.reObj,t.alert("操作成功！")):t.error(e.reMsg)})},o.startFlow=function(){common.initJqValidation(),$("form").valid()&&e.createArchivesLibrary(o.model,function(n){n.flag||"ok"==n.reCode?(o.model=n.reObj,e.startFlow(o.model.id,function(e){e.flag||"ok"==e.reCode?t.alert("操作成功！",function(){i.go("archivesLibraryList")}):t.error(e.reMsg)})):t.error(n.reMsg)})},o.del=function(t){common.confirm({vm:o,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),e.deleteArchivesLibrary(o,t)}})},o.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:o,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var n=t.join(",");o.del(n)}}}angular.module("app").controller("archivesLibraryCtrl",e),e.$inject=["archivesLibrarySvc","bsWin","$state"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.title="档案借阅管理",function(){t.grid(n)}(),n.search=function(){n.gridOptions.dataSource._skip=0,n.gridOptions.dataSource.read()},n.formReset=function(){$("#searchform")[0].reset()}}angular.module("app").controller("archivesLibraryListCtrl",e),e.$inject=["$location","archivesLibrarySvc","$state","bsWin"]}(),function(){"use strict";function e(e,t){function i(t,i){var o={method:"post",url:rootPath+"/archivesLibrary/findById",params:{id:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function o(t,i){var o={method:"post",url:rootPath+"/archivesLibrary/startFlow",params:{id:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function n(e){i(e.businessKey,function(t){e.model=t})}function a(t){var i={method:"get",url:rootPath+"/archivesLibrary/findByArchivesUser"},o=function(e){t.userlist=e.data};common.http({vm:t,$http:e,httpOptions:i,success:o})}function r(t,i){var o={method:"post",url:d+"/saveCity",data:t},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function s(t,i){t.isSubmit=!0;var o={method:"delete",url:d,data:i},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})}})};common.http({vm:t,$http:e,httpOptions:o,success:n})}function l(t,i){var o={method:"post",url:d+"/savaLibrary",data:t},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function c(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/archivesLibrary/findByOData",$("#searchform")),schema:{data:"value",total:function(e){return e.count},model:{id:"id",fields:{createdDate:{type:"date"},modifiedDate:{type:"date"}}}},serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"readCompany",title:"项目单位",width:140,filterable:!1},{field:"readProjectName",title:"查阅项目",width:140,filterable:!1},{field:"readUsername",title:"借阅人",width:100,filterable:!1},{field:"readArchivesCode",title:"归档编号",width:100,filterable:!1},{field:"readDate",title:"借阅时间",width:100,filterable:!1},{field:"",title:"操作",width:100,template:function(e){return common.format($("#columnBtns").html(),"archivesLibraryView/"+e.id)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})},resizable:!0}}var d=rootPath+"/archivesLibrary";return{initArchivesLibrary:i,startFlow:o,initFlowDeal:n,grid:c,createArchivesLibrary:l,createCityLibrary:r,getArchivesUserName:a,deleteArchivesLibrary:s}}angular.module("app").factory("archivesLibrarySvc",e),e.$inject=["$http","bsWin"]}(),function(){"use strict";function e(e,t,i){var o=this;o.model={},o.title="项目档案借阅查看详情",o.id=i.params.id,function(){o.id&&e.initArchivesLibrary(o.id,function(e){o.model=e})}()}angular.module("app").controller("archivesLibraryViewCtrl",e),e.$inject=["archivesLibrarySvc","bsWin","$state"]}(),function(){"use strict";function e(e,t,i,o,n,a){var r=this;r.model={},r.filterModel={},r.filterLow={},r.title="协审计划管理",r.splitNumArr=[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],r.plan={},r.plan.assistType="独立项目",r.planList=[],r.assistSign=[],r.pickSign=[],r.pickMainSign=[],r.lowerSign=[],r.showPlanId="",r.assistPlan={};var s=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"];r.refleshPageInfo=function(e){r.assistSign=[],i.initPlanPage(e,function(e){r.assistSign=e.signList,r.refleshPlanInfo(r.plan.id)})},r.refleshPlanInfo=function(e){i.findPlanSign(e,!1,r.isCommit,function(e){r.pickMainSign=[],r.lowerSign=[],r.plan=e.planDto,"合并项目"==r.plan.assistType?angular.forEach(r.plan.assistPlanSignDtoList,function(t,i){"9"!=t.isMain&&9!=t.isMain||angular.forEach(e.signList,function(e,i){t.signId==e.signid?r.pickMainSign.push(e):r.lowerSign.push(e)})}):r.pickMainSign=e.signList})},function(){i.initPlanPage(!1,function(e){e.signList&&e.signList.length>0&&(r.assistSign=e.signList),e.planList&&e.planList.length>0&&(r.planList=e.planList)}),i.initPlanGrid(r),$("#planInfo li").click(function(e){var t=$("a",this);e.preventDefault(),t.tab("show");var i=t.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500)})}(),r.filterSign=function(e){var t=!0;if(!angular.isUndefined(e)&&(angular.isUndefined(r.filterModel.filterFilecode)||(e.projectcode?-1==e.filecode.indexOf(r.filterModel.filterFilecode)&&(t=!1):t=!1),t&&(angular.isUndefined(r.filterModel.filterProjectCode)||(e.projectcode?-1==e.projectcode.indexOf(r.filterModel.filterProjectCode)&&(t=!1):t=!1)),t&&(angular.isUndefined(r.filterModel.filterProjectName)||(e.projectname?-1==e.projectname.indexOf(r.filterModel.filterProjectName)&&(t=!1):t=!1)),t&&(angular.isUndefined(r.filterModel.filterBuiltName)||(angular.isUndefined(e.builtcompanyName)&&(t=!1),t&&-1==e.builtcompanyName.indexOf(r.filterModel.filterBuiltName)&&(t=!1))),t))return e},r.filterLowSign=function(e){var t=!0;if(!angular.isUndefined(e)&&(angular.isUndefined(r.filterLow.filterFilecode)||(e.filecode?-1==e.filecode.indexOf(r.filterLow.filterFilecode)&&(t=!1):t=!1),t&&(angular.isUndefined(r.filterLow.filterProjectCode)||(e.projectcode?-1==e.projectcode.indexOf(r.filterLow.filterProjectCode)&&(t=!1):t=!1)),
t&&(angular.isUndefined(r.filterLow.filterProjectName)||(e.projectname?-1==e.projectname.indexOf(r.filterLow.filterProjectName)&&(t=!1):t=!1)),t&&(angular.isUndefined(r.filterLow.filterBuiltName)||(angular.isUndefined(e.builtcompanyName)&&(t=!1),t&&-1==e.builtcompanyName.indexOf(r.filterLow.filterBuiltName)&&(t=!1))),t))return e},r.initSplit=function(e){r.plan.assistType==e&&(angular.isUndefined(r.plan.spliNum)||(r.plan.spliNum=0))},r.affirmSign=function(){var e=$("input[name='selASTSign']:checked");if(e.length<1)n.alert("请选择要挑选的项目");else if(e.length>1)"合并项目"==r.plan.assistType?n.alert("合并项目要先挑选一个主项目，再挑选次项目！"):n.alert("独立项目，每次只能选择一个！");else{var t=e[0].value;r.plan.signId=t,i.saveAssistPlan(r.plan,r.isCommit,function(e){r.isCommit=!1,e.flag||"ok"==date.reCode?(r.plan.id||r.gridOptions.dataSource.read(),r.plan=e.reObj,i.initPlanPage(!0,function(e){e.signList&&e.signList.length>0&&(r.assistSign=e.signList)}),r.planList.push(r.plan),r.showPickLowSign(r.plan.id)):n.alert(e.reMsg)})}},r.cancelSign=function(){var e=$("input[name='checkASTSign']:checked");e.length<1?n.alert("请选择取消的项目"):n.confirm({title:"询问提示",message:"确认取消挑选项目吗?",onOk:function(){for(var t=[],o=0;o<e.length;o++)t.push(e[o].value);i.cancelPlanSign(r,t.join(","),function(e){r.isCommit=!1,r.refleshPageInfo(!0),n.alert("操作成功！")})}})},r.initSelPlan=function(){r.pickMainSign=[],r.lowerSign=[],r.showPlanId?i.findPlanSign(r.showPlanId,!1,r.isCommit,function(e){r.plan=e.planDto,r.refleshPlanInfo(r.showPlanId)}):r.plan={}},r.doDelete=function(){r.plan.id?n.confirm({title:"询问提示",message:"确认删除吗？删除数据不可恢复，请慎重！",onOk:function(){i.deletePlan(r.plan.id,r.isCommit,function(e){r.planList=[],i.initPlanPage(!1,function(e){e.signList&&e.signList.length>0&&(r.assistSign=e.signList),e.planList&&e.planList.length>0&&(r.planList=e.planList)}),r.isCommit=!1,r.pickMainSign=[],r.lowerSign=[],r.plan={},r.gridOptions.dataSource.read(),n.alert("操作成功！")})}}):n.alert("请选择要删除的协审计划包")},r.showPickLowSign=function(e){i.findPlanSign(e,!1,r.isCommit,function(e){r.pickMainSign=[],r.lowerSign=[],r.plan=e.planDto,"合并项目"==r.plan.assistType?(angular.forEach(r.plan.assistPlanSignDtoList,function(t,i){"9"!=t.isMain&&9!=t.isMain||angular.forEach(e.signList,function(e,i){t.signId==e.signid?r.pickMainSign.push(e):r.lowerSign.push(e)})}),$("#lowerSignWin").kendoWindow({width:"1024px",height:"600px",title:"次项目信息",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()):r.pickMainSign=e.signList})},r.affirmLowerSign=function(){var e=$("input[name='selLowSign']:checked");if(e.length<1)n.alert("请选择要挑选的次项目!");else{for(var t=[],o=0;o<e.length;o++)t.push(e[o].value);i.saveLowPlanSign(r,t,function(e){r.isCommit=!1,n.alert("操作成功！"),r.refleshPageInfo(!0)})}},r.cancelLowerSign=function(){var e=$("input[name='checkLowSign']:checked");if(e.length<1)n.alert("请选择要挑选的次项目");else{for(var t=[],o=0;o<e.length;o++)t.push(e[o].value);i.cancelLowPlanSign(r,t.join(","),function(){r.isCommit=!1,n.alert("操作成功！"),r.refleshPageInfo(!0)})}},r.queryPlan=function(){i.queryPlan(r)},r.showPlanDetail=function(e){r.assistPlan={},r.unitList=[],r.assistPlanSign=[],i.initPlanByPlanId(e,function(t){r.assistPlan=t,i.findPlanSign(e,!0,r.isCommit,function(e){e.signList&&e.signList.length>0&&angular.forEach(r.assistPlan.assistPlanSignDtoList,function(t,i){angular.forEach(e.signList,function(e,i){e.signid==t.signId&&(t.projectName=e.projectname,t.estimateCost=e.declaration)})}),$("#planInfo").kendoWindow({width:"80%",height:"600px",title:"协审项目清单",visible:!1,modal:!0,open:function(){r.drawTimeDay="",r.drawTimeStart="",r.drawTimeEnd=""},closable:!0,actions:["Minimize","Maximize","Close"]}).data("kendoWindow").center().open()})})},r.ministerOpinionEdit=function(e){angular.isObject(e)||(e={}),a.initIdeaData(r,e)},r.viceDirectorOpinionEdit=function(e){angular.isObject(e)||(e={}),a.initIdeaData(r,e)},r.directorOpinionEdit=function(e){angular.isObject(e)||(e={}),a.initIdeaData(r,e)},r.savePlanSign=function(){r.assistPlan.ministerOpinion=$("#ministerOpinion").val(),r.assistPlan.viceDirectorOpinion=$("#viceDirectorOpinion").val(),r.assistPlan.directorOpinion=$("#directorOpinion").val();var e=angular.copy(r.assistPlan);i.savePlan(e,function(e){e.flag||"ok"==e.reCode?n.alert("操作成功！"):n.alert(e.reMsg)})},r.chooseAssistUnit=function(){r.number=void 0==r.assistPlan.assistPlanSignDtoList?0:r.assistPlan.assistPlanSignDtoList.length,"1"==r.assistPlan.drawType&&(r.number=r.number+1),i.chooseAssistUnit(r.assistPlan.id,r.number,r.assistPlan.drawType,function(e){console.log(e),e.flag||"ok"==e.reCode?r.assistPlan.assistUnitDtoList=e.reObj:n.alert(e.reMsg)})},r.againChooleAssistUnit=function(){r.allUnitList&&0!=r.allUnitList.length?$("#againChooleAssistUnit").kendoWindow({title:"选择参加协审单位",width:"820px",height:"560px",visible:!1,modal:!0,closable:!0,actions:["Minimize","Maximize","Close"]}).data("kendoWindow").center().open():i.getAllUnit(function(e){r.allUnitList=e,$("#againChooleAssistUnit").kendoWindow({title:"选择参加协审单位",width:"820px",height:"560px",visible:!1,modal:!0,closable:!0,actions:["Minimize","Maximize","Close"]}).data("kendoWindow").center().open()})},r.saveAddChooleUnit=function(e){var t=r.assistPlan.assistPlanSignDtoList.length;"1"==r.assistPlan.drawType&&(t+=1),r.assistPlan.assistUnitDtoList.length<t?i.saveAddChooleUnit(r,e,function(e){e.flag||"ok"==e.reCode?(r.assistPlan.assistUnitDtoList.push(e.reObj),n.alert("操作成功！")):n.alert(e.reMsg)}):n.alert("当前只能"+t+"家单位参与抽签")},r.drawAssistUnit=function(){var e=0;if(r.assistPlan.assistPlanSignDtoList&&r.assistPlan.assistPlanSignDtoList.length>0)if(e=r.assistPlan.assistPlanSignDtoList.length,angular.forEach(r.assistPlan.assistPlanSignDtoList,function(e,t){e.assistUnit=null}),r.assistPlan.assistUnitDtoList&&0!=r.assistPlan.assistUnitDtoList.length){var t=r.assistPlan.assistUnitDtoList.length;if(r.drawAssistUnits=angular.copy(r.assistPlan.assistUnitDtoList),"1"==r.assistPlan.drawType?t>e:t>=e){for(var i=0,a=-1,s=0;s<t;s++)if("9"==r.assistPlan.assistUnitDtoList[s].isLastUnSelected){var l=Math.floor(Math.random()*t);a=l,r.assistPlan.assistPlanSignDtoList[l].assistUnit=r.drawAssistUnits[s],r.drawPlanSign=r.assistPlan.assistPlanSignDtoList[l],r.drawAssistUnits.splice(s,1)}var c=0;r.isStartDraw=!0,r.isDrawDone=!1,r.t=o(function(){r.drawPlanSign=r.assistPlan.assistPlanSignDtoList[i];var n=Math.floor(Math.random()*t),s=r.drawAssistUnits[n];r.showAssitUnitName=s.unitName,++c%5==0&&(i!=a?r.assistPlan.assistPlanSignDtoList[i].assistUnit=s:i!=e-1&&(r.assistPlan.assistPlanSignDtoList[++i].assistUnit=s),i++,i==a&&a==e-1&&(o.cancel(r.t),r.isDrawDone=!0),i==e&&(o.cancel(r.t),r.isDrawDone=!0),r.drawAssistUnits.forEach(function(e,t){e.id==s.id&&r.drawAssistUnits.splice(t,1)}))},200)}else n.alert("当前协审单位少于协审项目数，不能抽签！请先到项目计划表中选择参加的协审单位后再进行抽签！")}else n.alert("还没有设置协审单位，无法进行抽签！");else n.alert("没有协审项目，不能进行抽签！")},r.saveDrawAssistUnit=function(){i.saveDrawAssistUnit(r,function(e){e.flag||"ok"==e.reCode?n.alert("操作成功"):n.alert(e.reMsg)})},r.buildDrawTime=function(){var e=!1,t=!1,i=new Date(r.drawTimeDay),o=i.getDay(),n=i.Format("yyyy年MM月dd日")+"("+s[o]+")";if(r.drawTimeStart){e=!0;var a=r.drawTimeStart.split(":")[0];a>12?n+="下午":(t=!0,n+="上午"),n+=r.drawTimeStart}if(r.drawTimeEnd){var a=r.drawTimeEnd.split(":")[0];e&&(n+="至"),a>12?!t&&e||(n+="下午"):t&&e||(n+="上午"),n+=r.drawTimeEnd}r.assistPlan.drawTime=n},r.buildApprovalTime=function(){var e=!1,t=!1,i=new Date(r.approvalTimeDay),o=i.getDay(),n=i.Format("yyyy年MM月dd日")+"("+s[o]+")";if(r.approvalStart){e=!0;var a=r.approvalStart.split(":")[0];a>12?n+="下午":(t=!0,n+="上午"),n+=r.approvalStart}if(r.approvalTimeEnd){var a=r.approvalTimeEnd.split(":")[0];e&&(n+="至"),a>12?!t&&e||(n+="下午"):t&&e||(n+="上午"),n+=r.approvalTimeEnd}r.assistPlan.approvalTime=n}}angular.module("app").controller("assistPlanCtrl",e),e.$inject=["$location","$state","assistSvc","$interval","bsWin","ideaSvc"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.title="协审单位",n.model={},n.resource={},n.stateName=i.current.name,n.queryParams={},n.saveView=function(){o.storeView(n.stateName,{gridParams:n.gridOptions.dataSource.transport.options.read.data(),queryParams:n.queryParams,data:n})},function(){if(o.view[n.stateName]){var e=o.view[n.stateName];e.gridParams&&(n.gridParams=e.gridParams),e.data&&(n.model=e.data.model),e.queryParams&&(n.queryParams=e.queryParams),t.grid(n),o.view[n.stateName]=void 0}else t.grid(n)}(),n.del=function(e){n.id=e,common.confirm({vm:n,title:"",msg:"确认要删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),n.resource={},t.deleteAssistUnit(n,e)}})},n.dels=function(){var e=common.getKendoCheckId(".grid");0==e.length?common.alert({vm:n,msg:"请选择数据"}):common.confirm({vm:n,title:"",msg:"确认要删除数据吗？",fn:function(){$(".confirmDialog").modal("hide");for(var i=[],o=0;o<e.length;o++)i.push(e[o].value);var a=i.join(",");t.deleteAssistUnit(n,a)}})},n.queryAssistUnit=function(){t.queryAssistUnit(n)}}angular.module("app").controller("assistUnitCtrl",e),e.$inject=["$location","assistUnitSvc","$state","$rootScope"]}(),function(){"use strict";function e(e,t,i){function o(t){if(common.initJqValidation(),$("form").valid()&&0==t.isUnitExist){var i={method:"post",url:c,data:t.assistUnit},o=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=d}})}})};common.http({vm:t,$http:e,httpOptions:i,success:o})}}function n(o,n){o.isSubmint=!0;var a={method:"delete",url:c,data:n},r=function(e){common.requestSuccess({vm:o,response:e,fn:function(){i.alert("操作成功",function(){t.go("assistUnit")})}})};common.http({vm:o,$http:e,httpOptions:a,success:r})}function a(o){if(common.initJqValidation(),$("form").valid()&&0==o.isUnitExist){var n={method:"put",url:c,headers:{contentType:"application/json;charset=utf-8"},dataType:"json",data:angular.toJson(o.assistUnit)},a=function(e){common.requestSuccess({vm:o,response:e,fn:function(){i.alert("操作成功",function(){t.go("assistUnit")})}})};common.http({vm:o,$http:e,httpOptions:n,success:a})}}function r(t){var i={method:"get",url:c+"/getAssistUnitById",params:{id:t.id}},o=function(e){t.assistUnit=e.data};common.http({vm:t,$http:e,httpOptions:i,success:o})}function s(e){e.gridOptions.dataSource._skip="",e.gridOptions.dataSource.read()}function l(e){var t=common.kendoGridDataSource(c+"/fingByOData?$orderby=unitSort",$("#assistUnitform"),e.queryParams.page,e.queryParams.pageSize,e.gridParams),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"unitSort",title:"序号",width:50,filterable:!1},{field:"unitName",title:"单位名称",width:"20%",filterable:!1},{field:"unitShortName",title:"简称",width:"8%",filterable:!1},{field:"principalName",title:"负责人",width:"8%",filterable:!1},{field:"principalPhone",title:"负责人电话",width:"10%",filterable:!1},{field:"contactName",title:"联系人",width:"8%",filterable:!1},{field:"contactTell",title:"联系人电话",width:"10%",filterable:!1},{field:"address",title:"企业地址",width:"20%",filterable:!0},{field:"isUse",title:"状态",width:"5%",filterable:!1,template:function(e){return e.isUse?"0"==e.isUse?"已停用":"1"==e.isUse?"在用":void 0:""}},{field:"",title:"操作",width:"8%",template:function(e){return common.format($("#columnBtns").html(),"vm.del('"+e.id+"')",e.id,e.isUse)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,pageable:common.kendoGridConfig(e.queryParams).pageable,resizable:!0}}var c=rootPath+"/assistUnit",d="#/assistUnit";return{grid:l,deleteAssistUnit:n,createAssistUnit:o,updateAssistUnit:a,getAssistUnitById:r,queryAssistUnit:s}}angular.module("app").factory("assistUnitSvc",e),e.$inject=["$http","$state","bsWin"]}(),function(){"use strict";function e(e,t,i){var o=this;o.title="新增协审单位",o.id=i.params.id,o.isUnitExist=!1,o.id&&(o.isUpdate=!0,o.title="更新协审单位"),o.create=function(){t.createAssistUnit(o)},o.update=function(){t.updateAssistUnit(o)},function(){o.isUpdate&&t.getAssistUnitById(o)}()}angular.module("app").controller("assistUnitEditCtrl",e),e.$inject=["$location","assistUnitSvc","$state"]}(),function(){"use strict";function e(e,t){function i(t,i){var o={method:"post",url:rootPath+"/assistPlanSign/findAssistPlanSignById",params:{signId:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function o(){return[{field:"rowNumber",title:"序号",width:50,template:"<span class='row-number'></span>",filterable:!1},{field:"planName",title:"协审计划名称",width:"15%",filterable:!1},{field:"reportTime",title:"报审时间",width:"15%",filterable:!1,format:"{0: yyyy-MM-dd}"},{field:"drawTime",title:"抽签时间",width:"25%",filterable:!1},{field:"createdBy",title:"创建人员",width:"15%",filterable:!1},{field:"createdDate",title:"记录生成时间",width:"15%",filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"",title:"操作",width:"10%",filterable:!1,template:function(e){return'<button class="btn btn-xs btn-primary"  ng-click="vm.showPlanDetail(\''+e.id+'\')"><span class="glyphicon glyphicon-edit"></span>详情</button>'}}]}function n(e){var t=common.kendoGridDataSource(rootPath+"/assistPlan/findByOData",$("#searchform")),i=function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})};e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o(),dataBound:i,resizable:!0}}function a(t,i){var o={method:"post",url:rootPath+"/assistPlan/initPlanManager",params:{isOnlySign:1==t?"9":"0"}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function r(t,i,o){i=!0;var n={method:"post",url:rootPath+"/assistPlan",data:t},a=function(e){i=!1,void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a,onError:function(){i=!1}})}function s(t,i,o){i=!0;var n={method:"delete",url:rootPath+"/assistPlan",params:{id:t}},a=function(e){i=!1,void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a,onError:function(){i=!1}})}function l(t,i,o,n){o=!0;var a={method:"post",url:rootPath+"/sign/findByPlanId",params:{planId:t,isOnlySign:1==i?"9":"0"}},r=function(e){void 0!=n&&"function"==typeof n&&n(e.data)};common.http({$http:e,httpOptions:a,success:r,onError:function(){o=!1}})}function c(t,i,o){var n={method:"delete",url:rootPath+"/assistPlan/cancelPlanSign",params:{planId:t.plan.id,signIds:i}},a=function(e){t.isCommit=!1,void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a,onError:function(){t.isCommit=!1}})}function d(t,i,o){var n=new Array;t.assistSign.forEach(function(e,t){for(var o=0,a=i.length;o<a;o++)if(e.signid==i[o]){var r={};r.signId=e.signid,r.projectName=e.projectname,r.assistType="合并项目",r.isMain="0",n.push(r)}}),t.plan.assistPlanSignDtoList=n,t.isCommit=!0;var a={method:"post",url:rootPath+"/assistPlan/saveLowPlanSign",data:t.plan},r=function(e){t.isCommit=!1,void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:a,success:r,onError:function(){t.isCommit=!1}})}function u(t,i,o){t.isCommit=!0;var n={method:"delete",url:rootPath+"/assistPlan/cancelLowPlanSign",params:{planId:t.plan.id,signIds:i}},a=function(e){t.isCommit=!1,void 0!=o&&"function"==typeof o&&o(e.data)};common.http({vm:t,$http:e,httpOptions:n,success:a,onError:function(){t.isCommit=!1}})}function m(e){e.gridOptions.dataSource._skip="",e.gridOptions.dataSource.read()}function p(t,i){var o={method:"post",url:rootPath+"/assistPlanSign/getPlanSignByPlanId",params:{planId:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function f(t,i){var o={method:"put",url:rootPath+"/assistPlanSign/savePlanSign",headers:{contentType:"application/json;charset=utf-8"},dataType:"json",data:angular.toJson(t)},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({vm:vm,$http:e,httpOptions:o,success:n})}function h(t,i){var o={method:"post",url:rootPath+"/assistPlan/savePlanAndSign",data:t},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function g(t,i){var o={method:"post",url:rootPath+"/assistPlan/findById",params:{id:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function v(t,i,o,n){var a={method:"post",url:rootPath+"/assistUnit/chooseAssistUnit",params:{planId:t,number:i,drawType:o}},r=function(e){void 0!=n&&"function"==typeof n&&n(e.data)};common.http({$http:e,httpOptions:a,success:r})}function y(t){var i={method:"post",url:rootPath+"/assistUnitUser/findByOData"},o=function(e){t.unitUserList=e.data.value};common.http({vm:t,$http:e,httpOptions:i,success:o})}function w(t){var i={method:"post",url:rootPath+"/assistUnit/fingByOData"},o=function(e){void 0!=t&&"function"==typeof t&&t(e.data)};common.http({$http:e,httpOptions:i,success:o})}function b(t,i){var o="";t.assistPlan.assistPlanSignDtoList.forEach(function(e,t){t>0&&(o+=","),o+=e.id+"|"+e.assistUnit.id});var n="";t.drawAssistUnits.length>0&&t.drawAssistUnits.forEach(function(e,t){t>0&&(n+=","),n+=e.id}),t.isCommit=!0;var a={method:"post",url:rootPath+"/assistPlan/saveDrawAssistUnit",params:{planId:t.assistPlan.id,drawAssitUnitIds:o,unSelectedIds:n}},r=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:a,success:r,onError:function(e){t.isCommit=!1}})}function S(i,o,n){var a=!0;if(angular.forEach(i.assistPlan.assistUnitDtoList,function(e,i){if(o.id==e.id)return a=!1,void t.alert("该协审单位已被选中！")}),a){var r={method:"post",url:rootPath+"/assistPlan/saveChooleUnit",params:{planId:i.assistPlan.id,unitId:o.id}},s=function(e){void 0!=n&&"function"==typeof n&&n(e.data)};common.http({$http:e,httpOptions:r,success:s})}}function k(t,i){var o={method:"post",url:rootPath+"/assistPlan/initAssistUnit",params:{planId:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}return{initPlanPage:a,initPlanGrid:n,saveAssistPlan:r,deletePlan:s,findPlanSign:l,cancelPlanSign:c,saveLowPlanSign:d,cancelLowPlanSign:u,queryPlan:m,getPlanSignByPlanId:p,savePlanSign:f,savePlan:h,initPlanByPlanId:g,chooseAssistUnit:v,saveDrawAssistUnit:b,getUnitUser:y,getAllUnit:w,saveAddChooleUnit:S,initAssistUnitByPlanId:k,findAssistPlanSignById:i}}angular.module("app").factory("assistSvc",e),e.$inject=["$http","bsWin"]}(),function(){"use strict";function e(e,t,i){var o=this;o.title="借书列表",o.model={},o.searchModel={},function(){t.bookBorrowGrid(o,function(e){o.bookBorrowDetailList=e.reObj.bookBorrowDetailList,o.bookBorrowSumDtoList=e.reObj.bookBorrowSumDtoList})}(),o.searchForm=function(){t.bookBorrowGrid(o,function(e){o.bookBorrowDetailList=e.reObj.bookBorrowDetailList,o.bookBorrowSumDtoList=e.reObj.bookBorrowSumDtoList})},o.formReset=function(){o.searchModel={}},o.returnBook=function(e,t,i,n,a,r){o.model.id=e,o.model.bookNo=t,o.model.booksName=i,o.model.borrowNum=a,o.model.bookBorrower=n,o.model.returnDate=void 0!=r?new Date(r).Format("yyyy-MM-dd"):"",o.model.returnBorrower=$("#curName").val(),$("#returnBookWindow").kendoWindow({width:"38%",height:"300px",title:"图书借还",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},o.saveReturnBookDetail=function(){t.saveReturnBookDetail(o,function(e){e.flag||"ok"==e.reCode?i.alert("保存成功！",function(){window.parent.$("#returnBookWindow").data("kendoWindow").close(),$state.go("bookBorrowList")}):i.alert(e.reMsg)})},o.returnBookList=function(){window.parent.$("#returnBookWindow").data("kendoWindow").close(),$state.go("bookBorrowList")},o.comparisonStill=function(){o.model.returnNum>o.model.borrowNum&&(o.model.returnNum=o.model.borrowNum),o.model.returnNum<0&&(o.model.returnNum=0)}}angular.module("app").controller("bookBorrowCtrl",e),e.$inject=["$location","bookBuySvc","bsWin"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.title="图书查询",n.model={},n.del=function(e){common.confirm({vm:n,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteBookBuy(n,e)}})},n.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:n,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");n.del(o)}},function(){t.grid(n)}(),n.searchForm=function(){n.gridOptions.dataSource._skip=0,n.gridOptions.dataSource.read()},n.formReset=function(){n.searchModel={}},n.borrowBook=function(e){t.queryBookBuyById(e,function(e){n.model=e,n.model.bookBorrower=$("#curName").val()}),console.log(n.model.bookBorrower),$("#borrowBookWindow").kendoWindow({width:"860px",height:"300px",title:"图书借阅",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},n.saveBooksDetail=function(){console.log(n.model),n.model.borrowNum&&0!=n.model.borrowNum?n.model.borrowDate?n.model.returnDate?t.saveBorrowBookDetail(n,function(e){e.flag||"ok"==e.reCode?o.alert("保存成功！",function(){window.parent.$("#borrowBookWindow").data("kendoWindow").close(),n.searchForm()}):o.alert(e.reMsg)}):o.alert("请填写还书日期！"):o.alert("请填写借书日期！"):o.alert("请填写借书数量！")},n.returnBookList=function(){window.parent.$("#borrowBookWindow").data("kendoWindow").close(),n.searchForm()},n.comparisonSize=function(){n.model.borrowNum>n.model.storeConfirm&&(n.model.borrowNum=n.model.storeConfirm),n.model.borrowNum<0&&(n.model.borrowNum=0)}}angular.module("app").controller("bookBuyCtrl",e),e.$inject=["$location","bookBuySvc","$state","bsWin"]}(),function(){"use strict";function e(e,t,i){var o=this;o.title="添加图书管理信息",o.isuserExist=!1,o.id=i.params.id,o.id&&(o.isUpdate=!0,o.title="更新图书管理信息"),o.create=function(){t.createBookBuy(o)},o.update=function(){t.updateBookBuy(o)},function(){o.isUpdate&&t.getBookBuyById(o)}()}angular.module("app").controller("bookBuyEditCtrl",e),e.$inject=["$location","bookBuySvc","$state"]}(),function(){"use strict";function e(e){function t(t,i){var o={method:"post",url:rootPath+"/bookBuy/saveBorrowDetail",data:t.model},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function i(t,i){var o={method:"post",url:rootPath+"/bookBuy/saveReturnDetail",data:t.model},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function o(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0,t.model.id=t.id;var i={method:"put",url:d,data:t.model},o=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:t,$http:e,httpOptions:i,success:o})}}function n(t,i){t.isSubmit=!0;var o={method:"delete",url:d,data:i},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})}})};common.http({vm:t,$http:e,httpOptions:o,success:n})}function a(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0;var i={method:"post",url:d,data:t.model},o=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,location.href=u}})}})};common.http({vm:t,$http:e,httpOptions:i,success:o})}}function r(t){var i={method:"get",url:rootPath+"/bookBuy/html/findById",params:{id:t.id}},o=function(e){t.model=e.data};common.http({vm:t,$http:e,httpOptions:i,success:o})}function s(t,i){var o={method:"get",url:rootPath+"/bookBuy/html/findById",params:{id:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function l(t,i){var o={method:"post",url:rootPath+"/bookBorrow/expertCostDetailTotal",data:t.searchModel},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function c(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/bookBuy/findByOData",$("#bookForm")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})},o=[{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"bookNo",title:"图书号",width:100,filterable:!1},{field:"booksName",title:"图书名称",width:100,filterable:!1},{field:"booksType",title:"图书分类",width:100,filterable:!1},{field:"booksPrice",title:"价格",width:100,filterable:!1},{field:"bookNumber",title:"数量",width:100,filterable:!1},{field:"",title:"库存",width:100,attributes:{style:"color:red"},filterable:!1,template:function(e){return e.storeConfirm?e.storeConfirm:0}},{field:"storeTime",title:"入库时间",width:100,filterable:!1},{field:"",title:"操作",width:140,template:function(e){return e.storeConfirm&&e.storeConfirm>0?common.format($("#columnBtns").html(),e.id):""}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,resizable:!0,dataBound:i}}var d=rootPath+"/bookBuy",u="#/bookBuyList";return{grid:c,bookBorrowGrid:l,getBookBuyById:r,queryBookBuyById:s,createBookBuy:a,deleteBookBuy:n,updateBookBuy:o,saveBorrowBookDetail:t,saveReturnBookDetail:i}}angular.module("app").factory("bookBuySvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t){var i=this;i.title="图书采购流程查询",i.del=function(e){common.confirm({vm:i,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteBookBuyBusiness(i,e)}})},i.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:i,msg:"请选择数据"});else{for(var t=[],o=0;o<e.length;o++)t.push(e[o].value);var n=t.join(",");i.del(n)}},function(){t.grid(i)}(),i.searchForm=function(){i.gridOptions.dataSource._skip=0,i.gridOptions.dataSource.read()},i.formReset=function(){i.searchModel={}}}angular.module("app").controller("bookBuyBusinessCtrl",e),e.$inject=["$location","bookBuyBusinessSvc"]}(),function(){"use strict";function e(e,t,i){var o=this;o.model={},o.businessId=i.params.businessId,o.viewDetail=i.params.viewDetail,o.showGoBack=!0,function(){e.getBookBuyBusinessById(o,function(e){if(o.model=e,o.model.bookBuyList)for(var t=0;t<o.model.bookBuyList.length;t++)o.model.bookBuyList[t].totalPrice=parseFloat(o.model.bookBuyList[t].booksPrice)*o.model.bookBuyList[t].bookNumber})}()}angular.module("app").controller("bookBuyBusinessDetailCtrl",e),e.$inject=["bookBuyBusinessSvc","bsWin","$state"]}(),function(){"use strict";function e(e,t,i,o){function n(){var e=$("#buyChannel").val();if(""==e||"undefined"===e)return o.error("购买渠道没有填写，请选择后再进行保存！"),!1;if(common.initJqValidation($("#bookForm")),$("#bookForm").valid()){if(r.conditions.length>0){var t=!0;return r.conditions.forEach(function(e,i){e.booksName=$("#booksName"+e.sort).val(),e.booksType=$("#booksType"+e.sort).val(),e.publishingCompany=$("#publishingCompany"+e.sort).val(),e.bookNo=$("#bookNo"+e.sort).val(),""!=e.bookNo&&"undefined"!==e.bookNo||(o.error("图书号不能为空请核查！"),t=!1),e.author=$("#author"+e.sort).val(),e.bookNumber=$("#bookNumber"+e.sort).val(),""!=e.bookNumber&&"undefined"!==e.bookNumber||(o.error("图书数量不能为空请核查！"),t=!1),a(e.bookNumber)||(o.error("图书数量只能输入正整数请核查！"),t=!1),e.storeConfirm=$("#storeConfirm"+e.sort).val(),e.booksPrice=$("#booksPrice"+e.sort).val(),/^(-)?(([1-9]{1}\d*)|([0]{1}))(\.(\d){1,4})?$/.test(e.booksPrice)||(o.error("价格只能输入数字请核查！"),t=!1),e.applyDept=r.model.applyDept,e.operator=r.model.operator,e.buyChannel=r.model.buyChannel,e.businessId=$("#businessId").val(),e.businessName=r.model.businessName,e.applyReason=r.model.applyReason}),t}return o.error("没有分录数据，无法保存！"),!1}o.alert("操作失败，有红色*号的选项为必填项，请按要求填写！")}function a(e){return!!(/^(\+|-)?\d+$/.test(e)&&e>0)}var r=this;r.model={},r.conMaxIndex=0,r.conditions=new Array,r.title="图书信息录入",r.isuserExist=!1,r.businessId=i.params.businessId,r.viewDetail=i.params.viewDetail,r.showFlag={addBooksDeatail:!0,modBooksDetail:!0,bookBuyApplyTr:!1,bookBuyBzTr:!0,bookBuyFgzrTr:!0,bookBuyZrTr:!0,bookBuyYsrk:!0,buyChannel:!1,isCommit:!1},r.businessId?(r.isUpdate=!0,r.showFlag.modBooksDetail=!0,r.showFlag.addBooksDeatail=!1,$("#businessId").val(r.businessId)):(r.showFlag.modBooksDetail=!1,r.showFlag.addBooksDeatail=!0),"1"==r.viewDetail&&(r.showFlag.bookBuyYsrk=!0,r.showFlag.addBooksDeatail=!0,r.showFlag.modBooksDetail=!0,r.showFlag.bookBuyZrTr=!0,r.showFlag.bookBuyFgzrTr=!0,r.showFlag.bookBuyBzTr=!0,r.showFlag.bookBuyApplyTr=!0,r.showFlag.buyChannel=!0,r.showFlag.isCommit=!0),r.create=function(){t.createBookBuyBusiness(r)},r.update=function(){t.updateBookBuyBusiness(r)},r.addCondition=function(){r.condition={},r.showFlag.addBooksDeatail?r.condition.sort=r.conMaxIndex+1:(r.conMaxIndex=r.conditions.length,r.condition.sort=r.conditions.length+1),r.conditions.push(r.condition),r.conMaxIndex++},r.removeCondition=function(){var e=$("#conditionTable input[name='bookInfos']:checked");e.length>0?o.confirm({title:"询问提示",message:"删除数据不可恢复，确定删除么？",onOk:function(){$(".confirmDialog").modal("hide");for(var i=[],n=0;n<e.length;n++)for(var a=0;a<r.conditions.length;a++){var s=r.conditions[a];if(e[n].value==s.sort){if(!s.id){r.conditions.splice(a,1),$("#conTr"+s.sort).remove();break}i.push(s.id)}}i.length>0&&t.deleteBooksConditions(i.join(","),function(e){if(e.flag||"ok"==e.reCode){o.success("操作成功！");for(var t=0;t<i.length;t++)for(var n=0;n<r.conditions.length;n++){var a=r.conditions[n];if(i[t]==a.sort){r.conditions.splice(n,1),$("#conTr"+a.sort).remove();break}}}else o.error(e.reMsg)})}}):o.alert("请选择要删除的图书信息！")},r.saveCondition=function(){n()&&t.saveBookBuyBusinessDetail(r.conditions,function(e){e.flag||"ok"==e.reCode?($("#businessId").val(e.reObj.businessId),o.success("保存成功！")):o.error(e.reMsg)})},r.startFlow=function(){o.confirm({title:"询问提示",message:"发起流程后，当前页面数据将不能再修改！确认发起流程么？",onOk:function(){n()?t.startFlow(r.conditions,r.showFlag.isCommit,function(e){e.flag||"ok"==e.reCode?o.alert("保存成功！",function(){i.go("myBookBuyBusiness")}):o.alert(e.reMsg)}):o.error("没有分录数据，无法发起流程！")}})},r.checkBookNum=function(e){var t="bookNumber"+e;if(!a($("#"+t).val()))return void $("span[data-valmsg-for='"+t+"']").html("图书数量只能输入正整数！");$("span[data-valmsg-for='"+t+"']").html("")},r.checkPrice=function(e){var t=/^(-)?(([1-9]{1}\d*)|([0]{1}))(\.(\d){1,4})?$/,i="booksPrice"+e,o="bookNumber"+e;if(!t.test($("#"+i).val()))return $("#"+i).val(""),void $("span[data-valmsg-for='"+i+"']").html("价格只能输入数字！");$("span[data-valmsg-for='"+i+"']").html("");var n=$("#"+i).val(),a=$("#"+o).val();$("#total"+e).val(parseFloat(n)*a)},function(){r.isUpdate&&t.getBookBuyBusinessById(r,function(e){r.model=e,r.conditions=r.model.bookBuyList;for(var t=0;t<r.conditions.length;t++)r.conditions[t].sort=t+1,r.conditions[t].total=parseFloat(r.conditions[t].booksPrice)*r.conditions[t].bookNumber})}()}angular.module("app").controller("bookBuyBusinessEditCtrl",e),e.$inject=["$location","bookBuyBusinessSvc","$state","bsWin"]}(),function(){"use strict";function e(e){function t(t,i){var o={method:"delete",url:d+"/bookDel",params:{ids:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function i(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0,t.model.id=t.id;var i={method:"put",
url:d,data:t.model},o=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:t,$http:e,httpOptions:i,success:o})}}function o(t,i){t.isSubmit=!0;var o={method:"delete",url:d,data:i},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})}})};common.http({vm:t,$http:e,httpOptions:o,success:n})}function n(t){common.initJqValidation();$("form").valid();{t.isSubmit=!0;var i={method:"post",url:d,data:t.model},o=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,location.href=u}})}})};common.http({vm:t,$http:e,httpOptions:i,success:o})}}function a(t,i){var o={method:"post",url:rootPath+"/bookBuyBusiness/saveBooksDetailList",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(t)},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function r(t,i,o){i=!0;var n={method:"post",url:rootPath+"/bookBuyBusiness/startFlow",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(t)},a=function(e){i=!1,void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a,onError:function(){i=!1}})}function s(t){var i={method:"get",url:rootPath+"/bookBuyBusiness/html/findById",params:{id:t.businessKey}},o=function(e){t.model=e.data;for(var i=0;i<t.model.bookBuyList.length;i++)t.model.bookBuyList[i].totalPrice=parseFloat(t.model.bookBuyList[i].booksPrice)*t.model.bookBuyList[i].bookNumber};common.http({$http:e,httpOptions:i,success:o,onError:function(){}})}function l(t,i){var o={method:"get",url:rootPath+"/bookBuyBusiness/html/findById",params:{id:t.businessId}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({vm:t,$http:e,httpOptions:o,success:n})}function c(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/bookBuyBusiness/findByOData",$("#bookBuyForm"),{filter:"createdBy eq ${CURRENT_USER.id}"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})},o=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"applyDept",title:"申请部门",width:"20%",filterable:!1},{field:"operator",title:"申请人",width:"10%",filterable:!1},{field:"buyChannel",title:"购买渠道",width:"15%",filterable:!1},{field:"applyDate",title:"申请日期",width:"15%",filterable:!1},{field:"",title:"状态",width:"15%",filterable:!1,template:function(e){return e.processInstanceId&&e.filer?"已办理":e.processInstanceId?"正在办理":"未确定申购"}},{field:"",title:"操作",width:140,template:function(e){var t=!!e.processInstanceId;return common.format($("#columnBtns").html(),e.businessId,t)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}var d=rootPath+"/bookBuyBusiness",u="#/bookBuyBusinessList";return{grid:c,getBookBuyBusinessById:l,createBookBuyBusiness:n,deleteBookBuyBusiness:o,updateBookBuyBusiness:i,saveBookBuyBusinessDetail:a,startFlow:r,initFlowDeal:s,deleteBooksConditions:t}}angular.module("app").factory("bookBuyBusinessSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(){return{success:function(e,t){return this.alert({message:e,type:"success",onClose:t,icon:1})},warning:function(e,t){return this.alert({message:e,type:"warning",onClose:t,icon:5})},error:function(e,t){return this.alert({message:e,type:"error",onClose:t,icon:2})},alert:function(e,t,i){if(!angular.isObject(e)){var o;!t||angular.isFunction(t)?(i=t,t=e):o=e,e={message:t,onClose:i||function(){}},o&&(e.title=o)}e.onClose=e.onClose||function(){},layer.alert(e.message,{title:e.title?e.title:"系统消息",icon:e.icon?e.icon:6,skin:"layui-layer-lan"},function(t){layer.close(t),e.onClose()})},confirm:function(e,t,i,o,n){if(!angular.isObject(e)){var a;!t||angular.isFunction(t)?(n=o||function(){},o=i||function(){},i=t||function(){},t=e):a=e,e={message:t,onOk:i,onClose:o,onCancel:n},a&&(e.title=a)}e.onClose=e.onClose||function(){},layer.confirm(e.message,{title:e.title?e.title:"询问提示",icon:3,skin:"layui-layer-lan",btn:["确认","取消"],end:e.onClose},function(t){layer.close(t),void 0!=e.onOk&&"function"==typeof e.onOk&&e.onOk()},function(t){layer.close(t),void 0!=e.onCancel&&"function"==typeof e.onCancel&&e.onCancel()})}}}angular.module("app");angular.module("app").factory("bsWin",e)}(),function(){"use strict";function e(e,t,i){var o=new Blob([e],{type:"application/"+i}),n=URL.createObjectURL(o),a=$("<a><span class='forExcel'>下载</span></a>").attr("href",n).attr("download",t);$("body").append(a),$(".forExcel").click(),a.remove()}function t(e){e?(e.removeData("validator"),e.removeData("unobtrusiveValidation"),$.validator.unobtrusive.parse(e)):($("form").removeData("validator"),$("form").removeData("unobtrusiveValidation"),$.validator.unobtrusive.parse("form"))}function i(e){var t=function(t){b.alert({vm:e.vm,msg:t,fn:function(){e.vm.isSubmit=!1,$(".alertDialog").modal("hide")}})};if(e.response.status>400)t("发生错误！");else{var i=e.response.data;i&&555==i.reCode?t(i.message):e.fn&&e.fn(i)}}function o(){for(var e=arguments[0],t=1;t<arguments.length;t++){var i=new RegExp("\\{"+(t-1)+"\\}","gm");e=e.replace(i,arguments[t])}return e}function n(e){var t=e.toString().replace(/[^0-9]/g,"");return parseInt(t,10)}function a(e){return isNaN(parseFloat(e,10))?0:parseFloat(e,10)}function r(){return $(window).height()-180}function s(e){e.vm.alertDialogMessage=e.msg,e.vm.alertDialogFn=function(){e.closeDialog&&1==e.closeDialog&&($(".alertDialog").modal("hide"),$(".modal-backdrop").remove()),e.fn?e.fn():$(".alertDialog").modal("hide")},$(".alertDialog").modal({backdrop:"static",keyboard:!1})}function l(e){e.vm.dialogConfirmTitle=e.title,e.vm.dialogConfirmMessage=e.msg,$(".confirmDialog").modal({backdrop:"static"}),e.vm.dialogConfirmSubmit=e.fn,e.cancel?e.vm.dialogConfirmCancel=e.cancel:e.vm.dialogConfirmCancel=function(){$(".confirmDialog").modal("hide")}}function c(e,t){null==t&&(t=""),e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\?&]"+e+"=([^&#]*)"),o=i.exec(window.location.href);return null==o?t:o[1]}function d(e,t,i,o,n){return new kendo.data.DataSource({type:"odata",transport:u().transport(e,t,n),schema:u().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:o||10,page:i||1,sort:{field:"createdDate",dir:"desc"}})}function u(e){return{filterable:{extra:!1,operators:{string:{contains:"包含",eq:"等于"},number:{eq:"等于",neq:"不等于",gt:"大于",lt:"小于"},date:{gt:"大于",lt:"小于"}}},pageable:{pageSize:10,previousNext:!0,buttonCount:5,refresh:!0,pageSizes:!0,change:function(){e&&e.page&&(e.page=this.dataSource.page())}},dataBound:function(t){var i=this.items(),o=this.pager.page()-1,n=this.pager.pageSize();$(i).each(function(){var e=$(this).index()+1+o*n,t=$(this).find(".row-number");$(t).html(e)}),e.pageSize=t.sender.dataSource.pageSize(),e.page=t.sender.dataSource.page()},schema:function(e){return{data:"value",total:function(e){return e.count},model:e}},transport:function(e,t,i){return{read:{url:e,dataType:"json",type:"post",cache:!1,beforeSend:function(e){e.setRequestHeader("Token",b.getToken())},data:function(){if(t){var e=common.buildOdataFilter(t);if(e){if(i&&i.$filter){var o=i.$filter;return i=void 0,{$filter:e+" and "+o}}return{$filter:e}}return i&&i.$filter?{$filter:i.$filter}:{}}return i||{}}}}},noRecordMessage:{template:"暂时没有数据."}}}function m(e){var t=$(e).find("tr td:nth-child(1)").find("input:checked"),i=[];return t.each(function(){var e=$(this).attr("relId");i.push({name:"id",value:e})}),i}function p(e){e.headers={Token:b.getToken()},e.$http(e.httpOptions).then(e.success,function(t){e.onError&&e.onError(t)})}function f(){return{get:function(e,t){var i=this.getAll(e);return i?i[t]:null},getAll:function(e){var t=encodeURIComponent(e)+"=",i=document.cookie.indexOf(t),o=null,n={};if(i>-1){var a=document.cookie.indexOf(";",i);if(-1==a&&(a=document.cookie.length),o=document.cookie.substring(i+t.length,a),o.length>0){for(var r=o.split("&"),s=0,l=r.length;s<l;s++){var c=r[s].split("=");n[decodeURIComponent(c[0])]=decodeURIComponent(c[1])}return n}}return null},set:function(e,t,i,o,n,a,r){var s=this.getAll(e)||{};s[t]=i,this.setAll(e,s,o,n,a,r)},setAll:function(e,t,i,o,n,a){var r=encodeURIComponent(e)+"=",s=new Array;for(var l in t)l.length>0&&t.hasOwnProperty(l)&&s.push(encodeURIComponent(l)+"="+encodeURIComponent(t[l]));s.length>0?(r+=s.join("&"),i instanceof Date&&(r+=";expires="+i.toGMTString()),o&&(r+=";path="+o),n&&(r+=";domain="+n),a&&(r+=";secure")):r+=";expires="+new Date(0).toGMTString(),document.cookie=r},unset:function(e,t,i,o,n){var a=this.getAll(e);a&&(delete a[t],this.setAll(e,a,null,i,o,n))},unsetAll:function(e,t,i,o){this.setAll(e,null,new Date(0),t,i,o)}}}function h(){var e=f().getAll("data");return null!=e?e.token:""}function g(e){return e.error=function(e){401==e.status&&(location.href=window.rootPath+"/home/login")},e}function v(e){var t=/^(?:checkbox|radio)$/i,i=/^(?:submit|button|image|reset|file)$/i,o=/^(?:input|select|textarea|keygen)/i;return $(e).map(function(){var e=jQuery.prop(this,"elements");return e?jQuery.makeArray(e):this}).filter(function(){var e=this.type;return this.value&&this.name&&!$(this).is(":disabled")&&o.test(this.nodeName)&&!i.test(e)&&(this.checked||!t.test(e))}).map(function(e,t){var i=$(this),o=i.val();if(!o)return!1;var n=i.attr("data-type")||"String";o="'"+o+"'","String"!=n&&(o=n+o);var a=i.attr("operator")||"eq",r=i.attr("data-role")||"";return"datepicker"==r?o="date"+o:"datetimepicker"==r&&(o="datetime"+o),"like"==a?"substringof("+o+", "+t.name+")":t.name+" "+a+" "+o}).get().join(" and ")}function y(e){e.$http({method:"get",url:rootPath+"/admin/myCountInfo"}).then(function(e){e.data.DO_SIGN_COUNT&&$("#DO_SIGN_COUNT").html(e.data.DO_SIGN_COUNT),e.data.DO_TASK_COUNT&&$("#DO_TASK_COUNT").html(e.data.DO_TASK_COUNT),e.data.GET_SIGN_COUNT&&$("#GET_SIGN_COUNT").html(e.data.GET_SIGN_COUNT),e.data.GET_RESERVESIGN_COUNT&&$("#GET_RESERVESIGN_COUNT").html(e.data.GET_RESERVESIGN_COUNT)})}function w(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}).toUpperCase()}var b={initJqValidation:t,requestSuccess:i,format:o,blockNonNumber:n,floatNumberInput:a,adminContentHeight:r,alert:s,confirm:l,getQuerystring:c,kendoGridConfig:u,getKendoCheckId:m,cookie:f,getToken:h,http:p,gridDataSource:g,buildOdataFilter:v,kendoGridDataSource:d,getTaskCount:y,uuid:w,downloadReport:e};window.common=b,function(){$(document).on("click","#checkboxAll",function(){var e=$(this).is(":checked");$(".grid").find("tr td:nth-child(1)").find('input:checkbox[ng-disabled!="true"]').prop("checked",e)})}()}(),function(){"use strict";function e(e,i){return{request:function(e){return e.headers.Token=common.getToken(),e.headers["X-Requested-With"]="XMLHttpRequest",e},responseError:function(o){return o.config.headers.commonHttp||t(i,o.status,o.data),e.reject(o)}}}function t(e,t,i){switch(t){case 500:e.error("系统内部错误!");break;case 401:e.warning("登录信息失效或您没有权限,请重新登录!",function(){window.location.href=rootPath+"/"});break;case 403:e.warning("您无权限执行此操作！");break;case 404:e.error("未找到相应的操作！");break;case 408:e.warning("请求超时");break;case 412:e.warning(i.message||"操作失败");break;case 499:e.warning(i.message||"您的账号已在别的地方登录，请确认密码是否被修改！");break;default:e.error("发生错误,系统已记录,我们会尽快处理！")}}var i=angular.module("app");i.factory("commonHttpInterceptor",["$injector","bsWin",e]),i.config(["$httpProvider",function(t){t.interceptors.push(e),t.defaults.headers.get||(t.defaults.headers.get={}),t.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",t.defaults.headers.get["Cache-Control"]="no-cache",t.defaults.headers.get.Pragma="no-cache"}]),jQuery&&jQuery(document).ajaxSend(function(e,t,i){t.setRequestHeader("Token",common.getToken())}).ajaxError(function(e,i,o,n){var a=angular.element("body"),r=a.scope(),s=a.injector().get("bsWin"),l=angular.isString(i.responseText)?JSON.parse(i.responseText||"{}"):i.responseText;r.$apply(function(){t(s,i.status,l||{})})})}(),function(){"use strict";function e(e,t){function i(i,o){i.ideaContent="",$("#ideaWindow").kendoWindow({width:"70%",height:"660px",title:"意见选择",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open(),i.ideas||e({method:"post",url:rootPath+"/idea/findMyIdea"}).then(function(e){i.ideas=e.data}),i.deleteCommonIdea=function(){var o=$("#commonIdeaTable input[type='checkbox']:checked");if(o.length<1)t.alert("请选择要删除的意见！");else{for(var n=[],a=0;a<o.length;a++)o[a].value&&n.push(o[a].value),$.each(i.ideas,function(e,t){e==o[a].name&&i.ideas.splice(e,1)});if(n.length>0){var r=n.join(",");e({method:"delete",url:rootPath+"/idea",params:{ideas:r}}).then(function(o){t.alert("删除成功！",function(){e({method:"post",url:rootPath+"/idea/findMyIdea"}).then(function(e){i.ideas=e.data})})})}}},i.addCorrentIdea=function(e){i.ideaContent+=e},i.addCommonIdea=function(){i.ideas||(i.ideas=[]),i.newIdea={},i.newIdea.ideaType="1",i.ideas.push(i.newIdea)},i.saveCommonIdea=function(){if(0==i.ideas.length)return void t.alert("请编辑你要保存的意见信息！");e({method:"post",url:rootPath+"/idea",headers:{contentType:"application/json;charset=utf-8"},dataType:"json",data:angular.toJson(i.ideas)}).then(function(e){e.data.flag||"ok"==e.data.reCode?(i.ideas=e.data.reObj,t.alert("添加成功！")):t.alert(e.data.reMsg)})},i.saveCurrentIdea=function(){var e=$("#"+o.targetId);e.val(e.val()+i.ideaContent),window.parent.$("#ideaWindow").data("kendoWindow").close(),e.focus()}}function o(t){var i={method:"post",url:rootPath+"/idea/findMyIdea"},o=function(e){t.ideas=e.data};common.http({$http:e,httpOptions:i,success:o})}return{initIdeaData:i,initIdea:o}}angular.module("app").factory("ideaSvc",e),e.$inject=["$http","bsWin"]}(),function(){"use strict";function e(e,t){var i=this;i.title="单位列表",i.del=function(e){common.confirm({vm:i,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deletecompany(i,e)}})},i.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:i,msg:"请选择数据"});else{for(var t=[],o=0;o<e.length;o++)t.push(e[o].value);var n=t.join(",");i.del(n)}},i.queryConpany=function(){t.queryConpany(i)},function(){t.grid(i)}()}angular.module("app").controller("companyCtrl",e),e.$inject=["$location","companySvc"]}(),function(){"use strict";function e(e,t,i){var o=this;o.title="新增单位",o.iscompanyExist=!1,o.id=i.params.id,o.id&&(o.isUpdate=!0,o.title="更新单位"),o.create=function(){t.createcompany(o)},o.update=function(){t.updatecompany(o)},function(){o.isUpdate&&t.getcompanyById(o)}()}angular.module("app").controller("companyEditCtrl",e),e.$inject=["$location","companySvc","$state"]}(),function(){"use strict";function e(e,t){function i(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(c+"/fingByOData",$("#form")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})},o=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"coName",title:"单位名称",width:220,filterable:!1},{field:"coPhone",title:"单位电话",width:100,filterable:!1},{field:"coPC",title:"邮编",width:100,filterable:!1},{field:"coAddress",title:"地址",width:160,filterable:!1},{field:"coType",title:"单位类型",width:160,filterable:!1},{field:"",title:"操作",width:200,template:function(e){return common.format($("#columnBtns").html(),"vm.del('"+e.id+"')",e.id)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}function o(e){e.gridOptions.dataSource._skip=0,e.gridOptions.dataSource.read()}function n(t){if(common.initJqValidation(),$("form").valid()&&0==t.iscompanyExist){t.isSubmit=!0;var i={method:"post",url:c,data:t.model},o=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=d}})}})};common.http({vm:t,$http:e,httpOptions:i,success:o})}}function a(t){var i={method:"get",url:c+"/html/findByIdCompany",params:{id:t.id}},o=function(e){t.model=e.data,console.log(t.model)};common.http({vm:t,$http:e,httpOptions:i,success:o})}function r(t){if(common.initJqValidation(),$("form").valid()&&0==t.iscompanyExist){t.isSubmit=!0,t.model.id=t.id;var i={method:"put",url:c,data:t.model},o=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:t,$http:e,httpOptions:i,success:o})}}function s(t,i){t.isSubmit=!0;var o={method:"delete",url:c,data:i},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})};common.http({vm:t,$http:e,httpOptions:o,success:n})}function l(t,i){var o={method:"put",url:c+"/saveUnitScore",data:t},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}var c=rootPath+"/company",d="#/company";rootPath;return{grid:i,createcompany:n,getcompanyById:a,updatecompany:r,deletecompany:s,queryConpany:o,saveUnit:l}}angular.module("app").factory("companySvc",e),e.$inject=["$http","$compile"]}(),function(){"use strict";function e(e,t){var i=this;i.title="处室管理",i.del=function(e){common.confirm({vm:i,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteDept(i,e)}})},i.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:i,msg:"请选择数据"});else{for(var t=[],o=0;o<e.length;o++)t.push(e[o].value);var n=t.join(",");i.del(n)}},i.queryDept=function(){t.queryDept(i)},function(){t.grid(i)}()}angular.module("app").controller("deptCtrl",e),e.$inject=["$location","deptSvc"]}(),function(){"use strict";function e(e,t,i){var o=this;o.title="编辑处室",o.isuserExist=!1,o.deptId=i.params.deptId,o.deptId&&(o.isUpdate=!0,o.title="更新处室"),o.create=function(){t.createDept(o)},o.update=function(){t.updateDept(o)},function(){o.isUpdate&&t.getDeptById(o)}()}angular.module("app").controller("deptEditCtrl",e),e.$inject=["$location","deptSvc","$state"]}(),function(){"use strict";function e(e){function t(e){e.gridOptions.dataSource._skip="",e.gridOptions.dataSource.read()}function i(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0;var i={method:"put",url:s,data:t.model},o=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1}})}})};common.http({vm:t,$http:e,httpOptions:i,success:o})}}function o(t,i){t.isSubmit=!0;var o={method:"delete",url:s,data:i},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})}})};common.http({vm:t,$http:e,httpOptions:o,success:n})}function n(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0;var i={method:"post",url:s,data:t.model},o=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,location.href=l}})}})};common.http({vm:t,$http:e,httpOptions:i,success:o})}}function a(t){var i={method:"get",url:rootPath+"/dept/html/findById",params:{deptId:t.deptId}},o=function(e){e.data.offices&&(t.offices={},t.offiecs=e.data.offices),t.model=e.data};common.http({vm:t,$http:e,httpOptions:i,success:o})}function r(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(s+"/fingByOData",$("#formDept")),schema:common.kendoGridConfig().schema({id:"deptId",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})},o=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.deptId)},filterable:!1,width:20,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:30,filterable:!1,template:"<span class='row-number'></span>"},{field:"deptName",title:"处室名称",width:100,filterable:!1},{field:"deptUserName",title:"联系人",width:100,filterable:!1},{field:"address",title:"地址",width:100,filterable:!1},{field:"deptType",title:"类型",width:100,filterable:!1},{field:"",title:"状态",width:100,filterable:!1,template:function(e){return e.status?5==e.status?"正常":7==e.status?"已删除":void 0:" "}},{field:"",title:"操作",width:140,template:function(e){return common.format($("#columnBtns").html(),"vm.del('"+e.deptId+"')",e.deptId,e.deptId)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}var s=rootPath+"/dept",l="#/listDept";return{grid:r,getDeptById:a,createDept:n,deleteDept:o,updateDept:i,queryDept:t}}angular.module("app").factory("deptSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.title="办事处人员列表",n.id=t.params.deptId,n.showAddUserDialog=function(){$(".addUser").modal({backdrop:"static",keyboard:!1}),n.deptOfficeGrid.dataSource.read()},n.closeAddUserDialog=function(){$(".addUser").modal("hide")},n.addOfficeUser=function(e){o.addOfficeUser(n,e)},n.remove=function(e){common.confirm({vm:n,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),o.deletedeptOfficeUser(n,e)}})},n.removes=function(){var e=common.getKendoCheckId(".deptOfficeGrid");if(0==e.length)common.alert({vm:n,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");n.remove(o)}},function(){o.grid(n),o.deptOfficeGrid(n)}()}angular.module("app").controller("deptOfficeUserCtrl",e),e.$inject=["$location","$state","deptSvc","deptOfficeUserSvc"]}(),function(){"use strict";function e(e){function t(t,i){var o={method:"post",url:rootPath+"/dept/addOfficeUser",params:{deptId:t.id,officeId:i}},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.deptOfficeGrid.dataSource.read(),t.gridOptions.dataSource.read()}})};common.http({vm:t,$http:e,httpOptions:o,success:n})}function i(t){var i={method:"get",url:common.format(c+"/getDepts")},o=function(e){t.depts={},t.depts=e.data};common.http({vm:t,$http:e,httpOptions:i,success:o})}function o(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0,t.model.id=t.id;var i={method:"put",url:c,data:t.model},o=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:t,$http:e,httpOptions:i,success:o})}}function n(t,i){t.isSubmit=!0;var o={method:"delete",url:rootPath+"/dept/deleteOfficeUsers",params:{deptId:t.id,officeId:i}},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})}})};common.http({vm:t,$http:e,httpOptions:o,success:n})}function a(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0;var i={method:"post",url:c,data:t.model},o=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,location.href=d}})}})};common.http({vm:t,$http:e,httpOptions:i,success:o})}}function r(t){var i={method:"get",url:rootPath+"/dept/html/findById",params:{officeID:t.officeID}},o=function(e){e.data.dept&&(t.depts={}),t.model=e.data};common.http({vm:t,$http:e,httpOptions:i,success:o})}function s(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(m+"?deptId="+e.id),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.officeID)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"officeUserName",title:"办事处联系人",width:100,filterable:!1},{field:"officePhone",title:"电话",width:100,filterable:!1},{field:"officeDesc",title:"描述",width:100,filterable:!1},{field:"",title:"操作",width:140,template:function(e){return common.format($("#allUserGridBtns").html(),"vm.addOfficeUser('"+e.officeID+"')",e.officeID)}}];e.deptOfficeGrid={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0}}function l(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(u+"?deptId="+e.id),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.officeID)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"officeUserName",title:"办事处联系人",width:100,filterable:!1},{field:"officePhone",title:"电话",width:100,filterable:!1},{field:"officeDesc",title:"描述",width:100,filterable:!1},{field:"",title:"操作",width:140,template:function(e){return common.format($("#columnBtns").html(),"vm.remove('"+e.officeID+"')",e.officeID)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0}}var c=rootPath+"/dept",d="#/deptList",u=rootPath+"/dept/getDeptOfficeUsers",m=rootPath+"/dept/NotInoDeptfficeUsers";return{grid:l,getdeptById:r,createdept:a,deletedeptOfficeUser:n,updatedept:o,getDepts:i,deptOfficeGrid:s,addOfficeUser:t}}angular.module("app").factory("deptOfficeUserSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,i){var o=this;o.title="字典",o.model={},function(){e.initDictTree(function(e){function t(e,t,o){i.go("dict.edit",{id:o.id})}var n,a={callback:{onClick:t},data:{simpleData:{enable:!0,idKey:"id",pIdKey:"pId"}}},r=$linq(e.value).select(function(e){var t=null;return e.parentId&&(t=e.parentId),{id:e.dictId,name:e.dictName,pId:t}}).toArray();n=$.fn.zTree.init($("#zTree"),a,r),o.dictsTree=n})}(),o.del=function(n){t.confirm({title:"询问提示",message:"删除字典将会连下级字典一起删除，确认删除数据吗？",onOk:function(){e.deleteDict(n,o.isSubmit,function(e){o.isSubmit=!1,e.flag||"ok"==e.reCode?t.alert("消息提示","操作成功！",function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),i.go("dict",{},{reload:!0})}):t.alert(e.reMsg)})}})},o.dels=function(){var e=o.dictsTree.getSelectedNodes();e&&e.length>0?o.del(e[0].id):t.alert("请选择要删除的数据！")}}angular.module("app").controller("dictCtrl",e),e.$inject=["dictSvc","bsWin","$state"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.title="增加字典",n.model={},n.id=o.params.id,n.id&&(n.isUpdate=!0,n.title="编辑字典"),n.model.dictSort=0,function(){n.isUpdate?i.getDictById(n.id,function(e){e.flag||"ok"==e.reCode?(n.model=e.reObj,i.getTreeData(function(e){if(n.treeData={},n.treeData=e.value,n.isUpdate&&n.treeData&&n.model.parentId)for(var t=0;t<n.treeData.length;t++)if(n.treeData[t].dictId==n.model.parentId){n.model.parentDictName=n.treeData[t].dictName;break}})):t.alert(e.reMsg)}):(n.model.dictCode="",i.initpZtreeClient(function(e){var t={check:{enable:!0,chkStyle:"radio",radioType:"all"},callback:{},data:{simpleData:{enable:!0,idKey:"id",pIdKey:"pId"}}},i=$linq(e.value).select(function(e){var t;return e.parentId&&(t=e.parentId),{id:e.dictId,name:e.dictName,pId:t}}).toArray();n.zpTree=$.fn.zTree.init($("#pzTree"),t,i)}))}(),n.createDict=function(){if(common.initJqValidation(),$("form").valid()){var e=n.zpTree.getCheckedNodes(!0);e&&e.length>0&&(n.model.parentId=e[0].id),i.createDict(n.model,n.isSubmit,function(e){n.isSubmit=!1,e.flag||"ok"==e.reCode?($(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),t.alert("系统提示","操作成功！",function(){o.go("dict",{},{reload:!0})})):t.alert(e.reMsg)})}else t.alert("数据填写正确，请检查修改后再提交")},n.updateDict=function(){common.initJqValidation(),$("form").valid()?i.updateDict(n.model,n.isSubmit,function(e){n.isSubmit=!1,e.flag||"ok"==e.reCode?($(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),t.alert("系统提示","操作成功！",function(){o.go("dict.edit",{id:n.model.dictId},{reload:!0})})):t.alert(e.reMsg)}):t.alert("数据填写正确，请检查修改后再提交")},n.dictTypeChange=function(){n.model.dictType&&(n.model.dictKey="")},n.apply=function(){e.$apply()}}angular.module("app").controller("dictEditCtrl",e),e.$inject=["$scope","bsWin","dictSvc","$state"]}(),function(){"use strict";function e(e,t,i){function o(t){var i={method:"get",url:common.format(u+"?dictCode={0}","DICT_SEX")},o=function(e){};common.http({vm:t,$http:e,httpOptions:i,success:o})}function n(t){var i={method:"post",url:rootPath+"/dict/fingByOdata?$orderby=dictSort"},o=function(e){void 0!=t&&"function"==typeof t&&t(e.data)};common.http({$http:e,httpOptions:i,success:o})}function a(t,i,o){i=!0;var n={method:"delete",url:rootPath+"/dict",data:t},a=function(e){i=!1,void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a,onError:function(){i=!1}})}function r(t,i,o){i=!0;var n={method:"post",url:rootPath+"/dict",data:t},a=function(e){i=!1,void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a,onError:function(){i=!1}})}function s(t,i,o){i=!0;var n={method:"put",url:rootPath+"/dict",data:t},a=function(e){i=!1,void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a,onError:function(){i=!1}})}function l(t){var i={method:"post",url:rootPath+"/dict/fingByOdata?$orderby=dictSort"},o=function(e){void 0!=t&&"function"==typeof t&&t(e.data)};common.http({$http:e,httpOptions:i,success:o})}function c(t){var i={method:"post",url:rootPath+"/dict/fingByOdata?$orderby=dictSort"},o=function(e){void 0!=t&&"function"==typeof t&&t(e.data)};common.http({$http:e,httpOptions:i,success:o})}function d(t,i){var o={method:"post",
url:rootPath+"/dict/fingById",params:{id:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}var u=(rootPath,rootPath+"/dict/dictNameData");return{initDictTree:l,createDict:r,getDictById:d,updateDict:s,deleteDict:a,initpZtreeClient:c,getTreeData:n,getdictItems:o}}angular.module("app").factory("dictSvc",e),e.$inject=["$http","$state","$location"]}(),function(){"dispatch strict";function e(e,t,i,o,n,a,r){var s=this;s.title="项目发文编辑",s.sign={},s.searchSign={},s.dispatchDoc={},s.dispatchDoc.signId=i.params.signid,s.isControl=i.params.isControl,s.dispatchDoc.id="",s.showFlag={buttSysFile:!1,isReveiwDS:!1},s.busiFlag={isMerge:!1,isMain:!1},function(){e.initDispatchData(s)}(),s.watchIsRelated=function(){n.$watch("vm.dispatchDoc.isRelated",function(e,t){0!=e&&"0"!=e||9!=t&&"9"!=t||1!=s.sign.isAssociate?0!=t&&"0"!=t||9!=e&&"9"!=e||s.sign.isAssociate&&0!=s.sign.isAssociate||(signcommon.getReviewStage().OTHERS==s.dispatchDoc.dispatchStage||signcommon.getReviewStage().DEVICE_BILL_HOMELAND==s.dispatchDoc.dispatchStage||signcommon.getReviewStage().DEVICE_BILL_IMPORT==s.dispatchDoc.dispatchStage||signcommon.getReviewStage().IMPORT_DEVICE==s.dispatchDoc.dispatchStage?(o.alert("该阶段不能进行关联！"),s.dispatchDoc.isRelated=0):o.confirm({title:"询问提示",message:"您要进行项目关联么？",onOk:function(){s.searchAssociateSign||(s.searchAssociateSign={signid:s.sign.signid,projectname:s.sign.projectname}),s.searchAssociateSign.reviewstage=s.dispatchDoc.dispatchStage,a.getAssociateSign(s.searchAssociateSign,function(e){s.currentAssociateSign=s.sign,s.associateSignList=[],s.noassociateSign=!1,e&&e.length>0?s.associateSignList=e:s.noassociateSign=!0,$("#associateWindow").kendoWindow({width:"80%",height:"620px",title:"项目关联",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()})},onCancel:function(){s.dispatchDoc.isRelated=0}})):o.confirm({title:"询问提示",message:"该项目已经进行了关联，您要解除关联么？",onOk:function(){$(".confirmDialog").modal("hide"),a.saveAssociateSign(i.params.signid,null,function(){o.alert("项目解除关联成功"),window.location.reload()})},onCancel:function(){s.dispatchDoc.isRelated=9},onClose:function(){s.dispatchDoc.isRelated=9}})})},s.associateQuerySign=function(){s.noassociateSign=!1,a.getAssociateSign(s.searchAssociateSign,function(e){s.associateSignList=[],e&&e.length>0?s.associateSignList=e:s.noassociateSign=!0})},s.saveAssociateSign=function(e){if(s.sign.signid==e)return void o.alert("不能关联自身项目");a.saveAssociateSign(s.sign.signid,e,function(t){t.flag||"ok"==t.reCode?(e?(s.sign.isAssociate=1,s.associateDispatchs=t.reObj):s.associateDispatchs=[],o.alert(void 0!=e?"项目关联成功":"项目解除关联成功",function(){window.parent.$("#associateWindow").data("kendoWindow").close()})):o.alert(t.reMsg)})},s.initFileUpload=function(){s.dispatchDoc.id||n.$watch("vm.dispatchDoc.id",function(e,t){e&&e!=t&&!s.initUploadOptionSuccess&&s.initFileUpload()}),s.sysFile={businessId:s.dispatchDoc.id,mainId:s.dispatchDoc.signId,mainType:t.mainTypeValue().SIGN,sysfileType:t.mainTypeValue().DISPATCH,sysBusiType:t.mainTypeValue().DISPATCH},t.initUploadOptions({inputId:"sysfileinput",vm:s})},s.sigleProject=function(){"1"==s.dispatchDoc.dispatchWay?s.busiFlag.isMerge&&s.busiFlag.isMain&&o.confirm({title:"询问提示",message:"该项目已经设为合并发文，并且已经有关联项目，如果现在要取消合并发文，以前的关联信息将被删除，您确定要取消合并发文么?",onOk:function(){e.deleteAllMerge(s.dispatchDoc.signId,function(e){(e.flag||"ok"==e.reCode)&&(s.dispatchDoc.isMainProject="0",s.busiFlag.isMerge=!1,s.busiFlag.isMain=!1),o.alert(e.reMsg)})},onClose:function(){},onCancel:function(){s.dispatchDoc.dispatchWay="2",$(".confirmDialog").modal("hide")}}):"2"==s.dispatchDoc.dispatchWay&&(s.busiFlag.isMerge||(s.busiFlag.isMerge=!0,s.busiFlag.isMain="9"==s.dispatchDoc.isMainProject))},s.create=function(){common.initJqValidation($("#dispatch_form")),$("#dispatch_form").valid()?e.saveDispatch(s):o.alert("提交失败，有红色标识的是必填项，请确认是否填写！")},s.count=function(){var e=/^(-)?(([1-9]{1}\d*)|([0]{1}))(\.(\d){1,4})?$/;if(!e.test(s.dispatchDoc.declareValue))return s.dispatchDoc.declareValue=0,void $("span[data-valmsg-for='declareValue']").html("金额只能输入数字！");if(!e.test(s.dispatchDoc.authorizeValue))return s.dispatchDoc.authorizeValue=0,void $("span[data-valmsg-for='authorizeValue']").html("金额只能输入数字！");$("span[data-valmsg-for='declareValue']").html(""),$("span[data-valmsg-for='authorizeValue']").html("");var t=(parseFloat(s.dispatchDoc.declareValue)-parseFloat(s.dispatchDoc.authorizeValue)).toFixed(2),i=parseFloat(t/s.dispatchDoc.declareValue*1e4/100).toFixed(2);s.dispatchDoc.extraRate=i,s.dispatchDoc.extraValue=t},s.gotoMergePage=function(){s.busiFlag.isMain="9"==s.dispatchDoc.isMainProject,9!=s.dispatchDoc.isMainProject||s.dispatchDoc.id?(e.initMergeInfo(s,s.dispatchDoc.signId),$("#mergeSign").kendoWindow({width:"75%",height:"700px",title:"合并发文",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()):o.alert("请先保存！")},s.chooseSign=function(){var t=$("input[name='mergeSign']:checked");if(0==t.length)o.alert("请选择要合并发文的项目！");else{var i=[];$.each(t,function(e,t){i.push(t.value)}),e.chooseProject(s.dispatchDoc.signId,i.join(","),function(t){(t.flag||"ok"==t.reCode)&&e.initMergeInfo(s,s.dispatchDoc.signId),o.alert(t.reMsg)})}},s.cancelSign=function(){var t=$("input[name='cancelMergeSignid']:checked");if(t.length<1)o.alert("请选择要取消合并发文的项目！");else{var i=[];$.each(t,function(e,t){i.push(t.value)}),e.cancelProject(s.dispatchDoc.signId,i.join(","),function(t){(t.flag||"ok"==t.reCode)&&e.initMergeInfo(s,s.dispatchDoc.signId),o.alert(t.reMsg)})}},s.onClose=function(){window.parent.$("#mwindow").data("kendoWindow").close()},s.filterSign=function(e){var t=!0;if(s.searchSign.projectname&&-1==e.projectname.indexOf(s.searchSign.projectname)&&(t=!1),s.searchSign.reviewstage&&e.reviewstage!=s.searchSign.reviewstage&&(t=!1),t)return e},s.formReset=function(){s.searchSign={}},s.templatePage=function(e){r.templatePage(e)}}angular.module("app").controller("dispatchEditCtrl",e),e.$inject=["dispatchSvc","sysfileSvc","$state","bsWin","$scope","signSvc","templatePrintSvc"]}(),function(){"dispatch strict";function e(e,t,i,o){function n(e,t){u(t,function(t){e.unMergeSign=[],e.unMergeSign=t}),d(t,function(t){e.mergeSign=[],e.mergeSign=t})}function a(e){e.busiFlag.signleToMerge=!1;var o={method:"get",url:rootPath+"/dispatch/initData",params:{signid:e.dispatchDoc.signId}},n=function(t){var o=t.data;e.sign=o.sign,e.dispatchDoc=o.dispatch,e.dispatchDoc.authorizeValue=0,e.dispatchDoc.signId=i.params.signid,e.dispatchDoc.dispatchWay&&2==e.dispatchDoc.dispatchWay&&(e.busiFlag.isMerge=!0),e.dispatchDoc.isMainProject&&9==e.dispatchDoc.isMainProject&&(e.busiFlag.isMain=!0),e.associateDispatchs=o.associateDispatchs,e.proofread=o.mainUserList,2==e.dispatchDoc.dispatchWay&&0==e.dispatchDoc.isMainProject&&(e.showFlag.isReveiwDS=!0),e.initFileUpload(),e.watchIsRelated()};common.http({vm:e,$http:t,httpOptions:o,success:n})}function r(e){e.isCommit=!0;var i={method:"post",url:rootPath+"/dispatch",data:e.dispatchDoc},n=function(t){e.isCommit=!1,(t.data.flag||"ok"==t.data.reCode)&&(e.dispatchDoc.dispatchWay&&2==e.dispatchDoc.dispatchWay&&(e.busiFlag.isMerge=!0),e.dispatchDoc.isMainProject&&9==e.dispatchDoc.isMainProject&&(e.busiFlag.isMain=!0),e.dispatchDoc.id||(e.dispatchDoc.id=t.data.reObj.id)),o.alert(t.data.reMsg)};common.http({$http:t,httpOptions:i,success:n,onError:function(){e.isCommit=!1}})}function s(e,i,o){var n={method:"post",url:rootPath+"/signView/mergeSign",params:{signId:e,mergeIds:i,mergeType:"2"}},a=function(e){void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:t,httpOptions:n,success:a})}function l(e,i,o){var n={signId:e,mergeType:"2"};i&&(n.cancelIds=i);var a={method:"post",url:rootPath+"/signView/cancelMergeSign",params:n},r=function(e){void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:t,httpOptions:a,success:r})}function c(e,i){var o={method:"post",url:rootPath+"/signView/deleteAllMerge",params:{signId:e,mergeType:"2"}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:t,httpOptions:o,success:n})}function d(e,i){var o={method:"post",url:rootPath+"/signView/getMergeDISSign",params:{signId:e}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:t,httpOptions:o,success:n})}function u(e,i){var o={method:"post",url:rootPath+"/signView/unMergeDISSign",params:{signId:e}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:t,httpOptions:o,success:n})}return{initDispatchData:a,saveDispatch:r,initMergeInfo:n,unMergeDISSign:u,getMergeDISSign:d,chooseProject:s,cancelProject:l,deleteAllMerge:c}}angular.module("app").factory("dispatchSvc",e),e.$inject=["sysfileSvc","$http","$state","bsWin"]}(),function(){"use strict";function e(e,t,i){var o=this;o.title="专家审核",function(){t.auditGrid(o)}(),o.searchAudit=function(){t.searchAudit(o)},o.auditToOfficial=function(){t.auditTo(o,2)},o.auditToAlternative=function(){t.auditTo(o,3)},o.auditToStop=function(){t.auditTo(o,4)},o.auditToRemove=function(){t.auditTo(o,0)},o.officialToAudit=function(){t.toAudit(o,2)},o.alternativeToAudit=function(){t.toAudit(o,3)},o.stopToAudit=function(){t.toAudit(o,4)},o.temoveToAudit=function(){t.toAudit(o,5)},o.findExportDetail=function(e){o.model={},o.reviewProjectList=[],t.getExpertById(e,function(e){o.model=e,$("#auditExportDetail").kendoWindow({width:"80%",height:"620px",title:"专家详细信息",visible:!1,modal:!0,open:function(){$("#expertPhotoSrc").attr("src",rootPath+"/expert/transportImg?expertId="+o.model.expertID+"&t="+Math.random()),$("#myTab li").click(function(e){var t=$("a",this);e.preventDefault(),t.tab("show");var i=t.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500)}),o.reviewProjectList=[],t.reviewProjectGrid(o.model.expertID,function(e){o.isLoading=!1,e&&e.length>0?(o.reviewProjectList=e,o.noData=!1):o.noData=!0})},closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()})}}angular.module("app").controller("expertAuditCtrl",e),e.$inject=["$scope","expertSvc","templatePrintSvc"]}(),function(){"expert strict";function e(e,t,i,o,n){var a=this;a.data={},a.title="专家列表",a.expertId="",a.headerType="专家类型",a.fileName="专家信息",a.expert={},a.expertList=new Array(10),function(){t.grid(a)}(),a.search=function(){t.searchMuti(a)},a.searchAudit=function(){t.searchMAudit(a)},a.formReset=function(){t.formReset(a)},a.del=function(e){common.confirm({vm:a,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteExpert(a,e,function(e){a.isSubmit=!1,a.gridOptions.dataSource.read()})}})},a.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:a,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");a.del(o)}},a.findExportDetail=function(e){t.getExpertById(e,function(e){a.model=e,$("#queryExportDetail").kendoWindow({width:"80%",height:"620px",title:"专家详细信息",visible:!1,modal:!0,open:function(){$("#expertPhotoSrc").attr("src",rootPath+"/expert/transportImg?expertId="+a.model.expertID+"&t="+Math.random()),$("#myTab li").click(function(e){var t=$("a",this);e.preventDefault(),t.tab("show");var i=t.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500)}),a.editPrint=function(){o.templatePrint("expertApply_templ")},a.reviewProjectList=[],t.reviewProjectGrid(a.model.expertID,function(e){a.isLoading=!1,e&&e.length>0?(a.reviewProjectList=e,a.noData=!1):a.noData=!0})},closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()})},a.exportToExcel=function(){t.exportToExcel(a)},a.selectHeader=function(){n.selectHeaderWindow(a,a.headerType)}}angular.module("app").controller("expertCtrl",e),e.$inject=["$scope","expertSvc","$state","templatePrintSvc","headerSvc"]}(),function(){"expert strict";function e(e,t,i,o,n,a,r,s){function l(e){var t={language:"zh",allowedPreviewTypes:["image"],allowedFileExtensions:["jpg","png","gif"],maxFileSize:2e3,showRemove:!1,uploadUrl:rootPath+"/expert/uploadPhoto",uploadExtraData:{expertId:e.model.expertID}};$("#expertphotofile").fileinput(t).on("filebatchselected",function(e,t){}).on("fileuploaded",function(t,i){$("#expertPhotoSrc").removeAttr("src"),$("#expertPhotoSrc").attr("src",rootPath+"/expert/transportImg?expertId="+e.model.expertID+"&t="+Math.random())})}var c=this;c.model={},c.data={},c.title="专家信息编辑",c.isuserExist=!1,c.expertID=r.params.id,c.showSS=!0,c.showSC=!1,c.showWS=!0,c.showWC=!1,c.MW=!1,c.MS=!1,c.expertList=new Array(10),function(){c.expertID&&o.getExpertById(c.expertID,function(e){c.model=e,c.showSS=!1,c.showSC=!0,c.showWS=!1,c.showWC=!0,l(c),$("#expertPhotoSrc").attr("src",rootPath+"/expert/transportImg?expertId="+c.model.expertID+"&t="+Math.random())})}(),c.selReviewProject=function(){c.model.expertID&&$("#reviewProject").kendoWindow({width:"75%",height:"600px",title:"评审项目列表",visible:!1,open:function(){c.isLoading=!0,c.reviewProjectList=[],o.reviewProjectGrid(c.model.expertID,function(e){c.isLoading=!1,e&&e.length>0?(c.reviewProjectList=e,c.noData=!1):c.noData=!0})},modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()},c.queryDetail=function(e,t){$("#reviewProject").data("kendoWindow").close(),r.go("signDetails",{signid:e,processInstanceId:t})},c.showUploadWin=function(){c.model.expertID?$("#uploadWin").kendoWindow({width:"660px",height:"360px",title:"上传头像",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open():common.alert({vm:c,msg:"先保存数据在执行操作！"})},c.saveEP=function(){common.initJqValidation(),$("form").valid()?(c.isSubmit=!0,c.model.birthDay=$("#birthDay").val(),c.model.graduateDate=$("#graduateDate").val(),o.saveExpert(c.model,c.isSubmit,function(t){c.isSubmit=!1,t.flag||"ok"==t.reCode?(c.model.expertID=t.reObj.expertID,c.model.expertNo=t.reObj.expertNo,e.success("保存成功！")):e.error(t.reMsg)})):e.alert("专家信息没有填写完整")},c.gotoWPage=function(){c.model.expertID?$("#wrwindow").kendoWindow({width:"680px",height:"420px",title:"工作简历",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open():e.alert("请先保存专家信息！")},c.saveWorks=function(){common.initJqValidation($("#workForm")),$("#workForm").valid()&&(c.work.expertID||(c.work.expertID=c.model.expertID),i.saveWork(c.work,function(t){t.flag||"ok"==t.reCode?(c.work.weID?$.each(c.model.workDtoList,function(e,i){i.weID==c.work.weID&&(i=t.reObj)}):(c.model.workDtoList||(c.model.workDtoList=[]),c.model.workDtoList.push(t.reObj)),e.success(t.reMsg,function(){c.work={},c.onWClose()})):e.error(t.reMsg)}))},c.updateWork=function(){var t=$("input[name='checkwr']:checked");if(t.length<1)e.alert("请选择要更改的项目经历信息！");else if(t.length>1)e.alert("每次只能更改一条记录！");else{var i=t.val();$.each(c.model.workDtoList,function(e,t){t.weID==i&&(c.work=t)}),c.gotoWPage()}},c.deleteWork=function(){var t=$("input[name='checkwr']:checked");if(t.length<1)e.alert("请选择要删除的工作简历");else{var o=[];$.each(t,function(e,t){o.push(t.value)}),i.deleteWork(o.join(","),function(){$.each(o,function(e,t){$.each(c.model.workDtoList,function(e,i){i&&i.weID==t&&c.model.workDtoList.splice(e,1)})}),e.alert("操作成功！")})}},c.onWClose=function(){window.parent.$("#wrwindow").data("kendoWindow").close()},c.gotoJPage=function(){c.model.expertID?$("#pjwindow").kendoWindow({width:"690px",height:"330px",title:"添加项目经验",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open():e.alert("请先保存专家信息！")},c.saveProject=function(){common.initJqValidation($("#ProjectForm")),$("#ProjectForm").valid()&&(c.project.expertID||(c.project.expertID=c.model.expertID),c.project.projectbeginTime=$("#projectbeginTime").val(),c.project.projectendTime=$("#projectendTime").val(),t.saveProject(c.project,function(t){t.flag||"ok"==t.reCode?(c.project.peID?$.each(c.model.projectDtoList,function(e,i){i.peID==c.project.peID&&(i=t.reObj)}):(c.model.projectDtoList||(c.model.projectDtoList=[]),c.model.projectDtoList.push(t.reObj)),e.success(t.reMsg,function(){c.project={},c.onPClose()})):e.error(t.reMsg)}))},c.updateProjectPage=function(){var t=$("input[name='checkpj']:checked");if(t.length<1)e.alert("请选择要更改的项目经历信息！");else if(t.length>1)e.alert("每次只能更改一条记录！");else{var i=t.val();$.each(c.model.projectDtoList,function(e,t){t.peID==i&&(c.project=t)}),c.gotoJPage()}},c.delertProject=function(){common.initJqValidation();var i=$("input[name='checkpj']:checked");if(i.length<1)e.alert("请选择要删除的操作对象!");else{var o=[];$.each(i,function(e,t){o.push(t.value)}),t.delertProject(o.join(","),function(){$.each(o,function(e,t){$.each(c.model.projectDtoList,function(e,i){i&&i.peID==t&&c.model.projectDtoList.splice(e,1)})}),e.alert("操作成功！")})}},c.onPClose=function(){window.parent.$("#pjwindow").data("kendoWindow").close()},c.gotoExpertType=function(){c.model.expertID?$("#addExpertType").kendoWindow({width:"680px",height:"400px",title:"专家类型",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open():e.alert("请先保存专家信息！")},c.onETlose=function(){a.cleanValue(),window.parent.$("#addExpertType").data("kendoWindow").close()},c.saveExpertType=function(){common.initJqValidation($("#expertTypeForm")),$("#expertTypeForm").valid()&&(c.expertType.expertID||(c.expertType.expertID=c.model.expertID),a.saveExpertType(c.expertType,function(t){t.flag||"ok"==t.reCode?(c.expertType.id?$.each(c.model.expertTypeDtoList,function(e,i){i.id==c.expertType.id&&(i=t.reObj)}):(c.model.expertTypeDtoList||(c.model.expertTypeDtoList=[]),c.model.expertTypeDtoList.push(t.reObj)),e.success(t.reMsg,function(){c.expertType={},c.onETlose()})):e.error(t.reMsg)}))},c.updateProjectType=function(){var t=$("input[name='checkEType']:checked");if(t.length<1)e.alert("请选择要更改的专业信息！");else if(t.length>1)e.alert("每次只能更改一条记录！");else{var i=t.val();$.each(c.model.expertTypeDtoList,function(e,t){t.id==i&&(c.expertType=t)}),c.expertType.majobSmallDicts=s.topSelectChange(c.expertType.maJorBig,s.DICT.MAJOR.dicts),c.gotoExpertType()}},c.delertProjectType=function(){var t=$("input[name='checkEType']:checked");if(t.length<1)e.alert("请选择删除的专家类别信息！");else{var i=[];$.each(t,function(e,t){i.push(t.value)}),a.deleteExpertType(i.join(","),function(){$.each(i,function(e,t){$.each(c.model.expertTypeDtoList,function(e,i){i&&i.id==t&&c.model.expertTypeDtoList.splice(e,1)})}),e.alert("操作成功！")})}},c.gotoOfferPage=function(){c.model.expertID?$("#ep_offer_div").kendoWindow({width:"820px",height:"600px",title:"专家聘书",visible:!1,modal:!0,closable:!0,close:function(){c.showProjectOffer=!1},actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open():e.alert("先保存专家信息！")},c.saveOffer=function(){common.initJqValidation($("#expert_offer_form")),$("#expert_offer_form").valid()&&(c.expertOffer.expertId=c.model.expertID,n.saveOffer(c.expertOffer,function(t){t.flag||"ok"==t.reCode?(c.expertOffer.id?$.each(c.model.expertOfferDtoList,function(e,i){i.id==c.expertOffer.id&&(i=t.reObj)}):(c.model.expertOfferDtoList||(c.model.expertOfferDtoList=[]),c.model.expertOfferDtoList.push(t.reObj)),e.success(t.reMsg,function(){c.expertOffer={},c.onETlose()})):e.error(t.reMsg)}))},c.closeOffer=function(){c.showProjectOffer=!1,window.parent.$("#ep_offer_div").data("kendoWindow").close()},c.showOffer=function(){var t=$("input[name='checkps']:checked");if(t.length<1)e.alert("请选择要查看的聘书信息！");else if(t.length>1)e.alert("每次只能查看一条记录！");else{var i=t.val();$.each(c.model.expertOfferDtoList,function(e,t){if(t.id==i)return void(c.expertOffer=t)}),c.showProjectOffer=!0,c.gotoOfferPage()}},c.chooseMW=function(){c.MW=!0,c.showWS=!0,c.showWC=!1},c.cancelMW=function(){c.showWS=!1,c.showWC=!0},c.sureMW=function(){c.majorWork?(c.model.majorWork=c.majorWork,c.showWS=!1,c.showWC=!0):common.alert({vm:c,msg:"您未选择专业，请选择！",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}})},c.chooseMS=function(){c.MS=!0,c.showSS=!0,c.showSC=!1},c.cancelMS=function(){c.showSS=!1,c.showSC=!0},c.sureMS=function(){c.majorStudy?(c.model.majorStudy=c.majorStudy,c.showSS=!1,c.showSC=!0):common.alert({vm:c,msg:"您未选择专业，请选择！",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}})},c.queryDetail=function(e,t){$("#reviewProject").data("kendoWindow").close(),r.go("signDetails",{signid:e,processInstanceId:t})},c.editPrint=function(){o.expertPrint(c)}}angular.module("app").controller("expertEditCtrl",e),e.$inject=["bsWin","projectExpeSvc","workExpeSvc","expertSvc","expertOfferSvc","expertTypeSvc","$state","$rootScope"]}(),function(){"use strict";function e(e,t,i){var o=this;!function(){t.repeatGrid(o)}(),o.findExportDetail=function(e){t.getExpertById(e,function(e){o.model=e,$("#reExportDetail").kendoWindow({width:"80%",height:"auto",title:"专家详细信息",visible:!1,modal:!0,open:function(){$("#expertPhotoSrc").attr("src",rootPath+"/expert/transportImg?expertId="+o.model.expertID+"&t="+Math.random())},closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()})},o.del=function(e){i.confirm("删除数据不可恢复，确认删除数据吗？",function(){t.deleteExpertData(o,e,function(e){i.alert("操作成功",function(){o.repeatGridOptions.dataSource.read()})})})},o.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)i.alert("请选择数据");else{for(var t=[],n=0;n<e.length;n++)t.push(e[n].value);var a=t.join(",");o.del(a)}}}angular.module("app").controller("expertRepeatCtrl",e),e.$inject=["$location","expertSvc","bsWin"]}(),function(){"expert strict";function e(e,t){function i(){o.isSubmit=!0,o.noData=!1,t.expertScoreHis(o.selectHis,function(e){o.isSubmit=!1,o.expScoreList=e,o.expScoreList&&0!=o.expScoreList.length||(o.noData=!0)})}var o=this;o.data={},o.title="专家评分统计",o.selectHis={},o.selectHis.beginTime=(new Date).yearAgo(1),o.selectHis.endTime=(new Date).Format("yyyy-MM-dd"),o.expScoreList=[],i(),o.search=function(){o.selectHis.scoreBegin?o.selectHis.scoreEnd?o.selectHis.score=o.selectHis.scoreBegin+o.selectHis.scoreEnd:o.selectHis.score=o.selectHis.scoreBegin+5:o.selectHis.score=1+o.selectHis.scoreEnd,i()},o.formReset=function(){o.selectHis={}}}angular.module("app").controller("expertScoreCtrl",e),e.$inject=["$location","expertSvc"]}(),function(){"expert strict";function e(e,t){function i(){o.isSubmit=!0,o.noData=!1,t.expertSelectHis(o.selectHis,function(e){o.isSubmit=!1,o.expSelectList=e,e&&0!=e.length||(o.noData=!0)})}var o=this;o.title="专家抽取统计",o.selectHis={},o.selectHis.beginTime=(new Date).yearAgo(1),o.selectHis.endTime=(new Date).Format("yyyy-MM-dd"),o.expSelectList=[],i(),o.search=function(){i()},o.formReset=function(){o.selectHis={}}}angular.module("app").controller("expertSelectHisCtrl",e),e.$inject=["$location","expertSvc"]}(),function(){"expert strict";function e(e,t,i,o){function n(){o.templatePrint("expertApply_templ")}function a(e){$("#searchform")[0].reset(),e.gridOptions.dataSource.read()}function r(t,i,o){t.isSubmit=!0;var n={method:"delete",url:D,params:{id:i}},a=function(e){t.isSubmit=!1,void 0!=o&&"function"==typeof o&&o(e.data)};common.http({vm:t,$http:e,httpOptions:n,success:a})}function s(t,i,o){t.isSubmit=!0;var n={method:"delete",url:rootPath+"/expert/deleteExpertData",params:{id:i}},a=function(e){t.isSubmit=!1,void 0!=o&&"function"==typeof o&&o(e.data)};common.http({vm:t,$http:e,httpOptions:n,success:a})}function l(e){e.gridOptions.dataSource._skip=0,e.gridOptions.dataSource.read()}function c(t,i,o){i=!0;var n={method:"post",url:rootPath+"/expert",data:t},a=function(e){i=!1,void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a,onError:function(){i=!1}})}function d(t,i){var o={method:"post",url:D+"/findById",params:{id:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function u(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findByOData",$("#searchform"),{$filter:"state ne 0"}),schema:common.kendoGridConfig().schema({id:"expertID",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"applyDate",dir:"desc"}}),i=function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})};e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:m(e),dataBound:i,resizable:!0}}function m(e){return[{field:"rowNumber",title:"序号",width:50,attributes:{class:"table-cell",style:"text-align: center"},template:"<span class='row-number'></span>",filterable:!1},{field:"name",title:"姓名",width:80,filterable:!1,template:function(e){return"<a  ng-click=\"vm.findExportDetail('"+e.expertID+"')\">"+e.name+"</a>"}},{field:"comPany",title:"工作单位",width:300,filterable:!1},{field:"phone",title:"办公电话",width:120,filterable:!1},{field:"userPhone",title:"手机号码",width:120,filterable:!1},{field:"job",title:"职位",width:150,filterable:!1},{field:"post",title:"职称",width:120,filterable:!1},{field:"expertSort",title:"专家类型",width:150,filterable:!1},{field:"compositeScore",title:"评分",width:60,filterable:!1},{field:"",title:"操作",width:80,template:function(e){var t=!0;return t="5"!=e.state,common.format($("#columnBtns").html(),"vm.del('"+e.expertID+"')",e.expertID,t)}}]}function p(){return[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.expertID)},filterable:!1,width:25,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"name",title:"姓名",width:60,filterable:!1,template:function(e){return"<a  ng-click=\"vm.findExportDetail('"+e.expertID+"')\">"+e.name+"</a>"}},{field:"degRee",title:"学位",width:50,filterable:!1},{field:"post",title:"职称",width:70,filterable:!1},{field:"applyDate",title:"录入时间",width:70,filterable:!1,format:"{0: yyyy-MM-dd}"},{field:"compositeScore",title:"专家星级",width:70,filterable:!1},{field:"comPany",title:"工作单位",width:120,filterable:!1}]}function f(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findByOData",$("#auditform"),{$filter:"state eq '1'"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:25,sort:{field:"createdDate",dir:"desc"}}),i=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findByOData",$("#auditform"),{$filter:"state eq '2'"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:5,sort:{field:"createdDate",dir:"desc"}}),o=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findByOData",$("#auditform"),{$filter:"state eq '3'"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:5,sort:{field:"createdDate",dir:"desc"}}),n=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findByOData",$("#auditform"),{$filter:"state eq '4'"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:5,sort:{field:"createdDate",dir:"desc"}}),a=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findByOData",$("#auditform"),{$filter:"state eq '0'"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:5,sort:{field:"createdDate",dir:"desc"}}),r=function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})};e.gridOptions1={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:p(),dataBound:r,resizable:!0},e.gridOptions2={dataSource:common.gridDataSource(i),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:p(),dataBound:r,resizable:!0},e.gridOptions3={dataSource:common.gridDataSource(o),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:p(),dataBound:r,resizable:!0},e.gridOptions4={dataSource:common.gridDataSource(n),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:p(),dataBound:r,resizable:!0},e.gridOptions5={dataSource:common.gridDataSource(a),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:p(),dataBound:r,resizable:!0}}function h(e){e.gridOptions1.dataSource._skip=0,e.gridOptions2.dataSource._skip=0,e.gridOptions3.dataSource._skip=0,e.gridOptions4.dataSource._skip=0,e.gridOptions5.dataSource._skip=0,$("#state").val("1"),e.gridOptions1.dataSource.read(),$("#state").val("2"),e.gridOptions2.dataSource.read(),$("#state").val("3"),e.gridOptions3.dataSource.read(),$("#state").val("4"),e.gridOptions4.dataSource.read(),$("#state").val("0"),e.gridOptions5.dataSource.read()}function g(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findRepeatByOData"),schema:common.kendoGridConfig().schema({id:"id"}),rowNumber:!0,headerCenter:!0}),i=function(){var e=this.items();$(e).each(function(e){$(this).find(".row-number").html(e+1)})};e.repeatGridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:m(e),dataBound:i,resizable:!0}}function v(e,t){var i=common.getKendoCheckId("#grid"+t);if(0==i.length)common.alert({vm:e,msg:"请选择数据"});else{for(var o=[],n=0;n<i.length;n++)o.push(i[n].value);w(e,o.join(","),1)}}function y(e,t){var i=common.getKendoCheckId("#grid1");if(0==i.length)common.alert({vm:e,msg:"请选择数据"});else{for(var o=[],n=0;n<i.length;n++)o.push(i[n].value);w(e,o.join(","),t)}}function w(t,i,o){t.isSubmit=!0;var n={method:"post",url:D+"/updateAudit",params:{ids:i,flag:o}},a=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.isSubmit=!1,t.gridOptions1.dataSource.read(),t.gridOptions2.dataSource.read(),t.gridOptions3.dataSource.read(),t.gridOptions4.dataSource.read(),t.gridOptions5.dataSource.read(),common.alert({vm:t,msg:"操作成功"})}})};common.http({vm:t,$http:e,httpOptions:n,success:a})}function b(o){var n={method:"post",url:rootPath+"/expert/exportToExcel",responseType:"arraybuffer",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},data:{$filter:common.buildOdataFilter($("#searchform"))},transformRequest:function(e){var t=[];for(var i in e)t.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]));return t.join("&")}},a=function(e){var o=new i([e.data],{type:"application/vnd.ms-excel"});t.saveAs(o,"专家信息.xls")};common.http({$http:e,httpOptions:n,success:a})}function S(t,i){var o={method:"post",url:rootPath+"/expert/expertSelectHis",data:t},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function k(t,i){var o={method:"post",url:rootPath+"/expert/expertScoreHis",data:t},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)}
;common.http({$http:e,httpOptions:o,success:n})}function C(t,i){var o={method:"post",url:rootPath+"/expert/reviewProject",params:{expertId:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}var D=rootPath+"/expert";return{grid:u,auditGrid:f,getExpertById:d,saveExpert:c,deleteExpert:r,deleteExpertData:s,searchMuti:l,searchAudit:h,repeatGrid:g,updateAudit:w,toAudit:v,auditTo:y,formReset:a,exportToExcel:b,expertSelectHis:S,expertScoreHis:k,reviewProjectGrid:C,expertPrint:n}}angular.module("app").factory("expertSvc",e),e.$inject=["$http","FileSaver","Blob","templatePrintSvc"]}(),function(){"expertType strict";function e(e,t,i,o){function n(){var e=$("#addExpertType").find("input");$.each(e,function(e,t){t.value=""})}function a(t){var i={method:"GET",url:rootPath+"/expertType/getExpertType?$filter=expert.expertID eq '"+t.model.expertID+"'"},o=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.expertTypeList=e.data}})};common.http({vm:t,$http:e,httpOptions:i,success:o})}function r(t){var o={method:"get",url:rootPath+"/expertType/getExpertTypeById",params:{expertTypeId:t.expertTypeId}},n=function(e){t.expertType=e.data,t.expertType.majobSmallDicts=i.topSelectChange(t.expertType.maJorBig,i.DICT.MAJOR.dicts)};common.http({vm:t,$http:e,httpOptions:o,success:n})}function s(t,i){var o={method:"post",url:rootPath+"/expertType",data:t},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function l(i){if(common.initJqValidation($("#expertTypeForm")),$("#expertTypeForm").valid()){i.expertType.expertID=i.expertID;var o={method:"put",url:rootPath+"/expertType",data:i.expertType},a=function(e){common.requestSuccess({vm:i,response:e,fn:function(){window.parent.$("#addExpertType").data("kendoWindow").close(),t.getExpertById(i),n(),common.alert({vm:i,msg:"操作成功",fn:function(){i.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:i,$http:e,httpOptions:o,success:a})}}function c(t,i){var o={method:"delete",url:rootPath+"/expertType",params:{ids:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}return{cleanValue:n,getExpertType:a,getExpertTypeById:r,saveUpdate:l,deleteExpertType:c,saveExpertType:s}}angular.module("app").factory("expertTypeSvc",e),e.$inject=["$http","expertSvc","$rootScope","bsWin"]}(),function(){"projectExpe strict";function e(e){function t(t){var i={method:"get",url:rootPath+"/dict/getAllDictByCode",params:{dictCode:"PROJECTTYPE"}},o=function(e){t.projectTypes=e.data};common.http({vm:t,$http:e,httpOptions:i,success:o})}function i(t,i){var o={method:"delete",url:rootPath+"/projectExpe/deleteProject",params:{ids:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function o(t){var i={method:"get",url:common.format(rootPath+"/projectExpe/getProject?$filter=peID eq '{0}'",t.peID)},o=function(e){t.project={},t.project.projectName=e.data[0].projectName,t.project.projectType=e.data[0].projectType,t.project.projectbeginTime=e.data[0].projectbeginTime,t.project.projectendTime=e.data[0].projectendTime,t.isUpdate};common.http({vm:t,$http:e,httpOptions:i,success:o})}function n(t){if(common.initJqValidation($("#ProjectForm")),$("#ProjectForm").valid()){t.isSubmit=!0,t.project.peID=t.peID,t.project.expertID=t.expertID,t.project.projectbeginTime=$("#projectbeginTime").val(),t.project.projectendTime=$("#projectendTime").val();var i={method:"put",url:rootPath+"/projectExpe/updateProject",data:t.project},o=function(e){common.requestSuccess({vm:t,response:e,fn:function(){window.parent.$("#pjwindow").data("kendoWindow").close(),a(t),common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})}}common.http({vm:t,$http:e,httpOptions:i,success:o})}function a(t){var i={method:"GET",url:rootPath+"/projectExpe/getProject?$filter=expert.expertID eq '"+t.model.expertID+"'"},o=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.projectList=e.data}})};common.http({vm:t,$http:e,httpOptions:i,success:o})}function r(e){var t=$("input[name='checkpj']:checked");t.length<1?common.alert({vm:e,msg:"请选择操作对象",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}}):t.length>1?common.alert({vm:e,msg:"无法同时操作多条数据",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}}):(e.peID=t.val(),o(e),e.expertID=e.model.expertID,gotoJPage(e))}function s(t,i){var o={method:"post",url:rootPath+"/projectExpe/saveExpe",data:t},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}return{getProject:a,saveProject:s,updateProject:n,updateProjectPage:r,getProjectById:o,delertProject:i,initProjectType:t}}angular.module("app").factory("projectExpeSvc",e),e.$inject=["$http"]}(),function(){"workExpe strict";function e(e,t){function i(t){var i={method:"GET",url:rootPath+"/workExpe/getWork?$filter=expert.expertID eq '"+t.model.expertID+"'"},o=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.workList=e.data}})};common.http({vm:t,$http:e,httpOptions:i,success:o})}function o(t,i){var o={method:"delete",url:rootPath+"/workExpe/deleteWork",params:{ids:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function n(e){var t=$("input[name='checkwr']:checked");t.length<1?common.alert({vm:e,msg:"请选择操作对象",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}}):t.length>1?common.alert({vm:e,msg:"无法同时操作多条数据",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}}):(e.weID=t.val(),a(e),gotoWPage(e),e.expertID=e.model.expertID)}function a(t){var i={method:"get",url:common.format(rootPath+"/workExpe/getWork?$filter=weID eq '{0}'",t.weID)},o=function(e){t.work={},t.work.companyName=e.data[0].companyName,t.work.workJob=e.data[0].workJob,t.work.beginTime=e.data[0].beginTime,t.work.endTime=e.data[0].endTime};common.http({vm:t,$http:e,httpOptions:i,success:o})}function r(t,i){var o={method:"post",url:rootPath+"/workExpe/saveWorkExpe",data:t},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function s(t){if(common.initJqValidation(),$("form").valid()){t.work.weID=t.weID,t.work.expertID=t.expertID,t.work.beginTime=$("#beginTime").val(),t.work.endTime=$("#endTime").val();var o={method:"put",url:rootPath+"/workExpe/updateWork",data:t.work},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){window.parent.$("#wrwindow").data("kendoWindow").close(),i(t),cleanValue(),common.alert({vm:t,msg:"操作成功",fn:function(){t.showWorkHistory=!0,$(".alertDialog").modal("hide")}})}})};common.http({vm:t,$http:e,httpOptions:o,success:n})}}return{saveWork:r,updateWork:s,deleteWork:o,updateWorkPage:n,getWorkById:a,getWork:i}}angular.module("app").factory("workExpeSvc",e),e.$inject=["$http","expertSvc"]}(),function(){"use strict";function e(e,t){function i(t,i){var o={method:"post",url:rootPath+"/expertOffer",data:t},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function o(i){if(common.initJqValidation($("#expert_offer_form")),$("#expert_offer_form").valid()){i.expertOffer.expertId=i.model.expertID;var o={method:"put",url:rootPath+"/expertOffer",data:i.expertOffer},n=function(e){common.requestSuccess({vm:i,response:e,fn:function(){t.getExpertById(i),common.alert({vm:i,msg:"操作成功"})}})};common.http({vm:i,$http:e,httpOptions:o,success:n})}}return{saveOffer:i,updateOffer:o}}angular.module("app").factory("expertOfferSvc",e),e.$inject=["$http","expertSvc"]}(),function(){"use strict";function e(e,t){var i=this;i.title="专家列表",i.del=function(e){common.confirm({vm:i,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteExpertReview(i,e)}})},i.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:i,msg:"请选择数据"});else{for(var t=[],o=0;o<e.length;o++)t.push(e[o].value);var n=t.join(",");i.del(n)}},function(){t.initExpertGrid(i),t.getReviewList(i)}()}angular.module("app").controller("expertReviewCtrl",e),e.$inject=["$location","expertReviewSvc"]}(),function(){"use strict";function e(e,t,i){var o=this;o.title="添加附件",o.isuserExist=!1,o.id=i.params.id,o.id&&(o.isUpdate=!0,o.title="更新附件"),o.create=function(){t.createExpertReview(o)},o.update=function(){t.updateExpertReview(o)},function(){o.isUpdate&&t.getExpertReviewById(o)}()}angular.module("app").controller("expertReviewEditCtrl",e),e.$inject=["$location","expertReviewSvc","$state"]}(),function(){"use strict";function e(e,t,i,o,n,a){function r(e){return!!(/^(\+|-)?\d+$/.test(e)&&e>0)}function s(){if(l.expertReview.expertSelConditionDtoList.length>0){var e=!0;return l.expertReview.expertSelConditionDtoList.forEach(function(t,i){l.expertReview.id&&(t.expertReviewDto={},t.expertReviewDto.id=l.expertReview.id),t.officialNum&&r(t.officialNum)||($("#errorsOfficialNum"+t.id).html("必填，且为数字"),e=!1),t.alternativeNum&&r(t.alternativeNum)||($("#errorsAlternativeNum"+t.id).html("必填，且为数字"),e=!1),e&&($("#errorsOfficialNum"+t.id).html(""),$("#errorsAlternativeNum"+t.id).html(""))}),e}return!1}var l=this;l.title="选择专家",l.conMaxIndex=0,l.customCondition=new Array,l.expertReview={},l.confirmEPList=[],l.confirmEPListReplace=[],l.matchEPMap={},l.selectIds=[],l.businessId=o.params.businessId,l.minBusinessId=o.params.minBusinessId,l.businessType=o.params.businessType;o.params.expertID;l.isSuperUser=isSuperUser,l.saveNewExpertFlag=0,l.reviewType=o.params.reviewType,l.findExportDetail=function(e){i.getExpertById(e,function(e){l.model=e,$("#selectExportDetail").kendoWindow({width:"80%",height:"auto",title:"专家详细信息",visible:!1,modal:!0,open:function(){$("#expertPhotoSrc").attr("src",rootPath+"/expert/transportImg?expertId="+l.model.expertID+"&t="+Math.random())},closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()})},l.reFleshSelEPInfo=function(e){$.each(e,function(e,t){void 0!=t.expertDto.expertTypeDtoList&&t.expertDto.expertTypeDtoList.length>0&&(t.maJorBig=t.expertDto.expertTypeDtoList[0].maJorBig,t.maJorSmall=t.expertDto.expertTypeDtoList[0].maJorSmall,t.expeRttype=t.expertDto.expertTypeDtoList[0].expertType),l.confirmEPList.push(t),"专家函评"==l.reviewType&&"9"!=t.isLetterRw?t.isLetterRw=9:"专家评审会"==l.reviewType&&"0"!=t.isLetterRw&&(t.isLetterRw=0),l.confirmEPListReplace.length>0&&(l.confirmEPListReplace.push(t),l.saveExpert(!1)),l.selectIds.push(t.expertDto.expertID)}),l.excludeIds=l.selectIds.join(",")},l.reFleshAfterRemove=function(e){$.each(e,function(e,t){$.each(l.confirmEPList,function(e,i){i&&t==i.id&&l.confirmEPList.splice(e,1)}),$.each(l.confirmEPListReplace,function(e,i){i&&t==i.id&&l.confirmEPListReplace.splice(e,1)})})},l.reFleshJoinState=function(e,t){$.each(e,function(e,i){$.each(l.confirmEPList,function(e,o){i==o.id&&(o.isJoin=t)}),l.confirmEPListReplace.length>0&&$.each(l.confirmEPListReplace,function(e,o){i==o.id&&(o.isJoin=t)})})},l.reFleshConfirmState=function(e,t){$.each(e,function(e,i){$.each(l.confirmEPList,function(e,o){i==o.id&&(o.isConfrim=t)}),$.each(l.confirmEPListReplace,function(e,o){i==o.id&&(o.isConfrim=t)})})},l.updateSelectedIndex=function(e){e?$.each(l.expertReview.expertSelConditionDtoList,function(t,i){i.id==e&&(i.selectIndex=i.selectIndex?i.selectIndex+1:1)}):$.each(l.expertReview.expertSelConditionDtoList,function(e,t){t.selectIndex=t.selectIndex?t.selectIndex+1:1})},l.init=function(t,i){l.expertReview={},l.confirmEPList=[],l.selectIds=[],e.initReview(t,i,function(t){l.expertReview=t,!angular.isUndefined(l.expertReview.expertSelectedDtoList)&&angular.isArray(l.expertReview.expertSelectedDtoList)&&($.each(l.expertReview.expertSelectedDtoList,function(e,t){l.selectIds.push(t.expertDto.expertID),l.confirmEPList.push(t)}),l.selectIds.length>0?l.excludeIds=l.selectIds.join(","):l.excludeIds=""),e.initNewExpertInfo(l.minBusinessId,function(e){$.each(e,function(e,t){$.each(l.confirmEPList,function(e,i){t.name==i.expertDto.name&&"9"==i.isConfrim&&("专家函评"==l.reviewType&&"9"!=t.isLetterRw?(i.isLetterRw=9,l.saveNewExpertFlag="1"):"专家评审会"==l.reviewType&&"0"!=t.isLetterRw?(i.isLetterRw=0,l.saveNewExpertFlag="1"):i.isLetterRw=t.isLetterRw,i.maJorBig=t.maJorBig,i.maJorSmall=t.maJorSmall,i.expeRttype=t.expeRttype,i.isJoin=t.isJoin,l.confirmEPListReplace.push(i))})})})})},function(){e.initExpertGrid(l),l.init(l.businessId,l.minBusinessId)}(),l.showSelfExpertGrid=function(){l.selfExpertOptions.dataSource._skip=0,l.selfExpertOptions.dataSource.read(),$("#selfExpertDiv").kendoWindow({width:"80%",height:"680px",title:"自选评审专家",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},l.saveSelfExpert=function(){l.saveNewExpertFlag="1";var t=common.getKendoCheckId("#selfExpertGrid");0==t.length?n.alert("请先选择专家！"):t.length>1?n.alert("自选专家最多只能选择一个！"):e.saveSelfExpert(l.businessId,l.minBusinessId,l.businessType,t[0].value,l.expertReview.id,l.isCommit,function(e){if(e.flag||"ok"==e.reCode){var t=[];$.each(l.confirmEPList,function(e,i){"2"==i.selectType&&t.push(i.id)}),l.expertReview.id||(l.expertReview.id=e.idCode),l.reFleshSelEPInfo(e.reObj),l.reFleshAfterRemove(t),n.success("操作成功！",function(){window.parent.$("#selfExpertDiv").data("kendoWindow").close()})}else n.error(e.reMsg)})},l.delertSelfExpert=function(){l.saveNewExpertFlag="1";var t=$("input[name='seletedEp']:checked");t.length<1?n.alert("请选择要删除的专家"):n.confirm({title:"询问提示",message:"删除数据不可恢复，确定删除么？",onOk:function(){$(".confirmDialog").modal("hide");for(var i=[],o=0;o<t.length;o++)i.push(t[o].value);e.delSelectedExpert(l.expertReview.id,i.join(","),l.isCommit,function(e){e.flag||"ok"==e.reCode?(l.reFleshAfterRemove(i),n.success("操作成功！")):n.error(e.reMsg)})}})},l.querySelfExpert=function(){l.selfExpertOptions.dataSource._skip=0,l.selfExpertOptions.dataSource.read()},l.showOutExpertGrid=function(){l.outExpertOptions.dataSource._skip=0,l.outExpertOptions.dataSource.read(),$("#outExpertDiv").kendoWindow({width:"70%",height:"680px",title:"自选新专家、市外、境外专家",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},l.delertOutSelfExpert=function(){l.saveNewExpertFlag="1";var t=$("input[name='seletedOutEp']:checked");t.length<1?n.alert("请选择要删除的专家"):n.confirm({title:"询问提示",message:"删除数据不可恢复，确定删除么？",onOk:function(){$(".confirmDialog").modal("hide");for(var i=[],o=0;o<t.length;o++)i.push(t[o].value);e.delSelectedExpert(l.expertReview.id,i.join(","),l.isCommit,function(e){e.flag||"ok"==e.reCode?(l.reFleshAfterRemove(i),n.success("操作成功！")):n.error(e.reMsg)})}})},l.saveOutExpert=function(){l.saveNewExpertFlag="1";var t=common.getKendoCheckId("#outExpertGrid");if(0==t.length)n.alert("请先选择专家！");else{var i=[];$.each(t,function(e,t){i.push(t.value)}),e.saveOutExpert(l.businessId,l.minBusinessId,l.businessType,i.join(","),l.expertReview.id,l.isCommit,function(e){e.flag||"ok"==e.reCode?(l.expertReview.id||(l.expertReview.id=e.idCode),l.reFleshSelEPInfo(e.reObj),n.success("操作成功！",function(){window.parent.$("#outExpertDiv").data("kendoWindow").close()})):n.error(e.reMsg)})}},l.queryOutExpert=function(){l.outExpertOptions.dataSource._skip=0,l.outExpertOptions.dataSource.read()},l.countMatchExperts=function(t){if(l.expertReview.id){var i={};l.expertReview.expertSelConditionDtoList.forEach(function(e,o){e.id==t&&(i=e)}),e.countMatchExperts(i,l.minBusinessId,l.expertReview.id,function(e){l.matchEPMap[t]=e,$("#expertCount"+t).html(e.length)})}else n.alert("请保存整体抽取方案再计算")},l.showMatchExperts=function(e){l.matchExpertList=[],l.matchExpertList=l.matchEPMap[e],$("#matchExpertDiv").kendoWindow({width:"80%",height:"600px",title:"统计专家信息列表",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},l.checkIntegerValue=function(e,i,o){return t.isUnsignedInteger(e)?($("#errorsOfficialNum"+o).html(""),$("#errorsAlternativeNum"+o).html(""),e):($("#errorsOfficialNum"+o).html("只能填写数字"),void $("#errorsAlternativeNum"+o).html("只能填写数字"))},l.addCondition=function(){l.isSuperUser||9!=l.expertReview.state&&"9"!=l.expertReview.state?(l.expertReview.expertSelConditionDtoList||(l.expertReview.expertSelConditionDtoList=[]),l.condition={},l.condition.id=common.uuid(),l.condition.businessId=l.minBusinessId,l.condition.selectType="1",l.expertReview.expertSelConditionDtoList.push(l.condition)):n.alert("当前项目已经进行整体专家方案的抽取，不能再修改方案！")},l.removeCondition=function(){if(l.isSuperUser||9!=l.expertReview.state&&"9"!=l.expertReview.state){var e=$("#conditionTable input[name='epConditionSort']:checked");e.length>0?n.confirm({title:"询问提示",message:"删除数据的同时会删除该条件所抽取的专家，删除数据不可恢复，确定删除么？",onOk:function(){for(var i=[],o=0;o<e.length;o++)$.each(l.expertReview.expertSelConditionDtoList,function(t,n){e[o].value==n.id&&i.push(n.id)});i.length>0?t.deleteSelConditions(i.join(","),l.isCommit,function(e){e.flag||"ok"==e.reCode?n.success("操作成功！",function(){l.init(l.businessId,l.minBusinessId)}):n.error(e.reMsg)}):n.success("操作成功！")}}):n.alert("请选择要删除的抽取条件！")}else n.alert("当前项目已经进行整体专家方案的抽取，不能再修改方案！")},l.saveCondition=function(){l.isSuperUser||9!=l.expertReview.state&&"9"!=l.expertReview.state?s()?t.saveCondition(l.businessId,l.minBusinessId,l.businessType,l.expertReview.id,l.expertReview.expertSelConditionDtoList,function(e){e.flag||"ok"==e.reCode?(l.expertReview.expertSelConditionDtoList=e.reObj,l.expertReview.id||(l.expertReview.id=l.expertReview.expertSelConditionDtoList[0].expertReviewId),n.success("保存成功！")):n.error(e.reMsg)}):n.alert("专家抽取条件设置不完整！"):n.alert("当前项目已经进行整体专家方案的抽取，不能再修改方案！")},l.startAutoExpertWin=function(){return l.expertReview.id?isSuperUser||9!=l.expertReview.state&&"9"!=l.expertReview.state?void(s()?t.saveCondition(l.businessId,l.minBusinessId,l.businessType,l.expertReview.id,l.expertReview.expertSelConditionDtoList,function(t){t.flag||"ok"==t.reCode?(l.expertReview.expertSelConditionDtoList=t.reObj,l.expertReview.id||(l.expertReview.id=l.expertReview.expertSelConditionDtoList[0].expertReviewId),e.queryAutoExpert(l.expertReview.expertSelConditionDtoList,l.minBusinessId,l.expertReview.id,function(t){t.flag||"ok"==t.reCode?(l.reFleshSelEPInfo(t.reObj.autoEPList),l.autoSelectedEPList=[],l.autoSelectedEPList=t.reObj.autoEPList,l.expertReview.state="9",l.showAutoExpertWin(1),e.validateAutoExpert(t.reObj.allEPList,l),l.init(l.businessId,l.minBusinessId)):n.error(t.reMsg)})):n.error(t.reMsg)}):n.alert("专家抽取条件设置不完整！")):void n.alert("当前项目已经进行整体专家方案的抽取，不能再修改方案！"):void n.alert("请先进行整体专家抽取条件设置并保存！")},l.showAutoExpertWin=function(e){l.showBtnFlag=e,$("#aotuExpertDiv").kendoWindow({width:"90%",height:"700px",title:"专家抽取",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},l.showAutoMatchResultWin=function(){$("#aotuMatchResultDiv").kendoWindow({width:"90%",height:"700px",title:"专家抽取结果",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},l.repeatAutoExpert=function(t){var i=[];if($.each(l.expertReview.expertSelConditionDtoList,function(e,o){o.id==t&&i.push(o)}),i[0].selectIndex>3)return void n.alert("该条件已经进行了3次抽取，不能再继续抽取！");e.queryAutoExpert(i,l.minBusinessId,l.expertReview.id,function(i){i.flag||"ok"==i.reCode?(l.reFleshSelEPInfo(i.reObj.autoEPList),l.expertReview.state="9",l.autoSelectedEPList=[],l.autoSelectedEPList=i.reObj.autoEPList,l.updateSelectedIndex(t),l.showAutoExpertWin(1),e.validateAutoExpert(i.reObj.allEPList,l)):n.error(i.reMsg)})},l.affirmAutoExpert=function(){var t=$("#allAutoEPTable input[name='autoEPCheck']:checked");if(t.length<1)n.confirm({title:"询问提示",message:"您还没选择专家，确定没有合适的专家么？",onOk:function(){a.$apply(function(){$.each(l.expertReview.expertSelConditionDtoList,function(e,t){!t.selectIndex||t.selectIndex<1?t.selectIndex=1:t.selectIndex=t.selectIndex+1,t.showDraftBt=!0})}),window.parent.$("#aotuExpertDiv").data("kendoWindow").close()}});else{for(var i=[],o=0;o<t.length;o++)i.push(t[o].value);e.affirmAutoExpert(l.minBusinessId,l.businessType,i.join(","),"9",function(e){e.flag||"ok"==e.reCode?(l.reFleshConfirmState(i,"9"),l.checkAutoOfficeExpert=!1,l.checkAutoAntiExpert=!1,n.success(e.reMsg)):n.error(e.reMsg)})}},l.affirmJoinExpert=function(){$("#confirmJoinExpert").kendoWindow({width:"960px",height:"600px",title:"参加评审会专家确认",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},l.expertBack=function(){if("1"==l.saveNewExpertFlag)return void n.alert("拟聘请专家数据有改动，请保存后再返回！");o.go("workprogramEdit",{signid:l.businessId,minBusinessId:l.minBusinessId,businessType:l.businessType})},l.updateToJoin=function(){l.saveNewExpertFlag="1";var t=$("#notJoinExpertTable input[name='notJoinExpert']:checked");if(t.length<1)n.alert("请选择要改为参加会议的专家");else{for(var i=[],o=0;o<t.length;o++)i.push(t[o].value);e.updateJoinState(l.minBusinessId,l.businessType,i.join(","),"9",l.isCommit,function(e){n.success("操作成功！"),l.reFleshJoinState(i,"9")})}},l.updateToNotJoin=function(){l.saveNewExpertFlag="1";var t=$("#joinExpertTable input[name='joinExpert']:checked");if(t.length<1)n.alert("请选择未参加会议的专家");else{for(var i=[],o=0;o<t.length;o++)i.push(t[o].value);e.updateJoinState(l.minBusinessId,l.businessType,i.join(","),"0",l.isCommit,function(e){n.success("操作成功！"),l.reFleshJoinState(i,"0")})}},l.checkScore=function(e){e.compositeScoreEnd&&e.compositeScore&&e.compositeScore>e.compositeScoreEnd?($("#compositeScoreEnd_"+e.id).html("分值设置错误"),e.compositeScoreEnd=""):$("#compositeScoreEnd_"+e.id).html("")},l.deleteAutoSelectEP=function(){var t=$("#autoDraftExpertTable input[name='checkSelectExpert']:checked");t.length>0?n.confirm({title:"询问提示",message:"删除数据不可恢复，确定删除么？",onOk:function(){for(var i=[],o=0;o<t.length;o++)i.push(t[o].value);e.delSelectedExpert(l.expertReview.id,i.join(","),l.isCommit,function(e){e.flag||"ok"==e.reCode?n.alert("删除成功！",function(){l.reFleshAfterRemove(i)}):n.alert(e.reMsg)})}}):n.alert("请选择要删除的抽取专家！")};var c=function(e,t,i){return e[t]=e.splice(i,1,e[t])[0],e};l.upRecord=function(e,t){if(l.saveNewExpertFlag="1",0==t)return void(l.confirmEPListReplace=e);l.confirmEPListReplace=c(e,t,t-1)},l.downRecord=function(e,t){if(l.saveNewExpertFlag="1",t==e.length-1)return void(l.confirmEPListReplace=e);l.confirmEPListReplace=c(e,t,t+1)},l.saveExpert=function(t){l.saveNewExpertFlag="0",l.confirmEPListReplace.length>0?e.saveNewExpert(l.confirmEPListReplace,function(e){t&&n.success("操作成功！")}):($.each(l.confirmEPList,function(e,t){"9"==t.isConfrim&&l.confirmEPListReplace.push(t)}),e.saveNewExpert(l.confirmEPListReplace,function(e){t&&n.success("操作成功！")}))}}angular.module("app").controller("expertSelectCtrl",e),e.$inject=["expertReviewSvc","expertConditionSvc","expertSvc","$state","bsWin","$scope"]}(),function(){"use strict";function e(e,t){function i(t,i,o){var n={method:"post",url:rootPath+"/expertReview/initBybusinessId",params:{businessId:t,minBusinessId:i}},a=function(e){void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a})}function o(){return[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.expertID)},filterable:!1,width:25,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"name",title:"姓名",width:100,filterable:!1,template:function(e){return"<a  ng-click=\"vm.findExportDetail('"+e.expertID+"')\">"+e.name+"</a>"}},{field:"degRee",title:"学位",width:100,filterable:!1},{field:"sex",title:"性别",width:50,filterable:!0},{field:"comPany",title:"工作单位",width:100,filterable:!1},{field:"degRee",title:"职务",width:100,filterable:!1},{field:"",title:"专业大类",width:100,template:function(e){return e.expertTypeDtoList?e.expertTypeDtoList.length>1?"":1==e.expertTypeDtoList.length?e.expertTypeDtoList[0].maJorBig:void 0:""}},{field:"",title:"专业小类",width:100,template:function(e){return e.expertTypeDtoList?e.expertTypeDtoList.length>1?"":1==e.expertTypeDtoList.length?e.expertTypeDtoList[0].maJorSmall:void 0:""}},{field:"",title:"专家类型",width:100,template:function(e){return e.expertTypeDtoList?e.expertTypeDtoList.length>1?"":1==e.expertTypeDtoList.length?e.expertTypeDtoList[0].expertType:void 0:""}}]}function n(e){var t=function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})},i=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findByOData",$("#selfSelExpertForm")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}});e.selfExpertOptions={dataSource:common.gridDataSource(i),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o(),dataBound:t,resizable:!0};var n=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expert/findExpertFieldByOData",$("#outSelExpertForm")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}});e.outExpertOptions={dataSource:common.gridDataSource(n),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o(),dataBound:t,resizable:!0}}function a(t,i,o,n,a,r,s){r=!0;var l={method:"post",url:rootPath+"/expertReview/saveExpertReview",params:{businessId:t,minBusinessId:i,businessType:o,reviewId:angular.isUndefined(a)?"":a,expertIds:n,selectType:"2"}},c=function(e){r=!1,void 0!=s&&"function"==typeof s&&s(e.data)};common.http({$http:e,httpOptions:l,success:c,onError:function(e){r=!1}})}function r(t,i,o,n,a,r,s){r=!0;var l={method:"post",url:rootPath+"/expertReview/saveExpertReview",params:{businessId:t,minBusinessId:i,businessType:o,reviewId:angular.isUndefined(a)?"":a,expertIds:n,selectType:"3"}},c=function(e){r=!1,void 0!=s&&"function"==typeof s&&s(e.data)};common.http({$http:e,httpOptions:l,success:c,onError:function(e){r=!1}})}function s(t,i,o,n){var a={method:"post",url:rootPath+"/expert/countReviewExpert",data:t,params:{minBusinessId:i,reviewId:o}},r=function(e){void 0!=n&&"function"==typeof n&&n(e.data)};common.http({$http:e,httpOptions:a,success:r})}function l(t){var i={method:"get",url:rootPath+"/expertReview/html/getReviewList"},o=function(e){t.reviewList=e.data};common.http({vm:t,$http:e,httpOptions:i,success:o,onError:function(e){t.isCommit=!1}})}function c(t,i,o,n){var a={method:"post",url:rootPath+"/expert/autoExpertReview",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(t),params:{minBusinessId:i,reviewId:o}},r=function(e){void 0!=n&&"function"==typeof n&&n(e.data)};common.http({$http:e,httpOptions:a,success:r})}function d(e,i){var o=0,n=i.autoSelectedEPList.length,a=0,r=t(function(){if(0==n)t.cancel(r);else{var s=Math.floor(Math.random()*e.length);i.showAutoExpertName=e[s].name,o++,o%10==0&&(i.autoSelectedEPList[a].show=!0,i.autoSelectedEPList[a].official=!0,i.autoSelectedEPList[a+1].show=!0,i.autoSelectedEPList[a+1].official=!1,a+=2,n-=2)}},200)}function u(t,i,o,n,a,r){a=!0;var s={method:"post",url:rootPath+"/expertReview/updateJoinState",params:{minBusinessId:t,businessType:i,expertSelId:o,state:n}},l=function(e){void 0!=r&&"function"==typeof r&&r(e.data)};common.http({$http:e,httpOptions:s,success:l,onError:function(e){a=!1}})}function m(t,i,o,n,a){var r={method:"post",url:rootPath+"/expertReview/affirmAutoExpert",params:{minBusinessId:t,businessType:i,expertSelId:o,state:n}},s=function(e){void 0!=a&&"function"==typeof a&&a(e.data)};common.http({$http:e,httpOptions:r,success:s,onError:function(e){}})}function p(t,i,o,n){o=!0;var a={method:"delete",url:rootPath+"/expertSelected",params:{reviewId:t,id:i,deleteAll:!1}},r=function(e){o=!1,void 0!=n&&"function"==typeof n&&n(e.data)};common.http({$http:e,httpOptions:a,success:r,onError:function(e){o=!1}})}function f(t,i){var o={method:"post",url:rootPath+"/expertReview/initBybusinessId",params:{businessId:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n,onError:function(e){}})}function h(t,i){var o={method:"put",url:rootPath+"/expertSelected",data:t},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function g(t,i,o){if(!y(t))return void bsWin.alert("应纳税额计算错误,保存失败！");i=!0;var n={method:"post",url:rootPath+"/expertReview/saveExpertReviewCostSingle",data:t},a=function(e){i=!1,void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a,onError:function(){i=!1}})}function v(t,i,o,n){var a=rootPath+"/expertReview/getExpertReviewCost?reviewId={0}&expertIds={1}&month={2}",r={method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded"},url:common.format(a,t,i,o)},s=function(e){void 0!=n&&"function"==typeof n&&n(e.data)};common.http({$http:e,httpOptions:r,success:s})}function y(e){var t=!0;return void 0!=e&&e.length>0&&e.forEach(function(e,i){if(void 0==e.payDate)return e.errorMsg="请选择发放日期",void(t=!1);e.errorMsg="";var o=void 0==e.reviewCost?0:e.reviewCost,n=void 0==e.reviewTaxes?0:e.reviewTaxes,a=void 0==e.totalCost?0:e.totalCost;if(void 0!=e.expertSelectedDtoList&&e.expertSelectedDtoList.length>0){var r=0,s=0,l=0;if(e.expertSelectedDtoList.forEach(function(e,i){var o=void 0==e.reviewCost?0:e.reviewCost,n=void 0==e.reviewTaxes?0:e.reviewTaxes,a=void 0==e.totalCost?0:e.totalCost;if((parseFloat(o)+parseFloat(n)).toFixed(2)!=parseFloat(a).toFixed(2))return void(t=!1);r=parseFloat(r)+parseFloat(o),s=parseFloat(s)+parseFloat(n),l=parseFloat(l)+parseFloat(a)}),parseFloat(r).toFixed(2)!=parseFloat(o).toFixed(2))return void(t=!1);if(parseFloat(s).toFixed(2)!=parseFloat(n).toFixed(2))return void(t=!1);if(parseFloat(l).toFixed(2)!=parseFloat(a).toFixed(2))return void(t=!1)}}),t}function w(t,i){var o={method:"post",url:rootPath+"/expertReview/refleshBusinessEP",params:{businessId:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n,onError:function(){}})}function b(t,i){var o={method:"post",url:rootPath+"/expertReview/expertNewInfo",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(t)},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function S(t,i){var o={method:"post",url:rootPath+"/expertReview/getExpertInfo",params:{businessId:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n,onError:function(){}})}return{initExpertGrid:n,saveSelfExpert:a,saveOutExpert:r,countMatchExperts:s,getReviewList:l,initReview:i,delSelectedExpert:p,queryAutoExpert:c,validateAutoExpert:d,affirmAutoExpert:m,updateJoinState:u,findByBusinessId:f,saveMark:h,savePayment:g,countTaxes:v,refleshBusinessEP:w,saveNewExpert:b,initNewExpertInfo:S}}angular.module("app").factory("expertReviewSvc",e),e.$inject=["$http","$interval"]}(),function(){"use strict";function e(e){function t(t,i,o,n,a,r){var s={method:"post",url:rootPath+"/expertSelCondition/saveConditionList",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(a),params:{businessId:t,minBusinessId:i,reviewId:n,businessType:o}},l=function(e){void 0!=r&&"function"==typeof r&&r(e.data)};common.http({$http:e,httpOptions:s,success:l})}function i(e){return!!(/^(\+|-)?\d+$/.test(e)&&e>0)}function o(t,i,o){i=!0;var n={method:"delete",url:rootPath+"/expertSelCondition",params:{ids:t}},a=function(e){
void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a,onError:function(e){i=!1}})}return{saveCondition:t,deleteSelConditions:o,isUnsignedInteger:i}}angular.module("app").factory("expertConditionSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,i,o){function n(t,i){var o={method:"get",url:rootPath+"/fileLibrary/getFileUrlById",params:{fileId:i}},n=function(e){t.fileUrl=e.data.fileUrl,t.title=e.data.fileUrl,t.initFileUpload()};common.http({vm:t,$http:e,httpOptions:o,success:n})}function a(e){e.gridOptions.dataSource._skip=0,e.gridOptions.dataSource.read()}function r(t,i){var o={method:"delete",url:rootPath+"/fileLibrary/deleteRootDirectory",params:{parentFileId:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function s(t,i){var o={method:"delete",url:rootPath+"/fileLibrary/deleteFile",params:{fileId:t}},n=function(e){void 0!=i&&"function"==typeof i&&i()};common.http({$http:e,httpOptions:o,success:n})}function l(t,i){var o={method:"put",url:rootPath+"/fileLibrary/updateFile",data:t.fileLibrary},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({vm:t,$http:e,httpOptions:o,success:n})}function c(t,i){var o={method:"get",url:rootPath+"/fileLibrary/findFileById",params:{fileId:i}},n=function(e){t.fileLibrary=e.data,t.addFolderWindow()};common.http({vm:t,$http:e,httpOptions:o,success:n})}function d(t,i){var o={method:"get",url:rootPath+"/fileLibrary/findFileById",params:{fileId:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function u(t,i){if(common.initJqValidation(),$("form").valid()){var o={method:"post",url:rootPath+"/fileLibrary/saveFile",data:t.fileLibrary},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({vm:t,$http:e,httpOptions:o,success:n})}}function m(t,i,o){var n={method:"get",url:rootPath+"/fileLibrary/initFileFolder",params:{fileType:t.fileLibrary.fileType}},a=function(e){void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a})}function p(t,i){var o={method:"post",url:rootPath+"/fileLibrary/addFileFolder",data:t},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function f(t,i){if(void 0!=t.fileName){var o={method:"post",url:rootPath+"/fileLibrary/addFileFolder",data:t},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}else common.alert({vm:vm,msg:"文件名不能为空",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove()}})}function h(t,i,o){var n={method:"post",url:rootPath+"/fileLibrary/initFileList",params:{fileId:t,fileType:i}},a=function(e){void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a})}return{saveRootFolder:p,saveChildFolder:f,initFileFolder:m,initFileList:h,saveFile:u,findFileById:d,updateFile:l,deleteFile:s,deleteRootDirectory:r,folderById:c,queryUser:a,getFileUrlById:n}}angular.module("app").factory("fileLibrarySvc",e),e.$inject=["$http","$state","$location","sysfileSvc"]}(),function(){"use strict";function e(e,t,i,o,n,a,r){function s(){o.initFileFolder(l,e,function(t){function i(t,i,o){l.parentFileId=o.fileId,"FOLDER"==o.fileNature&&(l.policyList=[],o.children&&(l.policyList=o.children),e.$apply()),"FILE"==o.fileNature&&l.fileEdit(l.parentFileId)}function o(e,t,i){var o=$.fn.zTree.getZTreeObj("zTree"),i=o.getSelectedNodes();l.onRemove(i.id)}function n(e,t){if("FOLDER"==t.fileNature){var i=$("#"+t.tId+"_span");if(t.editNameFlag||$("#addBtn_"+t.tId).length>0)return;var o="<span class='button add' id='addBtn_"+t.tId+"' title='添加子节点' onfocus='this.blur();'></span>";i.after(o);var n=$("#addBtn_"+t.tId);n&&n.bind("click",function(){$.fn.zTree.getZTreeObj("zTree");l.addFolderWindow(t.id)})}}function r(e,t){$("#addBtn_"+t.tId).unbind().remove()}var s,c={check:{enable:!0,chkStyle:"radio",chkboxType:{Y:"",N:""}},edit:{enable:!0,showRenameBtn:!1,showRemoveBtn:!1,showAddBtn:!0,removeTitle:"删除节点"},view:{addHoverDom:n,removeHoverDom:r,dblClickExpand:!0},callback:{onClick:i,beforeRemove:o},data:{simpleData:{enable:!0,idKey:"id",pIdKey:"pId"},showTitle:!0,key:{title:"fileName"}}};l.zNodes=$linq(t).select(function(e){var t=e;return t=e,t.id=e.fileId,t.name=e.fileName,t.pId=e.parentFileId,"FOLDER"==e.fileNature&&(t.icon=rootPath+"/contents/libs/zTree/css/zTreeStyle/img/diy/7.png"),t}).toArray(),l.initFileTreeSucess=!0,e.$watch("vm.initFileTreeSucess",function(e,t){if(1==e)var i=a(function(){for(var e=document.getElementById("zTree"),t=0;t<l.zNodes.length;t++)if(l.zNodes[t].name.length>7){var o=l.zNodes[t].name.substring(0,7);l.zNodes[t].name=o+"..."}null!=e&&(s=$.fn.zTree.init($("#zTree"),c,l.zNodes),a.cancel(i))},500)})}),l.initFileUpload()}var l=this;l.parentId=t.params.parentId,l.fileId=t.params.fileId,l.fileLibrary={},l.fileLibrary.fileType="POLICY",l.fileType="POLICY",l.initFileUpload=function(){l.fileId||e.$watch("vm.fileId",function(e,t){e&&e!=t&&!l.initUploadOptionSuccess&&l.initFileUpload()}),l.sysFile={businessId:l.fileId,mainId:l.fileId,mainType:r.mainTypeValue().POLICYLIBRARY,sysBusiType:void 0==l.fileUrl?"":l.fileUrl.substring(l.fileUrl.lastIndexOf(r.mainTypeValue().POLICYLIBRARY),l.fileUrl.lastIndexOf(l.fileName)),showBusiType:!1},r.initUploadOptions({inputId:"sysfileinput",vm:l,uploadSuccess:function(){r.findByBusinessId(l.fileId,function(e){l.sysFilelists=e,o.initFileList(l.parentFileId,l.fileType,function(e){l.policyList=e.reObj})})}})},s(),l.addFolderWindow=function(e){l.fileLibrary={},l.fileLibrary.fileType="POLICY",void 0!=e&&(l.fileLibrary.parentFileId=e),$("#addRootFolder").kendoWindow({width:"500px",height:"300px",title:"新建文件夹",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()},l.saveRootFolder=function(){void 0!=l.fileLibrary.fileName?o.saveRootFolder(l.fileLibrary,function(e){e.flag||"ok"==e.reCode?n.alert("保存成功！",function(){window.parent.$("#addRootFolder").data("kendoWindow").close(),t.go("policyLibrary",{},{reload:!0})}):n.error(e.reMsg)}):n.alert("文件名不能为空!")},l.deleteFolder=function(){var e=$.fn.zTree.getZTreeObj("zTree"),i=e.getCheckedNodes();if(void 0!=i&&i.length>0){var a=i[0].id;n.confirm("删除的文件将无法恢复，确认删除？",function(){o.deleteRootDirectory(a,function(e){e.flag||"ok"==e.reCode?(n.success("操作成功！"),t.go("policyLibrary",{},{reload:!0})):n.error(e.reMsg)})})}},l.fileEdit=function(e){l.isUpdate=!1,l.fileId=e,l.fileLibrary={},l.sysFilelists={},l.fileLibrary.fileType="POLICY",l.fileId&&(l.isUpdate=!0,o.findFileById(l.fileId,function(e){l.fileLibrary=e,l.fileUrl=l.fileLibrary.fileUrl,l.fileName=l.fileLibrary.fileName,l.initFileUpload()}),r.findByBusinessId(l.fileId,function(e){l.sysFilelists=e})),$("#qualityEdit").kendoWindow({width:"800px",height:"500px",title:"文件编辑",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()},l.createFile=function(){l.fileLibrary.parentFileId=l.parentFileId,common.initJqValidation(),l.fileLibrary.fileName&&o.saveFile(l,function(e){e.flag||"ok"==e.reCode?n.alert("保存成功！",function(){l.isUpdate=!0,s(),l.policyList.push(e.reObj),l.fileId=e.reObj.fileId,o.getFileUrlById(l,l.fileId),l.initFileUpload()}):n.error(e.reMsg)})},l.updateFile=function(){o.updateFile(l,function(e){e.flag||"ok"==e.reCode?n.alert("更新成功！",function(){l.initFileUpload(),window.parent.$("#qualityEdit").data("kendoWindow").close(),s()}):n.error(e.reMsg)})},l.del=function(e){n.confirm("删除的数据将无法恢复，确认删除？",function(){var t=$.fn.zTree.getZTreeObj("zTree"),i=t.getNodeByParam("id",e,null);t.removeNode(i),o.deleteFile(e,function(){l.policyList.forEach(function(t,i){t.fileId==e&&l.policyList.splice(i,1)})})})},l.commonDownloadSysFile=function(e){r.downloadFile(e)},l.delFile=function(e){r.delSysFile(e,function(){$.each(l.sysFilelists,function(t,i){i.sysFileId==e&&l.sysFilelists.splice(t,1)}),o.initFileList(l.parentFileId,l.fileType,function(e){l.policyList=e.reObj})})}}angular.module("app").controller("policyCtrl",e),e.$inject=["$scope","$state","$location","fileLibrarySvc","bsWin","$interval","sysfileSvc"]}(),function(){"use strict";function e(e,t,i,o,n){var a=this;a.parentId=e.params.parentId,a.fileLibrary={},a.fileLibrary.parentFileId=a.parentId,a.fileLibrary.fileType="POLICY",a.fileId=e.params.fileId,a.fileUrl="",a.fileName="",a.businessFlag={isInitFileOption:!1},a.initFileUpload=function(){a.fileId||o.$watch("vm.fileId",function(e,t){e&&e!=t&&!a.initUploadOptionSuccess&&a.initFileUpload()}),a.sysFile={businessId:a.fileId,mainId:"",mainType:i.mainTypeValue().POLICYLIBRARY,sysBusiType:a.fileUrl.substring(a.fileUrl.lastIndexOf(i.mainTypeValue().POLICYLIBRARY),a.fileUrl.lastIndexOf(a.fileName))},i.initUploadOptions({inputId:"sysfileinput",vm:a,uploadSuccess:function(){i.findByBusinessId(a.fileId,function(e){a.sysFilelists=e})}})},function(){a.fileId&&(a.isUpdate=!0,t.findFileById(a,a.fileId),i.findByBusinessId(a.fileId,function(e){a.sysFilelists=e})),a.parentId&&(t.getFileUrlById(a,a.parentId),t.initFileList(a))}(),a.createFile=function(){t.saveFile(a,function(e){e.flag||"ok"==e.reCode?n.alert("保存成功！",function(){a.fileId=e.reObj.fileId,a.initFileUpload()}):n.error(e.reMsg)})},a.updateFile=function(){t.updateFile(a,function(e){e.flag||"ok"==e.reCode?(n.alert("更新成功！"),a.initFileUpload()):n.error(e.reMsg)})}}angular.module("app").controller("policyEditCtrl",e),e.$inject=["$state","fileLibrarySvc","sysfileSvc","$scope","bsWin"]}(),function(){"use strict";function e(e,t,i){var o=this;o.parentId=e.params.parentId,o.fileLibrary={},o.fileLibrary.parentFileId=o.parentId,o.fileLibrary.fileType="POLICY",o.formId="policyForm",function(){t.initFileList(o)}(),o.addFile=function(){e.go("policyLibrary.policyEdit",{parentId:o.parentId,fileId:""})},o.update=function(t){e.go("policyLibrary.policyEdit",{parentId:o.parentId,fileId:t})},o.del=function(e){i.confirm("删除的数据将无法恢复，确认删除？",function(){t.deleteFile(o,e)})},o.queryPolicy=function(){t.queryUser(o)},o.resetPolicy=function(){var e=$("#policyForm").find("input");$.each(e,function(e,t){t.value=""})}}angular.module("app").controller("policyListCtrl",e),e.$inject=["$state","fileLibrarySvc","bsWin"]}(),function(){"use strict";function e(e,t,i,o,n,a,r){function s(){o.initFileFolder(l,n,function(e){function t(e,t,i){s.checkNode(i,!i.checked,!0),l.parentFileId=i.fileId,"FOLDER"==i.fileNature&&(l.qualityList=[],i.children&&(l.qualityList=i.children),n.$apply()),"FILE"==i.fileNature&&l.fileEdit(l.parentFileId)}function i(e,t,i){l.onRemove(i.id)}function o(e,t){if("FOLDER"==t.fileNature){var i=$("#"+t.tId+"_span");if(t.editNameFlag||$("#addBtn_"+t.tId).length>0)return;var o="<span class='button add' id='addBtn_"+t.tId+"' title='添加子节点' onfocus='this.blur();'></span>";i.after(o);var n=$("#addBtn_"+t.tId);n&&n.bind("click",function(){$.fn.zTree.getZTreeObj("zTree");l.addFolderWindow(t.id)})}}function r(e,t){$("#addBtn_"+t.tId).unbind().remove()}var s,c={check:{enable:!0,chkStyle:"radio",chkboxType:{Y:"",N:""}},edit:{enable:!0,showRenameBtn:!1,showRemoveBtn:!1,showAddBtn:!0,removeTitle:"删除节点"},view:{addHoverDom:o,removeHoverDom:r,dblClickExpand:!0},callback:{onClick:t,beforeRemove:i},data:{simpleData:{enable:!0,idKey:"id",pIdKey:"pId"},showTitle:!0,key:{title:"fileName"}}};l.zNodes=$linq(e).select(function(e){var t=e;return t=e,t.id=e.fileId,t.name=e.fileName,t.pId=e.parentFileId,"FOLDER"==e.fileNature&&(t.icon=rootPath+"/contents/libs/zTree/css/zTreeStyle/img/diy/7.png"),t}).toArray(),l.initFileTreeSucess=!0,n.$watch("vm.initFileTreeSucess",function(e,t){if(1==e)var i=a(function(){for(var e=document.getElementById("zTree"),t=0;t<l.zNodes.length;t++)if(l.zNodes[t].name.length>7){var o=l.zNodes[t].name.substring(0,7);l.zNodes[t].name=o+"..."}null!=e&&(s=$.fn.zTree.init($("#zTree"),c,l.zNodes),a.cancel(i))},500)})}),l.initFileUpload()}var l=this;l.parentId=t.params.parentId,l.fileId=t.params.fileId,l.fileLibrary={},l.fileLibrary.fileType="QUALITY",l.fileType="QUALITY",l.qualityList=[],l.initFileUpload=function(){l.fileId||n.$watch("vm.fileId",function(e,t){e&&e!=t&&!l.initUploadOptionSuccess&&l.initFileUpload()}),l.sysFile={businessId:l.fileId,mainId:l.fileId,mainType:r.mainTypeValue().FILELIBRARY,sysBusiType:void 0==l.fileUrl?"":l.fileUrl.substring(l.fileUrl.lastIndexOf(r.mainTypeValue().FILELIBRARY),l.fileUrl.lastIndexOf(l.fileName)),showBusiType:!1},r.initUploadOptions({inputId:"sysfileinput",vm:l,uploadSuccess:function(){r.findByBusinessId(l.fileId,function(e){l.sysFilelists=e,o.initFileList(l.parentFileId,l.fileType,function(e){l.qualityList=e.reObj})})}})},l.query=function(){var e=$.fn.zTree.getZTreeObj("zTree");e.expandAll(!1),e.cancelSelectedNode();for(var t=e.getNodesByParamFuzzy("name",""+l.name,null),i=0,o=t.length;i<o;i++){var n=e.getNodeByParam("tId",t[i].tId,null);e.expandNode(n,!0,!0,!0);var a=n.getParentNode();null!=a&&e.expandNode(a,!0,!0,!0)}},s(),l.addFolderWindow=function(e){console.log(l.fileLibrary),l.fileLibrary={},l.fileLibrary.fileType="QUALITY",void 0!=e&&(l.fileLibrary.parentFileId=e),$("#addRootFolder").kendoWindow({width:"600px",height:"300px",title:"创建文件夹",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()},l.saveRootFolder=function(){void 0!=l.fileLibrary.fileName?o.saveRootFolder(l.fileLibrary,function(i){i.flag||"ok"==i.reCode?e.alert("保存成功！",function(){window.parent.$("#addRootFolder").data("kendoWindow").close(),t.go("fileLibrary",{},{reload:!0})}):e.error(i.reMsg)}):e.alert("文件名不能为空!")},n.onRemove=function(t){e.confirm("删除的文件将无法恢复，确认删除？",function(){o.deleteRootDirectory(t,function(t){return t.flag||"ok"==t.reCode?(e.success("操作成功！"),!0):(e.error(t.reMsg),!1)})})},l.deleteFolder=function(){var i=$.fn.zTree.getZTreeObj("zTree"),n=i.getCheckedNodes();if(void 0!=n&&n.length>0){var a=n[0].id;e.confirm("删除的文件将无法恢复，确认删除？",function(){o.deleteRootDirectory(a,function(i){i.flag||"ok"==i.reCode?(e.success("操作成功！"),t.go("fileLibrary",{},{reload:!0})):e.error(i.reMsg)})})}},l.fileEdit=function(e){l.isUpdate=!1,l.fileId=e,l.fileLibrary={},l.sysFilelists={},l.fileLibrary.fileType="QUALITY",l.fileId&&(l.isUpdate=!0,o.findFileById(l.fileId,function(e){l.fileLibrary=e,l.fileUrl=l.fileLibrary.fileUrl,l.fileName=l.fileLibrary.fileName,l.initFileUpload()}),r.findByBusinessId(l.fileId,function(e){l.sysFilelists=e})),$("#qualityEdit").kendoWindow({width:"800px",height:"500px",title:"文件编辑",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()},l.createFile=function(){l.fileLibrary.parentFileId=l.parentFileId,common.initJqValidation(),l.fileLibrary.fileName&&o.saveFile(l,function(t){t.flag||"ok"==t.reCode?e.alert("保存成功！",function(){l.isUpdate=!0,l.qualityList.push(t.reObj),l.fileId=t.reObj.fileId,o.getFileUrlById(l,l.fileId),l.initFileUpload(),s()}):e.error(t.reMsg)})},l.updateFile=function(){o.updateFile(l,function(t){t.flag||"ok"==t.reCode?e.alert("更新成功！",function(){l.initFileUpload(),window.parent.$("#qualityEdit").data("kendoWindow").close(),s()}):e.error(t.reMsg)})},l.del=function(t){e.confirm("删除的数据将无法恢复，确认删除？",function(){var e=$.fn.zTree.getZTreeObj("zTree"),i=e.getNodeByParam("id",t,null);e.removeNode(i),o.deleteFile(t,function(){l.qualityList.forEach(function(e,i){e.fileId==t&&l.qualityList.splice(i,1)})})})},l.commonDownloadSysFile=function(e){r.downloadFile(e)},l.delFile=function(e){r.delSysFile(e,function(){$.each(l.sysFilelists,function(t,i){i.sysFileId==e&&l.sysFilelists.splice(t,1)}),o.initFileList(l.parentFileId,l.fileType,function(e){l.qualityList=e.reObj})})}}angular.module("app").controller("qualityCtrl",e),e.$inject=["bsWin","$state","$location","fileLibrarySvc","$scope","$interval","sysfileSvc"]}(),function(){"use strict";function e(e,t,i,o,n){var a=this;a.parentId=e.params.parentId,a.fileLibrary={},a.fileLibrary.parentFileId=a.parentId,a.fileLibrary.fileType="QUALITY",a.fileId=e.params.fileId,a.fileUrl="",a.fileName="",a.businessFlag={isInitFileOption:!1},a.initFileUpload=function(){a.fileId||o.$watch("vm.fileId",function(e,t){e&&e!=t&&!a.initUploadOptionSuccess&&a.initFileUpload()}),a.sysFile={businessId:a.fileId,mainId:"",mainType:i.mainTypeValue().FILELIBRARY,sysBusiType:a.fileUrl.substring(a.fileUrl.lastIndexOf(i.mainTypeValue().FILELIBRARY),a.fileUrl.lastIndexOf(a.fileName))},i.initUploadOptions({inputId:"sysfileinput",vm:a,uploadSuccess:function(){i.findByBusinessId(a.fileId,function(e){a.sysFilelists=e})}})},function(){a.fileId&&(a.isUpdate=!0,t.findFileById(a,a.fileId),i.findByBusinessId(a.fileId,function(e){a.sysFilelists=e})),a.parentId&&(t.getFileUrlById(a,a.parentId),t.initFileList(a))}(),a.createFile=function(){t.saveFile(a,function(e){e.flag||"ok"==e.reCode?n.alert("保存成功！",function(){a.fileId=e.reObj.fileId,a.initFileUpload()}):n.error(e.reMsg)})},a.updateFile=function(){t.updateFile(a,function(e){e.flag||"ok"==e.reCode?n.alert("更新成功！",function(){a.initFileUpload()}):n.error(e.reMsg)})}}angular.module("app").controller("qualityEditCtrl",e),e.$inject=["$state","fileLibrarySvc","sysfileSvc","$scope","bsWin"]}(),function(){"use strict";function e(e,t,i,o,n){var a=this;a.parentId=e.params.parentId,a.fileLibrary={},a.fileLibrary.parentFileId=a.parentId,a.fileLibrary.fileType="QUALITY",a.formId="fileForm",function(){t.initFileList(a)}(),a.addFile=function(){e.go("fileLibrary.fileEdit",{parentId:a.parentId,fileId:""})},a.update=function(t){e.go("fileLibrary.fileEdit",{parentId:a.parentId,fileId:t})},a.del=function(e){n.confirm("删除的数据将无法恢复，确认删除？",function(){t.deleteFile(a,e)})},a.queryUser=function(){t.queryUser(a)},a.resetUser=function(){var e=$("#fileForm").find("input");$.each(e,function(e,t){t.value=""})}}angular.module("app").controller("qualityListCtrl",e),e.$inject=["$state","fileLibrarySvc","sysfileSvc","$scope","bsWin"]}(),function(){"use strict";function e(e,t,i,o,n,a,r){var s=this;s.title="项目归档编辑",s.fileRecord={},s.fileRecord.signId=t.params.signid,s.fileRecord.fileRecordId="",s.signId=t.params.signid,s.isControl=t.params.isControl,s.isassistproc=!1,s.drawingFile=[],s.otherFile=[],s.declareFile=[],s.initFileUpload=function(){s.fileRecord.fileRecordId||n.$watch("vm.fileRecord.fileRecordId",function(e,t){e&&e!=t&&!s.initUploadOptionSuccess&&s.initFileUpload()}),s.sysFile={businessId:s.fileRecord.fileRecordId,mainId:s.signId,mainType:i.mainTypeValue().SIGN,sysfileType:i.mainTypeValue().DOFILE,sysBusiType:i.mainTypeValue().DOFILE},i.initUploadOptions({inputId:"sysfileinput",vm:s})},function(){e.initFileRecordData(s)}(),s.create=function(){e.saveFileRecord(s,function(e){s.isCommit=!1,e.flag||"ok"==e.reCode?(s.fileRecord.fileRecordId=e.reObj,o.alert("修改成功！")):o.error(response.data.reMsg)})},s.templatePage=function(e){a.templatePage(e)},s.addOtherFile=function(e,t){s.addRegisters||(s.addRegisters=[]),e?("2"==t?(s.addRegisters=s.drawingFile,s.showFilePage=!0,s.showFileOther=!1,s.showSignOther=!1):(s.addRegisters=s.otherFile,s.showFileOther=!0,s.showFilePage=!1,s.showSignOther=!1),s.businessId=e,s.businessType=t,$("#addOtherFile").kendoWindow({width:"840px",height:"480px",title:"补充资料编辑",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()):o.alert("请先保存数据！")},s.addRegisterFile=function(){s.addRegister={},s.addRegister.businessId=s.businessId,s.addRegister.id=common.uuid(),s.addRegisters.push(s.addRegister)},s.saveRegisterFile=function(){r.saveRegisterFile(s.addRegisters,function(e){e.flag||"ok"==e.reCode?(s.addRegisters=e.reObj,o.alert("操作成功")):o.alert(e.reMsg)})},s.deleteRegisterFile=function(){var e=$("#addOtherFile input[name='addRegistersCheck']:checked");if(e.length<1)o.alert("请选择要删除的记录！");else{for(var t=[],i=0;i<e.length;i++)s.addRegisters.forEach(function(o,n){o.id&&e[i].value==o.id&&(t.push(e[i].value),s.addRegisters.splice(n,1))});t.length>0&&r.deleteByIds(t.join(","),function(e){o.alert("删除成功！")})}}}angular.module("app").controller("fileRecordEditCtrl",e),e.$inject=["fileRecordSvc","$state","sysfileSvc","bsWin","$scope","templatePrintSvc","addRegisterFileSvc"]}(),function(){"use strict";function e(e,t){function i(e){e.otherFile=[];var i={method:"get",url:rootPath+"/fileRecord/initFillPage",params:{signId:e.fileRecord.signId}},o=function(t){null!=t.data&&""!=t.data&&(e.fileRecord=t.data.file_record,e.fileRecord.signId=e.signId,e.signUserList=t.data.sign_user_List,e.isassistproc="9"==e.fileRecord.isassistproc,e.fileRecord.registerFileDto.forEach(function(t,i){"5"==t.businessType||"6"==t.businessType||"7"==t.businessType?e.otherFile.push(t):"2"==t.businessType&&e.drawingFile.push(t)}),e.initFileUpload())};common.http({vm:e,$http:t,httpOptions:i,success:o})}function o(e,i){if(common.initJqValidation($("#fileRecord_form")),$("#fileRecord_form").valid()){e.signUserList.forEach(function(t,i){e.fileRecord.signUserid==t.id&&(e.fileRecord.signUserName=t.displayName)}),e.isCommit=!0;var o={method:"post",url:rootPath+"/fileRecord",data:e.fileRecord},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:t,httpOptions:o,success:n,onError:function(t){e.isCommit=!1}})}}return{initFileRecordData:i,saveFileRecord:o}}angular.module("app").factory("fileRecordSvc",e),e.$inject=["bsWin","$http"]}(),function(){"use strict";function e(e,t,i,o,n,a){function r(){"REVIEW"==s.costType&&(n.initSignList(function(e){(e.flag||"ok"==e.reCode)&&(s.orgDeptList=e.reObj)}),e.initfinancial(s,function(e){s.stageCountList=e})),"ASSIST"==s.costType&&a.findSingAssistCostList(s.signAssistCost,function(e){s.signAssistCostList=e})}var s=this;s.sign={},s.financial={},s.model={},s.signAssistCost={},s.isuserExist=!1,s.id=t.params.id,s.financial.businessId=t.params.businessId,s.costType=t.params.costType,"REVIEW"==s.costType&&(s.title="评审费统计管理",s.titleName="专家评审费",s.windowName="专家评审费录入"),"ASSIST"==s.costType&&(s.title="协审费统计管理",s.titleName="专家协审费",s.windowName="专家协审费录入"),s.addCostWindow=function(t){s.signAssistCostCounList={},s.expertSelectedDtoList={},s.signAssistCost={},"REVIEW"==s.costType&&(e.sumFinancial(s,t.businessId),s.businessId=t.businessId,s.projectName=t.projectname),"ASSIST"==s.costType&&(s.businessId=t.signId,s.projectName=t.projectName),e.initFinancialProject(s.businessId,function(e){s.financial={},s.financial.businessId=s.businessId,s.financial.projectName=s.projectName,s.financial.paymentData=e.financialDto.paymentData,o.initReview(s.financial.businessId,"",function(e){s.expertReview=e,s.reviewTitle=e.reviewTitle,s.payDate=e.payDate,s.expertSelectedDtoList=e.expertSelectedDtoList,s.expertSelectedDtoList&&s.expertSelectedDtoList.length>0&&(s.showReviewCost=!0)}),s.signAssistCost.signId=s.businessId,a.findSingAssistCostCount(s.signAssistCost,function(e){s.signAssistCostCounList=e,s.signAssistCostCounList&&s.signAssistCostCounList.length>0&&(s.showAssistCost=!0)}),s.financials=e.financiallist,s.countCost(),$("#addCostWindow").kendoWindow({width:"70%",height:"600px;",title:s.windowName,visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()})},s.costExportExcel=function(){var t=s.reviewTitle+"("+s.payDate+")";e.exportExcel(s,s.financial.businessId,t)},s.countCost=function(){var e=0;s.financials&&s.financials.length>0&&angular.forEach(s.financials,function(t,i){t.charge&&(e+=t.charge)}),$("#financialCount").html(e)},s.changeName=function(e,t){if(s.financials.length>0)for(var o=0;o<s.financials.length-1;o++)o!=e&&void 0!=s.financials[o].chargeName&&s.financials[o].chargeName==t&&(i.alert("该费用已经录入，不能重复录入！"),s.financials[e]={})},s.addFinancial=function(){var e={};e.chargeType="8",e.businessId=s.financial.businessId,e.projectName=s.financial.projectName,e.paymentData=s.financial.paymentData,s.financials||(s.financials=[]),s.financials.push(e)},s.saveFinancial=function(){common.initJqValidation($("#fnFrom")),$("#fnFrom").valid()?e.savefinancial(s.financials,function(e){e.flag||"ok"==e.reCode?(s.financials=e.reObj,i.success(e.reMsg),$("#addCostWindow").data("kendoWindow").close()):i.error(e.reMsg)}):i.error("费用信息填写不正确！")},s.deleteFinancial=function(){var t=$("#financialsTable input[name='financialsCheck']:checked");if(t.length<1)common.alert({vm:s,msg:"请选择要删除的记录！"});else for(var i=[],o=0;o<t.length;o++){s.financials.forEach(function(e,n){t[o].value!=e.id&&void 0!=e.id||s.financials.splice(n,1),i.push(t[o].value)});var n=i.join(",");e.deleteFinancialManager(n,function(e){})}},s.queryUser=function(){r()},s.resetQuery=function(){s.financial={}},r()}angular.module("app").controller("addCostCtrl",e),e.$inject=["financialManagerSvc","$state","bsWin","expertReviewSvc","adminSvc","assistCostCountSvc"]}(),function(){"use strict";function e(e,t,i,o){function n(n,a,r,s){n.financial={},void 0==r.businessId&&(void 0==r.signid?r.businessId=r.signId:r.businessId=r.signid),r.projectname||(r.projectname=r.projectName),"REVIEW"==a?(n.windowName="项目评审费录入",n.financial.businessType="SIGN",n.financial.chargeType="1"):"ASSIST"==a&&(n.windowName="项目协审费录入",n.financial.businessType="SIGN",n.financial.chargeType="2"),n.financial.businessId=r.businessId,n.financial.projectName=r.projectname,n.costExportExcel=function(){var e=n.expertReview.reviewTitle+"("+n.expertReview.payDate+")";t.exportExcel(n,n.financial.businessId,e)},n.countCost=function(){var e=0;n.financials&&n.financials.length>0&&angular.forEach(n.financials,function(t,i){t.charge&&(e+=t.charge)}),$("#financialCount").html(e)},n.addFinancial=function(){var e={};e.businessId=n.financial.businessId,e.projectName=n.financial.projectName,e.paymentData=n.financial.paymentData,e.chargeType=n.financial.chargeType,n.financials||(n.financials=[]),n.financials.push(e)},n.saveFinancial=function(){common.initJqValidation($("#fnFrom")),$("#fnFrom").valid()?(angular.forEach(n.financials,function(e,t){e.paymentData=n.financial.paymentData}),t.savefinancial(n.financials,function(t){t.flag||"ok"==t.reCode?(n.financials=t.reObj,e.success(t.reMsg,function(){$("#"+s).data("kendoWindow").close()})):e.error(t.reMsg)})):e.error("费用信息填写不正确！")},n.deleteFinancial=function(){var i=$("#financialsTable input[name='financialsCheck']:checked");i.length<1?e.alert("请选择要删除的记录！"):e.confirm({title:"询问提示",message:"确认删除？",onOk:function(){for(var e=[],o=0;o<i.length;o++){n.financials.forEach(function(t,a){i[o].value!=t.id&&void 0!=t.id||n.financials.splice(a,1),e.push(i[o].value)});var a=e.join(",")}t.deleteFinancialManager(a,function(e){n.countCost()})}})},n.count=function(){n.countCost()},t.initFinancialProject(n.financial,function(e){n.financials=e.financiallist,n.financials&&n.financials.length>0&&(n.countCost(),n.financials[0].paymentData&&(n.financial.paymentData=new Date(n.financials[0].paymentData.CompatibleDate()).Format("yyyy-MM-dd"))),i.initReview(n.financial.businessId,"",function(e){n.expertReview=e}),"ASSIST"==a&&o.findSignCostBySignId(n.financial.businessId,function(e){n.signAssistCostCounList=e}),$("#"+s).kendoWindow({width:"70%",height:"560",title:n.windowName,visible:!1,modal:!0,closable:!0,close:function(){n.financial={},n.expertReview={},n.financials={},n.signAssistCostCounList={}},actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()})}return{initAddCost:n}}angular.module("app").factory("addCostSvc",e),e.$inject=["bsWin","financialManagerSvc","expertReviewSvc","assistCostCountSvc"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.title="协审费录入",n.financials=new Array,n.financial={},n.financial.businessId=i.params.signid,function(){t.initAssistProject(n.financial.businessId,function(e){n.model=e.financialDto,n.financials=e.financiallist,n.countCost()})}(),n.countCost=function(){if(n.financials&&n.financials.length>0){var e=0;angular.forEach(n.financials,function(t,i){t.charge&&(e+=t.charge)}),$("#financialCount").html(e)}},n.addFinancial=function(){var e={};e.chargeType="8",e.businessId=n.model.businessId,e.projectName=n.model.projectName,e.paymentData=n.model.paymentData,n.financials||(n.financials=[]),n.financials.push(e)},n.saveFinancial=function(){t.savefinancial(n.financials,function(t){t.flag||"ok"==t.reCode?(n.financials=t.reObj,n.model.paymentData||(n.model.paymentData=n.financials[0].paymentData),n.countCost(),e.success(t.reMsg)):e.error(t.reMsg)})},n.deleteFinancial=function(){var i=$("#financialsTable input[name='financialsCheck']:checked");if(i.length<1)common.alert({vm:n,msg:"请选择要删除的记录！"});else{for(var o=[],a=0;a<i.length;a++)n.financials.forEach(function(e,t){void 0!=e.id&&i[a].value!=e.id||n.financials.splice(t,1),i[a].value&&o.push(i[a].value)});if(o.length>0){var r=o.join(",");t.deleteFinancialManager(r,function(t){n.countCost(),e.alert("操作成功！！")})}}}}angular.module("app").controller("assistCostEditCtrl",e),e.$inject=["bsWin","financialManagerSvc","$state","expertReviewSvc"]}(),function(){"use strict";function e(e,t,i,o){function n(){a.isSubmit=!0,a.nodata=!1,t.findSingAssistCostList(a.signAssistCost,function(e){a.isSubmit=!1,a.signAssistCostList=e,a.signAssistCostList&&0!=a.signAssistCostList.length||(a.nodata=!0)})}var a=this;a.title="协审费录入",a.signAssistCost={},a.signAssistCost.beginTime=(new Date).halfYearAgo(),a.signAssistCost.endTime=(new Date).Format("yyyy-MM-dd"),a.costType=o.params.costType,a.financials=[],n(),a.queryAssistCost=function(){n()},a.assistCostReset=function(){a.signAssistCost={}},a.addCostWindow=function(e,t){i.initAddCost(a,a.costType,e,t)}}angular.module("app").controller("assistCostCountEditCtrl",e),e.$inject=["bsWin","assistCostCountSvc","addCostSvc","$state"]}(),function(){"use strict";function e(e,t,i){function o(){n.isSubmit=!0,n.nodata=!1,e.findSingAssistCostCount(n.signAssistCost,function(e){n.isSubmit=!1,n.signAssistCostCounList=e,n.signAssistCostCounList&&0!=n.signAssistCostCounList.length||(n.nodata=!0)})}var n=this;n.signAssistCost={},n.signAssistCost.beginTime=(new Date).halfYearAgo(),n.signAssistCost.endTime=(new Date).Format("yyyy-MM-dd"),o(),n.queryAssistCost=function(){o()},n.assistCostReset=function(){n.signAssistCost={}}}angular.module("app").controller("assistCostCountListCtrl",e),e.$inject=["assistCostCountSvc","$state","addCostSvc"]}(),function(){"use strict";function e(e){function t(t,i){var o={method:"post",url:rootPath+"/financialManager/findSignCostBySignId",params:{signId:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function i(t,i){var o={method:"post",url:rootPath+"/financialManager/findSingAssistCostCount",data:t},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function o(t,i){var o={method:"post",url:rootPath+"/financialManager/findSingAssistCostList",data:t},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function n(e,t,i){var i=escape(encodeURIComponent(i));window.open(rootPath+"/financialManager/exportExcel?fileName="+i+"&businessId="+t)}function a(e){return!!(/^(\+|-)?\d+$/.test(e)&&e>0)}function r(t,i){var o={method:"post",url:rootPath+"/financialManager/initfinancial",params:{businessId:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function s(t){var i={method:"get",url:rootPath+"/financialManager/html/sumfinancial",params:{businessId:t.financial.businessId}},o=function(e){t.financial.stageCount=e.data,$("#financialCount").html(t.financial.stageCount)};common.http({vm:t,$http:e,httpOptions:i,success:o})}function l(t,i){var o={method:"post",url:rootPath+"/financialManager",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(t)},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function c(t,i){var o={method:"delete",url:u,data:t},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function d(e){var t=new kendo.data.DataSource({
type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expertSelected/assistCostList",$("#searchform")),schema:{data:"value",model:{id:"id",fields:{createdDate:{type:"date"}}}},serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{field:"",title:"",width:30,template:function(e){switch(e.lightState){case"4":return $("#span1").html();case"8":return $("#span5").html();case"7":return $("#span4").html();case"6":return $("#span3").html();case"5":return $("#span2").html();case"1":case"2":case"3":default:return""}}},{field:"projectname",title:"项目名称",width:100,filterable:!1},{field:"builtcompanyname",title:"协审单位",width:100,filterable:!1},{field:"principal",title:"项目负责人",width:100,filterable:!1},{field:"signNum",title:"协审登记号",width:100,filterable:!1},{field:"totalCost",title:"计划协审费用",width:120,filterable:!1},{field:"totalCost",title:"实付协审费用",width:120,filterable:!1},{field:"payDate",title:"付款日期",width:100,filterable:!1},{field:"declareValue",title:"申报金额",width:100,filterable:!1},{field:"",title:"操作",width:100,template:function(e){return common.format($("#columnBtns").html(),"vm.addCost('"+e.businessId+"')")}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})},resizable:!0}}var u=rootPath+"/financialManager";return{grid:d,deleteassistCostCount:c,saveAssistCost:l,sumAssistCount:s,initAssistlProject:r,isUnsignedInteger:a,assistExportExcel:n,findSingAssistCostCount:i,findSingAssistCostList:o,findSignCostBySignId:t}}angular.module("app").factory("assistCostCountSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.title="专家费统计管理",n.financials=[],n.searchModel={},n.searchModel.beginTime=(new Date).halfYearAgo(),n.searchModel.endTime=(new Date).Format("yyyy-MM-dd"),n.model={},n.sign={},n.financial={},n.financial.signid=i.params.signid,n.inputIntegerValue=function(e,i){t.isUnsignedInteger(e)?$("#errorsUnmber"+i).html(""):$("#errorsUnmber"+i).html("只能输入数字")},n.addFinancial=function(){var e=$("#projectName").val(),t=$("#paymentData").val(),i=n.financial.signid;n.financial={},n.financial.chargeType="评审项目",n.financial.signid=i,n.financial.projectName=e,n.financial.paymentData=t,n.financials.push(n.financial),n.i++},n.saveFinancial=function(){t.savefinancial(n)},n.deleteFinancial=function(){var e=$("#financialsTable input[name='financialsCheck']:checked");if(e.length<1)common.alert({vm:n,msg:"请选择要删除的记录！"});else for(var i=[],o=0;o<e.length;o++){n.financials.forEach(function(t,a){e[o].value!=t.id&&void 0!=t.id||n.financials.splice(a,1),i.push(e[o].value)});var a=i.join(",");t.deleteexportCount(n,a)}},n.searchForm=function(){n.gridOptions.dataSource._skip=0,n.gridOptions.dataSource.read()},n.excelExport=function(){n.fileName="专家评审费明细",n.exportData=$("#statisticalGrid").data("kendoGrid")._data,t.excelExport(n,n.exportData,n.fileName)},n.formReset=function(){n.searchModel={}},function(){t.grid(n)}()}angular.module("app").controller("exportCountCtrl",e),e.$inject=["$location","exportCountSvc","$state","$http"]}(),function(){"use strict";function e(e){function t(e){return!!(/^(\+|-)?\d+$/.test(e)&&e>0)}function i(t){var i={method:"get",url:rootPath+"/exportCount/initfinancial",params:{signid:t.financial.signid}},o=function(e){t.model=e.data.financialDto,t.financials=e.data.financiallist};common.http({vm:t,$http:e,httpOptions:i,success:o})}function o(t){var i={method:"get",url:rootPath+"/exportCount/html/sumfinancial",params:{signId:t.financial.signid}},o=function(e){t.financial.stageCount=e.data,$("#financialCount").html(t.financial.stageCount)};common.http({vm:t,$http:e,httpOptions:i,success:o})}function n(t){var i={method:"post",url:rootPath+"/exportCount",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(t.financials)},o=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){a()}})}})};common.http({vm:t,$http:e,httpOptions:i,success:o})}function a(){window.location.reload()}function r(t,i){t.isSubmit=!0;var o={method:"delete",url:c,data:i},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,a()}})}})};common.http({vm:t,$http:e,httpOptions:o,success:n})}function s(t,i,o){var n=window.encodeURIComponent(window.encodeURIComponent(o)),a={fileName:n},r=rootPath+"/expertSelected/expertDetailExport";if($("#searchform")){var s=common.buildOdataFilter($("#searchform"));s&&(a.$filter=s)}var l={method:"post",url:r,traditional:!0,dataType:"json",responseType:"arraybuffer",params:a},c=function(e){o+=".xls";common.downloadReport(e.data,o,"vnd.ms-excel")};common.http({vm:t,$http:e,httpOptions:l,success:c})}function l(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expertSelected/findByOData",$("#searchform")),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10}),i=function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})},o=[{field:"rowNumber",title:"序号",width:50,filterable:!1,attributes:{class:"table-cell",style:"text-align: center"},template:"<span class='row-number'></span>"},{field:"expertDto.name",title:"姓名",width:80,filterable:!1},{field:"expertDto.idCard",title:"身份证号",width:170,filterable:!1},{field:"expertDto.openingBank",title:"开户行",width:140,filterable:!1},{field:"expertDto.bankAccount",title:"银行账号",width:200,filterable:!1},{field:"reviewCost",title:"评审费",width:70,filterable:!1},{field:"reviewTaxes",title:"应缴税",width:70,filterable:!1},{field:"expertReviewDto.reviewTitle",title:"项目名称",width:380,filterable:!1},{field:"expertReviewDto.reviewDate",title:"评审/函评日期",width:120,filterable:!1},{field:"principal",title:"负责人",width:140,filterable:!1}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}var c=rootPath+"/exportCount";return{grid:l,deleteexportCount:r,savefinancial:n,sumFinancial:o,initFinancialProject:i,isUnsignedInteger:t,excelExport:s}}angular.module("app").factory("exportCountSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.title="专家缴税统计管理",n.financials=[],n.sign={},n.financial={},n.model={},n.model.year=i.params.year,n.model.month=i.params.month,n.countExpertCost=function(){t.expertCostTotal(n,function(e){n.expertCostTotalInfo=e.reObj.expertCostTotalInfo,n.tMonthReviewcost=e.reObj.tMonthReviewcost,n.tMonthReviewtaxes=e.reObj.tMonthReviewtaxes,n.tYearReviewcost=e.reObj.tYearReviewcost,n.tYearReviewtaxes=e.reObj.tYearReviewtaxes})},n.getExpertCoustDetail=function(){i.go("expertPaymentDetailCountList",{year:n.model.year,month:n.model.month})},n.printFile=function(){var e=n.model.year+n.model.month,t=rootPath+"/contents/libs/pdfjs-dist/web/viewer.html?version="+(new Date).getTime()+"&file="+rootPath+"/expertSelected/printPreview/"+e;$("#iframePreview").attr("src",t),$("#previewModal").kendoWindow({width:"80%",height:"730px",title:"",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},n.excelExport=function(){n.fileName="专家缴税统计汇总表"+n.model.year+"-"+n.model.month,t.excelExport(n.expertCostTotalInfo,n.fileName)},function(){if(!n.model.year||!n.model.month){var e=new Date,i=e.getFullYear(),o=e.getMonth()+1;n.model.year=i+"",n.model.month=o+""}t.expertCostTotal(n,function(e){n.expertCostTotalInfo=e.reObj.expertCostTotalInfo,n.tMonthReviewcost=e.reObj.tMonthReviewcost,n.tMonthReviewtaxes=e.reObj.tMonthReviewtaxes,n.tYearReviewcost=e.reObj.tYearReviewcost,n.tYearReviewtaxes=e.reObj.tYearReviewtaxes})}()}angular.module("app").controller("expertPaymentCountCtrl",e),e.$inject=["$location","expertPaymentCountSvc","$state","$http"]}(),function(){"use strict";function e(e,t){function i(t,i){var o={method:"post",url:rootPath+"/expertSelected/expertCostTotal",data:t.model},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function o(t,i){var o={method:"post",url:rootPath+"/expertSelected/expertCostDetailTotal",data:t.model},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function n(i,o){var n={method:"post",url:rootPath+"/expertSelected/excelExport",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",responseType:"arraybuffer",data:angular.toJson(i)},a=function(e){var i=new Blob([e.data],{type:"application/vnd.ms-excel"});t.saveAs(i,o+".xls")};common.http({$http:e,httpOptions:n,success:a})}function a(e){return!!(/^(\+|-)?\d+$/.test(e)&&e>0)}function r(t){var i={method:"get",url:rootPath+"/expertPaymentCount/initfinancial",params:{signid:t.financial.signid}},o=function(e){t.model=e.data.financialDto,t.financials=e.data.financiallist};common.http({vm:t,$http:e,httpOptions:i,success:o})}function s(t){var i={method:"get",url:rootPath+"/expertPaymentCount/html/sumfinancial",params:{signId:t.financial.signid}},o=function(e){t.financial.stageCount=e.data,$("#financialCount").html(t.financial.stageCount)};common.http({vm:t,$http:e,httpOptions:i,success:o})}function l(t){var i={method:"post",url:rootPath+"/expertPaymentCount",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(t.financials)},o=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){c()}})}})};common.http({vm:t,$http:e,httpOptions:i,success:o})}function c(){window.location.reload()}function d(t,i){t.isSubmit=!0;var o={method:"delete",url:m,data:i},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,c()}})}})};common.http({vm:t,$http:e,httpOptions:o,success:n})}function u(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expertReview/findByOData",$("#searchform")),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10}),i=function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})},o=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.signid)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"expretCount",title:"姓名",width:100,filterable:!1},{field:"expretCount",title:"身份证号",width:100,filterable:!1},{field:"expretCount",title:"开户行",width:80,filterable:!1},{field:"expretCount",title:"银行账号",width:120,filterable:!1},{field:"reviewCost",title:"评审费（元）",width:160,filterable:!1},{field:"reviewTaxes",title:"应缴税",width:120,filterable:!1},{field:"reviewTitle",title:"项目名称",width:160,filterable:!1},{field:"reviewDate",title:"评审时间",width:160,filterable:!1},{field:"reviewDate",title:"函评时间",width:120,filterable:!1},{field:"reviewDate",title:"负责人",width:120,filterable:!1},{field:"",title:"操作",width:100,template:function(e){return common.format($("#columnBtns").html(),e.signid)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}var m=rootPath+"/expertPaymentCount";return{grid:u,deleteexpertPaymentCount:d,savefinancial:l,sumFinancial:s,initFinancialProject:r,isUnsignedInteger:a,expertCostTotal:i,expertCostDetailTotal:o,excelExport:n}}angular.module("app").factory("expertPaymentCountSvc",e),e.$inject=["$http","FileSaver"]}(),function(){"use strict";function e(e,t,i,o){function n(e){var t="",i=0;if(e.length>0){for(var o=0;o<e.length;o++)if(i++,t+="<tr id='option"+i+"'>",e[o].name.length,t+="<td  class='text-center'><strong>"+e[o].name+"</strong></td>",t+="<td  class='text-center'><strong>"+e[o].expertNo+"</strong></td>",t+="<td class='text-center'>",t+=e[o].reviewcost,t+="</td>",t+="<td class='text-center'>",t+=e[o].reviewtaxes,t+="</td>",t+="<td  class='text-center'><strong>"+e[o].monthTotal+"</strong></td>",t+="</tr>",void 0!=e[o].expertCostDetailCountDtoList&&e[o].expertCostDetailCountDtoList.length>0)for(var n=0;n<e[o].expertCostDetailCountDtoList.length;n++){i++;var a="";a+="<tr id='option"+i+"'>",a+="<td class='text-center' colspan='2'>",a+=void 0==e[o].expertCostDetailCountDtoList[n].reviewTitle?"":e[o].expertCostDetailCountDtoList[n].reviewTitle,a+="</td>",a+="<td class='text-center'>",a+=void 0==e[o].expertCostDetailCountDtoList[n].reviewType?"":e[o].expertCostDetailCountDtoList[n].reviewType,a+="</td>",a+="<td class='text-center'>",void 0!=e[o].expertCostDetailCountDtoList[n].reviewDate&&(a+=e[o].expertCostDetailCountDtoList[n].reviewDate),a+="</td>",a+="<td class='text-center'>",void 0!=e[o].expertCostDetailCountDtoList[n].reviewDate&&(a+=e[o].expertCostDetailCountDtoList[n].reviewDate),a+="</td>",a+="<td class='text-center'>",a+=e[o].expertCostDetailCountDtoList[n].reviewcost,a+="</td>",a+="<td class='text-center'>",a+=e[o].expertCostDetailCountDtoList[n].reviewtaxes,a+="</td>",a+="</tr>",t+=a}$("#expertCostHead").after(t)}}var a=this;a.title="专家缴税统计管理",a.model={},a.financials=new Array,a.sign={},a.financial={},a.model.year=i.params.year,a.model.month=i.params.month,a.getExpertCoust=function(){i.go("expertPaymentCountList",{year:a.model.year,month:a.model.month})},a.countExpertCostDetail=function(){t.expertCostDetailTotal(a,function(e){a.expertCostTotalInfo=e.reObj.expertCostTotalInfo;for(var t=$("#expertCostTable tr").length,i=1;i<t;i++)$("#option"+i).remove();n(a.expertCostTotalInfo)})},function(){if(i.params.year)a.model.year=i.params.year,a.model.month=i.params.month;else{var e=new Date,o=e.getFullYear(),r=e.getMonth()+1;a.model.year=o,a.model.month=r}t.expertCostDetailTotal(a,function(e){a.expertCostTotalInfo=e.reObj.expertCostTotalInfo,n(a.expertCostTotalInfo)})}(),a.printFile=function(){var e=a.model.year+a.model.month,t=rootPath+"/contents/libs/pdfjs-dist/web/viewer.html?version="+(new Date).getTime()+"&file="+rootPath+"/expertSelected/printPreviewDetail/"+e;$("#iframePreview").attr("src",t),$("#previewModal").kendoWindow({width:"80%",height:"730px",title:"",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()}}angular.module("app").controller("expertPaymentDetailCountCtrl",e),e.$inject=["$location","expertPaymentCountSvc","$state","$http"]}(),function(){"use strict";function e(e,t,i,o,n){function a(){var e=new Date,t=e.getFullYear();return c(new Date(t,l(),1))}function r(){var e=new Date,t=e.getFullYear(),i=l()+2;return c(new Date(t,i,s(i)))}function s(e){var t=new Date,i=t.getYear(),o=new Date(i,e,1);return(new Date(i,e+1,1)-o)/864e5}function l(){var e=new Date,t=e.getMonth(),i=0;return t<3&&(i=0),2<t&&t<6&&(i=3),5<t&&t<9&&(i=6),t>8&&(i=9),i}function c(e){var t=e.getFullYear(),i=e.getMonth()+1,o=e.getDate();return i<10&&(i="0"+i),o<10&&(o="0"+o),t.toString()+"-"+i.toString()+"-"+o.toString()}var d=this;d.title="专家评审基本情况统计",d.model={},d.expertRevConCount=function(){if(3==d.model.reportType&&(void 0==d.model.beginTime||""==d.model.beginTime||void 0==d.model.endTime||""==d.model.endTime))return void n.alert("会议起止时间不能为空");t.expertRevConCount(d,function(e){1==d.model.reportType?d.expertReviewConDtoList=e.reObj.expertReviewConDtoList:2==d.model.reportType?d.expertRevConSimDtoList=e.reObj.expertRevConSimDtoList:3==d.model.reportType&&(d.expertRevConCompDtoList=e.reObj.expertRevConCompDtoList)})},d.dropSlelectedCount=function(){if(1==d.model.reportType||2==d.model.reportType){var e=new Date,i=e.getFullYear(),o=e.getMonth()+1,n=e.getDate();o=o<10?"0"+o:o,d.model.beginTime=i.toString()+"-01-01",d.model.endTime=i.toString()+"-"+o.toString()+"-"+n}else 3==d.model.reportType&&(d.model.beginTime=a(),d.model.endTime=r());t.expertRevConCount(d,function(e){1==d.model.reportType?d.expertReviewConDtoList=e.reObj.expertReviewConDtoList:2==d.model.reportType?d.expertRevConSimDtoList=e.reObj.expertRevConSimDtoList:3==d.model.reportType&&(d.expertRevConCompDtoList=e.reObj.expertRevConCompDtoList)})},d.formReset=function(){var e=d.model.reportType;d.model={},d.model.reportType=e},function(){var e=new Date,i=e.getFullYear(),o=e.getMonth()+1,n=e.getDate();o=o<10?"0"+o:o,d.model.beginTime=i.toString()+"-01-01",d.model.endTime=i.toString()+"-"+o.toString()+"-"+n,d.model.reportType=1,t.expertRevConCount(d,function(e){d.expertReviewConDtoList=e.reObj.expertReviewConDtoList})}()}angular.module("app").controller("expertRevConCountCtrl",e),e.$inject=["$location","expertRevConCountSvc","$state","$http","bsWin"]}(),function(){"use strict";function e(e){function t(t,i){if(1==t.model.reportType)var o={method:"post",url:rootPath+"/expertSelected/expertReviewCondDetailCount",data:t.model};else if(2==t.model.reportType)var o={method:"post",url:rootPath+"/expertSelected/expertReviewCondCount",data:t.model};else if(3==t.model.reportType)var o={method:"post",url:rootPath+"/expertSelected/expertReviewCompliCount",data:t.model};var n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}return{expertRevConCount:t}}angular.module("app").factory("expertRevConCountSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,i,o,n){var a=this;a.title="评审费录入",a.financials=new Array,a.financial={},a.financial.businessId=i.params.businessId,function(){t.initFinancialProject(a.financial.businessId,function(e){a.model=e.financialDto,a.financials=e.financiallist,a.countCost()})}(),a.countCost=function(){if(a.financials&&a.financials.length>0){var e=0;angular.forEach(a.financials,function(t,i){t.charge&&(e+=t.charge)}),$("#financialCount").html(e)}},a.findStageCostTable=function(){n.initReview(a.financial.businessId,"",function(e){a.expertReview=e,a.reviewTitle=e.reviewTitle,a.payDate=e.payDate,a.expertSelectedDtoList=e.expertSelectedDtoList,$("#stageCostWindow").kendoWindow({width:"70%",height:"600px",title:"评审费用统计表",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()})},a.exportExcel=function(){var e=a.reviewTitle+"("+a.payDate+")";t.exportExcel(a,a.financial.businessId,e)},a.inputIntegerValue=function(e,i){t.isUnsignedInteger(e)?$("#errorsUnmber"+i).html(""):$("#errorsUnmber"+i).html("只能输入数字")},a.addFinancial=function(){var e={};e.chargeType="1",e.businessId=a.model.businessId,e.projectName=a.model.projectName,e.paymentData=a.model.paymentData,a.financials||(a.financials=[]),a.financials.push(e)},a.saveFinancial=function(){t.savefinancial(a.financials,function(t){t.flag||"ok"==t.reCode?(a.financials=t.reObj,a.model.paymentData||(a.model.paymentData=a.financials[0].paymentData),a.countCost(),e.success(t.reMsg)):e.error(t.reMsg)})},a.deleteFinancial=function(){var i=$("#financialsTable input[name='financialsCheck']:checked");if(i.length<1)common.alert({vm:a,msg:"请选择要删除的记录！"});else{for(var o=[],n=0;n<i.length;n++)a.financials.forEach(function(e,t){void 0!=e.id&&i[n].value!=e.id||a.financials.splice(t,1),i[n].value&&o.push(i[n].value)});if(o.length>0){var r=o.join(",");t.deleteFinancialManager(r,function(t){a.countCost(),e.alert("操作成功！！")})}}}}angular.module("app").controller("financialManagerCtrl",e),e.$inject=["bsWin","financialManagerSvc","$state","$http","expertReviewSvc"]}(),function(){"use strict";function e(e,t,i,o,n,a,r,s){var l=this;l.title="评审费录入",l.sign={},l.financial={},l.model={},l.model.beginTime=(new Date).halfYearAgo(),l.model.endTime=(new Date).Format("yyyy-MM-dd"),l.isuserExist=!1,l.id=i.params.id,l.financial.businessId=i.params.businessId,l.costType=i.params.costType,l.id&&(l.isUpdate=!0,l.title="评审费统计管理"),l.businessFlag={expertReviews:[]},function(){t.initfinancial(l.model,function(e){l.stageCountList=e}),r.initSignList(function(e){(e.flag||"ok"==e.reCode)&&(l.orgDeptList=e.reObj)})}(),l.showCostWindow=function(e,t){s.initAddCost(l,l.costType,e,t)},l.queryFinancl=function(){t.initfinancial(l.model,function(e){l.stageCountList=e})},l.resetQuery=function(){l.model={}}}angular.module("app").controller("financialManagerEditCtrl",e),e.$inject=["$location","financialManagerSvc","$state","signSvc","bsWin","expertReviewSvc","adminSvc","addCostSvc"]}(),function(){"use strict";function e(e){function t(t,i){var o={method:"post",url:rootPath+"/expertSelected/findProjectReviewCost",data:t},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function i(e,t,i){var i=escape(encodeURIComponent(i));window.open(rootPath+"/financialManager/exportExcel?fileName="+i+"&businessId="+t)}function o(t){var i={method:"post",url:rootPath+"/financialManager/findByOData"},o=function(e){t.stageCountList=e.data.value};common.http({vm:t,$http:e,httpOptions:i,success:o})}function n(e){return!!(/^(\+|-)?\d+$/.test(e)&&e>0)}function a(t,i){var o={method:"post",url:rootPath+"/financialManager/initfinancial",params:{businessId:t.businessId,businessType:t.businessType,chargeType:t.chargeType}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function r(t,i){var o={method:"post",url:rootPath+"/financialManager/initfinancial",params:{businessId:t,businessType:"SIGN"}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function s(t,i){var o={method:"get",url:rootPath+"/financialManager/html/sumfinancial",params:{businessId:i}},n=function(e){$("#financialCount").html(e.data)};common.http({vm:t,$http:e,httpOptions:o,success:n})}function l(t,i){var o={method:"post",url:rootPath+"/financialManager",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(t)},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function c(t,i){var o={method:"delete",url:rootPath+"/financialManager",data:t},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function d(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expertSelected/findProjectReviewCost",$("#searchform")),schema:common.kendoGridConfig().schema({id:"signid",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})},o=[{field:"",title:"",width:30,template:function(e){if("4"==e.isLightUp)return $("#span4").html();switch(e.processState){case 9:return $("#span5").html();case 4:case 5:return $("#span2").html();case 7:case 8:return $("#span3").html();default:return $("#span1").html()}}},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"projectname",title:"项目名称",width:140,filterable:!1},{field:"builtcompanyname",title:"建设单位",width:180,filterable:!1},{field:"reviewstage",title:"项目阶段",width:80,filterable:!1},{field:"principal",title:"项目负责人",width:120,filterable:!1},{field:"totalCost",title:"计划专家费用",width:160,filterable:!1,template:function(e){return"<button ng-click='vm.reviewCostWindow('"+e.businessId+"') '>"+e.totalCost+"</button>"}},{field:"signdate",title:"签收日期",width:120,filterable:!1,format:"{0: yyyy-MM-dd}"}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}rootPath;return{grid:d,deleteFinancialManager:c,savefinancial:l,sumFinancial:s,initFinancialProject:a,initAssistProject:r,isUnsignedInteger:n,stageCostCountList:o,exportExcel:i,initfinancial:t}}angular.module("app").factory("financialManagerSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,i,o,n){var a=this;a.title="项目评审费分类统计",a.model={},a.page=0,a.proReviewClassifyDetailDtoList=[],a.proReviewClassifyCountDtoList=[],a.model.beginTime=(new Date).halfYearAgo(),a.model.endTime=(new Date).Format("yyyy-MM-dd"),a.projectCostCountList=function(){o.go("projectCostCountList")},a.initFinancial=function(e){var t=o.href("financialManager",{businessId:e});window.open(t,"_blank")},a.proCostCount=function(){t.projectCostClassifyCout(a,function(e){a.proReviewClassifyCountDtoList=e.reObj.proReviewClassifyCountDtoList,void 0!=e.reObj&&e.reObj.proReviewClassifyDetailDtoList.forEach(function(e,t){a.proReviewClassifyDetailDtoList.push(e)}),void 0!=e.reObj.proReviewClassifyDetailDtoList&&0!=e.reObj.proReviewClassifyDetailDtoList.length&&(a.page++,a.proCostCount())})},a.proCostClassifyCount=function(){a.proReviewClassifyDetailDtoList=[],a.proReviewClassifyCountDtoList=[],a.page=0,a.proCostCount()},a.formReset=function(){a.model={}},function(){i.initSignList(function(e){(e.flag||"ok"==e.reCode)&&(a.orgDeptList=e.reObj)}),a.proCostCount()}()}angular.module("app").controller("proCostClassifyCountCtrl",e),e.$inject=["$location","projectCostCountSvc","adminSvc","$state","$http"]}(),function(){"use strict";function e(e,t,i,o,n,a,r){var s=this;s.title="项目评审费统计",s.model={},s.model.beginTime=(new Date).halfYearAgo(),s.model.endTime=(new Date).Format("yyyy-MM-dd"),s.proCostClassifyCountList=function(){o.go("proCostClassifyCountList")},s.proCostCount=function(){t.projectCostTotal(s,function(e){s.projectReviewCostDtoList=e.reObj.projectReviewCostDtoList})},s.queyCostWindow=function(e){a.initReview(e.businessId,"",function(e){s.titleName="专家评审费",s.expertReview=e,s.reviewTitle=e.reviewTitle,s.payDate=e.payDate,s.businessId=s.expertReview.businessId,s.expertSelectedDtoList=e.expertSelectedDtoList,s.expertSelectedDtoList&&s.expertSelectedDtoList.length>0?(s.showReviewCost=!0,$("#expertCostWindow").kendoWindow({width:"70%",height:"600px;",title:s.titleName,visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()):r.alert("没有专家")})},s.costExportExcel=function(){var e=s.reviewTitle+"("+s.payDate+")";t.exportExcel(s,s.businessId,e)},s.formReset=function(){s.model={}},function(){i.initSignList(function(e){(e.flag||"ok"==e.reCode)&&(s.orgDeptList=e.reObj)}),t.projectCostTotal(s,function(e){s.projectReviewCostDtoList=e.reObj.projectReviewCostDtoList})}()}angular.module("app").controller("projectCostCountCtrl",e),e.$inject=["$location","projectCostCountSvc","adminSvc","$state","$http","expertReviewSvc","bsWin"]}(),function(){"use strict";function e(e){function t(t,i){var o={method:"post",url:rootPath+"/expertSelected/projectCostTotal",data:t.model},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function i(t,i){var o={method:"post",url:rootPath+"/expertSelected/proCostClassifyTotal?page="+t.page,data:t.model},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function o(t,i,o){var n={method:"post",url:rootPath+"/expertSelected/excelExport",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",responseType:"arraybuffer",data:angular.toJson(i),params:{fileName:o}},a=function(e){o+=".xls";common.downloadReport(e.data,o,"vnd.ms-excel")};common.http({vm:t,$http:e,httpOptions:n,success:a})}function n(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/expertReview/findByOData",$("#searchform")),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10}),i=function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})},o=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.signid)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"expretCount",title:"姓名",width:100,filterable:!1},{field:"expretCount",title:"身份证号",width:100,filterable:!1},{field:"expretCount",title:"开户行",width:80,filterable:!1},{field:"expretCount",title:"银行账号",width:120,filterable:!1},{field:"reviewCost",title:"评审费（元）",width:160,filterable:!1},{field:"reviewTaxes",title:"应缴税",width:120,filterable:!1},{field:"reviewTitle",title:"项目名称",width:160,filterable:!1},{field:"reviewDate",title:"评审时间",width:160,filterable:!1},{field:"reviewDate",title:"函评时间",width:120,filterable:!1},{field:"reviewDate",title:"负责人",width:120,filterable:!1},{field:"",title:"操作",width:100,template:function(e){return common.format($("#columnBtns").html(),e.signid)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}function a(e,t,i){var i=escape(encodeURIComponent(i));window.open(rootPath+"/financialManager/costExportExcel?fileName="+i+"&businessId="+t)}rootPath;return{grid:n,projectCostTotal:t,projectCostClassifyCout:i,excelExport:o,exportExcel:a}}angular.module("app").factory("projectCostCountSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,i,o){function n(e,t){var i,o,n;try{i=e.toString().split(".")[1].length}catch(e){i=0}try{o=t.toString().split(".")[1].length}catch(e){o=0}return n=Math.pow(10,Math.max(i,o)),(e*n+t*n)/n}function a(){r.total.projectcount=0,r.total.declarevalue=0,r.total.authorizevalue=0,r.total.ljhj=0,r.total.hjl=0,r.protReviewConditionList.forEach(function(e,t){void 0!=e.proCount&&(r.total.projectcount+=e.proCount),void 0!=e.declareValue&&(r.total.declarevalue=n(r.total.declarevalue,e.declareValue)),void 0!=e.authorizeValue&&(r.total.authorizevalue=n(r.total.authorizevalue,e.authorizeValue)),void 0!=e.ljhj&&(r.total.ljhj=n(r.total.ljhj,e.ljhj))}),r.total.hjl=Math.round(r.total.ljhj/r.total.declarevalue*1e4)/100}var r=this;r.title="项目评审情况统计",r.model={},r.total={},r.proReviewConCount=function(){if(null!=r.model.beginTime&&""!=r.model.beginTime){var e=r.model.beginTime.split("-");r.year=e[0],r.begMonth=e[1],"0"==r.begMonth.charAt(0)&&(r.begMonth=r.begMonth.charAt(1))}if(null!=r.model.endTime&&""!=r.model.endTime){var e=r.model.endTime.split("-");r.year=e[0],r.endMonth=e[1],"0"==r.endMonth.charAt(0)&&(r.endMonth=r.endMonth.charAt(1))}t.proReviewConCount(r,function(e){r.protReviewConditionList=e.reObj.protReviewConditionList,a()})},r.formReset=function(){r.model={}},r.isBeginTime=function(){r.byear=r.model.beginTime.split("-")[0],r.begMonth=r.model.beginTime.split("-")[1],r.endMonth=r.model.endTime.split("-")[1],r.year=r.model.endTime.split("-")[0]},function(){var e=new Date,i=e.getFullYear(),o=e.getMonth()+1,n=e.getDate();o=o<10?"0"+o:o,r.model.beginTime=i.toString()+"-01",r.model.endTime=i.toString()+"-"+o.toString(),r.year=i,r.begMonth="1",r.endMonth=o,r.begDay="31",r.endDay=n,t.proReviewConCount(r,function(e){
r.protReviewConditionList=e.reObj.protReviewConditionList,a()})}()}angular.module("app").controller("proReviewConditionCtrl",e),e.$inject=["$location","proReviewConditionSvc","$state","$http"]}(),function(){"use strict";function e(e){function t(t,i){var o={method:"post",url:rootPath+"/expertSelected/proReviewConditionCount",data:t.model},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}return{proReviewConCount:t}}angular.module("app").factory("proReviewConditionSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,i){function o(e){var t={};if(void 0!=e.flow){var i=e.flow.processInstanceId;(angular.isUndefined(e.flow.hideFlowImg)||0==e.flow.hideFlowImg)&&(e.picture=rootPath+"/flow/processInstance/img/"+i),t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/flow/processInstance/history/"+i),schema:common.kendoGridConfig().schema({id:"id"}),rowNumber:!0,headerCenter:!0})}var o=[{field:"",title:"序号",template:"<span class='row-number'></span>",width:50},{field:"nodeNameValue",title:"环节名称",width:120,filterable:!1},{field:"displayName",title:"处理人",width:80,filterable:!1},{field:"startTime",title:"开始时间",width:120,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"endTime",title:"结束时间",width:120,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"durationStr",title:"处理时长",width:120,filterable:!1},{field:"message",title:"处理信息",width:300,filterable:!1}];e.historygrid={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,resizable:!0,dataBound:function(){var t=this.items();$(t).each(function(i){i==t.length-1&&c(e),$(this).find(".row-number").html(i+1)})}}}function n(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/flow/processInstance/history/"+e.instanceId),schema:common.kendoGridConfig().schema({id:"hctId"}),rowNumber:!0,headerCenter:!0}),i=[{field:"",title:"序号",template:"<span class='row-number'></span>",width:50},{field:"nodeNameValue",title:"环节名称",width:"20%",filterable:!1},{field:"displayName",title:"处理人",width:"15%",filterable:!1},{field:"startTime",title:"开始时间",width:"15%",filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"endTime",title:"结束时间",width:"15%",filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"durationStr",title:"处理时长",width:"15%",filterable:!1},{field:"message",title:"处理信息",width:"20%",filterable:!1}];e.historygrid={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,dataBound:function(){var e=this.items();$(e).each(function(e){$(this).find(".row-number").html(e+1)})}}}function a(t,i,o){var n={method:"post",url:rootPath+"/flow/processInstance/flowNodeInfo",params:{taskId:t,processInstanceId:i}},a=function(e){void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a})}function r(t,i,o){if(common.initJqValidation($("#flow_form")),$("#flow_form").valid()){t=!0;var n={method:"post",url:rootPath+"/flow/commit",data:i},a=function(e){t=!1,void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a,onError:function(e){t=!1}})}}function s(t,i,o){i=!0;var n={method:"post",url:rootPath+"/flow/rollbacklast",data:t},a=function(e){i=!1,void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a,onError:function(e){i=!1}})}function l(t){var i={method:"post",url:rootPath+"/flow/rollbacklast",data:t.flow},o=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:e.data.reMsg})}})};common.http({vm:t,$http:e,httpOptions:i,success:o})}function c(e){e.backNode=[];for(var t=e.historygrid.dataSource.data(),i=t.length,o=0;o<i;o++)t[o].assignee&&t[o].endTime&&e.backNode.push({activitiId:t[o].activityId,activitiName:t[o].activityName,assignee:t[o].assignee})}function d(t,i){var o={method:"post",url:rootPath+"/flow/suspend/"+i,data:t.projectStop},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:e.data.reMsg,closeDialog:!0,fn:function(){"error"==e.data.reCode?t.isCommit=!1:(window.parent.$("#spwindow").data("kendoWindow").close(),t.gridOptions.dataSource.read())}})}})};common.http({vm:t,$http:e,httpOptions:o,success:n,onError:function(){t.isCommit=!1}})}function u(t,i){t.isCommit=!0;var o={method:"post",url:rootPath+"/flow/active/"+i},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:e.data.reMsg,closeDialog:!0,fn:function(){"error"==e.data.reCode?t.isCommit=!1:t.gridOptions.dataSource.read()}})}})};common.http({vm:t,$http:e,httpOptions:o,success:n,onError:function(){t.isCommit=!1}})}function m(t){if(null==t.flow.dealOption||""==t.flow.dealOption)return void common.alert({vm:t,msg:"请填写处理信息！"});var i={method:"post",url:rootPath+"/flow/deleteFLow",data:t.flow},o=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功！"})}})};common.http({vm:t,$http:e,httpOptions:i,success:o})}return{initFlowData:o,getFlowInfo:a,commit:r,rollBackToLast:s,rollBack:l,initBackNode:c,suspendFlow:d,activeFlow:u,deleteFlow:m,historyData:n}}angular.module("app").factory("flowSvc",e),e.$inject=["$http","$state","bsWin"]}(),function(){"use strict";function e(e,t,i,o,n,a,r,s,l,c,d,u,m,p,f,h){function g(e){e=void 0==e?0:e;var t=0;return e>800&&e<=4e3?t=.2*(e-800):e>4e3&&e<=2e4?t=.8*e*.2:e>2e4&&e<=5e4&&(t=.8*e*.3-2e3),t}var v=this;v.title="待办任务处理",v.businessKey=o.params.businessKey,v.processKey=o.params.processKey,v.taskId=o.params.taskId,v.instanceId=o.params.instanceId,v.currentFlow,v.showFlag={businessNext:!1,businessTr:!1,tabSysFile:!1},function(){$("#myTab li").click(function(e){var t=$("a",this);e.preventDefault(),t.tab("show");var i=t.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500)}),v.picture=rootPath+"/flow/processInstance/img/"+v.instanceId,r.historyData(v),r.getFlowInfo(v.taskId,v.instanceId,function(e){if(v.flow=e,v.flow.taskId)if(v.currentFlow=e,v.flow.end)v.showFlag.nodeNext=!1;else switch(v.processKey){case flowcommon.getFlowDefinedKey().TOPIC_FLOW:a.initFlowNode(v.flow,v.showFlag,v)}else n.alert("该任务已处理！",function(){o.go("gtasks")})});var l=0;switch(v.processKey){case flowcommon.getFlowDefinedKey().TOPIC_FLOW:a.initFlowDeal(v),l=1;break;case flowcommon.getFlowDefinedKey().ASSERT_STORAGE_FLOW:c.initFlowDeal(v),l=1;break;case flowcommon.getFlowDefinedKey().BOOKS_BUY_FLOW:s.initFlowDeal(v),l=1;break;case flowcommon.getFlowDefinedKey().PROJECT_STOP_FLOW:d.initFlowDeal(v),l=2;break;case flowcommon.getFlowDefinedKey().FLOW_ARCHIVES:u.initFlowDeal(v),l=1;break;case flowcommon.getFlowDefinedKey().FLOW_APPRAISE_REPORT:m.initFlowDeal(v);break;case flowcommon.getFlowDefinedKey().FLOW_SUPP_LETTER:p.initFlowDeal(v),l=2;break;case flowcommon.getFlowDefinedKey().MONTHLY_BULLETIN_FLOW:f.initFlowDeal(v);break;case flowcommon.getFlowDefinedKey().ANNOUNT_MENT_FLOW:h.initFlowDeal(v),l=1}1==l?i.findByMianId(v.businessKey,function(t){t&&t.length>0&&(v.showFlag.tabSysFile=!0,v.sysFileList=t,i.initZtreeClient(v,e))}):2==l&&i.findByBusinessId(v.businessKey,function(t){t&&t.length>0&&(v.showFlag.tabSysFile=!0,v.sysFileList=t,i.initZtreeClient(v,e))}),t.initIdea(v)}(),v.initFileUpload=function(e,t,o){v.sysFile={businessId:v.businessKey,mainId:v.businessKey,mainType:e,sysfileType:t,sysBusiType:o},i.initUploadOptions({inputId:"sysfileinput",vm:v})},v.commonDownloadSysFile=function(e){i.downloadFile(e)},v.ideaEdit=function(e){angular.isObject(e)||(e={}),t.initIdeaData(v,e)},v.selectedIdea=function(){v.flow.dealOption=v.chooseIdea},v.commitFlow=function(){if(v.flow.isSuspended)return void n.error("该流程目前为暂停状态，不能进行流转操作！");r.commit(v.isCommit,v.flow,function(e){e.flag||"ok"==e.reCode?n.success("操作成功！",function(){o.go("agendaTasks")}):n.alert(e.reMsg)})},v.backFlow=function(){common.initJqValidation($("#flow_form")),$("#flow_form").valid()&&n.confirm({title:"询问提示",message:"确认回退吗？",onOk:function(){r.rollBackToLast(v.flow,v.isCommit,function(e){v.isCommit=!1,e.flag||"ok"==e.reCode?n.alert("回退成功！",function(){o.go("agendaTasks")}):n.alert(e.reMsg)})}})},v.editSelectExpert=function(e){v.scoreExpert={},$.each(v.model.expertReviewDto.expertSelectedDtoList,function(t,i){if(i.id==e)return void(v.scoreExpert=angular.copy(i))}),$("#star_"+v.scoreExpert.id).raty({number:5,score:function(){return $(this).attr("data-num",angular.isUndefined(v.scoreExpert.score)?0:v.scoreExpert.score),$(this).attr("data-num")},starOn:"../contents/libs/raty/lib/images/star-on.png",starOff:"../contents/libs/raty/lib/images/star-off.png",starHalf:"../contents/libs/raty/lib/images/star-half.png",readOnly:!1,halfShow:!0,hints:["不合格","合格","中等","良好","优秀"],size:34,click:function(e,t){v.scoreExpert.score=e}}),$("#score_win").kendoWindow({width:"820px",height:"365px",title:"编辑-专家星级",visible:!1,modal:!0,closable:!0,actions:["Close"]}).data("kendoWindow").center().open()},v.closeEditMark=function(){window.parent.$("#score_win").data("kendoWindow").close()},v.saveMark=function(){v.scoreExpert.score&&0!=v.scoreExpert.score?l.saveMark(v.scoreExpert,function(e){e.flag||"ok"==e.reCode?(angular.forEach(v.model.expertReviewDto.expertSelectedDtoList,function(e,t){e.id==v.scoreExpert.id&&(e.score=v.scoreExpert.score,e.describes=v.scoreExpert.describes)}),n.success("保存成功！",function(){v.closeEditMark()})):n.alert(e.reMsg)}):n.alert("请对专家进行评分！")},v.affirmJoinExpert=function(){v.model.expertReviewDto&&v.model.expertReviewDto.expertSelectedDtoList?(v.confirmEPList=v.model.expertReviewDto.expertSelectedDtoList,$("#confirmJoinExpert").kendoWindow({width:"75%",height:"600px",title:"参加评审会专家确认",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()):n.alert("该项目没有评审专家！")},v.updateToJoin=function(){var e=$("#notJoinExpertTable input[name='notJoinExpert']:checked");if(e.length<1)n.alert("请选择要改为参加会议的专家");else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);l.updateJoinState("","",t.join(","),"9",v.isCommit,function(e){v.reFleshJoinState(t,"9"),n.success("操作成功！")})}},v.updateToNotJoin=function(){var e=$("#joinExpertTable input[name='joinExpert']:checked");if(e.length<1)n.alert("请选择未参加会议的专家");else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);l.updateJoinState("","",t.join(","),"0",v.isCommit,function(e){v.reFleshJoinState(t,"0"),n.success("操作成功！")})}},v.reFleshJoinState=function(e,t){$.each(e,function(e,i){$.each(v.confirmEPList,function(e,o){i==o.id&&(o.isJoin=t)})}),l.refleshBusinessEP(v.model.workPlanDto.id,function(e){v.model.workPlanDto.expertDtoList=e})},v.countTaxes=function(e){if(void 0!=e){if(void 0==e.payDate)return void n.alert("请选择评审费发放日期");if(!/^(\d{4}-\d{1,2}-\d{1,2})$/.exec(e.payDate))return void n.alert("请输入正确的日期格式");if(void 0==e.expertSelectedDtoList||0==e.expertSelectedDtoList.length)return void n.alert("该方案还没评审专家");common.initJqValidation($("#payform"));if($("#payform").valid()){var t,i=e.expertSelectedDtoList.length,o="";$.each(e.expertSelectedDtoList,function(e,t){o+="'"+t.id+"'",e!=i-1&&(o+=",")});var a=e.payDate;t=a.substring(0,a.lastIndexOf("-")),l.countTaxes(o,t,function(t){var i=t;e.reviewCost=0,e.reviewTaxes=0,e.totalCost=0,$.each(e.expertSelectedDtoList,function(t,o){var n=o.EXPERTID,a=o.id,r=0;void 0!=i&&i.length>0&&i.forEach(function(e,t){e.EXPERTID==n&&e.ESID!=a&&(e.REVIEWCOST=void 0==e.REVIEWCOST?0:e.REVIEWCOST,e.REVIEWCOST=parseFloat(e.REVIEWCOST),r=parseFloat(r)+e.REVIEWCOST)}),o.reviewCost=void 0==o.reviewCost?0:o.reviewCost;var s=r+parseFloat(o.reviewCost);o.reviewTaxes=g(s).toFixed(2),o.totalCost=(parseFloat(o.reviewCost)+parseFloat(o.reviewTaxes)).toFixed(2),e.reviewCost=(parseFloat(e.reviewCost)+parseFloat(o.reviewCost)).toFixed(2),e.reviewTaxes=(parseFloat(e.reviewTaxes)+parseFloat(o.reviewTaxes)).toFixed(2),e.totalCost=(parseFloat(e.reviewCost)+parseFloat(e.reviewTaxes)).toFixed(2)}),l.savePayment(e,v.isCommit,function(e){e.flag||"ok"==e.reCode?n.alert("操作成功！",function(){v.isCommit=!1}):n.alert(e.reMsg)})})}else n.alert("请正确填写专家评审费信息！")}},v.closeEditPay=function(){window.parent.$("#payment").data("kendoWindow").close()},v.editUnitScore=function(e){$("#star").raty({number:5,score:function(){return $(this).attr("data-num",angular.isUndefined(v.model.unitScoreDto.score)?0:v.model.unitScoreDto.score),$(this).attr("data-num")},starOn:"../contents/libs/raty/lib/images/star-on.png",starOff:"../contents/libs/raty/lib/images/star-off.png",starHalf:"../contents/libs/raty/lib/images/star-half.png",readOnly:!1,halfShow:!0,hints:["不合格","合格","中等","良好","优秀"],size:34,click:function(e,t){v.model.unitScoreDto.score=e}}),$("#unitscore_win").kendoWindow({width:"820px",height:"365px",title:"编辑-单位星级",visible:!1,modal:!0,closable:!0,actions:["Close"]}).data("kendoWindow").center().open()},v.saveUnit=function(){v.model.unitScoreDto.score&&0!=v.model.unitScoreDto.score?companySvc.saveUnit(v.model.unitScoreDto,function(e){e.flag||"ok"==e.reCode?n.success("保存成功！",function(){v.closeEditUnit()}):n.alert(e.reMsg)}):n.alert("请对单位进行评分！")},v.closeEditUnit=function(){window.parent.$("#unitscore_win").data("kendoWindow").close()},v.updateFlow=function(){common.initJqValidation(),$("form").valid()?f.updatemonthlyMultiyear(v.suppletter,function(e){e.flag||"ok"==e.reCode?v.commitFlow():n.error(e.reMsg)}):n.alert("缺少部分没有填写，请仔细检查")},v.isTime=function(){""!=v.model.readDate&&void 0!=v.model.readDate&&v.flow.businessMap.RETURNDATE<v.model.readDate&&n.alert("归还时间不能小于查阅时间",function(){v.flow.businessMap.RETURNDATE=v.model.readDate,e.$apply()})}}angular.module("app").controller("flowDealCtrl",e),e.$inject=["$scope","ideaSvc","sysfileSvc","$state","bsWin","topicSvc","flowSvc","bookBuyBusinessSvc","expertReviewSvc","assertStorageBusinessSvc","pauseProjectSvc","archivesLibrarySvc","reviewProjectAppraiseSvc","addSuppLetterSvc","monthlyMultiyearSvc","annountmentSvc"]}(),function(){"use strict";function e(e,t,i,o,n,a,r,s,l,c,d,u,m){var p=this;p.title="在办任务详情页",p.businessKey=t.params.businessKey,p.processKey=t.params.processKey,p.taskId=t.params.taskId,p.instanceId=t.params.instanceId,p.showFlag={businessNext:!1,businessTr:!1,tabSysFile:!1,buttBack:!1},function(){switch($("#myTab li").click(function(e){var t=$("a",this);e.preventDefault(),t.tab("show");var i=t.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500)}),p.picture=rootPath+"/flow/processInstance/img/"+p.instanceId,o.historyData(p),p.processKey){case flowcommon.getFlowDefinedKey().TOPIC_FLOW:i.initFlowDeal(p);break;case flowcommon.getFlowDefinedKey().BOOKS_BUY_FLOW:a.initFlowDeal(p);break;case flowcommon.getFlowDefinedKey().ASSERT_STORAGE_FLOW:r.initFlowDeal(p);break;case flowcommon.getFlowDefinedKey().PROJECT_STOP_FLOW:s.initFlowDeal(p);break;case flowcommon.getFlowDefinedKey().FLOW_ARCHIVES:l.initFlowDeal(p);break;case flowcommon.getFlowDefinedKey().FLOW_APPRAISE_REPORT:c.initFlowDeal(p);break;case flowcommon.getFlowDefinedKey().FLOW_SUPP_LETTER:d.initFlowDeal(p);break;case flowcommon.getFlowDefinedKey().MONTHLY_BULLETIN_FLOW:u.initFlowDeal(p);break;case flowcommon.getFlowDefinedKey().ANNOUNT_MENT_FLOW:m.initFlowDeal(p)}n.findByMianId(p.businessKey,function(t){t&&t.length>0&&(p.showFlag.tabSysFile=!0,p.sysFileList=t,p.urlType="flowDetail",n.initZtreeClient(p,e))})}()}angular.module("app").controller("flowDetailCtrl",e),e.$inject=["$scope","$state","topicSvc","flowSvc","sysfileSvc","bookBuyBusinessSvc","assertStorageBusinessSvc","pauseProjectSvc","archivesLibrarySvc","reviewProjectAppraiseSvc","addSuppLetterSvc","monthlyMultiyearSvc","annountmentSvc"]}(),function(){"use strict";function e(e,t,i,o,n,a,r,s,l,c,d){var u=this;u.title="待办任务处理",u.businessKey=t.params.businessKey,u.processKey=t.params.processKey,u.instanceId=t.params.instanceId,u.showFlag={businessNext:!1,businessTr:!1,tabSysFile:!1,buttBack:!1},function(){switch($("#myTab li").click(function(e){var t=$("a",this);e.preventDefault(),t.tab("show");var i=t.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500)}),o.historyData(u),u.processKey){case flowcommon.getFlowDefinedKey().TOPIC_FLOW:i.initFlowDeal(u);break;case flowcommon.getFlowDefinedKey().BOOKS_BUY_FLOW:a.initFlowDeal(u);break;case flowcommon.getFlowDefinedKey().ASSERT_STORAGE_FLOW:r.initFlowDeal(u);break;case flowcommon.getFlowDefinedKey().PROJECT_STOP_FLOW:s.initFlowDeal(u);break;case flowcommon.getFlowDefinedKey().FLOW_ARCHIVES:l.initFlowDeal(u);break;case flowcommon.getFlowDefinedKey().FLOW_APPRAISE_REPORT:c.initFlowDeal(u);break;case flowcommon.getFlowDefinedKey().FLOW_SUPP_LETTER:d.initFlowDeal(u)}n.findByMianId(u.businessKey,function(t){t&&t.length>0&&(u.showFlag.tabSysFile=!0,u.sysFileList=t,u.urlType="flowEnd",n.initZtreeClient(u,e))})}()}angular.module("app").controller("flowEndCtrl",e),e.$inject=["$scope","$state","topicSvc","flowSvc","sysfileSvc","bookBuyBusinessSvc","assertStorageBusinessSvc","pauseProjectSvc","archivesLibrarySvc","reviewProjectAppraiseSvc","addSuppLetterSvc"]}(),function(){"use strict";var e={SIGN_ZR:"SIGN_ZR",SIGN_QS:"SIGN_QS",SIGN_ZHB:"SIGN_ZHB",SIGN_FGLD_FB:"SIGN_FGLD_FB",SIGN_BMFB1:"SIGN_BMFB1",SIGN_BMFB2:"SIGN_BMFB2",SIGN_BMFB3:"SIGN_BMFB3",SIGN_BMFB4:"SIGN_BMFB4",SIGN_XMFZR1:"SIGN_XMFZR1",SIGN_XMFZR2:"SIGN_XMFZR2",SIGN_XMFZR3:"SIGN_XMFZR3",SIGN_XMFZR4:"SIGN_XMFZR4",SIGN_BMLD_SPW1:"SIGN_BMLD_SPW1",SIGN_BMLD_SPW2:"SIGN_BMLD_SPW2",SIGN_BMLD_SPW3:"SIGN_BMLD_SPW3",SIGN_BMLD_SPW4:"SIGN_BMLD_SPW4",SIGN_FGLD_SPW1:"SIGN_FGLD_SPW1",SIGN_FGLD_SPW2:"SIGN_FGLD_SPW2",SIGN_FGLD_SPW3:"SIGN_FGLD_SPW3",SIGN_FGLD_SPW4:"SIGN_FGLD_SPW4",SIGN_FW:"SIGN_FW",SIGN_QRFW:"SIGN_QRFW",SIGN_BMLD_QRFW_XB:"SIGN_BMLD_QRFW_XB",SIGN_BMLD_QRFW:"SIGN_BMLD_QRFW",SIGN_FGLD_QRFW_XB:"SIGN_FGLD_QRFW_XB",SIGN_FGLD_QRFW:"SIGN_FGLD_QRFW",SIGN_ZR_QRFW:"SIGN_ZR_QRFW",SIGN_FWBH:"SIGN_FWBH",SIGN_CWBL:"SIGN_CWBL",SIGN_GD:"SIGN_GD",SIGN_DSFZR_QRGD:"SIGN_DSFZR_QRGD",SIGN_QRGD:"SIGN_QRGD"},t={TOPIC_JHTC:"TOPIC_JHTC",TOPIC_BZSH_JH:"TOPIC_BZSH_JH",TOPIC_FGLD_JH:"TOPIC_FGLD_JH",TOPIC_ZRSH_JH:"TOPIC_ZRSH_JH",TOPIC_BFGW:"TOPIC_BFGW",TOPIC_LXDW:"TOPIC_LXDW",TOPIC_QDHT:"TOPIC_QDHT",TOPIC_YJSS:"TOPIC_YJSS",TOPIC_NBCS:"TOPIC_NBCS",TOPIC_GZFA:"TOPIC_GZFA",TOPIC_BZSH_FA:"TOPIC_BZSH_FA",TOPIC_FGLD_FA:"TOPIC_FGLD_FA",TOPIC_ZRSH_FA:"TOPIC_ZRSH_FA",TOPIC_CGJD:"TOPIC_CGJD",TOPIC_KTBG:"TOPIC_KTBG",TOPIC_BZSH_BG:"TOPIC_BZSH_BG",TOPIC_FGLD_BG:"TOPIC_FGLD_BG",TOPIC_ZRSH_BG:"TOPIC_ZRSH_BG",TOPIC_KTJT:"TOPIC_KTJT",TOPIC_BZSH_JT:"TOPIC_BZSH_JT",TOPIC_FGLD_JT:"TOPIC_FGLD_JT",TOPIC_ZRSH_JT:"TOPIC_ZRSH_JT",TOPIC_YFZL:"TOPIC_YFZL",TOPIC_ZLGD:"TOPIC_ZLGD"},i={BOOK_LEADER_CGQQ:"BOOK_LEADER_CGQQ",BOOK_BZSP:"BOOK_BZSP",BOOK_FGFZRSP:"BOOK_FGFZRSP",BOOK_ZXZRSP:"BOOK_ZXZRSP",BOOK_YSRK:"BOOK_YSRK"},o={FINAL_SIGN_FLOW:"FINAL_SIGN_FLOW",TOPIC_FLOW:"TOPIC_FLOW",BOOKS_BUY_FLOW:"BOOKS_BUY_FLOW",ASSERT_STORAGE_FLOW:"ASSERT_STORAGE_FLOW",PROJECT_STOP_FLOW:"PROJECT_STOP_FLOW",FLOW_ARCHIVES:"FLOW_ARCHIVES",FLOW_APPRAISE_REPORT:"FLOW_APPRAISE_REPORT",FLOW_SUPP_LETTER:"FLOW_SUPP_LETTER",MONTHLY_BULLETIN_FLOW:"MONTHLY_BULLETIN_FLOW",ANNOUNT_MENT_FLOW:"ANNOUNT_MENT_FLOW"},n={getFlowDefinedKey:function(){return o},getSignFlowNode:function(){return e},getTopicFlowNode:function(){return t},getBooksBuyFlowNode:function(){return i},getAssertStorageFlowNode:function(){return i}};window.flowcommon=n}(),function(){"use strict";function e(e,t){var i=this;i.header={},i.id="",i.create=function(t){t&&(i.header.id=t,i.isUpdate=!0,e.getHeaderById(i,t)),i.header={},$("#addHeaderWindow").kendoWindow({width:"500px",height:"300px",title:"新建表字段",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()},i.save=function(){e.createHeader(i)},i.queryUser=function(){i.gridOptions.dataSource._skip=0,i.gridOptions.dataSource.read()},i.del=function(t){e.deleteHeader(i,t)},i.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:i,msg:"请选择数据"});else{for(var t=[],o=0;o<e.length;o++)t.push(e[o].value);var n=t.join(",");i.del(n)}},i.update=function(){e.updateHeader(i)},function(){e.headerGrid(i)}()}angular.module("app").controller("headerCtrl",e),e.$inject=["headerSvc","bsWin"]}(),function(){"use strict";function e(e,t){function i(i){common.initJqValidation();$("form").valid();if(void 0!=i.header.headerKey&&void 0!=i.header.headerName&&void 0!=i.header.headerType){var o={method:"put",url:rootPath+"/header/updateHeader",data:i.header},n=function(e){e.data.flag||"ok"==e.data.reCode?t.success("修改成功!",function(){window.parent.$("#addHeaderWindow").data("kendoWindow").close(),i.gridOptions.dataSource.read()}):t.error(e.data.reMsg)};common.http({vm:i,$http:e,httpOptions:o,success:n})}}function o(i,o){var n={method:"delete",url:rootPath+"/header",params:{id:o}},a=function(e){t.success("删除成功！"),i.gridOptions.dataSource.read()};common.http({vm:i,$http:e,httpOptions:n,success:a})}function n(t,i){var o={method:"get",url:rootPath+"/header/getHeaderById",params:{id:i}},n=function(e){t.header=e.data};common.http({vm:t,$http:e,httpOptions:o,success:n})}function a(t,i){var o={method:"post",url:rootPath+"/header/findHeaderListSelected",params:{headerType:t.headerType}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({vm:t,$http:e,httpOptions:o,success:n})}function r(t,i){var o={method:"put",url:rootPath+"/header/updateSelectedHeader",params:{idStr:i}},n=function(e){};common.http({vm:t,$http:e,httpOptions:o,success:n})}function s(t,i){var o={method:"put",url:rootPath+"/header/updateCancelHeader",params:{idStr:i}},n=function(e){};common.http({vm:t,$http:e,httpOptions:o,success:n})}function l(i){common.initJqValidation();$("form").valid();if(void 0!=i.header.headerKey&&void 0!=i.header.headerName&&void 0!=i.header.headerType){var o={method:"post",url:rootPath+"/header/createHeader",data:i.header},n=function(e){e.data.flag||"ok"==e.data.reCode?t.success("操作成功！",function(){window.parent.$("#addHeaderWindow").data("kendoWindow").close(),i.gridOptions.dataSource.read()}):t.error(e.data.reMsg)};common.http({vm:i,$http:e,httpOptions:o,success:n})}}function c(t){t.header={};var i={method:"post",url:rootPath+"/header/findHeaderListNoSelected",params:{headerType:t.headerType}},o=function(e){t.allHeaderList=e.data};common.http({vm:t,$http:e,httpOptions:i,success:o})}function d(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/header/findAllHeader",$("#headerForm")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"},modifiedDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})},o=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"headerName",title:"列名",width:100,filterable:!1},{field:"headerKey",title:"key值",width:100,filterable:!1},{field:"headerType",title:"类型",width:100,filterable:!1},{field:"",title:"操作",width:140,template:function(e){return common.format($("#columnBtns").html(),"vm.del('"+e.id+"')","vm.create('"+e.id+"')")}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}function u(e,t){c(e),a(e,function(t){e.selectedHeaderList=t,e.header=!0}),$("#selectHeaderWindow").kendoWindow({width:"860px",height:"500px",title:"自定义报表",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open(),e.headerType=t,e.allChecked=function(){var e=$("#selectHeaderForm").find("input");$.each(e,function(e,t){t.checked=!0})},e.allCancel=function(){var e=$("#selectHeaderForm").find("input");$.each(e,function(e,t){t.checked=!1})},e.addHeader=function(){for(var t=[],i=0;i<e.allHeaderList.length;i++){var o={};e.allHeaderList[0].checkbox&&(i=0),o=e.allHeaderList[i],o.checkbox&&(t.push(o.id),e.selectedHeaderList.push(o),e.allHeaderList.splice(i,1),i=0,o.checkbox=!1)}var n=t.join(",");r(e,n)},e.cancelHeader=function(){for(var t=[],i=0;i<e.selectedHeaderList.length;i++){var o={};e.selectedHeaderList[0].checkbox&&(i=0),o=e.selectedHeaderList[i],o.checkbox&&(t.push(o.id),e.allHeaderList.push(o),e.selectedHeaderList.splice(i,1),i=0,o.checkbox=!1)}var n=t.join(",");s(e,n)},e.changeType=function(){c(e),e.selectedHeaderList=[]}}return{headerGrid:d,createHeader:l,findHeaderListNoSelected:c,updateSelectedHeader:r,updateCancelHeader:s,findHeaderListSelected:a,deleteHeader:o,getHeaderById:n,updateHeader:i,selectHeaderWindow:u}}angular.module("app").factory("headerSvc",e),e.$inject=["$http","bsWin"]}(),function(){"use strict";function e(e,t){var i=this;i.selectedHeaderList=[],i.selectList={},i.headerType=t.params.headerType,i.allChecked=function(){var e=$("#selectHeaderForm").find("input");$.each(e,function(e,t){t.checked=!0})},i.allCancel=function(){var e=$("#selectHeaderForm").find("input");$.each(e,function(e,t){t.checked=!1})},i.addHeader=function(){for(var t=[],o=0;o<i.allHeaderList.length;o++){var n=i.allHeaderList[o];n.checkbox&&(t.push(n.id),i.selectedHeaderList.push(n),i.allHeaderList.splice(o,1),o=0,n.checkbox=!1)}var a=t.join(",");e.updateSelectedHeader(i,a)},i.cancelHeader=function(){for(var t=[],o=0;o<i.selectedHeaderList.length;o++){var n=i.selectedHeaderList[o];n.checkbox&&(t.push(n.id),i.allHeaderList.push(n),i.selectedHeaderList.splice(o,1),o=0,n.checkbox=!1)}var a=t.join(",");e.updateCancelHeader(i,a)},i.changeType=function(){e.findHeaderListNoSelected(i),i.selectedHeaderList=[]},function(){e.findHeaderListNoSelected(i),e.findHeaderListSelected(i,function(e){i.selectedHeaderList=e,i.header=!0})}()}angular.module("app").controller("headerEditCtrl",e),e.$inject=["headerSvc","$state"]}(),function(){"use strict";function e(e,t){var i=this;i.title="",i.changePwd=function(){t.changePwd(i)}}angular.module("app").controller("homeCtrl",e),e.$inject=["$location","homeSvc"]}(),function(){"use strict";function e(e){function t(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0;var o={method:"put",url:i,params:{password:t.model.password}},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:t,$http:e,httpOptions:o,success:n})}}var i=rootPath+"/account/password";return{changePwd:t}}angular.module("app").factory("homeSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t){var i=this;i.title="日志列表",function(){t.grid(i)}(),i.queryLog=function(){i.gridOptions.dataSource._skip=0,i.gridOptions.dataSource.read()},i.formReset=function(){var e=$("#logform").find("input,select");$.each(e,function(e,t){t.value=""})}}angular.module("app").controller("logCtrl",e),e.$inject=["$location","logSvc"]}(),function(){"use strict";function e(e,t){function i(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/log/fingByOData",$("#logform")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})},o=[{field:"",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"",title:"级别",width:60,filterable:!1,template:function(e){return e.logLevel?"1"==e.logLevel?"高":"2"==e.logLevel?"中":"3"==e.logLevel?"低":void 0:"低"}},{field:"message",title:"日志内容",filterable:!1,width:400},{field:"module",title:"所属模块",filterable:!1,width:200},{field:"logger",title:"所在方法",filterable:!1,width:350},{field:"userName",title:"操作者",width:80,filterable:!1},{field:"createdDate",title:"操作时间",width:170,filterable:!1,format:"{0:yyyy/MM/dd HH:mm:ss}"}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}return{grid:i}}angular.module("app").factory("logSvc",e),e.$inject=["$http","$compile"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.signid=e.params.signid,n.showExpertConfirm=!0,function(){o.initFlowPageData(n.signid,function(e){n.model=e,n.model.expertReviewDto&&n.model.expertReviewDto.expertSelectedDtoList&&(n.confirmEPList=n.model.expertReviewDto.expertSelectedDtoList)})}(),n.updateToJoin=function(){var e=$("#notJoinExpertTable input[name='notJoinExpert']:checked");if(e.length<1)i.alert("请选择要改为参加会议的专家");else{for(var o=[],a=0;a<e.length;a++)o.push(e[a].value);t.updateJoinState("","",o.join(","),"9",n.isCommit,function(e){n.reFleshJoinState(o,"9"),i.success("操作成功！")})}},n.updateToNotJoin=function(){var e=$("#joinExpertTable input[name='joinExpert']:checked");if(e.length<1)i.alert("请选择未参加会议的专家");else{for(var o=[],a=0;a<e.length;a++)o.push(e[a].value);t.updateJoinState("","",o.join(","),"0",n.isCommit,function(e){n.reFleshJoinState(o,"0"),i.success("操作成功！")})}},n.reFleshJoinState=function(e,i){$.each(e,function(e,t){$.each(n.confirmEPList,function(e,o){t==o.id&&(o.isJoin=i)})}),$.each(n.model.workProgramDtoList,function(e,i){t.refleshBusinessEP(i.id,function(e){i.expertDtoList=e})})}}angular.module("app").controller("maintainExpertConfirmCtrl",e),e.$inject=["$state","expertReviewSvc","bsWin","signSvc"]}(),function(){"use strict";function e(e,t,i,o){function n(e){e=void 0==e?0:e;var t=0;return e>800&&e<=4e3?t=.2*(e-800):e>4e3&&e<=2e4?t=.8*e*.2:e>2e4&&e<=5e4?t=.8*e*.3-2e3:e>5e4&&(t=.8*e*.3-2755),t}var a=this;a.signid=t.params.signid,a.showExpertPayment=!0,function(){e.initFlowPageData(a.signid,function(e){a.model=e})}(),a.countTaxes=function(e){if(void 0!=e){if(void 0==e.payDate)return void i.alert("请选择评审费发放日期");if(!/^(\d{4}-\d{1,2}-\d{1,2})$/.exec(e.payDate))return void i.alert("请输入正确的日期格式");if(void 0==e.expertSelectedDtoList||0==e.expertSelectedDtoList.length)return void i.alert("该方案还没评审专家");common.initJqValidation($("#payform"));if($("#payform").valid()){var t,a=e.expertSelectedDtoList.length,r="";$.each(e.expertSelectedDtoList,function(e,t){r+="'"+t.id+"'",e!=a-1&&(r+=",")});var s=e.payDate;t=s.substring(0,s.lastIndexOf("-")),o.countTaxes(r,t,function(t){var i=t;e.reviewCost=0,e.reviewTaxes=0,e.totalCost=0,$.each(e.expertSelectedDtoList,function(t,o){if(!("9"!=o.isConfrim&&9!=o.isConfrim||"9"!=o.isJoin&&9!=o.isJoin)){var a=o.EXPERTID,r=o.id,s=0;void 0!=i&&i.length>0&&i.forEach(function(e,t){e.EXPERTID==a&&e.ESID!=r&&(e.REVIEWCOST=void 0==e.REVIEWCOST?0:e.REVIEWCOST,e.REVIEWCOST=parseFloat(e.REVIEWCOST),s=parseFloat(s)+e.REVIEWCOST)}),o.reviewCost=void 0==o.reviewCost?0:o.reviewCost;var l=s+parseFloat(o.reviewCost);o.reviewTaxes=n(l).toFixed(2),o.totalCost=(parseFloat(o.reviewCost)+parseFloat(o.reviewTaxes)).toFixed(2),e.reviewCost=(parseFloat(e.reviewCost)+parseFloat(o.reviewCost)).toFixed(2),e.reviewTaxes=(parseFloat(e.reviewTaxes)+parseFloat(o.reviewTaxes)).toFixed(2),e.totalCost=(parseFloat(e.reviewCost)+parseFloat(e.reviewTaxes)).toFixed(2)}})})}}},a.closeEditPay=function(){window.parent.$("#payment").data("kendoWindow").close()},a.savePayment=function(e){if(common.initJqValidation($("#payform")),
$("#payform").valid())if(e.reviewCost){if(e.expertSelectedDtoList)for(var t=!1,n=0;n<e.expertSelectedDtoList.length;n++)if(0==e.expertSelectedDtoList[n].reviewCost)t=!0;else{if(void 0==e.expertSelectedDtoList[n].expertDto.bankAccount||void 0==e.expertSelectedDtoList[n].expertDto.openingBank){t=!1;break}t=!0}else t=!0;t?o.savePayment(e,a.isCommit,function(e){e.flag||"ok"==e.reCode?i.alert("操作成功！",function(){a.isCommit=!1}):i.alert(e.reMsg)}):i.alert("评审费不为0的专家，开户行和银行账户不完整，请写完整！")}else i.alert("请计算税率，再保存！");else i.alert("请正确填写专家评审费信息！")}}angular.module("app").controller("maintainExpertPaymentCtrl",e),e.$inject=["signSvc","$state","bsWin","expertReviewSvc"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.signid=o.params.signid,n.showExpertScore=!0,n.showFlag={},n.showFlag.isMainPrinUser=!0,function(){i.initFlowPageData(n.signid,function(e){n.model=e})}(),n.editSelectExpert=function(e){n.scoreExpert={},$.each(n.model.expertReviewDto.expertSelectedDtoList,function(t,i){if(i.id==e)return void(n.scoreExpert=angular.copy(i))}),$("#star_"+n.scoreExpert.id).raty({number:5,score:function(){return $(this).attr("data-num",angular.isUndefined(n.scoreExpert.score)?0:n.scoreExpert.score),$(this).attr("data-num")},starOn:"../contents/libs/raty/lib/images/star-on.png",starOff:"../contents/libs/raty/lib/images/star-off.png",starHalf:"../contents/libs/raty/lib/images/star-half.png",readOnly:!1,halfShow:!0,hints:["不合格","合格","中等","良好","优秀"],size:34,click:function(e,t){n.scoreExpert.score=e}}),$("#score_win").kendoWindow({width:"820px",height:"365px",title:"编辑-专家星级",visible:!1,modal:!0,closable:!0,actions:["Close"]}).data("kendoWindow").center().open()},n.closeEditMark=function(){window.parent.$("#score_win").data("kendoWindow").close()},n.saveMark=function(){n.scoreExpert.score&&0!=n.scoreExpert.score?e.saveMark(n.scoreExpert,function(e){e.flag||"ok"==e.reCode?(angular.forEach(n.model.expertReviewDto.expertSelectedDtoList,function(e,t){e.id==n.scoreExpert.id&&(e.score=n.scoreExpert.score,e.describes=n.scoreExpert.describes)}),t.success("保存成功！",function(){n.closeEditMark()})):t.alert(e.reMsg)}):t.alert("请对专家进行评分！")},n.editUnitScore=function(e){$("#star").raty({number:5,score:function(){return $(this).attr("data-num",angular.isUndefined(n.model.unitScoreDto.score)?0:n.model.unitScoreDto.score),$(this).attr("data-num")},starOn:"../contents/libs/raty/lib/images/star-on.png",starOff:"../contents/libs/raty/lib/images/star-off.png",starHalf:"../contents/libs/raty/lib/images/star-half.png",readOnly:!1,halfShow:!0,hints:["不合格","合格","中等","良好","优秀"],size:34,click:function(e,t){n.model.unitScoreDto.score=e}}),$("#unitscore_win").kendoWindow({width:"820px",height:"365px",title:"编辑-单位星级",visible:!1,modal:!0,closable:!0,actions:["Close"]}).data("kendoWindow").center().open()},n.saveUnit=function(){n.model.unitScoreDto.score&&0!=n.model.unitScoreDto.score?companySvc.saveUnit(n.model.unitScoreDto,function(e){e.flag||"ok"==e.reCode?t.success("保存成功！",function(){n.closeEditUnit()}):t.alert(e.reMsg)}):t.alert("请对单位进行评分！")},n.closeEditUnit=function(){window.parent.$("#unitscore_win").data("kendoWindow").close()}}angular.module("app").controller("maintainExpertScoreCtrl",e),e.$inject=["expertReviewSvc","bsWin","signSvc","$state"]}(),function(){"use strict";function e(e,t,i,o,n){var a=this;a.title="修改意见",a.model={},a.dispatchDoc={},a.model.signid=i.params.signid,a.model.processInstanceId=i.params.processInstanceId,function(){t.initFlowPageData(a.model.signid,function(e){if(a.model=e,a.dispatchDoc=a.model.dispatchDocDto,a.model.workProgramDtoList){a.workList=a.model.workProgramDtoList;for(var t=0;t<a.model.workProgramDtoList.length;t++)"1"==a.model.workProgramDtoList[t].branchId&&(a.work=a.model.workProgramDtoList[t],a.work.reviewOrgName&&(a.reviewOrgName=a.work.reviewOrgName.split(",")));for(var t=0;t<a.workList.length;t++)a.workList[t].orgName=a.reviewOrgName[a.model.workProgramDtoList[t].branchId-1]}})}(),a.create=function(){if(t.updateFillin(a.model),void 0!=a.workList&&0!=a.workList.length)for(var i=0;i<a.workList.length;i++)n.createWP(a.workList[i],!1,a.iscommit);a.dispatchDoc?(a.dispatchDoc.signid=a.model.signid,o.saveDispatch(a)):e.alert("操作成功")}}angular.module("app").controller("reviewOpinionCtrl",e),e.$inject=["bsWin","signSvc","$state","dispatchSvc","workprogramSvc"]}(),function(){"use strict";function e(e,t,i){var o=this;o.signId=e.params.signid,o.sign={},o.totalReviewDays=0,o.lengthenDays=0,function(){t.initReviewWorkDays(o,function(e){o.sign=e,o.totalReviewDays=o.sign.totalReviewdays,o.lengthenDays=o.sign.lengthenDays})}(),o.saveReview=function(){common.initJqValidation(),$("form").valid()&&t.saveReview(o,function(e){(e.flag||"ok"==e.reCode)&&i.success("操作成功！")})},o.changeTotalReviewDays=function(){o.sign.lengthenDays=o.sign.totalReviewdays-o.totalReviewDays+o.lengthenDays,o.sign.surplusdays=o.sign.totalReviewdays-o.sign.reviewdays}}angular.module("app").controller("reviewWorkdayCtrl",e),e.$inject=["$state","reviewWorkdaysSvc","bsWin"]}(),function(){"use strict";function e(e){function t(t,i){var o={method:"post",url:rootPath+"/maintainProject/initReviewDays",params:{signId:t.signId}},n=function(e){if(void 0!=i&&"function"==typeof i)return i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function i(t,i){var o={method:"put",url:rootPath+"/maintainProject/saveReview",data:t.sign},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}return{initReviewWorkDays:t,saveReview:i}}angular.module("app").factory("reviewWorkdaysSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t){var i=this;i.title="会议室列表",i.model={},i.del=function(o){e.confirm({title:"询问提示",message:"确认删除数据吗？",onOk:function(){t.deleteMeeting(o,i.isSubmit,function(t){i.isSubmit=!1,t.flag||"ok"==t.reCode?e.alert("消息提示","操作成功！",function(){i.gridOptions.dataSource.read()}):e.alert(t.reMsg)})}})},i.used=function(o){i.model.id=o,i.model.mrStatus="1",t.roomUseState(i.model,function(t){e.alert("操作成功！",function(){i.gridOptions.dataSource.read()})})},i.stoped=function(o){e.confirm({title:"询问提示",message:"确认停用么？",onOk:function(){i.model.id=o,i.model.mrStatus="2",t.roomUseState(i.model,function(t){e.alert("操作成功！",function(){i.gridOptions.dataSource.read()})})}})},i.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)e.alert("请选择数据");else{for(var o=[],n=0;n<t.length;n++)o.push(t[n].value);var a=o.join(",");i.del(a)}},i.queryMeeting=function(){i.gridOptions.dataSource._skip=0,i.gridOptions.dataSource.read()},i.formReset=function(){var e=$("#meetingForm").find("input,select");$.each(e,function(e,t){t.value=""})},function(){t.grid(i)}()}angular.module("app").controller("meetingCtrl",e),e.$inject=["bsWin","meetingSvc"]}(),function(){"use strict";function e(e,t,i){var o=this;o.title="添加会议室",o.isuserExist=!1,o.id=i.params.id,o.id&&(o.isUpdate=!0,o.title="更新会议室"),o.create=function(){common.initJqValidation(),$("form").valid()?t.createMeeting(o.model,o.isSubmit,function(t){t.flag||"ok"==t.reCode?e.alert("消息提示","操作成功！",function(){location.href="#/meeting"}):e.alert(t.reMsg)}):e.alert("信息没填写正确！")},o.update=function(){common.initJqValidation(),$("form").valid()?(o.model.id=o.id,t.updateMeeting(o.model,o.isSubmit,function(t){t.flag||"ok"==t.reCode?e.alert("操作成功"):e.alert(t.reMsg)})):e.alert("信息没填写正确！")},function(){o.isUpdate&&t.getMeetingById(o)}()}angular.module("app").controller("meetingEditCtrl",e),e.$inject=["bsWin","meetingSvc","$state"]}(),function(){"use strict";function e(e){function t(t,i,o){i=!0;var n={method:"put",url:l,data:t},a=function(e){i=!1,void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a})}function i(t,i,o){i=!0;var n={method:"delete",url:l,params:{id:t}},a=function(e){i=!1,void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a})}function o(t,i){var o={method:"put",url:l+"/roomUseState",data:t},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function n(t,i,o){i=!0;var n={method:"post",url:l,data:t},a=function(e){void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a,onError:function(e){i=!1}})}function a(t){var i={method:"get",url:l+"/html/findByIdMeeting",params:{id:t.id}},o=function(e){t.model=e.data};common.http({vm:t,$http:e,httpOptions:i,success:o})}function r(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(l+"/fingByOData",$("#meetingForm")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})},o=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"num",title:"编号",width:"8%",filterable:!1},{field:"mrName",title:"会议室名称",width:"25%",filterable:!1},{field:"mrType",title:"类型",width:"10%",filterable:!1},{field:"addr",title:"会议室地点",width:"25%",filterable:!1},{field:"capacity",title:"容量",width:"10%",filterable:!1},{field:"",title:"状态",width:"8%",template:function(e){return"2"==e.mrStatus?"停用":"正常"}},{field:"",title:"操作",width:"14%",template:function(e){var t=!1;return t="2"==e.mrStatus,common.format($("#columnBtns").html(),"vm.stoped('"+e.id+"')",t,"vm.used('"+e.id+"')",t,e.id)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}function s(t){var i={method:"post",url:rootPath+"/meeting/findAll"},o=function(e){void 0!=t&&"function"==typeof t&&t(e.data)};common.http({$http:e,httpOptions:i,success:o,onError:function(){}})}var l=rootPath+"/meeting";return{grid:r,getMeetingById:a,createMeeting:n,deleteMeeting:i,updateMeeting:t,roomUseState:o,findAllMeeting:s}}angular.module("app").factory("meetingSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.title="待办事项",n.addregister={},n.model={},n.model.signid=i.params.signid,function(){n.showPrint=!1,t.grid(n)}(),n.print=function(){signcommon.registerFilePrint(n,{$http:o})},n.findbySuppleDate=function(e){}}angular.module("app").controller("registerFileCtrl",e),e.$inject=["$location","registerFileSvc","$state","$http"]}(),function(){"use strict";function e(e,t){function i(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridinlineConfig().transport(e,{readUrl:o+"/findByOData",updateUrl:o+"/update",destroyUrl:o+"/delete",createUrl:o+"/create/"+e.model.signid},{filter:"signid eq '"+e.model.signid+"'"}),schema:common.kendoGridConfig().schema({id:"id",fields:{fileName:{validation:{required:!0},type:"String"},totalNum:{type:"number",validation:{required:!0,min:1}},isHasOriginfile:{type:"boolean"},isHasCopyfile:{type:"boolean"},suppleDeclare:{type:"string"},suppleDate:{type:"date"},createdDate:{type:"date"},modifiedDate:{type:"date"}}}),batch:!0,pageSize:10,serverPaging:!0,serverSorting:!0,serverFiltering:!0,sort:{field:"createdDate",dir:"desc"}}),i=function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})},n=[{field:"",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"fileName",title:"资料名称",width:"120px",filterable:!1},{field:"totalNum",title:"份数",width:"120px",filterable:!1},{field:"isHasOriginfile",title:"原件",width:"120px",filterable:!1,template:function(e){return e.isHasOriginfile?"是":"否"}},{field:"isHasCopyfile",title:"复印件",width:"120px",filterable:!1,template:function(e){return e.isHasCopyfile?"是":"否"}},{field:"suppleDeclare",title:"补充说明",width:"120px",filterable:!1},{field:"suppleDate",title:"补充日期",width:"120px",format:"{0:yyyy-MM-dd}",filterable:!1},{command:["destroy"],title:"&nbsp;",width:"250px"}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridinlineConfig().filterable,pageable:common.kendoGridinlineConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:n,toolbar:["create","save","cancel"],dataBound:i,editable:!0,navigatable:!0,resizable:!0}}var o=rootPath+"/addRegisterFile";return{grid:i}}angular.module("app").factory("registerFileSvc",e),e.$inject=["$rootScope","$http"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.showsupp=!1,n.title="拟补资料函",n.suppletter={},n.model={},n.model.signid=i.params.signid,n.suppletter.id=i.params.id,n.addSuppContent=function(){n.showsupp=!0,$("#addsuppContent").kendoWindow({width:"50%",height:"80%",title:"拟补资料函正文",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()}}angular.module("app").controller("suppletterCtrls",e),e.$inject=["$location","suppletterSvc","$state","$http"]}(),function(){"use strict";function e(e,t){return{}}angular.module("app").factory("suppletterSvc",e),e.$inject=["$rootScope","$http"]}(),function(){"use strict";function e(e,t){var i=this;i.title="月报简报历史数据管理",i.del=function(e){common.confirm({vm:i,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deletemonthlyHistory(i,e)}})},i.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:i,msg:"请选择数据"});else{for(var t=[],o=0;o<e.length;o++)t.push(e[o].value);var n=t.join(",");i.del(n)}},function(){t.monthlyHistoryGrid(i),t.deleteGridOptions(i)}()}angular.module("app").controller("monthlyHistoryCtrl",e),e.$inject=["$location","monthlyHistorySvc"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.title="添加月报简报历史数据",n.isuserExist=!1,n.id=i.params.id,n.monthly={},n.id&&(n.isUpdate=!0,n.title="更新月报简报"),n.createHistory=function(){common.initJqValidation(),$("form").valid()?t.createmonthlyHistory(n.monthly,function(e){e.flag||"ok"==e.reCode?(n.monthly=e.reObj,o.alert("操作成功！")):o.error(e.reMsg)}):o.alert("缺少部分没有填写，请仔细检查")},n.updateMonthly=function(){t.updatemonthlyHistory(n)},function(){n.isUpdate&&t.getmonthlyHistoryById(n)}()}angular.module("app").controller("monthlyHistoryEditCtrl",e),e.$inject=["$location","monthlyHistorySvc","$state","bsWin"]}(),function(){"use strict";function e(e){function t(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0,t.monthly.id=t.id;var i={method:"put",url:l+"/monthlyEdit",data:t.monthly},o=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:t,$http:e,httpOptions:i,success:o})}}function i(t,i){t.isSubmit=!0;var n={method:"delete",url:l+"/deleteHistory",data:i},a=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read(),o()}})}})};common.http({vm:t,$http:e,httpOptions:n,success:a})}function o(){window.location.reload()}function n(t,i){var o={method:"post",url:l+"/savaHistory",data:t},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function a(t){var i={method:"get",url:rootPath+"/monthlyNewsletter/html/findById",params:{id:t.id}},o=function(e){t.monthly=e.data};common.http({vm:t,$http:e,httpOptions:i,success:o})}function r(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(l+"/mothlyHistoryList"),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})},o=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"startDay",title:"开始时间",width:100,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"startDay",title:"结束时间",width:100,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"stageMunber",title:"已评审项目数",width:120,filterable:!1},{field:"declarationSum",title:"报审总投资",width:100,filterable:!1},{field:"assessorSum",title:"审核总投资",width:100,filterable:!1},{field:"authorizedUser",title:"录入人",width:100,filterable:!1},{field:"authorizedTime",title:"录入时间",width:100,filterable:!1},{field:"",title:"操作",width:100,template:function(e){return common.format($("#columnBtns").html(),e.id,"vm.del('"+e.id+"')")}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,dataBound:i,columns:o,resizable:!0}}function s(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(l+"/deleteHistoryList"),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})},o=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"startDay",title:"开始时间",width:100,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"startDay",title:"结束时间",width:100,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"stageMunber",title:"已评审项目数",width:120,filterable:!1},{field:"declarationSum",title:"报审总投资",width:100,filterable:!1},{field:"assessorSum",title:"审核总投资",width:100,filterable:!1},{field:"authorizedUser",title:"录入人",width:100,filterable:!1},{field:"authorizedTime",title:"录入时间",width:100,filterable:!1}];e.deleteGridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,dataBound:i,columns:o,resizable:!0}}var l=rootPath+"/monthlyNewsletter";return{monthlyHistoryGrid:r,deleteGridOptions:s,createmonthlyHistory:n,deletemonthlyHistory:i,getmonthlyHistoryById:a,updatemonthlyHistory:t}}angular.module("app").factory("monthlyHistorySvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,i,o,n){var a=this;a.title="月报简报查询",a.stateName=i.current.name,a.queryParams={},a.saveView=function(){n.storeView(a.stateName,{gridParams:a.multiyearGrid.dataSource.transport.options.read.data(),queryParams:a.queryParams,data:a})},function(){if(n.view[a.stateName]){var e=n.view[a.stateName];e.gridParams&&(a.gridParams=e.gridParams),e.data&&(a.model=e.data.model),e.queryParams&&(a.queryParams=e.queryParams),t.monthlyMultiyearGrid(a),n.view[a.stateName]=void 0}else t.monthlyMultiyearGrid(a)}(),a.addSuppQuery=function(){a.multiyearGrid.dataSource._skip=0,a.multiyearGrid.dataSource.read()},a.resetAddSupp=function(){var e=$("#form").find("input,select");$.each(e,function(e,t){t.value=""})}}angular.module("app").controller("monthlyMultiFileCtrl",e),e.$inject=["$location","monthlyMultiyearSvc","$state","bsWin","$rootScope"]}(),function(){"use strict";function e(e,t,i,o,n){var a=this;a.title="年度月报简报",a.suppletter={},a.suppletter.fileYear=i.params.year,$("#fileYear").val(a.suppletter.fileYear),a.stateName=i.current.name,a.queryParams={},a.saveView=function(){n.storeView(a.stateName,{gridParams:a.monthlyYearGrid.dataSource.transport.options.read.data(),queryParams:a.queryParams,data:a})},function(){if(n.view[a.stateName]){var e=n.view[a.stateName];e.gridParams&&(a.gridParams=e.gridParams),e.data&&(a.model=e.data.model),e.queryParams&&(a.queryParams=e.queryParams),t.monthlyYearGrid(a),n.view[a.stateName]=void 0}else t.monthlyYearGrid(a);t.findAllOrg(a)}(),a.addSuppQuery=function(){t.addSuppQuery(a)},a.resetAddSupp=function(){var e=$("#form_monthly").find("input,select");$.each(e,function(e,t){t.value=""})},a.del=function(e){common.confirm({vm:a,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deletemonthlyMultiyear(a,e)}})},a.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:a,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");a.del(o)}}}angular.module("app").controller("monthlyMultiyearCtrl",e),e.$inject=["$location","monthlyMultiyearSvc","$state","bsWin","$rootScope"]}(),function(){"use strict";function e(e,t,i,o,n){var a=this;a.title="添加月报简报稿纸",a.isuserExist=!1,a.isSubmit=!0,a.suppletter={},a.id=i.params.id,a.type=i.params.type,a.suppletter.id=i.params.id,a.suppletter.fileYear=i.params.year,a.id&&(a.isUpdate=!0,a.isflow=!0,a.title="更新月报简报稿纸"),a.businessFlag={isInitFileOption:!1},function(){a.isUpdate?e.getmonthlyMultiyearById(a.id,function(e){a.suppletter=e,a.initFileUpload()}):e.initMonthlyMultiyear(function(e){a.suppletter=e,a.suppletter.fileYear=i.params.year,a.initFileUpload()})}(),a.initFileUpload=function(){a.suppletter.id||n.$watch("vm.suppletter.id",function(e,t){e&&e!=t&&!a.initUploadOptionSuccess&&a.initFileUpload()}),a.sysFile={businessId:a.suppletter.id,mainId:a.suppletter.id,mainType:t.mainTypeValue().SIGN,sysfileType:t.mainTypeValue().MONTH_FILE,sysBusiType:t.mainTypeValue().MONTH_FILE},t.initUploadOptions({inputId:"sysfileinput",vm:a})},a.saveAddSuppletter=function(){common.initJqValidation(),$("form").valid()?(a.suppletter.fileType="2",e.createmonthlyMultiyear(a.suppletter,function(e){e.flag||"ok"==e.reCode?(a.suppletter=e.reObj,a.id=e.reObj.id,o.alert("操作成功！")):o.error(e.reMsg)})):o.alert("缺少部分没有填写，请仔细检查")},a.updateAddSuppletter=function(){common.initJqValidation(),$("form").valid()?e.updatemonthlyMultiyear(a.suppletter,function(e){e.flag||"ok"==e.reCode?o.alert("操作成功！"):o.error(e.reMsg)}):o.alert("缺少部分没有填写，请仔细检查")},a.startNewFlow=function(t){o.confirm({title:"询问提示",message:"确认已经完成填写，并且发起流程么？",onOk:function(){$(".confirmDialog").modal("hide"),t?e.updatemonthlyMultiyear(a.suppletter,function(i){i.flag||"ok"==i.reCode?e.startFlow(t,function(e){e.flag||"ok"==e.reCode?o.success("操作成功！",function(){location.href="#/theMonthsList"}):o.error(e.reMsg)}):o.error(i.reMsg)}):(a.suppletter.fileType="2",e.createmonthlyMultiyear(a.suppletter,function(t){t.flag||"ok"==t.reCode?(a.suppletter=t.reObj,a.id=t.reObj.id,e.startFlow(a.id,function(e){e.flag||"ok"==e.reCode?o.success("操作成功！",function(){location.href="#/theMonthsList"}):o.error(e.reMsg)})):o.error(t.reMsg)}))}})}}angular.module("app").controller("monthlyMultiyearEditCtrl",e),e.$inject=["monthlyMultiyearSvc","sysfileSvc","$state","bsWin","$scope"]}(),function(){"use strict";function e(e,t){function i(t){var i={method:"get",url:common.format(h+"/findAllUsers")},o=function(e){t.userlist={},t.userlist=e.data};common.http({vm:t,$http:e,httpOptions:i,success:o})}function o(t){var i={method:"get",url:common.format(h+"/getOrg")},o=function(e){t.orglist={},t.orglist=e.data};common.http({vm:t,$http:e,httpOptions:i,success:o})}function n(e){e.monthlyYearGrid.dataSource._skip=0,e.monthlyYearGrid.dataSource.read()}function a(t){var i={method:"post",url:rootPath+"/monthlyNewsletter/initMonthlyMultiyear"},o=function(e){void 0!=t&&"function"==typeof t&&t(e.data)};common.http({$http:e,httpOptions:i,success:o})}function r(t,i){var o={method:"post",url:f+"/saveMonthlyMultiyear",data:t},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function s(i,o){i.isSubmit=!0;var n={method:"delete",url:f+"/deleteMutiyear",data:o},a=function(e){t.alert("操作成功",function(){i.isSubmit=!1,i.monthlyYearGrid.dataSource.read()})};common.http({vm:i,$http:e,httpOptions:n,success:a})}function l(t,i){var o={method:"post",url:f+"/saveMonthlyMultiyear",data:t},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function c(t,i){var o={method:"post",url:rootPath+"/addSuppLetter/findById",params:{id:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function d(e){var t=common.kendoGridDataSource(rootPath+"/addSuppLetter/monthlyMultiyearList",$("#form_monthly"),e.queryParams.page,e.queryParams.pageSize,e.gridParams),i=[{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"title",title:"文件标题",width:180,filterable:!1,template:function(t){return t.processInstanceId?'<a ng-click="vm.saveView()" href="#/monthlyMultiyView/'+t.id+'" >'+t.title+"</a>":'<a ng-click="vm.saveView()" href="#/monthlyMultiyearEdit/'+e.suppletter.fileYear+"/"+t.id+'" >'+t.title+"</a>"}},{field:"orgName",title:"拟办部门",width:100,filterable:!1},{field:"userName",title:"拟稿人",width:120,filterable:!1},{field:"suppLetterTime",title:"拟稿时间",width:100,filterable:!1},{field:"secretLevel",title:"秘密等级",width:100,filterable:!1},{field:"",title:"操作",width:140,template:function(t){var i=!0;return(angular.isUndefined(t.processInstanceId)||""==t.processInstanceId)&&(i=!1),common.format($("#columnBtns").html(),e.suppletter.fileYear,t.id,i,t.createdBy,t.id,"vm.del('"+t.id+"')")}}];e.monthlyYearGrid={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,pageable:common.kendoGridConfig(e.queryParams).pageable,dataBound:common.kendoGridConfig(e.queryParams).dataBound,columns:i,resizable:!0}}function u(e){var t=common.kendoGridDataSource(rootPath+"/addSuppLetter/monthlyMultiyearList",$("#form"),e.queryParams.page,e.queryParams.pageSize,e.gridParams),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"title",title:"文件标题",width:"30%",filterable:!1,template:function(e){return'<a ng-click="vm.saveView()" href="#/monthlyMultiyView/'+e.id+'" >'+e.title+"</a>"}},{field:"orgName",title:"拟办部门",width:"10%",filterable:!1},{field:"userName",title:"拟稿人",width:"10%",filterable:!1},{field:"suppLetterTime",title:"拟稿时间",width:"10%",filterable:!1},{field:"secretLevel",title:"秘密等级",width:"10%",filterable:!1},{field:"",title:"操作",width:80,template:function(e){return common.format($("#columnBtns").html(),e.id,e.appoveStatus)}}];e.multiyearGrid={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,pageable:common.kendoGridConfig(e.queryParams).pageable,dataBound:common.kendoGridConfig(e.queryParams).dataBound,columns:i,resizable:!0}}function m(t,i){var o={method:"post",url:rootPath+"/monthlyNewsletter/startFlow",params:{id:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function p(e){c(e.businessKey,function(t){e.suppletter=t})}var f=rootPath+"/monthlyNewsletter",h=rootPath+"/user";return{createmonthlyMultiyear:l,initMonthlyMultiyear:a,monthlyMultiyearGrid:u,monthlyYearGrid:d,getmonthlyMultiyearById:c,updatemonthlyMultiyear:r,addSuppQuery:n,findAllOrg:o,findAllUser:i,deletemonthlyMultiyear:s,startFlow:m,initFlowDeal:p}}angular.module("app").factory("monthlyMultiyearSvc",e),e.$inject=["$http","bsWin"]}(),function(){"use strict";function e(e,t,i,o,n){var a=this;a.title="月报详情页面",a.suppletter={},a.id=i.params.id,function(){e.getmonthlyMultiyearById(a.id,function(e){a.suppletter=e})}()}angular.module("app").controller("monthlyMultiyViewCtrl",e),e.$inject=["monthlyMultiyearSvc","sysfileSvc","$state","bsWin","$scope"]}(),function(){"use strict";function e(e,t){var i=this;i.title="月报简报列表",function(){t.monthlyNewsletterGrid(i),t.monthlyDeleteGrid(i)}(),i.del=function(o){e.confirm({title:"询问提示",message:"确认删除数据吗？",onOk:function(){t.deleteMonthlyNewsletter(o,function(t){(t.flag||"ok"==t.reCode)&&e.alert("操作成功！",function(){i.gridOptions.dataSource.read(),i.monthlyDeleteGridOptions.dataSource.read()})})}})},i.dels=function(){var t=common.getKendoCheckId(".grid");if(0==t.length)e.alert("请选择要删除的数据！");else{for(var o=[],n=0;n<t.length;n++)o.push(t[n].value);var a=o.join(",");i.del(a)}}}angular.module("app").controller("monthlyNewsletterCtrl",e),e.$inject=["bsWin","monthlyNewsletterSvc"]}(),function(){"use strict";function e(e,t,i,o){function n(){var e=new Date,t=e.getFullYear(),i=e.getMonth()+1;1==i?(a.monthly.reportMultiyear=t-1+"",a.monthly.startMoultiyear=t-1+"",a.monthly.endMoultiyear=t-1+"",a.monthly.theMonths="12",a.monthly.staerTheMonths="1",a.monthly.endTheMonths="12"):(a.monthly.reportMultiyear=t+"",a.monthly.startMoultiyear=t+"",a.monthly.endMoultiyear=t+"",a.monthly.theMonths=i-1+"",a.monthly.staerTheMonths="1",a.monthly.endTheMonths=i-1+"")}var a=this;a.title="添加月报简报",a.isuserExist=!1,a.id=i.params.id,a.monthly={},a.id&&(a.isUpdate=!0,a.title="更新月报简报"),a.selectMonthly=function(){a.monthly.endTheMonths=a.monthly.theMonths,a.monthly.staerTheMonths="1"},a.reportYear=function(){var e=a.monthly.reportMultiyear;a.monthly.startMoultiyear=e,a.monthly.endMoultiyear=e},a.startMonthly=function(){parseInt(a.monthly.endTheMonths)<parseInt(a.monthly.staerTheMonths)&&(o.alert("开始月份不能大于结束月份"),a.monthly.staerTheMonths=" ")},a.createMothlyNewsletter=function(){common.initJqValidation(),$("#form").valid()?t.createMonthlyNewsletter(a.monthly,function(e){e.flag||"ok"==e.reCode?(a.monthly=e.reObj,o.alert("操作成功！")):o.error(e.reMsg)}):o.alert("缺少部分没有填写，请仔细检查")},a.updateMonthly=function(){t.updateMonthlyNewsletter(a)},a.createMonthReport=function(){t.createMonthReport(a)},function(){a.isUpdate?t.getMonthlyNewsletterById(a):n()}()}angular.module("app").controller("monthlyNewsletterEditCtrl",e),e.$inject=["$location","monthlyNewsletterSvc","$state","bsWin"]}(),function(){"use strict";function e(e){function t(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0,t.monthly.id=t.id;var i={method:"put",url:c+"/monthlyEdit",data:t.monthly},o=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:t,$http:e,httpOptions:i,success:o})}}function i(t,i){var o={method:"delete",url:c+"/deleteMonthlyData",params:{id:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function o(t,i){var o={method:"post",url:c+"/savaMonthlyNewsletter",data:t},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function n(e){void 0==e.monthly.reportMultiyear&&(e.monthly.reportMultiyear=""),void 0==e.monthly.theMonths&&(e.monthly.theMonths=""),void 0==e.monthly.startMoultiyear&&(e.monthly.startMoultiyear=""),void 0==e.monthly.endMoultiyear&&(e.monthly.endMoultiyear=""),void 0==e.monthly.staerTheMonths&&(e.monthly.staerTheMonths=""),void 0==e.monthly.endTheMonths&&(e.monthly.endTheMonths=""),
window.open(rootPath+"/monthlyNewsletter/createMonthReport?reportMultiyear="+e.monthly.reportMultiyear+"&theMonths="+e.monthly.theMonths+"&startMoultiyear="+e.monthly.startMoultiyear+"&endMoultiyear="+e.monthly.endMoultiyear+"&staerTheMonths="+e.monthly.staerTheMonths+"&endTheMonths="+e.monthly.endTheMonths)}function a(t){var i={method:"get",url:rootPath+"/monthlyNewsletter/html/findById",params:{id:t.id}},o=function(e){t.monthly=e.data};common.http({vm:t,$http:e,httpOptions:i,success:o})}function r(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(c+"/findByOData",$("#monthlyForm"),{$filter:"monthlyType eq '1'"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})},o=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"reportMultiyear",title:"报告年度",width:100,filterable:!1},{field:"theMonths",title:"报告月份",width:100,filterable:!1},{field:"remark",title:"报告说明",width:100,filterable:!1},{field:"authorizedUser",title:"编制人",width:100,filterable:!1},{field:"authorizedTime",title:"编制时间",width:100,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"},{field:"",title:"操作",width:140,template:function(e){return common.format($("#columnBtns").html(),e.id,"vm.del('"+e.id+"')")}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,dataBound:i,columns:o,resizable:!0}}function s(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(c+"/findByOData",$("#monthlyForm"),{$filter:"monthlyType eq '2'"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})},o=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"reportMultiyear",title:"报告年度",width:100,filterable:!1},{field:"theMonths",title:"报告月份",width:100,filterable:!1},{field:"remark",title:"报告说明",width:100,filterable:!1},{field:"authorizedUser",title:"编制人",width:100,filterable:!1},{field:"authorizedTime",title:"编制时间",width:100,filterable:!1,format:"{0: yyyy-MM-dd HH:mm:ss}"}];e.monthlyDeleteGridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,dataBound:i,columns:o,resizable:!0}}function l(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/monthlyNewsletter/getMonthlyList"),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}})}),i=function(){var e=this.items();$(e).each(function(){var e=$(this).index()+1,t=$(this).find(".row-number");$(t).html(e)})},o=[{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"monthlyNewsletterName",title:"名称",width:"30%",filterable:!1,template:function(e){return'<a href="#/monthlyFindByMultiyear/'+e.reportMultiyear+'" >'+e.monthlyNewsletterName+"</a>"}},{field:"reportMultiyear",title:"年份",width:"15%",filterable:!1},{field:"remark",title:"备注",width:"40%",filterable:!1},{field:"authorizedTime",title:"添加时间",width:"15%",filterable:!1}];e.theMonthGridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,dataBound:i,columns:o,resizable:!0}}var c=rootPath+"/monthlyNewsletter";return{monthlyNewsletterGrid:r,monthlyDeleteGrid:s,theMonthGrid:l,createMonthlyNewsletter:o,updateMonthlyNewsletter:t,deleteMonthlyNewsletter:i,getMonthlyNewsletterById:a,createMonthReport:n}}angular.module("app").factory("monthlyNewsletterSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t){var i=this;i.title="年度月报简报列表",function(){t.theMonthGrid(i)}()}angular.module("app").controller("yearMonthlyNewsletterCtrl",e),e.$inject=["$location","monthlyNewsletterSvc"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.title="处室人员管理",n.stateName=i.current.name,n.queryParams={},n.saveView=function(){o.storeView(n.stateName,{gridParams:n.gridOptions.dataSource.transport.options.read.data(),queryParams:n.queryParams,data:n})},n.del=function(e){common.confirm({vm:n,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteOfficeUser(n,e)}})},n.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:n,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");n.del(o)}},n.queryOffice=function(){t.queryOffice(n)},function(){if(o.view[n.stateName]){var e=o.view[n.stateName];e.gridParams&&(n.gridParams=e.gridParams),e.data&&(n.model=e.data.model),e.queryParams&&(n.queryParams=e.queryParams),t.grid(n),o.view[n.stateName]=void 0}else t.grid(n)}()}angular.module("app").controller("officeUserCtrl",e),e.$inject=["$location","officeUserSvc","$state","$rootScope"]}(),function(){"use strict";function e(e,t,i){var o=this;o.title="添加人员",o.isuserExist=!1,o.officeID=i.params.officeID,o.officeID&&(o.isUpdate=!0,o.title="更新人员"),o.create=function(){t.createOfficeUser(o)},o.update=function(){t.updateOfficeUser(o)},function(){o.isUpdate&&t.getOfficeUserById(o),t.getDepts(o)}()}angular.module("app").controller("officeUserEditCtrl",e),e.$inject=["$location","officeUserSvc","$state"]}(),function(){"use strict";function e(e){function t(e){e.gridOptions.dataSource._skip=0,e.gridOptions.dataSource.read()}function i(t){var i={method:"get",url:common.format(l+"/getDepts")},o=function(e){t.depts={},t.depts=e.data};common.http({vm:t,$http:e,httpOptions:i,success:o})}function o(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0,t.model.id=t.id;var i={method:"put",url:l,data:t.model},o=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:t,$http:e,httpOptions:i,success:o})}}function n(t,i){t.isSubmit=!0;var o={method:"delete",url:l,data:i},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})}})};common.http({vm:t,$http:e,httpOptions:o,success:n})}function a(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0;var i={method:"post",url:l,data:t.model},o=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,location.href=c}})}})};common.http({vm:t,$http:e,httpOptions:i,success:o})}}function r(t){var i={method:"get",url:rootPath+"/officeUser/html/findById",params:{officeID:t.officeID}},o=function(e){e.data.dept,t.model=e.data};common.http({vm:t,$http:e,httpOptions:i,success:o})}function s(e){var t=common.kendoGridDataSource(l+"/fingByOData",$("#formOffice"),e.queryParams.page,e.queryParams.pageSize,e.gridParams),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.officeID)},filterable:!1,width:20,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:30,filterable:!1,template:"<span class='row-number'></span>"},{field:"officeUserName",title:"办事处联系人",width:100,filterable:!1},{field:"deptName",title:"所在办事处",width:100,filterable:!1},{field:"officePhone",title:"电话",width:100,filterable:!1},{field:"officeEmail",title:"邮件",width:100,filterable:!1},{field:"officeDesc",title:"描述",width:100,filterable:!1},{field:"",title:"操作",width:140,template:function(e){return common.format($("#columnBtns").html(),"vm.del('"+e.officeID+"')",e.officeID)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,pageable:common.kendoGridConfig(e.queryParams).pageable,dataBound:common.kendoGridConfig(e.queryParams).dataBound,resizable:!0}}var l=rootPath+"/officeUser",c="#/officeUserList";return{grid:s,getOfficeUserById:r,createOfficeUser:a,deleteOfficeUser:n,updateOfficeUser:o,getDepts:i,queryOffice:t}}angular.module("app").factory("officeUserSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t){var i=this;i.title="部门列表",i.del=function(e){common.confirm({vm:i,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteOrg(i,e)}})},i.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:i,msg:"请选择数据"});else{for(var t=[],o=0;o<e.length;o++)t.push(e[o].value);var n=t.join(",");i.del(n)}},i.queryOrg=function(){t.queryOrg(i)},function(){t.grid(i)}()}angular.module("app").controller("orgCtrl",e),e.$inject=["$location","orgSvc"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.model={},n.title="新增部门",n.isorgExist=!1,n.model.id=i.params.id,n.model.id&&(n.isUpdate=!0,n.title="更新部门"),function(){t.initRoleUsers(function(e){n.orgMLeaderUsers=e.DIRECTOR,n.orgSLeaderUser=e.VICE_DIRECTOR,n.OrgDirectorUsers=e.DEPT_LEADER}),n.isUpdate&&t.getOrgById(n.model.id,function(e){n.model=e})}(),n.create=function(){common.initJqValidation(),$("form").valid()?($.each(n.OrgDirectorUsers,function(e,t){t.id==n.model.orgDirector&&(n.model.orgDirectorName=t.displayName)}),$.each(n.orgMLeaderUsers,function(e,t){t.id==n.model.orgMLeader&&(n.model.orgMLeaderName=t.displayName)}),$.each(n.orgSLeaderUser,function(e,t){t.id==n.model.orgSLeader&&(n.model.orgSLeaderName=t.displayName)}),t.createOrg(n.model,n.isSubmit,function(e){n.isSubmit=!1,e.flag||"ok"==e.reCode?(n.model.id||(n.model.id=e.idCode),o.success("操作成功！")):o.error(e.reMsg)})):o.alert("保存失败，有红色*号的选项是必填项，请按要求填写！")},n.update=function(){common.initJqValidation(),$("form").valid()?($.each(n.OrgDirectorUsers,function(e,t){t.id==n.model.orgDirector&&(n.model.orgDirectorName=t.displayName)}),$.each(n.orgMLeaderUsers,function(e,t){t.id==n.model.orgMLeader&&(n.model.orgMLeaderName=t.displayName)}),$.each(n.orgSLeaderUser,function(e,t){t.id==n.model.orgSLeader&&(n.model.orgSLeaderName=t.displayName)}),t.updateOrg(n.model,n.isSubmit,function(e){n.isSubmit=!1,e.flag||"ok"==e.reCode?o.success("操作成功！"):o.alert(e.reMsg)})):o.alert("保存失败，有红色*号的选项是必填项，请按要求填写！")}}angular.module("app").controller("orgEditCtrl",e),e.$inject=["$location","orgSvc","$state","bsWin"]}(),function(){"use strict";function e(e,t){function i(e){e.gridOptions.dataSource._skip=0,e.gridOptions.dataSource.read()}function o(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(u+"/fingByOData",$("#orgForm")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"sort",dir:"asc"}}),i=function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})},o=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"name",title:"部门名称",width:130,filterable:!1},{field:"orgFunction",title:"职能",width:130,filterable:!1},{field:"orgDirectorName",title:"部门负责人",width:100,filterable:!1},{field:"orgSLeaderName",title:"分管领导",width:100,filterable:!1},{field:"orgPhone",title:"电话",width:130,filterable:!1},{field:"",title:"操作",width:200,template:function(e){return common.format($("#columnBtns").html(),"vm.del('"+e.id+"')",e.id)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}function n(t,i,o){i=!0;var n={method:"post",url:u,data:t},a=function(e){i=!1,void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a,onError:function(){i=!1}})}function a(t){var i={method:"get",url:common.format(u+"/getCompany")},o=function(e){t.company={},t.company=e.data};common.http({vm:t,$http:e,httpOptions:i,success:o})}function r(t,i){var o={method:"post",url:rootPath+"/org/getOrgById",params:{id:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function s(t,i,o){i=!0;var n={method:"post",url:rootPath+"/org/updateOrg",data:t},a=function(e){i=!1,void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a,onError:function(){i=!1}})}function l(t,i){t.isSubmit=!0;var o={method:"delete",url:u,data:i},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})};common.http({vm:t,$http:e,httpOptions:o,success:n})}function c(t){var i={method:"post",url:rootPath+"/user/initRoleUsers"},o=function(e){void 0!=t&&"function"==typeof t&&t(e.data)};common.http({$http:e,httpOptions:i,success:o})}function d(t,i){var o={method:"post",url:rootPath+"/org/queryOrgList"},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({vm:t,$http:e,httpOptions:o,success:n})}var u=rootPath+"/org";rootPath;return{grid:o,createOrg:n,getOrgById:r,updateOrg:s,deleteOrg:l,getCompany:a,initRoleUsers:c,queryOrg:i,queryOrgList:d}}angular.module("app").factory("orgSvc",e),e.$inject=["$http","$compile"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.id=t.params.id,n.showAddUserDialog=function(){$(".addUser").modal({backdrop:"static",keyboard:!1}),n.orgUserGrid.dataSource.read()},n.closeAddUserDialog=function(){$(".addUser").modal("hide")},n.add=function(e){o.add(n,e)},n.remove=function(e){o.remove(n,e)},n.removes=function(){var e=common.getKendoCheckId(".gird");if(0==e.length)common.alert({vm:n,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");n.remove(o)}},n.query=function(){n.gridOptions.dataSource._skip=0,n.gridOptions.dataSource.read()},n.formReset=function(){var e=$("#form").find("input,select").not(":submit, :reset, :image, :disabled,:hidden");$.each(e,function(e,t){t.value=""})},function(){o.orgUserGrid(n),o.allUserGrid(n)}()}angular.module("app").controller("orgUserCtrl",e),e.$inject=["$location","$state","orgSvc","orgUserSvc"]}(),function(){"use strict";function e(e,t){function i(t,i){var o={method:"delete",url:rootPath+"/org/deleteUsers",params:{orgId:t.id,userId:i}},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.gridOptions.dataSource.read()}})};common.http({vm:t,$http:e,httpOptions:o,success:n})}function o(t,i){var o={method:"post",url:rootPath+"/org/addUsers",params:{orgId:t.id,userId:i}},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.orgUserGrid.dataSource.read(),t.gridOptions.dataSource.read()}})};common.http({vm:t,$http:e,httpOptions:o,success:n})}function n(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(r+"?orgId="+e.id),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"jobState",dir:"desc"}}),i=[{field:"loginName",title:"登录名",width:200,filterable:!0},{field:"displayName",title:"显示名",width:200,filterable:!0},{field:"remark",title:"描述",filterable:!1},{field:"",title:"操作",width:80,template:function(e){return common.format($("#allUserGridBtns").html(),"vm.add('"+e.id+"')")}}];e.orgUserGrid={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0}}function a(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/org/users?orgId="+e.id,$("#form")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!1,serverSorting:!1,serverFiltering:!1,pageSize:10,sort:{field:"jobState",dir:"desc"}}),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"loginName",title:"登录名",width:200,filterable:!1},{field:"displayName",title:"显示名",width:200,filterable:!1},{field:"",title:"在职情况",width:160,filterable:!1,template:function(e){return e.jobState&&"t"==e.jobState?"在职":"已撤销"}},{field:"remark",title:"描述",filterable:!1},{field:"",title:"操作",width:180,template:function(e){return common.format($("#columnBtns").html(),"vm.remove('"+e.id+"')")}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0}}var r=rootPath+"/org/userNotIn";return{orgUserGrid:a,allUserGrid:n,add:o,remove:i}}angular.module("app").factory("orgUserSvc",e),e.$inject=["$http","$compile"]}(),function(){"use strict";function e(e,t,i,o){function n(t,i){var o={method:"post",url:rootPath+"/partyManager/createParty",data:t.party},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function a(t,i){var o={method:"post",url:rootPath+"/partyManager/findById",params:{pmId:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function r(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/partyManager/findByOData",$("#partyform")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})},n=[{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"",title:"名称",width:100,filterable:!1,template:function(e){return"<a  ng-click=\"vm.partyDetail('"+e.pmId+"')\">"+e.pmName+"</a>"}},{field:"pmSex",title:"性别",width:50,filterable:!1},{field:"pmIDCard",title:"身份证号",width:200,filterable:!1},{field:"",title:"民族",width:50,filterable:!1,template:function(e){for(var t="",i=0;i<o.DICT.NATION.dicts.length;i++){var n=o.DICT.NATION.dicts[i];if(e.pmNation==n.dictKey){t=n.dictName;break}}return t}},{field:"pmEducation",title:"学历",width:100,filterable:!1},{field:"pmPhone",title:"手机号",width:100,filterable:!1},{field:"pmTel",title:"固定电话",width:80,filterable:!1},{field:"",title:"人员类别",width:80,filterable:!1,template:function(e){return"1"==e.pmCategory?"正式党员":"2"==e.pmCategory?"预备党员":""}},{field:"pmJoinPartyDate",title:"入党日期",width:80,filterable:!1},{field:"pmTurnToPatryDate",title:"转正日期",width:80,filterable:!1},{field:"",title:"操作",width:120,template:function(e){return 9==e.curState&&!0,common.format($("#columnBtns").html(),"vm.partyDetail('"+e.pmId+"')")}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:n,dataBound:i,resizable:!0}}return{createParty:n,partyGrid:r,findById:a}}angular.module("app").factory("partySvc",e),e.$inject=["$http","$state","bsWin","$rootScope"]}(),function(){"use strict";function e(e,t){var i=this;i.title="党员信息录入",i.party={},function(){$("#myTab li").click(function(e){var t=$("a",this);e.preventDefault(),t.tab("show");var i=t.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500)})}(),i.saveParty=function(){common.initJqValidation(),$("form").valid()&&e.createParty(i,function(e){(e.flag||"ok"==e.reCode)&&(console.log(e),t.alert("保存成功！"))})}}angular.module("app").controller("partyEditCtrl",e),e.$inject=["partySvc","bsWin"]}(),function(){"use strict";function e(e,t){var i=this;i.title="党员信息查询",i.party={},function(){e.partyGrid(i)}(),i.partyDetail=function(t){$("#myTab li").click(function(e){var t=$("a",this);e.preventDefault(),t.tab("show");var i=t.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500)}),$("#partyDetail").kendoWindow({width:"1000px",height:"600px",title:"党员信息表",visible:!1,open:function(){e.findById(t,function(e){i.party=e.reObj})},modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},i.queryParty=function(){i.gridOptions.dataSource.read()}}angular.module("app").controller("partyListCtrl",e),e.$inject=["partySvc","bsWin"]}(),function(){"use strict";function e(e,t,i){var o=this;o.title="党员会议添加",o.party={},function(){i.initOrgAndUser(o)}()}angular.module("app").controller("partyMeetingCtrl",e),e.$inject=["partySvc","bsWin","sharingPlatlformSvc"]}(),function(){"use strict";function e(e,t,i,o,n){var a=this;a.title="项目暂停审批",function(){t.grid(a),n.initIdea(a)}(),a.pauseProjectWindow=function(e,i){t.pauseProjectWindow(a,e,i)},a.commitProjectStop=function(){t.updateProjectStop(a)},a.closewin=function(){window.parent.$("#spwindow").data("kendoWindow").close()},a.selectMinisterIdea=function(){a.projectStop.directorIdeaContent+=a.directorIdea},a.selectDirectorIdea=function(){a.projectStop.leaderIdeaContent+=a.leaderIdea}}angular.module("app").controller("pauseProjectCtrl",e),e.$inject=["$location","pauseProjectSvc","$state","adminSvc","ideaSvc"]}(),function(){"use strict";function e(e,t,i){function o(t,i){var o={method:"post",url:rootPath+"/projectStop/getListInfo",params:{signId:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function n(o,n){var a={method:"post",url:rootPath+"/projectStop/findPausingProject",params:{signId:n}},r=function(e){console.log(e),e.data?i.alert("该项目暂停申请正在处理"):t.go("projectStopForm",{signId:n,stopId:""})};common.http({vm:o,$http:e,httpOptions:a,success:r})}function a(t,i){var o={method:"post",url:rootPath+"/projectStop/initProjectBySignId",params:{signId:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function r(t,i){var o={method:"post",url:rootPath+"/projectStop/savePauseProject",data:t},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function s(t,i){var o={method:"post",url:rootPath+"/projectStop/saveProjectStop",data:t},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function l(e){c(e.businessKey,function(t){e.model=t,e.sign=e.model.signDispaWork})}function c(t,i){var o={method:"post",url:rootPath+"/projectStop/getProjectStopByStopId",params:{stopId:t}},n=function(e){if(void 0!=i&&"function"==typeof i)return i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function d(t,i){var o={method:"post",url:rootPath+"/projectStop/getProjectStopBySignId",params:{signId:t}},n=function(e){if(void 0!=i&&"function"==typeof i)return i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function u(o){if(common.initJqValidation(),$("#form").valid()){var n={method:"post",url:rootPath+"/projectStop/updateProjectStop",data:o.projectStop},a=function(e){i.success("操作成功"),t.go("pauseProject")};common.http({vm:o,$http:e,httpOptions:n,success:a})}}function m(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/projectStop/findByOData"),schema:{data:"value",total:function(e){return e.count?$("#PAUSE_COUNT").html(e.count):$("#PAUSE_COUNT").html(0),e.count},model:{id:"id",fields:{createdDate:{type:"date"},modifiedDate:{type:"date"}}}},serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{field:"",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"",title:"项目名称",width:200,filterable:!1,template:function(e){return e.sign.projectname}},{field:"",title:"评审阶段",width:100,filterable:!1,template:function(e){return e.sign.reviewstage}},{field:"createdDate",title:"申请日期",width:100,format:"{0:yyyy-MM-dd}",filterable:!1},{field:"",title:"操作",width:100,filterable:!1,template:function(e){return common.format($("#columnBtns").html(),e.sign.signid,e.stopid)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,dataBound:function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})}}}return{initProject:a,pauseProject:r,initFlowDeal:l,grid:m,getProjectStopByStopId:c,updateProjectStop:u,findPausingProject:n,getListInfo:o,getProjectStopBySignId:d,saveProjectStop:s}}angular.module("app").factory("pauseProjectSvc",e),e.$inject=["$http","$state","bsWin"]}(),function(){"use strict";function e(e,t,i,o,n){var a=this;a.sign={};var r=e.params.signId;a.projectStop={},a.projectStop.signid=r,a.projectStop.stopId=e.params.stopId,a.showStartFlow=!0,""!=a.projectStop.stopId&&(a.showStartFlow=!1),a.initFileUpload=function(){a.projectStop.stopid||o.$watch("vm.projectStop.stopid",function(e,t){e&&e!=t&&!a.initUploadOptionSuccess&&a.initFileUpload()}),a.sysFile={businessId:a.projectStop.stopid,mainId:a.projectStop.stopid,mainType:"暂停项目",sysBusiType:a.projectStop.sysBusiType,showBusiType:!1},n.initUploadOptions({inputId:"sysfileinput",vm:a,uploadSuccess:function(){n.findByBusinessId(a.projectStop.stopid,function(e){a.sysFilelists=e})}})},function(){t.initProject(r,function(e){a.sign=e,"可行性研究报告"==a.sign.reviewstage||"项目概算"==a.sign.reviewstage?a.sign.countUsedWorkday=15-a.sign.surplusdays:a.sign.countUsedWorkday=12-a.sign.surplusdays}),t.getProjectStopBySignId(r,function(e){e.length>0&&(a.projectStop=e[0],"9"==a.projectStop.isSupplementMaterial&&(a.projectStop.sysBusiType="中心发补充材料函"),"9"==a.projectStop.isPuaseApprove&&(a.projectStop.sysBusiType="申报单位要求暂停审核函"),n.findByBusinessId(a.projectStop.stopid,function(e){a.sysFilelists=e})),a.initFileUpload()})}(),a.Checked=function(e,t){var i=e.target,o=i.checked;t?a.noFile=9!=o&&"9"!=o:a.noFile&&(a.projectStop.isSupplementMaterial=0,a.projectStop.isPuaseApprove=0)},a.commitProjectStop=function(){common.initJqValidation(),$("#form").valid()?(a.projectStop.processName="《"+a.sign.projectname+"》暂停申请",a.projectStop.userDays||(a.projectStop.userDays=a.sign.countUsedWorkday),a.projectStop.signid=a.sign.signid,t.pauseProject(a.projectStop,function(t){t.flag||"ok"==t.reCode?i.alert("操作成功！",function(){e.go("personDtasks")}):i.alert(t.reMsg)})):i.alert("项目暂停表填写不符合要求！")},a.saveProjectStop=function(){common.initJqValidation(),$("#form").valid()?(a.projectStop.signid=a.sign.signid,t.saveProjectStop(a.projectStop,function(e){e.flag||"ok"==e.reCode?(i.alert("操作成功！"),a.projectStop=e.reObj,"9"==a.projectStop.isSupplementMaterial&&(a.projectStop.sysBusiType="中心发补充材料函"),"9"==a.projectStop.isPuaseApprove&&(a.projectStop.sysBusiType="申报单位要求暂停审核函")):i.alert(e.reMsg)})):i.alert("项目暂停表填写不符合要求！")},a.selectMinisterIdea=function(){a.projectStop.directorIdeaContent+=a.directorIdea},a.selectDirectorIdea=function(){a.projectStop.leaderIdeaContent+=a.leaderIdea}}angular.module("app").controller("projectStopFormCtrl",e),e.$inject=["$state","pauseProjectSvc","bsWin","$scope","sysfileSvc"]}(),function(){"use strict";function e(e,t,i,o,n){var a=this;a.stopId=e.params.stopId,a.initFileUpload=function(){a.projectStop.stopid||o.$watch("vm.projectStop.stopid",function(e,t){e&&e!=t&&!a.initUploadOptionSuccess&&a.initFileUpload()}),a.sysFile={businessId:a.projectStop.stopid,mainId:a.projectStop.stopid,mainType:"暂停项目",sysBusiType:a.projectStop.sysBusiType,showBusiType:!0},n.initUploadOptions({inputId:"sysfileinput",vm:a,uploadSuccess:function(){n.findByBusinessId(a.projectStop.stopid,function(e){a.sysFilelists=e})}})},function(){t.getProjectStopByStopId(a.stopId,function(e){a.projectStop=e,a.sign=a.projectStop.signDispaWork,a.sign.countUsedWorkday=a.sign.reviewdays-a.sign.surplusdays,"9"==a.projectStop.isSupplementMaterial&&(a.projectStop.sysBusiType="中心发补充材料函"),"9"==a.projectStop.isPuaseApprove&&(a.projectStop.sysBusiType="申报单位要求暂停审核函"),n.findByBusinessId(a.projectStop.stopid,function(e){a.sysFilelists=e}),a.initFileUpload()})}(),a.saveProjectStop=function(){common.initJqValidation(),$("#form").valid()?t.saveProjectStop(a.projectStop,function(e){e.flag||"ok"==e.reCode?i.alert("操作成功！"):i.alert(e.reMsg)}):i.alert("项目暂停表填写不符合要求！")}}angular.module("app").controller("projectStopFormEditCtrl",e),e.$inject=["$state","pauseProjectSvc","bsWin","$scope","sysfileSvc"]}(),function(){"use strict";function e(e,t){var i=this,o=e.params.signId;i.sign={},function(){t.initProject(o,function(e){i.sign=e,i.sign.countUsedWorkday=i.sign.reviewdays-i.sign.surplusdays}),t.getListInfo(o,function(e){i.projectStopList=e})}()}angular.module("app").controller("projectStopInfoCtrl",e),e.$inject=["$state","pauseProjectSvc"]}(),function(){"use strict";function e(e,t,i){var o=this;o.title="个人代办",o.model={},function(){t.getUser(function(e){o.model=e,t.initAllUser(function(e){o.takeUserList=e,o.initTaskUser(o.model.takeUserId)})}),i.getOrg(function(e){o.org={},o.org=e})}(),o.cancelTakeUser=function(){o.model.takeUserId?e.confirm({title:"询问提示",message:"确认取消代办人么？",onOk:function(){t.cancelTakeUser(function(){o.model.takeUserId="",o.taskUserName="",e.alert("操作成功!")})}}):e.alert("你还没有设置代办人！")},o.saveTakeUser=function(){o.takeUserId?t.saveTakeUser(o.takeUserId,function(t){o.model.takeUserId=o.takeUserId,o.initTaskUser(o.takeUserId),e.alert("操作成功！")}):e.alert("请选择代办人！")},o.initTaskUser=function(e){angular.forEach(o.takeUserList,function(t,i){t.id==e&&(o.taskUserName=t.displayName)})}}angular.module("app").controller("takeUserCtrl",e),e.$inject=["bsWin","takeUserSvc","userSvc"]}(),function(){"use strict";function e(e){function t(t){var i={method:"post",url:rootPath+"/role/findAllRoles"},o=function(e){common.requestSuccess({vm:t,response:e,fn:function(){var i={check:{chkboxType:{Y:"ps",N:"ps"},enable:!0}},o=$linq(e.data).select(function(e){return{id:e.id,name:e.roleName}}).toArray(),n={id:"",name:"角色集合",children:o};$.fn.zTree.init($("#zTree"),i,n),r(t)}})};common.http({vm:t,$http:e,httpOptions:i,success:o})}function i(t){var i={method:"post",url:rootPath+"/user/getAllUserDisplayName"},o=function(e){void 0!=t&&"function"==typeof t&&t(e.data)};common.http({$http:e,httpOptions:i,success:o})}function o(t,i){var o={method:"post",url:rootPath+"/user/saveTakeUser",params:{takeUserId:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({
$http:e,httpOptions:o,success:n})}function n(t){var i={method:"post",url:rootPath+"/user/findCurrentUser"},o=function(e){void 0!=t&&"function"==typeof t&&t(e.data)};common.http({$http:e,httpOptions:i,success:o})}function a(t){var i={method:"get",url:rootPath+"/user/cancelTakeUser"},o=function(e){void 0!=t&&"function"==typeof t&&t(e.data)};common.http({$http:e,httpOptions:i,success:o})}function r(e){for(var t=$.fn.zTree.getZTreeObj("zTree"),i=$linq(e.model.roleDtoList).select(function(e){return e.roleName}).toArray(),o=t.getNodesByParam("level",1,null),n=$linq(o).where(function(e){return $linq(i).contains(e.name)}).toArray(),a=0,r=n.length;a<r;a++)t.checkNode(n[a],!0,!0)}return{initAllUser:i,saveTakeUser:o,getUser:n,cancelTakeUser:a,initZtreeClient:t,updateZtree:r}}angular.module("app").factory("takeUserSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t){var i=this;i.title="定时器配置",function(){t.grid(i)}(),i.addQuartz=function(){i.quartz={},$("#quartz_edit_div").kendoWindow({width:"680px",height:"400px",title:"定时器编辑",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},i.edit=function(e){$("#quartz_edit_div").kendoWindow({width:"600px",height:"400px",title:"定时器修改",visible:!1,modal:!0,open:function(){t.getQuartzById(e,function(e){i.quartz=e})},closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},i.colseQuartz=function(){window.parent.$("#quartz_edit_div").data("kendoWindow").close()},i.saveQuartz=function(){common.initJqValidation($("#quartz_form")),$("#quartz_form").valid()&&t.saveQuartz(i.quartz,function(t){t.flag||"ok"==t.reCode?e.alert("操作成功！",function(){i.colseQuartz(),i.gridOptions.dataSource.read()}):e.alert(t.reMsg)})},i.execute=function(o){t.quartzExecute(o,function(t){t.flag||"ok"==t.reCode?e.alert("操作成功！",function(){i.gridOptions.dataSource.read()}):e.alert(t.reMsg)})},i.stop=function(o){t.quartzStop(o,function(t){t.flag||"ok"==t.reCode?e.alert("操作成功！",function(){i.gridOptions.dataSource.read()}):e.alert(t.reMsg)})},i.del=function(o){e.confirm("确认删除？删除数据无法恢复，请谨慎操作！",function(){t.deleteQuartz(o,function(t){t.flag||"ok"==t.reCode?e.alert("操作成功！",function(){i.gridOptions.dataSource.read()}):e.alert(t.reMsg)})})}}angular.module("app").controller("quartzCtrl",e),e.$inject=["bsWin","quartzSvc"]}(),function(){"use strict";function e(e){function t(t,i){var o={method:"put",url:s+"/quartzExecute",params:{quartzId:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function i(t,i){var o={method:"post",url:s+"/quartzStop",params:{quartzId:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function o(t,i){var o={method:"delete",url:s,params:{id:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function n(t,i){var o={method:"post",url:rootPath+"/quartz",data:t},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function a(t,i){var o={method:"post",url:rootPath+"/quartz/html/findById",params:{id:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function r(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/quartz/findByOData"),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})},o=[{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"quartzName",title:"定时器名称",width:200,filterable:!1},{field:"className",title:"类名",width:260,filterable:!1},{field:"cronExpression",title:"表达式",width:150,filterable:!1},{field:"",title:"状态",width:80,filterable:!1,template:function(e){return e.curState?"9"==e.curState?"<span class='label label-success'>正在执行</span>":"0"==e.curState?"<span class='label label-warning'>已暂停</span>":void 0:""}},{field:"descInfo",title:"描述",width:120,filterable:!1},{field:"",title:"操作",width:80,template:function(e){var t=!1;return 9==e.curState&&(t=!0),common.format($("#columnBtns").html(),"vm.edit('"+e.id+"')","vm.execute('"+e.id+"')",!t,"vm.stop('"+e.id+"')",t)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}var s=rootPath+"/quartz";return{grid:r,getQuartzById:a,saveQuartz:n,deleteQuartz:o,quartzExecute:t,quartzStop:i}}angular.module("app").factory("quartzSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,i,o,n,a){function r(e){e=void 0==e?0:e;var t=0;return e>800&&e<=4e3?t=.2*(e-800):e>4e3&&e<=2e4?t=.8*e*.2:e>2e4&&e<=5e4&&(t=.8*e*.3-2e3),t}var s=this;s.title="评审费发放",s.reviewFee={},s.stateName=o.current.name,s.queryParams={},s.saveView=function(){n.storeView(s.stateName,{gridParams:s.gridOptions.dataSource.transport.options.read.data(),queryParams:s.queryParams,data:s})},function(){if(n.view[s.stateName]){var t=n.view[s.stateName];t.gridParams&&(s.gridParams=t.gridParams),t.data&&(s.reviewFee=t.data.reviewFee),t.queryParams&&(s.queryParams=t.queryParams),e.projectGrid(s),n.view[s.stateName]=void 0}else e.projectGrid(s)}(),s.query=function(){s.gridOptions.dataSource._skip=0,s.gridOptions.dataSource.read()},s.dealWindow=function(t){e.findExpertReview(s,t,function(e){s.expertReview=e,s.expertReview.payDate=(new Date).Format("yyyy-MM-dd"),$("#payFromWindow").kendoWindow({width:"70%",height:"600px",title:"专家评审费发放",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()})},s.countTaxes=function(e){if(void 0!=e){if(void 0==e.payDate)return void i.alert("请选择评审费发放日期");if(!/^(\d{4}-\d{1,2}-\d{1,2})$/.exec(e.payDate))return void i.alert("请输入正确的日期格式");if(void 0==e.expertSelectedDtoList||0==e.expertSelectedDtoList.length)return void i.alert("该方案还没评审专家");common.initJqValidation($("#payform"));if($("#payform").valid()){var o,n=e.expertSelectedDtoList.length,a="";$.each(e.expertSelectedDtoList,function(e,t){a+="'"+t.id+"'",e!=n-1&&(a+=",")});var l=e.payDate;o=l.substring(0,l.lastIndexOf("-")),t.countTaxes(a,o,function(o){var n=o;e.reviewCost=0,e.reviewTaxes=0,e.totalCost=0,$.each(e.expertSelectedDtoList,function(t,i){if("9"==i.isConfrim&&"9"==i.isJoin){var o=i.EXPERTID,a=i.id,s=0;void 0!=n&&n.length>0&&n.forEach(function(e,t){e.EXPERTID==o&&e.ESID!=a&&(e.REVIEWCOST=void 0==e.REVIEWCOST?0:e.REVIEWCOST,e.REVIEWCOST=parseFloat(e.REVIEWCOST),s=parseFloat(s)+e.REVIEWCOST)}),i.reviewCost=void 0==i.reviewCost?0:i.reviewCost;var l=s+parseFloat(i.reviewCost);i.reviewTaxes=r(l).toFixed(2),i.totalCost=(parseFloat(i.reviewCost)+parseFloat(i.reviewTaxes)).toFixed(2),e.reviewCost=(parseFloat(e.reviewCost)+parseFloat(i.reviewCost)).toFixed(2),e.reviewTaxes=(parseFloat(e.reviewTaxes)+parseFloat(i.reviewTaxes)).toFixed(2),e.totalCost=(parseFloat(e.reviewCost)+parseFloat(e.reviewTaxes)).toFixed(2)}}),t.savePayment(e,s.isCommit,function(e){e.flag||"ok"==e.reCode?i.alert("操作成功！",function(){s.isCommit=!1,window.parent.$("#payFromWindow").data("kendoWindow").close(),s.gridOptions.dataSource.read()}):i.alert(e.reMsg)})})}else i.alert("请正确填写专家评审费信息！")}},s.savePayment=function(e){if(common.initJqValidation($("#payform")),$("#payform").valid()){if(e.expertSelectedDtoList)for(var o=!1,n=0;n<e.expertSelectedDtoList.length;n++)if(0==e.expertSelectedDtoList[n].reviewCost)o=!0;else{if(void 0==e.expertSelectedDtoList[n].expertDto.bankAccount||void 0==e.expertSelectedDtoList[n].expertDto.openingBank){o=!1;break}o=!0}else o=!0;o?t.savePayment(e,s.isCommit,function(e){e.flag||"ok"==e.reCode?i.alert("操作成功！",function(){s.isCommit=!1}):i.alert(e.reMsg)}):i.alert("评审费不为0的专家，开户行和银行账户不完整，请写完整！")}else i.alert("请正确填写专家评审费信息！")},s.detail=function(e,t){s.saveView(),"SIGN"==t.trim()&&a.initFlowPageData(e,function(t){s.model=t,o.go("signDetails",{signid:e,processInstanceId:s.model.processInstanceId})}),"TOPIC"==t.trim()&&o.go("flowDetail",{businessKey:e})}}angular.module("app").controller("reviewFeeCtrl",e),e.$inject=["reviewFeeSvc","expertReviewSvc","bsWin","$state","$rootScope","signSvc"]}(),function(){"use strict";function e(e){function t(t,i,o){var n={method:"post",url:rootPath+"/expertReview/initBybusinessId",params:{businessId:i,minBusinessId:""}},a=function(e){void 0==o&&"function"!=typeof o||o(e.data)};common.http({vm:t,$http:e,httpOptions:n,success:a})}function i(e){var t=common.kendoGridDataSource(rootPath+"/reviewFee/findReviewFee",$("#reviewFeeForm"),e.queryParams.page,e.queryParams.pageSize,e.gridParams),i=[{field:"",title:"序号",template:"<span class='row-number'></span>",width:50},{field:"reviewTitle",title:"评审费标题",width:"40%",filterable:!1},{field:"",title:"评审费类型",width:"20%",filterable:!1,template:function(e){return e.businessType&&"SIGN"==e.businessType.trim()?"项目评审费":e.businessType&&"TOPIC"==e.businessType.trim()?"课题评审费":""}},{field:"reviewDate",title:"评审(函评)日期",width:"15%",filterable:!1,format:"{0: yyyy-MM-dd}"},{field:"",title:"操作",width:"20%",template:function(e){return common.format($("#columnBtns").html(),"vm.dealWindow('"+e.businessId+"')","vm.detail('"+e.businessId+"','"+e.businessType+"')")}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,pageable:common.kendoGridConfig(e.queryParams).pageable,dataBound:common.kendoGridConfig(e.queryParams).dataBound,resizable:!0}}return{projectGrid:i,findExpertReview:t}}angular.module("app").factory("reviewFeeSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e){var t=this;t.approve=!0,t.idea=!1,t.appraise={},function(){e.approveListGrid(t)}()}angular.module("app").controller("approveListCtrl",e),e.$inject=["reviewProjectAppraiseSvc"]}(),function(){"use strict";function e(e,t,i){var o=this,n=e.params.signId;o.model={},function(){t.initBySignId(n,function(e){o.model=e})}(),o.commitApprove=function(){common.initJqValidation(),$("#form").valid()?t.saveApply(o.model,function(n){n.flag||"ok"==n.reCode?(o.model=n.reObj,t.startFlow(o.model.id,function(t){(t.flag||"ok"==t.reCode)&&i.success("操作成功！",function(){e.go("personDtasks")})})):i.alert(n.reMsg)}):i.alert("优秀评审报告填报表单未填写正确！")}}angular.module("app").controller("approveWindowCtrl",e),e.$inject=["$state","reviewProjectAppraiseSvc","bsWin"]}(),function(){"use strict";function e(e,t,i){var o=this,n=e.params.id;o.model={},o.addApprove=function(){t.saveApply(o.model,function(){i.alert("操作成功")})},function(){t.getAppraiseById(n,function(e){o.model=e})}()}angular.module("app").controller("approveWindowEditCtrl",e),e.$inject=["$state","reviewProjectAppraiseSvc","bsWin"]}(),function(){"use strict";function e(e,t){var i=this;i.title="优秀评审报告列表",function(){t.appraisingProjectGrid(i)}()}angular.module("app").controller("reviewProjectAppraiseCtrl",e),e.$inject=["$location","reviewProjectAppraiseSvc"]}(),function(){"use strict";function e(e,t,i){function o(e){r(e.businessKey,function(t){e.model=t})}function n(t,i){var o={method:"post",url:rootPath+"/reviewProjectAppraise/startFlow",params:{id:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function a(t,i){var o={method:"post",url:rootPath+"/reviewProjectAppraise/initBySignId",params:{signId:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function r(t,i){var o={method:"post",url:rootPath+"/reviewProjectAppraise/getAppraiseById",params:{id:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function s(e){$("#appraiseWindow").kendoWindow({width:"800px",height:"400px",title:"评审报告评优申请",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()}function l(t,i){var o={method:"post",url:rootPath+"/reviewProjectAppraise/saveApply",data:t},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function c(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/reviewProjectAppraise/findAppraisingProject"),schema:common.kendoGridConfig().schema({id:"id",fields:{}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10}),i=[{field:"",title:"序号",template:"<span class='row-number'></span>",width:50},{field:"",title:"项目名称",width:160,filterable:!1,template:function(e){return e.processInstanceId?'<a href="#/signDetails/'+e.signid+"/"+e.processInstanceId+'" >'+e.projectname+"</a>":'<a href="#/signDetails/'+e.signid+'/" >'+e.projectname+"</a>"}},{field:"reviewstage",title:"评审阶段",width:140,filterable:!1},{field:"signdate",title:"收文日期",width:200,filterable:!1},{field:"dispatchDate",title:"发文日期",width:160,filterable:!1},{field:"reviewOrgName",title:"评审部门",width:140,filterable:!1},{field:"aUserName",title:"项目负责人",width:140,filterable:!1},{field:"ffilenum",title:"归档编号",width:140,filterable:!1},{field:"dfilenum",title:"文件字号",width:140,filterable:!1},{field:"appalyInvestment",title:"申报投资",width:140,filterable:!1},{field:"authorizeValue",title:"审定投资",width:140,filterable:!1},{field:"extraValue",title:"核减（增）投资",width:140,filterable:!1},{field:"extraRate",title:"核减率",width:140,filterable:!1},{field:"approveValue",title:"批复金额",width:140,filterable:!1},{field:"dispatchType",title:"发文类型",width:140,filterable:!1},{field:"fileDate",title:"归档日期",width:140,filterable:!1},{field:"builtcompanyname",title:"建设单位",width:140,filterable:!1}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,dataBound:function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})}}}function d(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/reviewProjectAppraise/getAppraiseReport"),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{field:"",title:"序号",template:"<span class='row-number'></span>",width:50},{field:"",title:"项目名称",width:160,filterable:!1,template:function(e){return e.processInstanceId?'<a href="#/signDetails/'+e.signid+"/"+e.processInstanceId+'" >'+e.projectName+"</a>":'<a href="#/signDetails/'+e.signid+'/" >'+e.projectName+"</a>"}},{field:"appraiseReportName",title:"评审报告名称",width:160,filterable:!1},{field:"proposerName",title:"申请人",width:160,filterable:!1},{field:"proposerTime",title:"申请时间",width:160,filterable:!1,format:"{0: yyyy-MM-dd}"},{field:"",title:"操作",width:100,template:function(e){return common.format($("#columnBtns").html(),e.signid,e.projectname,e.id)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,dataBound:function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})}}}return{initBySignId:a,appraisingProjectGrid:c,appraiseWindow:s,saveApply:l,approveListGrid:d,getAppraiseById:r,startFlow:n,initFlowDeal:o}}angular.module("app").factory("reviewProjectAppraiseSvc",e),e.$inject=["$http","bsWin","$state"]}(),function(){"use strict";function e(e,t){var i=this;i.title="角色列表",i.del=function(e){common.confirm({vm:i,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteRole(i,e)}})},i.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:i,msg:"请选择数据"});else{for(var t=[],o=0;o<e.length;o++)t.push(e[o].value);var n=t.join(",");i.del(n)}},function(){t.grid(i)}()}angular.module("app").controller("roleCtrl",e),e.$inject=["$location","roleSvc"]}(),function(){"use strict";function e(e,t,i){var o=this;o.title="添加角色",o.isRoleExist=!1,o.id=i.params.id,o.id&&(o.isUpdate=!0,o.title="更新角色"),o.create=function(){t.createRole(o)},o.update=function(){t.updateRole(o)},o.checkRole=function(){t.checkRole(o)},function(){o.isUpdate?t.getRoleById(o):t.initZtreeClient(o)}()}angular.module("app").controller("roleEditCtrl",e),e.$inject=["$location","roleSvc","$state"]}(),function(){"use strict";function e(e,t){function i(){return $.fn.zTree.getZTreeObj("zTree").getCheckedNodes(!0)}function o(e){for(var t=$.fn.zTree.getZTreeObj("zTree"),i=$linq(e.model.resources).select(function(e){return e.path}).toArray(),o=t.getNodesByParam("level",1,null),n=$linq(o).where(function(e){return $linq(i).contains(e.path)}).toArray(),a=0,r=n.length;a<r;a++)t.checkNode(n[a],!0,!0)}function n(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(u+"/fingByOData"),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})},o=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:70,filterable:!1,template:"<span class='row-number'></span>"},{field:"roleName",title:"角色名称",width:200,filterable:!1},{field:"remark",title:"描述",filterable:!1},{field:"createdDate",title:"创建时间",width:180,filterable:!1,format:"{0:yyyy-MM-dd HH:mm:ss}"},{field:"",title:"操作",width:180,template:function(e){return common.format($("#columnBtns").html(),"vm.del('"+e.id+"')",e.id)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}function a(t){if(common.initJqValidation(),$("form").valid()&&0==t.isRoleExist){t.isSubmit=!0;var o=i(),n=$linq(o).where(function(e){return 0==e.isParent}).select(function(e){return{id:e.id,name:e.name,path:e.path,method:e.method}}).toArray();t.model.resources=n;var a={method:"post",url:u,data:t.model},r=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=m}})}})};common.http({vm:t,$http:e,httpOptions:a,success:r})}}function r(e){}function s(t){var i={method:"post",url:rootPath+"/role/findById",params:{roleId:t.id}},o=function(e){t.model=e.data,t.isUpdate&&d(t)};common.http({vm:t,$http:e,httpOptions:i,success:o})}function l(t){if(common.initJqValidation(),$("form").valid()&&0==t.isRoleExist){t.isSubmit=!0,t.model.id=t.id;var o=i(),n=$linq(o).where(function(e){return!0}).select(function(e){return{id:e.id,name:e.name,path:e.path,method:e.method}}).toArray();t.model.resources=n;var a={method:"put",url:u,data:t.model},r=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:t,$http:e,httpOptions:a,success:r})}}function c(t,i){t.isSubmit=!0;var o={method:"delete",url:u,data:i},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})};common.http({vm:t,$http:e,httpOptions:o,success:n})}function d(t){var i={method:"get",url:p},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){var i={check:{chkboxType:{Y:"ps",N:"ps"},enable:!0}},n=e.data;$.fn.zTree.init($("#zTree"),i,n),t.isUpdate&&o(t)}})};common.http({vm:t,$http:e,httpOptions:i,success:n})}var u=rootPath+"/role",m="#/role",p=rootPath+"/sys/resource";return{grid:n,createRole:a,checkRole:r,getRoleById:s,updateRole:l,deleteRole:c,initZtreeClient:d}}angular.module("app").factory("roleSvc",e),e.$inject=["$http","$compile"]}(),function(){"use strict";function e(e,t){var i=this;i.title="预定会议统计列表",i.queryRoomCount=function(){t.queryRoomCount(i)},i.ResetRoomCount=function(){t.cleanValue()},function(){t.grid(i),t.roomList(i),t.findAllUsers(i,function(e){i.userlist={},i.userlist=e}),e.initSignList(function(e){(e.flag||"ok"==e.reCode)&&(i.orgDeptList=e.reObj)})}()}angular.module("app").controller("roomCountCtrl",e),e.$inject=["adminSvc","roomCountSvc"]}(),function(){"use strict";function e(e,t){function i(){var e=$("#roomCountform").find("input,select");$.each(e,function(e,t){t.value=""})}function o(e){e.gridOptions.dataSource._skip="",e.gridOptions.dataSource.read()}function n(t,i){var o={method:"get",url:common.format(l+"/findAllUsers")},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({vm:t,$http:e,httpOptions:o,success:n})}function a(t){var i={method:"get",url:common.format(s+"/meeting")},o=function(e){t.roomlists={},t.roomlists=e.data};common.http({vm:t,$http:e,httpOptions:i,success:o})}function r(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(s+"/fingByOData",$("#roomCountform")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})},o=[{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"rbName",title:"会议名称",width:"30%",filterable:!1},{field:"addressName",title:"会议室地点",width:"20%",filterable:!1},{field:"rbDay",title:"会议日期",width:"10%",filterable:!1},{field:"",title:"会议开始时间",width:"10%",filterable:!1,template:function(e){return e.beginTime?new Date(e.beginTime.CompatibleDate()).Format("hh:mm"):""}},{field:"",title:"会议结束时间",type:"date",width:"10%",filterable:!1,template:function(e){return e.endTime?new Date(e.endTime.CompatibleDate()).Format("hh:mm"):""}},{field:"dueToPeople",title:"会议预定人",width:"10%",filterable:!1}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}var s=(rootPath,rootPath+"/room"),l=rootPath+"/user",l=rootPath+"/user";return{grid:r,queryRoomCount:o,roomList:a,cleanValue:i,findAllUsers:n}}angular.module("app").factory("roomCountSvc",e),e.$inject=["$http","$compile"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.title="会议室预定列表",n.initSuccess=!1,n.model={businessId:i.params.businessId,businessType:i.params.businessType},n.startDateTime=new Date("2005/6/1 08:00"),n.startRbDate=new Date,n.endDateTime=new Date("2030/6/1 21:00"),n.currentDate="",n.reportName="会议室安排表",n.search={},n.loadScheduler=!1,function(){t.showMeeting(n,function(e){t.initScheduler(n),n.meetings={},n.meetings=e,t.initDefaultValue(n.model.businessId,n.model.businessType,function(e){n.model=e,n.meetings&&n.meetings.length>0&&(n.search.mrID=n.meetings[0].id,n.model.mrID=n.meetings[0].id,n.findMeeting())}),$("#menu_offcanvas_id").click(function(){$("body").hasClass("sidebar-collapse")?n.t=o(function(){$("#main-sidebar").width()>50&&(n.findMeeting(),o.cancel(n.t))},300):n.t=o(function(){$("#main-sidebar").width()<=50&&(n.findMeeting(),o.cancel(n.t))},300)})})}(),n.refleshData=function(t){n.findMeeting(),t.flag||"ok"==t.reCode?e.alert("操作成功"):e.error(t.reMsg)},n.reQueryDate=function(e){var t,i,o=e.date,a=o.getDay();0==a?(t=o.Days(-6),i=o.Format("yyyy-MM-dd")):1==a?(t=o.Format("yyyy-MM-dd"),i=o.Days(6)):(t=o.Days(-(a-1)),i=o.Days(7-a)),n.search.beginTimeStr=t,n.search.endTimeStr=i,n.findMeeting()},n.findMeeting=function(){t.queryBookRoom(n.search,function(e){n.model.mrID=n.search.mrID,t.setSCDataSource(n,e)})},n.exportThisWeekStage=function(){n.currentDate=$(".k-sm-date-format").html(),n.rbType="0",n.reportName="本周评审会会议安排表",t.exportThisWeekStage(n)},n.exportThisWeek=function(){n.currentDate=$(".k-sm-date-format").html(),n.rbType="1",n.reportName="本周全部会议安排表",t.exportThisWeekStage(n)},n.exportNextWeek=function(){var e=$(".k-sm-date-format").html(),i=e.split("-")[0].split("/"),o=i[0],a=2==i[1].length?i[1]:"0"+i[1],r=i[2].length>=2?i[2].substr(0,2):"0"+i[2].substr(0,1),s=new Date(a+"/"+r+"/"+o),l=new Date(a+"/"+r+"/"+o);s.setDate(s.getDate()+8-s.getDay()),l.setDate(l.getDate()+15-l.getDay());var c=new Date(s),d=new Date(l);n.currentDate=c.getFullYear()+"/"+(c.getMonth()+1)+"/"+c.getDate()+"-"+d.getFullYear()+"/"+(d.getMonth()+1)+"/"+d.getDate(),n.rbType="1",n.reportName="下周全部会议安排表",t.exportThisWeekStage(n)},n.exportNextWeekStage=function(){var e=$(".k-sm-date-format").html(),i=e.split("-")[0].split("/"),o=i[0],a=2==i[1].length?i[1]:"0"+i[1],r=i[2].length>=2?i[2].substr(0,2):"0"+i[2].substr(0,1),s=new Date(a+"/"+r+"/"+o),l=new Date(a+"/"+r+"/"+o);s.setDate(s.getDate()+8-s.getDay()),l.setDate(l.getDate()+15-l.getDay());var c=new Date(s),d=new Date(l);n.currentDate=c.getFullYear()+"/"+(c.getMonth()+1)+"/"+c.getDate()+"-"+d.getFullYear()+"/"+(d.getMonth()+1)+"/"+d.getDate(),n.rbType="0",n.reportName="下周评审会会议安排表",t.exportThisWeekStage(n)}}angular.module("app").controller("roomCtrl",e),e.$inject=["bsWin","roomSvc","$state","$interval"]}(),function(){"use strict";function e(e,t,i){var o=this;o.title="添加会议室预定",o.isuserExist=!1,o.id=i.params.id,o.id&&(o.isUpdate=!0,o.title="更新会议室"),function(){o.isUpdate&&t.getroomById(o)}()}angular.module("app").controller("roomEditCtrl",e),e.$inject=["$location","roomSvc","$state"]}(),function(){"use strict";function e(e,t){function i(e){$("#scheduler").kendoScheduler({date:new Date,width:"100%",startTime:new Date("2005/6/1 08:00"),endTime:new Date("2030/6/1 21:00"),views:[{type:"week",selected:!0,allDaySlot:!1}],editable:{destroy:!0,template:$("#customEditorTemplate").html()},navigate:function(t){e.reQueryDate(t)},edit:function(e){},save:function(t){r(t.event,function(t){e.refleshData(t)})},remove:function(t){o(t.event,function(t){e.refleshData(t)})},eventTemplate:$("#event-template").html(),timezone:"Etc/UTC",footer:!1});var t=$("#scheduler").data("kendoScheduler"),i=t._model.formattedShortDate,n=i.split("-");e.search.beginTimeStr=new Date(n[0].trim()).Format("yyyy-MM-dd"),e.search.endTimeStr=new Date(n[1].trim()).Format("yyyy-MM-dd")}function o(t,i){var o={method:"delete",url:rootPath+"/room",params:{id:t.id,dueToPeople:t.dueToPeople}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({httpOptions:o,$http:e,success:n})}function n(t,i){var o={method:"post",url:rootPath+"/room/queryBookInfo",data:t},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function a(e,t){var i=$("#scheduler").data("kendoScheduler"),o=new kendo.data.SchedulerDataSource({data:t,schema:{model:{id:"bookId",fields:{bookId:{from:"id"},title:{from:"addressName",defaultValue:"会议室",validation:{required:!0}},start:{type:"date",from:"beginTime"},end:{type:"date",from:"endTime"},rbDay:{type:"date",from:"rbDay",format:"yyyy-MM-dd"},businessId:{from:"businessId",defaultValue:e.model.businessId},businessType:{from:"businessType",defaultValue:e.model.businessType},rbName:{from:"rbName",defaultValue:e.model.rbName},stageOrgName:{from:"stageOrgName",defaultValue:e.model.stageOrgName},host:{from:"host",defaultValue:e.model.host},dueToPeople:{from:"dueToPeople",defaultValue:e.model.dueToPeople},mrID:{from:"mrID",defaultValue:e.model.mrID},content:{from:"content",defaultValue:e.model.content},remark:{from:"remark",defaultValue:e.model.remark}}}}});i.setDataSource(o)}function r(t,i){var o=t;if(o.rbName&&o.dueToPeople&&o.rbDay&&o.start&&o.end&&o.content){o.id=o.bookId;var n=o.start.Format("yyyy-MM-dd hh:mm:ss");o.beginTime=n,o.rbDay=o.start.Format("yyyy-MM-dd");var a=o.end.Format("hh:mm:ss");o.endTime=o.rbDay+" "+a;var r={method:"post",url:rootPath+"/room/addRoom",data:o},s=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:r,success:s})}else{var r={method:"post",url:rootPath+"/room/errorResult"},s=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:r,success:s})}}function s(t,i){var o={method:"get",url:rootPath+"/room/meeting"},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function l(t,i,o){var n={method:"post",url:rootPath+"/room/initDefaultValue",params:{businessId:t,businessType:i}},a=function(e){void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a})}function c(e){var t=escape(encodeURIComponent(e.reportName));window.open(d+"/exportThisWeekStage?currentDate="+e.currentDate+"&rbType="+e.rbType+"&mrId="+e.mrID+"&fileName="+t)}var d=rootPath+"/room";return{initScheduler:i,queryBookRoom:n,setSCDataSource:a,showMeeting:s,exportThisWeekStage:c,initDefaultValue:l,saveBookRoom:r,deleteRoom:o}}angular.module("app").factory("roomSvc",e),e.$inject=["$http","bsWin"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.title="资料共享详情页",n.model={},n.model.sharId=t.params.sharId,n.downloadSysFile=function(e){i.downloadFile(e)},function(){o.getSharingDetailById(n,n.model.sharId),i.findByBusinessId(n.model.sharId,function(e){n.sysFilelists=e})}()}angular.module("app").controller("sharingDetailCtrl",e),e.$inject=["$location","$state","sysfileSvc","sharingPlatlformSvc"]}(),function(){"use strict";function e(e,t,i,o,n,a){var r=this;r.title="共享资料管理",r.stateName=t.current.name,r.queryParams={},r.saveView=function(){n.storeView(r.stateName,{gridParams:r.gridOptions.dataSource.transport.options.read.data(),queryParams:r.queryParams,data:r})},function(){if(n.view[r.stateName]){var e=n.view[r.stateName];e.gridParams&&(r.gridParams=e.gridParams),e.data&&(r.model=e.data.model),e.queryParams&&(r.queryParams=e.queryParams),o.grid(r),n.view[r.stateName]=void 0}else o.grid(r)}(),r.del=function(e){common.confirm({vm:r,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),o.deleteSharingPlatlform(r,e)}})},r.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:r,msg:"请选择要删除的数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");r.del(o)}},r.bathPublish=function(){o.updatePublish(r,!0)},r.bathDown=function(){o.updatePublish(r,!1)},r.querySharing=function(){r.gridOptions.dataSource._skip=0,r.gridOptions.dataSource.read()},r.resetSharing=function(){var e=$("#formSharing").find("input,select");$.each(e,function(e,t){t.value=""})}}angular.module("app").controller("sharingPlatlformCtrl",e),e.$inject=["$location","$state","$http","sharingPlatlformSvc","$rootScope","monthlyMultiyearSvc"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.title="新增共享资料",n.model={},n.businessFlag={isUpdate:!1,isLoadModel:!1,isLoadOrgUser:!1},n.model.sharId=t.params.sharId,n.model.sharId&&(n.businessFlag.isUpdate=!0,n.title="更改共享资料"),n.initFileUpload=function(){n.model.sharId||o.$watch("vm.model.sharId",function(e,t){e&&e!=t&&!n.initUploadOptionSuccess&&n.initFileUpload()}),n.sysFile={businessId:n.model.sharId,mainId:n.model.sharId,mainType:i.mainTypeValue().SHARE
},i.initUploadOptions({inputId:"sysfileinput",vm:n,uploadSuccess:function(){i.findByBusinessId(n.model.sharId,function(e){n.sysFilelists=e})}})},function(){n.model.sharId?e.getSharingPlatlformById(n,function(t){n.model=t,n.businessFlag.isLoadModel=!0,e.initSeleObj(n),i.findByBusinessId(n.model.sharId,function(e){n.sysFilelists=e,n.initFileUpload()})}):n.initFileUpload(),e.initOrgAndUser(n)}(),n.resetSharing=function(){var e=$("#formSharing").find("input,select");$.each(e,function(e,t){t.value=""})},n.create=function(){e.createSharingPlatlform(n)},n.checkBox=function(e){var t=e.target,i=t.checked,o=t.value;i?$('input[tit="'+o+'"]').each(function(){$(this).attr("disabled","disabled"),$(this).removeAttr("checked")}):$('input[tit="'+o+'"]').each(function(){$(this).removeAttr("disabled")})}}angular.module("app").controller("sharingPlatlformEditCtrl",e),e.$inject=["sharingPlatlformSvc","$state","sysfileSvc","$scope"]}(),function(){"use strict";function e(e,t){function i(e){!e.businessFlag.isLoadOrgUser||!e.businessFlag.isLoadModel||e.model.isNoPermission&&"9"==e.model.isNoPermission||e.shareOrgList&&e.shareOrgList.length>0&&(e.model.privilegeDtoList&&e.model.privilegeDtoList.length>0&&e.shareOrgList.forEach(function(t,i){e.model.privilegeDtoList.forEach(function(e,i){1==e.businessType||"1"==e.businessType?e.businessId==t.id&&(t.isChecked=!0,t.userDtos.forEach(function(e,t){e.isDisabled=!0})):2!=e.businessType&&"2"!=e.businessType||t.userDtos.forEach(function(t,i){e.businessId==t.id&&(t.isChecked=!0)})})}),e.noOrgUsetList&&e.noOrgUsetList.length>0&&void 0!=e.model.privilegeDtoList&&e.noOrgUsetList.forEach(function(t,i){e.model.privilegeDtoList.forEach(function(e,i){2!=e.businessType&&"2"!=e.businessType||e.businessId!=t.id||(t.isChecked=!0)})}),e.businessFlag.isInitSeled=!0)}function o(t){var o={method:"post",url:rootPath+"/sharingPlatlform/initOrgAndUser"},n=function(e){t.shareOrgList=e.data.orgDtoList,t.noOrgUsetList=e.data.noOrgUserList,t.businessFlag.isLoadOrgUser=!0,i(t)};common.http({vm:t,$http:e,httpOptions:o,success:n})}function n(t,i){var o={method:"get",url:d+"/html/sharingDeatilById",params:{id:i}},n=function(e){t.model=e.data};common.http({vm:t,$http:e,httpOptions:o,success:n})}function a(i,o){i.isSubmit=!0;var n={method:"delete",url:d+"/sharingDelete",data:o},a=function(e){i.isSubmit=!1,i.gridOptions.dataSource.read(),t.alert("操作成功")};common.http({vm:i,$http:e,httpOptions:n,success:a})}function r(i){if($("form").valid()){if(i.isSubmit=!0,9!=i.model.isNoPermission){i.model.privilegeDtoList=[];var o=$("input[name='shareOrg']:checked");if(o.length>0)for(var n=0;n<o.length;n++){var a={};a.businessId=o[n].value,a.businessType="1",i.model.privilegeDtoList.push(a)}var r=$("input[name='shareUser']:not(:disabled):checked");if(r.length>0)for(var n=0;n<r.length;n++){var s={};s.businessId=r[n].value,s.businessType="2",i.model.privilegeDtoList.push(s)}}var l={method:"post",url:rootPath+"/sharingPlatlform/saveSharing",data:i.model},c=function(e){i.isSubmit=!1,i.model.sharId=e.data.sharId,t.alert("操作成功")};common.http({$http:e,httpOptions:l,success:c,onError:function(){i.isSubmit=!1}})}}function s(t,i){var o={method:"get",url:d+"/html/findById",params:{id:t.model.sharId}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({vm:t,$http:e,httpOptions:o,success:n})}function l(e){var t=common.kendoGridDataSource(d+"/findByCurUser",$("#formSharing"),e.queryParams.page,e.queryParams.pageSize,e.gridParams),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.sharId)},filterable:!1,width:30,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"unitSort",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"theme",title:"主题",width:"35%",filterable:!1},{field:"publishUsername",title:"发布人",width:"10%",filterable:!1},{field:"publishDate",title:"发布时间",format:"{0:yyyy-MM-dd hh24:mm:ss}",width:"18%",filterable:!1},{field:"isPublish",title:"发布状态",width:"12%",template:function(e){return e.isPublish&&9==e.isPublish?"已发布":"未发布"},filterable:!1},{field:"",title:"操作",width:"20%",template:function(e){return common.format($("#columnBtns").html(),e.sharId,e.sharId,"vm.del('"+e.sharId+"')")}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,pageable:common.kendoGridConfig(e.queryParams).pageable,dataBound:common.kendoGridConfig(e.queryParams).dataBound,columns:i,resizable:!0}}function c(t,i){var o=common.getKendoCheckId(".grid");if(0==o.length)common.alert({vm:t,msg:"请选择要批量发布的数据"});else{for(var n=[],a=0;a<o.length;a++)n.push(o[a].value);var r={method:"post",url:rootPath+"/sharingPlatlform/updatePublish",params:{ids:n.join(","),status:1==i?"9":"0"}},s=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read(),common.alert({vm:t,msg:"操作成功",closeDialog:!0})}})};common.http({vm:t,$http:e,httpOptions:r,success:s})}}var d=rootPath+"/sharingPlatlform";return{grid:l,getSharingPlatlformById:s,createSharingPlatlform:r,deleteSharingPlatlform:a,getSharingDetailById:n,initOrgAndUser:o,initSeleObj:i,updatePublish:c}}angular.module("app").factory("sharingPlatlformSvc",e),e.$inject=["$http","bsWin"]}(),function(){"use strict";function e(e,t,i,o,n){var a=this;a.title="共享资料列表",a.model={},a.stateName=t.current.name,a.queryParams={},a.saveView=function(){n.storeView(a.stateName,{gridParams:a.gridOptions.dataSource.transport.options.read.data(),queryParams:a.queryParams,data:a})},function(){if(n.view[a.stateName]){var e=n.view[a.stateName];e.gridParams&&(a.gridParams=e.gridParams),e.data&&(a.model=e.data.model),e.queryParams&&(a.queryParams=e.queryParams),o.grid(a),n.view[a.stateName]=void 0}else o.grid(a)}(),a.findSharing=function(){a.gridOptions.dataSource._skip=0,a.gridOptions.dataSource.read()},a.resetShared=function(){var e=$("#formSharingPub").find("select");$.each(e,function(e,t){t.value=""})}}angular.module("app").controller("sharingPlatlformYetCtrl",e),e.$inject=["$location","$state","$http","sharingPlatlformYetSvc","$rootScope"]}(),function(){"use strict";function e(e){function t(e){var t=common.kendoGridDataSource(rootPath+"/sharingPlatlform/findByReception",$("#formSharingPub"),e.queryParams.page,e.queryParams.pageSize,e.gridParams),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.sharId)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"unitSort",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"theme",title:"共享主题",width:180,filterable:!0},{field:"publishUsername",title:"发布人",width:100,filterable:!0},{field:"publishDate",title:"发布时间",width:100,filterable:!0},{field:"",title:"操作",width:140,template:function(e){return common.format($("#columnBtns").html(),e.sharId)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,pageable:common.kendoGridConfig(e.queryParams).pageable,dataBound:common.kendoGridConfig(e.queryParams).dataBound,resizable:!0}}return{grid:t}}angular.module("app").factory("sharingPlatlformYetSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.model={},n.title="新增收文",n.create=function(){common.initJqValidation(),$("form").valid()&&t.createSign(n.model,function(e){e.flag||"ok"==e.reCode?e.reObj.processInstanceId?o.alert("操作成功！"):o.success("操作成功，请继续填写项目审核登记表",function(){i.go("fillSign",{signid:e.reObj.signid},{reload:!0})}):o.error(e.reMsg)})}}angular.module("app").controller("signCreateCtrl",e),e.$inject=["$location","signSvc","$state","bsWin"]}(),function(){"use strict";function e(e,t,i,o,n,a){var r=this;r.model={},r.stateName=t.current.name,r.queryParams={},r.saveView=function(){a.storeView(r.stateName,{gridParams:r.gridOptions.dataSource.transport.options.read.data(),queryParams:r.queryParams,data:r})},function(){if(a.view[r.stateName]){var t=a.view[r.stateName];t.gridParams&&(r.gridParams=t.gridParams),t.data&&(r.model=t.data.model),t.queryParams&&(r.queryParams=t.queryParams),e.signGrid(r),a.view[r.stateName]=void 0}else e.signGrid(r)}(),r.getSignInfo=function(){if(""==r.model.filecode||null==r.model.filecode)return void n.alert("收文编号不能为空!");e.getSignInfo(r.model.filecode,"0",function(e){if(e.flag||"ok"==e.reCode){if("保存成功！"!=e.reMsg)return void n.alert(e.reMsg);r.gridOptions.dataSource.read()}else n.alert(e.reMsg)})},r.querySign=function(){r.gridOptions.dataSource._skip=0,r.gridOptions.dataSource.read()},r.check=function(){r.isAssociate=r.ischeck?9:0},r.del=function(t){n.confirm({title:"询问提示",message:"确认删除该条项目数据吗？",onOk:function(){e.deleteSign(t,function(e){e.flag||"ok"==e.reCode?n.alert("删除成功！",function(){r.gridOptions.dataSource.read()}):n.alert(e.reMsg)})}})},r.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:r,msg:"请选择数据"});else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);var o=t.join(",");r.del(o)}},r.startNewFlow=function(e){n.confirm({title:"询问提示",message:"确认已经完成填写，并且发起流程么？",onOk:function(){$(".confirmDialog").modal("hide"),o.startFlow(e,function(e){e.flag||"ok"==e.reCode?n.success("操作成功！",function(){r.gridOptions.dataSource.read()}):n.error(e.reMsg)})}})},r.realSign=function(t){n.confirm({title:"询问提示",message:"确认正式签收了么？",onOk:function(){$(".confirmDialog").modal("hide"),e.realSign(t,function(e){e.flag||"ok"==e.reCode?n.success("操作成功！",function(){r.gridOptions.dataSource.read()}):n.error(e.reMsg)})}})}}angular.module("app").controller("signCtrl",e),e.$inject=["signSvc","$state","flowSvc","signFlowSvc","bsWin","$rootScope"]}(),function(){"use strict";function e(e,t,i,o,n,a,r){var s=this;s.model={},s.title="填写报审登记表",s.model.signid=i.params.signid,s.flowDeal=!1,s.busiObj={},s.otherFile=[],s.supply={},s.isControl=i.params.isControl,function(){e.initFillData(s.model.signid,function(e){s.model=e.reObj.sign,s.deptlist=e.reObj.deptlist,e.reObj.mainOfficeList&&(s.mainOfficeList=e.reObj.mainOfficeList),e.reObj.assistOfficeList&&(s.assistOfficeList=e.reObj.assistOfficeList),s.companyList=e.reObj.companyList,s.busiObj.leaderList=e.reObj.leaderList,s.sysFile={businessId:s.model.signid,mainId:s.model.signid,mainType:t.mainTypeValue().SIGN,sysfileType:t.mainTypeValue().FILLSIGN},t.initUploadOptions({inputId:"sysfileinput",vm:s}),"项目建议书"==s.model.reviewstage||"可行性研究报告"==s.model.reviewstage?s.stageType="STAGESUG":"资金申请报告"==s.model.reviewstage?s.stageType="STAGEREPORT":"设备清单（国产）"==s.model.reviewstage||"设备清单（进口）"==s.model.reviewstage?s.stageType="STAGEHOMELAND":"进口设备"==s.model.reviewstage?s.stageType="STAGEDEVICE":"项目概算"==s.model.reviewstage&&(s.stageType="STAGEBUDGET"),void 0!=e.reObj.registerFileDtoDtoList&&e.reObj.registerFileDtoDtoList.forEach(function(e,t){"3"==e.businessType?s.supply.push(e):"2"==e.businessType?s.drawingFile.push(e):s.otherFile.push(e)})})}(),s.checkOrgType=function(e){var t=e.target,i=t.checked,o=t.value;i&&(s.model.leaderName=signcommon.getDefaultLeader(o),$.each(s.busiObj.leaderList,function(e,t){t.mngOrgType==o&&(s.model.leaderId=t.id,s.model.leaderName=t.displayName,s.model.comprehensivehandlesug="请"+t.displayName+"同志阅示。")}),o==signcommon.getBusinessType().GX?s.model.leaderhandlesug="请（概算一部         概算二部）组织评审。":s.model.leaderhandlesug="请（评估一部         评估二部         评估一部信息化组）组织评审。",s.model.leaderId||n.alert("选择的默认办理部门没有合适的分管领导，请先设置分管领导角色用户！"))},s.startNewFlow=function(){common.initJqValidation($("#sign_fill_form")),$("#sign_fill_form").valid()?(s.isSubmit=!0,n.confirm({title:"询问提示",message:"确定发起流程么，请确保填写的信息已经保存正确！",onOk:function(){e.updateFillin(s.model,function(e){var t={method:"post",url:rootPath+"/sign/startNewFlow",params:{signid:s.model.signid}},a=function(e){s.isSubmit=!1,"ok"==e.data.reCode?n.success("操作成功！",function(){i.go("gtasks")}):n.error(e.data.reMsg)};common.http({$http:o,httpOptions:t,success:a})})}})):n.alert("操作失败，有红色*号的选项为必填项，请按要求填写！")},s.signPreview=function(e){var t=$(".well").parents("body"),i=t.find(".main-sidebar"),o=t.find(".main-header"),n=t.find(".content-wrapper");i.hide(),o.hide(),$(".toolbar").hide(),$(".well input").each(function(){var e=$(this).attr("type");"text"==e&&$(this).before('<span class="printmesge" data="text" style="white-space : nowrap;">'+$(this).val()+"</span>"),"checkbox"==e&&($(this).is(":checked")?$(this).before('<span class="printmesge" data="text">有</span>'):$(this).before('<span class="printmesge" data="text">无</span>'))}),$(".printmesge").show(),$(".well input[type=text]").hide(),$(".well input[type=checkbox]").hide(),$(".well button").hide(),n.find("td div select").hide(),n.find("td div span").css("margin","0"),$(".well").addClass("printbody"),$(".well .table-bordered").addClass("tableBOX"),n.find("input").addClass("noborder"),n.addClass("nomargin"),window.print(),i.show(),o.show(),$(".toolbar").show(),$(".printmesge").hide(),$(".well input[type=text]").show(),$(".well input[type=checkbox]").show(),$(".well button").show(),n.find("td div select").show(),n.find("td div span").css("margin-left","100px"),$(".well").removeClass("printbody"),$(".well .table-bordered").removeClass("tableBOX"),$("[data=text]").remove(),n.find("input").removeClass("noborder"),n.removeClass("nomargin")},s.updateFillin=function(){common.initJqValidation($("#sign_fill_form")),$("#sign_fill_form").valid()?(s.isSubmit=!0,s.model.leaderhandlesug=$("#leaderhandlesug").val(),e.updateFillin(s.model,function(e){s.isSubmit=!1,n.alert("操作成功！")})):n.alert("操作失败，有红色*号的选项为必填项，请按要求填写！")},s.findOfficeUsersByDeptName=function(t){var i={};"main"==t?i.maindeptName=s.model.maindeptName:i.assistdeptName=s.model.assistdeptName,e.findOfficeUsersByDeptName(i,function(e){"main"==t?(s.mainOfficeList={},s.mainOfficeList=e):(s.assistOfficeList={},s.assistOfficeList=e)})},s.addOtherFile=function(e,t){s.addRegisters||(s.addRegisters=[]),e?("4"==t&&(s.addRegisters=s.otherFile,s.showFilePage=!1,s.showFileOther=!1,s.showSignOther=!0),"2"==t&&(s.addRegisters=s.drawingFile,s.showFilePage=!0,s.showFileOther=!1,s.showSignOther=!1),s.businessId=e,s.businessType=t,$("#addOtherFile").kendoWindow({width:"840px",height:"480px",title:"补充资料编辑",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()):n.alert("请先保存数据！")},s.addRegisterFile=function(){s.addRegister={},s.addRegister.businessId=s.businessId,s.addRegister.businessType=s.businessType,s.addRegister.id=common.uuid(),s.addRegisters.push(s.addRegister)},s.saveRegisterFile=function(){r.saveRegisterFile(s.addRegisters,function(e){e.flag||"ok"==e.reCode?(n.alert("操作成功"),s.addRegisters=e.reObj):n.alert(e.reMsg)})},s.deleteRegisterFile=function(){var e=$("#addOtherFile input[name='addRegistersCheck']:checked");if(e.length<1)n.alert("请选择要删除的记录！");else{for(var t=[],i=0;i<e.length;i++)s.addRegisters.forEach(function(o,n){o.id&&e[i].value==o.id&&(t.push(e[i].value),s.addRegisters.splice(n,1))});t.length>0&&r.deleteByIds(t.join(","),function(e){n.alert("删除成功！")})}},s.editPrint=function(){var e=getLodop(),t=(rootPath,"<style>"+document.getElementById("xxxx").innerHTML+"</style>"),i=t+"<body>"+$("#sign_fill_xmjys_templ").html()+"</body>";e.PRINT_INIT(""),e.ADD_PRINT_HTM(10,20,"100%","100%",i),e.PREVIEW()}}angular.module("app").controller("signFillinCtrl",e),e.$inject=["signSvc","sysfileSvc","$state","$http","bsWin","$scope","addRegisterFileSvc"]}(),function(){"use strict";function e(e,t,i,o,n,a){var r=this;r.title="已办结项目详情",r.model={},r.flow={},r.model.signid=i.params.signid,r.flow.processInstanceId=i.params.processInstanceId,r.flow.hideFlowImg=!0,r.showFlag={tabWorkProgram:!1,tabBaseWP:!1,tabDispatch:!1,tabFilerecord:!1,tabExpert:!1,tabSysFile:!1,tabAssociateSigns:!1},r.businessFlag={expertReviews:[]},function(){$("#myTab li").click(function(e){var t=$("a",this);e.preventDefault(),t.tab("show");var i=t.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500),r.model.showDiv=i}),o.initFlowData(r),t.initFlowPageData(r.model.signid,function(e){r.model=e;var t=$("#myTab .active"),i=$("a",t);r.model.showDiv=i.attr("for-div"),r.model.dispatchDocDto&&(r.showFlag.tabDispatch=!0,r.dispatchDoc=r.model.dispatchDocDto),r.model.fileRecordDto&&(r.showFlag.tabFilerecord=!0,r.fileRecord=r.model.fileRecordDto),r.model.processState>1&&(r.showFlag.tabWorkProgram=!0),r.model.suppLetterDtoList&&(r.showSupperIndex=0),void 0!=r.model.registerFileDtoDtoList&&(r.supply=[],r.registerFile=[],r.drawingFile=[],r.otherFile=[],r.model.registerFileDtoDtoList.forEach(function(e,t){"3"==e.businessType?r.supply.push(e):"2"==e.businessType?r.drawingFile.push(e):"1"==e.businessType||"4"==e.businessType?r.registerFile.push(e):"5"!=e.businessType&&"6"!=e.businessType&&"7"!=e.businessType||r.otherFile.push(e)}))}),e.findByMianId(r.model.signid,function(t){t&&t.length>0&&(r.showFlag.tabSysFile=!0,r.sysFileList=t,e.initZtreeClient(r,n))})}(),r.commonDownloadSysFile=function(t){e.downloadFile(t)},r.commonEditSysFile=function(e){$("#editSysFileWindow").kendoWindow({width:"80%",title:"在线编辑",content:rootPath+"/file/editFile?sysFileId="+e})},r.printpage=function(e){a.templatePrint(e.target,r.model)}}angular.module("app").controller("signEndCtrl",e),e.$inject=["sysfileSvc","signSvc","$state","flowSvc","$scope","templatePrintSvc"]}(),function(){"use strict";function e(e,t,i){function o(t,i){var o={method:"post",url:rootPath+"/sign/startNewFlow",params:{signid:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function n(e){switch(e.flow.curNode.activitiId){case flowcommon.getSignFlowNode().SIGN_QS:e.showFlag.businessTr=!0,e.showFlag.nodeSign=!0;break;case flowcommon.getSignFlowNode().SIGN_ZHB:e.showFlag.buttBack=!0,e.showFlag.businessNext=!0,e.showFlag.nodeSelViceMgr=!0,e.flow.businessMap&&(e.viceDirectors=e.flow.businessMap.viceDirectors);break;case flowcommon.getSignFlowNode().SIGN_FGLD_FB:e.showFlag.buttBack=!0,e.showFlag.businessNext=!0,e.showFlag.nodeSelOrgs=!0,e.flow.businessMap&&(e.orgs=e.flow.businessMap.orgs);break;case flowcommon.getSignFlowNode().SIGN_BMFB1:e.businessFlag.isMainBranch=!0;case flowcommon.getSignFlowNode().SIGN_BMFB2:case flowcommon.getSignFlowNode().SIGN_BMFB3:case flowcommon.getSignFlowNode().SIGN_BMFB4:e.showFlag.businessNext=!0,e.showFlag.nodeSelPrincipal=!0,e.flow.businessMap&&e.flow.businessMap.users&&(e.users=e.flow.businessMap.users,e.users.forEach(function(e,t){e.isSelected=!1}));break;case flowcommon.getSignFlowNode().SIGN_XMFZR1:e.businessFlag.isMainBranch=!0,e.businessFlag.curBranchId="1";case flowcommon.getSignFlowNode().SIGN_XMFZR2:e.businessFlag.curBranchId||(e.businessFlag.curBranchId="2");case flowcommon.getSignFlowNode().SIGN_XMFZR3:e.businessFlag.curBranchId||(e.businessFlag.curBranchId="3");case flowcommon.getSignFlowNode().SIGN_XMFZR4:e.businessFlag.curBranchId||(e.businessFlag.curBranchId="4"),e.showFlag.businessTr=!0,e.showFlag.nodeWorkProgram=!0,e.businessFlag.isFinishWP=e.flow.businessMap.isFinishWP,e.model.processState>=2&&e.model.workProgramDtoList&&($.each(e.model.workProgramDtoList,function(t,i){i.branchId==e.businessFlag.curBranchId&&(e.businessFlag.editEPReviewId=i.expertReviewId)}),e.businessFlag.editExpertSC=!0,e.showFlag.tabWorkProgram=!0,$("#show_workprogram_a").click());break;case flowcommon.getSignFlowNode().SIGN_BMLD_SPW1:case flowcommon.getSignFlowNode().SIGN_BMLD_SPW2:case flowcommon.getSignFlowNode().SIGN_BMLD_SPW3:case flowcommon.getSignFlowNode().SIGN_BMLD_SPW4:case flowcommon.getSignFlowNode().SIGN_FGLD_SPW1:case flowcommon.getSignFlowNode().SIGN_FGLD_SPW2:case flowcommon.getSignFlowNode().SIGN_FGLD_SPW3:case flowcommon.getSignFlowNode().SIGN_FGLD_SPW4:e.showFlag.buttBack=!0,e.showFlag.tabWorkProgram=!0,$("#show_workprogram_a").click();break;case flowcommon.getSignFlowNode().SIGN_FW:e.showFlag.businessTr=!0,e.showFlag.nodeDispatch=!0,e.showFlag.isMainPrinUser=!0,e.showFlag.expertEdit=!0,e.flow.businessMap.prilUserList&&(e.businessFlag.principalUsers=e.flow.businessMap.prilUserList,e.showFlag.businessNext=!0),e.model.processState>=4&&(e.showFlag.tabDispatch=!0,$("#show_dispatch_a").click());break;case flowcommon.getSignFlowNode().SIGN_QRFW:case flowcommon.getSignFlowNode().SIGN_BMLD_QRFW_XB:case flowcommon.getSignFlowNode().SIGN_FGLD_QRFW_XB:e.watchPassDis(),e.showFlag.buttBack=!1,e.showFlag.businessTr=!0,e.showFlag.nodeConfirmDis=!0,e.businessFlag.passDis="9",e.showFlag.tabDispatch=!0,$("#show_dispatch_a").click();break;case flowcommon.getSignFlowNode().SIGN_BMLD_QRFW:case flowcommon.getSignFlowNode().SIGN_FGLD_QRFW:case flowcommon.getSignFlowNode().SIGN_ZR_QRFW:e.showFlag.buttBack=!0,e.showFlag.tabWorkProgram=!0,e.showFlag.tabDispatch=!0,$("#show_dispatch_a").click();break;case flowcommon.getSignFlowNode().SIGN_FWBH:e.showFlag.tabWorkProgram=!0,e.showFlag.tabDispatch=!0,$("#show_dispatch_a").click(),e.showFlag.businessTr=!0,e.showFlag.nodeCreateDisNum=!0,e.showFlag.isMainPrinUser=!0;break;case flowcommon.getSignFlowNode().SIGN_CWBL:e.showFlag.tabWorkProgram=!0,e.showFlag.tabDispatch=!0,e.showFlag.businessTr=!0,e.showFlag.financialCode=!0;break;case flowcommon.getSignFlowNode().SIGN_GD:e.showFlag.tabWorkProgram=!0,e.showFlag.tabDispatch=!0,e.showFlag.isMainPrinUser=!0,e.flow.businessMap.checkFileUser&&(e.showFlag.businessNext=!0),e.showFlag.businessTr=!0,e.showFlag.nodeFileRecord=!0,e.model.processState>6&&(e.showFlag.tabFilerecord=!0,$("#show_filerecord_a").click());break;case flowcommon.getSignFlowNode().SIGN_DSFZR_QRGD:e.showFlag.tabWorkProgram=!0,e.showFlag.tabDispatch=!0,e.showFlag.tabFilerecord=!0,$("#show_filerecord_a").click(),e.showFlag.buttBack=!0;break;case flowcommon.getSignFlowNode().SIGN_QRGD:e.showFlag.tabWorkProgram=!0,e.showFlag.tabDispatch=!0,e.showFlag.tabFilerecord=!0,$("#show_filerecord_a").click(),e.showFlag.buttBack=!0,e.showFlag.nodeNext=!1}}function a(e){e.flow.businessMap||(e.flow.businessMap={});var t={};switch(t.resultTag=!0,e.flow.curNode.activitiId){case flowcommon.getSignFlowNode().SIGN_ZHB:$("#viceDirector").val()?e.flow.businessMap.FGLD=$("#viceDirector").val():t.resultTag=!1;break;case flowcommon.getSignFlowNode().SIGN_FGLD_FB:if(t.resultTag=!1,$('.seleteTable input[selectType="main"]:checked').each(function(){e.flow.businessMap.MAIN_ORG=$(this).val(),t.resultTag=!0}),t.resultTag){var i=[];$('.seleteTable input[selectType="assist"]:checked').each(function(){i.push($(this).val())}),i.length>3?(t.resultTag=!1,t.resultMsg="协办部门最多只能选择3个！"):e.flow.businessMap.ASSIST_ORG=i.join(",")}else t.resultMsg="主办部门不为空！";break;case flowcommon.getSignFlowNode().SIGN_BMFB1:if(!e.model.isassistflow||9!=e.model.isassistflow&&"9"!=e.model.isassistflow){var o=$("#selPrincipalMainUser").val();if(!o){t.resultTag=!1,t.resultMsg="必须要选择一个第一负责人！";break}t.resultTag=!0,e.flow.businessMap.M_USER_ID=o;var n=[];$('#principalAssistUser input[selectType="assistUser"]:checked').each(function(){n.push($(this).val())}),n.length>0&&(e.flow.businessMap.A_USER_ID=n.join(","))}else e.businessFlag.principalUsers&&0!=e.businessFlag.principalUsers.length?(t.resultTag=!1,$.each(e.businessFlag.principalUsers,function(e,i){"9"!=i.isMainUser&&9!=i.isMainUser||(t.resultTag=!0)}),t.resultTag||(t.resultMsg="必须要选择一个第一负责人！")):(t.resultTag=!1,t.resultMsg="请先选择项目负责人！"),t.resultTag&&(e.flow.businessMap.PRINCIPAL=e.businessFlag.principalUsers);break;case flowcommon.getSignFlowNode().SIGN_BMFB2:case flowcommon.getSignFlowNode().SIGN_BMFB3:case flowcommon.getSignFlowNode().SIGN_BMFB4:if(!e.model.isassistflow||9!=e.model.isassistflow&&"9"!=e.model.isassistflow){var n=[];$('#principalAssistUser input[selectType="assistUser"]:checked').each(function(){n.push($(this).val())}),n.length>0?e.flow.businessMap.A_USER_ID=n.join(","):(t.resultTag=!1,t.resultMsg="必须要选择负责人！")}else e.businessFlag.principalUsers&&0!=e.businessFlag.principalUsers.length||(t.resultTag=!1,t.resultMsg="请先选择项目负责人！"),t.resultTag&&(e.flow.businessMap.PRINCIPAL=e.businessFlag.principalUsers);break;case flowcommon.getSignFlowNode().SIGN_XMFZR1:case flowcommon.getSignFlowNode().SIGN_XMFZR2:case flowcommon.getSignFlowNode().SIGN_XMFZR3:case flowcommon.getSignFlowNode().SIGN_XMFZR4:9==e.businessFlag.isNeedWP&&0==e.businessFlag.isFinishWP&&(t.resultTag=!1,t.resultMsg="您还没有完成工作方案，不能进行下一步操作！"),e.flow.businessMap.IS_NEED_WP=e.businessFlag.isNeedWP;break;case flowcommon.getSignFlowNode().SIGN_BMLD_SPW1:case flowcommon.getSignFlowNode().SIGN_BMLD_SPW2:case flowcommon.getSignFlowNode().SIGN_BMLD_SPW3:case flowcommon.getSignFlowNode().SIGN_BMLD_SPW4:break;case flowcommon.getSignFlowNode().SIGN_FGLD_SPW1:case flowcommon.getSignFlowNode().SIGN_FGLD_SPW2:case flowcommon.getSignFlowNode().SIGN_FGLD_SPW3:case flowcommon.getSignFlowNode().SIGN_FGLD_SPW4:break;case flowcommon.getSignFlowNode().SIGN_FW:e.model.processState<4&&(t.resultTag=!1,t.resultMsg="您还没完成发文操作，不能进行下一步操作！"),e.flow.businessMap.DIS_ID=e.dispatchDoc.id;break;case flowcommon.getSignFlowNode().SIGN_QRFW:case flowcommon.getSignFlowNode().SIGN_BMLD_QRFW_XB:case flowcommon.getSignFlowNode().SIGN_FGLD_QRFW_XB:"9"==e.businessFlag.passDis||9==e.businessFlag.passDis?e.flow.businessMap.AGREE="9":e.flow.businessMap.AGREE="0",e.flow.businessMap.DIS_ID=e.dispatchDoc.id;break;case flowcommon.getSignFlowNode().SIGN_BMLD_QRFW_XB:case flowcommon.getSignFlowNode().SIGN_BMLD_QRFW:case flowcommon.getSignFlowNode().SIGN_FGLD_QRFW_XB:case flowcommon.getSignFlowNode().SIGN_FGLD_QRFW:case flowcommon.getSignFlowNode().SIGN_ZR_QRFW:case flowcommon.getSignFlowNode().SIGN_FWBH:e.flow.businessMap.DIS_ID=e.dispatchDoc.id;break;case flowcommon.getSignFlowNode().SIGN_CWBL:break;case flowcommon.getSignFlowNode().SIGN_GD:e.model.processState<7&&(t.resultTag=!1,t.resultMsg="您还没完成归档操作，不能进行下一步操作！");break;case flowcommon.getSignFlowNode().SIGN_DSFZR_QRGD:case flowcommon.getSignFlowNode().SIGN_QRGD:e.flow.businessMap.GD_ID=e.fileRecord.fileRecordId}return t}function r(t){var i={method:"get",url:rootPath+"/dispatch/html/initDispatchBySignId",params:{signId:t.model.signid}},o=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.dispatchDoc=e.data,$("#show_dispatch_a").click()}})};common.http({vm:t,$http:e,httpOptions:i,success:o})}function s(t){var i={method:"get",url:rootPath+"/fileRecord/html/initBySignId",params:{signId:t.model.signid}},o=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.fileRecord=e.data,$("#show_filerecord_a").click()}})};common.http({vm:t,$http:e,httpOptions:i,success:o})}function l(t){var i={method:"get",url:rootPath+"/sign/html/initDetailPageData",params:{signid:t.model.signid,queryAll:!0}},o=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.model=e.data,t.model.workProgramDtoList&&t.model.workProgramDtoList.length>0&&(t.show_workprogram=!0,t.model.workProgramDtoList.forEach(function(e,i){9==e.isMain?(t.showMainwork=!0,t.mainwork={},t.mainwork=e):0==e.isMain&&(t.showAssistwork=!0,t.assistwork={},t.assistwork=e)})),t.model.dispatchDocDto&&(t.show_dispatch=!0,t.dispatchDoc=t.model.dispatchDocDto),t.model.fileRecordDto&&(t.show_filerecord=!0,t.fileRecord=t.model.fileRecordDto)}})};common.http({vm:t,$http:e,httpOptions:i,success:o})}return{startFlow:o,initBusinessParams:n,checkBusinessFill:a,getChargeDispatch:r,getChargeFilerecord:s,endSignDetail:l}}angular.module("app").factory("signFlowSvc",e),e.$inject=["$http","$state","bsWin"]}(),function(){"use strict";function e(e,t,i,o,n,a,r,s,l,c,d,u,m,p,f,h){function g(e){e=void 0==e?0:e;var t=0;return e>800&&e<=4e3?t=.2*(e-800):e>4e3&&e<=2e4?t=.8*e*.2:e>2e4&&e<=5e4?t=.8*e*.3-2e3:e>5e4&&(t=.8*e*.3-2755),t}var v=this;v.title="项目流程处理",v.model={},v.flow={},v.mainwork={},v.assistwork={},v.dispatchDoc={},v.fileRecord={},v.expertReview={},v.queryParams={},v.work={},v.isDisplay=!0,v.expertList=new Array(15),v.showFlag={businessTr:!1,businessDis:!1,businessNext:!1,nodeNext:!0,nodeSelViceMgr:!1,nodeSelOrgs:!1,nodeSelPrincipal:!1,isMainBranch:!1,nodeSign:!1,nodeWorkProgram:!1,nodeDispatch:!1,nodeConfirmDis:!1,nodeCreateDisNum:!1,nodeFileRecord:!1,nodeXSWorkProgram:!1,tabWorkProgram:!1,tabBaseWP:!1,tabDispatch:!1,tabFilerecord:!1,tabExpert:!1,tabSysFile:!1,buttBack:!1,expertRemark:!1,expertpayment:!1,expertEdit:!1,isMainPrinUser:!1},v.businessFlag={isLoadSign:!1,isLoadFlow:!1,isGotoDis:!1,isMakeDisNum:!1,principalUsers:[],isSelMainPriUser:!1,editExpertSC:!1,expertScore:{},isNeedWP:9,isMainBranch:!1,isFinishWP:!1,passDis:!1,curBranchId:"",editEPReviewId:""},v.model.signid=o.params.signid,v.work.id=o.params.id,v.flow.taskId=o.params.taskId,v.flow.processInstanceId=o.params.processInstanceId,v.signId=v.model.signid,v.expertList=new Array(10),function(){$("#myTab li").click(function(e){var t=$("a",this);e.preventDefault(),t.tab("show");var i=t.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500),v.model.showDiv=i}),v.sysFile={businessId:o.params.signid,mainId:o.params.signid,mainType:e.mainTypeValue().SIGN,sysfileType:e.mainTypeValue().FILLSIGN},e.initUploadOptions({inputId:"sysfileinput",vm:v,uploadSuccess:function(){e.findByMianId(v.model.signid,function(t){t&&t.length>0&&(v.showFlag.tabSysFile=!0,v.sysFileList=t,e.initZtreeClient(v,c))})}}),t.initFlowPageData(v.model.signid,function(e){v.model=e;var t=$("#myTab .active"),i=$("a",t);if(v.model.showDiv=i.attr("for-div"),3!=v.model.processState&&4!=v.model.processState||(v.showMeterial=!0),v.model.dispatchDocDto&&(v.showFlag.tabDispatch=!0,v.dispatchDoc=v.model.dispatchDocDto,2==v.dispatchDoc.dispatchWay&&0==v.dispatchDoc.isMainProject||v.dispatchDoc.fileNum?v.businessFlag.isCreateDisFileNum=!0:v.showFlag.buttDisFileNum=!0),v.model.fileRecordDto&&(v.showFlag.tabFilerecord=!0,v.fileRecord=v.model.fileRecordDto),v.model.workProgramDtoList&&v.model.workProgramDtoList.length>0){var o;""!=(o="1"==v.model.workProgramDtoList[0].branchId||"1"==v.model.workProgramDtoList[0].branchId?v.model.workProgramDtoList[0].reviewOrgName:v.model.workProgramDtoList[0].mainWorkProgramDto.reviewOrgName)&&o.split(",").length>1&&(v.showTotalInvestment=!0);for(var n=0;n<v.model.workProgramDtoList.length;n++){var r=v.model.workProgramDtoList;if(r[n].expertDtoList)for(var s=r[n].expertDtoList,l=0;l<s.length;l++)if(s[l].expertTypeDtoList){for(var c=s[l].expertTypeDtoList,d="",u="",m=0;m<c.length;m++)u.indexOf(c[m].expertType)<0&&(m>0&&(u+="、"),u+=c[m].expertType),m>0&&(d+="、"),d+=c[m].maJorBig+"、"+c[m].maJorSmall;s[l].expertCategory=u,s[l].major=d}}}v.businessFlag.isLoadSign=!0,v.businessFlag.isLoadSign&&v.businessFlag.isLoadFlow&&a.initBusinessParams(v),v.model.suppLetterDtoList&&(v.showSupperIndex=0),void 0!=v.model.registerFileDtoDtoList&&(v.supply=[],v.registerFile=[],v.drawingFile=[],v.otherFile=[],v.model.registerFileDtoDtoList.forEach(function(e,t){3==e.businessType?v.supply.push(e):2==e.businessType?v.drawingFile.push(e):1==e.businessType||4==e.businessType?v.registerFile.push(e):5!=e.businessType&&6!=e.businessType&&7!=e.businessType||v.otherFile.push(e)}))}),n.getFlowInfo(v.flow.taskId,v.flow.processInstanceId,function(e){v.flow=e,v.flow.taskId?(v.flow.end&&(v.showFlag.nodeNext=!1),v.businessFlag.isLoadFlow=!0,v.businessFlag.isLoadSign&&v.businessFlag.isLoadFlow&&a.initBusinessParams(v)):d.alert("该任务已处理！",function(){o.go("gtasks")})}),n.initFlowData(v),e.findByMianId(v.model.signid,function(t){t&&t.length>0&&(v.showFlag.tabSysFile=!0,v.sysFileList=t,e.initZtreeClient(v,c))}),v.delFile=function(t){e.delSysFile(t,function(){d.alert("删除成功",function(){e.findByMianId(v.model.signid,function(t){t&&t.length>0&&(v.showFlag.tabSysFile=!0,v.sysFileList=t,e.initZtreeClient(v,c))})})})},r.initIdea(v)}(),v.ideaEdit=function(e){angular.isObject(e)||(e={}),r.initIdeaData(v,e)},v.selectedIdea=function(){v.flow.dealOption=v.chooseIdea},v.editSelectExpert=function(e){v.scoreExpert={},
$.each(v.model.expertReviewDto.expertSelectedDtoList,function(t,i){if(i.id==e)return void(v.scoreExpert=angular.copy(i))}),$("#star_"+v.scoreExpert.id).raty({number:5,score:function(){return $(this).attr("data-num",angular.isUndefined(v.scoreExpert.score)?0:v.scoreExpert.score),$(this).attr("data-num")},starOn:"../contents/libs/raty/lib/images/star-on.png",starOff:"../contents/libs/raty/lib/images/star-off.png",starHalf:"../contents/libs/raty/lib/images/star-half.png",readOnly:!1,halfShow:!0,hints:["不合格","合格","中等","良好","优秀"],size:34,click:function(e,t){v.scoreExpert.score=e}}),$("#score_win").kendoWindow({width:"820px",height:"365px",title:"编辑-专家星级",visible:!1,modal:!0,closable:!0,actions:["Close"]}).data("kendoWindow").center().open()},v.closeEditMark=function(){window.parent.$("#score_win").data("kendoWindow").close()},v.saveMark=function(){v.scoreExpert.score&&0!=v.scoreExpert.score?l.saveMark(v.scoreExpert,function(e){e.flag||"ok"==e.reCode?(angular.forEach(v.model.expertReviewDto.expertSelectedDtoList,function(e,t){e.id==v.scoreExpert.id&&(e.score=v.scoreExpert.score,e.describes=v.scoreExpert.describes)}),d.success("保存成功！",function(){v.closeEditMark()})):d.alert(e.reMsg)}):d.alert("请对专家进行评分！")},v.countTaxes=function(e){if(void 0!=e){if(void 0==e.reviewDate)return void d.alert("(函评/评审会)日期为空，无法进行专家纳税计算，请联系系统管理员处理！");if(!/^(\d{4}-\d{1,2}-\d{1,2})$/.exec(e.reviewDate))return void d.alert("请输入正确的日期格式");if(void 0==e.expertSelectedDtoList||0==e.expertSelectedDtoList.length)return void d.alert("该方案还没评审专家");e.payDate||(e.payDate=(new Date).Format("yyyy-MM-dd")),common.initJqValidation($("#payform"));if($("#payform").valid()){var t="";$.each(e.expertSelectedDtoList,function(e,i){"9"!=i.isConfrim&&9!=i.isConfrim||"9"!=i.isJoin&&9!=i.isJoin||(t+=i.id+",")}),l.countTaxes(e.id,t,e.reviewDate,function(t){var i=t;e.reviewCost=0,e.reviewTaxes=0,e.totalCost=0,console.log(i),$.each(e.expertSelectedDtoList,function(t,o){if(!("9"!=o.isConfrim&&9!=o.isConfrim||"9"!=o.isJoin&&9!=o.isJoin)){var n=o.EXPERTID,a=0;void 0!=i&&i.length>0&&$.each(i,function(e,t){n==t.expertId&&(t.excost=void 0==t.excost?0:t.excost,a=parseFloat(a)+parseFloat(t.excost))}),o.reviewCost=void 0==o.reviewCost?0:o.reviewCost;var r=a+parseFloat(o.reviewCost);o.reviewTaxes=g(r).toFixed(2),o.totalCost=(parseFloat(o.reviewCost)+parseFloat(o.reviewTaxes)).toFixed(2),e.reviewCost=(parseFloat(e.reviewCost)+parseFloat(o.reviewCost)).toFixed(2),e.reviewTaxes=(parseFloat(e.reviewTaxes)+parseFloat(o.reviewTaxes)).toFixed(2),e.totalCost=(parseFloat(e.reviewCost)+parseFloat(e.reviewTaxes)).toFixed(2)}}),l.savePayment(e,v.isCommit,function(e){e.flag||"ok"==e.reCode?d.alert("操作成功！",function(){v.isCommit=!1}):d.alert(e.reMsg)})})}else d.alert("请正确填写专家评审费信息！")}},v.closeEditPay=function(){window.parent.$("#payment").data("kendoWindow").close()},v.editUnitScore=function(e){$("#star").raty({number:5,score:function(){return $(this).attr("data-num",angular.isUndefined(v.model.unitScoreDto.score)?0:v.model.unitScoreDto.score),$(this).attr("data-num")},starOn:"../contents/libs/raty/lib/images/star-on.png",starOff:"../contents/libs/raty/lib/images/star-off.png",starHalf:"../contents/libs/raty/lib/images/star-half.png",readOnly:!1,halfShow:!0,hints:["不合格","合格","中等","良好","优秀"],size:34,click:function(e,t){v.model.unitScoreDto.score=e}}),$("#unitscore_win").kendoWindow({width:"820px",height:"365px",title:"编辑-单位星级",visible:!1,modal:!0,closable:!0,actions:["Close"]}).data("kendoWindow").center().open()},v.saveUnit=function(){v.model.unitScoreDto.score&&0!=v.model.unitScoreDto.score?h.saveUnit(v.model.unitScoreDto,function(e){e.flag||"ok"==e.reCode?d.success("保存成功！",function(){v.closeEditUnit()}):d.alert(e.reMsg)}):d.alert("请对单位进行评分！")},v.closeEditUnit=function(){window.parent.$("#unitscore_win").data("kendoWindow").close()},v.commitNextStep=function(){if(v.flow.isSuspended)return void d.error("该流程目前为暂停状态，不能进行流转操作！");var e=a.checkBusinessFill(v);e.resultTag?n.commit(v.isCommit,v.flow,function(e){e.flag||"ok"==e.reCode?d.success("操作成功！",function(){o.go("gtasks")}):d.alert(e.reMsg)}):d.alert(e.resultMsg)},v.commitBack=function(){common.initJqValidation($("#flow_form")),$("#flow_form").valid()&&d.confirm({title:"询问提示",message:"确认回退吗？",onOk:function(){n.rollBackToLast(v.flow,v.isCommit,function(e){e.flag||"ok"==e.reCode?(v.isCommit=!1,d.alert("回退成功！",function(){o.go("gtasks")})):d.alert(e.reMsg)})}})},v.deleteFlow=function(){d.confirm({title:"询问提示",message:"终止流程将无法恢复，确认删除么？？",onOk:function(){$(".confirmDialog").modal("hide"),n.deleteFlow(v)}})},v.editSign=function(){o.go("fillSign",{signid:v.model.signid})},v.addWorkProgram=function(){o.go("workprogramEdit",{signid:v.model.signid})},v.addSuppLetter=function(){o.go("addSupp",{businessId:v.model.signid,businessType:"SIGN"})},v.addSuppLetterList=function(){o.go("addSuppletterList",{businessId:v.model.signid})},v.addRegisterFile=function(){o.go("registerFile",{businessId:v.model.signid})},v.addBaseWP=function(){o.go("workprogramBaseEdit",{signid:v.model.signid})},v.addDisPatch=function(){v.model.isAssociate&&0!=v.model.isAssociate||signcommon.getReviewStage().STAGE_STUDY!=v.model.reviewstage&&signcommon.getReviewStage().STAGE_BUDGET!=v.model.reviewstage?o.go("dispatchEdit",{signid:v.model.signid}):d.confirm({title:"询问提示",message:"该项目还没进行项目关联，是否需要进行关联设置？",onOk:function(){v.ss?v.page.selPage(1):(v.page=lgx.page.init({id:"demo5",get:function(e){v.price||(v.price={signid:v.model.signid,projectname:v.model.projectname}),v.price.reviewstage=v.model.reviewstage;var i;i=0!=e.skip?e.skip+1:e.skip,v.price.skip=i,v.price.size=e.size+e.skip,t.getAssociateSignGrid(v,function(e){v.associateSignList=[],e&&(v.associateSignList=e.value,v.page.callback(e.count))})}}),v.ss=!0),$("#associateWindow").kendoWindow({width:"75%",height:"650px",title:"项目关联",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()},onCancel:function(){o.go("dispatchEdit",{signid:v.model.signid})}})},v.associateQuerySign=function(){t.getAssociateSign(v.searchAssociateSign,function(e){v.associateSignList=[],e&&(v.associateSignList=e)})},v.saveAssociateSign=function(e){if(v.model.signid==e)return void d.alert("不能关联自身项目");t.saveAssociateSign(v.model.signid,e,function(){e&&(v.model.isAssociate=1),d.alert(void 0!=e?"项目关联成功":"项目解除关联成功"),window.parent.$("#associateWindow").data("kendoWindow").close()})},v.addFinancialApply=function(e){"9"==v.model.isassistflow||9==v.model.isassistflow?v.costType="ASSIST":v.costType="REVIEW",p.initAddCost(v,v.costType,v.model,e)},v.addDoFile=function(){o.go("fileRecordEdit",{signid:v.model.signid})},v.addRegisterFileRecord=function(){v.fileRecord.fileRecordId?o.go("registerFile",{signid:v.fileRecord.fileRecordId}):d.alert("请保存归档再操作！")},v.mainOrg=function(e){var t=e.target,i=t.checked,o=t.value;i?$('.seleteTable input[selectType="main"]').each(function(){var e=$(this).attr("value");e!=o?($(this).removeAttr("checked"),$("#assist_"+e).removeAttr("disabled")):($("#assist_"+o).removeAttr("checked"),$("#assist_"+o).attr("disabled","disabled"))}):$("#assist_"+o).removeAttr("disabled"),v.initOption(e)};var y=[];v.initOption=function(e){var t=e.target,i=$(t),o=i.attr("selectType"),n=t.checked;if(n&&"main"==o?(y.splice(0,1),y.splice(0,0,i.attr("tit"))):n||"main"!=o||(y[0]=""),n&&"assist"==o)y.push(i.attr("tit"));else if(!n&&"assist"==o){var a=i.attr("tit");angular.forEach(y,function(e,t){e==a&&y.splice(t,1)})}if(y.length>0){for(var r=0;r<y.length;r++)y[0]==y[r]&&0!=r&&y.splice(r,1);v.flow.dealOption="请（"+y.join("，")+"）组织评审"}},v.checkPrincipal=function(){var e=$("#selPrincipalMainUser").val();e&&$('#principalAssistUser input[selectType="assistUser"]').each(function(){$(this).attr("value")==e?($(this).removeAttr("checked"),$(this).attr("disabled","disabled")):$(this).removeAttr("disabled")}),v.initUserOption()};var w=[];v.initUserOption=function(e){var t=$("#selPrincipalMainUser").val(),i=!1,o="请（";t?$.each(v.users,function(e,n){n.id==t&&(o+=n.displayName,v.selUserName=n.displayName,i=!0)}):v.selUserName=e,$("input[name='"+e+"']").is(":checked")?w.push(e):angular.forEach(w,function(e,t){e==v.selUserName&&w.splice(t,1)}),w.length>0&&(i&&(o+=", "),o+=w.join(", ")),o+=" )组织办理。",v.flow.dealOption=o},v.checkBoxSingle=function(e,t){var i=e.target,o=i.checked,n=i.value;o?$('.seleteTable input[selectType="'+t+'"]').each(function(){var e=$(this).attr("id"),i=$(this).attr("value");e!=t+"_"+n?($("#"+disabletype+"_"+i).removeAttr("disabled"),$(this).removeAttr("checked")):$("#"+disabletype+"_"+n).attr("disabled","disabled")}):$("#"+disabletype+"_"+n).removeAttr("disabled")},v.checkBoxSingle=function(e,t){var i=e.target,o=i.checked,n=i.value;o&&$('#xs_table input[selectType="'+t+'"]').each(function(){$(this).attr("id");$(this).attr("value")!=n&&$(this).removeAttr("checked")})},v.addPriUser=function(){var e=$("#xs_bmfb input[name='unSelPriUser']:checked");if(e.length<1)d.alert("请选择负责人");else{if(v.businessFlag.isMainBranch){if(9==v.isMainPriUser&&e.length>1)return void d.alert("总负责人只能选一个");if(0==v.businessFlag.isSelMainPriUser&&(angular.isUndefined(v.isMainPriUser)||0==v.isMainPriUser))return void d.alert("请先选择总负责人");if(1==v.businessFlag.isSelMainPriUser&&9==v.isMainPriUser)return void d.alert("你已经选择了一个总负责人！")}for(var t=0;t<e.length;t++){var i={};i.userId=e[t].value,i.userType=$("#userType").val(),9==v.isMainPriUser?(v.businessFlag.isSelMainPriUser=!0,i.isMainUser=9,v.isMainPriUser=0):i.isMainUser=0,v.users.forEach(function(o,n){o.id==e[t].value&&(o.isSelected=!0,i.userId=o.id,i.userName=o.displayName)}),v.businessFlag.principalUsers.push(i),v.businessFlag.principalUsers.sort(b("isMainUser")),v.initDealUserName(v.businessFlag.principalUsers)}}};var b=function(e){return function(t,i){var o,n;if("object"==typeof t&&"object"==typeof i&&t&&i)return o=t[e],n=i[e],console.log(o,n),o===n?0:typeof o==typeof n?o>n?-1:1:typeof o>typeof n?-1:1;throw"error"}};v.delPriUser=function(){var e=$("#xs_bmfb input[name='selPriUser']:checked");if(e.length<1)d.alert("请选择取消的负责人");else{for(var t=0;t<e.length;t++)v.users.forEach(function(i,o){i.id==e[t].value&&(i.isSelected=!1)}),v.businessFlag.principalUsers.forEach(function(i,o){i.userId==e[t].value&&(9==i.isMainUser&&(v.businessFlag.isSelMainPriUser=!1),v.businessFlag.principalUsers.splice(o,1))});v.initDealUserName(v.businessFlag.principalUsers)}},v.initDealUserName=function(e){if(e&&e.length>0){var t="请（";angular.forEach(e,function(e,i){i>0&&(t+=","),t+=e.userName}),t+=" )组织办理。",v.flow.dealOption=t}else v.flow.dealOption=""},v.checkNeedWP=function(e){var i=e.target,o=i.checked;o?v.businessFlag.isNeedWP=9:v.businessFlag.isFinishWP?d.confirm({title:"询问提示",message:"不做工作方案系统将会删除工作方案数据，确认不做工作方案么？",onOk:function(){$(".confirmDialog").modal("hide"),v.businessFlag.isNeedWP=0,t.removeWP(v)},onClose:function(){i.checked=!o,v.businessFlag.isNeedWP=9}}):v.businessFlag.isNeedWP=0},v.meetingDoc=function(){d.confirm({title:"",message:"如果之前已经生成会前准备材料，则本次生成的文档会覆盖之前产生的文档，确定执行操作么？",onOk:function(){t.meetingDoc(v,function(t){t.flag||"ok"==t.reCode?(d.success("操作成功"),e.findByMianId(v.model.signid,function(t){(t||t.length>0)&&(v.showFlag.tabSysFile=!0,v.sysFileList=t,e.initZtreeClient(v,c))})):d.alert(t.reMsg)})}})},v.commonDownloadSysFile=function(t){e.downloadFile(t)},v.createDispatchFileNum=function(){t.createDispatchFileNum(v.model.signid,v.dispatchDoc.id,function(e){(e.flag||"ok"==e.reCode)&&(v.dispatchDoc.fileNum=e.reObj),d.alert(e.reMsg)})},v.dispatchTemplate=function(){t.createDispatchTemplate(v)},v.watchPassDis=function(){c.$watch("vm.businessFlag.passDis",function(e,t){v.flow.dealOption=9==e?"通过":"不通过"})},v.affirmJoinExpert=function(){v.model.expertReviewDto&&v.model.expertReviewDto.expertSelectedDtoList?(v.confirmEPList=v.model.expertReviewDto.expertSelectedDtoList,$("#confirmJoinExpert").kendoWindow({width:"75%",height:"600px",title:"参加评审会专家确认",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()):d.alert("该项目没有评审专家！")},v.updateToJoin=function(){var e=$("#notJoinExpertTable input[name='notJoinExpert']:checked");if(e.length<1)d.alert("请选择要改为参加会议的专家");else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);l.updateJoinState("","",t.join(","),"9",v.isCommit,function(e){v.reFleshJoinState(t,"9"),d.success("操作成功！")})}},v.updateToNotJoin=function(){var e=$("#joinExpertTable input[name='joinExpert']:checked");if(e.length<1)d.alert("请选择未参加会议的专家");else{for(var t=[],i=0;i<e.length;i++)t.push(e[i].value);l.updateJoinState("","",t.join(","),"0",v.isCommit,function(e){v.reFleshJoinState(t,"0"),d.success("操作成功！")})}},v.reFleshJoinState=function(e,t){$.each(e,function(e,i){$.each(v.confirmEPList,function(e,o){i==o.id&&(o.isJoin=t)})}),$.each(v.model.workProgramDtoList,function(e,t){l.refleshBusinessEP(t.id,function(e){t.expertDtoList=e})})},v.printpage=function(e){var i=$(e.target).attr("id");t.workProgramPrint(i)},v.reviewReportDoc=function(){d.confirm({title:"",message:"如果之前已经生成评审报告，则本次操作会覆盖之前生成的文档，确定执行操作么？",onOk:function(){t.createDispatchTemplate(v,function(t){t.flag||"ok"==t.reCode?d.success("操作成功！",function(){e.findByMianId(v.model.signid,function(t){(t||t.length>0)&&(v.showFlag.tabSysFile=!0,v.sysFileList=t,e.initZtreeClient(v,c))})}):d.alert(t.reMsg)})}})},v.templatePage=function(e){f.templatePage(e)}}angular.module("app").controller("signFlowDealCtrl",e),e.$inject=["sysfileSvc","signSvc","workprogramSvc","$state","flowSvc","signFlowSvc","ideaSvc","addRegisterFileSvc","expertReviewSvc","$scope","bsWin","financialManagerSvc","assistCostCountSvc","addCostSvc","templatePrintSvc","companySvc"]}(),function(){"use strict";function e(e,t,i,o,n,a,r){var s=this;s.title="项目流程信息",s.model={},s.flow={},s.work={},s.dispatchDoc={},s.fileRecord={},s.model.signid=i.params.signid,s.flow.taskId=i.params.taskId,s.flow.processInstanceId=i.params.processInstanceId,s.showFlag={tabWorkProgram:!1,tabBaseWP:!1,tabDispatch:!1,tabFilerecord:!1,tabExpert:!1,tabSysFile:!1,tabAssociateSigns:!1},s.businessFlag={expertReviews:[]},s.expertList=new Array(10),function(){$("#myTab li").click(function(e){var t=$("a",this);e.preventDefault(),t.tab("show");var i=t.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500),s.model.showDiv=i}),o.initFlowData(s),t.initFlowPageData(s.model.signid,function(e){s.model=e;var t=$("#myTab .active"),i=$("a",t);if(s.model.showDiv=i.attr("for-div"),s.model.dispatchDocDto&&(s.showFlag.tabDispatch=!0,s.dispatchDoc=s.model.dispatchDocDto,2==s.dispatchDoc.dispatchWay&&0==s.dispatchDoc.isMainProject||s.dispatchDoc.fileNum?s.businessFlag.isCreateDisFileNum=!0:s.showFlag.buttDisFileNum=!0),s.model.fileRecordDto&&(s.showFlag.tabFilerecord=!0,s.fileRecord=s.model.fileRecordDto),s.model.workProgramDtoList&&s.model.workProgramDtoList.length>0){var o;""!=(o="1"==s.model.workProgramDtoList[0].branchId||"1"==s.model.workProgramDtoList[0].branchId?s.model.workProgramDtoList[0].reviewOrgName:s.model.workProgramDtoList[0].mainWorkProgramDto.reviewOrgName)&&o.split(",").length>1&&(s.showTotalInvestment=!0)}s.model.processState>1&&(s.showFlag.tabWorkProgram=!0),s.model.suppLetterDtoList&&(s.showSupperIndex=0),void 0!=s.model.registerFileDtoDtoList&&(s.supply=[],s.registerFile=[],s.drawingFile=[],s.otherFile=[],s.model.registerFileDtoDtoList.forEach(function(e,t){"3"==e.businessType?s.supply.push(e):"2"==e.businessType?s.drawingFile.push(e):"1"==e.businessType||"4"==e.businessType?s.registerFile.push(e):"5"!=e.businessType&&"6"!=e.businessType&&"7"!=e.businessType||s.otherFile.push(e)}))}),e.findByMianId(s.model.signid,function(t){t&&t.length>0&&(s.showFlag.tabSysFile=!0,s.sysFileList=t,e.initZtreeClient(s,a))})}(),s.commonDownloadSysFile=function(t){e.downloadFile(t)},s.templatePage=function(e){r.templatePage(e)}}angular.module("app").controller("signFlowDetailCtrl",e),e.$inject=["sysfileSvc","signSvc","$state","flowSvc","signFlowSvc","$scope","templatePrintSvc"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.model={},n.title="新增预签收收文",n.reserveAdd=function(){common.initJqValidation($("#reserveform")),$("#reserveform").valid()?t.reserveAdd(n.model,function(e){e.flag||"ok"==e.reCode?o.success("操作成功，请继续填写项目审核登记表",function(){i.go("fillSign",{signid:e.reObj.signid},{reload:!0})}):o.error(e.reMsg)}):o.alert("操作失败，有红色*号的选项为必填项，请按要求填写！")}}angular.module("app").controller("signReserveAddCtrl",e),e.$inject=["$location","reserveSignSvc","$state","bsWin"]}(),function(){"use strict";function e(e,t,i,o,n,a,r){var s=this;s.model={},s.title="预签收列表",s.stateName=i.current.name,s.queryParams={},s.saveView=function(){o.storeView(s.stateName,{gridParams:s.gridOptions.dataSource.transport.options.read.data(),queryParams:s.queryParams,data:s})},s.querySign=function(){s.gridOptions.dataSource._skip=0,s.gridOptions.dataSource.read()},s.del=function(e){a.confirm({title:"询问提示",message:"确认删除该条项目数据吗？",onOk:function(){n.deleteSign(e,function(e){e.flag||"ok"==e.reCode?a.alert("删除成功！",function(){s.gridOptions.dataSource.read()}):a.alert(e.reMsg)})}})},s.realSign=function(e){a.confirm({title:"询问提示",message:"确认正式签收了么？",onOk:function(){n.realSign(e,function(e){e.flag||"ok"==e.reCode?a.success("操作成功！",function(){s.gridOptions.dataSource.read()}):a.error(e.reMsg)})}})},s.startNewFlow=function(e){a.confirm({title:"询问提示",message:"确认已经完成填写，并且发起流程么？",onOk:function(){$(".confirmDialog").modal("hide"),r.startFlow(e,function(e){e.flag||"ok"==e.reCode?a.success("操作成功！",function(){s.gridOptions.dataSource.read()}):a.error(e.reMsg)})}})},s.getPreSignInfo=function(){if(""==s.model.filecode||null==s.model.filecode)return void a.alert("收文编号不能为空!");t.getPreSignInfo(s.model.filecode,"1",function(e){if(e.flag||"ok"==e.reCode){if("保存成功！"!=e.reMsg)return void a.alert(e.reMsg);s.gridOptions.dataSource.read()}else a.alert(e.reMsg)})},function(){if(o.view[s.stateName]){var e=o.view[s.stateName];e.gridParams&&(s.gridParams=e.gridParams),e.data&&(s.model=e.data.model),e.queryParams&&(s.queryParams=e.queryParams),t.grid(s),o.view[s.stateName]=void 0}else t.grid(s)}()}angular.module("app").controller("signReserveCtrl",e),e.$inject=["$location","reserveSignSvc","$state","$rootScope","signSvc","bsWin","signFlowSvc"]}(),function(){"use strict";function e(e,t){function i(t,i){var o={method:"post",url:rootPath+"/sign/html/reserveAddPost",data:t},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function o(t,i,o){var n={method:"get",url:rootPath+"/intfc/getPreSign",params:{fileCode:t,signType:i}},a=function(e){void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a})}function n(t,i){t.isSubmit=!0;var o={method:"delete",url:s+"/deleteReserve",params:{signid:i}},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})};common.http({vm:t,$http:e,httpOptions:o,success:n})}function a(t){var i={method:"get",url:s+"/html/findByIdsign",params:{id:t.id}},o=function(e){t.model=e.data};common.http({vm:t,$http:e,httpOptions:i,success:o})}function r(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(s+"/reserveListSign",$("#reserveFrom"),e.gridParams),schema:{data:"value",total:function(e){return e.count?$("#GET_RESERVESIGN_COUNT").html(e.count):$("#GET_RESERVESIGN_COUNT").html(0),e.count},model:{id:"signid"}},serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:e.queryParams.pageSize||10,page:e.queryParams.page||1,sort:{field:"createdDate",dir:"desc"}}),i=[{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{title:"",width:280,template:function(e){return'<a ng-click="vm.saveView()"  href="#/signDetails/'+e.signid+"/"+e.processInstanceId+'" >'+e.projectname+"</a>"}},{field:"filecode",title:"收文编号",width:120,filterable:!1},{field:"designcompanyName",title:"项目单位",width:220,filterable:!1},{field:"reviewstage",title:"项目阶段",width:130,filterable:!1},{field:"projectcode",title:"项目代码",width:120,filterable:!1},{field:"receivedate",title:"收文日期",width:160,filterable:!1,format:"{0:yyyy-MM-dd HH:mm:ss}"},{field:"",title:"操作",width:320,template:function(e){var t=!1;e.processInstanceId&&(t=!0);var i=!1;return!e.issign||9!=e.issign&&"9"!=e.issign||(i=!0),common.format($("#columnBtns").html(),e.signid,t,e.signid+"/"+e.processInstanceId,"vm.del('"+e.signid+"')","vm.startNewFlow('"+e.signid+"')","vm.realSign('"+e.signid+"')",i)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig(e.queryParams).pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,dataBound:common.kendoGridConfig(e.queryParams).dataBound,resizable:!0}}var s=rootPath+"/sign";return{grid:r,getsignById:a,reserveAdd:i,deleteReserveSign:n,getPreSignInfo:o}}angular.module("app").factory("reserveSignSvc",e),e.$inject=["$http","$state"]}(),function(){"use strict";function e(e,t,i,o,n,a,r){var s=this;s.model={},s.flow={},s.model.signid=i.params.signid,s.flow.processInstanceId=i.params.processInstanceId,s.showFlag={tabWorkProgram:!1,tabBaseWP:!1,tabDispatch:!1,tabFilerecord:!1,tabExpert:!1,tabSysFile:!1,tabAssociateSigns:!1},s.businessFlag={expertReviews:[]},s.expertList=new Array(15),function(){$("#myTab li").click(function(e){var t=$("a",this);e.preventDefault(),t.tab("show");var i=t.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500),s.model.showDiv=i}),i.params.processInstanceId&&o.initFlowData(s),t.initFlowPageData(s.model.signid,function(e){s.model=e;var t=$("#myTab .active"),i=$("a",t);if(s.model.showDiv=i.attr("for-div"),s.model.dispatchDocDto&&(s.showFlag.tabDispatch=!0,s.dispatchDoc=s.model.dispatchDocDto,r.findAssistPlanSignById(s.model.signid,function(e){s.assistPlanSign=e})),s.model.workProgramDtoList&&s.model.workProgramDtoList.length>0){var o;""!=(o="1"==s.model.workProgramDtoList[0].branchId||"1"==s.model.workProgramDtoList[0].branchId?s.model.workProgramDtoList[0].reviewOrgName:s.model.workProgramDtoList[0].mainWorkProgramDto.reviewOrgName)&&o.split(",").length>1&&(s.showTotalInvestment=!0)}s.model.fileRecordDto&&(s.showFlag.tabFilerecord=!0,s.fileRecord=s.model.fileRecordDto),s.model.processState>1&&(s.showFlag.tabWorkProgram=!0),s.model.suppLetterDtoList&&(s.showSupperIndex=0),void 0!=s.model.registerFileDtoDtoList&&(s.supply=[],s.registerFile=[],s.drawingFile=[],s.otherFile=[],s.model.registerFileDtoDtoList.forEach(function(e,t){"3"==e.businessType?s.supply.push(e):"2"==e.businessType?s.drawingFile.push(e):"1"==e.businessType||"4"==e.businessType?s.registerFile.push(e):"5"!=e.businessType&&"6"!=e.businessType&&"7"!=e.businessType||s.otherFile.push(e)}))}),e.findByMianId(s.model.signid,function(t){t&&t.length>0&&(s.showFlag.tabSysFile=!0,s.sysFileList=t,e.initZtreeClient(s,n))})}(),s.templatePage=function(e){a.templatePage(e)},s.commonDownloadSysFile=function(t){e.downloadFile(t)}}angular.module("app").controller("signDetailsCtrl",e),e.$inject=["sysfileSvc","signSvc","$state","flowSvc","$scope","templatePrintSvc","assistSvc"]}(),function(){"use strict";function e(e,t,i,o,n){function a(t,i){var o={method:"post",url:rootPath+"/signwork/fingSignWorkById",params:{signId:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function r(e){var t=$("#countSignDayForm");t.attr("target",""),t.attr("method","post"),t.attr("action",rootPath+"/signView/excelExport"),t.find("input[name='signIds']").val(e),t.submit()}function s(t,i){var o={method:"post",url:rootPath+"/sign/sumExistDays",params:{signIds:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function l(t,i){var o={method:"post",url:rootPath+"/dispatch/createDispatchTemplate",params:{signId:t.model.signid}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function c(t,i,o){var n={method:"get",url:rootPath+"/intfc/getPreSign",params:{fileCode:t,signType:i}},a=function(e){void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a})}function d(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/sign/findBySignUser",$("#searchform"),e.gridParams),schema:{data:"value",total:function(e){return e.count?$("#GET_SIGN_COUNT").html(e.count):$("#GET_SIGN_COUNT").html(0),e.count},model:{id:"signid"}},serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:e.queryParams.pageSize||10,page:e.queryParams.page||1,sort:{field:"createdDate",dir:"desc"}}),i=[{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"",title:"项目名称",width:280,filterable:!1,template:function(e){return'<a ng-click="vm.saveView()"  href="#/fillSign/'+e.signid+'/" >'+e.projectname+"</a>"}},{field:"filecode",title:"收文编号",width:120,filterable:!1},{field:"designcompanyName",title:"项目单位",width:260,filterable:!1},{field:"reviewstage",title:"评审阶段",width:130,filterable:!1},{field:"projectcode",title:"项目代码",width:160,filterable:!1},{field:"signdate",title:"签收日期",width:100,filterable:!1,format:"{0:yyyy-MM-dd HH:mm:ss}"},{field:"",title:"流程状态",width:80,filterable:!1,template:function(e){return e.signState?1==e.signState?'<span style="color:green;">进行中</span>':2==e.signState?'<span style="color:orange;">已暂停</span>':8==e.signState?'<span style="color:red;">强制结束</span>':9==e.signState?'<span style="color:blue;">已完成</span>':5==e.signState?"未发起":"":"未发起"}},{field:"",title:"操作",width:320,template:function(e){var t=!1;e.processInstanceId&&(t=!0);var i=!1;return!e.issign||9!=e.issign&&"9"!=e.issign||(i=!0),common.format($("#columnBtns").html(),e.signid,t,e.signid+"/"+e.processInstanceId,"vm.del('"+e.signid+"')",t,"vm.startNewFlow('"+e.signid+"')",t,"vm.realSign('"+e.signid+"')",i)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,pageable:common.kendoGridConfig(e.queryParams).pageable,dataBound:common.kendoGridConfig(e.queryParams).dataBound,resizable:!0}}function u(t,i){var o={method:"post",url:rootPath+"/sign",data:t},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function m(t,i){var o={method:"post",url:rootPath+"/officeUser/findOfficeUsersByDeptName",data:t},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function p(t,i){var o={method:"put",url:rootPath+"/sign",data:t},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function f(t,i){var o={method:"delete",url:rootPath+"/sign",params:{signid:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function h(t,i){var o={method:"post",url:rootPath+"/sign/html/initFillPageData",params:{signid:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function g(t,i){var o={method:"get",url:rootPath+"/sign/html/initDetailPageData",params:{signid:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function v(t,i){var o={method:"get",url:rootPath+"/sign/initFlowPageData",params:{signid:t,queryAll:!0}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function y(t){var o={method:"delete",url:rootPath+"/workprogram/deleteBySignId",params:{signId:t.model.signid}},n=function(e){t.isSubmit=!1,e.data.flag||"ok"==e.data.reCode?(t.businessFlag.isFinishWP=!1,i.success("操作成功！")):i.error(e.data.reMsg)};common.http({vm:t,$http:e,httpOptions:o,success:n})}function w(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/sign/fingByOData",$("#searchAssociateform"),{filter:"isAssociate eq 0"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{field:"projectname",title:"项目名称",width:160,filterable:!1},{field:"projectcode",title:"收文编号",width:140,filterable:!1},{field:"designcompanyName",title:"项目单位",width:200,filterable:!1},{field:"reviewstage",title:"项目阶段",width:160,filterable:!1},{field:"projectcode",title:"项目代码",width:140,filterable:!1}];e.associateGridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0}}function b(t,i){e({method:"get",url:rootPath+"/sign/findAssociateSignList",params:{signid:t.price.signid,reviewstage:t.price.reviewstage,projectname:t.price.projectname,skip:t.price.skip,size:t.price.size}}).then(function(e){"function"==typeof i&&i(e.data)})}function S(t,i){var o={method:"post",url:rootPath+"/sign/findAssociateSign",data:t},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function k(t,i,o){i="undefined"==i?null:i;var n={method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded"},url:rootPath+"/sign/associate",data:$.param({signId:t,associateId:i},!0)},a=function(e){void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a})}function C(t,i){var o={method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded"},url:rootPath+"/sign/associate?signId="+i},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){if(void 0!=e.data){t.associateSign=e.data;for(var i=e.data,o="",n=i.length-1;n>=0;n--){var a=i[n],r=a.signdate||"";o+='<div class="intro-list"><div class="intro-list-left">项目阶段：'+a.reviewstage+"<br/>签收时间："+r+'</div><div class="intro-list-right"><span></span><div class="intro-list-content">名称：<span style="color:red;">'+a.projectname+'</span><br/>送件人：<span style="color:red;">'+a.sendusersign+"</span><br/></div></div></div>"}$("#introFlow").html(o);$("#myStep").step({animate:!0,initStep:1,speed:1e3})}}})};common.http({vm:t,$http:e,httpOptions:o,success:n})}function D(t,i){var o={method:"get",url:rootPath+"/workprogram/createMeetingDoc",params:{signId:t.model.signid}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({vm:t,$http:e,httpOptions:o,success:n})}function P(t,i,o){var n={method:"post",url:rootPath+"/dispatch/createFileNum",params:{signId:t,dispatchId:i}},a=function(e){void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a})}function I(t,i){var o={method:"post",url:rootPath+"/sign/realSign",params:{signid:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function x(e){var t=common.kendoGridDataSource(rootPath+"/sign/fingByGetBack",$("#signBackform"),e.queryParams.page,e.queryParams.pageSize,e.gridParams),i=[{field:"",title:"序号",template:"<span class='row-number'></span>",width:50},{field:"projectName",title:"项目名称",width:"25%",filterable:!1},{field:"nodeNameValue",title:"当前环节",width:"10",filterable:!1},{field:"displayName",title:"处理人",width:"10",filterable:!1},{field:"",title:"合并评审",width:"15%",filterable:!1,template:function(e){return e.reviewType?9==e.reviewType||"9"==e.reviewType?"合并评审[主项目]":"合并评审[次项目]":"否"}},{field:"reviewStage",title:"项目阶段",width:"15%",filterable:!1},{field:"signDate",title:"签收时间",width:"10%",filterable:!1},{field:"",title:"操作",width:"10%",template:function(e){return common.format($("#columnBtns").html(),"signFlowDetail",e.businessKey,e.taskId,e.processInstanceId,"vm.getBack")}}];e.signGetBackGrid={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,
pageable:common.kendoGridConfig(e.queryParams).pageable,dataBound:common.kendoGridConfig(e.queryParams).dataBound,resizable:!0}}function F(t,i,o){var n={method:"post",url:rootPath+"/sign/getBack",params:{taskId:t,businessKey:i}},a=function(e){void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a})}function T(e){"项目建议书"==e.model.reviewstage||"可行性研究报告"==e.model.reviewstage||"其它"==e.model.reviewstage?n.templatePrint("sign_fill_xmjys_templ"):"资金申请报告"==e.model.reviewstage?n.templatePrint("sign_fill_zjsq_templ"):"进口设备"==e.model.reviewstage?n.templatePrint("sign_fill_jksb_templ"):"设备清单（国产）"==e.model.reviewstage||"设备清单（进口）"==e.model.reviewstage?n.templatePrint("sign_fill_sbqd_templ"):"项目概算"==e.model.reviewstage&&n.templatePrint("sign_fill_xmgs_templ")}function O(e){var t=common.kendoGridDataSource(rootPath+"/signView/getSignList?$orderby=receivedate",$("#deletform"),e.queryParams.page,e.queryParams.pageSize,e.gridParams),i=[{field:"",title:"序号",template:"<span class='row-number text-center'></span>",width:40},{field:"",title:"项目名称",width:160,filterable:!1,template:function(e){return e.processInstanceId?'<a ng-click="vm.saveView()" href="#/signDetails/'+e.signid+"/"+e.processInstanceId+'" >'+e.projectname+"</a>":'<a ng-click="vm.saveView()" href="#/signDetails/'+e.signid+'/" >'+e.projectname+"</a>"}},{field:"reviewstage",title:"项目阶段",width:110,filterable:!1},{field:"projectcode",title:"项目代码",width:100,filterable:!1},{field:"signdate",title:"签收日期",width:100,filterable:!1,format:"{0:yyyy/MM/dd HH:mm:ss}"},{field:"",title:"操作",width:90,filterable:!1,template:function(e){return common.format($("#columnBtns").html(),"vm.editSignState('"+e.signid+"')")}}];e.signListOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,pageable:common.kendoGridConfig(e.queryParams).pageable,dataBound:common.kendoGridConfig(e.queryParams).dataBound}}function L(t,i){var o={method:"post",url:rootPath+"/sign/editSignState",params:{signId:t.signid,stateProperty:"signState",stateValue:t.stateValue}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function M(e){var t=common.kendoGridDataSource(rootPath+"/signView/getSignList?$orderby=receivedate",$("#Maintenanform"),e.queryParams.page,e.queryParams.pageSize,e.gridParams),i=[{field:"",title:"序号",template:"<span class='row-number text-center'></span>",width:50},{field:"",title:"项目名称",width:260,filterable:!1,template:function(e){return e.processInstanceId?'<a ng-click="vm.saveView()" href="#/MaintainProjectEdit/'+e.signid+"/"+e.processInstanceId+'" >'+e.projectname+"</a>":'<a ng-click="vm.saveView()" href="#/MaintainProjectEdit/'+e.signid+'/" >'+e.projectname+"</a>"}},{field:"builtcompanyname",title:"建设单位",width:210,filterable:!1},{field:"reviewstage",title:"评审阶段",width:120,filterable:!1},{field:"",title:"项目状态",width:80,filterable:!1,template:function(e){var t="";switch(e.signState){case"1":t="进行中";break;case"2":t="暂停";break;case"8":t="强制结束";break;case"9":t="已完成"}return t}},{field:"signNum",title:"收文编号",width:100,filterable:!1},{field:"signdate",title:"收文日期",width:100,filterable:!1},{field:"dfilenum",title:"发文号",width:100,filterable:!1},{field:"ffilenum",title:"归档编号",width:130,filterable:!1},{field:"reviewOrgName",title:"所属部门",width:100,filterable:!1},{field:"allPriUser",title:"项目负责人",width:100,filterable:!1},{field:"dispatchType",title:"发文类型",width:100,filterable:!1},{field:"appalyInvestment",title:"申报金额",width:100,filterable:!1},{field:"authorizeValue",title:"审定金额",width:100,filterable:!1},{field:"extraValue",title:"核减",width:100,filterable:!1},{field:"approveValue",title:"批复金额",width:100,filterable:!1}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0,pageable:common.kendoGridConfig(e.queryParams).pageable,dataBound:common.kendoGridConfig(e.queryParams).dataBound}}return{signGrid:d,createSign:u,initFillData:h,initDetailData:g,updateFillin:p,deleteSign:f,findOfficeUsersByDeptName:m,initFlowPageData:v,removeWP:y,associateGrid:w,getAssociateSign:S,getAssociateSignGrid:b,saveAssociateSign:k,initAssociateSigns:C,meetingDoc:D,createDispatchFileNum:P,realSign:I,createDispatchTemplate:l,signGetBackGrid:x,getBack:F,editTemplatePrint:T,signDeletGrid:O,editSignState:L,sumExistDays:s,MaintenanProjectGrid:M,excelExport:r,findExpertReview:a,getSignInfo:c}}angular.module("app").factory("signSvc",e),e.$inject=["$http","$state","bsWin","sysfileSvc","templatePrintSvc"]}();!function(){"use strict";function e(e,t){function i(){o.review=["项目建议书","可行性研究报告","项目概算","资金申请报告","其它"],o.title="项目申报投资金额分布情况",o.capital=["申报金额","审定金额"],o.yAxisName="金额（亿元）",o.lineLegendData=["审定/申报"],o.lineResultValue=[],o.LineYAxisName="百分比（%）",o.appalyinvestment=[],o.authorizeValue=[],o.extraRate=[],o.resultData=[],e.findByTime(o,function(e){if(e.flag||"ok"==e.reCode){var i=e.reObj;if(void 0!=i&&i.length>0){for(var n=0;n<o.review.length;n++)for(var a=0;a<i.length;a++)$.each(i[a],function(e,t){e==o.review[n]&&(o.appalyinvestment.push(t[0]),o.authorizeValue.push(t[1]),o.lineResultValue.push(void 0==t[3]?0:t[3]),o.extraRate.push({reviewStage:e,value:void 0==t[4]?0:t[4]}))});o.resultData.push(o.appalyinvestment,o.authorizeValue),o.gotoLineChart()}}else t.error(e.reMsg)})}var o=this;o.startTime=(new Date).halfYearAgo(),o.endTime=(new Date).Format("yyyy-MM-dd"),o.statsType="1",o.chartType="lineChart",o.reviewStage=[],$("input[type='radio']").click(function(){var e=$("input[type='radio']:checked").val();"lineChart"==e?o.gotoLineChart():"histogram"==e?o.gotoHistogram():"pie"==e&&o.gotoPie()}),o.resetChart=function(){o.resultData=[],"1"==o.statsType&&(o.chartType="lineChart",i()),"2"==o.statsType&&(o.chartType="histogram",o.review=["项目建议书","可行性研究报告","项目概算","资金申请报告","设备清单（进口）","设备清单（国产）","进口设备","其它"],o.title="项目类别分布情况",o.capital=["市政工程","房建工程","信息工程","设备采购","其他"],o.yAxisName="项目个数",o.sz=[],o.fj=[],o.xx=[],o.sb=[],o.qt=[],o.lineLegendData=["审定/申报"],o.lineResultValue=[],o.LineYAxisName="百分比（%）",e.findByTypeAndReview(o,function(e){if(e.flag||"ok"==e.reCode){for(var i=e.reObj,n=0;n<o.review.length;n++)for(var a=0;a<i.length;a++)$.each(i[a],function(e,t){e==o.review[n]&&(o.sz.push(t[0]),o.fj.push(t[1]),o.xx.push(t[2]),o.sb.push(t[3]),o.qt.push(t[4]))});o.resultData.push(o.sz,o.fj,o.xx,o.sb,o.qt),o.gotoHistogram()}else t.error(e.reMsg)})),"3"==o.statsType&&(o.chartType="pie",o.title="项目申报投资金额分布情况",o.stage=["3000万以下","3000万-1亿","1亿-10亿","10亿以上"],e.pieData(o,function(e){e.flag||"ok"==e.reCode?(o.resultData=e.reObj,void 0!=o.resultData&&null!=o.resultData?o.gotoPie():t.error("该时间段没有数据！")):t.error(e.reMsg)}))},o.gotoHistogram=function(){o.showHistogram=!0,o.showLineChart=!1,o.showPie=!1,o.series=[];for(var e=0;e<o.capital.length;e++)o.series.push({name:o.capital[e],type:"bar",data:o.resultData[e],barWidth:10,itemStyle:{normal:{label:{show:!0,position:"top",formatter:function(e){return e.value}}}}});o.initHistogram()},o.initHistogram=function(){var e=echarts.init(document.getElementById("histogram")),t={title:{text:o.title,x:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#283b56"}}},legend:{orient:"vertical",left:"left",data:o.capital},toolbox:{show:!0,x:"80%",feature:{dataView:{show:!0,readOnly:!0},restore:{show:!0},saveAsImage:{show:!0}},optionToContent:function(e){var t=e.xAxis[0].data,i=e.series,n='<table id="test" class="table-bordered table-striped" style="width:100%;text-align:center">';n+="<tbody><tr>",n+='<th style="text-align: center;">评审阶段</th>';for(var a=0;a<i.length;a++)"1"==o.statsType&&(n+='<th style="text-align: center;">'+i[a].name+"(亿元)</th>"),"2"==o.statsType&&(n+='<th style="text-align: center;">'+i[a].name+"(个)</th>");n+="</tr>";for(var a=0,r=t.length;a<r;a++){n+="<tr><td>"+t[a]+"</td>";for(var s=0;s<i.length;s++)n+="<td>"+i[s].data[a]+"</td>"}return n+="</tbody>"}},grid:{left:"13%",right:"10%",bottom:"10%",containLabel:!0},xAxis:{type:"category",name:"评审阶段",data:o.review,axisTick:{alignWithLabel:!0},axisLabel:{interval:0,rotate:35,margin:2,textStyle:{fontWeight:"bolder",color:"#295645"}}},yAxis:{type:"value",name:o.yAxisName,min:0},series:o.series,itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0,0,0,0.5)"}}};e.clear(),e.setOption(t)},o.gotoLineChart=function(){o.showHistogram=!1,o.showPie=!1,o.showLineChart=!0,o.lineSeries=[];for(var e=0;e<o.lineLegendData.length;e++)o.lineSeries.push({name:o.lineLegendData[e],type:"line",data:o.lineResultValue,itemStyle:{normal:{label:{show:!0,position:"top",textStyle:{fontWeight:"normal",fontSize:15},formatter:function(e){return e.value}}}}});o.initLineChart()},o.initLineChart=function(){var e=echarts.init(document.getElementById("lineChart")),t={title:{text:o.title,x:"center"},tooltip:{trigger:"item",formatter:function(e){for(var t=0;t<o.extraRate.length;t++)if(e.name==o.extraRate[t].reviewStage)return e.name+"<br/> 核减率 : "+o.extraRate[t].value+"%"}},grid:{left:"13%",right:"10%",bottom:"10%",containLabel:!0},toolbox:{show:!0,x:"80%",feature:{dataView:{show:!0,readOnly:!0},restore:{show:!0},saveAsImage:{show:!0}},optionToContent:function(e){var t=e.xAxis[0].data,i=e.series,o='<table id="test" class="table-bordered table-striped" style="width:100%;text-align:center">';o+="<tbody><tr>",o+='<th style="text-align: center;">评审阶段</th>';for(var n=0;n<i.length;n++)o+='<th style="text-align: center;">'+i[n].name+"</th>";o+="</tr>";for(var n=0,a=t.length;n<a;n++){o+="<tr><td>"+t[n]+"</td>";for(var r=0;r<i.length;r++)o+="<td>"+i[r].data[n]+"</td>"}return o+="</tbody>"}},legend:{orient:"vertical",left:"left",data:o.lineLegendData},xAxis:{type:"category",name:"评审阶段",splitLine:{show:!1},data:o.review,axisLabel:{interval:0,rotate:35,margin:2,textStyle:{fontWeight:"bolder",color:"#295645"}}},yAxis:{type:"value",name:o.LineYAxisName,min:0},series:o.lineSeries,lineStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0,0,0,0.5)"}}};e.clear(),e.setOption(t)},o.gotoPie=function(){o.showHistogram=!1,o.showLineChart=!1,o.showPie=!0,o.series=[],o.tooltipFormater=[];for(var e=0;e<o.resultData[1].length;e++)o.series.push({value:o.resultData[1][e],name:o.stage[e],label:{normal:{formatter:" {b} : {c}%",textStyle:{fontWeight:"normal",fontSize:15}}}}),o.tooltipFormater.push({seriesName:"项目数",totalName:"项目总数",totalValue:o.resultData[2],name:o.stage[e],pidName:"占百分比",data:o.resultData[0][e],value:o.resultData[1][e]});o.initPie()},o.initPie=function(){var e=echarts.init(document.getElementById("pie")),t={title:{text:o.title,x:"center"},tooltip:{trigger:"item",width:150,formatter:function(e){for(var t=0;t<o.tooltipFormater.length;t++)if(o.tooltipFormater[t].name==e.name)return e.name+"<br/>"+o.tooltipFormater[t].seriesName+" : "+o.tooltipFormater[t].data+"<br/>"+o.tooltipFormater[t].totalName+" : "+o.tooltipFormater[t].totalValue+"<br/>"+o.tooltipFormater[t].pidName+" : "+o.tooltipFormater[t].value+"%"}},grid:{left:"10%",right:"10%",bottom:"10%",containLabel:!0},toolbox:{show:!0,x:"80%",feature:{dataView:{show:!0,readOnly:!0},restore:{show:!0},saveAsImage:{show:!0}},optionToContent:function(e){var t=e.series[0].data,i='<table id="test" class="table-bordered table-striped" style="width:100%;text-align:center">';i+="<tbody><tr>",i+='<th style="text-align: center;">申报金额范围</th>',i+='<th style="text-align: center;">占百分比(%)</th>',i+="</tr>";for(var o=0,n=t.length;o<n;o++)i+="<tr><td>"+t[o].name+"</td>",i+="<td>"+t[o].value+"</td>";return i+="</tbody>"}},legend:{orient:"vertical",left:"left",data:o.stage},series:[{type:"pie",radius:"30%",center:["50%","50%"],selectMode:"single",data:o.series,itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0,0,0,0.5)"}}}]};e.clear(),e.setOption(t)},i()}angular.module("app").controller("signChartCtrl",e),e.$inject=["signChartSvc","bsWin"]}(),function(){"use strict";function e(e){function t(t){var i={method:"post",url:rootPath+"/signView/getDate"},o=function(e){void 0!=t&&"function"==typeof t&&t(e.data)};common.http({httpOptions:i,$http:e,success:o})}function i(t,i){var o={method:"post",url:rootPath+"/signView/findByTime",params:{startTime:t.startTime,endTime:t.endTime}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({vm:t,httpOptions:o,$http:e,success:n})}function o(t,i){var o={method:"post",url:rootPath+"/signView/pieDate",params:{startTime:t.startTime,endTime:t.endTime}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({vm:t,httpOptions:o,$http:e,success:n})}function n(t,i){var o={method:"post",url:rootPath+"/signView/findByTypeAndReview",params:{startTime:t.startTime,endTime:t.endTime}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({vm:t,httpOptions:o,$http:e,success:n})}return{findByTime:i,pieData:o,findByTypeAndReview:n,getDate:t}}angular.module("app").factory("signChartSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,i,o,n,a,r){var s=this;s.title="作废项目列表",s.stateName=n.current.name,s.queryParams={},s.saveView=function(){a.storeView(s.stateName,{gridParams:s.signListOptions.dataSource.transport.options.read.data(),queryParams:s.queryParams,data:s})},s.query=function(){s.signListOptions.dataSource._skip=0,s.signListOptions.dataSource.read()},s.editSignState=function(t){s.signid=t,r.getProjectStopBySignId(t,function(e){"9"==e[0].isactive&&"9"==e[0].isOverTime?s.stateValue="2":s.stateValue="1"}),o.confirm({title:"询问提示",message:"确认要恢复项目吗？",onOk:function(){e.editSignState(s,function(e){e.flag||"ok"==e.reCode?o.alert("恢复成功！",function(){s.signListOptions.dataSource.read()}):o.alert(e.reMsg)})}})},s.formReset=function(){var e=$("#deletform").find("input,select").not(":submit, :reset, :image, :disabled,:hidden");$.each(e,function(e,t){t.value=""})},function(){if(a.view[s.stateName]){var t=a.view[s.stateName];t.gridParams&&(s.gridParams=t.gridParams),t.data&&(s.project=t.data.project),t.queryParams&&(s.queryParams=t.queryParams),e.signDeletGrid(s),a.view[s.stateName]=void 0}else e.signDeletGrid(s)}()}angular.module("app").controller("signDeletCtrl",e),e.$inject=["signSvc","flowSvc","signFlowSvc","bsWin","$state","$rootScope","pauseProjectSvc"]}(),function(){"use strict";function e(e,t,i,o,n,a){var r=this;r.stateName=n.current.name,r.queryParams={},r.saveView=function(){a.storeView(r.stateName,{gridParams:r.signGetBackGrid.dataSource.transport.options.read.data(),queryParams:r.queryParams,data:r})},r.getBack=function(t,i){o.confirm({title:"询问提示",message:"确认取回吗？",onOk:function(){e.getBack(t,i,function(e){e.flag||"ok"==e.reCode?o.alert("取回项目成功",function(){r.signGetBackGrid.dataSource.read();var e=parseInt($("#DO_SIGN_COUNT").html());$("#DO_SIGN_COUNT").html(e+1)}):o.alert(e.reMsg)})}})},r.query=function(){r.signGetBackGrid.dataSource._skip=0,r.signGetBackGrid.dataSource.read()},function(){if(a.view[r.stateName]){var t=a.view[r.stateName];t.gridParams&&(r.gridParams=t.gridParams),t.data&&(r.model=t.data.model),t.queryParams&&(r.queryParams=t.queryParams),e.signGetBackGrid(r),a.view[r.stateName]=void 0}else e.signGetBackGrid(r)}()}angular.module("app").controller("signGetBackCtrl",e),e.$inject=["signSvc","flowSvc","signFlowSvc","bsWin","$state","$rootScope"]}(),function(){"use strict";function e(e,t,i,o,n,a){var r=this;r.title="维护项目列表",r.model={},r.model.signdatebigen=(new Date).oneMonthAgo(),r.model.signdateend=(new Date).Format("yyyy-MM-dd"),$("#signdatebigen").val(""),$("#signdateend").val(""),r.stateName=n.current.name,r.queryParams={},r.saveView=function(){a.storeView(r.stateName,{gridParams:r.gridOptions.dataSource.transport.options.read.data(),queryParams:r.queryParams,data:r})},r.query=function(){r.gridOptions.dataSource._skip=0,r.gridOptions.dataSource.read()},r.formReset=function(){var e=$("#deletform").find("input,select").not(":submit, :reset, :image, :disabled,:hidden");$.each(e,function(e,t){t.value=""})},function(){if(a.view[r.stateName]){var t=a.view[r.stateName];t.gridParams&&(r.gridParams=t.gridParams),t.data&&(r.model=t.data.model),t.queryParams&&(r.queryParams=t.queryParams),e.MaintenanProjectGrid(r),a.view[r.stateName]=void 0}else $("#signdatebigen").val(r.model.signdatebigen),$("#signdateend").val(r.model.signdateend),e.MaintenanProjectGrid(r)}()}angular.module("app").controller("MaintainProjectCtrl",e),e.$inject=["signSvc","flowSvc","signFlowSvc","bsWin","$state","$rootScope"]}(),function(){"use strict";function e(e,t,i,o,n,a,r,s){var l=this;l.title="维护项目修改",l.model={},l.model.signid=i.params.signid,l.model.processInstanceId=i.params.processInstanceId,l.signWorkList={},l.initFileUpload=function(){l.sysFile={businessId:l.model.signid,mainId:l.model.signid,mainType:a.mainTypeValue().SIGN,sysfileType:a.mainTypeValue().WORKPROGRAM,sysBusiType:a.mainTypeValue().WORKPROGRAM},a.initUploadOptions({inputId:"sysfileinput",vm:l,uploadSuccess:function(){a.findByMianId(l.model.signid,function(e){e&&e.length>0&&(l.isDisplay=!0,l.sysFileList=e,a.initZtreeClient(l,n))})}})},function(){$("#myTab li").click(function(e){var t=$("a",this);e.preventDefault(),t.tab("show");var i=t.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500),l.model.showDiv=i}),t.initFlowPageData(l.model.signid,function(e){if(l.model=e,l.dispatchDoc=l.model.dispatchDocDto,l.fileRecordDto=l.model.fileRecordDto,l.model.workProgramDtoList)for(var t=0;t<l.model.workProgramDtoList.length;t++)"1"==l.model.workProgramDtoList[t].branchId&&(l.work=l.model.workProgramDtoList[t],l.work.secondChargeUserName&&(l.secondChargeUserName=l.work.secondChargeUserName.split(",")));a.findByMianId(l.model.signid,function(e){e&&e.length>0&&(l.isDisplay=!0,l.sysFileList=e,a.initZtreeClient(l,n))})}),l.initFileUpload()}(),l.addRegisterFile=function(){i.go("registerFile",{businessId:l.model.signid})},l.addWorkProgram=function(){l.model.processInstanceId?l.model.workProgramDtoList?i.go("workprogramEdit",{signid:l.model.signid,isControl:!0}):s.alert("该项目还没有填写工作方案"):s.alert("该项目还没有发起流程")},l.addDisPatch=function(){l.model.processInstanceId?l.model.dispatchDocDto?l.model.isAssociate&&0!=l.model.isAssociate||signcommon.getReviewStage().STAGE_STUDY!=l.model.reviewstage&&signcommon.getReviewStage().STAGE_BUDGET!=l.model.reviewstage?i.go("dispatchEdit",{signid:l.model.signid,isControl:!0}):s.confirm({title:"询问提示",message:"该项目还没进行项目关联，是否需要进行关联设置？",onOk:function(){l.searchAssociateSign||(l.searchAssociateSign={signid:l.model.signid,projectname:l.model.projectname}),t.getAssociateSign(l.searchAssociateSign,function(e){l.associateSignList=[],e&&(l.associateSignList=e),$("#associateWindow").kendoWindow({width:"75%",height:"650px",title:"项目关联",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()})},onCancel:function(){i.go("dispatchEdit",{signid:l.model.signid,isControl:!0})}}):s.alert("该项目还没有填写发文"):s.alert("该项目还没有发起流程")},l.addDoFile=function(){l.model.processInstanceId?l.model.fileRecordDto?i.go("fileRecordEdit",{signid:l.model.signid,isControl:!0}):s.alert("该项目还没有填写归档"):s.alert("该项目还没有发起流程")},l.scrap=function(e){s.confirm({title:"询问提示",message:"确认作废该条项目吗？",onOk:function(){t.deleteSign(e,function(e){e.flag||"ok"==e.reCode?s.alert("操作成功！",function(){i.go("MaintainProjectList")}):s.alert(e.reMsg)})}})},l.pauseProject=function(){e.findPausingProject(l,l.model.signid)},l.addSuppLetter=function(){i.go("addSupp",{businessId:l.model.signid,businessType:"SIGN",isControl:!0})},l.relation=function(){l.searchAssociateSign||(l.searchAssociateSign={signid:l.model.signid,projectname:l.model.projectname}),t.getAssociateSign(l.searchAssociateSign,function(e){l.associateSignList=[],e&&(l.associateSignList=e),$("#associateWindow").kendoWindow({width:"75%",height:"650px",title:"项目关联",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open()})},l.findExpertReview=function(e,i){9==i?s.alert("该项目已归档，不能再修改！"):(l.signWorkList={},t.findExpertReview(e,function(e){(e||e.length>0)&&(l.signWorkList=e,$("#signWorkDiv").kendoWindow({width:"860px",height:"320px",title:"抽取专家维护",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","close"]}).data("kendoWindow").center().open())}))},l.colseOpenWin=function(){window.parent.$("#signWorkDiv").data("kendoWindow").close()},l.commonDownloadSysFile=function(e){a.downloadFile(e)},l.delFile=function(e){a.delSysFile(e,function(){s.alert("删除成功",function(){a.findByMianId(l.model.signid,function(e){e&&e.length>0&&(l.sysFileList=e,a.initZtreeClient(l,n))})})})}}angular.module("app").controller("MaintainProjectEditCtrl",e),e.$inject=["pauseProjectSvc","signSvc","$state","flowSvc","$scope","sysfileSvc","addRegisterFileSvc","bsWin"]}(),function(){"use strict";function e(){return n}function t(e){var t="";switch(e){case n.PD:t=a.ZHANG_YF;break;case n.GD:t=a.LI_J}return t}function i(e){var t="";switch(e){case n.PD:t="请张一帆同志阅示。";break;case n.GD:t="请李军同志阅示。"}return t}function o(){return r}var n={PX:"PX",GX:"GX"},a={ZHANG_YF:"张一帆",LI_J:"李军"},r={godispatch:"godispatch",principaluser:"principaluser",seconduser:"seconduser"},s={getBusinessType:e,getDefaultLeader:t,getDefaultZHBYJ:i,getFlowParams:o,getReviewStage:function(){return{STAGE_SUG:"项目建议书",STAGE_STUDY:"可行性研究报告",STAGE_BUDGET:"项目概算",APPLY_REPORT:"资金申请报告",OTHERS:"其它",DEVICE_BILL_HOMELAND:"设备清单（国产）",DEVICE_BILL_IMPORT:"设备清单（进口）",IMPORT_DEVICE:"进口设备"}}};window.signcommon=s}(),function(){"use strict";function e(e,t,i){function o(){n.signWorkList=[],e.signWorkList(function(e){n.signWorkList=e,n.signWorkList&&0!=n.signWorkList.length?n.nodata=!1:n.nodata=!0})}var n=this;n.signId=i.params.signid,o(),n.querySignWork=function(){o()},n.resetForm=function(){var e=$("#signworkform").find("input,select");$.each(e,function(e,t){t.value=""})}}angular.module("app").controller("signworkCtrl",e),e.$inject=["signworkSvc","bsWin","$state"]}(),function(){"use strict";function e(e,t,i){function o(t){var i={method:"post",url:rootPath+"/signwork/fingSignWorkList",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:{$filter:common.buildOdataFilter($("#signworkform"))},transformRequest:function(e){var t=[];for(var i in e)t.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]));return t.join("&")}},o=function(e){void 0!=t&&"function"==typeof t&&t(e.data)};common.http({$http:e,httpOptions:i,success:o})}return{signWorkList:o}}angular.module("app").factory("signworkSvc",e),e.$inject=["$http","$state","bsWin"]}(),function(){"use strict";function e(e,t,i){function o(){t.queryList(n)}var n=this;n.model={},n.title="系统配置",o(),n.addConfig=function(){n.model={},n.model.isShow="9",$("#configdiv").kendoWindow({width:"760px",height:"500px",title:"系统参数编辑",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},n.closeWin=function(){window.parent.$("#configdiv").data("kendoWindow").close(),o()},n.doCommit=function(){common.initJqValidation(),$("#configForm").valid()&&t.saveConfig(n,function(e){e.flag||"ok"==e.reCode?(i.success("操作成功！"),window.parent.$("#configdiv").data("kendoWindow").close(),o()):i.error(e.reMsg)})},n.editConfig=function(e){n.configList.forEach(function(t,i){t.id==e&&(n.model=t)}),$("#configdiv").kendoWindow({width:"700px",height:"440px",title:"参数编辑",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()}}angular.module("app").controller("sysConfigCtrl",e),e.$inject=["$location","sysConfigSvc","bsWin"]}(),function(){"use strict";function e(e){function t(t){var i={method:"get",url:rootPath+"/sysConfig/queryList"},o=function(e){common.requestSuccess({vm:t,response:e,fn:function(){t.configList=new Array,t.configList=e.data}})};common.http({vm:t,$http:e,httpOptions:i,success:o})}function i(i,o){var n={method:"delete",url:rootPath+"/sysConfig",params:{id:o}},a=function(e){common.requestSuccess({vm:i,response:e,fn:function(){common.alert({vm:i,msg:"操作成功",fn:function(){$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),i.isSubmit=!1,t(i)}})}})};common.http({vm:i,$http:e,httpOptions:n,success:a})}function o(t,i){var o={method:"post",url:rootPath+"/sysConfig",data:t.model},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({vm:t,$http:e,httpOptions:o,success:n})}return{queryList:t,deleteConfig:i,saveConfig:o}}angular.module("app").factory("sysConfigSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e){var t=this;t.model={},t.title="部门小组列表",function(){e.listGrid(t.gridOptions)}()}angular.module("app").controller("sysdeptCtrl",e),e.$inject=["sysdeptSvc"]}(),function(){"use strict";function e(e){var t=this;t.model={},t.title="部门小组编辑",t.model.id=$state.params.id,t.model.id&&(t.isUpdate=!0,t.title="更新部门"),function(){t.isUpdate&&e.findById(t.model.id,function(e){t.model=e})}()}angular.module("app").controller("sysdeptEditCtrl",e),e.$inject=["sysdeptSvc"]}(),function(){"use strict";function e(e){function t(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/sysdept/fingByOData",$("#sysDeptForm")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})},o=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"name",title:"小组名称",width:160,filterable:!1},{field:"",title:"操作",width:200,template:function(e){return common.format($("#columnBtns").html(),"vm.del('"+e.id+"')",e.id)}}];common.gridDataSource(t),common.kendoGridConfig().filterable,common.kendoGridConfig().pageable,common.kendoGridConfig().noRecordMessage}function i(t,i){var o={method:"post",url:rootPath+"/sysdept/getSysDeptById",params:{id:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}return{listGrid:t,findById:i}}angular.module("app").factory("sysdeptSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,i){var o=this;o.model={},o.model.signid=i.params.id,o.model.type=i.params.type,o.commonDownloadSysFile=function(e){t.downloadFile(e)},function(){t.queryFile(o.model.signid,o.model.type,function(e){e&&e.length>0&&(o.sysFileList=e)})}()}angular.module("app").controller("fileListCtrl",e),e.$inject=["$location","sysfileSvc","$state"]}(),function(){"use strict";function e(e,t){var i=this;i.title="系统安装包列表",function(){t.queryPluginfile(i)}()}angular.module("app").controller("pluginfileCtrl",e),e.$inject=["$location","sysfileSvc"]}(),function(){"use strict";function e(e,t,i,o){function n(){}function a(){return{SIGN:"项目附件",FILLSIGN:"审批登记",HUMAN:"人事附件",BOOKS:"图书附件",NOTICE:"通知公告",SHARE:"资料共享",MEETTINGROOM:"会议室预定",WORKPROGRAM:"工作方案",DISPATCH:"发文",DOFILE:"归档",MEETING:"会前准备材料",SUPPLEMENT:"补充函",STAGEMEETING:"评审会会议",FILELIBRARY:"质量管理文件库",POLICYLIBRARY:"政策标准库",TOPIC:"课题附件",TOPIC_PLAN:"课题计划书",TOPIC_WORKPLAN:"课题工作方案",TOPIC_FILING:"课题归档",MONTH_FILE:"月报简报",AADSUPP_FILE:"拟补充资料函"}}function r(i){var o={method:"post",url:rootPath+"/file/fileSysCheck",params:{sysFileId:i}},n=function(e){var o=$("#szecSysFileDownLoadForm");o.attr("target",""),o.attr("method","post"),e.data.flag||"ok"==e.data.reCode?(o.attr("action",rootPath+"/file/fileDownload"),o.find("input[name='sysfileId']").val(i),o.submit()):(o.attr("action",""),o.find("input[name='sysfileId']").val(""),t.error(e.data.reMsg))};common.http({$http:e,httpOptions:o,success:n})}function s(t,i){var o={method:"post",url:rootPath+"/file/findByBusinessId",params:{businessId:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function l(t,i){var o={method:"post",url:rootPath+"/file/findByMainId",params:{mainId:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function c(t,i,o){var n={method:"post",url:rootPath+"/file/queryFile",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},data:$.param({mainId:t,sysBusiType:i})},a=function(e){void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a})}function d(i,o){var n={method:"delete",url:rootPath+"/file/deleteSysFile",params:{id:i}},a=function(e){e.data.flag||"ok"==e.data.reCode?void 0!=o&&"function"==typeof o&&o(e.data):t.alert(e.data.reMsg)};common.http({$http:e,httpOptions:n,success:a})}function u(e){e.vm.initUploadOptionSuccess=!1;var i={width:"70%",height:"460px",uploadBt:"upload_file_bt",detailBt:"detail_file_bt",inputId:"sysfileinput",mainType:"没有归类附件",sysBusiType:"",showBusiType:!0};if(!e.vm.sysFile)return void t.alert("初始化附件控件失败，请先定义附件对象！");if(e.sysBusiType&&(i.sysBusiType=e.sysBusiType),e.width&&(i.width=e.width),e.height&&(i.height=e.height),angular.isUndefined(e.vm.sysFile.showBusiType)&&(e.vm.sysFile.showBusiType=i.showBusiType),e.vm.downloadSysFile=function(e){r(e)},e.vm.delSysFile=function(i){d(i,function(o){t.alert(o.reMsg||"删除成功！"),$.each(e.vm.sysFilelists,function(t,o){angular.isUndefined(o)||o.sysFileId!=i||e.vm.sysFilelists.splice(t,1)})})},e.vm.clickUploadBt=function(){e.vm.sysFile.businessId?(e.vm.sysFile.sysBusiType="",angular.element("#sysfileinput").fileinput("clear"),$("#commonUploadWindow").kendoWindow({width:i.width,height:i.height,title:"附件上传",visible:!1,modal:!0,closable:!0}).data("kendoWindow").center().open()):t.alert("请先保存业务数据！")},e.vm.clickDetailBt=function(){if(!e.vm.sysFile.businessId)return void t.alert("请先保存业务数据！");s(e.vm.sysFile.businessId,function(t){e.vm.sysFilelists=[],e.vm.sysFilelists=t,$("#commonQueryWindow").kendoWindow({width:"75%",height:"500px",title:"附件上传列表",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()})},e.vm.sysFile.businessId){var o={language:"zh",allowedPreviewTypes:["image"],allowedFileExtensions:["sql","exe","lnk"],maxFileSize:0,showRemove:!1,previewFileIcon:"<i class='glyphicon glyphicon-king'></i>",uploadAsync:!1,enctype:"multipart/form-data",uploadUrl:rootPath+"/file/fileUpload",previewFileIconSettings:{doc:'<i class="fa fa-file-word-o text-primary"></i>',xls:'<i class="fa fa-file-excel-o text-success"></i>',ppt:'<i class="fa fa-file-powerpoint-o text-danger"></i>',docx:'<i class="fa fa-file-word-o text-primary"></i>',xlsx:'<i class="fa fa-file-excel-o text-success"></i>',pptx:'<i class="fa fa-file-powerpoint-o text-danger"></i>',pdf:'<i class="fa fa-file-pdf-o text-danger"></i>',zip:'<i class="fa fa-file-archive-o text-muted"></i>'},uploadExtraData:function(t,o){var n={};return n.businessId=e.vm.sysFile.businessId,n.mainId=e.vm.sysFile.mainId,n.mainType=e.vm.sysFile.mainType||i.mainType,n.sysfileType=e.vm.sysFile.sysfileType||"",n.sysBusiType=e.vm.sysFile.sysBusiType||i.sysBusiType,n}},n=0;$("#"+e.inputId||i.inputId).fileinput(o).on("filebatchselected",function(e,t){n=t.length}).on("filepreupload",function(e,t,i,o){t.form,t.files,t.extra,t.response,t.reader}).on("filebatchuploaderror",function(e,t,i){}).on("filebatchuploadsuccess",function(t,i,o,n){console.log("同步上传成功"),console.log(i),void 0!=e.uploadSuccess&&"function"==typeof e.uploadSuccess&&e.uploadSuccess(t,i,o,n)}),e.vm.initUploadOptionSuccess=!0}}function m(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/file/getPluginFile"),schema:common.kendoGridConfig().schema(),serverPaging:!1,serverSorting:!0,serverFiltering:!0,sort:{field:"createdDate",dir:"desc"}
}),i=[{field:"fileName",title:"名称",filterable:!1},{field:"fileLength",title:"大小",width:160,filterable:!1},{field:"",title:"操作",width:150,template:function(e){return common.format($("#columnBtns").html(),rootPath+"/"+e.relativePath)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0}}function p(e,t){var i,n={check:{chkboxType:{Y:"ps",N:"ps"},enable:!1},callback:{onClick:function(o,n,a){if(e.sysFileList=[],0==a.check_Child_State)a.children&&(e.sysFileList=a.children);else{var r=a.parentTId,s=i.getNodeByTId(r);null!=s&&(e.sysFileList=s.children)}t.$apply()}}},a=e.sysFileList;e.zNodes=[],e.initFileTreeSucess=!1;for(var r=[],s=0,l=a.length;s<l;s++){a[s].sysBusiType||(a[s].sysBusiType="其他文件");var c=new Object;if(c=a[s],c.name=a[s].showName,c.id=a[s].sysFileId,r[a[s].sysBusiType])r[a[s].sysBusiType].push(c);else{var d=new Object;d.id=(new Date).getTime(),d.name=a[s].sysBusiType,e.zNodes.push(d);var u=[];u.push(c),r[a[s].sysBusiType]=u}}for(var s=0,l=e.zNodes.length;s<l;s++){for(var m in r)e.zNodes[s].name==m&&(e.zNodes[s].children=r[m]);s==l-1&&(e.initFileTreeSucess=!0)}t.$watch("vm.initFileTreeSucess",function(t,a){if(1==t)var r=o(function(){if(null!=document.getElementById("zTree")){var t=$.fn.zTree.getZTreeObj("zTree");if(null!=t){var a=t.getSelectedNodes();if(null!=a&&a.length>0){var s=a[0].tId;i=$.fn.zTree.init($("#zTree"),n,e.zNodes);var l=i.getNodeByTId(s);null!=l&&(e.sysFileList=[],e.sysFileList=l.children,i.selectNode(l),i.expandNode(l,!0,!1))}}else{i=$.fn.zTree.init($("#zTree"),n,e.zNodes);var l=i.getNodes();l.length>0&&(i.selectNode(l[0]),i.expandNode(l[0],!0,!1),e.sysFileList=l[0].children)}o.cancel(r)}},500)})}return{initUploadOptions:u,delSysFile:d,downloadFile:r,queryPluginfile:m,findByMianId:l,findByBusinessId:s,mainTypeValue:a,previewFile:n,initZtreeClient:p,queryFile:c}}angular.module("app").factory("sysfileSvc",e),e.$inject=["$http","bsWin","$state","$interval"]}(),function(){"use strict";function e(e,t,i){function o(e){var t=getLodop(),i=rootPath+"/contents/shared/templatePrint.css",o="<link href="+i+" type='text/css' rel='stylesheet'>",n="<head>"+o+"</head><body>"+$("#"+e).html()+"</body>";t.PRINT_INIT(""),t.ADD_PRINT_HTML(10,20,"100%","100%",n),t.PREVIEW()}function n(){var e=navigator.userAgent;return console.log(e),e.indexOf("Opera")>-1?"Opera":e.indexOf("Firefox")>-1?"FF":e.indexOf("Chrome")>-1?"Chrome":e.indexOf("Safari")>-1?"Safari":window.ActiveXObject||"ActiveXObject"in window?"IE":void 0}function a(e){var t=getLodop(),i=rootPath+"/contents/shared/templatePrint.css",o="<link href="+i+" type='text/css' rel='stylesheet'>",n="<head>"+o+"</head><body>"+$("#"+e+"_templ1").html()+"</body>";if(t.PRINT_INIT(""),t.ADD_PRINT_HTML(10,20,"100%","100%",n),$("#"+e+"_templ2").html()){t.NewPage();var a="<head>"+o+"</head><body>"+$("#"+e+"_templ2").html()+"</body>";t.ADD_PRINT_HTML(50,20,"100%","100%",a)}if($("#"+e+"_templ3").html()){t.NewPage();var r="<head>"+o+"</head><body>"+$("#"+e+"_templ3").html()+"</body>";t.ADD_PRINT_HTML(50,20,"100%","100%",r)}t.PREVIEW()}return this.model={},{templatePrint:o,getBrowserType:n,templatePage:a}}angular.module("app").factory("templatePrintSvc",e),e.$inject=["$http","bsWin","$state"]}(),function(){"use strict";function e(e,t,i,o,n){var a=this;a.title="新增课题研究",a.model={},a.model.fgwlx=0,a.model.sendFgw=0,n.params.id&&(a.model.id=n.params.id),a.initFileUpload=function(){a.model.id||t.$watch("vm.model.id",function(e,t){e&&e!=t&&!a.initUploadOptionSuccess&&a.initFileUpload()}),a.sysFile={businessId:a.model.id,mainId:a.model.id,mainType:i.mainTypeValue().TOPIC,sysfileType:i.mainTypeValue().TOPIC_PLAN,sysBusiType:i.mainTypeValue().TOPIC_PLAN,showBusiType:!1},i.initUploadOptions({inputId:"sysfileinput",vm:a})},function(){a.model.id&&o.initDetail(a.model.id,function(e){a.model=e}),o.findOrgUser(function(e){a.principalUsers=e}),a.initFileUpload()}(),a.checkPrincipal=function(){var e=$("#mainPrinUserId").val();e&&$('#principalUser_ul input[selectType="assistUser"]').each(function(){$(this).attr("value")==e?($(this).removeAttr("checked"),$(this).attr("disabled","disabled")):$(this).removeAttr("disabled")})},a.create=function(){if(common.initJqValidation($("#topicform")),$("#topicform").valid()){var t=[];$('#principalUser_ul input[selectType="assistUser"]:checked').each(function(){t.push($(this).attr("value"))}),a.model.prinUserIds=t.join(","),o.createTopic(a.model,a.isCommit,function(t){t.flag||"ok"==t.reCode?(a.model=t.reObj,e.alert("操作成功！")):e.alert(t.reMsg)})}else e.alert("页面未填报完整或者为正确，请检查！")},a.startFlow=function(){common.initJqValidation($("#topicform")),$("#topicform").valid()?e.confirm({title:"询问提示",message:"发起流程后，当前页面数据将不能再修改！确认发起流程么？",onOk:function(){var t=[];$('#principalUser_ul input[selectType="assistUser"]:checked').each(function(){t.push($(this).attr("value"))}),a.model.prinUserIds=t.join(","),o.startFlow(a.model,a.isCommit,function(t){t.flag||"ok"==t.reCode?e.alert("保存成功！",function(){n.go("myTopic")}):e.alert(t.reMsg)})}}):e.alert("页面未填报完整或者为正确，请检查！")}}angular.module("app").controller("topicAddCtrl",e),e.$inject=["bsWin","$scope","sysfileSvc","topicSvc","$state"]}(),function(){"use strict";function e(e,t,i,o,n,a){var r=this;r.title="课题研究存档表",r.filing={},r.zlList=[],function(){o.findByTopicId(n.params.topicId,function(e){r.filing=e,r.filing.topicId=n.params.topicId,r.initFileUpload()})}(),r.initFileUpload=function(){r.filing.id||t.$watch("vm.filing.id",function(e,t){e&&e!=t&&!r.initUploadOptionSuccess&&r.initFileUpload()}),r.sysFile={businessId:r.filing.id,mainId:r.filing.topicId,mainType:a.mainTypeValue().TOPIC,sysfileType:a.mainTypeValue().TOPIC_FILING,sysBusiType:a.mainTypeValue().TOPIC_FILING},a.initUploadOptions({inputId:"sysfileinput",vm:r})},r.saveFiling=function(){o.save(r.filing,function(t){t.flag||"ok"==t.reCode?(r.filing=t.reObj,r.filing.topicId=n.params.topicId,e.alert("保存成功！")):e.error(t.reMsg)})},r.addZL=function(){r.filing.registerFileDto||(r.filing.registerFileDto=[]);var e={};e.id=common.uuid(),r.filing.registerFileDto.push(e)},r.delZL=function(){var t=$("#filingform input[tit='dynamicCheckbox']:checked");if(t.length<1)e.alert("请选择要删除的意见！");else{for(var o=[],n=0;n<t.length;n++)t[n].value&&o.push(t[n].value),$.each(r.filing.registerFileDto,function(e,i){i.id==t[n].value&&r.filing.registerFileDto.splice(e,1)});o.length>0&&i.deleteByIds(o.join(","),function(t){e.alert("删除成功！")})}},r.initInputValue=function(e,t){return e.target.checked&&!t?1:t}}angular.module("app").controller("filingEditCtrl",e),e.$inject=["bsWin","$scope","addRegisterFileSvc","filingSvc","$state","sysfileSvc"]}(),function(){"use strict";function e(e,t){function i(t,i){var o={method:"post",url:rootPath+"/filing/initByTopicId",params:{topicId:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function o(t,i){var o={method:"post",url:rootPath+"/filing",data:t},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}return{findByTopicId:i,save:o}}angular.module("app").factory("filingSvc",e),e.$inject=["$http","bsWin"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.title="我的课题列表",function(){o.initMyGird(n)}(),n.searchForm=function(){n.myTopicOptions.dataSource._skip=0,n.myTopicOptions.dataSource.read()},n.formReset=function(){n.searchModel={}}}angular.module("app").controller("myTopicCtrl",e),e.$inject=["bsWin","$scope","sysfileSvc","topicSvc"]}(),function(){"use strict";function e(e,t,i){function o(t){var i={method:"get",url:rootPath+"/user/findChargeUsers"},o=function(e){void 0!=t&&"function"==typeof t&&t(e.data)};common.http({$http:e,httpOptions:i,success:o})}function n(t,i,o){i=!0;var n={method:"post",url:rootPath+"/topicInfo",data:t},a=function(e){i=!1,void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a,onError:function(){i=!1}})}function a(t,i,o){i=!0;var n={method:"post",url:rootPath+"/topicInfo/startFlow",data:t},a=function(e){i=!1,void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a,onError:function(){i=!1}})}function r(t){var i={method:"post",url:rootPath+"/topicInfo/findById",params:{id:t.businessKey}},o=function(e){t.model={},t.model=e.data};common.http({$http:e,httpOptions:i,success:o,onError:function(){}})}function s(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/topicInfo/findByOData",$("#myTopicForm"),{filter:"createdBy eq ${CURRENT_USER.id}"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})},o=[{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"topicName",title:"课题名称",width:"25%",filterable:!1},{field:"cooperator",title:"合作单位",width:"20%",filterable:!1},{field:"createdDate",title:"创建日期",width:"25%",filterable:!1,format:"{0:yyyy/MM/dd HH:mm:ss}"},{field:"",title:"已发起流程",width:"15%",filterable:!1,template:function(e){return e.processInstanceId?"是":"否"}},{field:"",title:"操作",width:"15%",template:function(e){var t=!!e.processInstanceId;return common.format($("#columnBtns").html(),e.id,t,"flowEnd/"+e.id+"/"+flowcommon.getFlowDefinedKey().TOPIC_FLOW+"/"+e.processInstanceId,!t)}}];e.myTopicOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}function l(t,i){var o={method:"post",url:rootPath+"/topicInfo/findDetailById",params:{id:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n,onError:function(){}})}function c(e,t,o){switch(e.curNode.activitiId){case flowcommon.getTopicFlowNode().TOPIC_BZSH_JH:case flowcommon.getTopicFlowNode().TOPIC_FGLD_JH:case flowcommon.getTopicFlowNode().TOPIC_ZRSH_JH:case flowcommon.getTopicFlowNode().TOPIC_BZSH_FA:case flowcommon.getTopicFlowNode().TOPIC_FGLD_FA:case flowcommon.getTopicFlowNode().TOPIC_ZRSH_FA:case flowcommon.getTopicFlowNode().TOPIC_BZSH_BG:case flowcommon.getTopicFlowNode().TOPIC_FGLD_BG:case flowcommon.getTopicFlowNode().TOPIC_ZRSH_BG:case flowcommon.getTopicFlowNode().TOPIC_BZSH_JT:case flowcommon.getTopicFlowNode().TOPIC_FGLD_JT:case flowcommon.getTopicFlowNode().TOPIC_ZRSH_JT:case flowcommon.getTopicFlowNode().TOPIC_BZSH_GD:case flowcommon.getTopicFlowNode().TOPIC_GDY_QR:t.buttBack=!0;break;case flowcommon.getTopicFlowNode().TOPIC_CGJD:case flowcommon.getTopicFlowNode().TOPIC_KTBG:case flowcommon.getTopicFlowNode().TOPIC_KTJT:e.businessMap&&(o.showFlag.isMainPrinUser=e.businessMap.MAIN_USER,o.showFlag.expertEdit=!0);break;case flowcommon.getTopicFlowNode().TOPIC_LXDW:case flowcommon.getTopicFlowNode().TOPIC_QDHT:case flowcommon.getTopicFlowNode().TOPIC_YJSS:case flowcommon.getTopicFlowNode().TOPIC_NBCS:case flowcommon.getTopicFlowNode().TOPIC_YFZL:t.showUploadBT=!0,o.initFileUpload(i.mainTypeValue().TOPIC,i.mainTypeValue().TOPIC,i.mainTypeValue().TOPIC);break;case flowcommon.getTopicFlowNode().TOPIC_JHTC:case flowcommon.getTopicFlowNode().TOPIC_GZFA:t.businessTr=!0;break;case flowcommon.getTopicFlowNode().TOPIC_ZLGD:t.businessTr=!0,o.showFlag.isMainPrinUser=!0,o.showFlag.expertEdit=!0}}return{findOrgUser:o,createTopic:n,startFlow:a,initFlowDeal:r,initFlowNode:c,initMyGird:s,initDetail:l}}angular.module("app").factory("topicSvc",e),e.$inject=["$http","bsWin","sysfileSvc"]}(),function(){"use strict";function e(e,t,i,o,n,a,r){var s=this;s.title="课题研究成果鉴定会工作方案",s.workplan={},n.params.topicId&&(s.workplan.topicId=n.params.topicId),function(){s.workplan.topicId&&o.findByTopicId(s.workplan.topicId,function(e){s.workplan=e,s.workplan.topicId=n.params.topicId,s.initFileUpload()})}(),s.saveWorkPlan=function(){o.save(s.workplan,function(t){t.flag||"ok"==t.reCode?(s.workplan=t.reObj,e.alert("保存成功！")):e.error(t.reMsg)})},s.initFileUpload=function(){s.workplan.id||a.$watch("vm.workplan.id",function(e,t){e&&e!=t&&!s.initUploadOptionSuccess&&s.initFileUpload()}),s.sysFile={businessId:s.workplan.id,mainId:s.workplan.topicId,mainType:r.mainTypeValue().TOPIC,sysfileType:r.mainTypeValue().TOPIC_WORKPLAN,sysBusiType:r.mainTypeValue().TOPIC_WORKPLAN},r.initUploadOptions({inputId:"sysfileinput",vm:s})},s.bookMeeting=function(){s.workplan.id?n.go("room",{businessId:s.workplan.id,businessType:"TOPIC_WP"}):e.alert("请先保存当前信息！")},s.selectExpert=function(){s.workplan.id?n.go("expertReviewEdit",{businessId:n.params.topicId,minBusinessId:s.workplan.id,businessType:"TOPIC",reviewType:s.workplan.reviewType}):e.alert("请先保存当前信息，再继续操作！")},s.updateBookRoom=function(e){s.meetingList||t.findAllMeeting(function(e){s.meetingList=e}),$.each(s.workplan.roomDtoList,function(t,i){e==i.id&&(s.roombook=i)}),$("#roomBookDetailWindow").kendoWindow({width:"50%",height:"620px",title:"会议预定信息",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},s.saveRoom=function(){i.saveRoom(s.roombook,function(t){t.flag||"ok"==t.reCode?($.each(s.workplan.roomDtoList,function(e,i){s.roombook.id==i.id&&(i=t.reObj)}),e.success("操作成功！",function(){s.onRoomClose()})):e.error(t.reMsg)})},s.onRoomClose=function(){window.parent.$("#roomBookDetailWindow").data("kendoWindow").close()}}angular.module("app").controller("workPlanEditCtrl",e),e.$inject=["bsWin","meetingSvc","roomSvc","workPlanSvc","$state","$scope","sysfileSvc"]}(),function(){"use strict";function e(e,t){function i(t,i){var o={method:"post",url:rootPath+"/workPlan/initByTopicId",params:{topicId:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function o(t,i){var o={method:"post",url:rootPath+"/workPlan",data:t},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}return{findByTopicId:i,save:o}}angular.module("app").factory("workPlanSvc",e),e.$inject=["$http","bsWin"]}(),function(){"use strict";function e(e,t,i){var o=this;o.title="用户列表",o.del=function(e){i.confirm({title:"温馨提示",message:"确认删除数据吗？",onOk:function(){t.deleteUser(o,e,function(e){e.flag||"ok"==e.reCode?i.success("操作成功！",function(){o.gridOptions.dataSource.read()}):i.error(e.reMsg)})}})},o.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)i.alert("请选择要删除数据！");else{for(var t=[],n=0;n<e.length;n++)t.push(e[n].value);var a=t.join(",");o.del(a)}},o.queryUser=function(){t.queryUser(o)},o.resetPwd=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)i.alert("请选择数据");else{for(var n=[],a=0;a<e.length;a++)n.push(e[a].value);var r=n.join(",");i.confirm({title:"温馨提示",message:"确认重置密码？",onOk:function(){t.resetPwd(o,r)}})}},function(){o.model||(o.model={}),o.model.jobState||(o.model.jobState="t"),t.grid(o)}()}angular.module("app").controller("userCtrl",e),e.$inject=["$location","userSvc","bsWin"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.title="新增用户",n.isuserExist=!1,n.id=i.params.id,n.id&&(n.isUpdate=!0,n.title="编辑用户"),function(){n.isUpdate?t.getUserById(n):t.initZtreeClient(n),t.getOrg(function(e){n.org={},n.org=e})}(),n.create=function(){if(common.initJqValidation(),$("form").valid()){var e=t.getZtreeChecked(),i=$linq(e).where(function(e){return 0==e.isParent}).select(function(e){return{id:e.id,roleName:e.name}}).toArray();n.model.roleDtoList=i,t.createUser(n.model,n.isSubmit,function(e){e.flag||"ok"==e.reCode?(n.model.id||(n.model.id=e.idCode),o.success("操作成功！")):o.error(e.reMsg)})}},n.update=function(){t.updateUser(n)}}angular.module("app").controller("userEditCtrl",e),e.$inject=["$location","userSvc","$state","bsWin"]}(),function(){"use strict";function e(e,t){function i(i,o){var n={method:"put",url:p+"/resetPwd",params:{ids:o}},a=function(e){t.success("重置密码成功！",function(){i.gridOptions.dataSource.read()})};common.http({vm:i,httpOptions:n,success:a,$http:e})}function o(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0,t.model.id=t.id;var i=u(),o=$linq(i).where(function(e){return 0==e.isParent}).select(function(e){return{id:e.id,roleName:e.name}}).toArray();t.model.roleDtoList=o;var n={method:"put",url:p,data:t.model},a=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:t,$http:e,httpOptions:n,success:a})}}function n(t,i,o){t.isSubmit=!0;var n={method:"delete",url:p,data:i},a=function(e){t.isSubmit=!1,void 0!=o&&"function"==typeof o&&o(e.data)};common.http({vm:t,$http:e,httpOptions:n,success:a,onError:function(){t.isSubmit=!1}})}function a(t,i,o){i=!0;var n={method:"post",url:rootPath+"/user",data:t},a=function(e){void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a,onError:function(){i=!1}})}function r(t){var i={method:"post",url:rootPath+"/org/listAll"},o=function(e){void 0!=t&&"function"==typeof t&&t(e.data)};common.http({$http:e,httpOptions:i,success:o})}function s(t){var i={method:"post",url:rootPath+"/role/findAllRoles"},o=function(e){common.requestSuccess({vm:t,response:e,fn:function(){var i={check:{chkboxType:{Y:"ps",N:"ps"},enable:!0}},o=$linq(e.data).select(function(e){return{id:e.id,name:e.roleName}}).toArray(),n={id:"",name:"角色集合",children:o};$.fn.zTree.init($("#zTree"),i,n),t.isUpdate&&m(t)}})};common.http({vm:t,$http:e,httpOptions:i,success:o})}function l(t){var i={method:"post",url:rootPath+"/user/findUserById",params:{userId:t.id}},o=function(e){t.model=e.data,t.isUpdate&&s(t)};common.http({vm:t,$http:e,httpOptions:i,success:o})}function c(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/user/fingByOData",$("#usersform"),{filter:"loginName ne 'admin'"}),schema:common.kendoGridConfig().schema({id:"id"}),serverPaging:!1,serverSorting:!1,serverFiltering:!1,pageSize:10}),i=function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})},o=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox' />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"loginName",title:"登录名",width:100,filterable:!1},{field:"displayName",title:"显示名",width:100,filterable:!1},{field:"orgDto.name",title:"所属部门",width:100,filterable:!1},{field:"userIP",title:"登录IP",width:160,filterable:!1},{field:"lastLogin",title:"最后登录时间",width:160,filterable:!1},{field:"",title:"所属角色",width:160,filterable:!1,template:function(e){if(e.roleDtoList){for(var t="",i=0,o=e.roleDtoList.length;i<o;i++)t+=0==i?e.roleDtoList[i].roleName:", "+e.roleDtoList[i].roleName;return t}return" "}},{field:"",title:"在职情况",width:80,filterable:!1,template:function(e){return e.jobState&&"t"==e.jobState?"在职":"已撤销"}},{field:"",title:"操作",width:140,template:function(e){return common.format($("#columnBtns").html(),"vm.del('"+e.id+"')",e.id)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}function d(e){e.gridOptions.dataSource._skip=0,e.gridOptions.dataSource.read()}function u(){return $.fn.zTree.getZTreeObj("zTree").getCheckedNodes(!0)}function m(e){for(var t=$.fn.zTree.getZTreeObj("zTree"),i=$linq(e.model.roleDtoList).select(function(e){return e.roleName}).toArray(),o=t.getNodesByParam("level",1,null),n=$linq(o).where(function(e){return $linq(i).contains(e.name)}).toArray(),a=0,r=n.length;a<r;a++)t.checkNode(n[a],!0,!0)}var p=rootPath+"/user";rootPath,rootPath;return{grid:c,getUserById:l,initZtreeClient:s,createUser:a,deleteUser:n,updateUser:o,getOrg:r,queryUser:d,getZtreeChecked:u,resetPwd:i}}angular.module("app").factory("userSvc",e),e.$inject=["$http","bsWin"]}(),function(){"use strict";function e(e,t){var i=this;i.title="工作日列表",function(){t.grid(i)}(),i.addWorkDay=function(){$("#workDay").kendoWindow({width:"45%",height:"auto",title:"新增工作日",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},i.create=function(){common.initJqValidation($("#form")),$("#form").valid()&&t.createWorkday(i)},i.del=function(e){common.confirm({vm:i,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteWorkday(i,e)}})},i.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:i,msg:"请选择数据"});else{for(var t=[],o=0;o<e.length;o++)t.push(e[o].value);var n=t.join(",");i.del(n)}},i.queryWorkday=function(){t.queryWorkday(i)},i.ResetWorkday=function(){t.clearValue(i)}}angular.module("app").controller("workdayCtrl",e),e.$inject=["$location","workdaySvc"]}(),function(){"use strict";function e(e,t,i){function o(e){var t=$("#workdayForm").find("input,select");$.each(t,function(e,t){t.value=""}),e.gridOptions.dataSource.read()}function n(t){var i={method:"get",url:d+"/getWorkdayById",params:{id:t.id}},o=function(e){t.workday=e.data};common.http({vm:t,$http:e,httpOptions:i,success:o})}function a(e){e.gridOptions.dataSource.read()}function r(t){var o={method:"post",url:d+"/createWorkday",data:t.workday},n=function(e){console.log(e),e.data.flag?i.alert("保存成功！",function(){t.gridOptions.dataSource.read(),window.parent.$("#workDay").data("kendoWindow").close(),t.workday=""}):i.alert(e.data.reMsg+"已存在，不能重复添加！",function(){t.gridOptions.dataSource.read(),window.parent.$("#workDay").data("kendoWindow").close(),t.workday=""})};common.http({vm:t,$http:e,httpOptions:o,success:n})}function s(t){var i={method:"put",url:d,data:t.workday},o=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide"),$(".modal-backdrop").remove(),location.href=u}})}})};common.http({vm:t,$http:e,httpOptions:i,success:o})}function l(t,i){var o={method:"delete",url:d,data:i},n=function(e){t.gridOptions.dataSource.read()};common.http({vm:t,$http:e,httpOptions:o,success:n})}function c(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(d+"/findByOdataObj",$("#workdayForm")),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"},modifiedDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"dates",dir:"desc"}}),i=function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})},o=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"dates",title:"时间",width:200,format:"{0:yyyy-MM-dd}",filterable:!1},{field:"",title:"状态",width:100,filterable:!1,template:function(e){return e.status?"1"==e.status?"调休":"2"==e.status?"加班":void 0:""}},{field:"remark",title:"备注",width:140,filterable:!1},{field:"",title:"操作",width:140,template:function(e){return common.format($("#columnBtns").html(),"vm.del('"+e.id+"')",e.id)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}var d=rootPath+"/workday",u="#/workday";return{grid:c,createWorkday:r,getWorkdayById:n,updateWorkday:s,deleteWorkday:l,queryWorkday:a,clearValue:o}}angular.module("app").factory("workdaySvc",e),e.$inject=["$http","$state","bsWin"]}(),function(){"use strict";function e(e,t,i){var o=this;o.title="添加工作日",o.id=i.params.id,o.workday={},o.workday.status="1",o.id&&(o.isUpdate=!0,o.title="更新工作日"),function(){o.isUpdate&&t.getWorkdayById(o)}(),o.create=function(){t.createWorkday(o)},o.update=function(){t.updateWorkday(o)}}angular.module("app").controller("workdayEditCtrl",e),e.$inject=["$location","workdaySvc","$state"]}(),function(){"use strict";function e(e,t,i,o){var n=this;n.work={},n.title="项目基本信息",n.work.signId=i.params.signid,function(){t.initPage(n)}(),n.create=function(){t.createWP(n,!1)}}angular.module("app").controller("workprogramBaseEditCtrl",e),e.$inject=["$location","workprogramSvc","$state","$http"]}(),function(){"use strict";function e(e,t,i,o,n,a,r,s){var l=this;l.work={},l.model={},l.title="评审方案编辑",l.startDateTime=new Date("2006/6/1 08:00"),l.endDateTime=new Date("2030/6/1 21:00"),l.work.signId=t.params.signid,l.isControl=t.params.isControl,l.work.id="",l.sign={},l.unSeledWork={},l.searchSign={},l.businessFlag={isSelfReview:!1,isSingleReview:!0,isMainWorkProj:!1,isLoadMeetRoom:!1,isReveiwAWP:!1},l.expertList=new Array(15),function(){l.showAll=!0,l.isControl?e.workMaintainList(l):e.initPage(l),$("#wpTab li").click(function(e){var t=$("a",this);e.preventDefault(),t.tab("show");var i=t.attr("for-div");$(".tab-pane").removeClass("active").removeClass("in"),$("#"+i).addClass("active").addClass("in").show(500)})}(),l.initFileUpload=function(){l.work.id||n.$watch("vm.work.id",function(e,t){e&&e!=t&&!l.initUploadOptionSuccess&&l.initFileUpload()}),l.sysFile={businessId:l.work.id,mainId:l.work.signId,mainType:o.mainTypeValue().SIGN,sysfileType:o.mainTypeValue().WORKPROGRAM,sysBusiType:o.mainTypeValue().WORKPROGRAM},o.initUploadOptions({inputId:"sysfileinput",vm:l})},l.reviewTypeChange=function(){"自评"==l.work.reviewType&&(l.work.expertCost=""),"合并评审"==l.work.reviewType&&(l.work.isMainProject="9"),l.work.id&&e.findById(l.work.id,function(o){if(void 0!=o.expertCost&&""==l.work.expertCost&&(l.work.expertCost=o.expertCost),"合并评审"==o.isSigle&&"9"==o.isMainProject&&"单个评审"==l.work.isSigle)i.confirm({title:"询问提示",message:"该项目已关联其他项目，您确定要改为单个评审吗？",onOk:function(){e.deleteAllMerge(t.params.signid,l.work.id,function(e){e.flag||"ok"==e.reCode?i.alert("操作成功！",function(){l.work.isMainProject="0"}):i.error("操作失败！")})},onCancel:function(){l.work.isSigle="合并评审",l.work.isMainProject="9"}});else if("专家评审会"==o.reviewType&&"专家函评"==l.work.reviewType&&l.work.roomBookingDtos&&l.work.roomBookingDtos.length>0)i.confirm({title:"询问提示",message:"改成专家函评，预定会议室将会删除，确定修改么？",onOk:function(){e.updateReviewType(t.params.signid,l.work.id,l.work.reviewType,function(e){e.flag||"ok"==e.reCode?(l.work=e.reObj,l.work.signId=t.params.signid,i.alert("操作成功！")):i.error("操作失败！")})},onCancel:function(){l.work.reviewType=o.reviewType}});else if(("专家评审会"==o.reviewType||"专家函评"==o.reviewType)&&"自评"==l.work.reviewType){var n=!1;l.work.roomBookingDtos&&l.work.roomBookingDtos.length>0?n=!0:l.work.expertDtoList&&l.work.expertDtoList.length>0&&(n=!0),n&&i.confirm({title:"询问提示",message:"评审方式改成自评，预定会议室和抽取专家将会删除，确定修改么？",onOk:function(){e.updateReviewType(t.params.signid,l.work.id,l.work.reviewType,function(e){e.flag||"ok"==e.reCode?(l.work=e.reObj,l.work.signId=t.params.signid,i.alert("操作成功！")):i.error("操作失败！")})},onCancel:function(){l.work.reviewType=o.reviewType}})}})},l.onWorkClose=function(){window.parent.$(".workPro").data("kendoWindow").close()},l.formReset=function(){l.searchSign={}},l.filterSign=function(e){var t=!0;if(l.searchSign.projectname&&-1==e.projectname.indexOf(l.searchSign.projectname)&&(t=!1),t&&l.searchSign.reviewstage&&-1==e.reviewstage.indexOf(l.searchSign.reviewstage)&&(t=!1),t)return e},l.initMergeWP=function(){l.work.id?e.findById(l.work.id,function(t){"合并评审"==t.isSigle&&"9"==t.isMainProject?(e.initMergeInfo(l,l.work.signId),$("#mergeSign").kendoWindow({width:"75%",height:"700px",title:"合并评审",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()):i.alert("请先保存工作方案！")}):i.alert("请先保存工作方案！")},l.chooseSign=function(){var t=$("input[name='mergeSign']:checked");if(0==t.length)i.alert("请选择要合并评审的项目！");else{var o=[];$.each(t,function(e,t){o.push(t.value)}),e.chooseSign(l.work.signId,o.join(","),function(t){(t.flag||"ok"==t.reCode)&&e.initMergeInfo(l,l.work.signId),i.alert(t.reMsg)})}},l.cancelSign=function(){var t=$("input[name='cancelMergeSignid']:checked");if(0==t.length)i.alert("请选择要取消合并评审的项目！");else{var o=[];$.each(t,function(e,t){o.push(t.value)})}e.cancelMergeSign(l.work.signId,o.join(","),function(t){(t.flag||"ok"==t.reCode)&&e.initMergeInfo(l,l.work.signId),i.alert(t.reMsg)})},l.addTimeStage=function(){l.work.id?e.findById(l.work.id,function(e){"专家评审会"==e.reviewType?t.go("room",{businessId:l.work.id,businessType:"SIGN_WP"}):i.alert("请先保存工作方案！")}):i.alert("请先保存！")},l.findUsersByOrgId=function(t){e.findUsersByOrgId(l,t)},l.create=function(){common.initJqValidation($("#work_program_form")),$("#work_program_form").valid()?l.isTime?i.alert("结束时间必须大于开始时间！"):("全天"==l.work.studyQuantum?(l.work.studyBeginTime="",l.work.studyEndTime=""):($("#studyBeginTime").val()&&(l.work.studyBeginTimeStr=$("#studyBeginTime").val()),$("#studyEndTime").val()&&(l.work.studyEndTimeStr=$("#studyEndTime").val()),$("#studyAllDay").val()&&$("#studyBeginTime").val()&&(l.work.studyBeginTime=$("#studyAllDay").val()+" "+$("#studyBeginTime").val()+":00"),$("#studyAllDay").val()&&$("#studyEndTime").val()&&(l.work.studyEndTime=$("#studyAllDay").val()+" "+$("#studyEndTime").val()+":00")),e.createWP(l.work,!1,l.iscommit,function(e){e.flag||"ok"==e.reCode?(l.work.id=e.reObj.id,i.success("操作成功！")):i.error(e.reMsg)})):i.alert("操作失败，有红色*号的选项为必填项，请按要求填写！")},l.compare=function(){var e=parseInt(l.work.studyBeginTimeStr.split(":")[0]),t=parseInt(l.work.studyEndTimeStr.split(":")[0]);if(e==t){var i=parseInt(l.work.studyBeginTimeStr.split(":")[1]),o=parseInt(l.work.studyEndTimeStr.split(":")[1]);l.isTime=i>o}else l.isTime=e>t},l.selectExpert=function(){l.work.id?e.findById(l.work.id,function(e){"专家评审会"==e.reviewType||"专家函评"==e.reviewType?"专家评审会"!=l.work.reviewType||l.work.roomBookingDtos&&0!=l.work.roomBookingDtos.length?"专家函评"!=l.work.reviewType||e.letterDate?t.go("expertReviewEdit",{businessId:l.work.signId,minBusinessId:l.work.id,businessType:"SIGN",reviewType:l.work.reviewType}):i.alert("请先选择函评日期并保存！"):i.alert("请先预定评审会日期！"):i.alert("请先保存工作方案！")}):i.alert("请先保存当前信息，再继续操作！")},l.printpage=function(e){var t=$(e.target).attr("id");s.workProgramPrint(t)},l.createMaintain=function(){if(void 0!=l.assistant&&0!=l.assistant.length)for(var t=0;t<l.assistant.length;t++)e.createWP(l.assistant[t],!1,l.iscommit);l.work&&e.createWP(l.work,!1,l.iscommit,function(){i.alert("操作成功")})}}angular.module("app").controller("workprogramEditCtrl",e),e.$inject=["workprogramSvc","$state","bsWin","sysfileSvc","$scope","meetingSvc","roomSvc","signSvc"]}(),function(){"use strict";function e(e,t,i){function o(t,i,o,n){var a={signId:t,id:i,reviewType:o},r={method:"post",url:rootPath+"/workprogram/updateReviewType",data:a},s=function(e){void 0!=n&&"function"==typeof n&&n(e.data)};common.http({$http:e,httpOptions:r,success:s})}function n(t,i){var o={method:"post",url:rootPath+"/workprogram/initWorkProgramById",params:{workId:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function a(t,i){var o={method:"post",url:rootPath+"/signView/getMergeSignBySignId",params:{signId:t}},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function r(t,i){var o={method:"post",url:rootPath+"/signView/unMergeWPSign",params:{signId:t}},n=function(e){
void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function s(e,t){r(t,function(t){e.unMergeSign=[],e.unMergeSign=t}),a(t,function(t){e.mergeSign=[],e.mergeSign=t})}function l(t,i,o){var n={method:"post",url:rootPath+"/signView/cancelMergeSign",params:{signId:t,cancelIds:i,mergeType:"1"}},a=function(e){void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a})}function c(t,i,o){var n={method:"post",url:rootPath+"/signView/mergeSign",params:{signId:t,mergeIds:i,mergeType:"1"}},a=function(e){void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a})}function d(t,i,o){var n={method:"post",url:rootPath+"/signView/deleteAllMerge",params:{signId:t,mergeType:"1",businessId:i}},a=function(e){void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a})}function u(t){var i={method:"get",url:rootPath+"/room/meeting"},o=function(e){void 0!=t&&"function"==typeof t&&t(e.data)};common.http({$http:e,httpOptions:i,success:o})}function m(t){var i={method:"get",url:common.format(y+"/findCcompanys")},o=function(e){t.companys={},t.companys=e.data};common.http({vm:t,$http:e,httpOptions:i,success:o})}function p(t,i){var o={};"main"==i&&(o.orgId=t.work.reviewDept);var n={method:"get",url:rootPath+"/user/findUsersByOrgId",params:o},a=function(e){common.requestSuccess({vm:t,response:e,fn:function(){"main"==i&&(t.mainUserList={},t.mainUserList=e.data)}})};common.http({vm:t,$http:e,httpOptions:n,success:a})}function f(o){var n={method:"post",url:rootPath+"/workprogram/html/initWorkProgram",params:{signId:o.work.signId}},a=function(e){if(null!=e.data&&""!=e.data){if(o.work=e.data.eidtWP,o.work.reviewType||(o.work.reviewType="自评"),o.work.isSigle||(o.work.isSigle="单个评审"),o.work.expertDtoList&&o.work.expertDtoList.length>0&&((!o.work.expertCost||o.work.expertCost<1e3*o.work.expertDtoList.length)&&(o.work.expertCost=1e3*o.work.expertDtoList.length),o.work.expertDtoList))for(var n=o.work.expertDtoList,a=0;a<n.length;a++)if(n[a].expertTypeDtoList){for(var r=n[a].expertTypeDtoList,s="",l="",c=0;c<r.length;c++)l.indexOf(r[c].expertType)<0&&(c>0&&(l+="、"),l+=r[c].expertType),c>0&&(s+="、"),s+=r[c].maJorBig+"、"+r[c].maJorSmall;n[a].expertCategory=l,n[a].major=s}o.model.workProgramDtoList={},("9"==e.data.showTotalInvestment||9==e.data.showTotalInvestment||e.data.WPList&&e.data.WPList.length>0)&&(o.model.workProgramDtoList=e.data.WPList,o.showTotalInvestment=!0),"1"==o.work.branchId&&m(o),o.work.signId=t.params.signid,o.work.projectType&&(o.work.projectTypeDicts=i.topSelectChange(o.work.projectType,i.DICT.PROJECTTYPE.dicts)),"合并评审"!=o.work.isSigle||"0"!=o.work.isMainProject&&0!=o.work.isMainProject||(o.businessFlag.isReveiwAWP=!0),o.initFileUpload()}};common.http({vm:o,$http:e,httpOptions:n,success:a})}function h(o){var n={method:"post",url:rootPath+"/workprogram/html/workMaintainList",params:{signId:o.work.signId}},a=function(e){if(null!=e.data&&""!=e.data){if(o.work=e.data.eidtWP,console.log(o.work),o.assistant=e.data.WPList,o.work.reviewOrgName&&(o.reviewOrgName=o.work.reviewOrgName.split(","),o.work.orgName=o.reviewOrgName[0]),o.assistant&&o.assistant.length>0)for(var n=0;n<o.assistant.length;n++)o.assistant[n].orgName=o.reviewOrgName[o.assistant[n].branchId-1];o.work.reviewType||(o.work.reviewType="自评"),o.work.isSigle||(o.work.isSigle="单个评审"),o.work.expertDtoList&&o.work.expertDtoList.length>0&&(!o.work.expertCost||o.work.expertCost<1e3*o.work.expertDtoList.length)&&(o.work.expertCost=1e3*o.work.expertDtoList.length),o.model.workProgramDtoList={},("9"==e.data.showTotalInvestment||9==e.data.showTotalInvestment||e.data.WPList&&e.data.WPList.length>0)&&(o.model.workProgramDtoList=e.data.WPList,o.showTotalInvestment=!0),"1"==o.work.branchId&&m(o),o.work.signId=t.params.signid,o.work.projectType&&(o.work.projectTypeDicts=i.topSelectChange(o.work.projectType,i.DICT.PROJECTTYPE.dicts)),"合并评审"!=o.work.isSigle||"0"!=o.work.isMainProject&&0!=o.work.isMainProject||(o.businessFlag.isReveiwAWP=!0)}};common.http({vm:o,$http:e,httpOptions:n,success:a})}function g(t,i,o,n){o=!0;var a={method:"post",url:rootPath+"/workprogram/addWork",data:t,params:{isNeedWorkProgram:i}},r=function(e){void 0!=n&&"function"==typeof n&&n(e.data)};common.http({$http:e,httpOptions:a,success:r,onError:function(e){o=!1}})}function v(t,i){var o={method:"delete",url:rootPath+"/room",params:{id:t}},n=function(e){void 0!=i&&"function"==typeof i&&i()};common.http({$http:e,httpOptions:o,success:n})}var y=rootPath+"/company";return{initPage:f,createWP:g,findCompanys:m,findUsersByOrgId:p,deleteBookRoom:v,findAllMeeting:u,workMaintainList:h,initMergeInfo:s,getMergeSignBySignId:a,unMergeWPSign:r,chooseSign:c,cancelMergeSign:l,deleteAllMerge:d,findById:n,updateReviewType:o}}angular.module("app").factory("workprogramSvc",e),e.$inject=["$http","$state","$rootScope"]}(),function(){"use strict";function e(e,t){var i=this;i.title="固定资产申购流程",i.del=function(e){common.confirm({vm:i,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteAssertStorageBusiness(i,e)}})},i.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:i,msg:"请选择数据"});else{for(var t=[],o=0;o<e.length;o++)t.push(e[o].value);var n=t.join(",");i.del(n)}},function(){t.grid(i)}(),i.searchForm=function(){i.gridOptions.dataSource._skip=0,i.gridOptions.dataSource.read()},i.formReset=function(){i.searchModel={}}}angular.module("app").controller("assertStorageBusinessCtrl",e),e.$inject=["$location","assertStorageBusinessSvc"]}(),function(){"use strict";function e(e,t,i,o){function n(e){if(r.conditions.length>0){return r.conditions.forEach(function(e,t){e.goodsName=$("#goodsName"+e.sort).val(),e.specifications=$("#specifications"+e.sort).val(),e.models=$("#models"+e.sort).val(),e.orgCompany=$("#orgCompany"+e.sort).val(),e.evaluate=$("#evaluate"+e.sort).val(),e.goodsNumber=$("#goodsNumber"+e.sort).val(),e.applyDept=r.model.applyDept,e.operator=r.model.operator,e.businessId=$("#businessId").val()}),!0}return!1}function a(e){return!!(/^(\+|-)?\d+$/.test(e)&&e>0)}var r=this;r.model={},r.conMaxIndex=0,r.conditions=new Array,r.title="添加固定资产申购流程",r.isuserExist=!1,r.businessId=i.params.businessId,r.showFlag={addBooksDeatail:!0,modBooksDetail:!0,bookBuyApplyTr:!1,bookBuyBzTr:!0,bookBuyFgzrTr:!0,bookBuyZrTr:!0,bookBuyYsrk:!0},r.businessId&&(r.isUpdate=!0,r.showFlag.modBooksDetail=!0,r.showFlag.addBooksDeatail=!1,r.title="更新图书采购申请业务信息",$("#businessId").val(r.businessId)),r.create=function(){t.createAssertStorageBusiness(r)},r.update=function(){t.updateAssertStorageBusiness(r)},r.addCondition=function(){r.condition={},r.showFlag.addBooksDeatail?r.condition.sort=r.conMaxIndex+1:(r.conMaxIndex=r.conditions.length,r.condition.sort=r.conditions.length+1),r.conditions.push(r.condition),r.conMaxIndex++},r.removeCondition=function(){var e=$("#conditionTable input[name='epConditionSort']:checked");e.length>0?o.confirm({title:"询问提示",message:"删除数据不可恢复，确定删除么？",onOk:function(){$(".confirmDialog").modal("hide");for(var i=[],n=0;n<e.length;n++)$.each(r.conditions,function(t,o){e[n].value==o.sort&&(o.id?i.push(o.id):r.conditions.splice(t,1))});i.length>0?t.deleteSelConditions(i.join(","),r.isCommit,function(e){e.flag||"ok"==e.reCode?(o.success("操作成功！"),$.each(i,function(e,t){$.each(r.conditions,function(e,i){t==i.sort&&r.conditions.splice(e,1)})})):o.error(e.reMsg)}):o.success("操作成功！")}}):o.alert("请选择要删除的抽取条件！")},r.saveCondition=function(){n(!1)?t.saveGoodsDetailBusinessDetail(r.conditions,function(e){e.flag||"ok"==e.reCode?($("#businessId").val(e.reObj.businessId),o.success("保存成功！")):o.error(e.reMsg)}):o.error("请添加后再保存")},r.startFlow=function(){o.confirm({title:"询问提示",message:"发起流程后，当前页面数据将不能再修改！确认发起流程么？",onOk:function(){n(!1)?t.startFlow(r.conditions,r.isCommit,function(e){e.flag||"ok"==e.reCode?o.alert("保存成功！",function(){i.go("myAssertStorageBusiness")}):o.alert(e.reMsg)}):o.error("请添加图书信息后再发起流程！")}})},r.checkBookNum=function(e){var t="bookNumber"+e;if(!a($("#"+t).val()))return void $("span[data-valmsg-for='"+t+"']").html("图书数量只能输入正整数！");$("span[data-valmsg-for='"+t+"']").html("")},r.checkPrice=function(e){var t=/^(-)?(([1-9]{1}\d*)|([0]{1}))(\.(\d){1,4})?$/,i="booksPrice"+e,o="bookNumber"+e;if(!t.test($("#"+i).val()))return $("#"+i).val(""),void $("span[data-valmsg-for='"+i+"']").html("价格只能输入数字！");$("span[data-valmsg-for='"+i+"']").html("");var n=$("#"+i).val(),a=$("#"+o).val();$("#total"+e).val(parseFloat(n)*a)},function(){r.isUpdate&&t.getAssertStorageBusinessById(r)}()}angular.module("app").controller("assertStorageBusinessEditCtrl",e),e.$inject=["$location","assertStorageBusinessSvc","$state","bsWin"]}(),function(){"use strict";function e(e){function t(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0,t.model.id=t.id;var i={method:"put",url:c,data:t.model},o=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:t,$http:e,httpOptions:i,success:o})}}function i(t,i){t.isSubmit=!0;var o={method:"delete",url:c,data:i},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})}})};common.http({vm:t,$http:e,httpOptions:o,success:n})}function o(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0;var i={method:"post",url:c,data:t.model},o=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,location.href=d}})}})};common.http({vm:t,$http:e,httpOptions:i,success:o})}}function n(t,i){var o={method:"post",url:rootPath+"/assertStorageBusiness/saveGoodsDetailList",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(t)},n=function(e){void 0!=i&&"function"==typeof i&&i(e.data)};common.http({$http:e,httpOptions:o,success:n})}function a(t,i,o){i=!0;var n={method:"post",url:rootPath+"/assertStorageBusiness/startFlow",headers:{contentType:"application/json;charset=utf-8"},traditional:!0,dataType:"json",data:angular.toJson(t)},a=function(e){i=!1,void 0!=o&&"function"==typeof o&&o(e.data)};common.http({$http:e,httpOptions:n,success:a,onError:function(){i=!1}})}function r(t){var i={method:"get",url:rootPath+"/assertStorageBusiness/html/findById",params:{id:t.businessKey}},o=function(e){t.model=e.data};common.http({$http:e,httpOptions:i,success:o,onError:function(){}})}function s(t){var i={method:"get",url:rootPath+"/assertStorageBusiness/html/findById",params:{id:t.businessId}},o=function(e){t.model=e.data};common.http({vm:t,$http:e,httpOptions:i,success:o})}function l(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(rootPath+"/assertStorageBusiness/findByOData",$("#myTopicForm"),{filter:"createdBy eq ${CURRENT_USER.id}"}),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=function(){var e=this.items(),t=this.pager.page()-1,i=this.pager.pageSize();$(e).each(function(){var e=$(this).index()+1+t*i,o=$(this).find(".row-number");$(o).html(e)})},o=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"rowNumber",title:"序号",width:50,filterable:!1,template:"<span class='row-number'></span>"},{field:"businessName",title:"业务流程名称",width:"20%",filterable:!1},{field:"createdDate",title:"创建日期",width:"15%",filterable:!1,format:"{0:yyyy/MM/dd HH:mm:ss}"},{field:"",title:"已发起流程",width:"15%",filterable:!1,template:function(e){return e.processInstanceId?"是":"否"}},{field:"",title:"操作",width:140,template:function(e){var t=!!e.processInstanceId;return common.format($("#columnBtns").html(),e.businessId,t)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:o,dataBound:i,resizable:!0}}var c=rootPath+"/assertStorageBusiness",d="#/assertStorageBusinessList";return{grid:l,getAssertStorageBusinessById:s,createAssertStorageBusiness:o,deleteAssertStorageBusiness:i,updateAssertStorageBusiness:t,saveGoodsDetailBusinessDetail:n,startFlow:a,initFlowDeal:r}}angular.module("app").factory("assertStorageBusinessSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t){var i=this;i.title="物品明细",i.del=function(e){common.confirm({vm:i,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteGoodsDetail(i,e)}})},i.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:i,msg:"请选择数据"});else{for(var t=[],o=0;o<e.length;o++)t.push(e[o].value);var n=t.join(",");i.del(n)}},function(){t.grid(i)}()}angular.module("app").controller("goodsDetailCtrl",e),e.$inject=["$location","goodsDetailSvc"]}(),function(){"use strict";function e(e,t,i){var o=this;o.title="添加物品明细",o.isuserExist=!1,o.id=i.params.id,o.id&&(o.isUpdate=!0,o.title="更新物品明细"),o.create=function(){t.createGoodsDetail(o)},o.update=function(){t.updateGoodsDetail(o)},function(){o.isUpdate&&t.getGoodsDetailById(o)}()}angular.module("app").controller("goodsDetailEditCtrl",e),e.$inject=["$location","goodsDetailSvc","$state"]}(),function(){"use strict";function e(e){function t(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0,t.model.id=t.id;var i={method:"put",url:s,data:t.model},o=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:t,$http:e,httpOptions:i,success:o})}}function i(t,i){t.isSubmit=!0;var o={method:"delete",url:s,data:i},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})}})};common.http({vm:t,$http:e,httpOptions:o,success:n})}function o(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0;var i={method:"post",url:s,data:t.model},o=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,location.href=l}})}})};common.http({vm:t,$http:e,httpOptions:i,success:o})}}function n(t){var i={method:"get",url:rootPath+"/goodsDetail/html/findById",params:{id:t.id}},o=function(e){t.model=e.data};common.http({vm:t,$http:e,httpOptions:i,success:o})}function a(t){var i={method:"get",url:rootPath+"/bookBuyBusiness/html/findById"},o=function(e){void 0!=t&&"function"==typeof t&&t(e.data)};common.http({vm:vm,$http:e,httpOptions:i,success:o})}function r(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(s),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"id",title:"id",width:100,filterable:!0},{field:"goodsCode",title:"goodsCode",width:100,filterable:!0},{field:"goodsName",title:"goodsName",width:100,filterable:!0},{field:"specifications",title:"specifications",width:100,filterable:!0},{field:"models",title:"models",width:100,filterable:!0},{field:"goodsPrice",title:"goodsPrice",width:100,filterable:!0},{field:"evaluate",title:"evaluate",width:100,filterable:!0},{field:"goodsNumber",title:"goodsNumber",width:100,filterable:!0},{field:"assertStorageBusiness",title:"assertStorageBusiness",width:100,filterable:!0},{field:"",title:"操作",width:140,template:function(e){return common.format($("#columnBtns").html(),"vm.del('"+e.id+"')",e.id)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0}}var s=rootPath+"/goodsDetail",l="#/goodsDetailList";return{grid:r,getGoodsDetailById:n,createGoodsDetail:o,deleteGoodsDetail:i,updateGoodsDetail:t,getAllStoreAssert:a}}angular.module("app").factory("goodsDetailSvc",e),e.$inject=["$http"]}(),function(){"use strict";function e(e,t,i){var o=this;o.model={},o.conMaxIndex=0,o.conditions=new Array,o.title="添加用户资产明细",o.isuserExist=!1,o.id=i.params.id,o.id&&(o.isUpdate=!0,o.title="更新用户资产明细"),o.create=function(){t.createUserAssertDetail(o)},o.update=function(){t.updateUserAssertDetail(o)},o.addCondition=function(){o.condition={},o.condition.sort=o.conMaxIndex+1,o.conditions.push(o.condition),o.conMaxIndex++},function(){o.isUpdate?t.getUserAssertDetailById(o):t.initFillData(function(e){o.goodsDetailDtoList=e.reObj.goodsDetailDtoList})}()}angular.module("app").controller("userAssertDetailAddCtrl",e),e.$inject=["$location","userAssertDetailSvc","$state"]}(),function(){"use strict";function e(e,t){var i=this;i.title="用户资产明细",i.del=function(e){common.confirm({vm:i,title:"",msg:"确认删除数据吗？",fn:function(){$(".confirmDialog").modal("hide"),t.deleteUserAssertDetail(i,e)}})},i.dels=function(){var e=common.getKendoCheckId(".grid");if(0==e.length)common.alert({vm:i,msg:"请选择数据"});else{for(var t=[],o=0;o<e.length;o++)t.push(e[o].value);var n=t.join(",");i.del(n)}},function(){t.grid(i)}()}angular.module("app").controller("userAssertDetailCtrl",e),e.$inject=["$location","userAssertDetailSvc"]}(),function(){"use strict";function e(e){function t(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0,t.model.id=t.id;var i={method:"put",url:s,data:t.model},o=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",fn:function(){t.isSubmit=!1,$(".alertDialog").modal("hide")}})}})};common.http({vm:t,$http:e,httpOptions:i,success:o})}}function i(t,i){t.isSubmit=!0;var o={method:"delete",url:s,data:i},n=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,t.gridOptions.dataSource.read()}})}})};common.http({vm:t,$http:e,httpOptions:o,success:n})}function o(t){if(common.initJqValidation(),$("form").valid()){t.isSubmit=!0;var i={method:"post",url:s,data:t.model},o=function(e){common.requestSuccess({vm:t,response:e,fn:function(){common.alert({vm:t,msg:"操作成功",closeDialog:!0,fn:function(){t.isSubmit=!1,location.href=l}})}})};common.http({vm:t,$http:e,httpOptions:i,success:o})}}function n(t){var i={method:"get",url:rootPath+"/userAssertDetail/html/findById",params:{id:t.id}},o=function(e){t.model=e.data};common.http({vm:t,$http:e,httpOptions:i,success:o})}function a(t){var i={method:"post",url:rootPath+"/userAssertDetail/html/initFillPageData"},o=function(e){void 0!=t&&"function"==typeof t&&t(e.data)};common.http({$http:e,httpOptions:i,success:o})}function r(e){var t=new kendo.data.DataSource({type:"odata",transport:common.kendoGridConfig().transport(s),schema:common.kendoGridConfig().schema({id:"id",fields:{createdDate:{type:"date"}}}),serverPaging:!0,serverSorting:!0,serverFiltering:!0,pageSize:10,sort:{field:"createdDate",dir:"desc"}}),i=[{template:function(e){return kendo.format("<input type='checkbox'  relId='{0}' name='checkbox' class='checkbox' />",e.id)},filterable:!1,width:40,title:"<input id='checkboxAll' type='checkbox'  class='checkbox'  />"},{field:"id",title:"id",width:100,filterable:!0},{field:"userId",title:"userId",width:100,filterable:!0},{field:"userName",title:"userName",width:100,filterable:!0},{field:"goodId",title:"goodId",width:100,filterable:!0},{field:"goodsName",title:"goodsName",width:100,filterable:!0},{field:"goodsNumber",title:"goodsNumber",width:100,filterable:!0},{field:"",title:"操作",width:140,template:function(e){return common.format($("#columnBtns").html(),"vm.del('"+e.id+"')",e.id)}}];e.gridOptions={dataSource:common.gridDataSource(t),filterable:common.kendoGridConfig().filterable,pageable:common.kendoGridConfig().pageable,noRecords:common.kendoGridConfig().noRecordMessage,columns:i,resizable:!0}}var s=rootPath+"/userAssertDetail",l="#/userAssertDetailList";return{grid:r,getUserAssertDetailById:n,createUserAssertDetail:o,deleteUserAssertDetail:i,updateUserAssertDetail:t,initFillData:a}}angular.module("app").factory("userAssertDetailSvc",e),e.$inject=["$http"]}();