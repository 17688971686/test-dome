!function(){"use strict";function t(t,e,i,n,r){var o=$("#topMenuBox"),a=$("#leftMenuBox");t.$on("$stateChangeStart",function(t,e,i,n,r){t&&$(".uploadify").each(function(){$(this).uploadify("destroy")})}),t.$on("$stateChangeSuccess",function(e,i,n,r,o){t.previousState_name=r.name,t.previousState_params=o}),t.backPrevPage=function(i){i=i||"welcome",e.go(t.previousState_name||i,t.previousState_params)},t.csHide=function(e){e&&e!=t.menuBoxResId&&($("#menu_"+e).length>0?t.menuBoxResId=e:t.menuBoxResId="pm")},r.initMenus(t,function(e,i){t.menuBoxResId||(t.menuBoxResId="pm"),o.append(n(e)(t)),a.append(n(i)(t))}),r.initDicts(t)}function e(t,e,i){e.parentSelector="#loading-bar-container",e.spinnerTemplate='<div style="position:fixed;width:100%;height:100%;left:0;top:0; z-index:99;background:rgba(0, 0, 0, 0.3);overflow: hidden;"><div style="position: absolute;top:30%; width: 400px;height:40px;left:50%;"><i class="fa fa-spinner fa-pulse fa-1x fa-fw"></i>程序处理中...</div></div>',t.otherwise("/welcome"),i.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|javascript):/)}function i(t){t.$on("$viewContentLoaded",function(t){jQuery.AdminLTE.layout&&(jQuery.AdminLTE.layout.fix(),jQuery.AdminLTE.layout.fixSidebar())})}angular.module("myApp",["ui.router","angular-loading-bar","bsTable","sn.common"]).config(e).run(i).controller("indexCtrl",t),t.$inject=["$scope","$state","$http","$compile","snBaseUtils"],e.$inject=["$urlRouterProvider","cfpLoadingBarProvider","$compileProvider"],i.$inject=["$rootScope"];var n=$('<div><i class="fa fa-chevron-up"></i></div>').css({position:"fixed",bottom:"20px",right:"25px",width:"40px",height:"40px",color:"#eee","font-size":"","line-height":"40px","text-align":"center","background-color":"#222d32",cursor:"pointer","border-radius":"5px","z-index":"99999",opacity:".7",display:"none"}).on({mouseenter:function(){n.css("opacity","1")},mouseout:function(){n.css("opacity",".7")},click:function(){$("html,body").animate({scrollTop:top},500)}});$(".wrapper").append(n),$(window).scroll(function(){$(window).scrollTop()>=150?n.is(":visible")||n.fadeIn(500):n.fadeOut(500)})}(),function(){"use strict";angular.module("myApp").config(function(t){t.state("operatorLog",{url:"/operatorLog",controllerAs:"vm",templateUrl:util.formatUrl("sys/operatorLog/html/list"),controller:function(t,e,i){t.csHide("bm");var n=this;n.model={},n.delLog=function(t){e.deleteLog(n,t)},e.bsTableControl(t)}})})}(),function(){"use strict";angular.module("myApp").factory("operatorLogSvc",function(t,e){var i=util.formatUrl("sys/operatorLog");return{bsTableControl:function(t){t.bsTableControl={options:util.getTableFilterOption({url:i,columns:[{title:"行号",switchable:!1,width:50,align:"left",formatter:function(e,i,n){var r=t.bsTableControl.state;return r.pageNumber&&r.pageSize?n+1+(r.pageNumber-1)*r.pageSize:n+1}},{field:"createdDate",title:"操作时间",width:160,sortable:!0,filterControl:"datepicker",filterOperator:"lte"},{field:"createdBy",title:"操作人",width:100,sortable:!0,filterControl:"input",filterOperator:"like"},{field:"operateName",title:"操作名",width:150,sortable:!0,filterControl:"input",filterOperator:"like"},{field:"operateUri",title:"请求链接",width:150,sortable:!0,filterControl:"input",filterOperator:"like"},{field:"operateMethod",title:"请求方式",width:80,sortable:!0,filterControl:"input",filterOperator:"like"},{field:"operateTime",title:"耗时（毫秒）",width:100,sortable:!0,align:"right",filterControl:"number"},{field:"ipAddress",title:"IP地址",width:100,align:"center",filterControl:"input",filterOperator:"like"},{field:"clientType",title:"客户端类型",width:100,sortable:!0,filterControl:"input",filterOperator:"like"},{field:"operateType",title:"状态",width:60,filterControl:"input",filterOperator:"like",formatter:"<span ng-show='row.operateType==1' class='bg-green'>成功</span><span ng-show='row.operateType!=1' class='bg-red'>失败</span>"},{field:"message",title:"结果消息",width:200,filterControl:"input",filterOperator:"like"}]})}},getOperatorLogList:function(e,n){t.get(i,{params:n}).success(function(t){e.operatorLogList=t||{}})},deleteLog:function(n,r){n.isSubmit=!0,t.delete(i,{params:{days:r||""}}).then(function(){e.alert("删除成功"),n.isSubmit=!1,$("#editTable").bootstrapTable("refresh","")})}}})}(),function(){"use strict";angular.module("myApp").config(function(t){t.state("dict",{url:"/dict",controllerAs:"vm",templateUrl:util.formatUrl("sys/dict/html/list"),controller:function(t,e,i){t.csHide("bm");var n=this;n.dict={},n.dels=function(){var t=n.dictsTree.getSelectedNodes();t&&t.length>0?n.del(t[0].dictId):i.confirm("请选择数据")},n.del=function(t){n.dict.dictId=t,i.confirm("删除字典将会连下级字典一起删除，确认删除数据吗？",function(){e.deleteDict(n)})},n.resetDict=function(){i.confirm("您确定要重置数据字典吗？",function(){e.resetDict(n)})},e.initDictTree(n)}})})}(),function(){"use strict";angular.module("myApp").config(function(t){t.state("dict.edit",{url:"/dictEdit/:dictId",controllerAs:"vm",templateUrl:util.formatUrl("sys/dict/html/edit"),controller:function(t,e,i){t.csHide("bm");var n=this;n.dict={},n.dictId=i.params.dictId,n.dictId&&(n.isUpdate=!0),n.isUpdate?e.findDictById(n):e.initpZtreeClient(n),n.create=function(){if(n.dictsTree){var t=n.dictsTree.getCheckedNodes(!0);t&&0!=t.length&&(n.dict.parentId=t[0].dictId)}e.createDict(n)},n.update=function(){e.updateDict(n)},n.dictTypeChange=function(){n.dict.dictType&&(n.dict.dictKey="")}}})})}(),function(){"use strict";angular.module("myApp").factory("dictSvc",function(t,e,i){function n(e){e.dictsTree&&e.dictsTree.destroy(),t.get(r+"?$orderby=itemOrder asc").success(function(t){function n(t,e,n){i.go("dict.edit",{dictId:n.dictId})}e.dictsTree=$.fn.zTree.init($("#zTree"),{callback:{onClick:n},data:{key:{name:"dictName"},simpleData:{enable:!0,idKey:"dictId",pIdKey:"parentId",rootPId:0}}},t||[]),window.fuzzySearch("zTree","#dictTreeKey",null,!0)})}var r=util.formatUrl("sys/dict");return{initDictTree:n,initpZtreeClient:function(e){e.dictsTree&&e.dictsTree.destroy(),t.get(r+"?$orderby=itemOrder asc").success(function(t){var i={check:{enable:!0,chkStyle:"radio",radioType:"all"},data:{key:{name:"dictName"},simpleData:{enable:!0,idKey:"dictId",pIdKey:"parentId",rootPId:0}}};e.dictsTree=$.fn.zTree.init($("#pzTree"),i,t||[])})},createDict:function(i){util.initJqValidation(),$("form").valid()&&(i.isSubmit=!0,t.post(r,i.dict).then(function(){e.success("创建成功"),i.isSubmit=!1,n(i)},function(){i.isSubmit=!1}))},findDictById:function(e){if(!e.dictId)return!1;t.get(r+"/"+e.dictId).success(function(t){e.dict=t})},updateDict:function(i){util.initJqValidation(),$("form").valid()&&(i.isSubmit=!0,t.put(r,i.dict).then(function(){e.success("更新成功"),i.isSubmit=!1,n(i)},function(){i.isSubmit=!1}))},deleteDict:function(i){i.isSubmit=!0,t.delete(r,{params:{dictId:i.dict.dictId||""}}).then(function(){e.success("删除成功"),i.isSubmit=!1,n(i)},function(){i.isSubmit=!1})},resetDict:function(i){i.isSubmit=!0,t.post(r+"/reset",{}).then(function(){e.success("操作成功"),i.isSubmit=!1,n(i)},function(){i.isSubmit=!1})}}})}(),function(){"use strict";angular.module("myApp").config(function(t){t.state("resource",{url:"/resource",controllerAs:"vm",templateUrl:util.formatUrl("sys/resource/html/list"),controller:function(t,e,i){function n(i){if(i)t.isUpdate=!0,t.editTitle="编辑系统资源",t.model||(t.model={}),t.resId=i,e.findResourceById(t,function(e){t.parentId=e.parentId;var i=a.getNodeByParam("resId",e.parentId);i&&a.checkNode(i,!0,!0)});else{t.model={status:1},t.isUpdate=!1,t.editTitle="新增系统资源";for(var n=a.getCheckedNodes(!0),r=0,o=n.length;r<o;r++)a.checkNode(n[r],!1,!0)}}function r(){o&&o.destroy(),a&&a.destroy(),e.getResourceData(t,function(i){i=i.value||[];var l={treeId:"resId",data:{key:{name:"resName"},simpleData:{enable:!0,idKey:"resId",pIdKey:"parentId"}}};if(o=$.fn.zTree.init($("#resourceTree"),$.extend({edit:{enable:!0,removeTitle:"删除资源",showRemoveBtn:function(t,e){return!e.isParent},showRenameBtn:!1},callback:{onClick:function(e,i,r){t.$apply(function(){n(r.resId)})},beforeRemove:function(i,o){return t.$apply(function(){t.resId=o.resId,e.deleteResource(t,function(){t.resId=null,t.parentId=null,n(),r()})}),!1},beforeDrag:function(){return!1}}},l),i),t.parentId){var s=o.getNodeByParam("resId",t.parentId);o.expandNode(s,!0,!1,!0)}a=$.fn.zTree.init($("#parentResourceTree"),$.extend({check:{enable:!0,chkStyle:"radio"}},l),i),window.fuzzySearch("resourceTree","#resourceKey",null,!0)})}t.csHide("bm"),t.editTitle="新增系统资源",t.model={status:1},t.isUpdate=!1,t.isSubmit=!1,t.createResource=n,t.createSave=function(){var i=a.getCheckedNodes(!0);i.length>0&&(t.model.parentId=i[0].resId),e.createResource(t,function(){r()})},t.updateSave=function(){if(util.initJqValidation(),$("form").valid()){var i=a.getCheckedNodes(!0);i.length>0&&(t.model.parentId=i[0].resId),e.updateResource(t,function(){r()})}},t.resetResource=function(){e.resetResource(t,function(){r()})};var o,a;r()}})})}(),function(){"use strict";angular.module("myApp").factory("resourceSvc",function(t,e){var i=util.formatUrl("sys/resource");return{getResourceData:function(e,n){t.get(i+"?$orderby=itemOrder asc").success(function(t){e.resources=t,n&&n(t)})},findResourceById:function(e,n){t.get(i+"/"+(e.resId||"")).success(function(t){e.model=t,n&&n(t)})},createResource:function(n,r){util.initJqValidation(),$("form").valid()&&(n.isSubmit=!0,t.post(i,n.model).then(function(){n.isSubmit=!1,e.alert("创建成功"),r&&r()},function(){n.isSubmit=!1}))},updateResource:function(n,r){util.initJqValidation(),$("form").valid()&&(n.isSubmit=!0,t.put(i,n.model).then(function(){n.isSubmit=!1,e.alert("更新成功"),r&&r()},function(){n.isSubmit=!1}))},deleteResource:function(n,r){n.isSubmit=!0,t.delete(i,{data:n.resId||""}).then(function(){e.alert("删除成功"),n.isSubmit=!1,r&&r()},function(){n.isSubmit=!1})},resetResource:function(n,r){n.isSubmit=!0,t.post(i+"/reset").then(function(){n.isSubmit=!1,e.alert("系统资源已成功重置"),r&&r()},function(){n.isSubmit=!1})}}})}(),function(){"use strict";angular.module("myApp").config(function(t){t.state("role",{url:"/role",controllerAs:"vm",templateUrl:util.formatUrl("sys/role/html/list"),controller:function(t,e,i,n){function r(n){function r(){a.checkAllNodes(!1),o.roleId=n.roleId,e.findRoleById(o,function(t){$.each(t.resources,function(t,e){a.checkNode(a.getNodeByParam("resId",e.resId),!0,!0)})})}a?r():i.getResourceData(t,function(t){t=t.value||[],a=$.fn.zTree.init($("#resourceTree"),{treeId:"resId",check:{enable:!0,chkboxType:{Y:"p",N:"s"}},data:{key:{name:"resName"},simpleData:{enable:!0,idKey:"resId",pIdKey:"parentId"}}},t),r()})}t.csHide("bm");var o=this;o.role={},o.del=function(t){n.confirm("确认删除数据吗？",function(){o.roleId=t,e.deleteById(o)})},o.dels=function(){var t=$("#editTable").bootstrapTable("getSelections");if(0==t.length)return void n.warning("请选择要删除的数据");var e=[];$.each(t,function(t,i){e.push(i.roleId)}),o.del(e.join(","))},o.authorization=function(t){o.roleId=t.roleId,o.displayName=t.displayName,r(t),$("#roleAuthorizationWin").modal("show")},o.toAuthorization=function(){a&&(o.resources=a.getCheckedNodes(!0),e.authorization(o))},o.start=function(t){e.stateEnable(t,o)},o.stop=function(t){e.stateDisable(t,o)};var a;e.bsTableControl(o)}})})}(),function(){"use strict";function t(t){t.state("roleEdit",{url:"/roleEdit/:id",controllerAs:"vm",templateUrl:util.formatUrl("sys/role/html/edit"),controller:e})}function e(t,e,i){var n=this;n.roleId=e.params.id,n.role={roleState:"1"},n.roleId&&i.findRoleById(n),n.save=function(){n.roleId?i.update(n):i.create(n)}}angular.module("myApp").config(t),t.$inject=["$stateProvider"],e.$inject=["$scope","$state","roleSvc"]}(),function(){"use strict";angular.module("myApp").factory("roleSvc",function(t,e,i){var n=util.formatUrl("sys/role");return{bsTableControl:function(t){t.bsTableControl={options:util.getTableFilterOption({url:n,columns:[{title:"行号",width:50,switchable:!1,formatter:function(e,i,n){var r=t.bsTableControl.state;return r.pageNumber&&r.pageSize?n+1+(r.pageNumber-1)*r.pageSize:n+1}},{checkbox:!0},{field:"roleName",title:"角色名",sortable:!0,filterControl:"input",filterOperator:"like"},{field:"displayName",title:"角色显示名",sortable:!1,filterControl:"input",filterOperator:"like"},{field:"roleState",title:"状态",width:100,align:"center",filterControl:"input",filterOperator:"like",formatter:'<span class="bg-green" ng-if="row.roleState == 1">启用</span><span class="bg-red" ng-if="row.roleState != 1">禁用</span>'},{title:"操作",width:350,align:"center",formatter:$("#columnBtns").html()}]})}},create:function(r){util.initJqValidation(),$("form").valid()&&(r.isSubmit=!0,t.post(n,r.role).then(function(){r.isSubmit=!1,e.success("创建成功",function(){i.go("role")})},function(){r.isSubmit=!1}))},findRoleById:function(e,i){t.get(n+"/"+(e.roleId||"")).success(function(t){i?i(t):e.role=t})},update:function(i){util.initJqValidation(),$("form").valid()&&(i.isSubmit=!0,t.put(n,i.role).then(function(){i.isSubmit=!1,e.success("更新成功")},function(){i.isSubmit=!1}))},deleteById:function(i){i.isSubmit=!0,t.delete(n,{params:{roleId:i.roleId||""}}).then(function(){i.isSubmit=!1,e.success("删除成功"),i.bsTableControl.refresh()},function(){i.isSubmit=!1})},authorization:function(i){if(!i.roleId)return void e.warning("缺少参数");i.isSubmit=!0,t.put(n+"/authorization?roleId="+i.roleId,i.resources).then(function(){i.isSubmit=!1,e.success("权限更新成功")},function(){i.isSubmit=!1})},stateEnable:function(i,r){t.put(n+"/enable?id="+i).then(function(){r.isSubmit=!1,e.success("状态已启用"),r.bsTableControl.refresh()},function(){r.isSubmit=!1})},stateDisable:function(i,r){t.put(n+"/disable?id="+i).then(function(){r.isSubmit=!1,e.success("状态已停用"),r.bsTableControl.refresh()},function(){r.isSubmit=!1})},findRoles:function(e,i,r){angular.isFunction(i)?(r=i,i=""):i=i||"",t.get(n,{params:i}).success(function(t){r?r(t):e.roles=t})},findUserRoles:function(e,i,r){angular.isFunction(i)?(r=i,i=""):i=i||"",t.get(n+"/userRoles",{params:{userId:i}}).success(function(t){r?r(t):e.roles=t})}}})}(),function(){"use strict";angular.module("myApp").config(function(t){var e=util.formatUrl("admin/userInfo");t.state("userInfo",{url:"/userInfo",controllerAs:"vm",templateUrl:e,controller:function(t,i,n){var r=this;r.isSubmit=!1,r.toUpdate=function(){if(util.initJqValidation(),$("form").valid()){var t=new JSEncrypt;i.get(util.formatUrl("rsaKey")).success(function(o){t.setPublicKey(o||""),r.model.oldPassword&&(r.model.oldPassword=t.encrypt(r.model.oldPassword),r.model.newPassword=t.encrypt(r.model.newPassword),r.model.verifyPassword=t.encrypt(r.model.verifyPassword)),r.isSubmit=!0,i.put(e,r.model).then(function(){r.isSubmit=!1,n.success("修改成功")},function(){r.isSubmit=!1})})}}}})})}(),function(){"use strict";function t(t){t.state("welcome",{url:"/welcome",templateUrl:util.formatUrl("admin/welcome"),controllerAs:"vm",controller:e})}function e(t,e){var i=this;i.getOperatorLogList=function(){e.getOperatorLogList(i,{$orderby:"createdDate desc",$top:5})}}angular.module("myApp").config(t),t.$inject=["$stateProvider"],e.$inject=["$scope","operatorLogSvc"]}(),function(){"use strict";angular.module("myApp").factory("welcomeSvc",function(t,e){util.formatUrl("admin");return{}})}(),function(){"use strict";function t(t){t.state("user",{url:"/user",controllerAs:"vm",templateUrl:util.formatUrl("sys/user/html/list"),controller:e})}function e(t,e,i,n,r){function o(t){l.organName=t.oldname||t.organName||"-",l.organId=t.organId,s.value="|"+t.organId+"|",e.reloadBsTable(l,s)}function a(){u&&u.destroy(),i.getOrganList(l,function(e){u=$.fn.zTree.init($("#organTree"),{treeId:"organId",data:{key:{name:"organName"},simpleData:{enable:!0,idKey:"organId",pIdKey:"parentId"}},callback:{onClick:function(e,i,n){t.$apply(function(){o(n)})}}},e);var i=u.getNodeByParam("parentId",null);u.expandNode(i,!0),o(i),window.fuzzySearch("organTree","#organKey",null,!0)})}t.csHide("bm");var l=this,s={field:"organ.organRel",operator:"like",value:"|"};e.bsTableControl(l,s),l.resetPwd=function(t){l.userId=t,e.resetPwd(l)},l.del=function(t){l.userId=t,r.confirm("确认删除数据吗？",function(){e.deleteUser(l)})},l.dels=function(){var t=l.bsTableControl.getSelections();if(0==t.length)return void r.warning("请选择要删除的数据");var e=[];$.each(t,function(t,i){e.push(i.userId)}),l.del(e.join(","))},l.start=function(t){l.userId=t.userId,e.enableUser(l)},l.stop=function(t){l.userId=t.userId,e.disableUser(l)};var u;a(),l.initOrganTree=a,l.openUserEditWin=function(t){c.modal("show"),t?(l.isUpdate=!0,l.userId=t,e.findUserById(l,function(t){l.model=t})):(l.isUpdate=!1,l.model={useState:1,organ:{organId:l.organId}})};var c=$("#organUserEditModel").on("hidden.bs.modal",function(e){t.$apply(function(){l.model=null})});l.saveUser=function(){l.isUpdate?e.updateUser(l,function(){c.modal("hide"),$("#editTable").bootstrapTable("refresh")}):e.createUser(l,function(){c.modal("hide"),$("#editTable").bootstrapTable("refresh")})};var d=$("#userRolesModel");l.setRoles=function(t){l.userId=t.userId,d.modal("show"),n.findUserRoles(l,l.userId,function(t){l.roles=t||[]})},l.toSetRoles=function(){var t=[];d.find("input[name='roleId']:checked").each(function(e,i){this.disabled||t.push(this.value)}),e.toSetRoles(l,t.join(","))}}angular.module("myApp").config(t),t.$inject=["$stateProvider"],e.$inject=["$scope","userSvc","organSvc","roleSvc","bsWin"]}(),function(){"use strict";angular.module("myApp").config(function(t,e){t.state("userEdit",{url:"/userEdit/:id",controllerAs:"vm",templateUrl:util.formatUrl("sys/user/html/edit"),controller:function(t,e,i){t.csHide("基础管理");var n=this;n.userId=i.params.id,n.isUpdate=!1,n.userId?(n.isUpdate=!0,e.findUserById(n)):n.model={useState:1},n.save=function(){n.isUpdate?e.updateUser(n):e.createUser(n,function(){i.go("user")})}}})})}(),function(){"use strict";function t(t,e){var i=util.formatUrl("sys/user"),n=util.formatUrl("rsaKey");return{reloadBsTable:function(t,e){var n=t.bsTableControl.options;n.url=i,e&&(n.defaultFilters=e)},bsTableControl:function(t,e){t.bsTableControl={options:util.getTableFilterOption({defaultFilters:e,defaultSort:"itemOrder asc,createdDate desc",columns:[{title:"行号",switchable:!1,width:50,formatter:function(e,i,n){var r=t.bsTableControl.state;return r.pageNumber&&r.pageSize?n+1+(r.pageNumber-1)*r.pageSize:n+1}},{checkbox:!0},{field:"username",title:"用户名",sortable:!0,width:150,filterControl:"input",filterOperator:"like"},{field:"displayName",title:"姓名",width:150,sortable:!0,filterControl:"input",filterOperator:"like"},{field:"organ.organName",title:"所属机构",sortable:!1,width:200,filterControl:"input",filterOperator:"like"},{field:"useState",title:"状态",width:100,align:"center",filterControl:"input",filterOperator:"like",formatter:'<span ng-if="row.useState == 1" class="bg-green">启用</span><span ng-if="row.useState != 1"  class="bg-red">禁用</span>'},{field:"lastLoginDate",title:"最后登录时间",width:160,sortable:!0,filterControl:"datepicker",filterOperator:"gt"},{field:"remark",title:"备注",filterControl:"input",filterOperator:"like"},{field:"",title:"操作",width:200,formatter:$("#userColumnBtns").html()}]})}},createUser:function(r,o){function a(){t.post(i,r.model).then(function(){r.isSubmit=!1,e.success("创建成功"),o&&o()},function(){r.isSubmit=!1})}util.initJqValidation(),$("form").valid()&&(r.isSubmit=!0,r.model.password?$.get(n).success(function(t){var e=new JSEncrypt;e.setPublicKey(t||""),r.model.password=e.encrypt(r.model.password),r.model.verifyPassword=e.encrypt(r.model.verifyPassword),a()}):a())},findUserById:function(e,n){if(!e.userId)return!1;t.get(i+"/"+e.userId).success(function(t){t=t||{},n?n(t):e.model=t})},updateUser:function(n,r){util.initJqValidation(),$("form").valid()&&(n.isSubmit=!0,t.put(i,n.model).then(function(){n.isSubmit=!1,e.success("更新成功"),r&&r()},function(){n.isSubmit=!1}))},enableUser:function(n,r){if(!n.userId)return!1;n.isSubmit=!0,t.put(i+"/enable?id="+n.userId).then(function(){n.isSubmit=!1,e.success("启用成功"),$("#editTable").bootstrapTable("refresh"),r&&r()},function(){n.isSubmit=!1})},disableUser:function(n,r){n.isSubmit=!0,t.put(i+"/disable?id="+n.userId).then(function(){n.isSubmit=!1,e.success("禁用成功"),$("#editTable").bootstrapTable("refresh"),r&&r()},function(){n.isSubmit=!1})},deleteUser:function(n){if(!n.userId)return!1;n.isSubmit=!0,t.delete(i+"?userId="+n.userId).then(function(){e.success("删除成功"),n.bsTableControl.refresh(),n.isSubmit=!1},function(){n.isSubmit=!1})},resetPwd:function(n,r){if(!(r=r||n.userId))return e.warning("缺少参数"),!1;e.confirm("您是否要重置用户密码？",function(){n.isSubmit=!0,t.put(i+"/resetPwd",r).then(function(){n.isSubmit=!1,e.success("用户密码已重置成功")},function(){n.isSubmit=!1})})},userResources:function(e,n,r){t.get(i+"/resources",{params:n}).success(function(t){r?r(t):e.menus=t})},toSetRoles:function(n,r){if(!n.userId)return e.warning("缺少参数"),!1;n.isSubmit=!0,t.post(i+"/setRoles",{},{params:{userId:n.userId,roleIds:r}}).then(function(){n.isSubmit=!1,e.success("用户角色设置成功")},function(){n.isSubmit=!1})}}}angular.module("myApp").factory("userSvc",t),t.$inject=["$http","bsWin"]}(),function(){"use strict";angular.module("myApp").config(function(t){t.state("attachment",{url:"/attachment",controllerAs:"vm",templateUrl:util.formatUrl("sys/attachment/html/list"),controller:function(t,e,i){t.csHide("bm");var n=this;n.attachment={},n.del=function(t){i.confirm("确认删除数据吗？",function(){e.deleteById(n,t,function(){n.bsTableControl.refresh()})})},n.dels=function(){var t=$("#editTable").bootstrapTable("getSelections");if(0==t.length)return void i.warning("请选择要删除的数据");var e=[];$.each(t,function(t,i){e.push(i.id)}),n.del(e.join(","))},e.bsTableControl(n)}})})}(),function(){"use strict";angular.module("myApp").config(function(t){t.state("attachmentEdit",{url:"/attachmentEdit/:id",controllerAs:"vm",templateUrl:util.formatUrl("sys/attachment/html/edit"),controller:function(t,e,i,n){t.csHide("bm");var r=this;r.attachment={},r.attachmentId=i.params.id,r.attachment.publicAtt=!0,r.attachmentId&&e.findDocById(r.attachmentId,r),r.save=function(){if(r.attachmentId)r.attachment.id=r.attachmentId,e.update(r);else{if(!r.attachment.id)return void n.alert("请先上传文档！");e.create(r)}},$("#orginalFiles").uploadify({uploader:util.formatUrl("sys/attachment/upload"),swf:util.formatUrl("libs/uploadify/uploadify.swf"),method:"post",multi:!0,auto:!0,fileObjName:"files",fileSizeLimit:"10MB",buttonText:"选择文档",fileExt:"*.pdf;*.txt;*.png;*.doc",fileTypeExts:"*.pdf;*.txt;*.png;*.doc;*png;*.docx;*.xls;*.xlsx;*.ppt;*.pptx;*.ceb",fileTypeDesc:"请选择*.pdf;*.txt;*.png;*.doc文件",removeCompleted:!0,onUploadStart:function(t){if(!r.attachment.tableKey)return n.error("参数错误！"),!1;r.attachment.id&&$("#orginalFiles").uploadify("settings","formData",{attId:r.attachment.id}),$("#orginalFiles").uploadify("settings","formData",{tableKey:r.attachment.tableKey})},onUploadSuccess:function(t,e,i){angular.element("body").scope().$apply(function(){r.attachment.originalName=t.name.substring(0,t.name.indexOf(".")),n.alert("上传成功")})},onUploadError:function(t,e,i,r){angular.element("body").scope().$apply(function(){n.error("上传失败")})}}),r.backPrevPage=function(e){t.backPrevPage(e)}}})})}(),function(){"use strict";angular.module("myApp").factory("attachmentSvc",function(t,e){var i=util.formatUrl("sys/attachment");return{bsTableControl:function(t){t.bsTableControl={options:util.getTableFilterOption({url:i,defaultSort:"itemOrder desc",columns:[{title:"行号",width:50,switchable:!1,formatter:function(e,i,n){var r=t.bsTableControl.state;return r.pageNumber&&r.pageSize?n+1+(r.pageNumber-1)*r.pageSize:n+1}},{checkbox:!0},{field:"originalName",title:"文档名称",sortable:!0,filterControl:"input",filterOperator:"like",formatter:function(t,e,n){return'<a href="'+i+"/download/"+e.id+'" target="_blank">'+t+"</a>"}},{field:"docCategory",title:"文档分类",sortable:!0,filterControl:"input",filterOperator:"like",formatter:"{{DICT.ATTACHMENT.dicts.CATEGORY.dicts[row.docCategory].dictName}}"},{field:"attMonth",title:"所属月份",width:100,sortable:!0,filterControl:"input",filterOperator:"like"},{field:"publicAtt",title:"是否公开给业主",width:130,sortable:!1,align:"center",filterControl:"input",filterOperator:"like",formatter:function(t){return t?"是":"否"}},{field:"createdDate",title:"建档时间",width:200,sortable:!0,filterControl:"datepicker",filterOperator:"gt"},{field:"modifiedDate",title:"最后修改时间",width:200,sortable:!1,filterControl:"datepicker",filterOperator:"gt"},{field:"createdBy",title:"建档人",width:100,sortable:!1,filterControl:"input",filterOperator:"like"},{field:"",title:"操作",width:100,formatter:$("#columnBtns").html()}]})}},create:function(n){util.initJqValidation(),$("form").valid()&&(n.isSubmit=!0,t.put(i,n.attachment).then(function(){e.success("添加成功"),n.backPrevPage(),n.isSubmit=!1}).then(function(){n.isSubmit=!1}))},findDocById:function(e){t.get(i+"/findById",{params:{id:e.attachment.id}}).then(function(t){e.attachment=t.data})},update:function(n){util.initJqValidation(),$("form").valid()&&(n.isSubmit=!0,t.put(i,n.attachment).success(function(){n.isSubmit=!1,e.success("更新成功"),n.backPrevPage("attachment")}).then(function(){n.isSubmit=!1}))},deleteById:function(n,r,o){n.isSubmit=!0,t.delete(i,{params:{id:r||""}}).then(function(){e.success("删除成功"),angular.isFunction(o)&&o(),n.isSubmit=!1}).then(function(){n.isSubmit=!1})}}})}(),function(){"use strict";function t(t){t.state("organ.add",{url:"/organAdd/:id",controllerAs:"vm",templateUrl:util.formatUrl("sys/organ/html/add"),controller:e})}function e(t,e,i){if(t.organId=i.params.id,t.isSubmit=!1,t.hasParent=!1,t.organId)t.hasParent=!0,e.findOrganById(t,function(e){t.parentOrgan=e,t.model={parentId:e.organId}});else{var n;t.$watch("organList",function(e){n&&n.destroy(),e&&0!=e.length?(t.hasParent=!1,n=$.fn.zTree.init($("#parentOrganTree"),{treeId:"organId",data:{key:{name:"organName"},simpleData:{enable:!0,idKey:"organId",pIdKey:"parentId"}},check:{enable:!0,chkStyle:"radio"},callback:{onCheck:function(e,i,n){n.checked&&t.$apply(function(){t.model||(t.model={}),t.model.parentId=n.organId})}}},e)):t.hasParent=!0})}t.saveOrgan=function(){e.createOrgan(t,function(){i.go("organ",{},{reload:!0})})}}angular.module("myApp").config(t),t.$inject=["$stateProvider"],e.$inject=["$scope","organSvc","$state"]}(),function(){"use strict";function t(t){t.state("organ",{url:"/organ",controllerAs:"vm",templateUrl:util.formatUrl("sys/organ/html/list"),controller:e})}function e(t,e,i,n){function r(){o&&o.destroy(),i.getOrganList(t,function(n){o=$.fn.zTree.init(l,{treeId:"organId",data:{key:{name:"organName"},simpleData:{enable:!0,idKey:"organId",pIdKey:"parentId"}},edit:{enable:!0,removeTitle:"删除机构",showRemoveBtn:function(t,e){return!!s&&(e.organDataType>0&&!e.isParent)},showRenameBtn:!1},view:{addHoverDom:function(t,i){if(i.organType<2){var n=$("#"+i.tId+"_span");if(i.editNameFlag||$("#addBtn_"+i.tId).length>0)return;if(a.length>0){var r=util.format(a.html(),i.tId);n.after(r);var o=$("#addBtn_"+i.tId);o&&o.bind("click",function(){return e.go("organ.add",{id:i.organId}),!1})}}},removeHoverDom:function(t,e){$("#addBtn_"+e.tId).unbind().remove()},selectedMulti:!1},callback:{onClick:function(t,i,n){e.go("organ.edit",{id:n.organId})},beforeRemove:function(n,r){return t.$apply(function(){t.organId=r.organId,i.deleteOrgan(t,function(){t.organId=null,e.go("organ",{},{reload:!0})})}),!1},beforeDrag:function(){return!1}}},n);var r=o.getNodeByParam("parentId",null);o.expandNode(r,!0),window.fuzzySearch("organTree","#organKey",null,!0)})}t.csHide("bm"),t.deleteOrgan=function(e){t.organId=e,n.confirm("确认删除数据吗？",function(){i.deleteOrgan(vm)})};var o,a=$("#treeAddBtn"),l=$("#organTree"),s=l.attr("delete");r(),t.initOrganTree=r}angular.module("myApp").config(t),t.$inject=["$stateProvider"],e.$inject=["$scope","$state","organSvc","bsWin"]}(),function(){"use strict";function t(t){t.state("organ.edit",{url:"/organEdit/:id",controllerAs:"vm",templateUrl:util.formatUrl("sys/organ/html/edit"),controller:e})}function e(t,e,i,n){function r(){function e(){o.checkAllNodes(!1),$.each(t.model.resources,function(t,e){o.checkNode(o.getNodeByParam("resId",e.resId),!0,!0)})}o?e():n.getResourceData(t,function(t){t=t.value||[],o=$.fn.zTree.init($("#resourceTree"),{treeId:"resId",check:{enable:!0,chkboxType:{Y:"p",N:"s"}},data:{key:{name:"resName"},simpleData:{enable:!0,idKey:"resId",pIdKey:"parentId"}}},t),e()})}t.organId=e.params.id,t.isSubmit=!1,t.organId&&i.findOrganById(t,function(e){t.model=e,e.parentId&&i.findOrganById({organId:e.parentId},function(e){t.parentOrgan=e})}),t.saveOrgan=function(){i.updateOrgan(t,function(){t.initOrganTree&&t.initOrganTree()})},t.authorization=function(){r(),$("#organAuthorizationWin").modal("show")},t.toAuthorization=function(){o&&(t.model.resources=o.getCheckedNodes(!0),i.authorization(t))};var o}angular.module("myApp").config(t),t.$inject=["$stateProvider"],e.$inject=["$scope","$state","organSvc","resourceSvc"]}(),function(){"use strict";function t(t,e){var i=util.formatUrl("sys/organ");return{getOrganList:function(e,n){t.get(i+"?$orderby=itemOrder asc").success(function(t){e.organList=t.value||[],n&&n(e.organList)})},findOrganList:function(e,n){t.get(i+"/findOrganList").then(function(t){n?n(t.data):e.organList=t.data})},createOrgan:function(n,r){util.initJqValidation(),$("form").valid()&&(n.isSubmit=!0,t.post(i,n.model).then(function(){n.isSubmit=!1,e.success("创建成功",function(){r&&r()})},function(){n.isSubmit=!1}))},findOrganById:function(e,n){t.get(i+"/"+(e.organId||"")).success(function(t){t=t||{},n?n(t):e.model=t})},updateOrgan:function(n,r){util.initJqValidation(),$("form").valid()&&(n.isSubmit=!0,t.put(i,n.model).then(function(){n.isSubmit=!1,e.success("更新成功",function(){r&&r()})},function(){n.isSubmit=!1}))},deleteOrgan:function(n,r){t.delete(i,{params:{organId:n.organId||""}}).then(function(){e.success("删除成功",function(){r&&r()})},function(){n.isSubmit=!1})},authorization:function(n){if(!n.organId||!n.model)return void e.warning("缺少参数");n.isSubmit=!0,t.put(i+"/authorization?organId="+n.organId,n.model.resources||[]).then(function(){n.isSubmit=!1,e.success("权限更新成功")},function(){n.isSubmit=!1})}}}angular.module("myApp").factory("organSvc",t),t.$inject=["$http","bsWin"]}(),function(){"use strict";function t(t){t.state("organ.user",{url:"/organUser/:id",controllerAs:"vm",templateUrl:util.formatUrl("sys/organ/html/user"),controller:e})}function e(t,e,i,n,r){t.organId=e.params.id||"",t.isSubmit=!1,t.isUpdate=!1,t.openUserEditWin=function(e){o.modal("show"),e?(t.isUpdate=!0,t.userId=e,n.findUserById(t,function(e){t.model=e})):(t.isUpdate=!1,t.model={useState:1,organ:{organId:t.organId}})};var o=$("#organUserEditModel").on("hidden.bs.modal",function(e){t.$apply(function(){t.model=null})});t.saveUser=function(){t.isUpdate?n.updateUser(t,function(){o.modal("hide"),$("#editTable").bootstrapTable("refresh")}):n.createUser(t,function(){o.modal("hide"),$("#editTable").bootstrapTable("refresh")})},t.delUser=function(e){t.userId=e,r.confirm("确认删除数据吗？",function(){n.deleteUser(t)})},t.delUsers=function(){var e=$("#editTable").bootstrapTable("getSelections");if(0==e.length)return void r.alert("请选择要删除的数据");var i=[];$.each(e,function(t,e){i.push(e.userId)}),t.delUser(i.join(","))},t.start=function(e){t.userId=e.userId,n.enableUser(t)},t.stop=function(e){t.userId=e.userId,n.disableUser(t)},i.findOrganById(t,function(e){t.organ=e}),n.bsTableControl(t,{field:"organ.organId",operator:"eq",value:t.organId}),n.reloadBsTable(t)}angular.module("myApp").config(t),t.$inject=["$stateProvider"],e.$inject=["$scope","$state","organSvc","userSvc","bsWin"]}(),function(){"use strict";function t(t){t.state("sysVariable",{url:"/sysVariable",controllerAs:"vm",templateUrl:util.formatUrl("sys/variable/html/list"),controller:e})}function e(t,e,i){t.csHide("bm");var n=this;n.del=function(t){i.confirm("确认删除数据吗？",function(){n.varId=t,e.deleteById(n)})},n.dels=function(){var t=$("#editTable").bootstrapTable("getSelections");if(0==t.length)return void i.warning("请选择要删除的数据");var e=[];$.each(t,function(t,i){e.push(i.varId)}),n.del(e.join(","))},e.bsTableControl(n)}angular.module("myApp").config(t),t.$inject=["$stateProvider"],e.$inject=["$scope","sysVariableSvc","bsWin"]}(),function(){"use strict";function t(t){t.state("sysVariableEdit",{
url:"/sysVariableEdit/:id",controllerAs:"vm",templateUrl:util.formatUrl("sys/variable/html/edit"),controller:e})}function e(t,e){var i=this;i.varId=t.params.id,i.varId&&e.findById(i),i.save=function(){i.varId?e.update(i):e.create(i)}}angular.module("myApp").config(t),t.$inject=["$stateProvider"],e.$inject=["$state","sysVariableSvc"]}(),function(){"use strict";function t(t,e,i){var n=util.formatUrl("sys/variable");return{bsTableControl:function(t){t.bsTableControl={options:util.getTableFilterOption({url:n,columns:[{title:"行号",width:50,switchable:!1,formatter:function(e,i,n){var r=t.bsTableControl.state;return r.pageNumber&&r.pageSize?n+1+(r.pageNumber-1)*r.pageSize:n+1}},{checkbox:!0},{field:"varCode",title:"系统变量编码",sortable:!0,width:150,filterControl:"input",filterOperator:"like"},{field:"varName",title:"系统变量名",sortable:!1,width:150,filterControl:"input",filterOperator:"like"},{field:"typeName",title:"系统变量类型",width:150,sortable:!1,filterControl:"input",filterOperator:"like"},{field:"varValue",title:"系统变量值",width:200,sortable:!1,filterControl:"input",filterOperator:"like"},{field:"remark",title:"备注",sortable:!1,filterControl:"input",filterOperator:"like"},{title:"操作",width:150,align:"center",formatter:$("#columnBtns").html()}]})}},create:function(r){util.initJqValidation(),$("form").valid()&&(r.isSubmit=!0,t.post(n,r.model).then(function(){r.isSubmit=!1,e.success("创建成功",function(){i.go("role")})},function(){r.isSubmit=!1}))},findById:function(e,i){t.get(n+"/"+(e.varId||"")).success(function(t){i?i(t):e.model=t})},update:function(i){util.initJqValidation(),$("form").valid()&&(i.isSubmit=!0,t.put(n,i.model).then(function(){i.isSubmit=!1,e.success("更新成功"),$("#editTable").bootstrapTable("refresh")},function(){i.isSubmit=!1}))},deleteById:function(i){i.isSubmit=!0,t.delete(n,{params:{varId:i.varId||""}}).then(function(){i.isSubmit=!1,e.success("删除成功"),$("#editTable").bootstrapTable("refresh")},function(){i.isSubmit=!1})}}}angular.module("myApp").factory("sysVariableSvc",t),t.$inject=["$http","bsWin","$state"]}();