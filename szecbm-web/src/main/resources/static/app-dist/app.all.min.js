!function(){"use strict";function t(o,e,t,i,n){$("#topMenuBox");var r=$("#leftMenuBox");o.$on("$stateChangeStart",function(t,e,i,n,r){t&&$(".uploadify").each(function(){$(this).uploadify("destroy")})}),o.$on("$stateChangeSuccess",function(t,e,i,n,r){o.previousState_name=n.name,o.previousState_params=r}),o.backPrevPage=function(t){t=t||"welcome",e.go(o.previousState_name||t,o.previousState_params)},o.csHide=function(t){t&&t!=o.menuBoxResId&&(0<$("#menu_"+t).length?o.menuBoxResId=t:o.menuBoxResId="pm")},n.initMenus(o,function(t){o.menuBoxResId||(o.menuBoxResId="pm"),r.append(i(t)(o))}),n.initDicts(o)}function e(t,e,i){e.parentSelector="#loading-bar-container",e.spinnerTemplate='<div style="position:fixed;width:100%;height:100%;left:0;top:0; z-index:99;background:rgba(0, 0, 0, 0.3);overflow: hidden;"><div style="position: absolute;top:30%; width: 400px;height:40px;left:50%;"><i class="fa fa-spinner fa-pulse fa-1x fa-fw"></i>程序处理中...</div></div>',t.otherwise("/welcome"),i.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|javascript):/)}function i(t){t.$on("$viewContentLoaded",function(t){jQuery.AdminLTE.layout&&(jQuery.AdminLTE.layout.fix(),jQuery.AdminLTE.layout.fixSidebar())})}angular.module("myApp",["ui.router","angular-loading-bar","bsTable","sn.common"]).config(e).run(i).controller("indexCtrl",t),t.$inject=["$scope","$state","$http","$compile","snBaseUtils"],e.$inject=["$urlRouterProvider","cfpLoadingBarProvider","$compileProvider"],i.$inject=["$rootScope"];var n=$('<div><i class="fa fa-chevron-up"></i></div>').css({position:"fixed",bottom:"20px",right:"25px",width:"40px",height:"40px",color:"#eee","font-size":"","line-height":"40px","text-align":"center","background-color":"#222d32",cursor:"pointer","border-radius":"5px","z-index":"99999",opacity:".7",display:"none"}).on({mouseenter:function(){n.css("opacity","1")},mouseout:function(){n.css("opacity",".7")},click:function(){$("html,body").animate({scrollTop:top},500)}});$(".wrapper").append(n),$(window).scroll(function(){150<=$(window).scrollTop()?n.is(":visible")||n.fadeIn(500):n.fadeOut(500)})}(),function(){"use strict";angular.module("myApp").config(function(t){var o=util.formatUrl("admin/userInfo");t.state("userInfo",{url:"/userInfo",controllerAs:"vm",templateUrl:o,controller:function(t,i,n){var r=this;r.isSubmit=!1,r.toUpdate=function(){if(util.initJqValidation(),$("form").valid()){var e=new JSEncrypt;i.get(util.formatUrl("rsaKey")).success(function(t){e.setPublicKey(t||""),r.model.oldPassword&&(r.model.oldPassword=e.encrypt(r.model.oldPassword),r.model.newPassword=e.encrypt(r.model.newPassword),r.model.verifyPassword=e.encrypt(r.model.verifyPassword)),r.isSubmit=!0,i.put(o,r.model).then(function(){r.isSubmit=!1,n.success("修改成功")},function(){r.isSubmit=!1})})}}}})})}(),function(){"use strict";function t(t){t.state("welcome",{url:"/welcome",templateUrl:util.formatUrl("admin/welcome"),controllerAs:"vm",controller:e})}function e(t,e){var i=this;i.getOperatorLogList=function(){e.getOperatorLogList(i,{$orderby:"createdDate desc",$top:5})}}angular.module("myApp").config(t),t.$inject=["$stateProvider"],e.$inject=["$scope","operatorLogSvc"]}(),function(){"use strict";angular.module("myApp").factory("welcomeSvc",function(t,e){util.formatUrl("admin");return{}})}(),function(){"use strict";angular.module("myApp").config(function(t){t.state("attachment",{url:"/attachment",controllerAs:"vm",templateUrl:util.formatUrl("sys/attachment/html/list"),controller:function(t,e,n){t.csHide("bm");var r=this;r.attachment={},r.del=function(t){n.confirm("确认删除数据吗？",function(){e.deleteById(r,t,function(){r.bsTableControl.refresh()})})},r.dels=function(){var t=$("#editTable").bootstrapTable("getSelections");if(0!=t.length){var i=[];$.each(t,function(t,e){i.push(e.id)}),r.del(i.join(","))}else n.warning("请选择要删除的数据")},e.bsTableControl(r)}})})}(),function(){"use strict";angular.module("myApp").config(function(t){t.state("attachmentEdit",{url:"/attachmentEdit/:id",controllerAs:"vm",templateUrl:util.formatUrl("sys/attachment/html/edit"),controller:function(e,t,i,r){e.csHide("bm");var n=this;n.attachment={},n.attachmentId=i.params.id,n.attachment.publicAtt=!0,n.attachmentId&&t.findDocById(n.attachmentId,n),n.save=function(){if(n.attachmentId)n.attachment.id=n.attachmentId,t.update(n);else{if(!n.attachment.id)return void r.alert("请先上传文档！");t.create(n)}},$("#orginalFiles").uploadify({uploader:util.formatUrl("sys/attachment/upload"),swf:util.formatUrl("libs/uploadify/uploadify.swf"),method:"post",multi:!0,auto:!0,fileObjName:"files",fileSizeLimit:"10MB",buttonText:"选择文档",fileExt:"*.pdf;*.txt;*.png;*.doc",fileTypeExts:"*.pdf;*.txt;*.png;*.doc;*png;*.docx;*.xls;*.xlsx;*.ppt;*.pptx;*.ceb",fileTypeDesc:"请选择*.pdf;*.txt;*.png;*.doc文件",removeCompleted:!0,onUploadStart:function(t){if(!n.attachment.tableKey)return r.error("参数错误！"),!1;n.attachment.id&&$("#orginalFiles").uploadify("settings","formData",{attId:n.attachment.id}),$("#orginalFiles").uploadify("settings","formData",{tableKey:n.attachment.tableKey})},onUploadSuccess:function(t,e,i){angular.element("body").scope().$apply(function(){n.attachment.originalName=t.name.substring(0,t.name.indexOf(".")),r.alert("上传成功")})},onUploadError:function(t,e,i,n){angular.element("body").scope().$apply(function(){r.error("上传失败")})}}),n.backPrevPage=function(t){e.backPrevPage(t)}}})})}(),function(){"use strict";angular.module("myApp").factory("attachmentSvc",function(n,r){var o=util.formatUrl("sys/attachment");return{bsTableControl:function(r){r.bsTableControl={options:util.getTableFilterOption({url:o,defaultSort:"itemOrder desc",columns:[{title:"行号",width:50,switchable:!1,formatter:function(t,e,i){var n=r.bsTableControl.state;return n.pageNumber&&n.pageSize?i+1+(n.pageNumber-1)*n.pageSize:i+1}},{checkbox:!0},{field:"originalName",title:"文档名称",sortable:!0,filterControl:"input",filterOperator:"like",formatter:function(t,e,i){return'<a href="'+o+"/download/"+e.id+'" target="_blank">'+t+"</a>"}},{field:"docCategory",title:"文档分类",sortable:!0,filterControl:"input",filterOperator:"like",formatter:"{{DICT.ATTACHMENT.dicts.CATEGORY.dicts[row.docCategory].dictName}}"},{field:"attMonth",title:"所属月份",width:100,sortable:!0,filterControl:"input",filterOperator:"like"},{field:"publicAtt",title:"是否公开给业主",width:130,sortable:!1,align:"center",filterControl:"input",filterOperator:"like",formatter:function(t){return t?"是":"否"}},{field:"createdDate",title:"建档时间",width:200,sortable:!0,filterControl:"datepicker",filterOperator:"gt"},{field:"modifiedDate",title:"最后修改时间",width:200,sortable:!1,filterControl:"datepicker",filterOperator:"gt"},{field:"createdBy",title:"建档人",width:100,sortable:!1,filterControl:"input",filterOperator:"like"},{field:"",title:"操作",width:100,formatter:$("#columnBtns").html()}]})}},create:function(t){util.initJqValidation(),$("form").valid()&&(t.isSubmit=!0,n.put(o,t.attachment).then(function(){r.success("添加成功"),t.backPrevPage(),t.isSubmit=!1}).then(function(){t.isSubmit=!1}))},findDocById:function(e){n.get(o+"/findById",{params:{id:e.attachment.id}}).then(function(t){e.attachment=t.data})},update:function(t){util.initJqValidation(),$("form").valid()&&(t.isSubmit=!0,n.put(o,t.attachment).success(function(){t.isSubmit=!1,r.success("更新成功"),t.backPrevPage("attachment")}).then(function(){t.isSubmit=!1}))},deleteById:function(t,e,i){t.isSubmit=!0,n.delete(o,{params:{id:e||""}}).then(function(){r.success("删除成功"),angular.isFunction(i)&&i(),t.isSubmit=!1}).then(function(){t.isSubmit=!1})}}})}(),function(){"use strict";angular.module("myApp").config(function(t){t.state("dict",{url:"/dict",controllerAs:"vm",templateUrl:util.formatUrl("sys/dict/html/list"),controller:function(t,e,i){t.csHide("bm");var n=this;n.dict={},n.dels=function(){var t=n.dictsTree.getSelectedNodes();t&&0<t.length?n.del(t[0].dictId):i.confirm("请选择数据")},n.del=function(t){n.dict.dictId=t,i.confirm("删除字典将会连下级字典一起删除，确认删除数据吗？",function(){e.deleteDict(n)})},n.resetDict=function(){i.confirm("您确定要重置数据字典吗？",function(){e.resetDict(n)})},e.initDictTree(n)}})})}(),function(){"use strict";angular.module("myApp").config(function(t){t.state("dict.edit",{url:"/dictEdit/:dictId",controllerAs:"vm",templateUrl:util.formatUrl("sys/dict/html/edit"),controller:function(t,e,i){t.csHide("bm");var n=this;n.dict={},n.dictId=i.params.dictId,n.dictId&&(n.isUpdate=!0),n.isUpdate?e.findDictById(n):e.initpZtreeClient(n),n.create=function(){if(n.dictsTree){var t=n.dictsTree.getCheckedNodes(!0);t&&0!=t.length&&(n.dict.parentId=t[0].dictId)}e.createDict(n)},n.update=function(){e.updateDict(n)},n.dictTypeChange=function(){n.dict.dictType&&(n.dict.dictKey="")}}})})}(),function(){"use strict";angular.module("myApp").factory("dictSvc",function(i,e,n){var r=util.formatUrl("sys/dict");return{initDictTree:o,initpZtreeClient:function(e){e.dictsTree&&e.dictsTree.destroy(),i.get(r+"?$orderby=itemOrder asc").success(function(t){e.dictsTree=$.fn.zTree.init($("#pzTree"),{check:{enable:!0,chkStyle:"radio",radioType:"all"},data:{key:{name:"dictName"},simpleData:{enable:!0,idKey:"dictId",pIdKey:"parentId",rootPId:0}}},t||[])})},createDict:function(t){util.initJqValidation(),$("form").valid()&&(t.isSubmit=!0,i.post(r,t.dict).then(function(){e.success("创建成功"),t.isSubmit=!1,o(t)},function(){t.isSubmit=!1}))},findDictById:function(e){if(!e.dictId)return!1;i.get(r+"/"+e.dictId).success(function(t){e.dict=t})},updateDict:function(t){util.initJqValidation(),$("form").valid()&&(t.isSubmit=!0,i.put(r,t.dict).then(function(){e.success("更新成功"),t.isSubmit=!1,o(t)},function(){t.isSubmit=!1}))},deleteDict:function(t){t.isSubmit=!0,i.delete(r,{params:{dictId:t.dict.dictId||""}}).then(function(){e.success("删除成功"),t.isSubmit=!1,o(t)},function(){t.isSubmit=!1})},resetDict:function(t){t.isSubmit=!0,i.post(r+"/reset",{}).then(function(){e.success("操作成功"),t.isSubmit=!1,o(t)},function(){t.isSubmit=!1})}};function o(e){e.dictsTree&&e.dictsTree.destroy(),i.get(r+"?$orderby=itemOrder asc").success(function(t){e.dictsTree=$.fn.zTree.init($("#zTree"),{callback:{onClick:function(t,e,i){n.go("dict.edit",{dictId:i.dictId})}},data:{key:{name:"dictName"},simpleData:{enable:!0,idKey:"dictId",pIdKey:"parentId",rootPId:0}}},t||[]),window.fuzzySearch("zTree","#dictTreeKey",null,!0)})}})}(),function(){"use strict";angular.module("myApp").config(function(t){t.state("operatorLog",{url:"/operatorLog",controllerAs:"vm",templateUrl:util.formatUrl("sys/operatorLog/html/list"),controller:function(t,e,i){t.csHide("bm");var n=this;n.model={},n.delLog=function(t){e.deleteLog(n,t)},e.bsTableControl(t)}})})}(),function(){"use strict";angular.module("myApp").factory("operatorLogSvc",function(i,n){var o=util.formatUrl("sys/operatorLog");return{bsTableControl:function(r){r.bsTableControl={options:util.getTableFilterOption({url:o,columns:[{title:"行号",switchable:!1,width:50,align:"left",formatter:function(t,e,i){var n=r.bsTableControl.state;return n.pageNumber&&n.pageSize?i+1+(n.pageNumber-1)*n.pageSize:i+1}},{field:"createdDate",title:"操作时间",width:100,sortable:!0,filterControl:"datepicker",filterOperator:"lte"},{field:"createdBy",title:"操作人",width:100,sortable:!0,filterControl:"input",filterOperator:"like"},{field:"businessType",title:"操作对象",width:100,sortable:!0,filterControl:"input",filterOperator:"like",formatter:function(t,e,i){return e.businessType+"["+e.operateType+"]"}},{field:"operateTime",title:"耗时",width:80,sortable:!0,align:"right",filterControl:"number"},{field:"ipAddress",title:"IP地址",width:100,align:"center",filterControl:"input",filterOperator:"like"},{field:"sucessFlag",title:"结果",width:60,filterControl:"input",filterOperator:"like",formatter:"<span ng-show='row.sucessFlag==1' class='bg-green'>成功</span><span ng-show='row.sucessFlag!=1' class='bg-red'>失败</span>"},{field:"message",title:"结果消息",width:120},{field:"oldInfo",title:"原数据",width:200,formatter:function(t,e,i){return t?"<textarea style='width: 100%' rows='4'>"+t+"</textarea>":"<textarea style='width: 100%' rows='4'> </textarea>"}},{field:"newInfo",title:"更新数据",width:200,formatter:function(t,e,i){return t?"<textarea style='width: 100%' rows='4'>"+t+"</textarea>":"<textarea style='width: 100%' rows='4'> </textarea>"}},{field:"updateInfo",title:"更新信息",width:200,formatter:function(t,e,i){return t?"<textarea style='width: 100%' rows='4'>"+t+"</textarea>":"<textarea style='width: 100%' rows='4'> </textarea>"}}]})}},getOperatorLogList:function(e,t){i.get(o,{params:t}).success(function(t){e.operatorLogList=t||{}})},deleteLog:function(t,e){t.isSubmit=!0,i.delete(o,{params:{days:e||""}}).then(function(){n.alert("删除成功"),t.isSubmit=!1,$("#editTable").bootstrapTable("refresh","")})}}})}(),function(){"use strict";function t(t){t.state("organ.add",{url:"/organAdd/:id",controllerAs:"vm",templateUrl:util.formatUrl("sys/organ/html/add"),controller:e})}function e(n,t,e){var i;(n.organId=e.params.id,n.isSubmit=!1,n.hasParent=!1,n.organId)?(n.hasParent=!0,t.findOrganById(n,function(t){n.parentOrgan=t,n.model={parentId:t.organId}})):n.$watch("organList",function(t){i&&i.destroy(),t&&0!=t.length?(n.hasParent=!1,i=$.fn.zTree.init($("#parentOrganTree"),{treeId:"organId",data:{key:{name:"organName"},simpleData:{enable:!0,idKey:"organId",pIdKey:"parentId"}},check:{enable:!0,chkStyle:"radio"},callback:{onCheck:function(t,e,i){i.checked&&n.$apply(function(){n.model||(n.model={}),n.model.parentId=i.organId})}}},t)):n.hasParent=!0});n.saveOrgan=function(){t.createOrgan(n,function(){e.go("organ",{},{reload:!0})})}}angular.module("myApp").config(t),t.$inject=["$stateProvider"],e.$inject=["$scope","organSvc","$state"]}(),function(){"use strict";function t(t){t.state("organ",{url:"/organ",controllerAs:"vm",templateUrl:util.formatUrl("sys/organ/html/list"),controller:e})}function e(i,o,n,e){i.csHide("bm"),i.deleteOrgan=function(t){i.organId=t,e.confirm("确认删除数据吗？",function(){n.deleteOrgan(vm)})};var r,a=$("#treeAddBtn"),s=$("#organTree"),l=s.attr("delete");function t(){r&&r.destroy(),n.getOrganList(i,function(t){var e=(r=$.fn.zTree.init(s,{treeId:"organId",data:{key:{name:"organName"},simpleData:{enable:!0,idKey:"organId",pIdKey:"parentId"}},edit:{enable:!0,removeTitle:"删除机构",showRemoveBtn:function(t,e){return!!l&&(0<e.organDataType&&!e.isParent)},showRenameBtn:!1},view:{addHoverDom:function(t,e){if(e.organType<2){var i=$("#"+e.tId+"_span");if(e.editNameFlag||0<$("#addBtn_"+e.tId).length)return;if(0<a.length){var n=util.format(a.html(),e.tId);i.after(n);var r=$("#addBtn_"+e.tId);r&&r.bind("click",function(){return o.go("organ.add",{id:e.organId}),!1})}}},removeHoverDom:function(t,e){$("#addBtn_"+e.tId).unbind().remove()},selectedMulti:!1},callback:{onClick:function(t,e,i){o.go("organ.edit",{id:i.organId})},beforeRemove:function(t,e){return i.$apply(function(){i.organId=e.organId,n.deleteOrgan(i,function(){i.organId=null,o.go("organ",{},{reload:!0})})}),!1},beforeDrag:function(){return!1}}},t)).getNodeByParam("parentId",null);r.expandNode(e,!0),window.fuzzySearch("organTree","#organKey",null,!0)})}t(),i.initOrganTree=t}angular.module("myApp").config(t),t.$inject=["$stateProvider"],e.$inject=["$scope","$state","organSvc","bsWin"]}(),function(){"use strict";function t(t){t.state("organ.edit",{url:"/organEdit/:id",controllerAs:"vm",templateUrl:util.formatUrl("sys/organ/html/edit"),controller:e})}function e(i,t,e,n){var r;i.organId=t.params.id,i.isSubmit=!1,i.organId&&e.findOrganById(i,function(t){(i.model=t).parentId&&e.findOrganById({organId:t.parentId},function(t){i.parentOrgan=t})}),i.saveOrgan=function(){e.updateOrgan(i,function(){i.initOrganTree&&i.initOrganTree()})},i.authorization=function(){!function(){r?e():n.getResourceData(i,function(t){t=t.value||[],r=$.fn.zTree.init($("#resourceTree"),{treeId:"resId",check:{enable:!0,chkboxType:{Y:"p",N:"s"}},data:{key:{name:"resName"},simpleData:{enable:!0,idKey:"resId",pIdKey:"parentId"}}},t),e()});function e(){r.checkAllNodes(!1),$.each(i.model.resources,function(t,e){r.checkNode(r.getNodeByParam("resId",e.resId),!0,!0)})}}(),$("#organAuthorizationWin").modal("show")},i.toAuthorization=function(){r&&(i.model.resources=r.getCheckedNodes(!0),e.authorization(i))}}angular.module("myApp").config(t),t.$inject=["$stateProvider"],e.$inject=["$scope","$state","organSvc","resourceSvc"]}(),function(){"use strict";function t(n,i){var r=util.formatUrl("sys/organ");return{getOrganList:function(e,i){n.get(r+"?$orderby=itemOrder asc").success(function(t){e.organList=t.value||[],i&&i(e.organList)})},findOrganList:function(e,i){n.get(r+"/findOrganList").then(function(t){i?i(t.data):e.organList=t.data})},createOrgan:function(t,e){util.initJqValidation(),$("form").valid()&&(t.isSubmit=!0,n.post(r,t.model).then(function(){t.isSubmit=!1,i.success("创建成功",function(){e&&e()})},function(){t.isSubmit=!1}))},findOrganById:function(e,i){n.get(r+"/"+(e.organId||"")).success(function(t){t=t||{},i?i(t):e.model=t})},updateOrgan:function(t,e){util.initJqValidation(),$("form").valid()&&(t.isSubmit=!0,n.put(r,t.model).then(function(){t.isSubmit=!1,i.success("更新成功",function(){e&&e()})},function(){t.isSubmit=!1}))},deleteOrgan:function(t,e){n.delete(r,{params:{organId:t.organId||""}}).then(function(){i.success("删除成功",function(){e&&e()})},function(){t.isSubmit=!1})},authorization:function(t){t.organId&&t.model?(t.isSubmit=!0,n.put(r+"/authorization?organId="+t.organId,t.model.resources||[]).then(function(){t.isSubmit=!1,i.success("权限更新成功")},function(){t.isSubmit=!1})):i.warning("缺少参数")}}}angular.module("myApp").factory("organSvc",t),t.$inject=["$http","bsWin"]}(),function(){"use strict";function t(t){t.state("organ.user",{url:"/organUser/:id",controllerAs:"vm",templateUrl:util.formatUrl("sys/organ/html/user"),controller:e})}function e(e,t,i,n,r){e.organId=t.params.id||"",e.isSubmit=!1,e.isUpdate=!1,e.openUserEditWin=function(t){o.modal("show"),t?(e.isUpdate=!0,e.userId=t,n.findUserById(e,function(t){e.model=t})):(e.isUpdate=!1,e.model={useState:1,organ:{organId:e.organId}})};var o=$("#organUserEditModel").on("hidden.bs.modal",function(t){e.$apply(function(){e.model=null})});e.saveUser=function(){e.isUpdate?n.updateUser(e,function(){o.modal("hide"),$("#editTable").bootstrapTable("refresh")}):n.createUser(e,function(){o.modal("hide"),$("#editTable").bootstrapTable("refresh")})},e.delUser=function(t){e.userId=t,r.confirm("确认删除数据吗？",function(){n.deleteUser(e)})},e.delUsers=function(){var t=$("#editTable").bootstrapTable("getSelections");if(0!=t.length){var i=[];$.each(t,function(t,e){i.push(e.userId)}),e.delUser(i.join(","))}else r.alert("请选择要删除的数据")},e.start=function(t){e.userId=t.userId,n.enableUser(e)},e.stop=function(t){e.userId=t.userId,n.disableUser(e)},i.findOrganById(e,function(t){e.organ=t}),n.bsTableControl(e,{field:"organ.organId",operator:"eq",value:e.organId}),n.reloadBsTable(e)}angular.module("myApp").config(t),t.$inject=["$stateProvider"],e.$inject=["$scope","$state","organSvc","userSvc","bsWin"]}(),function(){"use strict";angular.module("myApp").config(function(t){t.state("resource",{url:"/resource",controllerAs:"vm",templateUrl:util.formatUrl("sys/resource/html/list"),controller:function(r,o,t){function n(t){if(t)r.isUpdate=!0,r.editTitle="编辑系统资源",r.model||(r.model={}),r.resId=t,o.findResourceById(r,function(t){r.parentId=t.parentId;var e=s.getNodeByParam("resId",t.parentId);e&&s.checkNode(e,!0,!0)});else{r.model={status:1},r.isUpdate=!1,r.editTitle="新增系统资源";for(var e=s.getCheckedNodes(!0),i=0,n=e.length;i<n;i++)s.checkNode(e[i],!1,!0)}}var a,s;function l(){a&&a.destroy(),s&&s.destroy(),o.getResourceData(r,function(t){t=t.value||[];var e={treeId:"resId",data:{key:{name:"resName"},simpleData:{enable:!0,idKey:"resId",pIdKey:"parentId"}}};if(a=$.fn.zTree.init($("#resourceTree"),$.extend({edit:{enable:!0,removeTitle:"删除资源",showRemoveBtn:function(t,e){return!e.isParent},showRenameBtn:!1},callback:{onClick:function(t,e,i){r.$apply(function(){n(i.resId)})},beforeRemove:function(t,e){return r.$apply(function(){r.resId=e.resId,o.deleteResource(r,function(){r.resId=null,r.parentId=null,n(),l()})}),!1},beforeDrag:function(){return!1}}},e),t),r.parentId){var i=a.getNodeByParam("resId",r.parentId);a.expandNode(i,!0,!1,!0)}s=$.fn.zTree.init($("#parentResourceTree"),$.extend({check:{enable:!0,chkStyle:"radio"}},e),t),window.fuzzySearch("resourceTree","#resourceKey",null,!0)})}r.csHide("bm"),r.editTitle="新增系统资源",r.model={status:1},r.isUpdate=!1,r.isSubmit=!1,r.createResource=n,r.createSave=function(){var t=s.getCheckedNodes(!0);0<t.length&&(r.model.parentId=t[0].resId),o.createResource(r,function(){l()})},r.updateSave=function(){if(util.initJqValidation(),$("form").valid()){var t=s.getCheckedNodes(!0);0<t.length&&(r.model.parentId=t[0].resId),o.updateResource(r,function(){l()})}},r.resetResource=function(){o.resetResource(r,function(){l()})},l()}})})}(),function(){"use strict";angular.module("myApp").factory("resourceSvc",function(n,i){var r=util.formatUrl("sys/resource");return{getResourceData:function(e,i){n.get(r+"?$orderby=itemOrder asc").success(function(t){e.resources=t,i&&i(t)})},findResourceById:function(e,i){n.get(r+"/"+(e.resId||"")).success(function(t){e.model=t,i&&i(t)})},createResource:function(t,e){util.initJqValidation(),$("form").valid()&&(t.isSubmit=!0,n.post(r,t.model).then(function(){t.isSubmit=!1,i.alert("创建成功"),e&&e()},function(){t.isSubmit=!1}))},updateResource:function(t,e){util.initJqValidation(),$("form").valid()&&(t.isSubmit=!0,n.put(r,t.model).then(function(){t.isSubmit=!1,i.alert("更新成功"),e&&e()},function(){t.isSubmit=!1}))},deleteResource:function(t,e){t.isSubmit=!0,n.delete(r,{data:t.resId||""}).then(function(){i.alert("删除成功"),t.isSubmit=!1,e&&e()},function(){t.isSubmit=!1})},resetResource:function(t,e){t.isSubmit=!0,n.post(r+"/reset").then(function(){t.isSubmit=!1,i.alert("系统资源已成功重置"),e&&e()},function(){t.isSubmit=!1})}}})}(),function(){"use strict";angular.module("myApp").config(function(t){t.state("role",{url:"/role",controllerAs:"vm",templateUrl:util.formatUrl("sys/role/html/list"),controller:function(i,n,r,e){i.csHide("bm");var o,a=this;a.role={},a.del=function(t){e.confirm("确认删除数据吗？",function(){a.roleId=t,n.deleteById(a)})},a.dels=function(){var t=$("#editTable").bootstrapTable("getSelections");if(0!=t.length){var i=[];$.each(t,function(t,e){i.push(e.roleId)}),a.del(i.join(","))}else e.warning("请选择要删除的数据")},a.authorization=function(t){a.roleId=t.roleId,a.displayName=t.displayName,function(t){o?e():r.getResourceData(i,function(t){t=t.value||[],o=$.fn.zTree.init($("#resourceTree"),{treeId:"resId",check:{enable:!0,chkboxType:{Y:"p",N:"s"}},data:{key:{name:"resName"},simpleData:{enable:!0,idKey:"resId",pIdKey:"parentId"}}},t),e()});function e(){o.checkAllNodes(!1),a.roleId=t.roleId,n.findRoleById(a,function(t){$.each(t.resources,function(t,e){o.checkNode(o.getNodeByParam("resId",e.resId),!0,!0)})})}}(t),$("#roleAuthorizationWin").modal("show")},a.toAuthorization=function(){o&&(a.resources=o.getCheckedNodes(!0),n.authorization(a))},a.start=function(t){n.stateEnable(t,a)},a.stop=function(t){n.stateDisable(t,a)},n.bsTableControl(a)}})})}(),function(){"use strict";function t(t){t.state("roleEdit",{url:"/roleEdit/:id",controllerAs:"vm",templateUrl:util.formatUrl("sys/role/html/edit"),controller:e})}function e(t,e,i){var n=this;n.roleId=e.params.id,n.role={roleState:"1"},n.roleId&&i.findRoleById(n),n.save=function(){n.roleId?i.update(n):i.create(n)}}angular.module("myApp").config(t),t.$inject=["$stateProvider"],e.$inject=["$scope","$state","roleSvc"]}(),function(){"use strict";angular.module("myApp").factory("roleSvc",function(n,i,e){var o=util.formatUrl("sys/role");return{bsTableControl:function(r){r.bsTableControl={options:util.getTableFilterOption({url:o,columns:[{title:"行号",width:50,switchable:!1,formatter:function(t,e,i){var n=r.bsTableControl.state;return n.pageNumber&&n.pageSize?i+1+(n.pageNumber-1)*n.pageSize:i+1}},{checkbox:!0},{field:"roleName",title:"角色名",sortable:!0,filterControl:"input",filterOperator:"like"},{field:"displayName",title:"角色显示名",sortable:!1,filterControl:"input",filterOperator:"like"},{field:"roleState",title:"状态",width:100,align:"center",filterControl:"input",filterOperator:"like",formatter:'<span class="bg-green" ng-if="row.roleState == 1">启用</span><span class="bg-red" ng-if="row.roleState != 1">禁用</span>'},{title:"操作",width:350,align:"center",formatter:$("#columnBtns").html()}]})}},create:function(t){util.initJqValidation(),$("form").valid()&&(t.isSubmit=!0,n.post(o,t.role).then(function(){t.isSubmit=!1,i.success("创建成功",function(){e.go("role")})},function(){t.isSubmit=!1}))},findRoleById:function(e,i){n.get(o+"/"+(e.roleId||"")).success(function(t){i?i(t):e.role=t})},update:function(t){util.initJqValidation(),$("form").valid()&&(t.isSubmit=!0,n.put(o,t.role).then(function(){t.isSubmit=!1,i.success("更新成功")},function(){t.isSubmit=!1}))},deleteById:function(t){t.isSubmit=!0,n.delete(o,{params:{roleId:t.roleId||""}}).then(function(){t.isSubmit=!1,i.success("删除成功"),t.bsTableControl.refresh()},function(){t.isSubmit=!1})},authorization:function(t){t.roleId?(t.isSubmit=!0,n.put(o+"/authorization?roleId="+t.roleId,t.resources).then(function(){t.isSubmit=!1,i.success("权限更新成功")},function(){t.isSubmit=!1})):i.warning("缺少参数")},stateEnable:function(t,e){n.put(o+"/enable?id="+t).then(function(){e.isSubmit=!1,i.success("状态已启用"),e.bsTableControl.refresh()},function(){e.isSubmit=!1})},stateDisable:function(t,e){n.put(o+"/disable?id="+t).then(function(){e.isSubmit=!1,i.success("状态已停用"),e.bsTableControl.refresh()},function(){e.isSubmit=!1})},findRoles:function(e,t,i){angular.isFunction(t)?(i=t,t=""):t=t||"",n.get(o,{params:t}).success(function(t){i?i(t):e.roles=t})},findUserRoles:function(e,t,i){angular.isFunction(t)?(i=t,t=""):t=t||"",n.get(o+"/userRoles",{params:{userId:t}}).success(function(t){i?i(t):e.roles=t})}}})}(),function(){"use strict";function t(t){t.state("sysVariable",{url:"/sysVariable",controllerAs:"vm",templateUrl:util.formatUrl("sys/variable/html/list"),controller:e})}function e(t,e,n){t.csHide("bm");var r=this;r.del=function(t){n.confirm("确认删除数据吗？",function(){r.varId=t,e.deleteById(r)})},r.dels=function(){var t=$("#editTable").bootstrapTable("getSelections");if(0!=t.length){var i=[];$.each(t,function(t,e){i.push(e.varId)}),r.del(i.join(","))}else n.warning("请选择要删除的数据")},e.bsTableControl(r)}angular.module("myApp").config(t),t.$inject=["$stateProvider"],e.$inject=["$scope","sysVariableSvc","bsWin"]}(),function(){"use strict";function t(t){t.state("sysVariableEdit",{url:"/sysVariableEdit/:id",controllerAs:"vm",templateUrl:util.formatUrl("sys/variable/html/edit"),controller:e})}function e(t,e){var i=this;i.varId=t.params.id,i.varId&&e.findById(i),i.save=function(){i.varId?e.update(i):e.create(i)}}angular.module("myApp").config(t),t.$inject=["$stateProvider"],e.$inject=["$state","sysVariableSvc"]}(),function(){"use strict";function t(n,e,i){var o=util.formatUrl("sys/variable");return{bsTableControl:function(r){r.bsTableControl={options:util.getTableFilterOption({url:o,columns:[{title:"行号",width:50,switchable:!1,formatter:function(t,e,i){var n=r.bsTableControl.state;return n.pageNumber&&n.pageSize?i+1+(n.pageNumber-1)*n.pageSize:i+1}},{checkbox:!0},{field:"varCode",title:"系统变量编码",sortable:!0,width:150,filterControl:"input",filterOperator:"like"},{field:"varName",title:"系统变量名",sortable:!1,width:150,filterControl:"input",filterOperator:"like"},{field:"typeName",title:"系统变量类型",width:150,sortable:!1,filterControl:"input",filterOperator:"like"},{field:"varValue",title:"系统变量值",width:200,sortable:!1,filterControl:"input",filterOperator:"like"},{field:"remark",title:"备注",sortable:!1,filterControl:"input",filterOperator:"like"},{title:"操作",width:150,align:"center",formatter:$("#columnBtns").html()}]})}},create:function(t){util.initJqValidation(),$("form").valid()&&(t.isSubmit=!0,n.post(o,t.model).then(function(){t.isSubmit=!1,e.success("创建成功",function(){i.go("role")})},function(){t.isSubmit=!1}))},findById:function(e,i){n.get(o+"/"+(e.varId||"")).success(function(t){i?i(t):e.model=t})},update:function(t){util.initJqValidation(),$("form").valid()&&(t.isSubmit=!0,n.put(o,t.model).then(function(){t.isSubmit=!1,e.success("更新成功"),$("#editTable").bootstrapTable("refresh")},function(){t.isSubmit=!1}))},deleteById:function(t){t.isSubmit=!0,n.delete(o,{params:{varId:t.varId||""}}).then(function(){t.isSubmit=!1,e.success("删除成功"),$("#editTable").bootstrapTable("refresh")},function(){t.isSubmit=!1})}}}angular.module("myApp").factory("sysVariableSvc",t),t.$inject=["$http","bsWin","$state"]}(),function(){"use strict";function t(t){t.state("user",{url:"/user",controllerAs:"vm",templateUrl:util.formatUrl("sys/user/html/list"),controller:e})}function e(n,e,t,i,r){n.csHide("bm");var o,a=this,s={field:"organ.organRel",operator:"like",value:"|"};function l(t){a.organName=t.oldname||t.organName||"-",a.organId=t.organId,s.value="|"+t.organId+"|",e.reloadBsTable(a,s)}function u(){o&&o.destroy(),t.getOrganList(a,function(t){var e=(o=$.fn.zTree.init($("#organTree"),{treeId:"organId",data:{key:{name:"organName"},simpleData:{enable:!0,idKey:"organId",pIdKey:"parentId"}},callback:{onClick:function(t,e,i){n.$apply(function(){l(i)})}}},t)).getNodeByParam("parentId",null);o.expandNode(e,!0),l(e),window.fuzzySearch("organTree","#organKey",null,!0)})}e.bsTableControl(a,s),a.resetPwd=function(t){a.userId=t,e.resetPwd(a)},a.del=function(t){a.userId=t,r.confirm("确认删除数据吗？",function(){e.deleteUser(a)})},a.dels=function(){var t=a.bsTableControl.getSelections();if(0!=t.length){var i=[];$.each(t,function(t,e){i.push(e.userId)}),a.del(i.join(","))}else r.warning("请选择要删除的数据")},a.start=function(t){a.userId=t.userId,e.enableUser(a)},a.stop=function(t){a.userId=t.userId,e.disableUser(a)},u(),a.initOrganTree=u,a.openUserEditWin=function(t){c.modal("show"),t?(a.isUpdate=!0,a.userId=t,e.findUserById(a,function(t){a.model=t})):(a.isUpdate=!1,a.model={useState:1,organ:{organId:a.organId}})};var c=$("#organUserEditModel").on("hidden.bs.modal",function(t){n.$apply(function(){a.model=null})});a.saveUser=function(){a.isUpdate?e.updateUser(a,function(){c.modal("hide"),$("#editTable").bootstrapTable("refresh")}):e.createUser(a,function(){c.modal("hide"),$("#editTable").bootstrapTable("refresh")})};var d=$("#userRolesModel");a.setRoles=function(t){a.userId=t.userId,d.modal("show"),i.findUserRoles(a,a.userId,function(t){a.roles=t||[]})},a.toSetRoles=function(){var i=[];d.find("input[name='roleId']:checked").each(function(t,e){this.disabled||i.push(this.value)}),e.toSetRoles(a,i.join(","))}}angular.module("myApp").config(t),t.$inject=["$stateProvider"],e.$inject=["$scope","userSvc","organSvc","roleSvc","bsWin"]}(),function(){"use strict";angular.module("myApp").config(function(t,e){t.state("userEdit",{url:"/userEdit/:id",controllerAs:"vm",templateUrl:util.formatUrl("sys/user/html/edit"),controller:function(t,e,i){t.csHide("基础管理");var n=this;n.userId=i.params.id,n.isUpdate=!1,n.userId?(n.isUpdate=!0,e.findUserById(n)):n.model={useState:1},n.save=function(){n.isUpdate?e.updateUser(n):e.createUser(n,function(){i.go("user")})}}})})}(),function(){"use strict";function t(r,o){var a=util.formatUrl("sys/user"),e=util.formatUrl("rsaKey");return{reloadBsTable:function(t,e){var i=t.bsTableControl.options;i.url=a,e&&(i.defaultFilters=e)},bsTableControl:function(r,t){r.bsTableControl={options:util.getTableFilterOption({defaultFilters:t,defaultSort:"itemOrder asc,createdDate desc",columns:[{title:"行号",switchable:!1,width:50,formatter:function(t,e,i){var n=r.bsTableControl.state;return n.pageNumber&&n.pageSize?i+1+(n.pageNumber-1)*n.pageSize:i+1}},{checkbox:!0},{field:"username",title:"用户名",sortable:!0,width:150,filterControl:"input",filterOperator:"like"},{field:"displayName",title:"姓名",width:150,sortable:!0,filterControl:"input",filterOperator:"like"},{field:"organ.organName",title:"所属机构",sortable:!1,width:200,filterControl:"input",filterOperator:"like"},{field:"useState",title:"状态",width:100,align:"center",filterControl:"input",filterOperator:"like",formatter:'<span ng-if="row.useState == 1" class="bg-green">启用</span><span ng-if="row.useState != 1"  class="bg-red">禁用</span>'},{field:"lastLoginDate",title:"最后登录时间",width:160,sortable:!0,filterControl:"datepicker",filterOperator:"gt"},{field:"remark",title:"备注",filterControl:"input",filterOperator:"like"},{field:"",title:"操作",width:200,formatter:$("#userColumnBtns").html()}]})}},createUser:function(i,t){function n(){r.post(a,i.model).then(function(){i.isSubmit=!1,o.success("创建成功"),t&&t()},function(){i.isSubmit=!1})}util.initJqValidation(),$("form").valid()&&(i.isSubmit=!0,i.model.password?$.get(e).success(function(t){var e=new JSEncrypt;e.setPublicKey(t||""),i.model.password=e.encrypt(i.model.password),i.model.verifyPassword=e.encrypt(i.model.verifyPassword),n()}):n())},findUserById:function(e,i){if(!e.userId)return!1;r.get(a+"/"+e.userId).success(function(t){t=t||{},i?i(t):e.model=t})},updateUser:function(t,e){util.initJqValidation(),$("form").valid()&&(t.isSubmit=!0,r.put(a,t.model).then(function(){t.isSubmit=!1,o.success("更新成功"),e&&e()},function(){t.isSubmit=!1}))},enableUser:function(t,e){if(!t.userId)return!1;t.isSubmit=!0,r.put(a+"/enable?id="+t.userId).then(function(){t.isSubmit=!1,o.success("启用成功"),$("#editTable").bootstrapTable("refresh"),e&&e()},function(){t.isSubmit=!1})},disableUser:function(t,e){t.isSubmit=!0,r.put(a+"/disable?id="+t.userId).then(function(){t.isSubmit=!1,o.success("禁用成功"),$("#editTable").bootstrapTable("refresh"),e&&e()},function(){t.isSubmit=!1})},deleteUser:function(t){if(!t.userId)return!1;t.isSubmit=!0,r.delete(a+"?userId="+t.userId).then(function(){o.success("删除成功"),t.bsTableControl.refresh(),t.isSubmit=!1},function(){t.isSubmit=!1})},resetPwd:function(t,e){if(!(e=e||t.userId))return o.warning("缺少参数"),!1;o.confirm("您是否要重置用户密码？",function(){t.isSubmit=!0,r.put(a+"/resetPwd",e).then(function(){t.isSubmit=!1,o.success("用户密码已重置成功")},function(){t.isSubmit=!1})})},userResources:function(e,t,i){r.get(a+"/resources",{params:t}).success(function(t){i?i(t):e.menus=t})},toSetRoles:function(t,e){if(!t.userId)return o.warning("缺少参数"),!1;t.isSubmit=!0,r.post(a+"/setRoles",{},{params:{userId:t.userId,roleIds:e}}).then(function(){t.isSubmit=!1,o.success("用户角色设置成功")},function(){t.isSubmit=!1})}}}angular.module("myApp").factory("userSvc",t),t.$inject=["$http","bsWin"]}();