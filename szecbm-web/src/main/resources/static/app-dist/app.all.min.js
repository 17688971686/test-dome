!function(){"use strict";function t(r,e,t,n,i){$("#topMenuBox");var o=$("#leftMenuBox");r.$on("$stateChangeStart",function(t,e,n,i,o){t&&$(".uploadify").each(function(){$(this).uploadify("destroy")})}),r.$on("$stateChangeSuccess",function(t,e,n,i,o){r.previousState_name=i.name,r.previousState_params=o}),r.backPrevPage=function(t){t=t||"welcome",e.go(r.previousState_name||t,r.previousState_params)},r.csHide=function(t){t&&t!=r.menuBoxResId&&(0<$("#menu_"+t).length?r.menuBoxResId=t:r.menuBoxResId="pm")},i.initMenus(r,function(t){r.menuBoxResId||(r.menuBoxResId="pm"),o.append(n(t)(r))}),i.initDicts(r)}function e(t,e,n){e.parentSelector="#loading-bar-container",e.spinnerTemplate='<div style="position:fixed;width:100%;height:100%;left:0;top:0; z-index:99;background:rgba(0, 0, 0, 0.3);overflow: hidden;"><div style="position: absolute;top:30%; width: 400px;height:40px;left:50%;"><i class="fa fa-spinner fa-pulse fa-1x fa-fw"></i>程序处理中...</div></div>',t.otherwise("/welcome"),n.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|javascript):/)}function n(t){t.$on("$viewContentLoaded",function(t){jQuery.AdminLTE.layout&&(jQuery.AdminLTE.layout.fix(),jQuery.AdminLTE.layout.fixSidebar())})}angular.module("myApp",["ui.router","angular-loading-bar","bsTable","sn.common"]).config(e).run(n).controller("indexCtrl",t),t.$inject=["$scope","$state","$http","$compile","snBaseUtils"],e.$inject=["$urlRouterProvider","cfpLoadingBarProvider","$compileProvider"],n.$inject=["$rootScope"];var i=$('<div><i class="fa fa-chevron-up"></i></div>').css({position:"fixed",bottom:"20px",right:"25px",width:"40px",height:"40px",color:"#eee","font-size":"","line-height":"40px","text-align":"center","background-color":"#222d32",cursor:"pointer","border-radius":"5px","z-index":"99999",opacity:".7",display:"none"}).on({mouseenter:function(){i.css("opacity","1")},mouseout:function(){i.css("opacity",".7")},click:function(){$("html,body").animate({scrollTop:top},500)}});$(".wrapper").append(i),$(window).scroll(function(){150<=$(window).scrollTop()?i.is(":visible")||i.fadeIn(500):i.fadeOut(500)})}(),function(){"use strict";function t(t){t.state("projectManageCancel",{url:"/projectManageCancel",controllerAs:"vm",templateUrl:util.formatUrl("project/html/cancel"),controller:e})}function e(t,e,n){t.csHide("cjgl");var i=this;i.model={},e.bsTableCancelManagement(i),i.expProinfo=function(){e.createProReport(i)},i.restore=function(t){i.model=t,i.model.status="1",n.confirm("是否恢复项目",function(){e.restoreInvestProject(i)})},i.delete=function(t){n.confirm("是否删除项目，删除后数据不可恢复",function(){e.deleteGovernmentInvestProject(t)})}}angular.module("myApp").config(t),t.$inject=["$stateProvider"],e.$inject=["$scope","projectManagerSvc","bsWin"]}(),function(){"use strict";function t(t){t.state("projectManageEdit",{url:"/projectManageEdit/:id/:flag",controllerAs:"vm",templateUrl:util.formatUrl("project/html/edit"),controller:e})}function e(t,n,e,i){t.csHide("cjgl");var o=this;o.model={},o.model.id=e.params.id,o.flag=e.params.flag,o.attachments=[],n.initUploadConfig(o,"relateAttach",function(t){o.attachments=o.attachments.concat(JSON.parse(t))}),o.model.id?n.findGovernmentInvestProjectById(o,function(){n.getAttachments(o,{businessId:o.model.id},function(t){angular.forEach(o.attachments.concat(t),function(t,e){o.attachments=o.attachments.concat(t)})})}):n.createUUID(o),o.removeFile=function(t,e){i.confirm("是否移除附件",function(){n.deleteFileById(t,o),o.attachments.splice(e,1)})},o.checkLength=function(t,e,n){util.checkLength(t,e,n)},o.save=function(){util.initJqValidation(),$("form").valid()&&(o.model.id?n.updateGovernmentInvestProject(o):(o.model.id=o.UUID,o.model.status="1",n.createGovernmentInvestProject(o)))}}angular.module("myApp").config(t),t.$inject=["$stateProvider"],e.$inject=["$scope","projectManagerSvc","$state","bsWin"]}(),function(){"use strict";function t(t){t.state("projectManage",{url:"/projectManage",controllerAs:"vm",templateUrl:util.formatUrl("project/html/list"),controller:e})}function e(t,e,n){var i=this;i.model={},e.bsTableControlForManagement(i),i.expProinfo=function(){e.createProReport(i)},i.cancel=function(t){i.model=t,i.model.status="2",n.confirm("是否作废项目",function(){e.cancelInvestProject(i)})}}angular.module("myApp").config(t),t.$inject=["$stateProvider"],e.$inject=["$scope","projectManagerSvc","bsWin"]}(),function(){"use strict";function t(i,o,e){var r=util.formatUrl("project"),a=util.formatUrl("sys/sysfile");return{bsTableControlForManagement:function(o,t,e){o.bsTableControlForManagement={options:util.getTableFilterOption({url:r+"/proInfo",defaultFilters:e,columns:[{title:"序号",switchable:!1,align:"center",width:50,formatter:function(t,e,n){var i=o.bsTableControlForManagement.state;return i.pageNumber&&i.pageSize?n+1+(i.pageNumber-1)*i.pageSize:n+1}},{field:"fileCode",title:"收文编号",width:100,filterControl:"input"},{field:"projectName",title:"项目名称",width:200,sortable:!1,filterControl:"input",filterOperator:"like",formatter:'<a href="#/projectManageView/{{row.id}}/view" style="color:blue">{{row.projectName}}</a>'},{field:"reviewStage",title:"评审阶段",width:100,filterControl:"input"},{field:"proUnit",title:"项目单位",width:90,filterControl:"input"},{field:"reviewDept",title:"评审部门",width:90,filterControl:"input"},{field:"mainUser",title:"项目负责人",width:90,filterControl:"input"},{field:"dispatchDate",title:"发文日期",width:90,filterControl:"input"},{field:"fileNum",title:"发文号",width:90,filterControl:"input"},{field:"fileDate",title:"存档日期",width:90,filterControl:"input"},{field:"fileNo",title:"存档号",width:90,filterControl:"input"},{field:"remark",title:"备注",width:90,filterControl:"input"},{field:"id",title:"操作",width:240,formatter:$("#columnBtns").html()}]})}},bsTableCancelManagement:function(o,t,e){o.bsTableCancelManagement={options:util.getTableFilterOption({url:r+"/cancelInfo",defaultFilters:e,columns:[{title:"序号",switchable:!1,align:"center",width:50,formatter:function(t,e,n){var i=o.bsTableCancelManagement.state;return i.pageNumber&&i.pageSize?n+1+(i.pageNumber-1)*i.pageSize:n+1}},{field:"fileCode",title:"收文编号",width:100,filterControl:"input"},{field:"projectName",title:"项目名称",width:200,sortable:!1,filterControl:"input",filterOperator:"like",formatter:'<a href="#/projectManageView/{{row.id}}/cancelView" style="color:blue">{{row.projectName}}</a>'},{field:"reviewStage",title:"评审阶段",width:100,filterControl:"input"},{field:"proUnit",title:"项目单位",width:90,filterControl:"input"},{field:"reviewDept",title:"评审部门",width:90,filterControl:"input"},{field:"mainUser",title:"项目负责人",width:90,filterControl:"input"},{field:"dispatchDate",title:"发文日期",width:90,filterControl:"input"},{field:"fileNum",title:"发文号",width:90,filterControl:"input"},{field:"fileDate",title:"存档日期",width:90,filterControl:"input"},{field:"fileNo",title:"存档号",width:90,filterControl:"input"},{field:"remark",title:"备注",width:90,filterControl:"input"},{field:"id",title:"操作",width:240,formatter:$("#columnBtns").html()}]})}},findGovernmentInvestProjectById:function(e,n){i.get(r+"/findById",{params:{id:e.model.id||""}}).then(function(t){e.model=t.data,n&&n()})},createGovernmentInvestProject:function(t){i.post(r,t.model).then(function(){o.success("创建成功"),e.go("projectManage")})},deleteGovernmentInvestProject:function(t){i.delete(r,{params:{id:t||""}}).then(function(){o.success("删除成功"),$("#listTable").bootstrapTable("refresh")})},updateGovernmentInvestProject:function(t){i.put(r,t.model).then(function(){o.success("更新成功")})},restoreInvestProject:function(t){i.post(r+"/restore",t.model).then(function(){o.success("项目恢复成功"),$("#listTable").bootstrapTable("refresh")})},cancelInvestProject:function(t){i.post(r+"/cancel",t.model).then(function(){o.success("项目作废成功"),$("#listTable").bootstrapTable("refresh")})},createProReport:function(t){window.open(r+"/exportPro2?fileCode=22")},getAttachments:function(t,e,n){i.get(a+"/findByBusinessId",{params:e}).success(function(t){n(t)})},initUploadConfig:function(e,t,i){$("#"+t).uploadify({uploader:util.formatUrl("sys/sysfile/fileUpload"),swf:util.formatUrl("libs/uploadify/uploadify.swf"),buttonText:"相关附件",method:"post",multi:!0,auto:!0,fileObjName:"files",fileSizeLimit:"40MB",fileExt:"*.pdf;*.txt;*.png;*.doc",fileTypeExts:"*.pdf;*.txt;*.png;*.doc",fileTypeDesc:"请选择*.pdf;*.txt;*.png;*.doc文件",removeCompleted:!0,onUploadStart:function(t){$("#relateAttach").uploadify("settings","formData",{businessId:e.model.id?e.model.id:e.UUID})},onUploadSuccess:function(t,e,n){i(e),angular.element("body").scope().$apply(function(){o.success("上传成功")})},onCancel:function(t){o.confirm("询问提示","确认删除该文件吗？",function(){})},onUploadError:function(t,e,n,i){angular.element("body").scope().$apply(function(){o.error("上传失败")})}})},createUUID:function(e){i.get(r+"/createUUID").success(function(t){e.UUID=t||[]})},deleteFileById:function(t,e,n){i.delete(a,{params:{sysFileId:t||""}}).then(function(){o.success("删除成功"),angular.isFunction(n)&&n()}).then(function(){})}}}angular.module("myApp").factory("projectManagerSvc",t),t.$inject=["$http","bsWin","$state"]}(),function(){"use strict";function t(t){t.state("projectManageView",{url:"/projectManageView/:id/:flag",controllerAs:"vm",templateUrl:util.formatUrl("project/html/view"),controller:e})}function e(t,e,n,i,o){t.csHide("cjgl");var r=this;r.model={},r.model.id=n.params.id,r.flag=n.params.flag,r.attachments=[],e.initUploadConfig(r,"relateAttach",function(t){r.attachments=r.attachments.concat(JSON.parse(t))}),r.model.id?e.findGovernmentInvestProjectById(r,function(){e.getAttachments(r,{businessId:r.model.id},function(t){angular.forEach(r.attachments.concat(t),function(t,e){r.attachments=r.attachments.concat(t)})}),"cancel"==r.flag||"normal"==r.flag?("cancel"==r.flag?r.model.status="2":r.model.status="1",e.updateGovernmentInvestProject(r)):"delete"==r.flag&&e.deleteGovernmentInvestProject(r.model.id)}):e.createUUID(r)}angular.module("myApp").config(t),t.$inject=["$stateProvider"],e.$inject=["$scope","projectManagerSvc","$state","bsWin","attachmentSvc"]}(),function(){"use strict";angular.module("myApp").config(function(t){var r=util.formatUrl("admin/userInfo");t.state("userInfo",{url:"/userInfo",controllerAs:"vm",templateUrl:r,controller:function(t,n,i){var o=this;o.isSubmit=!1,o.toUpdate=function(){if(util.initJqValidation(),$("form").valid()){var e=new JSEncrypt;n.get(util.formatUrl("rsaKey")).success(function(t){e.setPublicKey(t||""),o.model.oldPassword&&(o.model.oldPassword=e.encrypt(o.model.oldPassword),o.model.newPassword=e.encrypt(o.model.newPassword),o.model.verifyPassword=e.encrypt(o.model.verifyPassword)),o.isSubmit=!0,n.put(r,o.model).then(function(){o.isSubmit=!1,i.success("修改成功")},function(){o.isSubmit=!1})})}}}})})}(),function(){"use strict";function t(t){t.state("welcome",{url:"/welcome",templateUrl:util.formatUrl("admin/welcome"),controllerAs:"vm",controller:e})}function e(t,e){var n=this;n.getOperatorLogList=function(){e.getOperatorLogList(n,{$orderby:"createdDate desc",$top:5})}}angular.module("myApp").config(t),t.$inject=["$stateProvider"],e.$inject=["$scope","operatorLogSvc"]}(),function(){"use strict";angular.module("myApp").factory("welcomeSvc",function(t,e){util.formatUrl("admin");return{}})}(),function(){"use strict";angular.module("myApp").config(function(t){t.state("dict",{url:"/dict",controllerAs:"vm",templateUrl:util.formatUrl("sys/dict/html/list"),controller:function(t,e,n){t.csHide("bm");var i=this;i.dict={},i.dels=function(){var t=i.dictsTree.getSelectedNodes();t&&0<t.length?i.del(t[0].dictId):n.confirm("请选择数据")},i.del=function(t){i.dict.dictId=t,n.confirm("删除字典将会连下级字典一起删除，确认删除数据吗？",function(){e.deleteDict(i)})},i.resetDict=function(){n.confirm("您确定要重置数据字典吗？",function(){e.resetDict(i)})},e.initDictTree(i)}})})}(),function(){"use strict";angular.module("myApp").config(function(t){t.state("dict.edit",{url:"/dictEdit/:dictId",controllerAs:"vm",templateUrl:util.formatUrl("sys/dict/html/edit"),controller:function(t,e,n){t.csHide("bm");var i=this;i.dict={},i.dictId=n.params.dictId,i.dictId&&(i.isUpdate=!0),i.isUpdate?e.findDictById(i):e.initpZtreeClient(i),i.create=function(){if(i.dictsTree){var t=i.dictsTree.getCheckedNodes(!0);t&&0!=t.length&&(i.dict.parentId=t[0].dictId)}e.createDict(i)},i.update=function(){e.updateDict(i)},i.dictTypeChange=function(){i.dict.dictType&&(i.dict.dictKey="")}}})})}(),function(){"use strict";angular.module("myApp").factory("dictSvc",function(n,e,i){var o=util.formatUrl("sys/dict");return{initDictTree:r,initpZtreeClient:function(e){e.dictsTree&&e.dictsTree.destroy(),n.get(o+"?$orderby=itemOrder asc").success(function(t){e.dictsTree=$.fn.zTree.init($("#pzTree"),{check:{enable:!0,chkStyle:"radio",radioType:"all"},data:{key:{name:"dictName"},simpleData:{enable:!0,idKey:"dictId",pIdKey:"parentId",rootPId:0}}},t||[])})},createDict:function(t){util.initJqValidation(),$("form").valid()&&(t.isSubmit=!0,n.post(o,t.dict).then(function(){e.success("创建成功"),t.isSubmit=!1,r(t)},function(){t.isSubmit=!1}))},findDictById:function(e){if(!e.dictId)return!1;n.get(o+"/"+e.dictId).success(function(t){e.dict=t})},updateDict:function(t){util.initJqValidation(),$("form").valid()&&(t.isSubmit=!0,n.put(o,t.dict).then(function(){e.success("更新成功"),t.isSubmit=!1,r(t)},function(){t.isSubmit=!1}))},deleteDict:function(t){t.isSubmit=!0,n.delete(o,{params:{dictId:t.dict.dictId||""}}).then(function(){e.success("删除成功"),t.isSubmit=!1,r(t)},function(){t.isSubmit=!1})},resetDict:function(t){t.isSubmit=!0,n.post(o+"/reset",{}).then(function(){e.success("操作成功"),t.isSubmit=!1,r(t)},function(){t.isSubmit=!1})}};function r(e){e.dictsTree&&e.dictsTree.destroy(),n.get(o+"?$orderby=itemOrder asc").success(function(t){e.dictsTree=$.fn.zTree.init($("#zTree"),{callback:{onClick:function(t,e,n){i.go("dict.edit",{dictId:n.dictId})}},data:{key:{name:"dictName"},simpleData:{enable:!0,idKey:"dictId",pIdKey:"parentId",rootPId:0}}},t||[]),window.fuzzySearch("zTree","#dictTreeKey",null,!0)})}})}(),function(){"use strict";angular.module("myApp").config(function(t){t.state("attachment",{url:"/attachment",controllerAs:"vm",templateUrl:util.formatUrl("sys/attachment/html/list"),controller:function(t,e,i){t.csHide("bm");var o=this;o.attachment={},o.del=function(t){i.confirm("确认删除数据吗？",function(){e.deleteById(o,t,function(){o.bsTableControl.refresh()})})},o.dels=function(){var t=$("#editTable").bootstrapTable("getSelections");if(0!=t.length){var n=[];$.each(t,function(t,e){n.push(e.id)}),o.del(n.join(","))}else i.warning("请选择要删除的数据")},e.bsTableControl(o)}})})}(),function(){"use strict";angular.module("myApp").config(function(t){t.state("attachmentEdit",{url:"/attachmentEdit/:id",controllerAs:"vm",templateUrl:util.formatUrl("sys/attachment/html/edit"),controller:function(e,t,n,o){e.csHide("bm");var i=this;i.attachment={},i.attachmentId=n.params.id,i.attachment.publicAtt=!0,i.attachmentId&&t.findDocById(i.attachmentId,i),i.save=function(){if(i.attachmentId)i.attachment.id=i.attachmentId,t.update(i);else{if(!i.attachment.id)return void o.alert("请先上传文档！");t.create(i)}},$("#orginalFiles").uploadify({uploader:util.formatUrl("sys/attachment/upload"),swf:util.formatUrl("libs/uploadify/uploadify.swf"),method:"post",multi:!0,auto:!0,fileObjName:"files",fileSizeLimit:"10MB",buttonText:"选择文档",fileExt:"*.pdf;*.txt;*.png;*.doc",fileTypeExts:"*.pdf;*.txt;*.png;*.doc;*png;*.docx;*.xls;*.xlsx;*.ppt;*.pptx;*.ceb",fileTypeDesc:"请选择*.pdf;*.txt;*.png;*.doc文件",removeCompleted:!0,onUploadStart:function(t){if(!i.attachment.tableKey)return o.error("参数错误！"),!1;i.attachment.id&&$("#orginalFiles").uploadify("settings","formData",{attId:i.attachment.id}),$("#orginalFiles").uploadify("settings","formData",{tableKey:i.attachment.tableKey})},onUploadSuccess:function(t,e,n){angular.element("body").scope().$apply(function(){i.attachment.originalName=t.name.substring(0,t.name.indexOf(".")),o.alert("上传成功")})},onUploadError:function(t,e,n,i){angular.element("body").scope().$apply(function(){o.error("上传失败")})}}),i.backPrevPage=function(t){e.backPrevPage(t)}}})})}(),function(){"use strict";angular.module("myApp").factory("attachmentSvc",function(i,o){var r=util.formatUrl("sys/attachment");return{bsTableControl:function(o){o.bsTableControl={options:util.getTableFilterOption({url:r,defaultSort:"itemOrder desc",columns:[{title:"行号",width:50,switchable:!1,formatter:function(t,e,n){var i=o.bsTableControl.state;return i.pageNumber&&i.pageSize?n+1+(i.pageNumber-1)*i.pageSize:n+1}},{checkbox:!0},{field:"originalName",title:"文档名称",sortable:!0,filterControl:"input",filterOperator:"like",formatter:function(t,e,n){return'<a href="'+r+"/download/"+e.id+'" target="_blank">'+t+"</a>"}},{field:"docCategory",title:"文档分类",sortable:!0,filterControl:"input",filterOperator:"like",formatter:"{{DICT.ATTACHMENT.dicts.CATEGORY.dicts[row.docCategory].dictName}}"},{field:"attMonth",title:"所属月份",width:100,sortable:!0,filterControl:"input",filterOperator:"like"},{field:"publicAtt",title:"是否公开给业主",width:130,sortable:!1,align:"center",filterControl:"input",filterOperator:"like",formatter:function(t){return t?"是":"否"}},{field:"createdDate",title:"建档时间",width:200,sortable:!0,filterControl:"datepicker",filterOperator:"gt"},{field:"modifiedDate",title:"最后修改时间",width:200,sortable:!1,filterControl:"datepicker",filterOperator:"gt"},{field:"createdBy",title:"建档人",width:100,sortable:!1,filterControl:"input",filterOperator:"like"},{field:"",title:"操作",width:100,formatter:$("#columnBtns").html()}]})}},create:function(t){util.initJqValidation(),$("form").valid()&&(t.isSubmit=!0,i.put(r,t.attachment).then(function(){o.success("添加成功"),t.backPrevPage(),t.isSubmit=!1}).then(function(){t.isSubmit=!1}))},findDocById:function(e){i.get(r+"/findById",{params:{id:e.attachment.id}}).then(function(t){e.attachment=t.data})},update:function(t){util.initJqValidation(),$("form").valid()&&(t.isSubmit=!0,i.put(r,t.attachment).success(function(){t.isSubmit=!1,o.success("更新成功"),t.backPrevPage("attachment")}).then(function(){t.isSubmit=!1}))},deleteById:function(t,e,n){t.isSubmit=!0,i.delete(r,{params:{id:e||""}}).then(function(){o.success("删除成功"),angular.isFunction(n)&&n(),t.isSubmit=!1}).then(function(){t.isSubmit=!1})}}})}(),function(){"use strict";angular.module("myApp").config(function(t){t.state("operatorLog",{url:"/operatorLog",controllerAs:"vm",templateUrl:util.formatUrl("sys/operatorLog/html/list"),controller:function(t,e,n){t.csHide("bm");var i=this;i.model={},i.delLog=function(t){e.deleteLog(i,t)},e.bsTableControl(t)}})})}(),function(){"use strict";angular.module("myApp").factory("operatorLogSvc",function(n,i){var r=util.formatUrl("sys/operatorLog");return{bsTableControl:function(o){o.bsTableControl={options:util.getTableFilterOption({url:r,columns:[{title:"行号",switchable:!1,width:50,align:"left",formatter:function(t,e,n){var i=o.bsTableControl.state;return i.pageNumber&&i.pageSize?n+1+(i.pageNumber-1)*i.pageSize:n+1}},{field:"createdDate",title:"操作时间",width:100,sortable:!0,filterControl:"datepicker",filterOperator:"lte"},{field:"createdBy",title:"操作人",width:100,sortable:!0,filterControl:"input",filterOperator:"like"},{field:"businessType",title:"操作对象",width:100,sortable:!0,filterControl:"input",filterOperator:"like",formatter:function(t,e,n){return e.businessType+"["+e.operateType+"]"}},{field:"operateTime",title:"耗时",width:80,sortable:!0,align:"right",filterControl:"number"},{field:"ipAddress",title:"IP地址",width:100,align:"center",filterControl:"input",filterOperator:"like"},{field:"sucessFlag",title:"结果",width:60,filterControl:"input",filterOperator:"like",formatter:"<span ng-show='row.sucessFlag==1' class='bg-green'>成功</span><span ng-show='row.sucessFlag!=1' class='bg-red'>失败</span>"},{field:"message",title:"结果消息",width:120},{field:"oldInfo",title:"原数据",width:200,formatter:function(t,e,n){return t?"<textarea style='width: 100%' rows='4'>"+t+"</textarea>":"<textarea style='width: 100%' rows='4'> </textarea>"}},{field:"newInfo",title:"更新数据",width:200,formatter:function(t,e,n){return t?"<textarea style='width: 100%' rows='4'>"+t+"</textarea>":"<textarea style='width: 100%' rows='4'> </textarea>"}},{field:"updateInfo",title:"更新信息",width:200,formatter:function(t,e,n){return t?"<textarea style='width: 100%' rows='4'>"+t+"</textarea>":"<textarea style='width: 100%' rows='4'> </textarea>"}}]})}},getOperatorLogList:function(e,t){n.get(r,{params:t}).success(function(t){e.operatorLogList=t||{}})},deleteLog:function(t,e){t.isSubmit=!0,n.delete(r,{params:{days:e||""}}).then(function(){i.alert("删除成功"),t.isSubmit=!1,$("#editTable").bootstrapTable("refresh","")})}}})}(),function(){"use strict";function t(t){t.state("organ.add",{url:"/organAdd/:id",controllerAs:"vm",templateUrl:util.formatUrl("sys/organ/html/add"),controller:e})}function e(i,t,e){var n;(i.organId=e.params.id,i.isSubmit=!1,i.hasParent=!1,i.organId)?(i.hasParent=!0,t.findOrganById(i,function(t){i.parentOrgan=t,i.model={parentId:t.organId}})):i.$watch("organList",function(t){n&&n.destroy(),t&&0!=t.length?(i.hasParent=!1,n=$.fn.zTree.init($("#parentOrganTree"),{treeId:"organId",data:{key:{name:"organName"},simpleData:{enable:!0,idKey:"organId",pIdKey:"parentId"}},check:{enable:!0,chkStyle:"radio"},callback:{onCheck:function(t,e,n){n.checked&&i.$apply(function(){i.model||(i.model={}),i.model.parentId=n.organId})}}},t)):i.hasParent=!0});i.saveOrgan=function(){t.createOrgan(i,function(){e.go("organ",{},{reload:!0})})}}angular.module("myApp").config(t),t.$inject=["$stateProvider"],e.$inject=["$scope","organSvc","$state"]}(),function(){"use strict";function t(t){t.state("organ",{url:"/organ",controllerAs:"vm",templateUrl:util.formatUrl("sys/organ/html/list"),controller:e})}function e(n,r,i,e){n.csHide("bm"),n.deleteOrgan=function(t){n.organId=t,e.confirm("确认删除数据吗？",function(){i.deleteOrgan(vm)})};var o,a=$("#treeAddBtn"),l=$("#organTree"),s=l.attr("delete");function t(){o&&o.destroy(),i.getOrganList(n,function(t){var e=(o=$.fn.zTree.init(l,{treeId:"organId",data:{key:{name:"organName"},simpleData:{enable:!0,idKey:"organId",pIdKey:"parentId"}},edit:{enable:!0,removeTitle:"删除机构",showRemoveBtn:function(t,e){return!!s&&(0<e.organDataType&&!e.isParent)},showRenameBtn:!1},view:{addHoverDom:function(t,e){if(e.organType<2){var n=$("#"+e.tId+"_span");if(e.editNameFlag||0<$("#addBtn_"+e.tId).length)return;if(0<a.length){var i=util.format(a.html(),e.tId);n.after(i);var o=$("#addBtn_"+e.tId);o&&o.bind("click",function(){return r.go("organ.add",{id:e.organId}),!1})}}},removeHoverDom:function(t,e){$("#addBtn_"+e.tId).unbind().remove()},selectedMulti:!1},callback:{onClick:function(t,e,n){r.go("organ.edit",{id:n.organId})},beforeRemove:function(t,e){return n.$apply(function(){n.organId=e.organId,i.deleteOrgan(n,function(){n.organId=null,r.go("organ",{},{reload:!0})})}),!1},beforeDrag:function(){return!1}}},t)).getNodeByParam("parentId",null);o.expandNode(e,!0),window.fuzzySearch("organTree","#organKey",null,!0)})}t(),n.initOrganTree=t}angular.module("myApp").config(t),t.$inject=["$stateProvider"],e.$inject=["$scope","$state","organSvc","bsWin"]}(),function(){"use strict";function t(t){t.state("organ.edit",{url:"/organEdit/:id",controllerAs:"vm",templateUrl:util.formatUrl("sys/organ/html/edit"),controller:e})}function e(n,t,e,i){var o;n.organId=t.params.id,n.isSubmit=!1,n.organId&&e.findOrganById(n,function(t){(n.model=t).parentId&&e.findOrganById({organId:t.parentId},function(t){n.parentOrgan=t})}),n.saveOrgan=function(){e.updateOrgan(n,function(){n.initOrganTree&&n.initOrganTree()})},n.authorization=function(){!function(){o?e():i.getResourceData(n,function(t){t=t.value||[],o=$.fn.zTree.init($("#resourceTree"),{treeId:"resId",check:{enable:!0,chkboxType:{Y:"p",N:"s"}},data:{key:{name:"resName"},simpleData:{enable:!0,idKey:"resId",pIdKey:"parentId"}}},t),e()});function e(){o.checkAllNodes(!1),$.each(n.model.resources,function(t,e){o.checkNode(o.getNodeByParam("resId",e.resId),!0,!0)})}}(),$("#organAuthorizationWin").modal("show")},n.toAuthorization=function(){o&&(n.model.resources=o.getCheckedNodes(!0),e.authorization(n))}}angular.module("myApp").config(t),t.$inject=["$stateProvider"],e.$inject=["$scope","$state","organSvc","resourceSvc"]}(),function(){"use strict";function t(i,n){var o=util.formatUrl("sys/organ");return{getOrganList:function(e,n){i.get(o+"?$orderby=itemOrder asc").success(function(t){e.organList=t.value||[],n&&n(e.organList)})},findOrganList:function(e,n){i.get(o+"/findOrganList").then(function(t){n?n(t.data):e.organList=t.data})},createOrgan:function(t,e){util.initJqValidation(),$("form").valid()&&(t.isSubmit=!0,i.post(o,t.model).then(function(){t.isSubmit=!1,n.success("创建成功",function(){e&&e()})},function(){t.isSubmit=!1}))},findOrganById:function(e,n){i.get(o+"/"+(e.organId||"")).success(function(t){t=t||{},n?n(t):e.model=t})},updateOrgan:function(t,e){util.initJqValidation(),$("form").valid()&&(t.isSubmit=!0,i.put(o,t.model).then(function(){t.isSubmit=!1,n.success("更新成功",function(){e&&e()})},function(){t.isSubmit=!1}))},deleteOrgan:function(t,e){i.delete(o,{params:{organId:t.organId||""}}).then(function(){n.success("删除成功",function(){e&&e()})},function(){t.isSubmit=!1})},authorization:function(t){t.organId&&t.model?(t.isSubmit=!0,i.put(o+"/authorization?organId="+t.organId,t.model.resources||[]).then(function(){t.isSubmit=!1,n.success("权限更新成功")},function(){t.isSubmit=!1})):n.warning("缺少参数")}}}angular.module("myApp").factory("organSvc",t),t.$inject=["$http","bsWin"]}(),function(){"use strict";function t(t){t.state("organ.user",{url:"/organUser/:id",controllerAs:"vm",templateUrl:util.formatUrl("sys/organ/html/user"),controller:e})}function e(e,t,n,i,o){e.organId=t.params.id||"",e.isSubmit=!1,e.isUpdate=!1,e.openUserEditWin=function(t){r.modal("show"),t?(e.isUpdate=!0,e.userId=t,i.findUserById(e,function(t){e.model=t})):(e.isUpdate=!1,e.model={useState:1,organ:{organId:e.organId}})};var r=$("#organUserEditModel").on("hidden.bs.modal",function(t){e.$apply(function(){e.model=null})});e.saveUser=function(){e.isUpdate?i.updateUser(e,function(){r.modal("hide"),$("#editTable").bootstrapTable("refresh")}):i.createUser(e,function(){r.modal("hide"),$("#editTable").bootstrapTable("refresh")})},e.delUser=function(t){e.userId=t,o.confirm("确认删除数据吗？",function(){i.deleteUser(e)})},e.delUsers=function(){var t=$("#editTable").bootstrapTable("getSelections");if(0!=t.length){var n=[];$.each(t,function(t,e){n.push(e.userId)}),e.delUser(n.join(","))}else o.alert("请选择要删除的数据")},e.start=function(t){e.userId=t.userId,i.enableUser(e)},e.stop=function(t){e.userId=t.userId,i.disableUser(e)},n.findOrganById(e,function(t){e.organ=t}),i.bsTableControl(e,{field:"organ.organId",operator:"eq",value:e.organId}),i.reloadBsTable(e)}angular.module("myApp").config(t),t.$inject=["$stateProvider"],e.$inject=["$scope","$state","organSvc","userSvc","bsWin"]}(),function(){"use strict";angular.module("myApp").config(function(t){t.state("resource",{url:"/resource",controllerAs:"vm",templateUrl:util.formatUrl("sys/resource/html/list"),controller:function(o,r,t){function i(t){if(t)o.isUpdate=!0,o.editTitle="编辑系统资源",o.model||(o.model={}),o.resId=t,r.findResourceById(o,function(t){o.parentId=t.parentId;var e=l.getNodeByParam("resId",t.parentId);e&&l.checkNode(e,!0,!0)});else{o.model={status:1},o.isUpdate=!1,o.editTitle="新增系统资源";for(var e=l.getCheckedNodes(!0),n=0,i=e.length;n<i;n++)l.checkNode(e[n],!1,!0)}}var a,l;function s(){a&&a.destroy(),l&&l.destroy(),r.getResourceData(o,function(t){t=t.value||[];var e={treeId:"resId",data:{key:{name:"resName"},simpleData:{enable:!0,idKey:"resId",pIdKey:"parentId"}}};if(a=$.fn.zTree.init($("#resourceTree"),$.extend({edit:{enable:!0,removeTitle:"删除资源",showRemoveBtn:function(t,e){return!e.isParent},showRenameBtn:!1},callback:{onClick:function(t,e,n){o.$apply(function(){i(n.resId)})},beforeRemove:function(t,e){return o.$apply(function(){o.resId=e.resId,r.deleteResource(o,function(){o.resId=null,o.parentId=null,i(),s()})}),!1},beforeDrag:function(){return!1}}},e),t),o.parentId){var n=a.getNodeByParam("resId",o.parentId);a.expandNode(n,!0,!1,!0)}l=$.fn.zTree.init($("#parentResourceTree"),$.extend({check:{enable:!0,chkStyle:"radio"}},e),t),window.fuzzySearch("resourceTree","#resourceKey",null,!0)})}o.csHide("bm"),o.editTitle="新增系统资源",o.model={status:1},o.isUpdate=!1,o.isSubmit=!1,o.createResource=i,o.createSave=function(){var t=l.getCheckedNodes(!0);0<t.length&&(o.model.parentId=t[0].resId),r.createResource(o,function(){s()})},o.updateSave=function(){if(util.initJqValidation(),$("form").valid()){var t=l.getCheckedNodes(!0);0<t.length&&(o.model.parentId=t[0].resId),r.updateResource(o,function(){s()})}},o.resetResource=function(){r.resetResource(o,function(){s()})},s()}})})}(),function(){"use strict";angular.module("myApp").factory("resourceSvc",function(i,n){var o=util.formatUrl("sys/resource");return{getResourceData:function(e,n){i.get(o+"?$orderby=itemOrder asc").success(function(t){e.resources=t,n&&n(t)})},findResourceById:function(e,n){i.get(o+"/"+(e.resId||"")).success(function(t){e.model=t,n&&n(t)})},createResource:function(t,e){util.initJqValidation(),$("form").valid()&&(t.isSubmit=!0,i.post(o,t.model).then(function(){t.isSubmit=!1,n.alert("创建成功"),e&&e()},function(){t.isSubmit=!1}))},updateResource:function(t,e){util.initJqValidation(),$("form").valid()&&(t.isSubmit=!0,i.put(o,t.model).then(function(){t.isSubmit=!1,n.alert("更新成功"),e&&e()},function(){t.isSubmit=!1}))},deleteResource:function(t,e){t.isSubmit=!0,i.delete(o,{data:t.resId||""}).then(function(){n.alert("删除成功"),t.isSubmit=!1,e&&e()},function(){t.isSubmit=!1})},resetResource:function(t,e){t.isSubmit=!0,i.post(o+"/reset").then(function(){t.isSubmit=!1,n.alert("系统资源已成功重置"),e&&e()},function(){t.isSubmit=!1})}}})}(),function(){"use strict";angular.module("myApp").config(function(t){t.state("role",{url:"/role",controllerAs:"vm",templateUrl:util.formatUrl("sys/role/html/list"),controller:function(n,i,o,e){n.csHide("bm");var r,a=this;a.role={},a.del=function(t){e.confirm("确认删除数据吗？",function(){a.roleId=t,i.deleteById(a)})},a.dels=function(){var t=$("#editTable").bootstrapTable("getSelections");if(0!=t.length){var n=[];$.each(t,function(t,e){n.push(e.roleId)}),a.del(n.join(","))}else e.warning("请选择要删除的数据")},a.authorization=function(t){a.roleId=t.roleId,a.displayName=t.displayName,function(t){r?e():o.getResourceData(n,function(t){t=t.value||[],r=$.fn.zTree.init($("#resourceTree"),{treeId:"resId",check:{enable:!0,chkboxType:{Y:"p",N:"s"}},data:{key:{name:"resName"},simpleData:{enable:!0,idKey:"resId",pIdKey:"parentId"}}},t),e()});function e(){r.checkAllNodes(!1),a.roleId=t.roleId,i.findRoleById(a,function(t){$.each(t.resources,function(t,e){r.checkNode(r.getNodeByParam("resId",e.resId),!0,!0)})})}}(t),$("#roleAuthorizationWin").modal("show")},a.toAuthorization=function(){r&&(a.resources=r.getCheckedNodes(!0),i.authorization(a))},a.start=function(t){i.stateEnable(t,a)},a.stop=function(t){i.stateDisable(t,a)},i.bsTableControl(a)}})})}(),function(){"use strict";function t(t){t.state("roleEdit",{url:"/roleEdit/:id",controllerAs:"vm",templateUrl:util.formatUrl("sys/role/html/edit"),controller:e})}function e(t,e,n){var i=this;i.roleId=e.params.id,i.role={roleState:"1"},i.roleId&&n.findRoleById(i),i.save=function(){i.roleId?n.update(i):n.create(i)}}angular.module("myApp").config(t),t.$inject=["$stateProvider"],e.$inject=["$scope","$state","roleSvc"]}(),function(){"use strict";angular.module("myApp").factory("roleSvc",function(i,n,e){var r=util.formatUrl("sys/role");return{bsTableControl:function(o){o.bsTableControl={options:util.getTableFilterOption({url:r,columns:[{title:"行号",width:50,switchable:!1,formatter:function(t,e,n){var i=o.bsTableControl.state;return i.pageNumber&&i.pageSize?n+1+(i.pageNumber-1)*i.pageSize:n+1}},{checkbox:!0},{field:"roleName",title:"角色名",sortable:!0,filterControl:"input",filterOperator:"like"},{field:"displayName",title:"角色显示名",sortable:!1,filterControl:"input",filterOperator:"like"},{field:"roleState",title:"状态",width:100,align:"center",filterControl:"input",filterOperator:"like",formatter:'<span class="bg-green" ng-if="row.roleState == 1">启用</span><span class="bg-red" ng-if="row.roleState != 1">禁用</span>'},{title:"操作",width:350,align:"center",formatter:$("#columnBtns").html()}]})}},create:function(t){util.initJqValidation(),$("form").valid()&&(t.isSubmit=!0,i.post(r,t.role).then(function(){t.isSubmit=!1,n.success("创建成功",function(){e.go("role")})},function(){t.isSubmit=!1}))},findRoleById:function(e,n){i.get(r+"/"+(e.roleId||"")).success(function(t){n?n(t):e.role=t})},update:function(t){util.initJqValidation(),$("form").valid()&&(t.isSubmit=!0,i.put(r,t.role).then(function(){t.isSubmit=!1,n.success("更新成功")},function(){t.isSubmit=!1}))},deleteById:function(t){t.isSubmit=!0,i.delete(r,{params:{roleId:t.roleId||""}}).then(function(){t.isSubmit=!1,n.success("删除成功"),t.bsTableControl.refresh()},function(){t.isSubmit=!1})},authorization:function(t){t.roleId?(t.isSubmit=!0,i.put(r+"/authorization?roleId="+t.roleId,t.resources).then(function(){t.isSubmit=!1,n.success("权限更新成功")},function(){t.isSubmit=!1})):n.warning("缺少参数")},stateEnable:function(t,e){i.put(r+"/enable?id="+t).then(function(){e.isSubmit=!1,n.success("状态已启用"),e.bsTableControl.refresh()},function(){e.isSubmit=!1})},stateDisable:function(t,e){i.put(r+"/disable?id="+t).then(function(){e.isSubmit=!1,n.success("状态已停用"),e.bsTableControl.refresh()},function(){e.isSubmit=!1})},findRoles:function(e,t,n){angular.isFunction(t)?(n=t,t=""):t=t||"",i.get(r,{params:t}).success(function(t){n?n(t):e.roles=t})},findUserRoles:function(e,t,n){angular.isFunction(t)?(n=t,t=""):t=t||"",i.get(r+"/userRoles",{params:{userId:t}}).success(function(t){n?n(t):e.roles=t})}}})}(),function(){"use strict";function t(t){t.state("sysVariable",{url:"/sysVariable",controllerAs:"vm",templateUrl:util.formatUrl("sys/variable/html/list"),controller:e})}function e(t,e,i){t.csHide("bm");var o=this;o.del=function(t){i.confirm("确认删除数据吗？",function(){o.varId=t,e.deleteById(o)})},o.dels=function(){var t=$("#editTable").bootstrapTable("getSelections");if(0!=t.length){var n=[];$.each(t,function(t,e){n.push(e.varId)}),o.del(n.join(","))}else i.warning("请选择要删除的数据")},e.bsTableControl(o)}angular.module("myApp").config(t),t.$inject=["$stateProvider"],e.$inject=["$scope","sysVariableSvc","bsWin"]}(),function(){"use strict";function t(t){t.state("sysVariableEdit",{url:"/sysVariableEdit/:id",controllerAs:"vm",templateUrl:util.formatUrl("sys/variable/html/edit"),controller:e})}function e(t,e){var n=this;n.varId=t.params.id,n.varId&&e.findById(n),n.save=function(){n.varId?e.update(n):e.create(n)}}angular.module("myApp").config(t),t.$inject=["$stateProvider"],e.$inject=["$state","sysVariableSvc"]}(),function(){"use strict";function t(i,e,n){var r=util.formatUrl("sys/variable");return{bsTableControl:function(o){o.bsTableControl={options:util.getTableFilterOption({url:r,columns:[{title:"行号",width:50,switchable:!1,formatter:function(t,e,n){var i=o.bsTableControl.state;return i.pageNumber&&i.pageSize?n+1+(i.pageNumber-1)*i.pageSize:n+1}},{checkbox:!0},{field:"varCode",title:"系统变量编码",sortable:!0,width:150,filterControl:"input",filterOperator:"like"},{field:"varName",title:"系统变量名",sortable:!1,width:150,filterControl:"input",filterOperator:"like"},{field:"typeName",title:"系统变量类型",width:150,sortable:!1,filterControl:"input",filterOperator:"like"},{field:"varValue",title:"系统变量值",width:200,sortable:!1,filterControl:"input",filterOperator:"like"},{field:"remark",title:"备注",sortable:!1,filterControl:"input",filterOperator:"like"},{title:"操作",width:150,align:"center",formatter:$("#columnBtns").html()}]})}},create:function(t){util.initJqValidation(),$("form").valid()&&(t.isSubmit=!0,i.post(r,t.model).then(function(){t.isSubmit=!1,e.success("创建成功",function(){n.go("role")})},function(){t.isSubmit=!1}))},findById:function(e,n){i.get(r+"/"+(e.varId||"")).success(function(t){n?n(t):e.model=t})},update:function(t){util.initJqValidation(),$("form").valid()&&(t.isSubmit=!0,i.put(r,t.model).then(function(){t.isSubmit=!1,e.success("更新成功"),$("#editTable").bootstrapTable("refresh")},function(){t.isSubmit=!1}))},deleteById:function(t){t.isSubmit=!0,i.delete(r,{params:{varId:t.varId||""}}).then(function(){t.isSubmit=!1,e.success("删除成功"),$("#editTable").bootstrapTable("refresh")},function(){t.isSubmit=!1})}}}angular.module("myApp").factory("sysVariableSvc",t),t.$inject=["$http","bsWin","$state"]}(),function(){"use strict";function t(t){t.state("user",{url:"/user",controllerAs:"vm",templateUrl:util.formatUrl("sys/user/html/list"),controller:e})}function e(i,e,t,n,o){i.csHide("bm");var r,a=this,l={field:"organ.organRel",operator:"like",value:"|"};function s(t){a.organName=t.oldname||t.organName||"-",a.organId=t.organId,l.value="|"+t.organId+"|",e.reloadBsTable(a,l)}function c(){r&&r.destroy(),t.getOrganList(a,function(t){var e=(r=$.fn.zTree.init($("#organTree"),{treeId:"organId",data:{key:{name:"organName"},simpleData:{enable:!0,idKey:"organId",pIdKey:"parentId"}},callback:{onClick:function(t,e,n){i.$apply(function(){s(n)})}}},t)).getNodeByParam("parentId",null);r.expandNode(e,!0),s(e),window.fuzzySearch("organTree","#organKey",null,!0)})}e.bsTableControl(a,l),a.resetPwd=function(t){a.userId=t,e.resetPwd(a)},a.del=function(t){a.userId=t,o.confirm("确认删除数据吗？",function(){e.deleteUser(a)})},a.dels=function(){var t=a.bsTableControl.getSelections();if(0!=t.length){var n=[];$.each(t,function(t,e){n.push(e.userId)}),a.del(n.join(","))}else o.warning("请选择要删除的数据")},a.start=function(t){a.userId=t.userId,e.enableUser(a)},a.stop=function(t){a.userId=t.userId,e.disableUser(a)},c(),a.initOrganTree=c,a.openUserEditWin=function(t){u.modal("show"),t?(a.isUpdate=!0,a.userId=t,e.findUserById(a,function(t){a.model=t})):(a.isUpdate=!1,a.model={useState:1,organ:{organId:a.organId}})};var u=$("#organUserEditModel").on("hidden.bs.modal",function(t){i.$apply(function(){a.model=null})});a.saveUser=function(){a.isUpdate?e.updateUser(a,function(){u.modal("hide"),$("#editTable").bootstrapTable("refresh")}):e.createUser(a,function(){u.modal("hide"),$("#editTable").bootstrapTable("refresh")})};var d=$("#userRolesModel");a.setRoles=function(t){a.userId=t.userId,d.modal("show"),n.findUserRoles(a,a.userId,function(t){a.roles=t||[]})},a.toSetRoles=function(){var n=[];d.find("input[name='roleId']:checked").each(function(t,e){this.disabled||n.push(this.value)}),e.toSetRoles(a,n.join(","))}}angular.module("myApp").config(t),t.$inject=["$stateProvider"],e.$inject=["$scope","userSvc","organSvc","roleSvc","bsWin"]}(),function(){"use strict";angular.module("myApp").config(function(t,e){t.state("userEdit",{url:"/userEdit/:id",controllerAs:"vm",templateUrl:util.formatUrl("sys/user/html/edit"),controller:function(t,e,n){t.csHide("基础管理");var i=this;i.userId=n.params.id,i.isUpdate=!1,i.userId?(i.isUpdate=!0,e.findUserById(i)):i.model={useState:1},i.save=function(){i.isUpdate?e.updateUser(i):e.createUser(i,function(){n.go("user")})}}})})}(),function(){"use strict";function t(o,r){var a=util.formatUrl("sys/user"),e=util.formatUrl("rsaKey");return{reloadBsTable:function(t,e){var n=t.bsTableControl.options;n.url=a,e&&(n.defaultFilters=e)},bsTableControl:function(o,t){o.bsTableControl={options:util.getTableFilterOption({defaultFilters:t,defaultSort:"itemOrder asc,createdDate desc",columns:[{title:"行号",switchable:!1,width:50,formatter:function(t,e,n){var i=o.bsTableControl.state;return i.pageNumber&&i.pageSize?n+1+(i.pageNumber-1)*i.pageSize:n+1}},{checkbox:!0},{field:"username",title:"用户名",sortable:!0,width:150,filterControl:"input",filterOperator:"like"},{field:"displayName",title:"姓名",width:150,sortable:!0,filterControl:"input",filterOperator:"like"},{field:"organ.organName",title:"所属机构",sortable:!1,width:200,filterControl:"input",filterOperator:"like"},{field:"useState",title:"状态",width:100,align:"center",filterControl:"input",filterOperator:"like",formatter:'<span ng-if="row.useState == 1" class="bg-green">启用</span><span ng-if="row.useState != 1"  class="bg-red">禁用</span>'},{field:"lastLoginDate",title:"最后登录时间",width:160,sortable:!0,filterControl:"datepicker",filterOperator:"gt"},{field:"remark",title:"备注",filterControl:"input",filterOperator:"like"},{field:"",title:"操作",width:200,formatter:$("#userColumnBtns").html()}]})}},createUser:function(n,t){function i(){o.post(a,n.model).then(function(){n.isSubmit=!1,r.success("创建成功"),t&&t()},function(){n.isSubmit=!1})}util.initJqValidation(),$("form").valid()&&(n.isSubmit=!0,n.model.password?$.get(e).success(function(t){var e=new JSEncrypt;e.setPublicKey(t||""),n.model.password=e.encrypt(n.model.password),n.model.verifyPassword=e.encrypt(n.model.verifyPassword),i()}):i())},findUserById:function(e,n){if(!e.userId)return!1;o.get(a+"/"+e.userId).success(function(t){t=t||{},n?n(t):e.model=t})},updateUser:function(t,e){util.initJqValidation(),$("form").valid()&&(t.isSubmit=!0,o.put(a,t.model).then(function(){t.isSubmit=!1,r.success("更新成功"),e&&e()},function(){t.isSubmit=!1}))},enableUser:function(t,e){if(!t.userId)return!1;t.isSubmit=!0,o.put(a+"/enable?id="+t.userId).then(function(){t.isSubmit=!1,r.success("启用成功"),$("#editTable").bootstrapTable("refresh"),e&&e()},function(){t.isSubmit=!1})},disableUser:function(t,e){t.isSubmit=!0,o.put(a+"/disable?id="+t.userId).then(function(){t.isSubmit=!1,r.success("禁用成功"),$("#editTable").bootstrapTable("refresh"),e&&e()},function(){t.isSubmit=!1})},deleteUser:function(t){if(!t.userId)return!1;t.isSubmit=!0,o.delete(a+"?userId="+t.userId).then(function(){r.success("删除成功"),t.bsTableControl.refresh(),t.isSubmit=!1},function(){t.isSubmit=!1})},resetPwd:function(t,e){if(!(e=e||t.userId))return r.warning("缺少参数"),!1;r.confirm("您是否要重置用户密码？",function(){t.isSubmit=!0,o.put(a+"/resetPwd",e).then(function(){t.isSubmit=!1,r.success("用户密码已重置成功")},function(){t.isSubmit=!1})})},userResources:function(e,t,n){o.get(a+"/resources",{params:t}).success(function(t){n?n(t):e.menus=t})},toSetRoles:function(t,e){if(!t.userId)return r.warning("缺少参数"),!1;t.isSubmit=!0,o.post(a+"/setRoles",{},{params:{userId:t.userId,roleIds:e}}).then(function(){t.isSubmit=!1,r.success("用户角色设置成功")},function(){t.isSubmit=!1})}}}angular.module("myApp").factory("userSvc",t),t.$inject=["$http","bsWin"]}();