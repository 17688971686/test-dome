!function(){"use strict";function e(o,t,e,i,n){$("#topMenuBox");var r=$("#leftMenuBox");o.$on("$stateChangeStart",function(e,t,i,n,r){e&&$(".uploadify").each(function(){$(this).uploadify("destroy")})}),o.$on("$stateChangeSuccess",function(e,t,i,n,r){o.previousState_name=n.name,o.previousState_params=r}),o.backPrevPage=function(e){e=e||"welcome",t.go(o.previousState_name||e,o.previousState_params)},o.csHide=function(e){e&&e!=o.menuBoxResId&&(0<$("#menu_"+e).length?o.menuBoxResId=e:o.menuBoxResId="pm")},n.initMenus(o,function(e){o.menuBoxResId||(o.menuBoxResId="pm"),r.append(i(e)(o))}),n.initDicts(o)}function t(e,t,i){t.parentSelector="#loading-bar-container",t.spinnerTemplate='<div style="position:fixed;width:100%;height:100%;left:0;top:0; z-index:99;background:rgba(0, 0, 0, 0.3);overflow: hidden;"><div style="position: absolute;top:30%; width: 400px;height:40px;left:50%;"><i class="fa fa-spinner fa-pulse fa-1x fa-fw"></i>程序处理中...</div></div>',e.otherwise("/welcome"),i.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|file|javascript):/)}function i(e){e.$on("$viewContentLoaded",function(e){jQuery.AdminLTE.layout&&(jQuery.AdminLTE.layout.fix(),jQuery.AdminLTE.layout.fixSidebar())})}angular.module("myApp",["ui.router","kendo.directives","angular-loading-bar","bsTable","sn.common"]).config(t).run(i).controller("indexCtrl",e),e.$inject=["$scope","$state","$http","$compile","snBaseUtils"],t.$inject=["$urlRouterProvider","cfpLoadingBarProvider","$compileProvider"],i.$inject=["$rootScope"];var n=$('<div><i class="fa fa-chevron-up"></i></div>').css({position:"fixed",bottom:"20px",right:"25px",width:"40px",height:"40px",color:"#eee","font-size":"","line-height":"40px","text-align":"center","background-color":"#222d32",cursor:"pointer","border-radius":"5px","z-index":"99999",opacity:".7",display:"none"}).on({mouseenter:function(){n.css("opacity","1")},mouseout:function(){n.css("opacity",".7")},click:function(){$("html,body").animate({scrollTop:top},500)}});$(".wrapper").append(n),$(window).scroll(function(){150<=$(window).scrollTop()?n.is(":visible")||n.fadeIn(500):n.fadeOut(500)})}(),function(){"use strict";function e(e){e.state("projectManageCancel",{url:"/projectManageCancel",controllerAs:"vm",templateUrl:util.formatUrl("project/html/cancel"),controller:t})}function t(e,i,n,t){e.csHide("cjgl");var r=this;r.model={},r.tableParams={},i.bsTableCancelManagement(r),r.filterSearch=function(){$("#listTable").bootstrapTable("refresh")},r.expProinfo=function(){r.status="2",r.tableParams.$filter=util.buildOdataFilter("#toolbar",null),r.tableParams.$orderby="createdDate desc",i.createProReport(r)},r.restore=function(t){i.checkProPriUser(t.id,function(e){e.flag?(r.model=t,r.model.status="1",n.confirm("是否恢复项目",function(){i.restoreInvestProject(r)})):n.alert("您无权进行编辑操作！")})},r.delete=function(t){i.checkProPriUser(t,function(e){e.flag?n.confirm("是否删除项目，删除后数据不可恢复",function(){i.deleteGovernmentInvestProject(t)}):n.alert("您无权进行编辑操作！")})}}angular.module("myApp").config(e),e.$inject=["$stateProvider"],t.$inject=["$scope","projectManagerSvc","bsWin","$state"]}(),function(){"use strict";function e(e){e.state("projectManageEdit",{url:"/projectManageEdit/:id/:flag",controllerAs:"vm",templateUrl:util.formatUrl("project/html/edit"),controller:t})}function t(e,o,t,a){e.csHide("cjgl");var l=this;l.model={},l.model.id=t.params.id,l.flag=t.params.flag,l.attachments=[],o.findOrganUser(function(e){l.orgUsers=e,l.principalUsers=e,l.initFileUpload()}),o.findAllOrgDelt(function(e){l.orgDeptList=e}),l.model.id?o.findGovernmentInvestProjectById(l,function(){}):o.createUUID(l),l.initFileUpload=function(){l.model.id||e.$watch("vm.model.id",function(e,t){e&&e!=t&&!l.initUploadOptionSuccess&&l.initFileUpload()}),l.sysFile={businessId:l.model.id,mainId:"",mainType:"",sysfileType:"",sysBusiType:"",detailBt:"detail_file_bt"},o.initUploadOptions({inputId:"sysfileinput",vm:l})},l.removeFile=function(e,t){a.confirm("是否移除附件",function(){o.deleteFileById(e,l),l.attachments.splice(t,1)})},l.checkLength=function(e,t,i){util.checkLength(e,t,i)},l.save=function(){util.initJqValidation();var e=!1;if($('.seleteTable input[selectType="main"]:checked').each(function(){l.model.mainOrgId=$(this).val(),l.model.mainOrgName=$(this).attr("tit"),e=!0}),!e)return a.alert("您还没选择评审部门！"),!1;var t=[],i=[];if($('.seleteTable input[selectType="assist"]:checked').each(function(){t.push($(this).val()),i.push($(this).attr("tit"))}),0<t.length&&(l.model.assistOrgId=t.join(","),l.model.assistOrgName=i.join(",")),$("#form").valid()){var n=[],r=[];$('#principalUser_ul input[selectType="assistUser"]:checked').each(function(){n.push($(this).attr("value")),r.push($(this).attr("tit"))}),l.model.mainUserName=$.trim($("#mainUser").find("option:selected").text()),l.model.assistUser=n.join(","),l.model.assistUserName=r.join(","),l.model.id?o.updateGovernmentInvestProject(l):(l.model.id=l.UUID,l.model.status="1",o.createGovernmentInvestProject(l))}},l.checkPrincipal=function(){var e=$("#mainUser").val();e&&$('#principalUser_ul input[selectType="assistUser"]').each(function(){$(this).attr("value")==e?($(this).removeAttr("checked"),$(this).attr("disabled","disabled")):$(this).removeAttr("disabled")})},l.mainOrg=function(e){var t=e.target,i=t.checked,n=t.value;i?$('.seleteTable input[selectType="main"]').each(function(){var e=$(this).attr("value");e!=n?($(this).removeAttr("checked"),$("#assist_"+e).removeAttr("disabled")):($("#assist_"+n).removeAttr("checked"),$("#assist_"+n).attr("disabled","disabled"))}):$("#assist_"+n).removeAttr("disabled")}}angular.module("myApp").config(e),e.$inject=["$stateProvider"],t.$inject=["$scope","projectManagerSvc","$state","bsWin"]}(),function(){"use strict";function e(e){e.state("projectManage",{url:"/projectManage",controllerAs:"vm",templateUrl:util.formatUrl("project/html/list"),controller:t})}function t(i,n,r){var o=this;o.model={},o.tableParams={},n.rsTableControl(o),o.filterSearch=function(){$("#listTable").bootstrapTable("refresh")},o.expProinfo=function(){o.status="1",o.tableParams.$filter=util.buildOdataFilter("#toolbar",null),o.tableParams.$orderby="createdDate desc",n.createProReport(o)},o.cancel=function(t){n.checkProPriUser(t.id,function(e){e.flag?(o.model=t,o.model.status="2",r.confirm("是否作废项目",function(){n.cancelInvestProject(o)})):r.alert("您无权进行编辑操作！")})},o.editProj=function(t){n.checkProPriUser(t,function(e){e.flag?i.go("projectManageEdit",{id:t,flag:"edit"}):r.alert("您无权进行编辑操作！")})}}angular.module("myApp").config(e),e.$inject=["$stateProvider"],t.$inject=["$state","projectManagerSvc","bsWin"]}(),function(){"use strict";function e(o,a,t){var n=util.formatUrl("project"),e=util.formatUrl("sys/user"),l=util.formatUrl("sys/sysfile");return{bsTableControlForManagement:function(r,e,t){r.bsTableControlForManagement={options:util.getTableFilterOption({queryParams:function(e){var t=e.filter,i={$skip:e.offset,$top:e.limit,$orderby:e.sort?e.sort+" "+e.order:this.defaultSort,$filter:0==t.length?"":$.toOdataFilter({logic:"and",filters:t})};return this.pagination&&(i.$inlinecount="allpages"),r.tableParams=i},url:n+"/proInfo",defaultFilters:t,columns:[{title:"序号",switchable:!1,align:"center",width:50,formatter:function(e,t,i){var n=r.bsTableControlForManagement.state;return n.pageNumber&&n.pageSize?i+1+(n.pageNumber-1)*n.pageSize:i+1}},{field:"fileCode",title:"收文编号",width:100,filterControl:"input",filterOperator:"like"},{field:"projectName",title:"项目名称",width:200,sortable:!1,filterControl:"input",filterOperator:"like",formatter:'<a href="#/projectManageView/{{row.id}}/view" style="color:blue">{{row.projectName}}</a>'},{field:"reviewStage",title:"评审阶段",width:100,filterControl:"input"},{field:"proUnit",title:"项目单位",width:90,filterControl:"input",filterOperator:"like"},{field:"mainOrgName",title:"主办部门",width:90,filterControl:"input"},,{field:"assistOrgName",title:"协办部门",width:220,filterControl:"input"},{field:"mainUserName",title:"第一负责人",width:90,filterControl:"input"},{field:"assistUserName",title:"其他负责人",width:90,filterControl:"input"},{field:"dispatchDate",title:"发文日期",width:90,filterControl:"input"},{field:"fileNum",title:"发文号",width:90,filterControl:"input",filterOperator:"like"},{field:"fileDate",title:"存档日期",width:90,filterControl:"input"},{field:"fileNo",title:"存档号",width:90,filterControl:"input",filterOperator:"like"},{field:"remark",title:"备注",width:90,filterControl:"input",filterOperator:"like"},{field:"id",title:"操作",width:240,formatter:$("#columnBtns").html()}]})}},rsTableControl:function(r){r.rsTableControl={options:util.getTableOption({url:n+"/proInfo",defaultSort:"createdDate desc",filterForm:"#filterForm",columns:[{title:"序号",switchable:!1,width:50,formatter:function(e,t,i){var n=r.rsTableControl.state;return n.pageNumber&&n.pageSize?i+1+(n.pageNumber-1)*n.pageSize:i+1}},{field:"fileCode",title:"收文编号",width:100},{field:"projectName",title:"项目名称",width:200,sortable:!1,formatter:'<a href="#/projectManageView/{{row.id}}/view" style="color:blue">{{row.projectName}}</a>'},{field:"reviewStage",title:"评审阶段",width:100},{field:"proUnit",title:"项目单位",width:90},{field:"mainOrgName",title:"主办部门",width:90,filterControl:"input"},{field:"assistOrgName",title:"协办部门",width:220,filterControl:"input"},{field:"mainUserName",title:"第一负责人",width:90,filterControl:"input"},{field:"assistUserName",title:"其他负责人",width:90,filterControl:"input"},{field:"dispatchDate",title:"发文日期",width:90},{field:"fileNum",title:"发文号",width:90},{field:"fileDate",title:"存档日期",width:90},{field:"fileNo",title:"存档号",width:90},{field:"remark",title:"备注",width:90},{field:"id",title:"操作",width:240,formatter:$("#columnBtns").html()}]})}},bsTableCancelManagement:function(r,e,t){r.bsTableCancelManagement={options:util.getTableOption({url:n+"/cancelInfo",defaultSort:"createdDate desc",filterForm:"#filterForm",columns:[{title:"序号",switchable:!1,width:50,formatter:function(e,t,i){var n=r.bsTableCancelManagement.state;return n.pageNumber&&n.pageSize?i+1+(n.pageNumber-1)*n.pageSize:i+1}},{field:"fileCode",title:"收文编号",width:100},{field:"projectName",title:"项目名称",width:200,sortable:!1,formatter:'<a href="#/projectManageView/{{row.id}}/view" style="color:blue">{{row.projectName}}</a>'},{field:"reviewStage",title:"评审阶段",width:100},{field:"proUnit",title:"项目单位",width:90},{field:"mainOrgName",title:"主办部门",width:90,filterControl:"input"},{field:"assistOrgName",title:"协办部门",width:220,filterControl:"input"},{field:"mainUserName",title:"第一负责人",width:90,filterControl:"input"},{field:"assistUserName",title:"其他负责人",width:90,filterControl:"input"},{field:"dispatchDate",title:"发文日期",width:90},{field:"fileNum",title:"发文号",width:90},{field:"fileDate",title:"存档日期",width:90},{field:"fileNo",title:"存档号",width:90},{field:"remark",title:"备注",width:90},{field:"id",title:"操作",width:240,formatter:$("#columnBtns").html()}]})}},findGovernmentInvestProjectById:function(t,i){o.get(n+"/findById",{params:{id:t.model.id||""}}).then(function(e){t.model=e.data,i&&i()})},createGovernmentInvestProject:function(e){o.post(n,e.model).then(function(){a.success("创建成功"),t.go("projectManage")})},deleteGovernmentInvestProject:function(e){o.delete(n,{params:{id:e||""}}).then(function(){a.success("删除成功"),$("#listTable").bootstrapTable("refresh")})},updateGovernmentInvestProject:function(e){o.put(n,e.model).then(function(){a.success("更新成功")})},restoreInvestProject:function(e){o.post(n+"/restore",e.model).then(function(){a.success("项目恢复成功"),$("#listTable").bootstrapTable("refresh")})},cancelInvestProject:function(e){o.post(n+"/cancel",e.model).then(function(){a.success("项目作废成功"),$("#listTable").bootstrapTable("refresh")})},createProReport:function(e){window.open(n+"/exportPro2?$filter="+e.tableParams.$filter+"and status eq '"+e.status+"' &$orderby="+e.tableParams.$orderby)},getAttachments:function(e,t,i){o.get(l+"/findByBusinessId",{params:t}).success(function(e){i(e)})},initUploadConfig:function(t,e,n){$("#"+e).uploadify({uploader:util.formatUrl("sys/sysfile/fileUpload"),swf:util.formatUrl("libs/uploadify/uploadify.swf"),buttonText:"相关附件",method:"post",multi:!0,auto:!0,fileObjName:"files",fileSizeLimit:"40MB",fileExt:"*.pdf;*.txt;*.png;*.jpg;*.doc;*.docx;*.wps",fileTypeExts:"*.pdf;*.txt;*.png;*.jpg;*.doc;*.docx;*.wps",fileTypeDesc:"请选择*.pdf;*.txt;*.png;*.jpg;*.doc;*.docx;*.wps文件",removeCompleted:!0,onUploadStart:function(e){$("#relateAttach").uploadify("settings","formData",{businessId:t.model.id?t.model.id:t.UUID,mainType:"ProAttachment"})},onUploadSuccess:function(e,t,i){n(t),angular.element("body").scope().$apply(function(){a.success("上传成功")})},onCancel:function(e){a.confirm("询问提示","确认删除该文件吗？",function(){})},onUploadError:function(e,t,i,n){angular.element("body").scope().$apply(function(){switch(t){case-100:a.error("上传的文件数量已经超出系统限制的文件！");break;case-110:a.error("文件 ["+e.name+"] 大小超出系统限制的大小！");break;case-120:a.error("文件 ["+e.name+"] 大小异常！");break;case-130:a.error("文件 ["+e.name+"] 类型不正确！");break;default:a.error("上传失败")}})}})},initUploadOptions:function(r){var n={width:"70%",height:"460px",uploadBt:"upload_file_bt",detailBt:"detail_file_bt",inputId:"sysfileinput",mainType:"ProAttachment",sysBusiType:"",showBusiType:!(r.vm.initUploadOptionSuccess=!1)};if(r.vm.sysFile){if(r.sysBusiType&&(n.sysBusiType=r.sysBusiType),r.width&&(n.width=r.width),r.height&&(n.height=r.height),angular.isUndefined(r.vm.sysFile.showBusiType)&&(r.vm.sysFile.showBusiType=n.showBusiType),r.vm.downloadSysFile=function(e){var i;i=e,o.get(l+"/fileSysCheck?sysFileId="+i).success(function(e){var t=$("#szecSysFileDownLoadForm");t.attr("target",""),t.attr("method","get"),e.flag||"ok"==e.reCode?(t.attr("action",l+"/fileDownload"),t.find("input[name='sysfileId']").val(i),t.submit()):(t.attr("action",""),t.find("input[name='sysfileId']").val(""),a.error(e.reMsg))})},r.vm.delSysFile=function(i){a.confirm({title:"询问提示",message:"确认删除么？",onOk:function(){var e,t;e=i,t=function(e){a.alert(e.reMsg||"删除成功！"),$.each(r.vm.sysFilelists,function(e,t){angular.isUndefined(t)||t.sysFileId!=i||r.vm.sysFilelists.splice(e,1)})},o.get(l+"/deleteSysFile?sysFileId="+e).success(function(e){t(e)})}})},r.vm.clickUploadBt=function(){r.vm.sysFile.businessId?(r.vm.sysFile.sysBusiType="",angular.element("#sysfileinput").fileinput("clear"),$("#commonUploadWindow").kendoWindow({width:n.width,height:n.height,title:"附件上传",visible:!1,modal:!0,closable:!0}).data("kendoWindow").center().open()):a.alert("请先保存业务数据！")},r.vm.clickDetailBt=function(){var e,t;r.vm.sysFile.businessId?(e=r.vm.sysFile.businessId,t=function(e){r.vm.sysFilelists=[],r.vm.sysFilelists=e,$("#commonQueryWindow").kendoWindow({width:"50%",height:"500px",title:"附件上传列表",visible:!1,modal:!0,closable:!0,actions:["Pin","Minimize","Maximize","Close"]}).data("kendoWindow").center().open()},o.get(l+"/findByBusinessId?businessId="+e).success(function(e){t(e)})):a.alert("请先保存业务数据！")},r.vm.sysFile.businessId){var e={language:"zh",allowedPreviewTypes:["image"],allowedFileExtensions:["sql","exe","lnk"],maxFileSize:0,showRemove:!1,previewFileIcon:"<i class='glyphicon glyphicon-king'></i>",uploadAsync:!1,enctype:"multipart/form-data",uploadUrl:l+"/fileUpload",previewFileIconSettings:{doc:'<i class="fa fa-file-word-o text-primary"></i>',xls:'<i class="fa fa-file-excel-o text-success"></i>',ppt:'<i class="fa fa-file-powerpoint-o text-danger"></i>',docx:'<i class="fa fa-file-word-o text-primary"></i>',xlsx:'<i class="fa fa-file-excel-o text-success"></i>',pptx:'<i class="fa fa-file-powerpoint-o text-danger"></i>',pdf:'<i class="fa fa-file-pdf-o text-danger"></i>',zip:'<i class="fa fa-file-archive-o text-muted"></i>'},uploadExtraData:function(e,t){var i={};return i.businessId=r.vm.sysFile.businessId,i.mainId=r.vm.sysFile.mainId||"",i.mainType=r.vm.sysFile.mainType||n.mainType,i.sysfileType=r.vm.sysFile.sysfileType||"",i.sysBusiType=r.vm.sysFile.sysBusiType||n.sysBusiType,i}};$("#"+r.inputId||n.inputId).fileinput(e).on("filebatchselected",function(e,t){t.length}).on("filepreupload",function(e,t,i,n){t.form,t.files,t.extra,t.response,t.reader}).on("filebatchuploaderror",function(e,t,i){console.log("同步上传错误")}).on("filebatchuploadsuccess",function(e,t,i,n){null!=r.uploadSuccess&&"function"==typeof r.uploadSuccess&&r.uploadSuccess(e,t,i,n)}),r.vm.initUploadOptionSuccess=!0}}else a.alert("初始化附件控件失败，请先定义附件对象！")},createUUID:function(t){o.get(n+"/createUUID").success(function(e){t.UUID=e||[]})},deleteFileById:function(e,t,i){o.delete(l,{params:{sysFileId:e||""}}).then(function(){a.success("删除成功"),angular.isFunction(i)&&i()}).then(function(){})},findOrgUser:function(t){o.get(e+"/findUsersByOrgId").success(function(e){t(e)})},findOrganUser:function(t){o.get(e+"/findOrgUser").success(function(e){t(e)})},findAllOrgDelt:function(t){o.get("sys/organ/findAllOrgDept").success(function(e){t(e)})},checkProPriUser:function(e,t){o.get(n+"/checkProPriUser?id="+e).success(function(e){t(e)})}}}angular.module("myApp").factory("projectManagerSvc",e),e.$inject=["$http","bsWin","$state"]}(),function(){"use strict";function e(e){e.state("projectManageView",{url:"/projectManageView/:id/:flag",controllerAs:"vm",templateUrl:util.formatUrl("project/html/view"),controller:t})}function t(e,t,i,n,r){e.csHide("cjgl");var o=this;o.model={},o.model.id=i.params.id,o.flag=i.params.flag,o.attachments=[],t.findOrganUser(function(e){o.orgUsers=e,o.principalUsers=e,o.initFileUpload()}),t.findAllOrgDelt(function(e){o.orgDeptList=e}),o.model.id?t.findGovernmentInvestProjectById(o,function(){"cancel"==o.flag||"normal"==o.flag?("cancel"==o.flag?o.model.status="2":o.model.status="1",t.updateGovernmentInvestProject(o)):"delete"==o.flag&&t.deleteGovernmentInvestProject(o.model.id)}):t.createUUID(o),o.initFileUpload=function(){o.model.id||e.$watch("vm.model.id",function(e,t){e&&e!=t&&!o.initUploadOptionSuccess&&o.initFileUpload()}),o.sysFile={businessId:o.model.id,mainId:"",mainType:"",sysfileType:"",sysBusiType:"",detailBt:"detail_file_bt"},t.initUploadOptions({inputId:"sysfileinput",vm:o})}}angular.module("myApp").config(e),e.$inject=["$stateProvider"],t.$inject=["$scope","projectManagerSvc","$state","bsWin","attachmentSvc"]}(),function(){"use strict";angular.module("myApp").config(function(e){var o=util.formatUrl("admin/userInfo");e.state("userInfo",{url:"/userInfo",controllerAs:"vm",templateUrl:o,controller:function(e,i,n){var r=this;r.isSubmit=!1,r.toUpdate=function(){if(util.initJqValidation(),$("form").valid()){var t=new JSEncrypt;i.get(util.formatUrl("rsaKey")).success(function(e){t.setPublicKey(e||""),r.model.oldPassword&&(r.model.oldPassword=t.encrypt(r.model.oldPassword),r.model.newPassword=t.encrypt(r.model.newPassword),r.model.verifyPassword=t.encrypt(r.model.verifyPassword)),r.isSubmit=!0,i.put(o,r.model).then(function(){r.isSubmit=!1,n.success("修改成功")},function(){r.isSubmit=!1})})}}}})})}(),function(){"use strict";function e(e){e.state("welcome",{url:"/welcome",templateUrl:util.formatUrl("admin/welcome"),controllerAs:"vm",controller:t})}function t(e,t){var i=this;i.getOperatorLogList=function(){t.getOperatorLogList(i,{$orderby:"createdDate desc",$top:5})}}angular.module("myApp").config(e),e.$inject=["$stateProvider"],t.$inject=["$scope","operatorLogSvc"]}(),function(){"use strict";angular.module("myApp").factory("welcomeSvc",function(e,t){util.formatUrl("admin");return{}})}(),function(){"use strict";angular.module("myApp").config(function(e){e.state("attachment",{url:"/attachment",controllerAs:"vm",templateUrl:util.formatUrl("sys/attachment/html/list"),controller:function(e,t,n){e.csHide("bm");var r=this;r.attachment={},r.del=function(e){n.confirm("确认删除数据吗？",function(){t.deleteById(r,e,function(){r.bsTableControl.refresh()})})},r.dels=function(){var e=$("#editTable").bootstrapTable("getSelections");if(0!=e.length){var i=[];$.each(e,function(e,t){i.push(t.id)}),r.del(i.join(","))}else n.warning("请选择要删除的数据")},t.bsTableControl(r)}})})}(),function(){"use strict";angular.module("myApp").config(function(e){e.state("attachmentEdit",{url:"/attachmentEdit/:id",controllerAs:"vm",templateUrl:util.formatUrl("sys/attachment/html/edit"),controller:function(t,e,i,r){t.csHide("bm");var n=this;n.attachment={},n.attachmentId=i.params.id,n.attachment.publicAtt=!0,n.attachmentId&&e.findDocById(n.attachmentId,n),n.save=function(){if(n.attachmentId)n.attachment.id=n.attachmentId,e.update(n);else{if(!n.attachment.id)return void r.alert("请先上传文档！");e.create(n)}},$("#orginalFiles").uploadify({uploader:util.formatUrl("sys/attachment/upload"),swf:util.formatUrl("libs/uploadify/uploadify.swf"),method:"post",multi:!0,auto:!0,fileObjName:"files",fileSizeLimit:"10MB",buttonText:"选择文档",fileExt:"*.pdf;*.txt;*.png;*.doc",fileTypeExts:"*.pdf;*.txt;*.png;*.doc;*png;*.docx;*.xls;*.xlsx;*.ppt;*.pptx;*.ceb",fileTypeDesc:"请选择*.pdf;*.txt;*.png;*.doc文件",removeCompleted:!0,onUploadStart:function(e){if(!n.attachment.tableKey)return r.error("参数错误！"),!1;n.attachment.id&&$("#orginalFiles").uploadify("settings","formData",{attId:n.attachment.id}),$("#orginalFiles").uploadify("settings","formData",{tableKey:n.attachment.tableKey})},onUploadSuccess:function(e,t,i){angular.element("body").scope().$apply(function(){n.attachment.originalName=e.name.substring(0,e.name.indexOf(".")),r.alert("上传成功")})},onUploadError:function(e,t,i,n){angular.element("body").scope().$apply(function(){r.error("上传失败")})}}),n.backPrevPage=function(e){t.backPrevPage(e)}}})})}(),function(){"use strict";angular.module("myApp").factory("attachmentSvc",function(n,r){var o=util.formatUrl("sys/attachment");return{bsTableControl:function(r){r.bsTableControl={options:util.getTableFilterOption({url:o,defaultSort:"itemOrder desc",columns:[{title:"行号",width:50,switchable:!1,formatter:function(e,t,i){var n=r.bsTableControl.state;return n.pageNumber&&n.pageSize?i+1+(n.pageNumber-1)*n.pageSize:i+1}},{checkbox:!0},{field:"originalName",title:"文档名称",sortable:!0,filterControl:"input",filterOperator:"like",formatter:function(e,t,i){return'<a href="'+o+"/download/"+t.id+'" target="_blank">'+e+"</a>"}},{field:"docCategory",title:"文档分类",sortable:!0,filterControl:"input",filterOperator:"like",formatter:"{{DICT.ATTACHMENT.dicts.CATEGORY.dicts[row.docCategory].dictName}}"},{field:"attMonth",title:"所属月份",width:100,sortable:!0,filterControl:"input",filterOperator:"like"},{field:"publicAtt",title:"是否公开给业主",width:130,sortable:!1,align:"center",filterControl:"input",filterOperator:"like",formatter:function(e){return e?"是":"否"}},{field:"createdDate",title:"建档时间",width:200,sortable:!0,filterControl:"datepicker",filterOperator:"gt"},{field:"modifiedDate",title:"最后修改时间",width:200,sortable:!1,filterControl:"datepicker",filterOperator:"gt"},{field:"createdBy",title:"建档人",width:100,sortable:!1,filterControl:"input",filterOperator:"like"},{field:"",title:"操作",width:100,formatter:$("#columnBtns").html()}]})}},create:function(e){util.initJqValidation(),$("form").valid()&&(e.isSubmit=!0,n.put(o,e.attachment).then(function(){r.success("添加成功"),e.backPrevPage(),e.isSubmit=!1}).then(function(){e.isSubmit=!1}))},findDocById:function(t){n.get(o+"/findById",{params:{id:t.attachment.id}}).then(function(e){t.attachment=e.data})},update:function(e){util.initJqValidation(),$("form").valid()&&(e.isSubmit=!0,n.put(o,e.attachment).success(function(){e.isSubmit=!1,r.success("更新成功"),e.backPrevPage("attachment")}).then(function(){e.isSubmit=!1}))},deleteById:function(e,t,i){e.isSubmit=!0,n.delete(o,{params:{id:t||""}}).then(function(){r.success("删除成功"),angular.isFunction(i)&&i(),e.isSubmit=!1}).then(function(){e.isSubmit=!1})}}})}(),function(){"use strict";angular.module("myApp").config(function(e){e.state("dict",{url:"/dict",controllerAs:"vm",templateUrl:util.formatUrl("sys/dict/html/list"),controller:function(e,t,i){e.csHide("bm");var n=this;n.dict={},n.dels=function(){var e=n.dictsTree.getSelectedNodes();e&&0<e.length?n.del(e[0].dictId):i.confirm("请选择数据")},n.del=function(e){n.dict.dictId=e,i.confirm("删除字典将会连下级字典一起删除，确认删除数据吗？",function(){t.deleteDict(n)})},n.resetDict=function(){i.confirm("您确定要重置数据字典吗？",function(){t.resetDict(n)})},t.initDictTree(n)}})})}(),function(){"use strict";angular.module("myApp").config(function(e){e.state("dict.edit",{url:"/dictEdit/:dictId",controllerAs:"vm",templateUrl:util.formatUrl("sys/dict/html/edit"),controller:function(e,t,i){e.csHide("bm");var n=this;n.dict={},n.dictId=i.params.dictId,n.dictId&&(n.isUpdate=!0),n.isUpdate?t.findDictById(n):t.initpZtreeClient(n),n.create=function(){if(n.dictsTree){var e=n.dictsTree.getCheckedNodes(!0);e&&0!=e.length&&(n.dict.parentId=e[0].dictId)}t.createDict(n)},n.update=function(){t.updateDict(n)},n.dictTypeChange=function(){n.dict.dictType&&(n.dict.dictKey="")}}})})}(),function(){"use strict";angular.module("myApp").factory("dictSvc",function(i,t,n){var r=util.formatUrl("sys/dict");return{initDictTree:o,initpZtreeClient:function(t){t.dictsTree&&t.dictsTree.destroy(),i.get(r+"?$orderby=itemOrder asc").success(function(e){t.dictsTree=$.fn.zTree.init($("#pzTree"),{check:{enable:!0,chkStyle:"radio",radioType:"all"},data:{key:{name:"dictName"},simpleData:{enable:!0,idKey:"dictId",pIdKey:"parentId",rootPId:0}}},e||[])})},createDict:function(e){util.initJqValidation(),$("form").valid()&&(e.isSubmit=!0,i.post(r,e.dict).then(function(){t.success("创建成功"),e.isSubmit=!1,o(e)},function(){e.isSubmit=!1}))},findDictById:function(t){if(!t.dictId)return!1;i.get(r+"/"+t.dictId).success(function(e){t.dict=e})},updateDict:function(e){util.initJqValidation(),$("form").valid()&&(e.isSubmit=!0,i.put(r,e.dict).then(function(){t.success("更新成功"),e.isSubmit=!1,o(e)},function(){e.isSubmit=!1}))},deleteDict:function(e){e.isSubmit=!0,i.delete(r,{params:{dictId:e.dict.dictId||""}}).then(function(){t.success("删除成功"),e.isSubmit=!1,o(e)},function(){e.isSubmit=!1})},resetDict:function(e){e.isSubmit=!0,i.post(r+"/reset",{}).then(function(){t.success("操作成功"),e.isSubmit=!1,o(e)},function(){e.isSubmit=!1})}};function o(t){t.dictsTree&&t.dictsTree.destroy(),i.get(r+"?$orderby=itemOrder asc").success(function(e){t.dictsTree=$.fn.zTree.init($("#zTree"),{callback:{onClick:function(e,t,i){n.go("dict.edit",{dictId:i.dictId})}},data:{key:{name:"dictName"},simpleData:{enable:!0,idKey:"dictId",pIdKey:"parentId",rootPId:0}}},e||[]),window.fuzzySearch("zTree","#dictTreeKey",null,!0)})}})}(),function(){"use strict";angular.module("myApp").config(function(e){e.state("operatorLog",{url:"/operatorLog",controllerAs:"vm",templateUrl:util.formatUrl("sys/operatorLog/html/list"),controller:function(e,t,i){e.csHide("bm");var n=this;n.model={},n.delLog=function(e){t.deleteLog(n,e)},t.bsTableControl(e)}})})}(),function(){"use strict";angular.module("myApp").factory("operatorLogSvc",function(i,n){var o=util.formatUrl("sys/operatorLog");return{bsTableControl:function(r){r.bsTableControl={options:util.getTableFilterOption({url:o,columns:[{title:"行号",switchable:!1,width:50,align:"left",formatter:function(e,t,i){var n=r.bsTableControl.state;return n.pageNumber&&n.pageSize?i+1+(n.pageNumber-1)*n.pageSize:i+1}},{field:"createdDate",title:"操作时间",width:100,sortable:!0,filterControl:"datepicker",filterOperator:"lte"},{field:"createdBy",title:"操作人",width:100,sortable:!0,filterControl:"input",filterOperator:"like"},{field:"businessType",title:"操作对象",width:100,sortable:!0,filterControl:"input",filterOperator:"like",formatter:function(e,t,i){return t.businessType+"["+t.operateType+"]"}},{field:"operateTime",title:"耗时",width:80,sortable:!0,align:"right",filterControl:"number"},{field:"ipAddress",title:"IP地址",width:100,align:"center",filterControl:"input",filterOperator:"like"},{field:"sucessFlag",title:"结果",width:60,filterControl:"input",filterOperator:"like",formatter:"<span ng-show='row.sucessFlag==1' class='bg-green'>成功</span><span ng-show='row.sucessFlag!=1' class='bg-red'>失败</span>"},{field:"message",title:"结果消息",width:120},{field:"oldInfo",title:"原数据",width:200,formatter:function(e,t,i){return e?"<textarea style='width: 100%' rows='4'>"+e+"</textarea>":"<textarea style='width: 100%' rows='4'> </textarea>"}},{field:"newInfo",title:"更新数据",width:200,formatter:function(e,t,i){return e?"<textarea style='width: 100%' rows='4'>"+e+"</textarea>":"<textarea style='width: 100%' rows='4'> </textarea>"}},{field:"updateInfo",title:"更新信息",width:200,formatter:function(e,t,i){return e?"<textarea style='width: 100%' rows='4'>"+e+"</textarea>":"<textarea style='width: 100%' rows='4'> </textarea>"}}]})}},getOperatorLogList:function(t,e){i.get(o,{params:e}).success(function(e){t.operatorLogList=e||{}})},deleteLog:function(e,t){e.isSubmit=!0,i.delete(o,{params:{days:t||""}}).then(function(){n.alert("删除成功"),e.isSubmit=!1,$("#editTable").bootstrapTable("refresh","")})}}})}(),function(){"use strict";function e(e){e.state("organ.add",{url:"/organAdd/:id",controllerAs:"vm",templateUrl:util.formatUrl("sys/organ/html/add"),controller:t})}function t(n,e,t){var i;(n.organId=t.params.id,n.isSubmit=!1,n.hasParent=!1,n.organId)?(n.hasParent=!0,e.findOrganById(n,function(e){n.parentOrgan=e,n.model={parentId:e.organId}})):n.$watch("organList",function(e){i&&i.destroy(),e&&0!=e.length?(n.hasParent=!1,i=$.fn.zTree.init($("#parentOrganTree"),{treeId:"organId",data:{key:{name:"organName"},simpleData:{enable:!0,idKey:"organId",pIdKey:"parentId"}},check:{enable:!0,chkStyle:"radio"},callback:{onCheck:function(e,t,i){i.checked&&n.$apply(function(){n.model||(n.model={}),n.model.parentId=i.organId})}}},e)):n.hasParent=!0});n.saveOrgan=function(){e.createOrgan(n,function(){t.go("organ",{},{reload:!0})})}}angular.module("myApp").config(e),e.$inject=["$stateProvider"],t.$inject=["$scope","organSvc","$state"]}(),function(){"use strict";function e(e){e.state("organ",{url:"/organ",controllerAs:"vm",templateUrl:util.formatUrl("sys/organ/html/list"),controller:t})}function t(i,o,n,t){i.csHide("bm"),i.deleteOrgan=function(e){i.organId=e,t.confirm("确认删除数据吗？",function(){n.deleteOrgan(vm)})};var r,a=$("#treeAddBtn"),l=$("#organTree"),s=l.attr("delete");function e(){r&&r.destroy(),n.getOrganList(i,function(e){var t=(r=$.fn.zTree.init(l,{treeId:"organId",data:{key:{name:"organName"},simpleData:{enable:!0,idKey:"organId",pIdKey:"parentId"}},edit:{enable:!0,removeTitle:"删除机构",showRemoveBtn:function(e,t){return!!s&&(0<t.organDataType&&!t.isParent)},showRenameBtn:!1},view:{addHoverDom:function(e,t){if(t.organType<2){var i=$("#"+t.tId+"_span");if(t.editNameFlag||0<$("#addBtn_"+t.tId).length)return;if(0<a.length){var n=util.format(a.html(),t.tId);i.after(n);var r=$("#addBtn_"+t.tId);r&&r.bind("click",function(){return o.go("organ.add",{id:t.organId}),!1})}}},removeHoverDom:function(e,t){$("#addBtn_"+t.tId).unbind().remove()},selectedMulti:!1},callback:{onClick:function(e,t,i){o.go("organ.edit",{id:i.organId})},beforeRemove:function(e,t){return i.$apply(function(){i.organId=t.organId,n.deleteOrgan(i,function(){i.organId=null,o.go("organ",{},{reload:!0})})}),!1},beforeDrag:function(){return!1}}},e)).getNodeByParam("parentId",null);r.expandNode(t,!0),window.fuzzySearch("organTree","#organKey",null,!0)})}e(),i.initOrganTree=e}angular.module("myApp").config(e),e.$inject=["$stateProvider"],t.$inject=["$scope","$state","organSvc","bsWin"]}(),function(){"use strict";function e(e){e.state("organ.edit",{url:"/organEdit/:id",controllerAs:"vm",templateUrl:util.formatUrl("sys/organ/html/edit"),controller:t})}function t(i,e,t,n){var r;i.organId=e.params.id,i.isSubmit=!1,i.organId&&t.findOrganById(i,function(e){(i.model=e).parentId&&t.findOrganById({organId:e.parentId},function(e){i.parentOrgan=e})}),i.saveOrgan=function(){t.updateOrgan(i,function(){i.initOrganTree&&i.initOrganTree()})},i.authorization=function(){!function(){r?t():n.getResourceData(i,function(e){e=e.value||[],r=$.fn.zTree.init($("#resourceTree"),{treeId:"resId",check:{enable:!0,chkboxType:{Y:"p",N:"s"}},data:{key:{name:"resName"},simpleData:{enable:!0,idKey:"resId",pIdKey:"parentId"}}},e),t()});function t(){r.checkAllNodes(!1),$.each(i.model.resources,function(e,t){r.checkNode(r.getNodeByParam("resId",t.resId),!0,!0)})}}(),$("#organAuthorizationWin").modal("show")},i.toAuthorization=function(){r&&(i.model.resources=r.getCheckedNodes(!0),t.authorization(i))}}angular.module("myApp").config(e),e.$inject=["$stateProvider"],t.$inject=["$scope","$state","organSvc","resourceSvc"]}(),function(){"use strict";function e(n,i){var r=util.formatUrl("sys/organ");return{getOrganList:function(t,i){n.get(r+"?$orderby=itemOrder asc").success(function(e){t.organList=e.value||[],i&&i(t.organList)})},findOrganList:function(t,i){n.get(r+"/findOrganList").then(function(e){i?i(e.data):t.organList=e.data})},createOrgan:function(e,t){util.initJqValidation(),$("form").valid()&&(e.isSubmit=!0,n.post(r,e.model).then(function(){e.isSubmit=!1,i.success("创建成功",function(){t&&t()})},function(){e.isSubmit=!1}))},findOrganById:function(t,i){n.get(r+"/"+(t.organId||"")).success(function(e){e=e||{},i?i(e):t.model=e})},updateOrgan:function(e,t){util.initJqValidation(),$("form").valid()&&(e.isSubmit=!0,n.put(r,e.model).then(function(){e.isSubmit=!1,i.success("更新成功",function(){t&&t()})},function(){e.isSubmit=!1}))},deleteOrgan:function(e,t){n.delete(r,{params:{organId:e.organId||""}}).then(function(){i.success("删除成功",function(){t&&t()})},function(){e.isSubmit=!1})},authorization:function(e){e.organId&&e.model?(e.isSubmit=!0,n.put(r+"/authorization?organId="+e.organId,e.model.resources||[]).then(function(){e.isSubmit=!1,i.success("权限更新成功")},function(){e.isSubmit=!1})):i.warning("缺少参数")}}}angular.module("myApp").factory("organSvc",e),e.$inject=["$http","bsWin"]}(),function(){"use strict";function e(e){e.state("organ.user",{url:"/organUser/:id",controllerAs:"vm",templateUrl:util.formatUrl("sys/organ/html/user"),controller:t})}function t(t,e,i,n,r){t.organId=e.params.id||"",t.isSubmit=!1,t.isUpdate=!1,t.openUserEditWin=function(e){o.modal("show"),e?(t.isUpdate=!0,t.userId=e,n.findUserById(t,function(e){t.model=e})):(t.isUpdate=!1,t.model={useState:1,organ:{organId:t.organId}})};var o=$("#organUserEditModel").on("hidden.bs.modal",function(e){t.$apply(function(){t.model=null})});t.saveUser=function(){t.isUpdate?n.updateUser(t,function(){o.modal("hide"),$("#editTable").bootstrapTable("refresh")}):n.createUser(t,function(){o.modal("hide"),$("#editTable").bootstrapTable("refresh")})},t.delUser=function(e){t.userId=e,r.confirm("确认删除数据吗？",function(){n.deleteUser(t)})},t.delUsers=function(){var e=$("#editTable").bootstrapTable("getSelections");if(0!=e.length){var i=[];$.each(e,function(e,t){i.push(t.userId)}),t.delUser(i.join(","))}else r.alert("请选择要删除的数据")},t.start=function(e){t.userId=e.userId,n.enableUser(t)},t.stop=function(e){t.userId=e.userId,n.disableUser(t)},i.findOrganById(t,function(e){t.organ=e}),n.bsTableControl(t,{field:"organ.organId",operator:"eq",value:t.organId}),n.reloadBsTable(t)}angular.module("myApp").config(e),e.$inject=["$stateProvider"],t.$inject=["$scope","$state","organSvc","userSvc","bsWin"]}(),function(){"use strict";angular.module("myApp").config(function(e){e.state("resource",{url:"/resource",controllerAs:"vm",templateUrl:util.formatUrl("sys/resource/html/list"),controller:function(r,o,e){function n(e){if(e)r.isUpdate=!0,r.editTitle="编辑系统资源",r.model||(r.model={}),r.resId=e,o.findResourceById(r,function(e){r.parentId=e.parentId;var t=l.getNodeByParam("resId",e.parentId);t&&l.checkNode(t,!0,!0)});else{r.model={status:1},r.isUpdate=!1,r.editTitle="新增系统资源";for(var t=l.getCheckedNodes(!0),i=0,n=t.length;i<n;i++)l.checkNode(t[i],!1,!0)}}var a,l;function s(){a&&a.destroy(),l&&l.destroy(),o.getResourceData(r,function(e){e=e.value||[];var t={treeId:"resId",data:{key:{name:"resName"},simpleData:{enable:!0,idKey:"resId",pIdKey:"parentId"}}};if(a=$.fn.zTree.init($("#resourceTree"),$.extend({edit:{enable:!0,removeTitle:"删除资源",showRemoveBtn:function(e,t){return!t.isParent},showRenameBtn:!1},callback:{onClick:function(e,t,i){r.$apply(function(){n(i.resId)})},beforeRemove:function(e,t){return r.$apply(function(){r.resId=t.resId,o.deleteResource(r,function(){r.resId=null,r.parentId=null,n(),s()})}),!1},beforeDrag:function(){return!1}}},t),e),r.parentId){var i=a.getNodeByParam("resId",r.parentId);a.expandNode(i,!0,!1,!0)}l=$.fn.zTree.init($("#parentResourceTree"),$.extend({check:{enable:!0,chkStyle:"radio"}},t),e),window.fuzzySearch("resourceTree","#resourceKey",null,!0)})}r.csHide("bm"),r.editTitle="新增系统资源",r.model={status:1},r.isUpdate=!1,r.isSubmit=!1,r.createResource=n,r.createSave=function(){var e=l.getCheckedNodes(!0);0<e.length&&(r.model.parentId=e[0].resId),o.createResource(r,function(){s()})},r.updateSave=function(){if(util.initJqValidation(),$("form").valid()){var e=l.getCheckedNodes(!0);0<e.length&&(r.model.parentId=e[0].resId),o.updateResource(r,function(){s()})}},r.resetResource=function(){o.resetResource(r,function(){s()})},s()}})})}(),function(){"use strict";angular.module("myApp").factory("resourceSvc",function(n,i){var r=util.formatUrl("sys/resource");return{getResourceData:function(t,i){n.get(r+"?$orderby=itemOrder asc").success(function(e){t.resources=e,i&&i(e)})},findResourceById:function(t,i){n.get(r+"/"+(t.resId||"")).success(function(e){t.model=e,i&&i(e)})},createResource:function(e,t){util.initJqValidation(),$("form").valid()&&(e.isSubmit=!0,n.post(r,e.model).then(function(){e.isSubmit=!1,i.alert("创建成功"),t&&t()},function(){e.isSubmit=!1}))},updateResource:function(e,t){util.initJqValidation(),$("form").valid()&&(e.isSubmit=!0,n.put(r,e.model).then(function(){e.isSubmit=!1,i.alert("更新成功"),t&&t()},function(){e.isSubmit=!1}))},deleteResource:function(e,t){e.isSubmit=!0,n.delete(r,{data:e.resId||""}).then(function(){i.alert("删除成功"),e.isSubmit=!1,t&&t()},function(){e.isSubmit=!1})},resetResource:function(e,t){e.isSubmit=!0,n.post(r+"/reset").then(function(){e.isSubmit=!1,i.alert("系统资源已成功重置"),t&&t()},function(){e.isSubmit=!1})}}})}(),function(){"use strict";angular.module("myApp").config(function(e){e.state("role",{url:"/role",controllerAs:"vm",templateUrl:util.formatUrl("sys/role/html/list"),controller:function(i,n,r,t){i.csHide("bm");var o,a=this;a.role={},a.del=function(e){t.confirm("确认删除数据吗？",function(){a.roleId=e,n.deleteById(a)})},a.dels=function(){var e=$("#editTable").bootstrapTable("getSelections");if(0!=e.length){var i=[];$.each(e,function(e,t){i.push(t.roleId)}),a.del(i.join(","))}else t.warning("请选择要删除的数据")},a.authorization=function(e){a.roleId=e.roleId,a.displayName=e.displayName,function(e){o?t():r.getResourceData(i,function(e){e=e.value||[],o=$.fn.zTree.init($("#resourceTree"),{treeId:"resId",check:{enable:!0,chkboxType:{Y:"p",N:"s"}},data:{key:{name:"resName"},simpleData:{enable:!0,idKey:"resId",pIdKey:"parentId"}}},e),t()});function t(){o.checkAllNodes(!1),a.roleId=e.roleId,n.findRoleById(a,function(e){$.each(e.resources,function(e,t){o.checkNode(o.getNodeByParam("resId",t.resId),!0,!0)})})}}(e),$("#roleAuthorizationWin").modal("show")},a.toAuthorization=function(){o&&(a.resources=o.getCheckedNodes(!0),n.authorization(a))},a.start=function(e){n.stateEnable(e,a)},a.stop=function(e){n.stateDisable(e,a)},n.bsTableControl(a)}})})}(),function(){"use strict";function e(e){e.state("roleEdit",{url:"/roleEdit/:id",controllerAs:"vm",templateUrl:util.formatUrl("sys/role/html/edit"),controller:t})}function t(e,t,i){var n=this;n.roleId=t.params.id,n.role={roleState:"1"},n.roleId&&i.findRoleById(n),n.save=function(){n.roleId?i.update(n):i.create(n)}}angular.module("myApp").config(e),e.$inject=["$stateProvider"],t.$inject=["$scope","$state","roleSvc"]}(),function(){"use strict";angular.module("myApp").factory("roleSvc",function(n,i,t){var o=util.formatUrl("sys/role");return{bsTableControl:function(r){r.bsTableControl={options:util.getTableFilterOption({url:o,columns:[{title:"行号",width:50,switchable:!1,formatter:function(e,t,i){var n=r.bsTableControl.state;return n.pageNumber&&n.pageSize?i+1+(n.pageNumber-1)*n.pageSize:i+1}},{checkbox:!0},{field:"roleName",title:"角色名",sortable:!0,filterControl:"input",filterOperator:"like"},{field:"displayName",title:"角色显示名",sortable:!1,filterControl:"input",filterOperator:"like"},{field:"roleState",title:"状态",width:100,align:"center",filterControl:"input",filterOperator:"like",formatter:'<span class="bg-green" ng-if="row.roleState == 1">启用</span><span class="bg-red" ng-if="row.roleState != 1">禁用</span>'},{title:"操作",width:350,align:"center",formatter:$("#columnBtns").html()}]})}},create:function(e){util.initJqValidation(),$("form").valid()&&(e.isSubmit=!0,n.post(o,e.role).then(function(){e.isSubmit=!1,i.success("创建成功",function(){t.go("role")})},function(){e.isSubmit=!1}))},findRoleById:function(t,i){n.get(o+"/"+(t.roleId||"")).success(function(e){i?i(e):t.role=e})},update:function(e){util.initJqValidation(),$("form").valid()&&(e.isSubmit=!0,n.put(o,e.role).then(function(){e.isSubmit=!1,i.success("更新成功")},function(){e.isSubmit=!1}))},deleteById:function(e){e.isSubmit=!0,n.delete(o,{params:{roleId:e.roleId||""}}).then(function(){e.isSubmit=!1,i.success("删除成功"),e.bsTableControl.refresh()},function(){e.isSubmit=!1})},authorization:function(e){e.roleId?(e.isSubmit=!0,n.put(o+"/authorization?roleId="+e.roleId,e.resources).then(function(){e.isSubmit=!1,i.success("权限更新成功")},function(){e.isSubmit=!1})):i.warning("缺少参数")},stateEnable:function(e,t){n.put(o+"/enable?id="+e).then(function(){t.isSubmit=!1,i.success("状态已启用"),t.bsTableControl.refresh()},function(){t.isSubmit=!1})},stateDisable:function(e,t){n.put(o+"/disable?id="+e).then(function(){t.isSubmit=!1,i.success("状态已停用"),t.bsTableControl.refresh()},function(){t.isSubmit=!1})},findRoles:function(t,e,i){angular.isFunction(e)?(i=e,e=""):e=e||"",n.get(o,{params:e}).success(function(e){i?i(e):t.roles=e})},findUserRoles:function(t,e,i){angular.isFunction(e)?(i=e,e=""):e=e||"",n.get(o+"/userRoles",{params:{userId:e}}).success(function(e){i?i(e):t.roles=e})}}})}(),function(){"use strict";function e(e){e.state("sysVariable",{url:"/sysVariable",controllerAs:"vm",templateUrl:util.formatUrl("sys/variable/html/list"),controller:t})}function t(e,t,n){e.csHide("bm");var r=this;r.del=function(e){n.confirm("确认删除数据吗？",function(){r.varId=e,t.deleteById(r)})},r.dels=function(){var e=$("#editTable").bootstrapTable("getSelections");if(0!=e.length){var i=[];$.each(e,function(e,t){i.push(t.varId)}),r.del(i.join(","))}else n.warning("请选择要删除的数据")},t.bsTableControl(r)}angular.module("myApp").config(e),e.$inject=["$stateProvider"],t.$inject=["$scope","sysVariableSvc","bsWin"]}(),function(){"use strict";function e(e){e.state("sysVariableEdit",{url:"/sysVariableEdit/:id",controllerAs:"vm",templateUrl:util.formatUrl("sys/variable/html/edit"),controller:t})}function t(e,t){var i=this;i.varId=e.params.id,i.varId&&t.findById(i),i.save=function(){i.varId?t.update(i):t.create(i)}}angular.module("myApp").config(e),e.$inject=["$stateProvider"],t.$inject=["$state","sysVariableSvc"]}(),function(){"use strict";function e(n,t,i){var o=util.formatUrl("sys/variable");return{bsTableControl:function(r){r.bsTableControl={options:util.getTableFilterOption({url:o,columns:[{title:"行号",width:50,switchable:!1,formatter:function(e,t,i){var n=r.bsTableControl.state;return n.pageNumber&&n.pageSize?i+1+(n.pageNumber-1)*n.pageSize:i+1}},{checkbox:!0},{field:"varCode",title:"系统变量编码",sortable:!0,width:150,filterControl:"input",filterOperator:"like"},{field:"varName",title:"系统变量名",sortable:!1,width:150,filterControl:"input",filterOperator:"like"},{field:"typeName",title:"系统变量类型",width:150,sortable:!1,filterControl:"input",filterOperator:"like"},{field:"varValue",title:"系统变量值",width:200,sortable:!1,filterControl:"input",filterOperator:"like"},{field:"remark",title:"备注",sortable:!1,filterControl:"input",filterOperator:"like"},{title:"操作",width:150,align:"center",formatter:$("#columnBtns").html()}]})}},create:function(e){util.initJqValidation(),$("form").valid()&&(e.isSubmit=!0,n.post(o,e.model).then(function(){e.isSubmit=!1,t.success("创建成功",function(){i.go("role")})},function(){e.isSubmit=!1}))},findById:function(t,i){n.get(o+"/"+(t.varId||"")).success(function(e){i?i(e):t.model=e})},update:function(e){util.initJqValidation(),$("form").valid()&&(e.isSubmit=!0,n.put(o,e.model).then(function(){e.isSubmit=!1,t.success("更新成功"),$("#editTable").bootstrapTable("refresh")},function(){e.isSubmit=!1}))},deleteById:function(e){e.isSubmit=!0,n.delete(o,{params:{varId:e.varId||""}}).then(function(){e.isSubmit=!1,t.success("删除成功"),$("#editTable").bootstrapTable("refresh")},function(){e.isSubmit=!1})}}}angular.module("myApp").factory("sysVariableSvc",e),e.$inject=["$http","bsWin","$state"]}(),function(){"use strict";function e(e){e.state("user",{url:"/user",controllerAs:"vm",templateUrl:util.formatUrl("sys/user/html/list"),controller:t})}function t(n,t,e,i,r){n.csHide("bm");var o=this;o.orgList=[];var a,l={field:"organ.organId",operator:"eq",value:"|"};function s(e){l.value=e.organId,t.reloadBsTable(o,l)}function c(){a&&a.destroy(),o.orgList=[],e.getOrganList(o,function(e){o.orgList=e;var t=(a=$.fn.zTree.init($("#organTree"),{treeId:"organId",data:{key:{name:"organName"},simpleData:{enable:!0,idKey:"organId",pIdKey:"parentId"}},callback:{onClick:function(e,t,i){n.$apply(function(){s(i)})}}},e)).getNodeByParam("parentId",null);a.expandNode(t,!0),s(t),window.fuzzySearch("organTree","#organKey",null,!0)})}t.bsTableControl(o,l),o.resetPwd=function(e){o.userId=e,t.resetPwd(o)},o.del=function(e){o.userId=e,r.confirm("确认删除数据吗？",function(){t.deleteUser(o)})},o.dels=function(){var e=o.bsTableControl.getSelections();if(0!=e.length){var i=[];$.each(e,function(e,t){i.push(t.userId)}),o.del(i.join(","))}else r.warning("请选择要删除的数据")},o.start=function(e){o.userId=e.userId,t.enableUser(o)},o.stop=function(e){o.userId=e.userId,t.disableUser(o)},c(),o.initOrganTree=c,o.openUserEditWin=function(e){u.modal("show"),e?(o.isUpdate=!0,o.userId=e,t.findUserById(o,function(e){o.model=e})):(o.isUpdate=!1,o.model={useState:1,organ:{organId:o.organId}})};var u=$("#organUserEditModel").on("hidden.bs.modal",function(e){n.$apply(function(){o.model=null})});o.saveUser=function(){o.isUpdate?t.updateUser(o,function(){u.modal("hide"),$("#editTable").bootstrapTable("refresh")}):t.createUser(o,function(){u.modal("hide"),$("#editTable").bootstrapTable("refresh")})};var d=$("#userRolesModel");o.setRoles=function(e){o.userId=e.userId,d.modal("show"),i.findUserRoles(o,o.userId,function(e){o.roles=e||[]})},o.toSetRoles=function(){var i=[];d.find("input[name='roleId']:checked").each(function(e,t){this.disabled||i.push(this.value)}),t.toSetRoles(o,i.join(","))}}angular.module("myApp").config(e),e.$inject=["$stateProvider"],t.$inject=["$scope","userSvc","organSvc","roleSvc","bsWin"]}(),function(){"use strict";angular.module("myApp").config(function(e,t){e.state("userEdit",{url:"/userEdit/:id",controllerAs:"vm",templateUrl:util.formatUrl("sys/user/html/edit"),controller:function(e,t,i){e.csHide("基础管理");var n=this;n.userId=i.params.id,n.isUpdate=!1,n.userId?(n.isUpdate=!0,t.findUserById(n)):n.model={useState:1},n.save=function(){n.isUpdate?t.updateUser(n):t.createUser(n,function(){i.go("user")})}}})})}(),function(){"use strict";function e(r,o){var a=util.formatUrl("sys/user"),t=util.formatUrl("rsaKey");return{reloadBsTable:function(e,t){var i=e.bsTableControl.options;i.url=a,t&&(i.defaultFilters=t)},bsTableControl:function(r,e){r.bsTableControl={options:util.getTableFilterOption({defaultFilters:e,defaultSort:"itemOrder asc,createdDate desc",columns:[{title:"行号",switchable:!1,align:"center",width:50,formatter:function(e,t,i){var n=r.bsTableControl.state;return n.pageNumber&&n.pageSize?i+1+(n.pageNumber-1)*n.pageSize:i+1}},{checkbox:!0,align:"center"},{field:"username",title:"用户名",width:150,filterControl:"input",filterOperator:"like"},{field:"displayName",title:"姓名",width:150,sortable:!0,filterControl:"input",filterOperator:"like"},{field:"organ.organName",title:"所属机构",sortable:!1,width:200,filterControl:"input",filterOperator:"like"},{field:"lastLoginDate",title:"最后登录时间",width:120,sortable:!0,filterControl:"datepicker",filterOperator:"gt"},{field:"useState",title:"状态",width:60,align:"center",filterControl:"input",filterOperator:"like",formatter:'<span ng-if="row.useState == 1" class="bg-green">启用</span><span ng-if="row.useState != 1"  class="bg-red">禁用</span>'},{field:"",title:"操作",width:200,formatter:$("#userColumnBtns").html()}]})}},createUser:function(i,e){function n(){r.post(a,i.model).then(function(){i.isSubmit=!1,o.success("创建成功"),e&&e()},function(){i.isSubmit=!1})}util.initJqValidation(),$("form").valid()&&(i.isSubmit=!0,i.model.password?$.get(t).success(function(e){var t=new JSEncrypt;t.setPublicKey(e||""),i.model.password=t.encrypt(i.model.password),i.model.verifyPassword=t.encrypt(i.model.verifyPassword),n()}):n())},findUserById:function(t,i){if(!t.userId)return!1;r.get(a+"/"+t.userId).success(function(e){e=e||{},i?i(e):t.model=e})},updateUser:function(e,t){util.initJqValidation(),$("form").valid()&&(e.isSubmit=!0,r.put(a,e.model).then(function(){e.isSubmit=!1,o.success("更新成功"),t&&t()},function(){e.isSubmit=!1}))},enableUser:function(e,t){if(!e.userId)return!1;e.isSubmit=!0,r.put(a+"/enable?id="+e.userId).then(function(){e.isSubmit=!1,o.success("启用成功"),$("#editTable").bootstrapTable("refresh"),t&&t()},function(){e.isSubmit=!1})},disableUser:function(e,t){e.isSubmit=!0,r.put(a+"/disable?id="+e.userId).then(function(){e.isSubmit=!1,o.success("禁用成功"),$("#editTable").bootstrapTable("refresh"),t&&t()},function(){e.isSubmit=!1})},deleteUser:function(e){if(!e.userId)return!1;e.isSubmit=!0,r.delete(a+"?userId="+e.userId).then(function(){o.success("删除成功"),e.bsTableControl.refresh(),e.isSubmit=!1},function(){e.isSubmit=!1})},resetPwd:function(e,t){if(!(t=t||e.userId))return o.warning("缺少参数"),!1;o.confirm("您是否要重置用户密码？",function(){e.isSubmit=!0,r.put(a+"/resetPwd",t).then(function(){e.isSubmit=!1,o.success("用户密码已重置成功")},function(){e.isSubmit=!1})})},userResources:function(t,e,i){r.get(a+"/resources",{params:e}).success(function(e){i?i(e):t.menus=e})},toSetRoles:function(e,t){if(!e.userId)return o.warning("缺少参数"),!1;e.isSubmit=!0,r.post(a+"/setRoles",{},{params:{userId:e.userId,roleIds:t}}).then(function(){e.isSubmit=!1,o.success("用户角色设置成功")},function(){e.isSubmit=!1})}}}angular.module("myApp").factory("userSvc",e),e.$inject=["$http","bsWin"]}();