(function(t){"use strict";var e=t.fn.bootstrapTable.utils.sprintf,r=t.fn.bootstrapTable.utils.objectKeys;var i=function(t){return t.get(t.length-1).options};var o=function(t,r){var o=i(t);for(var n=0;n<o.length;n++){if(o[n].value!==""){if(!r.hasOwnProperty(o[n].value)){t.find(e("option[value='%s']",o[n].value)).hide()}else{t.find(e("option[value='%s']",o[n].value)).show()}}}};var n=function(e,r,i){r=t.trim(r);e=t(e.get(e.length-1));if(!l(e,r)){e.append(t("<option></option>").attr("value",r).text(t("<div />").html(i).text()))}};var a=function(e){var r=e.find("option:gt(0)");r.sort(function(e,r){e=t(e).text().toLowerCase();r=t(r).text().toLowerCase();if(t.isNumeric(e)&&t.isNumeric(r)){e=parseFloat(e);r=parseFloat(r)}return e>r?1:e<r?-1:0});e.find("option:gt(0)").remove();e.append(r)};var l=function(t,e){var r=i(t);for(var o=0;o<r.length;o++){if(r[o].value===e.toString()){return true}}return false};var s=function(t){t.$tableHeader.css("height","77px")};var f=function(t){var e=t.$header;if(t.options.height){e=t.$tableHeader}return e};var u=function(t){var e="select.odata-filter, input.odata-filter";if(t.options.height){e="table select.odata-filter, table input.odata-filter"}return e};var p=function(e){if(t.fn.bootstrapTable.utils.isIEBrowser()){if(t(e).is("input")){var r=0;if("selectionStart"in e){r=e.selectionStart}else if("selection"in document){e.focus();var i=document.selection.createRange();var o=document.selection.createRange().text.length;i.moveStart("character",-e.value.length);r=i.text.length-o}return r}else{return-1}}else{return-1}};var c=function(e,r){if(t.fn.bootstrapTable.utils.isIEBrowser()){if(e.setSelectionRange!==undefined){e.setSelectionRange(r,r)}else{t(e).val(e.value)}}};var d=function(e){var r=f(e),i=u(e);e.options.valuesFilterControl=[];r.find(i).each(function(){e.options.valuesFilterControl.push({field:t(this).closest("[data-field]").data("field"),value:t(this).val(),position:p(t(this).get(0))})})};var h=function(e){var r=null,i=[],o=f(e),n=u(e);if(e.options.valuesFilterControl.length>0){o.find(n).each(function(o,n){r=t(this).closest("[data-field]").data("field");i=t.grep(e.options.valuesFilterControl,function(t){return t.field===r});if(i.length>0){t(this).val(i[0].value);c(t(this).get(0),i[0].position)}})}};var v=function e(){var r=[],i=document.cookie.match(/(?:bs.table.)(\w*)/g);if(i){t.each(i,function(e,i){if(/./.test(i)){i=i.split(".").pop()}if(t.inArray(i,r)===-1){r.push(i)}});return r}};var b=function(e){var r=e.data,i=e.pageTo<e.options.data.length?e.options.data.length:e.pageTo,l=function(t){return t.filterControl&&typeof t.filterControl=="string"&&t.filterControl.toLowerCase()==="select"&&t.searchable},s=function(t){var e=t.filterData;return e===undefined||typeof e=="string"&&e.toLowerCase()==="column"},f=function(t){return t&&t.length>0};var u=e.options.pagination?e.options.sidePagination==="server"?e.pageTo:e.options.totalRows:e.pageTo;t.each(e.header.fields,function(i,p){var c=e.columns[t.fn.bootstrapTable.utils.getFieldIndex(e.columns,p)],d=t(".bootstrap-table-filter-control-"+g(c.field));if(l(c)&&s(c)&&f(d)){if(d.get(d.length-1).options.length===0){n(d,"","")}var h={};for(var v=0;v<u;v++){var b=r[v][p],y=t.fn.bootstrapTable.utils.calculateObjectValue(e.header,e.header.formatters[i],[b,r[v],v],b);h[y]=b}for(var m in h){n(d,h[m],m)}a(d);if(e.options.hideUnusedSelectOptions){o(d,h)}}})};var g=function(t){return String(t).replace(/(:|\.|\[|\]|,)/g,"\\$1")};var y=function(e,r){var i=false,o,l,s,f=0,u=r.children().children(".table-header"),p=0,c;for(var d in e.columns){o=e.columns[d];l="hidden";s=[];c=null;if(!o.visible){continue}var h=o.filterControl;if(!h){s.push('<div class="no-filter-control"></div>')}else{var v;if(o.searchable){l="visible";if(t.isFunction(h)){v=h(e,o.field,l,o.filterOperator,o.filterControlPlaceholder,o)}else{var b=e.options.filterTemplate[h];if(!b){v=null}else if(t.isFunction(b)){v=b(e,o.field,l,o.filterOperator,o.filterControlPlaceholder,o)}else{v=b.init(e,o.field,l,o.filterOperator,o.filterControlPlaceholder,o);c=b.initAfter}}}if(!v){s.push('<div class="no-filter-control"></div>')}else{i=true;s.push('<div class="filter-control">');s.push(v);s.push("</div>")}}var y=t(u[p]);p++;if(y.data("field")===o.field){e.appendControls(y,o,s.join(""),c)}var m=o.filterData;if(m!==undefined&&m.toLowerCase()!=="column"&&m.indexOf(":")>1){var w=T(C,m.substring(0,m.indexOf(":")));var O,S;if(w!==null){O=o.filterData.substring(o.filterData.indexOf(":")+1,o.filterData.length);S=t(".bootstrap-table-filter-control-"+g(o.field));n(S,"","");w(O,S)}else{throw new SyntaxError("Error. You should use any of these allowed filter data methods: var, json, url."+' Use like this: var: {key: "value"}')}var x,F;switch(w){case"url":t.ajax({url:O,dataType:"json",success:function(t){for(var e in t){n(S,e,t[e])}a(S)}});break;case"var":x=window[O];for(F in x){n(S,F,x[F])}a(S);break;case"jso":x=JSON.parse(O);for(F in x){n(S,F,x[F])}a(S);break}}}if(i){r.off("input propertychange paste",".number-input.odata-filter").on("input propertychange paste",".number-input.odata-filter",function(){this.value=this.value.replace(/\D|^0/g,"")}).css("ime-mode","disabled");r.off("input propertychange","input").on("input propertychange","input,select",function(t){clearTimeout(f);f=setTimeout(function(){e.onColumnSearch(t)},e.options.searchTimeOut)})}else{r.find(".filterControl").hide()}};var m=function(t){t=t===undefined?"left":t.toLowerCase();switch(t){case"left":return"ltr";case"right":return"rtl";case"auto":return"auto";default:return"ltr"}};var C={var:function(t,e){var r=window[t];for(var i in r){n(e,i,r[i])}a(e)},url:function(e,r){t.ajax({url:e,dataType:"json",success:function(t){for(var e in t){n(r,e,t[e])}a(r)}})},json:function(t,e){var r=JSON.parse(t);for(var i in r){n(e,i,r[i])}a(e)}};var T=function(t,e){var r=Object.keys(t);for(var i=0;i<r.length;i++){if(r[i]===e){return t[e]}}return null};var w=t.fn.bootstrapTable.Constructor,O=w.prototype.init,S=w.prototype.initToolbar,x=w.prototype.initHeader,F=w.prototype.initBody,P=w.prototype.initSearch;t.fn.bootstrapTable.FILTER_OPERATOR={eq:"等于",neq:"不等于",gt:"大于",gte:"大于等于",lt:"小于",lte:"小于等于",like:"包含",nolike:"不包含",contains:"包含",doesnotcontain:"不包含",endswith:"从……结束于",startswith:"从……开始"};t.extend(t.fn.bootstrapTable.defaults,{filterControl:false,onColumnSearch:function(t,e){return false},defaultSort:null,defaultFilters:null,queryParams:function(e){var r=this,i=e.filter,o={$skip:e.offset,$top:e.limit,$orderby:!e.sort?r.defaultSort:e.sort+" "+e.order,$filter:i.length==0?"":t.toOdataFilter({logic:"and",filters:i})};if(r.pagination){o["$inlinecount"]="allpages"}return o},filterShowClear:false,alignmentSelectControlOptions:undefined,filterTemplate:{input:function(r,i,o,n,a){n=n||"eq";a=a||t.fn.bootstrapTable.FILTER_OPERATOR[n]||"";return e('<input type="text" class="form-control odata-filter bootstrap-table-filter-control-%s" name="%s" style="width: 100%; visibility: %s" operator="%s" placeholder="%s">',i,i,o,n,a)},number:function(r,i,o,n,a){n=n||"eq";a=a||t.fn.bootstrapTable.FILTER_OPERATOR[n]||"";return e('<input type="text" class="form-control odata-filter number-input bootstrap-table-filter-control-%s" name="%s" style="width: 100%; visibility: %s" operator="%s" placeholder="%s">',i,i,o,n,a)},numberRange:function(r,i,o,n,a){return e('<div class="row"><div class="col-xs-6"><input type="text" class="form-control odata-filter number-input bootstrap-table-filter-control-%s" name="%s" style="width: 100%; visibility: %s" operator="gte" placeholder="%s"></div>',i,i,o,t.fn.bootstrapTable.FILTER_OPERATOR["gte"])+e('<div class="col-xs-6"><input type="text" class="form-control odata-filter number-input bootstrap-table-filter-control-%s" name="%s" style="width: 100%; visibility: %s" operator="lte" placeholder="%s"></div></div> ',i,i,o,t.fn.bootstrapTable.FILTER_OPERATOR["lte"])},select:function(t,r,i){return e('<select class="form-control odata-filter select-filter-control bootstrap-table-filter-control-%s" name="%s" style="width: 100%; visibility: %s" dir="%s"></select>',r,r,i,m(t.options.alignmentSelectControlOptions))},datepicker:{init:function(r,i,o,n,a){n=n||"eq";a=a||t.fn.bootstrapTable.FILTER_OPERATOR[n]||"";return e('<div class="input-group date date-filter-control bootstrap-table-filter-control-%s"><input type="text" class="form-control odata-filter date-input" readonly name="%s" style="width: 100%; visibility: %s" operator="%s" placeholder="%s"><span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span></div>',i,i,o,n,a)},initAfter:function(e,r){var i=e.find("div.date-filter-control.bootstrap-table-filter-control-"+r.field).datetimepicker(t.extend({language:"zh-CN",format:"yyyy-mm-dd",minView:2,autoclose:true,todayBtn:true,todayHighlight:true,clearBtn:true},r.filterDatepickerOptions)).on("changeDate",function(t){i.children("input").trigger("input").trigger("propertychange")})}}},valuesFilterControl:[]});t.extend(w.COLUMN_DEFAULTS,{filterControl:undefined,filterData:undefined,filterDataKey:"key",filterDataName:"value",filterDatepickerOptions:undefined,filterStrictSearch:false,filterStartsWithSearch:false,filterOperator:undefined,filterControlPlaceholder:""});t.extend(w.EVENTS,{"column-search.bs.table":"onColumnSearch"});t.extend(t.fn.bootstrapTable.defaults.icons,{clear:"glyphicon-trash icon-clear"});t.extend(t.fn.bootstrapTable.locales,{formatClearFilters:function(){return"清除查询条件"}});t.extend(t.fn.bootstrapTable.defaults,t.fn.bootstrapTable.locales);w.prototype.init=function(){if(this.options.filterControl){var t=this;if(!Object.keys){r()}this.options.valuesFilterControl=[];this.$el.on("reset-view.bs.table",function(){if(!t.options.height){return}if(t.$tableHeader.find("select").length>0||t.$tableHeader.find("input").length>0){return}y(t,t.$tableHeader)}).on("post-header.bs.table",function(){h(t)}).on("post-body.bs.table",function(){if(t.options.height){s(t)}}).on("column-switch.bs.table",function(){h(t)})}O.apply(this,Array.prototype.slice.apply(arguments))};w.prototype.initToolbar=function(){this.showToolbar=this.options.filterControl&&this.options.filterShowClear;S.apply(this,Array.prototype.slice.apply(arguments));if(this.options.filterControl&&this.options.filterShowClear){var r=this.$toolbar.find(">.btn-group"),i=r.find(".filter-show-clear");if(!i.length){i=t(['<button class="btn btn-default filter-show-clear" ',e('type="button" title="%s">',this.options.formatClearFilters()),e('<i class="%s %s"></i> ',this.options.iconsPrefix,this.options.icons.clear),"</button>"].join("")).appendTo(r);i.off("click").on("click",t.proxy(this.clearFilterControl,this))}}};w.prototype.initHeader=function(){x.apply(this,Array.prototype.slice.apply(arguments));if(!this.options.filterControl){return}y(this,this.$header)};w.prototype.initBody=function(){F.apply(this,Array.prototype.slice.apply(arguments));b(this)};w.prototype.initSearch=function(){P.apply(this,Array.prototype.slice.apply(arguments));if(this.options.sidePagination==="server"){return}var e=this;var r=t.isEmptyObject(this.filterColumnsPartial)?null:this.filterColumnsPartial;this.data=r?t.grep(this.data,function(i,o){for(var n in r){var a=e.columns[t.fn.bootstrapTable.utils.getFieldIndex(e.columns,n)];var l=r[n].toLowerCase();var s=i[n];if(a&&a.searchFormatter){s=t.fn.bootstrapTable.utils.calculateObjectValue(e.header,e.header.formatters[t.inArray(n,e.header.fields)],[s,i,o],s)}if(a.filterStrictSearch){if(!(t.inArray(n,e.header.fields)!==-1&&(typeof s==="string"||typeof s==="number")&&s.toString().toLowerCase()===l.toString().toLowerCase())){return false}}else if(a.filterStartsWithSearch){if(!(t.inArray(n,e.header.fields)!==-1&&(typeof s==="string"||typeof s==="number")&&(s+"").toLowerCase().indexOf(l)===0)){return false}}else{if(!(t.inArray(n,e.header.fields)!==-1&&(typeof s==="string"||typeof s==="number")&&(s+"").toLowerCase().indexOf(l)!==-1)){return false}}}return true}):this.data};w.prototype.initColumnSearch=function(t){d(this);if(t){this.filterColumnsPartial=t;this.updatePagination();for(var e in t){this.trigger("column-search",e,t[e])}}};w.prototype.onColumnSearch=function(r){if(t.inArray(r.keyCode,[37,38,39,40])>-1){return}d(this);var i=r.currentTarget,o=t(i),n=o.attr("operator")||"eq",a=t.trim(o.val()),l=i.name||o.closest("[data-field]").data("field");if(l=="btSelectAll"){return false}if(t.isEmptyObject(this.filterColumnsPartial)){this.filterColumnsPartial={}}l=e("filter_%s_%s",n,l);this.onFilterText(o,l,a);this.searchText+="randomText";this.options.pageNumber=1;this.onSearch(r);this.trigger("column-search",l,a)};w.prototype.onFilterText=function(t,e,r){if(r){if(t.hasClass("date-input")){if(r.indexOf(" ")==-1){r+=" 00:00:00"}r=new Date(r)}else if(t.hasClass("number-input")){r=r*1;r=isNaN(r)?0:r}this.filterColumnsPartial[e]=r}else{delete this.filterColumnsPartial[e]}};w.prototype.initServerFilter=function(e){var r=this.options.defaultFilters||[];if(!t.isEmptyObject(r)&&!t.isArray(r)){r=[r]}var i=this.filterColumnsPartial;if(!t.isEmptyObject(i)){for(var o in i){var n=i[o],a="eq";if(o.indexOf("filter_")==0){var l=o.split("_");if(l.length==3){a=l[1];o=l[2]||""}else if(l.length==2){a="like";o=l[1]||""}else{return}}r.push({field:o,operator:a,value:n})}}e.filter=r};w.prototype.clearFilterControl=function(){if(this.options.filterControl&&this.options.filterShowClear){var r=this,i=v(),o=f(r),n=o.closest("table"),a=o.find(u(r)),l=r.$toolbar.find(".search input"),s=0;t.each(r.options.valuesFilterControl,function(t,e){e.value=""});h(r);if(a.length>0){this.filterColumnsPartial={};t(a[0]).trigger("input").trigger("propertychange")}else{return}if(l.length>0){r.resetSearch()}if(r.options.sortName!==n.data("sortName")||r.options.sortOrder!==n.data("sortOrder")){var p=o.find(e('[data-field="%s"]',t(a[0]).closest("table").data("sortName")));if(p.length>0){r.onSort(n.data("sortName"),n.data("sortName"));t(p).find(".sortable").trigger("click")}}clearTimeout(s);s=setTimeout(function(){if(i&&i.length>0){t.each(i,function(t,e){if(r.deleteCookie!==undefined){r.deleteCookie(e)}})}},r.options.searchTimeOut)}};w.prototype.createControls=y;w.prototype.appendControls=function(e,r,i,o){var n=this,a=n.$header;e.append(i);if(t.isFunction(o)){o(a,r)}}})(jQuery);